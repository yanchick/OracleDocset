<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104287"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Simple%20Single-Source%20Replication%20Example"></a><title>Simple Single-Source Replication Example</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1042"/>
<meta name="dcterms.created" content="2015-02-05T11:48:35Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Extended Examples"/>
<meta name="dcterms.identifier" content="E17912-10"/>
<meta name="dcterms.isVersionOf" content="STREX"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="release_changes.htm" title="Previous" type="text/html"/>
<link rel="Next" href="repsingdemo.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E17912-10.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">5/11</span> <!-- End Header -->
<div id="STREX002" class="chapter"><a id="g1033597"></a> <a id="i1006083"></a>
<h1 class="chapter"><span class="secnum">1</span> Simple Single-Source Replication Example</h1>
<p><a id="sthref6"></a><a id="sthref7"></a>This chapter illustrates an example of a simple single-source replication environment that can be constructed using Oracle Streams.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i1006111">Overview of the Simple Single-Source Replication Example</a></p>
</li>
<li>
<p><a href="#i1006127">Prerequisites</a></p>
</li>
<li>
<p><a href="#CJFGJAIH">Create Queues and Database Links</a></p>
</li>
<li>
<p><a href="#CJFJAJJE">Configure Capture, Propagation, and Apply for Changes to One Table</a></p>
</li>
<li>
<p><a href="#CJFEEGGF">Make Changes to the hr.jobs Table and View Results</a></p>
</li>
</ul>
<a id="i1006111"></a>
<div id="STREX544" class="sect1">
<h2 class="sect1">Overview of the Simple Single-Source Replication Example</h2>
<p>The example in this chapter illustrates using Oracle Streams to replicate data in one table between two databases. A capture process captures data manipulation language (DML) and data definition language (DDL) changes made to the <code dir="ltr">jobs</code> table in the <code dir="ltr">hr</code> schema at the <code dir="ltr">str1.example.com</code> Oracle database, and a propagation propagates these changes to the <code dir="ltr">str2.example.com</code> Oracle database. Next, an apply process applies these changes at the <code dir="ltr">str2.example.com</code> database. This example assumes that the <code dir="ltr">hr.jobs</code> table is read-only at the <code dir="ltr">str2.example.com</code> database.</p>
<p><a href="#i1006121">Figure 1-1</a> provides an overview of the environment.</p>
<div id="STREX545" class="figure">
<p class="titleinfigure"><a id="i1006121"></a>Figure 1-1 Simple Example that Shares Data from a Single Source Database</p>
<img width="597" height="222" src="img/strex035.gif" alt="Description of Figure 1-1 follows"/><br/>
<a id="sthref8" href="img_text/strex035.htm">Description of &#34;Figure 1-1 Simple Example that Shares Data from a Single Source Database&#34;</a><br/>
<br/></div>
<!-- class="figure" --></div>
<!-- class="sect1" -->
<a id="i1006127"></a>
<div id="STREX546" class="sect1">
<h2 class="sect1">Prerequisites</h2>
<p>The following prerequisites must be completed before you begin the example in this chapter.</p>
<ul>
<li>
<p><a id="sthref9"></a><a id="sthref10"></a><a id="sthref11"></a>Set the following initialization parameters to the values indicated:</p>
<ul>
<li>
<p><code dir="ltr">GLOBAL_NAMES</code>: This parameter must be set to <code dir="ltr">TRUE</code> at each database that is participating in your Oracle Streams environment.</p>
</li>
<li>
<p><code dir="ltr">COMPATIBLE</code>: This parameter must be set to <code dir="ltr">10.2.0</code> or higher at each database that is participating in your Oracle Streams environment.</p>
</li>
<li>
<p><code dir="ltr">STREAMS_POOL_SIZE</code>: Optionally set this parameter to an appropriate value for each database in the environment. This parameter specifies the size of the Oracle Streams pool. The Oracle Streams pool stores messages in a buffered queue and is used for internal communications during parallel capture and apply. When the <code dir="ltr">MEMORY_TARGET</code>, <code dir="ltr">MEMORY_MAX_TARGET</code>, or <code dir="ltr">SGA_TARGET</code> initialization parameter is set to a nonzero value, the Oracle Streams pool size is managed automatically.</p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<a class="olink STREP201" href="../STREP/prep_rep.htm#STREP201"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about other initialization parameters that are important in an Oracle Streams environment</div>
</li>
</ul>
</li>
<li>
<p><a id="sthref12"></a><a id="sthref13"></a>Any database producing changes that will be captured must be running in <code dir="ltr">ARCHIVELOG</code> mode. In this example, changes are produced at <code dir="ltr">str1.example.com</code>, and so <code dir="ltr">str1.example.com</code> must be running in <code dir="ltr">ARCHIVELOG</code> mode.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN008" href="../ADMIN/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about running a database in <code dir="ltr">ARCHIVELOG</code> mode</div>
</li>
<li>
<p>Configure your network and Oracle Net so that the <code dir="ltr">str1.example.com</code> database can communicate with the <code dir="ltr">str2.example.com</code> database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a></div>
</li>
<li>
<p>Create an Oracle Streams administrator at each database in the replication environment. In this example, the databases are <code dir="ltr">str1.example.com</code> and <code dir="ltr">str2.example.com</code>. This example assumes that the user name of the Oracle Streams administrator is <code dir="ltr">strmadmin</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STREP200" href="../STREP/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for instructions about creating an Oracle Streams administrator</div>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CJFGJAIH"></a>
<div id="STREX547" class="sect1">
<h2 class="sect1">Create Queues and Database Links</h2>
<p>Complete the following steps to create queues and database links for an Oracle Streams replication environment that includes two Oracle databases.</p>
<ol>
<li>
<p><a href="#i1026451">Show Output and Spool Results</a></p>
</li>
<li>
<p><a href="#CJFDIGFI">Create the ANYDATA Queue at str1.example.com</a></p>
</li>
<li>
<p><a href="#CJFEGIDA">Create the Database Link at str1.example.com</a></p>
</li>
<li>
<p><a href="#CJFCIHDJ">Set Up the ANYDATA Queue at str2.example.com</a></p>
</li>
<li>
<p><a href="#CJFDAHIG">Check the Spool Results</a></p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are viewing this document online, then you can copy the text from the &#34;BEGINNING OF SCRIPT&#34; line after this note to the next &#34;END OF SCRIPT&#34; line into a text editor and then edit the text to create a script for your environment. Run the script with SQL*Plus on a computer that can connect to all of the databases in the environment.</div>
<pre dir="ltr">/************************* BEGINNING OF SCRIPT ******************************
</pre>
<a id="i1026451"></a>
<dl>
<dd><a id="STREX1179"></a><a id="CJFICIFJ"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Show Output and Spool Results</dt>
<dd>
<p>Run <code dir="ltr">SET</code> <code dir="ltr">ECHO</code> <code dir="ltr">ON</code> and specify the spool file for the script. Check the spool file for errors after you run this script.</p>
<pre dir="ltr">*/

SET ECHO ON
SPOOL streams_setup_simple.out

/*
</pre></dd>
<dd><a id="STREX1180"></a><a id="CJFDIGFI"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Create the ANYDATA Queue at str1.example.com</dt>
<dd>
<p>Connect as the Oracle Streams administrator at the database where you want to capture changes. In this example, that database is <code dir="ltr">str1.example.com</code>.</p>
<pre dir="ltr">*/

CONNECT strmadmin@str1.example.com

/*
</pre>
<p>Run the <code dir="ltr">SET_UP_QUEUE</code> procedure to create a queue named <code dir="ltr">streams_queue</code> at <code dir="ltr">str1.example.com</code>. This queue will function as the <code dir="ltr">ANYDATA</code> queue by holding the captured changes that will be propagated to other databases.</p>
<p>Running the <code dir="ltr">SET_UP_QUEUE</code> procedure performs the following actions:</p>
<ul>
<li>
<p>Creates a queue table named <code dir="ltr">streams_queue_table</code>. This queue table is owned by the Oracle Streams administrator (<code dir="ltr">strmadmin</code>) and uses the default storage of this user.</p>
</li>
<li>
<p>Creates a queue named <code dir="ltr">streams_queue</code> owned by the Oracle Streams administrator (<code dir="ltr">strmadmin</code>).</p>
</li>
<li>
<p>Starts the queue.</p>
</li>
</ul>
<pre dir="ltr">*/

EXEC DBMS_STREAMS_ADM.SET_UP_QUEUE();

/*
</pre></dd>
<dd><a id="STREX1181"></a><a id="CJFEGIDA"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Create the Database Link at str1.example.com<span class="bold"><a class="dashingAutolink" name="autolink-104288"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref14"></a></span></dt>
<dd>
<p>Create the database link from the database where changes are captured to the database where changes are propagated. In this example, the database where changes are captured is <code dir="ltr">str1.example.com</code>, and these changes are propagated to&nbsp;<code dir="ltr">str2.example.com</code>.</p>
<pre dir="ltr">*/

ACCEPT password PROMPT &#39;Enter password for user: &#39; HIDE

CREATE DATABASE LINK str2.example.com CONNECT TO strmadmin 
   IDENTIFIED BY &amp;password USING &#39;str2.example.com&#39;;

/*
</pre></dd>
<dd><a id="STREX1182"></a><a id="CJFCIHDJ"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Set Up the ANYDATA Queue at str2.example.com</dt>
<dd>
<p>Connect as the Oracle Streams administrator at <code dir="ltr">str2.example.com</code>.</p>
<pre dir="ltr">*/

CONNECT strmadmin@str2.example.com

/*
</pre>
<p>Run the <code dir="ltr">SET_UP_QUEUE</code> procedure to create a queue named <code dir="ltr">streams_queue</code> at <code dir="ltr">str2.example.com</code>. This queue will function as the <code dir="ltr">ANYDATA</code> queue by holding the changes that will be applied at this database.</p>
<p>Running the <code dir="ltr">SET_UP_QUEUE</code> procedure performs the following actions:</p>
<ul>
<li>
<p>Creates a queue table named <code dir="ltr">streams_queue_table</code>. This queue table is owned by the Oracle Streams administrator (<code dir="ltr">strmadmin</code>) and uses the default storage of this user.</p>
</li>
<li>
<p>Creates a queue named <code dir="ltr">streams_queue</code> owned by the Oracle Streams administrator (<code dir="ltr">strmadmin</code>).</p>
</li>
<li>
<p>Starts the queue.</p>
</li>
</ul>
<pre dir="ltr">*/

EXEC  DBMS_STREAMS_ADM.SET_UP_QUEUE();

/*
</pre></dd>
<dd><a id="STREX1183"></a><a id="CJFDAHIG"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Check the Spool Results</dt>
<dd>
<p>Check the <code dir="ltr">streams_setup_simple.out</code> spool file to ensure that all actions finished successfully after this script is completed.</p>
<pre dir="ltr">*/

SET ECHO OFF
SPOOL OFF

<a id="i1026600"></a>/*************************** END OF SCRIPT ******************************/
</pre></dd>
</dl>
</div>
<!-- class="sect1" -->
<a id="CJFJAJJE"></a>
<div id="STREX548" class="sect1">
<h2 class="sect1">Configure Capture, Propagation, and Apply for Changes to One Table</h2>
<p>Complete the following steps to specify the capture, propagation, and apply definitions for the <code dir="ltr">hr.jobs</code> table using the <code dir="ltr">DBMS_STEAMS_ADM</code> package.</p>
<ol>
<li>
<p><a href="#CJFCCCAF">Show Output and Spool Results</a></p>
</li>
<li>
<p><a href="#CJFHCCDB">Configure Propagation at str1.example.com</a></p>
</li>
<li>
<p><a href="#CJFIDGFA">Configure the Capture Process at str1.example.com</a></p>
</li>
<li>
<p><a href="#CJFBBCCJ">Set the Instantiation SCN for the hr.jobs Table at str2.example.com</a></p>
</li>
<li>
<p><a href="#CJFBFHAJ">Configure the Apply Process at str2.example.com</a></p>
</li>
<li>
<p><a href="#CJFFHDEJ">Start the Apply Process at str2.example.com</a></p>
</li>
<li>
<p><a href="#CJFDFGEC">Start the Capture Process at str1.example.com</a></p>
</li>
<li>
<p><a href="#CJFHGBIG">Check the Spool Results</a></p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are viewing this document online, then you can copy the text from the &#34;BEGINNING OF SCRIPT&#34; line after this note to the next &#34;END OF SCRIPT&#34; line into a text editor and then edit the text to create a script for your environment. Run the script with SQL*Plus on a computer that can connect to all of the databases in the environment.</div>
<pre dir="ltr">/************************* BEGINNING OF SCRIPT ******************************
</pre>
<dl>
<dd><a id="STREX1184"></a><a id="CJFCCCAF"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Show Output and Spool Results</dt>
<dd>
<p>Run <code dir="ltr">SET</code> <code dir="ltr">ECHO</code> <code dir="ltr">ON</code> and specify the spool file for the script. Check the spool file for errors after you run this script.</p>
<pre dir="ltr">*/

SET ECHO ON
SPOOL streams_share_jobs.out

/*
</pre></dd>
<dd><a id="STREX1185"></a><a id="CJFHCCDB"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Configure Propagation at str1.example.com</dt>
<dd>
<p>Connect to <code dir="ltr">str1.example.com</code> as the <code dir="ltr">strmadmin</code> user.</p>
<pre dir="ltr">*/
 
CONNECT strmadmin@str1.example.com

/*
</pre>
<p>Configure and schedule propagation of DML and DDL changes to the <code dir="ltr">hr.jobs</code> table from the queue at <code dir="ltr">str1.example.com</code> to the queue at <code dir="ltr">str2.example.com</code>.</p>
<pre dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; &#39;hr.jobs&#39;, 
    streams_name            =&gt; &#39;str1_to_str2&#39;, 
    source_queue_name       =&gt; &#39;strmadmin.streams_queue&#39;,
    destination_queue_name  =&gt; &#39;strmadmin.streams_queue@str2.example.com&#39;,
    include_dml             =&gt; TRUE,
    include_ddl             =&gt; TRUE,
    source_database         =&gt; &#39;str1.example.com&#39;,
    inclusion_rule          =&gt; TRUE,
    queue_to_queue          =&gt; TRUE);
END;
/

/*
</pre></dd>
<dd><a id="STREX1186"></a><a id="CJFIDGFA"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Configure the Capture Process at str1.example.com</dt>
<dd>
<p>Configure the capture process to capture changes to the <code dir="ltr">hr.jobs</code> table at <code dir="ltr">str1.example.com</code>. This step specifies that changes to this table are captured by the capture process and enqueued into the specified queue.</p>
<p>This step also prepares the <code dir="ltr">hr.jobs</code> table for instantiation and enables supplemental logging for any primary key, unique key, bitmap index, and foreign key columns in this table. Supplemental logging places additional information in the redo log for changes made to tables. The apply process needs this extra information to perform certain operations, such as unique row identification and conflict resolution. Because <code dir="ltr">str1.example.com</code> is the only database where changes are captured in this environment, it is the only database where supplemental logging must be enabled for the <code dir="ltr">hr.jobs</code> table.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STREP107" href="../STREP/prep_rep.htm#STREP107"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a></div>
<pre dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name     =&gt; &#39;hr.jobs&#39;,   
    streams_type   =&gt; &#39;capture&#39;,
    streams_name   =&gt; &#39;capture_simp&#39;,
    queue_name     =&gt; &#39;strmadmin.streams_queue&#39;,
    include_dml    =&gt; TRUE,
    include_ddl    =&gt; TRUE,
    inclusion_rule =&gt; TRUE);
END;
/

/*
</pre></dd>
<dd><a id="STREX1187"></a><a id="CJFBBCCJ"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Set the Instantiation SCN for the hr.jobs Table at str2.example.com</dt>
<dd>
<p>This example assumes that the <code dir="ltr">hr.jobs</code> table exists at both the <code dir="ltr">str1.example.com</code> database and the <code dir="ltr">str2.example.com</code> database, and that this table is synchronized at these databases. Because the <code dir="ltr">hr.jobs</code> table already exists at <code dir="ltr">str2.example.com</code>, this example uses the <code dir="ltr">GET_SYSTEM_CHANGE_NUMBER</code> function in the <code dir="ltr">DBMS_FLASHBACK</code> package at <code dir="ltr">str1.example.com</code> to obtain the current SCN for the source database. This SCN is used at <code dir="ltr">str2.example.com</code> to run the <code dir="ltr">SET_TABLE_INSTANTIATION_SCN</code> procedure in the <code dir="ltr">DBMS_APPLY_ADM</code> package. Running this procedure sets the instantiation SCN for the <code dir="ltr">hr.jobs</code> table at <code dir="ltr">str2.example.com</code>.</p>
<p>The <code dir="ltr">SET_TABLE_INSTANTIATION_SCN</code> procedure controls which LCRs for a table are ignored by an apply process and which LCRs for a table are applied by an apply process. If the commit SCN of an LCR for a table from a source database is less than or equal to the instantiation SCN for that table at a destination database, then the apply process at the destination database discards the LCR. Otherwise, the apply process applies the LCR.</p>
<p>In this example, both of the apply process at <code dir="ltr">str2.example.com</code> will apply transactions to the <code dir="ltr">hr.jobs</code> table with SCNs that were committed after SCN obtained in this step.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This example assumes that the contents of the <code dir="ltr">hr.jobs</code> table at <code dir="ltr">str1.example.com</code> and <code dir="ltr">str2.example.com</code> are consistent when you complete this step. Ensure that there is no activity on this table while the instantiation SCN is being set. You might want to lock the table at each database while you complete this step to ensure consistency. If the table does not exist at the destination database, then you can use export/import for instantiation.</div>
<pre dir="ltr">*/

DECLARE
  iscn  NUMBER;         -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@STR2.EXAMPLE.COM(
    source_object_name    =&gt; &#39;hr.jobs&#39;,
    source_database_name  =&gt; &#39;str1.example.com&#39;,
    instantiation_scn     =&gt; iscn);
END;
/

/*
</pre></dd>
<dd><a id="STREX1188"></a><a id="CJFBFHAJ"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Configure the Apply Process at str2.example.com</dt>
<dd>
<p>Connect to <code dir="ltr">str2.example.com</code> as the <code dir="ltr">strmadmin</code> user.</p>
<pre dir="ltr">*/
 
CONNECT strmadmin@str2.example.com

/*
</pre>
<p>Configure <code dir="ltr">str2.example.com</code> to apply changes to the <code dir="ltr">hr.jobs</code> table.</p>
<pre dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; &#39;hr.jobs&#39;,
    streams_type    =&gt; &#39;apply&#39;, 
    streams_name    =&gt; &#39;apply_simp&#39;,
    queue_name      =&gt; &#39;strmadmin.streams_queue&#39;,
    include_dml     =&gt; TRUE,
    include_ddl     =&gt; TRUE,
    source_database =&gt; &#39;str1.example.com&#39;,
    inclusion_rule  =&gt; TRUE);
END;
/

/*
</pre></dd>
<dd><a id="STREX1189"></a><a id="CJFFHDEJ"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Start the Apply Process at str2.example.com</dt>
<dd>
<p>Set the <code dir="ltr">disable_on_error</code> parameter to <code dir="ltr">n</code> so that the apply process will not be disabled if it encounters an error, and start the apply process at <code dir="ltr">str2.example.com</code>.</p>
<pre dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; &#39;apply_simp&#39;, 
    parameter   =&gt; &#39;disable_on_error&#39;, 
    value       =&gt; &#39;N&#39;);
END;
/
 
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; &#39;apply_simp&#39;);
END;
/

/*
</pre></dd>
<dd><a id="STREX1190"></a><a id="CJFDFGEC"></a></dd>
<dt class="seghead">Step 7&nbsp;&nbsp;&nbsp;Start the Capture Process at str1.example.com</dt>
<dd>
<p>Connect to <code dir="ltr">str1.example.com</code> as the <code dir="ltr">strmadmin</code> user.</p>
<pre dir="ltr">*/
 
CONNECT strmadmin@str1.example.com

/*
</pre>
<p>Start the capture process at <code dir="ltr">str1.example.com</code>.</p>
<pre dir="ltr">*/

BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name  =&gt; &#39;capture_simp&#39;);
END;
/

/*
</pre></dd>
<dd><a id="STREX1191"></a><a id="CJFHGBIG"></a></dd>
<dt class="seghead">Step 8&nbsp;&nbsp;&nbsp;Check the Spool Results</dt>
<dd>
<p>Check the <code dir="ltr">streams_share_jobs.out</code> spool file to ensure that all actions finished successfully after this script is completed.</p>
<pre dir="ltr">*/

SET ECHO OFF
SPOOL OFF

/*************************** END OF SCRIPT ******************************/
</pre></dd>
</dl>
</div>
<!-- class="sect1" -->
<a id="CJFEEGGF"></a>
<div id="STREX549" class="sect1">
<h2 class="sect1">Make Changes to the hr.jobs Table and View Results</h2>
<p>Complete the following steps to make DML and DDL changes to the <code dir="ltr">hr.jobs</code> table at <code dir="ltr">str1.example.com</code> and then confirm that the changes were captured at <code dir="ltr">str1.example.com</code>, propagated from <code dir="ltr">str1.example.com</code> to <code dir="ltr">str2.example.com</code>, and applied to the <code dir="ltr">hr.jobs</code> table at&nbsp;<code dir="ltr">str2.example.com</code>.</p>
<dl>
<dd><a id="STREX1192"></a><a id="sthref15"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Make Changes to hr.jobs at str1.example.com</dt>
<dd>
<p>Make the following changes to the <code dir="ltr">hr.jobs</code> table.</p>
<pre dir="ltr">CONNECT hr@str1.example.com
Enter password: <span class="italic">password</span>

UPDATE hr.jobs SET max_salary=9545 WHERE job_id=&#39;PR_REP&#39;;
COMMIT;

ALTER TABLE hr.jobs ADD(duties VARCHAR2(4000));
</pre></dd>
<dd><a id="STREX1193"></a><a id="sthref16"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Query and Describe the hr.jobs Table at str2.example.com</dt>
<dd>
<p>After some time passes to allow for capture, propagation, and apply of the changes performed in the previous step, run the following query to confirm that the <code dir="ltr">UPDATE</code> change was propagated and applied at <code dir="ltr">str2.example.com</code>:</p>
<pre dir="ltr">CONNECT hr@str2.example.com
Enter password: <span class="italic">password</span>

SELECT * FROM hr.jobs WHERE job_id=&#39;PR_REP&#39;;
</pre>
<p>The value in the <code dir="ltr">max_salary</code> column should be <code dir="ltr">9545</code>.</p>
<p>Next, describe the <code dir="ltr">hr.jobs</code> table to confirm that the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> change was propagated and applied at <code dir="ltr">str2.example.com</code>:</p>
<pre dir="ltr">DESC hr.jobs
</pre>
<p>The <code dir="ltr">duties</code> column should be the last column.</p>
</dd>
</dl>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4743">
<tr>
<td class="cellalignment4750">
<table class="cellalignment4748">
<tr>
<td class="cellalignment4747"><a href="release_changes.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4747"><a href="repsingdemo.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4752">
<table class="cellalignment4746">
<tr>
<td class="cellalignment4747"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4747"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4747"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4747"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4747"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4747"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>