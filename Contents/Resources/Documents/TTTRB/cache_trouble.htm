<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-114087"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Troubleshooting%20TimesTen%20Application-Tier%20Database%20Cache"></a><title>Troubleshooting TimesTen Application-Tier Database Cache&nbsp;</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="dcterms.created" content="2014-10-07T19:55:1Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="TimesTen In-Memory Database Troubleshooting Guide"/>
<meta name="dcterms.identifier" content="E21636-11"/>
<meta name="dcterms.isVersionOf" content="TTTRB"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2011, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="datastore_trouble.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rep_trouble.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E21636-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">7/10</span> <!-- End Header -->
<div id="TTTRB223" class="chapter"><a id="sthref144"></a>
<h1 class="chapter"><span class="secnum">3</span> Troubleshooting TimesTen Application-Tier Database Cache&nbsp;</h1>
<p><a id="sthref145"></a>The following sections in this chapter describe how to troubleshoot problems you may encounter when using TimesTen Application-Tier Database Cache (TimesTen Cache):</p>
<ul>
<li>
<p><a href="#i556204">Unable to create a cache group</a></p>
</li>
<li>
<p><a href="#i572470">Unable to start or stop the cache agent</a></p>
</li>
<li>
<p><a href="#BABGDICE">Recovering cache grid after unexpected system shutdown</a></p>
</li>
<li>
<p><a href="#i522904">Unable to resolve Oracle Service Name</a></p>
</li>
<li>
<p><a href="#i539013">Unable to resolve connect identifier</a></p>
</li>
<li>
<p><a href="#i555874">Incompatible Oracle Database Server and Client versions</a></p>
</li>
<li>
<p><a href="#i572261">Unable to validate the Oracle database username and password</a></p>
</li>
<li>
<p><a href="#i556575">OCI initialization failed</a></p>
</li>
<li>
<p><a href="#i542262">Unsupported data type mapping</a></p>
</li>
<li>
<p><a href="#i542280">Null constraint does not match Oracle Database</a></p>
</li>
<li>
<p><a href="#BABGHBFD">DDL on cached Oracle database tables may cause cache group operations to fail</a></p>
</li>
<li>
<p><a href="#BABFHECG">Changes not visible after updating object in cache group</a></p>
</li>
<li>
<p><a href="#i555087">Loading or refreshing fails</a></p>
</li>
<li>
<p><a href="#i547144">Monitoring autorefresh cache groups</a></p>
</li>
<li>
<p><a href="#BABCGEGB">Optimize performance for TimesTen Cache</a></p>
</li>
<li>
<p><a href="#BABBCBAD">Avoid performance and memory problems for large batch jobs on Oracle database tables</a></p>
</li>
<li>
<p><a href="#i547090">Autorefresh not refreshing cache at the specified interval</a></p>
</li>
<li>
<p><a href="#i537373">Incremental autorefresh not progressing</a></p>
</li>
<li>
<p><a href="#i537308">Incremental autorefresh becomes full autorefresh</a></p>
</li>
<li>
<p><a href="#i521797">Poor autorefresh performance</a></p>
</li>
<li>
<p><a href="#BABJAEEI">Declaring NOVALIDATE on constraints causes cache group creation failure</a></p>
</li>
<li>
<p><a href="#BABBJGCH">AWR report showing lock contention with DBMS_LOCK</a></p>
</li>
</ul>
<p>If you are having problems with an AWT cache group, see <a href="awt_trouble.htm#g996353">Chapter 5, &#34;Troubleshooting AWT Cache Groups&#34;</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Error log messages from the cache agent daemon are designated by <code>CAC</code> in the message, as shown in several examples in this chapter. These messages are enabled unless you disable the <code>CACHE</code> component of the <code>ttDaemonLog</code> utility. See <a class="olink TTREF338" href="../TTREF/util.htm#TTREF338">&#34;ttDaemonLog&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Reference</span> for information about <code>ttDaemonLog</code> options for Windows and UNIX.</div>
<a id="i556204"></a>
<div id="TTTRB224" class="sect1">
<h2 class="sect1">Unable to create a cache group</h2>
<p>This section describes problems you might encounter when executing the <code>CREATE CACHE GROUP</code> statement.</p>
<div class="inftblhruleinformal">
<table class="cellalignment2557" title="Possible causes of trouble when creating a cache group" summary="This table lists possible causes for the inability to create a cache group. It also lists possible solutions and references to more information." dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t3">Possible cause</th>
<th class="cellalignment2558" id="r1c2-t3">What to do</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t3" headers="r1c1-t3">User does not have the correct Oracle database privileges to create the cache group type.</td>
<td class="cellalignment2559" headers="r2c1-t3 r1c2-t3">See <a href="#i520156">&#34;Check the Oracle database privileges&#34;</a>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t3" headers="r1c1-t3">User has insufficient access to the database.</td>
<td class="cellalignment2559" headers="r3c1-t3 r1c2-t3">You must have <code>CACHE_MANAGER</code> privilege to create a cache group.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r4c1-t3" headers="r1c1-t3">The internal/external user does not match the Oracle database user.</td>
<td class="cellalignment2559" headers="r4c1-t3 r1c2-t3">The TimesTen user name must be the same as the Oracle database user name.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r5c1-t3" headers="r1c1-t3">Cannot connect to the Oracle database.</td>
<td class="cellalignment2559" headers="r5c1-t3 r1c2-t3">See:
<ul>
<li>
<p><a href="#i522904">&#34;Unable to resolve Oracle Service Name&#34;</a></p>
</li>
<li>
<p><a href="#i539013">&#34;Unable to resolve connect identifier&#34;</a></p>
</li>
<li>
<p><a href="#i572261">&#34;Unable to validate the Oracle database username and password&#34;</a></p>
</li>
<li>
<p><a href="#i555874">&#34;Incompatible Oracle Database Server and Client versions&#34;</a></p>
</li>
<li>
<p>Check whether Oracle Database must be restarted.</p>
</li>
</ul>
<p>Check the network status.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r6c1-t3" headers="r1c1-t3">Cache administration user ID or password is not set (when trying to create AWT or autorefresh cache groups).</td>
<td class="cellalignment2559" headers="r6c1-t3 r1c2-t3">See <a href="#i529700">&#34;Set the cache administration user name and password&#34;</a>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r7c1-t3" headers="r1c1-t3">Data type mapping is unsupported.</td>
<td class="cellalignment2559" headers="r7c1-t3 r1c2-t3">See <a href="#i542262">&#34;Unsupported data type mapping&#34;</a>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r8c1-t3" headers="r1c1-t3">Nullability setting in the Oracle database is different.</td>
<td class="cellalignment2559" headers="r8c1-t3 r1c2-t3">See <a href="#i542280">&#34;Null constraint does not match Oracle Database&#34;</a>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r9c1-t3" headers="r1c1-t3">Primary key in root table is not specified.</td>
<td class="cellalignment2559" headers="r9c1-t3 r1c2-t3">The root table of a cache group must have a primary key. See <a class="olink TTCAC203" href="../TTCAC/define.htm#TTCAC203">&#34;Defining Cache Groups&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="sect1" -->
<a id="i572470"></a>
<div id="TTTRB225" class="sect1">
<h2 class="sect1">Unable to start or stop the cache agent<a id="sthref146"></a></h2>
<p>This section describes problems you might encounter when starting or stopping the cache agent.</p>
<div class="inftblhruleinformal">
<table class="cellalignment2557" title="Possible causes for inability to start or stop the cache agent." summary="This table contains possible causes for inability to start or stop the cache agent. It also lists possible solutions." dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t4">Possible cause</th>
<th class="cellalignment2558" id="r1c2-t4">What to do</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t4" headers="r1c1-t4">Cache agent is already running.</td>
<td class="cellalignment2559" headers="r2c1-t4 r1c2-t4">See <a href="#i572524">&#34;Check status of the cache agent&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t4" headers="r1c1-t4">Cannot locate Oracle Database libraries.</td>
<td class="cellalignment2559" headers="r3c1-t4 r1c2-t4">
<ul>
<li>See <a href="#i529366">&#34;Check status of TNS listener and Oracle Database Server&#34;</a>.</li>
<li>
<p>Check the permissions on the libraries.</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r4c1-t4" headers="r1c1-t4"><code>ORACLE_HOME</code> is invalid.</td>
<td class="cellalignment2559" headers="r4c1-t4 r1c2-t4">See <a href="#i535972">&#34;Check ORACLE_HOME environment variable&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r5c1-t4" headers="r1c1-t4">Privileges are insufficient.</td>
<td class="cellalignment2559" headers="r5c1-t4 r1c2-t4">You must have <code>CACHE_MANAGER</code> privilege to start or stop the cache agent.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r6c1-t4" headers="r1c1-t4"><code>OracleNetServiceName</code> is incorrect.</td>
<td class="cellalignment2559" headers="r6c1-t4 r1c2-t4">Ensure that the <code>OracleNetServiceName</code> set in your DSN definition matches the Oracle Service Name for the Oracle Database instance that contains the tables to cache in TimesTen.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" -->
<a id="i572524"></a>
<div id="TTTRB226" class="sect2">
<h3 class="sect2">Check status of the cache agent</h3>
<p>Check the status of the cache agent by using the <code>ttStatus</code> utility as described in <a href="tools.htm#i1367399">&#34;Using the ttStatus utility&#34;</a> to check the status of the cache agent.</p>
<p>If the cache agent is not running, start it as described in <a class="olink TTCAC199" href="../TTCAC/prereqs.htm#TTCAC199">&#34;Starting the cache agent&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>. If attempts to start the cache agent fail, then investigate the possible causes and restart the system before attempting to start the cache agent.</p>
</div>
<!-- class="sect2" -->
<a id="i535972"></a>
<div id="TTTRB227" class="sect2">
<h3 class="sect2">Check ORACLE_HOME environment variable</h3>
<p>On UNIX or Linux platforms, check that the <code>ORACLE_HOME</code> environment variable is set correctly for the shell from which you are starting the cache agent and the TimesTen daemon. Use the <a id="sthref147"></a><a id="sthref148"></a><code>ttmodinstall</code> utility if you need to change the setting for <code>ORACLE_HOME</code>.</p>
<p>See <a class="olink TTINS178" href="../TTINS/install.htm#TTINS178">&#34;Environment variables&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Installation Guide</span>.</p>
</div>
<!-- class="sect2" -->
<div id="TTTRB344" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref149"></a>
<h3 class="sect2">Check NLS environment variables</h3>
<p>NLS environment variables are set in the environment where the TimesTen application is running. Check to see if TimesTen is using the NLS environment variables.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABGDICE"></a>
<div id="TTTRB345" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Recovering cache grid after unexpected system shutdown</h2>
<p><a id="sthref150"></a><a id="sthref151"></a><a id="sthref152"></a><a id="sthref153"></a>The server may experience a system failure or an unexpected restart, such as with a power outage. In this case, the cache grid exits unexpectedly without the normal shutdown procedure.</p>
<p>The following sections describe how to recover when the system unexpectedly shuts down for two scenarios:</p>
<ul>
<li>
<p><a href="#BABECHGI">A portion of the cache grid nodes are still running</a></p>
</li>
<li>
<p><a href="#BABGJGIH">All cache grid nodes exited unexpectedly</a></p>
</li>
</ul>
<a id="BABECHGI"></a>
<div id="TTTRB346" class="sect2">
<h3 class="sect2">A portion of the cache grid nodes are still running</h3>
<p>When the server shuts down, some cache grid nodes exited unexpectedly, but others are still active. In this case, you must detach the dead nodes first by executing <code>ttGridDetachList</code> from an attached node, as follows.</p>
<ol>
<li>
<p>Connect to a surviving grid node and execute <code><a id="sthref154"></a><a id="sthref155"></a><a id="sthref156"></a>ttGridDetachList</code> to force a detach of all dead nodes from the grid.</p>
</li>
<li>
<p>Connect to the databases on the restarted server. Start the replication agent by executing <code>ttRepStart</code>.</p>
</li>
<li>
<p>Attach the cache grid nodes by executing <code>ttGridAttach</code>.</p>
</li>
<li>
<p>Resume normal database operations.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABGJGIH"></a>
<div id="TTTRB347" class="sect2">
<h3 class="sect2">All cache grid nodes exited unexpectedly</h3>
<p>If all cache grid nodes exited unexpectedly when the server shut down, perform the following tasks to recover the cache grid:</p>
<ol>
<li>
<p>Log on to each grid node by connecting to the databases on the restarted server. Start the replication agent by executing <code>ttRepStart</code>. The replication agent will flush the existing log, even if the log is current.</p>
</li>
<li>
<p>Call <code>ttGridAttach</code> on each node, which will fail with a communication error because it cannot communicate with other members. The failed attach cleans up the node information.</p>
</li>
<li>
<p>The last node on which you execute the <code>ttGridAttach</code> should succeed. At this point you have cleaned up all nodes, so execute <code>ttGridAttach</code> on all nodes again to attach each node to the grid.</p>
</li>
<li>
<p>Resume normal database operations.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i522904"></a>
<div id="TTTRB228" class="sect1">
<h2 class="sect1">Unable to resolve Oracle Service Name</h2>
<p>If you receive error <code>ORA-12514</code> indicating &#34;<code>could not resolve service name</code>&#34;:</p>
<ul>
<li>
<p>Use the Oracle Database <code>TNSPING</code> utility to verify that the service can be reached.</p>
</li>
<li>
<p>Ensure that the <code>OracleNetServiceName</code> set in your DSN definition matches the Oracle Service Name for the Oracle Database instance that contains the tables to cache in TimesTen.</p>
</li>
<li>
<p>Ensure that there is a service name defined. If it is a Windows Oracle client, use Oracle Net Configuration Assistant to configure a service name. In Oracle Net Configuration Assistant, navigate to Oracle Net Configuration -&gt; Local -&gt; Service Naming, select your Oracle Database server and confirm that there is a service name or a SID that identifies the Oracle Database server. If you add or modify a service name, you may need to restart.</p>
<p>Check the cache administration user name and password on the Oracle database with SQL*Plus to make sure this service name works. For example:</p>
<pre>%sqlplus <span class="italic">cache_admin_user</span>/<span class="italic">cache_admin_pwd</span>@<span class="codeinlineitalic">OracleHost</span>
</pre>
<p><code><span class="codeinlineitalic">cache_admin_user</span></code> is the cache administration user name, <code><span class="codeinlineitalic">cache_admin_pwd</span></code> is the cache administration user password, and <code><span class="codeinlineitalic">OracleHost</span></code> is the <code>OracleNetServiceName</code> specified in your DSN definition.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Your cache administration user may be different from your regular Oracle database user. See <a class="olink TTCAC172" href="../TTCAC/prereqs.htm#TTCAC172">&#34;Create the Oracle database users&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>.</div>
</li>
<li>
<p>Ensure that there is only one copy of <code>tnsnames.ora</code> on your TimesTen system. Also check the permission on <code>tnsnames.ora</code>.</p>
</li>
<li>
<p>If you run TimesTen on a UNIX system, check that the <code>ORACLE_HOME</code> environment variable is correctly defined. For example:</p>
<pre>ORACLE_HOME=/products/oracle11g
</pre></li>
<li>
<p>Check the Oracle Database client and server versions. See <a href="#i555874">&#34;Incompatible Oracle Database Server and Client versions&#34;</a>, following shortly.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="i539013"></a>
<div id="TTTRB229" class="sect1">
<h2 class="sect1">Unable to resolve connect identifier</h2>
<p>You may receive <a id="sthref157"></a><a id="sthref158"></a><a id="sthref159"></a><code>ORA-12154</code> &#34;<code>TNS:could not resolve the connect identifier specified</code>&#34; when you try to connect to a a database.</p>
<p>This can occur when you are trying to use TimesTen Cache and Oracle Database on the same system and the <code>TNS_ADMIN</code> environment variable does not point to the proper <code>tnsnames.ora</code> file for Oracle Database. For example, you may have several instances of the Oracle Database running on a laptop.</p>
<p>In a production environment, you typically have TimesTen and Oracle Database running on different systems. In this case, do not reset the <code>TNS_ADMIN</code> environment variable to point to a <code>tnsnames.ora</code> file on the system where TimesTen is running. The Oracle Database client uses the <code>TNS_ADMIN</code> setting to resolve the connection, but the TimesTen main daemon, the cache agent, the Web server, and the replication agent are unaware of the <code>TNS_ADMIN</code> setting. TimesTen Cache cannot operate properly when the Oracle Database client and TimesTen use different <code>tnsnames.ora</code> files.</p>
<p>On Windows, set the <code>TNS_ADMIN</code> environment variable as follows:</p>
<ol>
<li>
<p>Right-click My Computer and choose Properties.</p>
</li>
<li>
<p>On the Advanced tab, choose Environment Variables.</p>
</li>
<li>
<p>Add or edit <code>TNS_ADMIN</code> as a system environment variable so that it points to the directory that contains the <code>tnsnames.ora</code> file that you want to use. You can include other <code>tnsnames.ora</code> files with the <code>INAME</code> command inside the <code>tnsnames.ora</code> file.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i555874"></a>
<div id="TTTRB230" class="sect1">
<h2 class="sect1">Incompatible Oracle Database Server and Client versions</h2>
<p>If you receive <a id="sthref160"></a><a id="sthref161"></a><a id="sthref162"></a>connection timeout errors such as <code>ORA-12170</code> or <code>ORA-12535</code>, or if you receive <code>ORA-03134</code> (server version not supported), verify that you are using an Oracle Database client and Oracle Database server whose versions are compatible.</p>
<p>Metalink Documentation Note 207303.1, &#34;Client/Server/Interoperability Support Between Different Oracle Versions&#34;, lists the client/server combinations supported by Oracle.</p>
<p>See Oracle Database and TimesTen release notes for known problems with client/server versions.</p>
</div>
<!-- class="sect1" -->
<a id="i572261"></a>
<div id="TTTRB231" class="sect1">
<h2 class="sect1">Unable to validate the Oracle database username and password</h2>
<p>This section describes problems you might encounter when using the Oracle database username and password.</p>
<div class="inftblhruleinformal">
<table class="cellalignment2557" title="Possible causes of problems with the Oracle username and password" summary="This table contains possible causes for inability to validate the Oracle username and password. It also lists references to possible solutions." dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t6">Possible cause</th>
<th class="cellalignment2558" id="r1c2-t6">See...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t6" headers="r1c1-t6">The library environment variable is not set correctly.</td>
<td class="cellalignment2559" headers="r2c1-t6 r1c2-t6"><a href="#i529269">&#34;Check library path environment variable&#34;</a>, below</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t6" headers="r1c1-t6">Oracle Database processes are not running.</td>
<td class="cellalignment2559" headers="r3c1-t6 r1c2-t6"><a href="#i529366">&#34;Check status of TNS listener and Oracle Database Server&#34;</a>, below</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r4c1-t6" headers="r1c1-t6">User does not have the correct Oracle database privileges.</td>
<td class="cellalignment2559" headers="r4c1-t6 r1c2-t6"><a href="#i520156">&#34;Check the Oracle database privileges&#34;</a>, below</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r5c1-t6" headers="r1c1-t6">DSN is incorrectly configured.</td>
<td class="cellalignment2559" headers="r5c1-t6 r1c2-t6"><a href="#i520162">&#34;Check DSN definition&#34;</a></td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r6c1-t6" headers="r1c1-t6">There are problems with cache administration user ID or password.</td>
<td class="cellalignment2559" headers="r6c1-t6 r1c2-t6"><a href="#i529700">&#34;Set the cache administration user name and password&#34;</a></td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r7c1-t6" headers="r1c1-t6">User and system environments are inconsistent.</td>
<td class="cellalignment2559" headers="r7c1-t6 r1c2-t6"><a href="#i520185">&#34;Check user and system environment&#34;</a></td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r8c1-t6" headers="r1c1-t6">Dynamic libraries are not loading.</td>
<td class="cellalignment2559" headers="r8c1-t6 r1c2-t6"><a href="#i520200">&#34;Verify the loaded dynamic libraries&#34;</a></td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" -->
<a id="i529269"></a>
<div id="TTTRB232" class="sect2">
<h3 class="sect2">Check library path environment variable</h3>
<p>Check the library path environment variable on your platform.</p>
<div class="inftblhruleinformal">
<table class="cellalignment2557" title="Library path environment variables by platform" summary=" Summary value required!!!" dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t7">On this platform...</th>
<th class="cellalignment2558" id="r1c2-t7">Check this variable...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t7" headers="r1c1-t7">UNIX</td>
<td class="cellalignment2559" headers="r2c1-t7 r1c2-t7"><code>LD_LIBRARY_PATH</code></td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t7" headers="r1c1-t7">Windows</td>
<td class="cellalignment2559" headers="r3c1-t7 r1c2-t7"><code>PATH</code></td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" -->
<p>The library path environment variable must include the following information:</p>
<div class="inftblhruleinformal">
<table class="cellalignment2557" title="Information to include in the library path environment variable" summary="This table shows values that must be included in the library path variable for TimesTen and platform combinations." dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t8">TimesTen and platform bit combination</th>
<th class="cellalignment2558" id="r1c2-t8">Setting</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t8" headers="r1c1-t8">64-bit TimesTen or 32-bit TimesTen on 32-bit platform</td>
<td class="cellalignment2559" headers="r2c1-t8 r1c2-t8"><code>$ORACLE_HOME/LIB</code> and <code>$ORACLE_HOME/NETWORK/LIB</code></td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t8" headers="r1c1-t8">32-bit TimesTen on 64-bit platform</td>
<td class="cellalignment2559" headers="r3c1-t8 r1c2-t8"><code>$ORACLE_HOME/LIB32</code> and <code>$ORACLE_HOME/NETWORK/LIB32</code></td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="sect2" -->
<a id="i529366"></a>
<div id="TTTRB233" class="sect2">
<h3 class="sect2">Check status of TNS listener and Oracle Database Server</h3>
<p>Try to connect to the Oracle database by using SQL*Plus or use Oracle Enterprise Manager to verify the status.</p>
</div>
<!-- class="sect2" -->
<a id="i520156"></a>
<div id="TTTRB234" class="sect2">
<h3 class="sect2">Check the Oracle database privileges</h3>
<p>From an Oracle SQL*Plus command prompt, list the current Oracle database privileges granted to you by entering:</p>
<pre>SELECT * FROM SESSION_ROLES;
SELECT * FROM SESSION_PRIVS;
</pre>
<p>Compare the privileges listed against the required privileges for the various TimesTen Cache operations that are specified in <a class="olink TTCAC176" href="../TTCAC/prereqs.htm#TTCAC176">&#34;Grant privileges to the Oracle database users&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>. Contact your Oracle Database Administrator if you require additional privileges.</p>
</div>
<!-- class="sect2" -->
<a id="i520162"></a>
<div id="TTTRB235" class="sect2">
<h3 class="sect2">Check DSN definition</h3>
<ul>
<li>
<p>Confirm you have correctly set the DSN attributes, such as in the example <a class="olink TTCAC184" href="../TTCAC/prereqs.htm#TTCAC184">&#34;DSN for a TimesTen database that caches data from an Oracle database&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>.</p>
</li>
<li>
<p>Confirm that the DSN definition for TimesTen Cache is a system DSN.</p>
</li>
<li>
<p>Confirm that the DSN for TimesTen Cache is defined only once.</p>
</li>
<li>
<p>Confirm the Oracle database user name and password. Use SQLPlus and connect to the Oracle database using the same <code>OracleNetServiceName</code> and <code>OraclePWD</code> used in your DSN definition to confirm they are correct.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i520174"></a>
<div id="TTTRB236" class="sect2">
<h3 class="sect2">Reboot TimesTen machine</h3>
<p>If the Oracle Database client was installed and the system has not been restarted, then the TimesTen daemon is still running under the &#34;old&#34; environment before the Oracle Database client install. Restart your system so the TimesTen can start under the &#34;new&#34; environment.</p>
</div>
<!-- class="sect2" -->
<a id="i529700"></a>
<div id="TTTRB237" class="sect2">
<h3 class="sect2">Set the cache administration user name and password</h3>
<p>The cache administration user name and password must be set only once in a TimesTen database. However, they must be changed if the TimesTen database is destroyed and recreated or if the cache administration user name is dropped and recreated in the Oracle database.</p>
<p>The cache administration user name and password cannot be changed if the cache agent is running on the TimesTen database or there are cache groups in the database. The cache groups must be dropped before you can change the cache administration user name and password. You must also stop the cache agent before you change the cache administration user name and password, and then restart the cache agent after the user name and password have been changed.</p>
<p>From a <code>ttIsql</code> session, connect to the database as the cache manager user and call the <code>ttCacheUidPwdSet</code> built-in procedure to set the Oracle database cache administration user name and password, as follows:</p>
<pre>Command&gt; call ttCacheUidPwdSet(&#39;cacheuser&#39;,&#39;oracle&#39;);
</pre>
<p>If it returns an error, check the Oracle Database ID, the cache administration user ID and cache administration password. In addition, check whether the Oracle Database instance is running.</p>
<p>You can also set the user name and password by executing the <code>ttAdmin -cacheUidPwdSet</code> utility command as a TimesTen external user with the <code>CACHE_MANAGER</code> privilege:</p>
<pre>% ttAdmin -cacheUidPwdSet -cacheUid cacheuser -cachePwd oracle cachealone1
</pre>
<p>If you do not specify the <code>-cachePwd</code> option, the <code>ttAdmin</code> utility prompts for the cache administration user&#39;s password. For more information about the utility, see <a class="olink TTREF321" href="../TTREF/util.htm#TTREF321">&#34;ttAdmin&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</p>
</div>
<!-- class="sect2" -->
<a id="i520185"></a>
<div id="TTTRB238" class="sect2">
<h3 class="sect2">Check user and system environment</h3>
<p>Test to see if the problem is due to differences in user and system environment. This procedure requires two session windows (Command Prompt windows in Windows or shell windows in UNIX).</p>
<ol>
<li>
<p>Stop the TimesTen daemon.</p>
</li>
<li id="i540825">
<p>In one session window, start the Timesten daemon as a regular user.</p>
<p>On Windows:</p>
<pre>% install_dir/srv/ttsrv1122.exe -d -verbose
</pre>
<p>On UNIX:</p>
<pre>% <span class="italic">install_dir</span>/srv/timestend -d verbose
</pre>
<p>Some messages will flash by, and then it goes into a wait state.</p>
</li>
<li id="i520416">
<p>In another session window, try to restart the cache agent.</p>
</li>
<li>
<p>If Step <a href="#i520416">3</a> succeeds, then use Ctrl-C on Windows or the <code>kill</code> command on UNIX to stop the TimesTen daemon you started for the other session in Step <a href="#i540825">2</a>.</p>
</li>
<li>
<p>Compare the user environment and system environment. For example, do both user and system see the same copy of <code>oci.dll</code>? Are there any differences in the path name to the <code>oci.dll</code> library between the user and system environments?</p>
</li>
<li>
<p>If you detect differences, make the necessary modifications.</p>
</li>
<li>
<p>Restart the system and restart the TimesTen daemon.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="i520200"></a>
<div id="TTTRB239" class="sect2">
<h3 class="sect2">Verify the loaded dynamic libraries</h3>
<p>If you run on a Windows system with Visual C++ installed, verify the loaded dynamic libraries. This works only if you can start the cache agent without autorefresh:</p>
<ol>
<li>
<p>Make sure TimesTen is started.</p>
</li>
<li>
<p>Start the cache agent without autorefresh.</p>
<pre>Command&gt; call ttCacheStart;
Command&gt; create cache group cg1 from t1(c1 int not null primary key);
</pre></li>
<li>
<p>Open the Windows Task Manager, find process <code>ttora1122.exe</code> and highlight it. Right-click on it and select Debug. This brings you into Visual C++ and you should see the loaded DLL in the debug window, as described in <a href="#i522904">&#34;Unable to resolve Oracle Service Name&#34;</a>.</p>
</li>
<li>
<p>Load the cache group to force an cache connection from the cache agent:</p>
<pre>Command&gt; load cache group cg1 commit every 100 rows;
</pre></li>
<li>
<p>Compare the loaded DLL in your debug window with the partial list shown in <a href="#i572739">Example 3-1</a>.</p>
</li>
</ol>
<div id="TTTRB240" class="example">
<p class="titleinexample"><a id="i572739"></a>Example 3-1 List of loaded dlls</p>
<p>This partial list was created with the Oracle Database client.</p>
<pre>Loaded &#39;E:\TimesTen\tt1121_32\bin\timestenorad1121.exe&#39;, no matching symbolic 
information found.
Loaded &#39;C:\WINDOWS\SYSTEM32\ntdll.dll&#39;, no matching symbolic information found.
Loaded &#39;C:\WINDOWS\SYSTEM32\kernel32.dll&#39;, no matching symbolic information 
found.
Loaded &#39;E:\TimesTen\tt1121_32\bin\tten1121.dll&#39;, no matching symbolic information 
found.
Loaded &#39;E:\TimesTen\tt1121_32\bin\ttcommon1121.dll&#39;, no matching symbolic 
information found.
Loaded &#39;C:\WINDOWS\SYSTEM32\wsock32.dll&#39;, no matching symbolic information 
found.
Loaded &#39;C:\WINDOWS\SYSTEM32\ws2_32.dll&#39;, no matching symbolic information found.
Loaded &#39;C:\WINDOWS\SYSTEM32\msvcrt.dll&#39;, no matching symbolic information found.
Loaded &#39;C:\WINDOWS\SYSTEM32\ws2help.dll&#39;, no matching symbolic information 
found.
Loaded &#39;C:\WINDOWS\SYSTEM32\advapi32.dll&#39;, no matching symbolic information 
found.
Loaded &#39;C:\WINDOWS\SYSTEM32\rpcrt4.dll&#39;, no matching symbolic information found.
...
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i556575"></a>
<div id="TTTRB241" class="sect1">
<h2 class="sect1">OCI initialization failed</h2>
<p>Error 5105, &#34;<a id="sthref163"></a><code>OCI initialization failed</code>,&#34; may occur when an operation requires contact with the Oracle database. For example, the error might occur in the following situations:</p>
<ul>
<li>
<p>Starting the cache agent</p>
</li>
<li>
<p>Setting the cache administration user ID or password</p>
</li>
<li>
<p>Entering a SQL statement in TimesTen when autocommit=0 and PassThrough=3</p>
</li>
</ul>
<p>Error 5105 contains additional information about its cause:</p>
<ul>
<li>
<p>OCI cannot find an Oracle database library. See <a href="#i529269">&#34;Check library path environment variable&#34;</a> and check the permissions on the library specified in the error message.</p>
</li>
<li>
<p><code>ORACLE_HOME</code> is invalid. See <a href="#i535972">&#34;Check ORACLE_HOME environment variable&#34;</a>.</p>
</li>
<li>
<p>NLS environment variables are set in the environment where the TimesTen application is running. Check to see if TimesTen is using the NLS environment variables.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="i542262"></a>
<div id="TTTRB242" class="sect1">
<h2 class="sect1">Unsupported data type mapping</h2>
<p>When <a id="sthref164"></a>you try to create a cache group, you may receive the following error:</p>
<pre>5115: Unsupported type mapping for column <span class="codeinlineitalic">name</span>
</pre>
<p>For example, table <span class="italic">tab</span> on the Oracle database can be described as follows:</p>
<pre>COL1     NUMBER(38) NOT NULL
COL2     NUMBER(38)
</pre>
<p>Try to create the cache group as follows:</p>
<pre>CREATE CACHE GROUP cg FROM tab(col1 CHAR(10) NOT NULL PRIMARY KEY);
</pre>
<p>Error 5119 is displayed and the cache group is not created because the statement attempts to map a column of <code>NUMBER</code> data type to a column of <code>CHAR</code> data type.</p>
<p>See <a class="olink TTCAC363" href="../TTCAC/oracle_tt.htm#TTCAC363">&#34;Data type mappings allowed for key columns&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>.</p>
</div>
<!-- class="sect1" -->
<a id="i542280"></a>
<div id="TTTRB243" class="sect1">
<h2 class="sect1">Null constraint does not match Oracle Database</h2>
<p>When <a id="sthref165"></a>you try to create a cache group, you may receive the following warning:</p>
<pre>Warning 5119: Column <span class="codeinlineitalic">name</span> has different nullability setting in Oracle
</pre>
<p>For example, table <code>tab</code> on the Oracle database can be described as follows:</p>
<pre>COL1     NUMBER(38) NOT NULL
COL2     NUMBER(38)
</pre>
<p>Try to create the cache group as follows:</p>
<pre>CREATE CACHE GROUP cg 
    FROM tab(col1 INTEGER NOT NULL PRIMARY KEY, col2 INTEGER NOT NULL);
</pre>
<p>Warning 5119 is displayed because <code>col2</code> on the Oracle database does not have a <code>NULL</code> constraint, but <code>col2</code> in the cache group is defined as <code>NOT NULL</code>.</p>
</div>
<!-- class="sect1" -->
<a id="BABGHBFD"></a>
<div id="TTTRB244" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">DDL on cached Oracle database tables may cause cache group operations to fail</h2>
<p><a id="sthref166"></a><a id="sthref167"></a><a id="sthref168"></a><a id="sthref169"></a><a id="sthref170"></a><a id="sthref171"></a><a id="sthref172"></a>DDL operations that are performed on an Oracle database table that is being cached in TimesTen may cause a failure on the cache group. For example, the user drops a column on the Oracle database table that is being cached in TimesTen. When the cache group is propagated or flushed, TimesTen will update the column that no longer exists in the Oracle database table. When the cache group loads or refreshes, then TimesTen attempts to retrieve data from the column that has been dropped.</p>
<p>The following cache group operations may fail:</p>
<ul>
<li>
<p>Autorefresh does not occur.</p>
</li>
<li>
<p>AWT cache group operations are not propagated or refreshed to or from the Oracle database.</p>
</li>
<li>
<p>Cache group load or propagate fails.</p>
</li>
</ul>
<p>If you suspect the cache group operations are not working properly because of a DDL operation on the Oracle database base table, then use DDL tracking to diagnose the issue. DDL tracking saves the change history for all the cached Oracle database tables. The SQL statement and when it was executed are each written to a TimesTen table in the cache administrator user schema on the Oracle database.</p>
<p>For more information on how to create the DDL tracking objects and how to enable DDL tracking for the base table within the Oracle database, see &#34;<a class="olink TTCAC315" href="../TTCAC/manage.htm#TTCAC315">Tracking DDL statements issued on cached Oracle Database tables</a>&#34; in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>. For details on the built-in procedure used for enabling or disabling DDL tracking, see <a class="olink TTREF229" href="../TTREF/proced.htm#TTREF229">&#34;ttCacheDDLTrackingConfig&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</p>
</div>
<!-- class="sect1" -->
<a id="BABFHECG"></a>
<div id="TTTRB245" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Changes not visible after updating object in cache group</h2>
<p>If you modify an object in a cache group and then the changes do not appear on a subsequent SQL statement, then one of the following may have occurred:</p>
<ul>
<li>
<p>The object was dropped from the Oracle database or was somehow damaged.</p>
</li>
<li>
<p>Oracle database was restored or recovered to a time before the object was created.</p>
</li>
<li>
<p>The Oracle database was down.</p>
</li>
<li>
<p>The user modified the <code>OracleNetServiceName</code> DSN or connection attribute after creating the cache group, which points to an Oracle database other than the one that the cache group was created upon.</p>
</li>
</ul>
<p>For example, if the user creates an AWT cache group. Then, the user added rows to a table. When the user performs a <code>SELECT * FROM</code> the table, the rows did not appear. The <code>ttmesg.log</code> error file does not display an error that the Oracle database is not available. Instead, it displays the following messages:</p>
<pre>12:09:02.10 Err : REP: 29934: CACHE1:meta.c(904): TT5221: TT5221: Oracle syntax 
error in OCIStmtExecute(): ORA-00942: table or view does not exist rc = -1 -- 
file &#34;bdbStmt.c&#34;, lineno 1535, procedure &#34;getOraOutTypesNLengths()&#34; 
12:09:02.27 Err : REP: 29934: CACHE1:receiver.c(1978): TT5250: Awt Initialization 
Failure. Could not compile meta data sql. 
12:09:02.27 Warn: REP: 29934: CACHE1:transmitter.c(6505): TT16060: Failed to read 
data from the network. select() timed out 
</pre>
<p>To recover, perform the following:</p>
<ol>
<li>
<p>Stop all updates to the cache group.</p>
</li>
<li>
<p>If you are using an AWT cache group, then flush the cache group.</p>
</li>
<li>
<p>Recreate the cache group with the drop and create.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i555087"></a>
<div id="TTTRB246" class="sect1">
<h2 class="sect1">Loading or refreshing fails</h2>
<p>If the <code>LOAD CACHE GROUP</code> or <code>REFRESH CACHE GROUP</code> statement <a id="sthref173"></a><a id="sthref174"></a><a id="sthref175"></a><a id="sthref176"></a>fails when you specify <code>COMMIT EVERY</code> <code><span class="codeinlineitalic">n</span></code> <code>ROWS</code> and <code><span class="codeinlineitalic">n</span></code> is greater than 0, the contents of the target cache group could be in an inconsistent state. Some cache instances may be partially loaded.</p>
<p>Unload the cache group and then load it again. In some situations, it may be easier to drop and recreate the cache group.</p>
</div>
<!-- class="sect1" -->
<a id="i547144"></a>
<div id="TTTRB247" class="sect1">
<h2 class="sect1">Monitoring autorefresh cache groups</h2>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#i583726">Using the ttCacheAutorefreshStatsGet procedure</a></p>
</li>
<li>
<p><a href="#i552825">Displaying information from the change log tables</a></p>
</li>
<li>
<p><a href="#i551327">Understanding messages about autorefresh in the support log</a></p>
</li>
<li>
<p><a href="#i578017">Diagnosing autorefresh failure</a></p>
</li>
<li>
<p><a href="#i552863">Diagnosing autorefresh performance problems</a></p>
</li>
<li>
<p><a href="#i552876">Using SNMP traps for alerts about autorefresh problems</a></p>
</li>
</ul>
<a id="i583726"></a>
<div id="TTTRB248" class="sect2">
<h3 class="sect2">Using the ttCacheAutorefreshStatsGet procedure</h3>
<p>The <code>ttCacheAutorefreshStatsGet</code> procedure returns information about the last ten autorefresh operations on a specified cache group.</p>
<p>The <code>ttCacheAutorefreshStatsGet</code> procedure returns information only when the cache agent is running and the autorefresh state is <code>ON</code> or <code>PAUSED</code>. All of the return fields are set to 0 when the cache agent is restarted or the autorefresh state is changed to <code>OFF</code>.</p>
<div id="TTTRB249" class="example">
<p class="titleinexample"><a id="sthref177"></a>Example 3-2 Calling ttCacheAutorefreshStatsGet</p>
<p>This example uses <code>testcache</code>, which is a READONLY cache group with one table and an incremental autorefresh interval of 10 seconds.</p>
<pre>Command&gt; call ttcacheautorefreshstatsget(&#39;user1&#39;,&#39;testcache&#39;);

&lt; 1164260, 2007-07-23 15:43:52.000000, 850280, 44, 0, 75464, 528255, 75464, 310, 110, 6800, 
1890912, 12439795, 1890912, 160020, InProgress &gt;
&lt; 1164260, 2007-07-23 15:43:33.000000, 831700, 43, 13550, 108544, 759808, 108544, 1030, 230, 
12290, 1815448, 11911540, 1815448, 160020, Complete &gt;
&lt; 1164260, 2007-07-23 15:43:12.000000, 810230, 42, 17040, 115712, 809984, 115712, 610, 330, 
16090, 1706904, 11151732, 1706904, 146470, Complete &gt;
&lt; 1164260, 2007-07-23 15:42:52.000000, 790190, 41, 14300, 94208, 659456, 94208,560, 320, 
13410, 1591192, 10341748, 1591192, 129430, Complete &gt;
&lt; 1164260, 2007-07-23 15:42:32.000000, 770180, 40, 12080, 99328, 695296, 99328,450, 290, 
11340, 1496984, 9682292, 1496984, 115130, Complete &gt;
&lt; 1164260, 2007-07-23 15:42:12.000000, 750130, 39, 10380, 86016, 598368, 86016,430, 230, 
9720, 1397656, 8986996, 1397656, 103050, Complete &gt;
&lt; 1164260, 2007-07-23 15:41:52.000000, 730130, 38, 13530, 112640, 700768, 112640, 530, 220, 
12780, 1311640, 8388628, 1311640, 92670, Complete &gt;
&lt; 1164260, 2007-07-23 15:41:32.000000, 710120, 37, 9370, 56320, 326810, 56320, 310, 160, 
8900, 1199000, 7687860, 1199000, 79140, Complete &gt;
&lt; 1164260, 2007-07-23 15:41:22.000000, 700120, 36, 2120, 10240, 50330, 10240, 50, 200, 1870, 
1142680, 7361050, 1142680, 69770, Complete &gt;
&lt; 1164260, 2007-07-23 15:41:12.000000, 690110, 35, 0, 0, 0, 0, 0, 0, 0, 1132440, 7310720, 
1132440, 67650, Complete &gt;
10 rows found.
</pre>
<p><a href="#g584362">Table 3-1</a> describes the results from the first row of output.</p>
</div>
<!-- class="example" -->
<div id="TTTRB250" class="tblhruleformal">
<p class="titleintable"><a id="sthref178"></a><a id="g584362"></a>Table 3-1 ttCacheAutorefreshStatsGet results from last autorefresh operation</p>
<table class="cellalignment2557" title="ttCacheAutorefreshStatsGet results from last autorefresh operation" summary="This table describes the fields in the output from ttCacheAutorefreshStatsGet." dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t9">Result</th>
<th class="cellalignment2558" id="r1c2-t9">Field name</th>
<th class="cellalignment2558" id="r1c3-t9">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t9" headers="r1c1-t9">
<pre>1164260
</pre></td>
<td class="cellalignment2559" headers="r2c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">cgId</span></code></p>
</td>
<td class="cellalignment2559" headers="r2c1-t9 r1c3-t9">
<p>Cache group ID</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t9" headers="r1c1-t9">
<pre>2007-07-23 15:43:52.000000
</pre></td>
<td class="cellalignment2559" headers="r3c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">startTimestamp</span></code></p>
</td>
<td class="cellalignment2559" headers="r3c1-t9 r1c3-t9">
<p>Timestamp when autorefresh started for this interval</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r4c1-t9" headers="r1c1-t9">
<pre>850280
</pre></td>
<td class="cellalignment2559" headers="r4c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">cacheAgentUpTime</span></code></p>
</td>
<td class="cellalignment2559" headers="r4c1-t9 r1c3-t9">
<p>Number of cache agent clock ticks in milliseconds at the time the autorefresh transaction started for this interval</p>
<p>This value is cumulative and is reset when the cache agent process starts.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r5c1-t9" headers="r1c1-t9">
<pre>44
</pre></td>
<td class="cellalignment2559" headers="r5c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefNumber</span></code></p>
</td>
<td class="cellalignment2559" headers="r5c1-t9 r1c3-t9">
<p>Autorefresh number</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r6c1-t9" headers="r1c1-t9">
<pre>0
</pre></td>
<td class="cellalignment2559" headers="r6c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefDuration</span></code></p>
</td>
<td class="cellalignment2559" headers="r6c1-t9 r1c3-t9">
<p>Number of milliseconds spent in this autorefresh operation</p>
<p>It is zero because the operation is in progress.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r7c1-t9" headers="r1c1-t9">
<pre>75464
</pre></td>
<td class="cellalignment2559" headers="r7c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefNumRows</span></code></p>
</td>
<td class="cellalignment2559" headers="r7c1-t9 r1c3-t9">
<p>Number of rows autorefreshed in this autorefresh operation</p>
<p>This would include all rows in the root table and child tables if the cache group had child tables.</p>
<p><span class="bold">Note</span>: This information is not provided for full autorefresh.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r8c1-t9" headers="r1c1-t9">
<pre>528255
</pre></td>
<td class="cellalignment2559" headers="r8c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">numOracleBytes</span></code></p>
</td>
<td class="cellalignment2559" headers="r8c1-t9 r1c3-t9">
<p>Number of bytes transferred from the Oracle database in this autorefresh operation</p>
<p><span class="bold">Note</span>: This information is not provided for full autorefresh.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r9c1-t9" headers="r1c1-t9">
<pre>75464
</pre></td>
<td class="cellalignment2559" headers="r9c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefNumRootTblRows</span></code></p>
</td>
<td class="cellalignment2559" headers="r9c1-t9 r1c3-t9">
<p>Number of root table rows autorefreshed in this autorefresh operation</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r10c1-t9" headers="r1c1-t9">
<pre>310
</pre></td>
<td class="cellalignment2559" headers="r10c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefQueryExecDuration</span></code></p>
</td>
<td class="cellalignment2559" headers="r10c1-t9 r1c3-t9">
<p>Duration in milliseconds for the autorefresh query to execute on the Oracle database</p>
<p><span class="bold">Note</span>: This information is not provided for full autorefresh.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r11c1-t9" headers="r1c1-t9">
<pre>110
</pre></td>
<td class="cellalignment2559" headers="r11c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefQueryFetchDuration</span></code></p>
</td>
<td class="cellalignment2559" headers="r11c1-t9 r1c3-t9">
<p>Duration in milliseconds for the autorefresh query to fetch rows from the Oracle database</p>
<p><span class="bold">Note</span>: This information is not provided for full autorefresh.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r12c1-t9" headers="r1c1-t9">
<pre>6800
</pre></td>
<td class="cellalignment2559" headers="r12c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefTtApplyDuration</span></code></p>
</td>
<td class="cellalignment2559" headers="r12c1-t9 r1c3-t9">
<p>Duration in milliseconds for TimesTen to apply the updated rows to the cache group</p>
<p><span class="bold">Note</span>: This information is not provided for full autorefresh.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r13c1-t9" headers="r1c1-t9">
<pre>1890912
</pre></td>
<td class="cellalignment2559" headers="r13c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">totalNumRows</span></code></p>
</td>
<td class="cellalignment2559" headers="r13c1-t9 r1c3-t9">
<p>Total number of rows autorefreshed since the cache agent started</p>
<p><span class="bold">Note</span>: This information is not provided for full autorefresh.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r14c1-t9" headers="r1c1-t9">
<pre>12439795
</pre></td>
<td class="cellalignment2559" headers="r14c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">totalNumOracleBytes</span></code></p>
</td>
<td class="cellalignment2559" headers="r14c1-t9 r1c3-t9">
<p>The total number of bytes transferred from the Oracle database since the cache agent started</p>
<p><span class="bold">Note</span>: This information is not provided for full autorefresh.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r15c1-t9" headers="r1c1-t9">
<pre>1890912
</pre></td>
<td class="cellalignment2559" headers="r15c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">totalNumRootTblRows</span></code></p>
</td>
<td class="cellalignment2559" headers="r15c1-t9 r1c3-t9">
<p>Total number of root table rows autorefreshed since the cache agent started</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r16c1-t9" headers="r1c1-t9">
<pre>160020
</pre></td>
<td class="cellalignment2559" headers="r16c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">totalDuration</span></code></p>
</td>
<td class="cellalignment2559" headers="r16c1-t9 r1c3-t9">
<p>Total autorefresh duration in milliseconds since the cache agent started</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r17c1-t9" headers="r1c1-t9">
<pre>InProgress
</pre></td>
<td class="cellalignment2559" headers="r17c1-t9 r1c2-t9">
<p><code><span class="codeinlineitalic">autorefreshStatus</span></code></p>
</td>
<td class="cellalignment2559" headers="r17c1-t9 r1c3-t9">
<p>Status</p>
<p>Status can also be <code>Complete</code> or <code>Failed</code>.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformal" -->
<p>Note that the total number of autorefreshed rows (1890912) is the same as the total number of autorefreshed root table rows in this example because there are no child tables.</p>
<p>The number of autorefreshed rows in TimesTen does not necessarily reflect the number of rows updated on the Oracle database. The Oracle database updates may be applied in TimesTen more than once, or multiple Oracle database updates on the same row may be applied as one update in TimesTen.</p>
</div>
<!-- class="sect2" -->
<a id="i552825"></a>
<div id="TTTRB251" class="sect2">
<h3 class="sect2">Displaying information from the change log tables</h3>
<p>TimesTen provides the <code>cacheInfo</code> <a id="sthref179"></a><a id="sthref180"></a><a id="sthref181"></a>SQL script that gathers information from the change log tables that exist on the Oracle database for autorefresh cache groups. See <a class="olink TTCAC318" href="../TTCAC/manage.htm#TTCAC318">&#34;Managing a caching environment with Oracle Database objects&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span> for additional information about change log tables.</p>
<p>Run the script as the cache administration user on the Oracle database using SQL*Plus. If you run the script as a different user, it reports that the change log tables do not exist.</p>
<p>The <a id="sthref182"></a>script is in the following location:</p>
<pre><span class="codeinlineitalic">install_dir</span>/oraclescripts/cacheInfo.sql
</pre>
<p>The <code>cacheInfo</code> script displays the following information for each cached table:</p>
<pre>% cd TimesTen_install_dir/oraclescripts
% sqlplus cacheuser/oracle
SQL&gt; @cacheInfo
*************Autorefresh Objects Information ***************
Host name: sys1
Timesten datastore name: /users/OracleCache/alone1
Cache table name: ORATT.ORDERS
Change log table name: tt_06_69245_L
Number of rows in change log table: 100000
Maximum logseq on the change log table: 38
Timesten has autorefreshed updates up to logseq: 38
Number of updates waiting to be autorefreshed: 0
Number of updates that has not been marked with a valid logseq: 0
****************************
</pre>
<p>The information returned for each change log table includes the name of the change log table, the name of its corresponding TimesTen cache table, the number of rows in the change log table, and the number of updates in the change log table that have not been automatically refreshed into the cache table.</p>
<p>The log sequence number (<code>logseq</code>) acts as a marker for the autorefresh operation.</p>
</div>
<!-- class="sect2" -->
<a id="i551327"></a>
<div id="TTTRB252" class="sect2">
<h3 class="sect2">Understanding messages about autorefresh in the support log</h3>
<p>The support log <a id="sthref183"></a><a id="sthref184"></a>contains messages that show the progress of autorefresh. For example, <code>testcache</code> is a readonly cache group with an autorefresh interval of 10 seconds (10,000 milliseconds).</p>
<p>The support log shows when autorefresh starts:</p>
<pre>15:43:33.96 Info: CAC: 5264: TT47118-5264-5676-refresh03918: Starting autorefresh
number 43 for interval 10000ms
</pre>
<p>The message includes the following information:</p>
<ul>
<li>
<p>Message number: TT47118</p>
</li>
<li>
<p>Timestamp (<code>15:43:33.96</code>)</p>
</li>
<li>
<p>Cache agent process ID (<code>5264</code>)</p>
</li>
<li>
<p>Thread ID (<code>5676</code>)</p>
</li>
</ul>
<p>You can look up the message number in the <a class="olink TTERR" href="../TTERR/toc.htm"><span class="italic">Oracle TimesTen In-Memory Database Error Messages and SNMP Traps</span></a>. For example, in the log message above, TT47118 is error message number 47118.</p>
<p>The thread ID is important because autorefresh numbers are unique only for a specific interval. Always check both the thread ID and the autorefresh number when you are tracking a specific autorefresh operation.</p>
<p>The support log also contains a longer message that reports information similar to the <code>ttCacheAutorefreshStatsGet</code> procedure. 108544 rows were updated in this autorefresh interval, and 1815448 rows have been updated since the cache agent was started. Note that the total number of rows and the total number of root table rows are the same in this message because there is only one table in the cache group. <code>Number</code> refers to the autorefresh number. All times are expressed in milliseconds.</p>
<pre>15:43:51.81 Info: CAC: 5264: TT47087-5264-5676-refresh04387: Cache agent 
refreshed cache group USER1.TESTCACHE: Number - 43, Duration - 13550, NumRows - 
108544, NumRootTblRows - 108544, NumOracleBytes - 759808, queryExecDuration - 
230, queryFetchDuration - 1030, ttApplyDuration - 12290, totalNumRows - 1815448,
totalNumRootTblRows - 1815448, totalNumOracleBytes - 11911540, totalDuration - 
160020
</pre>
<p>Additional messages show that the autorefresh operation completes successfully:</p>
<pre>15:43:51.81 Info: CAC: 5264: TT47119-5264-5676-refresh04449: Autorefresh 
number 43 finished for interval 10000ms successfully
15:43:51.81 Info: CAC: 5264: TT47119-5264-5676-fresher01619: Autorefresh number
43 succeeded for interval 10000 milliseconds
</pre>
<p>Inspect the timestamps to determine whether autorefresh is progressing as expected.</p>
<p>See <a class="olink TTOPR215" href="../TTOPR/daemon.htm#TTOPR215">&#34;Managing TimesTen daemon options&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database Operations Guide</span> for information about setting the support log location.</p>
</div>
<!-- class="sect2" -->
<a id="i578017"></a>
<div id="TTTRB253" class="sect2">
<h3 class="sect2">Diagnosing autorefresh failure</h3>
<p>If <code>ttCacheAutorefreshStatsGet</code> shows that the status of an autorefresh operation is <a id="sthref185"></a><a id="sthref186"></a><span class="bold">Failed</span>, check the support log for messages related to the autorefresh operation with number the number shown in the <code>ttCacheAutorefreshStatsGet</code> output. Look for errors that occurred after the autorefresh operation started.</p>
<div id="TTTRB254" class="example">
<p class="titleinexample"><a id="sthref187"></a>Example 3-3 ttCacheAutorefreshStatsGet output shows autorefresh failure</p>
<p>This row of output from <code>ttCacheAutorefreshStatsGet</code> shows a failed autorefresh operation.</p>
<pre>&lt; 1164260, 2007-08-01 14:56:36.000000, 959350, <span class="bold">9</span>, 0, 0, 0, 0, 0, 0, 0, 1, 7,
 1, 50, Failed &gt;
</pre>
<p>The autorefresh number is 9.</p>
<p>The support log shows the start message for autorefresh number 9:</p>
<pre>14:56:36.10 Info: CAC: 5988: TT47118-5988-<span class="bold">4724</span>-refresh03926: Starting 
autorefresh number <span class="bold">9</span> for interval 15000ms
</pre>
<p>The thread ID for autorefresh number 9 is 4724. Look for error messages with this thread ID.</p>
<p>The following messages appear in the support log:</p>
<pre>14:56:36.10 Info: CAC: 5988: TT47117-5988-4724-refresh03953: Autorefresh thread 
for interval 15000ms is connected to instance inst1 on host host1. Server handle 
231976252
14:56:36.12 Err : CAC: 5988: TT40018-5988-4724-refresh07567: TimesTen error 
code:5901, msg The Oracle refresh log table, &#34;USER2&#34;.&#34;TT_06_81799_L&#34;, for base 
table, USER2.READTAB2, cannot be found.
14:56:36.12 Info: CAC: 5988: TT47055-5988-4724-refresh05559: Autorefresh rolled 
back.
14:56:36.12 Info: CAC: 5988: TT47119-5988-4724-refresh04458: Autorefresh number 
9 finished for interval 15000ms with error.
14:56:36.12 Err : CAC: 5988: TT40035-5988-4724-fresher01606: Autorefresh number 
9 failed for cache groups with interval 15000 ms after 10 retries.
</pre>
<p>The error message for thread ID 4724 shows that the change log table, <code>TT_06_81799_L</code>, is missing. The introduction to <a href="#i547090">&#34;Autorefresh not refreshing cache at the specified interval&#34;</a> has a table entry that describes what to do in this situation.</p>
</div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="i552863"></a>
<div id="TTTRB255" class="sect2">
<h3 class="sect2">Diagnosing autorefresh performance problems</h3>
<p>You can use the <code>ttTraceMon</code> utility to diagnose autorefresh performance problems. See <a href="tools.htm#i1368116">&#34;AUTOREFRESH tracing&#34;</a>.</p>
<p>TimesTen tracing severely impacts application performance and consumes a great deal of disk space if trace output is directed to a file. When you are finished, reset tracing to the default values.</p>
</div>
<!-- class="sect2" -->
<a id="i552876"></a>
<div id="TTTRB256" class="sect2">
<h3 class="sect2">Using SNMP traps for alerts about autorefresh problems</h3>
<p>Enable SNMP traps to alert you when autorefresh problems occur. The SNMP traps related to autorefresh include the following.</p>
<ul>
<li>
<p><code>ttCacheAutoRefQueFullTrap</code></p>
</li>
<li>
<p><code>ttCacheIncAutoRefFailedTrap</code></p>
</li>
<li>
<p><code>ttCacheValidationErrorTrap</code></p>
</li>
<li>
<p><code>ttCacheValidationWarnTrap</code></p>
</li>
<li>
<p><code>ttCacheValidationAbortedTrap</code></p>
</li>
</ul>
<p>See <a class="olink TTERR138" href="../TTERR/snmp.htm#TTERR138">&#34;Diagnostics through SNMP Traps&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database Error Messages and SNMP Traps</span>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABCGEGB"></a>
<div id="TTTRB348" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Optimize performance for TimesTen Cache</h2>
<p>The following recommendations may optimize performance for the TimesTen Cache:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Each of these suggestions involve performance tradeoffs, which may not always be beneficial for optimal use. Consider and test each performance suggestion for your own configured environment.</div>
<ul>
<li>
<p>Pin the TimesTen Cache meta tables and cache group base tables in the SGA. by executing the <code>ALTER TABLE</code> <code><span class="codeinlineitalic">table_name</span></code> <code>CACHE</code> statement to indicate to the Oracle database that these tables should be stored in the keep portion of the SGA buffer cache. Pinning TimesTen Cache tables in the SGA increases the probability that any given data block needed for a TimesTen Cache refresh operation will be available in the SGA when the refresh is performed and will not force a disk read. This minimizes physical disk reads executed during TimesTen cache refresh operations.</p>
</li>
<li>
<p><a id="sthref188"></a><a id="sthref189"></a><a id="sthref190"></a><a id="sthref191"></a><a id="sthref192"></a><a id="sthref193"></a>Pin TimesTen Cache triggers into the shared pool using the <code>dbms_shared_pool.keep</code> procedure. Pinning triggers into the shared pool for applications where updates to the cache group base tables are infrequent keeps the trigger from having to be reloaded and reparsed. This is not necessary for highly volatile tables where the trigger will be executed frequently and will remain in the shared pool under any circumstances.</p>
</li>
<li>
<p>Enable <a id="sthref194"></a><a id="sthref195"></a>parallel query. For very large base tables with 10 million rows or more, consider using the Oracle database parallel query facility. The primary join query between the log table and the base table is the kind of query which the Oracle database parallel query is designed to handle. When parallel processing is enabled, the parallel query optimizer generates a query plan that enables the original query to be broken into sections to be worked concurrently by different parallel query slave processes. When using parallel query, users should assign a default degree of parallelism of (<code>2*N</code>) to the cache group base table, where &#34;N&#34; is the number of CPUs on the system. Then, experiment to understand what level of parallelism works best for their environment. Experiment with different table structures for base tables, as follows.</p>
<ul>
<li>
<p>Use a standard heap table with default degree of parallelism assigned during table creation or by use of the <code>ALTER TABLE PARALLEL</code> command. Build an N-partition primary key index against the table.</p>
</li>
<li>
<p>Use an N-way partitioned table structure with partition range key based either on the table primary key or, in the case of a concatenated primary key, the high-order column of the primary key. The number of partitions should be set to the degree of parallelism. Use a local primary key index with the same number of partitions.</p>
</li>
<li>
<p>Use an N-way hashed partition structure using the primary key as the hash key, a local partitioned primary key index, and both index and table partitions equal to the degree of parallelism. The log table should not be partitioned, as the cardinalities of the log table should never be large enough that a partitioned log table would have any performance benefit. Further, given the continuously increasing value of the log table primary key column, range partitions cannot be used.</p>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="BABBCBAD"></a>
<div id="TTTRB366" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Avoid performance and <a id="sthref196"></a><a id="sthref197"></a>memory problems for large batch jobs on Oracle database tables</h2>
<p>Customers sometimes run large batch jobs at month-end or year-end on the Oracle database tables that are cached in read-only cache groups with incremental autorefresh. This can cause performance and memory problems for autorefresh operations and replication unless preventative steps are taken.</p>
<p>The tasks described in this section are supported for these components in an TimesTen Cache configuration:</p>
<ul>
<li>
<p>Read-only cache groups that are not in a cache grid and are not replicated by an active standby pair</p>
</li>
<li>
<p>Cache grid</p>
</li>
<li>
<p>Active standby pair replication</p>
</li>
<li>
<p>Active standby pair with a return service specified</p>
</li>
<li>
<p>Active standby pair with a disaster recovery subscriber</p>
</li>
<li>
<p>Physical, synchronous Oracle Data Guard</p>
</li>
<li>
<p>Oracle RAC</p>
</li>
</ul>
<p>Perform these tasks when large batch jobs must be run on the cached Oracle database tables:</p>
<ol>
<li>
<p>Set the autorefresh state to <code>PAUSED</code> for cache groups with the <code>AUTOREFRESH</code> attribute that are affected by the batch job. Perform this task on each standalone cache grid node and on the active node of an active standby pair grid member. For example:</p>
<pre>ALTER CACHE GROUP sampecg SET AUTOREFRESH STATE PAUSED;
COMMIT;
</pre></li>
<li>
<p>Set the autorefresh state to <code>PAUSED</code> for cache groups with the <code>AUTOREFRESH</code> attribute that are <span class="italic">not</span> directly affected by the batch job. This ensures that there is a consistent view of the data during batch processing. Perform this task on each standalone cache grid node and on the active node of an active standby pair grid member.</p>
</li>
<li>
<p>Run the batch job on the cached Oracle database tables.</p>
</li>
<li>
<p>Make sure all autorefresh change log records have been assigned a valid log sequence number (<code>logseq</code>). Call the <code>cacheInfo.sql</code> script:</p>
<pre>% cd <span class="italic">TimesTen_install_dir</span>/oraclescripts
% sqlplus cacheuser/oracle
SQL&gt; @cacheInfo
</pre>
<p>Look for the number of updates that have not been marked with a valid log sequence number. Ideally, the number should be zero or small (less than 100) for all tables in cache groups for which the autorefresh state was paused. Consider the following example.</p>
<pre>*************Autorefresh Objects Information  ***************
Host name: host1
Timesten datastore name: /scratch/ttuser/ds/mydsn
Cache table name: TTUSER.NOTAFFECTED
Change log table name: tt_05_460491_L
Number of rows in change log table: 1
Maximum logseq on the change log table: 1
Timesten has autorefreshed updates up to logseq: 1
Number of updates waiting to be autorefreshed: 0
Number of updates that has not been marked with a valid logseq: 0
****************************
Host name: host2
Timesten datastore name: /scratch/ttuser/ds/mydsn
Cache table name: TTUSER.AFFECTED
Change log table name: tt_05_460489_L
Number of rows in change log table: 100
Maximum logseq on the change log table: 213
Timesten has autorefreshed updates up to logseq: 213
<span class="bold">Number of updates waiting to be autorefreshed: 10000</span>
<span class="bold">Number of updates that has not been marked with a valid logseq: 0</span>
****************************
</pre></li>
<li>
<p>If the configuration includes active standby pair grid members, verify that the standby state is set to <code>PAUSED</code> on all standby nodes. Use the <code>ttIsql cachegroups</code> command.</p>
</li>
<li>
<p>For each cache group that was altered in step 1, manually refresh the cache group in parallel mode. Select appropriate values for the transaction size (number of rows committed at a time) and degree of parallelism. Perform this task on each standalone cache grid node and on the active node of an active standby pair grid member. For example:</p>
<pre>REFRESH CACHE GROUP samplecg
 COMMIT EVERY <span class="italic">n</span> ROWS PARALLEL <span class="italic">m</span>;
COMMIT;
</pre>
<p>Note that this operation automatically resets the autorefresh state to <code>ON</code>.</p>
</li>
<li>
<p>For each cache group that was altered in step 2, set the autorefresh state to <code>ON</code>. Perform this task on each standalone cache grid node and on the active node of an active standby pair grid member. For example:</p>
<pre>ALTER CACHE GROUP sampecg2 SET AUTOREFRESH ON;
COMMIT;
</pre></li>
</ol>
<p>It is good practice to periodically coalesce the indexes on the autorefresh log tables. See <a class="olink SQLRF00805" href="../SQLRF/statements_1012.htm#SQLRF00805">&#34;ALTER INDEX&#34;</a> in <span class="italic">Oracle Database SQL Language Reference</span>.</p>
</div>
<!-- class="sect1" -->
<a id="i547090"></a>
<div id="TTTRB257" class="sect1">
<h2 class="sect1">Autorefresh not refreshing cache at the specified interval</h2>
<p>The following table shows possible causes for autorefresh problems.</p>
<div class="inftblhruleinformal">
<table class="cellalignment2557" title="Possible causes of autorefresh problems" summary=" Summary value required!!!" dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t11">Possible cause</th>
<th class="cellalignment2558" id="r1c2-t11">What to do</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t11" headers="r1c1-t11">Cache agent is not started with a cache administration user.</td>
<td class="cellalignment2559" headers="r2c1-t11 r1c2-t11">Specify a cache administration user ID and password when starting the cache agent, as shown in <a class="olink TTCAC199" href="../TTCAC/prereqs.htm#TTCAC199">&#34;Starting the cache agent&#34;</a> in the <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>. Also see <a class="olink TTREF234" href="../TTREF/proced.htm#TTREF234">&#34;ttCacheStart&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Reference</span> and <a class="olink TTCAC189" href="../TTCAC/prereqs.htm#TTCAC189">&#34;Set the cache administration user name and password&#34;</a> in <span class="italic">Oracle TimesTen Application-Tier Database Cache User&#39;s Guide</span>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t11" headers="r1c1-t11">Object ID of the base table has changed.</td>
<td class="cellalignment2559" headers="r3c1-t11 r1c2-t11">See <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r4c1-t11" headers="r1c1-t11">Autorefresh trigger not enabled.</td>
<td class="cellalignment2559" headers="r4c1-t11 r1c2-t11">See <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r5c1-t11" headers="r1c1-t11">Current log sequence number recorded in the <code>TT_</code><code><span class="codeinlineitalic">version</span></code><code>_USER_COUNT</code> table is less than to the maximum log sequence number in the autorefresh log table.</td>
<td class="cellalignment2559" headers="r5c1-t11 r1c2-t11">See <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r6c1-t11" headers="r1c1-t11">There is no row in the <code>TT_</code><code><span class="codeinlineitalic">version</span></code><code>_USER_COUNT</code> table with <code><span class="codeinlineitalic">usercount</span></code> &gt; 0 for every active incremental autorefresh table.</td>
<td class="cellalignment2559" headers="r6c1-t11 r1c2-t11">See <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r7c1-t11" headers="r1c1-t11">Change log table is empty.</td>
<td class="cellalignment2559" headers="r7c1-t11 r1c2-t11">See <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r8c1-t11" headers="r1c1-t11">User count is less than 0 or any <code>TT_</code><code><span class="codeinlineitalic">version</span></code><code>_USER_COUNT</code> log sequence anomalies.</td>
<td class="cellalignment2559" headers="r8c1-t11 r1c2-t11">See <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r9c1-t11" headers="r1c1-t11">Autorefresh log table, trigger, or sequence associated with a cached table does not exist or is not valid.</td>
<td class="cellalignment2559" headers="r9c1-t11 r1c2-t11">Check whether the cache agent was started with the correct cache administration user ID. If the cache administration user ID is correct, follow the procedure described in <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.
<p>Check the user error log for messages about &#34;fatal anomalies&#34;. This indicates corrupt or missing Oracle database objects.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r10c1-t11" headers="r1c1-t11"><code>TT_</code><code><span class="codeinlineitalic">version</span></code><code>_USER_COUNT</code> table is missing.</td>
<td class="cellalignment2559" headers="r10c1-t11 r1c2-t11">Check whether the cache agent was started with the correct cache administration user ID. If the cache administration user ID is correct, follow the procedure in <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.
<p>Check the user error log for messages about &#34;fatal anomalies&#34;. This indicates corrupt or missing Oracle database objects.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r11c1-t11" headers="r1c1-t11">Current log sequence number in the <code>TT_</code><code><span class="codeinlineitalic">version</span></code><code>_USER_COUNT</code> table changes and is different from the bookmark, and the associated cached table is not refreshed by the next committed autorefresh.</td>
<td class="cellalignment2559" headers="r11c1-t11 r1c2-t11">Restart the cache agent. If that does not work, follow the procedure in <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>, below.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r12c1-t11" headers="r1c1-t11">If autorefresh occurs at the same time you alter the autorefresh mode, state, or interval, you may potentially cause a lock timeout as both actions modify the same table.</td>
<td class="cellalignment2559" headers="r12c1-t11 r1c2-t11">Stop the cache agent before altering the autorefresh mode, state, or interval. See <a href="#BABHGDHE">&#34;Avoid a lock timeout condition when modifying autorefresh mode, state, or interval&#34;</a>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r13c1-t11" headers="r1c1-t11">There is a resource problem.</td>
<td class="cellalignment2559" headers="r13c1-t11 r1c2-t11">Restart the cache agent.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" -->
<a id="i523724"></a>
<div id="TTTRB258" class="sect2">
<h3 class="sect2">Reset autorefresh state</h3>
<p>Incremental autorefresh does not work if the <code>TRUNCATE</code> statement is used on an Oracle database base table. If <code>TRUNCATE</code> is used on an Oracle database base table, then you must reset autorefresh by using the <code>ALTER CACHE GROUP</code> statement to set the autorefresh state to <code>OFF</code> followed by another <code>ALTER CACHE GROUP</code> to reset the autorefresh state to <code>ON</code>.</p>
</div>
<!-- class="sect2" -->
<a id="i524822"></a>
<div id="TTTRB259" class="sect2">
<h3 class="sect2">Recover and reset autorefresh for the Oracle database objects</h3>
<p>If you know or suspect the Oracle database objects used by autorefresh are the cause of the problem, use the following procedure to recreate the Oracle database objects.</p>
<ol>
<li>
<p>Use <code>ALTER CACHE GROUP</code> to reset the autorefresh state to <code>OFF</code> on all cache groups on all databases that have the affected cached table:</p>
<pre>ALTER CACHE GROUP <span class="italic">cache_group_name</span> SET AUTOREFRESH STATE OFF;
</pre></li>
<li>
<p>Shut down all cache agents on all affected databases.</p>
</li>
<li>
<p>Check if the user count is zero for each table in the cache group.</p>
<p>On the Oracle database, execute the following statement:</p>
<pre>SELECT usercount FROM <span class="italic">autorefresh_id</span>.tt_<span class="italic">version</span>_user_count
    WHERE tablename =&#39;<span class="italic">owner</span>.<span class="italic">tablename</span>&#39;;
</pre>
<p>If the count is not zero, set the count to zero:</p>
<pre>UPDATE <span class="italic">autorefresh_id</span>.tt_<span class="italic">version</span>_user_count SET usercount = 0
    WHERE tablename =&#39;<span class="italic">owner</span>.<span class="italic">tablename</span>&#39;;
</pre></li>
<li>
<p>Start one of the cache agents. The cache agent performs a clean up operation. It displays the following message to the support log after it has completed the cleanup:</p>
<pre>Cleanup of the Oracle objects completed
</pre></li>
<li>
<p>After the cache agent has completed the clean up, use <code>ALTER CACHE GROUP</code> to reset the autorefresh state back to <code>ON</code>:</p>
<pre>ALTER CACHE GROUP <span class="italic">cache_group_name</span> SET AUTOREFRESH STATE ON;
</pre></li>
<li>
<p>Start all other cache agents.</p>
</li>
<li>
<p>Use <code>ALTER CACHE GROUP</code> to reset the autorefresh state back to <code>ON</code> for all of the affected cache groups on all databases.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABHGDHE"></a>
<div id="TTTRB375" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Avoid a lock timeout condition when modifying autorefresh mode, state, or interval<a id="sthref198"></a><a id="sthref199"></a></h3>
<p>A lock timeout may occur if you modify the autorefresh mode, state, or interval with the <code>ALTER CACHE GROUP</code> statement at the same time when a scheduled autorefresh starts (scheduled because of the autorefresh interval).</p>
<ul>
<li>
<p>Autorefresh locks the cache tables and its rows in the <code>SYS.CACHE_GROUP</code> table.</p>
</li>
<li>
<p>The <code>ALTER CACHE GROUP SET AUTOREFRESH</code> statement updates the cache group state in the <code>SYS.CACHE_GROUP</code> table.</p>
</li>
</ul>
<p>This results in the following error:</p>
<pre>Error TT6003: Lock request denied because of time-out. 
</pre>
<p>As a workaround, you can:</p>
<ul>
<li>
<p>Increase the lock timeout with the <code>ttLockWait</code> built-in procedure.</p>
</li>
<li>
<p>Stop the cache agent before executing the <code>ALTER CACHE GROUP SET AUTOREFRESH</code> statement to modify the autorefresh mode, state, or interval. The following example demonstrates setting the autorefresh state to paused.</p>
<ol>
<li>
<p>Stop the cache agent.</p>
<pre>Command&gt; call ttCacheStop;
</pre></li>
<li>
<p>Alter the autorefresh state to the desired state. This example sets the autorefresh state to paused.</p>
<pre>Command&gt; ALTER CACHE GROUP new_customers SET AUTOREFRESH STATE PAUSED;
</pre></li>
<li>
<p>Start the cache agent.</p>
<pre>Command&gt; call ttCacheStart;
</pre></li>
</ol>
<p>For more information on <code>ALTER CACHE GROUP</code>, see <a class="olink TTSQL280" href="../TTSQL/state.htm#TTSQL280">&#34;ALTER CACHE GROUP&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database SQL Reference</span>. For more information on the <code>ttLockWait</code> built-in procedure, see <a class="olink TTREF260" href="../TTREF/proced.htm#TTREF260">&#34;ttLockWait&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i537373"></a>
<div id="TTTRB260" class="sect1">
<h2 class="sect1">Incremental autorefresh not progressing</h2>
<p>If incremental autorefresh is not progressing, verify that:</p>
<ul>
<li>
<p>Autorefresh state is <code>ON</code>.</p>
</li>
<li>
<p>Cache agent is running.</p>
</li>
</ul>
<p>Inspect the support log for the conditions described in the following table:</p>
<p>Table summary is in the first heading cell.</p>
<div class="inftblhruleinformal">
<table class="cellalignment2557" title=" Title value required on InformallTable elements!!!" summary=" Summary value required!!!" dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t12">Condition</th>
<th class="cellalignment2558" id="r1c2-t12">What to do</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t12" headers="r1c1-t12">Oracle Database server connection errors or warnings</td>
<td class="cellalignment2559" headers="r2c1-t12 r1c2-t12">See <a href="datastore_trouble.htm#i1211432">&#34;Troubleshooting Client/Server problems&#34;</a> for information about resolving connection problems.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t12" headers="r1c1-t12">Lock timeout errors or warnings on TimesTen</td>
<td class="cellalignment2559" headers="r3c1-t12 r1c2-t12">This usually occurs because of an open DDL transaction on the cache group. Commit the DDL transaction so that autorefresh can get the necessary locks.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r4c1-t12" headers="r1c1-t12">Insufficient permanent memory region errors on TimesTen</td>
<td class="cellalignment2559" headers="r4c1-t12 r1c2-t12">Increase <code>PermSize</code>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r5c1-t12" headers="r1c1-t12">Autorefresh Oracle Database object validations errors or warnings</td>
<td class="cellalignment2559" headers="r5c1-t12 r1c2-t12">See <a href="#i524822">&#34;Recover and reset autorefresh for the Oracle database objects&#34;</a>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r6c1-t12" headers="r1c1-t12">Cache agent unexpected exit</td>
<td class="cellalignment2559" headers="r6c1-t12 r1c2-t12">Contact TimesTen technical support.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r7c1-t12" headers="r1c1-t12">Core files in main daemon directory</td>
<td class="cellalignment2559" headers="r7c1-t12 r1c2-t12">Contact TimesTen technical support.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r8c1-t12" headers="r1c1-t12">Warnings about incremental autorefresh becoming full refresh</td>
<td class="cellalignment2559" headers="r8c1-t12 r1c2-t12">See <a href="#i537308">&#34;Incremental autorefresh becomes full autorefresh&#34;</a>.</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r9c1-t12" headers="r1c1-t12">Warnings that autorefresh has not finished for a long time</td>
<td class="cellalignment2559" headers="r9c1-t12 r1c2-t12">The autorefresh transaction can take a long time if many transactions have occurred since the last autorefresh.
<p><span class="bold">Note</span>: Cache groups with the same autorefresh interval are autorefreshed in one transaction.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" -->
<a id="i537541"></a>
<div id="TTTRB261" class="sect2">
<h3 class="sect2">Validate autorefresh for the Oracle database objects</h3>
<p>The cache agent automatically verifies that the Oracle database objects exist and that they are valid so that autorefresh can progress. In normal operation, you should not see object validation errors or warnings in the user error log. If you see object validation errors, contact TimesTen technical support <span class="italic">unless</span> one of the following conditions has occurred:</p>
<ul>
<li>
<p>The TimesTen database has been destroyed without using the <code>DROP CACHE GROUP</code> statement.</p>
</li>
<li>
<p>A customer application inadvertently modifies the objects directly in the Oracle database.</p>
</li>
<li>
<p>A DDL operation occurs on the base table on the Oracle database. This disables the trigger that controls autorefresh operations.</p>
</li>
</ul>
<p>The cache group must be recreated if one of the preceding conditions has occurred.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i537308"></a>
<div id="TTTRB262" class="sect1">
<h2 class="sect1">Incremental autorefresh becomes full autorefresh</h2>
<p>Incremental autorefresh can become <a id="sthref200"></a><a id="sthref201"></a>full autorefresh if the cache administration user tablespace becomes full.</p>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#i553514">Detecting when incremental autorefresh becomes full</a></p>
</li>
<li>
<p><a href="#i553519">Understanding the cache administration user tablespace</a></p>
</li>
<li>
<p><a href="#i553524">Diagnosing a full cache administration user tablespace</a></p>
</li>
<li>
<p><a href="#BABCGBCB">Monitoring the usage of the cache administration user&#39;s tablespace</a></p>
</li>
<li>
<p><a href="#BABJDFCE">Considerations when the tablespace of the cache administration is full</a></p>
</li>
</ul>
<a id="i553514"></a>
<div id="TTTRB263" class="sect2">
<h3 class="sect2">Detecting when incremental autorefresh becomes full</h3>
<p>You can detect when incremental autorefresh becomes full refresh by several methods:</p>
<ul>
<li>
<p>Check for messages in the support log that indicate full autorefresh operations are occurring. For example:</p>
<pre>2007-08-08 08:06:51.35 Warn: CAC: 11384: TT47166-11384-1087179104-lMarker01403:
A full autorefresh will be performed for Incremental autorefresh table 
USER1.READTAB because change log table TT_06_55555_L on Oracle has been 
truncated.
</pre></li>
<li>
<p>Use the <code>ttCacheAutorefreshStatsGet</code> procedure.</p>
<ul>
<li>
<p>If autorefresh is <span class="italic">InProgress</span> for longer than usual, full autorefresh may be occurring.</p>
</li>
<li>
<p>If a much larger number of rows (<code><span class="codeinlineitalic">autoRefNumRows</span></code>) was autorefreshed than usual, full autorefresh may have occurred.</p>
</li>
</ul>
<p>Check the support log for messages about full autorefresh.</p>
</li>
<li>
<p>If SNMP traps are enabled, the <code>ttCacheRecoveryAutorefreshTrap</code> SNMP trap indicates a full autorefresh.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i553519"></a>
<div id="TTTRB264" class="sect2">
<h3 class="sect2">Understanding the cache administration user tablespace</h3>
<p>TimesTen <a id="sthref202"></a><a id="sthref203"></a><a id="sthref204"></a><a id="sthref205"></a>strongly recommends creating a separate tablespace for the cache administration user. This tablespace is used as the cache administration user&#39;s default tablespace. The tablespace contains autorefresh triggers for each Oracle database table, change log tables for each Oracle database table, and other objects that TimesTen needs for each cache administration user. If you do not specify a separate tablespace, then these objects are placed in the Oracle Database system tablespace.</p>
<p>Specify the tablespace when you create the cache administration user on the Oracle database. You can also specify the tablespace after user creation with the <code>DEFAULT TABLESPACE</code> clause of the Oracle Database <code>ALTER USER</code> statement.</p>
<p>Change log tables for each of the cached Oracle database tables reside in the cache administration user tablespace. For each update on an Oracle database table, one row (a change log record) is inserted into the change log table for that Oracle database table. The size of a <a id="sthref206"></a>change log record in bytes is as follows:</p>
<pre>size of change log record = size of primary key on Oracle table + 250
</pre>
<p>The number of <a id="sthref207"></a>records in a change log table depends on the update rate on the Oracle database table and on the autorefresh interval on TimesTen. Every 20 seconds, TimesTen removes change log records that have been applied to all databases that cache the associated Oracle database table.</p>
<p>When change logs are removed, a message similar to the following is displayed in the support log:</p>
<pre>16:32:26.73 Info: CAC: 5652: TT47112-5652-4756-ogTblGC01036: Garbage collector 
deleted 1 rows from TT_06_383270_L where logseq &lt; 1
</pre>
<p>There are options on how to manage what happens when the cache administration user tablespace is filled. See <a href="#BABJDFCE">&#34;Considerations when the tablespace of the cache administration is full&#34;</a> for more information.</p>
</div>
<!-- class="sect2" -->
<a id="i553524"></a>
<div id="TTTRB265" class="sect2">
<h3 class="sect2">Diagnosing a full cache administration user tablespace</h3>
<p><a id="sthref208"></a><a id="sthref209"></a>Check for the following conditions if the cache administration user tablespace is full:</p>
<ul>
<li>
<p>Is the autorefresh state set to <code>PAUSED</code>? Change log records accumulate when the state is <code>PAUSED</code>.</p>
</li>
<li>
<p>Has the cache group been created but not loaded? The default autorefresh state for cache group creation is <code>PAUSED</code>.</p>
</li>
<li>
<p>Is a cache group being created or is a database being duplicated? Both of these operations temporarily stop clean-up operations on the change log table.</p>
</li>
<li>
<p>Are the cache agents on all TimesTen databases running? If a cache agent is not running, change log records accumulate.</p>
</li>
<li>
<p>Has a database been abandoned without dropping autorefresh cache groups in the database? Abandoned databases result from scenarios such as the following:</p>
<ul>
<li>
<p>The database is destroyed by <code>ttDestroy</code> <code>-force</code>.</p>
</li>
<li>
<p>The application connected to the database with the <code>Overwrite</code> connection attribute set to 1, but the cache groups that were in the old database are not recreated.</p>
</li>
</ul>
<p>If the database still exists, connect to the abandoned database and drop the cache group.</p>
</li>
</ul>
<p>Use the <code>cacheInfo.sql</code> script to find out how large the change log tables are for each cached Oracle database table. Use the output to verify that the databases are still in use. See <a href="#i552825">&#34;Displaying information from the change log tables&#34;</a>.</p>
<p>If the databases are still in use, verify that the cache agents are running.</p>
<p>Compare the autorefresh progress on TimesTen to the maximum log sequence number on the change log table. If TimesTen is behind, then call the <code>ttCacheAutorefreshStatsGet</code> procedure to see whether the autorefresh operations are successful. See <a href="#i583726">&#34;Using the ttCacheAutorefreshStatsGet procedure&#34;</a>.</p>
<p>If the status is <span class="italic">InProgress</span> longer than seems reasonable, see <a href="#i521797">&#34;Poor autorefresh performance&#34;</a>.</p>
<p>You may need to decrease the autorefresh interval or increase the size of the cache administration user tablespace.</p>
<p>There are options on how to manage what happens when the cache administration user tablespace is filled. See <a href="#BABJDFCE">&#34;Considerations when the tablespace of the cache administration is full&#34;</a>, following shortly, for more information.</p>
</div>
<!-- class="sect2" -->
<a id="BABCGBCB"></a>
<div id="TTTRB266" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Monitoring the usage of the cache administration user&#39;s tablespace</h3>
<p><a id="sthref210"></a><a id="sthref211"></a>To monitor the cache administration user tablespace, you can use either Oracle Enterprise Manager alerts or set the TimesTen tablespace threshold parameter.</p>
<p>The cache agent can be configured to periodically monitor the tablespace usage and issue a warning when it exceeds a specified threshold. Set the tablespace threshold percentage with the <code><a id="sthref212"></a>TblspaceThreshold</code> parameter of the <code><a id="sthref213"></a>ttCacheConfig</code> built-in procedure. For example, if you set the <code>TblspaceThreshold</code> parameter to 80, then a warning is issued when more than 80% of the tablespace is used.</p>
<ul>
<li>
<p>If the threshold is set to zero, then no warning is issued. This is the default.</p>
</li>
<li>
<p>If the threshold is set between 1 and 99, a warning is issued when the tablespace threshold exceeds that number.</p>
</li>
<li>
<p>If the threshold is set to 100, then a warning is issued when the tablespace is full.</p>
</li>
</ul>
<p>For example, to configure for a warning to be issued if the tablespace exceeds 80%, execute the following:</p>
<pre>call ttCacheConfig(&#39;TblspaceThreshold&#39;,,,&#39;80&#39;);
</pre>
<p>For full details of the <code>ttCacheConfig</code> built-in procedure, see the <a class="olink TTREF227" href="../TTREF/proced.htm#TTREF227">&#34;ttCacheConfig&#34;</a> section in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</p>
</div>
<!-- class="sect2" -->
<a id="BABJDFCE"></a>
<div id="TTTRB267" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Considerations when the tablespace of the cache administration is full</h3>
<p><a id="sthref214"></a><a id="sthref215"></a><a id="sthref216"></a>With Oracle database tables that are cached in a TimesTen database, you can configure them to use incremental automatic refresh. For these tables, you can specify which one of the following is to occur when the cache administration user&#39;s tablespace is full:</p>
<ul>
<li>
<p>The application performing the DML is to fail. This is the default.</p>
<p>The tablespace full recovery is set to none. The application receives an &#34;<code>Out of Tablespace</code>&#34; error from Oracle Database when the tablespace is full. At that point, the application will need to rollback the transaction.</p>
<p>Setting the tablespace full recovery to none is configured when you set the <code>Param</code> parameter to <code><a id="sthref217"></a>TblSpaceFullRecovery</code> and the <code>Value</code> parameter to <code>None</code> with the <code>ttCacheConfig</code> built-in procedure. For example, the following configures <code>Param</code> to <code>TblSpaceFullRecovery</code> and <code>Value</code> to <code>None</code> for the <code>employees</code> table that is owned by <code>terry</code>:</p>
<pre>call ttCacheConfig(&#39;TblSpaceFullRecovery&#39;,&#39;terry&#39;, &#39;employees&#39;,&#39;None&#39;);
</pre></li>
<li>
<p>Truncate the change log table to free up space and cause a full autorefresh.</p>
<p>When the cache administration user&#39;s tablespace is full, any application that is executing DML statements on the autorefresh cached Oracle database tables continues to execute. A trigger executes to free up space for new change log records by deleting existing change log records. This can result in a full automatic refresh on cache groups that have the incremental automatic refresh mode configured. However, if the Oracle database table is not configured for incremental automatic refresh, then no trigger executes.</p>
<p>To set the operation to enable the application to continue and cause an autorefresh, set the <code>Param</code> parameter to <code>TblSpaceFullRecovery</code> and the <code>Value</code> parameter to <code>Reload</code> with the <code>ttCacheConfig</code> procedure. The user will see stale data until the full autorefresh is complete.</p>
<p>However, even if the user sets the cache configuration parameter <code>TblSpaceFullRecovery</code> with the value of <code>Reload</code>, the tablespace may not be able to be emptied enough to handle the case of a growing index. Deleting rows from the change log table may not free up enough space for the index that is on the change log table. If the index is growing so fast that it uses all the tablespace to the point where purging the change log tables does not help, then the user&#39;s application may receive the following error:</p>
<pre>ORA-01654: unable to extend index &lt;index&gt; by 128 in tablespace &lt;tblspace&gt;
</pre></li>
</ul>
<p>For full details of the <code><a id="sthref218"></a>ttCacheConfig</code> built-in procedure, see the <a class="olink TTREF227" href="../TTREF/proced.htm#TTREF227">&#34;ttCacheConfig&#34;</a> section in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i521797"></a>
<div id="TTTRB268" class="sect1">
<h2 class="sect1">Poor autorefresh performance</h2>
<p><a id="sthref219"></a>Poor autorefresh performance is usually the result of large autorefresh operations. Use the <code><a id="sthref220"></a>ttCacheAutorefreshStatsGet</code> procedure to check the autorefresh duration and observe whether the status remains <span class="italic">InProgress</span> for a long time.</p>
<p>Factors that can cause large autorefresh operations include:</p>
<ul>
<li>
<p><a href="#i537308">Incremental autorefresh becomes full autorefresh</a></p>
</li>
<li>
<p><a href="#BABCJIGH">Unresponsive or dead TimesTen database degrades autorefresh performance</a></p>
</li>
<li>
<p><a href="#BABJFACH">Autorefresh cache group refresh with excessive waiting on resources</a></p>
</li>
<li>
<p><a href="#BABDCHAC">Abnormally large change log and base tables degrade autorefresh performance</a></p>
</li>
<li>
<p><a href="#BABBBAAI">Fragmented autorefresh change log table space</a></p>
</li>
<li>
<p><a href="#BABFAJCF">Performance degrades when autorefresh interval is small</a></p>
</li>
<li>
<p>Large autorefresh interval</p>
</li>
<li>
<p>Large number of cache groups with the same interval</p>
</li>
<li>
<p>High rate of changes to the Oracle database tables</p>
</li>
<li>
<p>The number of generations of child tables in a cache group</p>
</li>
<li>
<p>The number of rows in the cached Oracle database tables</p>
</li>
<li>
<p>The size of the rows in the cached Oracle database tables</p>
</li>
</ul>
<p>Enable an <a id="sthref221"></a><a id="sthref222"></a><code>AUTOREFRESH</code> trace to diagnose autorefresh performance problems. See <a href="tools.htm#i1368116">&#34;AUTOREFRESH tracing&#34;</a>.</p>
<a id="BABCJIGH"></a>
<div id="TTTRB269" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Unresponsive or dead TimesTen database degrades autorefresh performance</h3>
<div class="infobox-note">
<p class="notep1">Note:</p>
Automatic recovery for TimesTen cache groups only applies to read-only and user managed cache groups that use the <code>AUTOREFRESH</code> cache group attribute. In this section, all references to autorefresh cache groups are read-only and user managed cache groups that use the <code>AUTOREFRESH</code> cache group attribute.</div>
<p>If any TimesTen databases containing autorefresh cache groups are destroyed or no longer in use, TimesTen continues to track autorefresh changes to the Oracle database tables for the TimesTen database for which the cache agent is not running. This causes automatic refresh to cache groups in active TimesTen databases to slow down.</p>
<p>The cache agent is responsible for detecting if a database is unresponsive or no longer in use. You can specify if and how a dead TimesTen database is to be recovered. However, you cannot recover a TimesTen database if all of the Oracle database objects have been removed.</p>
<p>The following sections describe how you can avoid a degraded autorefresh performance for inactive TimesTen databases:</p>
<ul>
<li>
<p><a href="#CACBEIBJ">Setting cached TimesTen database timeout</a></p>
</li>
<li>
<p><a href="#CACFBBDA">Configuring recovery method for certain cache groups</a></p>
</li>
</ul>
<a id="CACBEIBJ"></a>
<div id="TTTRB270" class="sect3">
<h4 class="sect3">Setting cached TimesTen database timeout</h4>
<p>You can instruct TimesTen to mark the database as dead and no longer accepting updates if the cache agent has not communicated with the Oracle Database server within a specific timeout period.</p>
<p>Set the timeout for the TimesTen database and the recovery method for each autorefresh cache group with the <code>AgentTimeOut</code> parameter in the <code>ttCacheConfig</code> built-in procedure. The timeout value applies to the all TimesTen databases that use the same cache administration user. You should set the timeout value greater than the time necessary to load the TimesTen database into memory on first connect and start the cache agent. Otherwise, the TimesTen database could be incorrectly marked as dead. For any planned maintenance for the TimesTen instance, you could temporarily set the <code><a id="sthref223"></a><a id="sthref224"></a><a id="sthref225"></a>AgentTimeOut</code> value to zero to disable the timeout. For full details of the <code>ttCacheConfig</code> built-in procedure, see the <a class="olink TTREF227" href="../TTREF/proced.htm#TTREF227">&#34;ttCacheConfig&#34;</a> section in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</p>
<p>For example, the following sets the timeout value for the TimesTen database to 6000 seconds or 100 minutes. If the cache agent does not contact the Oracle Database server within a 100-minute period, then the TimesTen database is marked as dead.</p>
<pre>ttIsql&gt; call ttCacheConfig(&#39;AgentTimeOut&#39;,,,&#39;6000&#39;);
</pre></div>
<!-- class="sect3" -->
<a id="CACFBBDA"></a>
<div id="TTTRB271" class="sect3">
<h4 class="sect3">Configuring recovery method for certain cache groups</h4>
<p>You can recover a TimesTen database and autorefresh cache groups if they are not synchronizing with the Oracle database. If there is no synchronization, then updates on the Oracle database tables are not automatically refreshed to the corresponding TimesTen cache tables.</p>
<p>You can configure the <code>DeadDbRecovery</code> parameter of the <code>ttCacheConfig</code> built-in procedure to specify how to recover the synchronization for the TimesTen database and all autorefresh cache groups. The setting for <code>DeadDbRecovery</code> applies to all TimesTen databases that use the same cache administrator user. Set the <code>DeadDbRecovery</code> parameter to <code>Normal</code>, <code>Manual</code> or <code>None</code> to describe how TimesTen is to recover the database and all autorefresh cache groups. The <code>DeadDbRecovery</code> setting applies to all TimesTen databases that use the same cache administration user. While TimesTen is recovering the database and its autorefresh cache groups, there is an autorefresh status for the TimesTen database and the autorefresh cache groups that describes the recovery status for each of these entities. The TimesTen database can have an automatic refresh status of Alive, Dead or Recovering. The autorefresh cache groups can have an automatic refresh status of OK, Dead or Recovering. The TimesTen database status changes are linked to changes in the status for the autorefresh cache groups, as follows:</p>
<ul>
<li>
<p>If the recovery method is set to Normal, then when TimesTen starts a full automatic refresh on an autorefresh cache group, the cache group&#39;s status is set to Recovering and the database&#39;s status is also set to Recovering.</p>
</li>
<li>
<p>The TimesTen database&#39;s status is only set to Alive when all of the autorefresh cache groups have either been recovered to OK or have been dropped.</p>
</li>
<li>
<p>When the database status is set to Dead, then all of its autorefresh cache groups are also set to Dead.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can determine the autorefresh status of the TimesTen database and autorefresh cache groups with the <code>ttCacheDbCgStatus</code> built-in procedure, which is described in the <a class="olink TTREF228" href="../TTREF/proced.htm#TTREF228">&#34;ttCacheDbCgStatus&#34;</a> section in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</div>
<p>When communication between the cache agent and the Oracle Database server is reestablished, TimesTen determines how to recover the autorefresh cache groups. TimesTen follows the recovery method you configured in the <code>DeadDbRecovery</code> parameter in the <code>ttCacheConfig</code> built-in procedure. This parameter can be set to one of the following:</p>
<ul>
<li>
<p><code>Normal</code>: This is the default. The autorefresh cache groups will each be recovered with a full automatic refresh. After the first full refresh, the cache group is recovered and will incrementally perform autorefresh.</p>
<p>The autorefresh cache groups within the same automatic refresh interval will be transactionally consistent. Because it is a full refresh, it is not as performant as an incremental refresh.</p>
<p>The autorefresh sets the status to Recovering. When the full autorefresh is completed successfully, the autorefresh cache group status is set to OK.</p>
</li>
<li>
<p><code>Manual</code>: You must manually refresh an autorefresh cache group to recover it, or unload it if the cache group is dynamic.</p>
</li>
<li>
<p><code>None</code>: The autorefresh cache group will never be recovered by a TimesTen autorefresh. Drop and recreate the cache group to recover it.</p>
</li>
</ul>
<p>The database status changes as the first autorefresh cache group status changes. If there is at least one cache group that is in the process of recovery, then the database status is set to Recovering. Once all cache groups have been recovered, the status of the TimesTen database is marked as Alive.</p>
<p>The following example sets the <code>DeadDbRecovery</code> parameter to <code>Normal</code> for all autorefresh cache groups. The dead TimesTen database will be recovered when all of its autorefresh cache groups have each been recovered with a full automatic refresh.</p>
<pre>ttIsql&gt; call ttCacheConfig(&#39;DeadDbRecovery&#39;,,,&#39;Normal&#39;);
</pre>
<p>When TimesTen databases participating in an active standby pair replication scheme contains cache groups, if the autorefresh status of the active master database is Dead and the autorefresh status of the standby master database is Alive, the standby master does not automatically assume the role of the active master. The recovery requires that you manually ensure that the cache and replication agents are executing. The specifics for each situation is as follows:</p>
<div id="TTTRB272" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref226"></a><a id="sthref227"></a>Table 3-2 Recovery for cache groups involved in active standby replication pair</p>
<table class="cellalignment2557" title="Recovery for cache groups involved in active standby replication pair" summary="Active standby replication pair in recovery" dir="ltr">
<thead>
<tr class="cellalignment2551">
<th class="cellalignment2558" id="r1c1-t15">DeadDbRecovery Setting</th>
<th class="cellalignment2558" id="r1c2-t15">Active Master</th>
<th class="cellalignment2558" id="r1c3-t15">Standby Master</th>
<th class="cellalignment2558" id="r1c4-t15">Resulting Behavior</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r2c1-t15" headers="r1c1-t15">
<p>Normal</p>
</td>
<td class="cellalignment2559" headers="r2c1-t15 r1c2-t15">
<p>Alive</p>
</td>
<td class="cellalignment2559" headers="r2c1-t15 r1c3-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r2c1-t15 r1c4-t15">
<p>Make sure that the cache and replication agents are executing on the standby master. Once the cache agent can connect to the Oracle Database, then the status of all autorefresh cache groups is set to Recovering. This sets the database to Recovering. Once a single cache group has received enough data to resume autorefresh, the status is set to OK. After all cache group are set to OK, the database is set to Alive.</p>
<p>Alternatively, you can fail the standby master and rollout a new standby master.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r3c1-t15" headers="r1c1-t15">
<p>Normal</p>
</td>
<td class="cellalignment2559" headers="r3c1-t15 r1c2-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r3c1-t15 r1c3-t15">
<p>Alive</p>
</td>
<td class="cellalignment2559" headers="r3c1-t15 r1c4-t15">
<p>Make sure that the cache and replication agents are executing on the active master. Once the cache agent can connect to the Oracle Database, then the status of all autorefresh cache groups is set to Recovering. This sets the database to Recovering. Once a single cache group has received enough data to resume autorefresh, the status is set to OK. After all cache group are set to OK, the database is set to Alive.</p>
<p>Alternatively, you can fail the active master, switch the standby master as the new active and then rollout a new standby master.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r4c1-t15" headers="r1c1-t15">
<p>Normal</p>
</td>
<td class="cellalignment2559" headers="r4c1-t15 r1c2-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r4c1-t15 r1c3-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r4c1-t15 r1c4-t15">
<p>Make sure that the cache and replication agents are executing on both masters. Once the cache agent can connect to the Oracle Database, then the status of all autorefresh cache groups is set to Recovering. This sets the database to Recovering. Once a single cache group has received enough data to resume autorefresh, the status is set to OK. After all cache group are set to OK, the database is set to Alive.</p>
<p>Alternatively, you can rollout new masters.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r5c1-t15" headers="r1c1-t15">
<p>Manual</p>
</td>
<td class="cellalignment2559" headers="r5c1-t15 r1c2-t15">
<p>Alive</p>
</td>
<td class="cellalignment2559" headers="r5c1-t15 r1c3-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r5c1-t15 r1c4-t15">
<p>Make sure that the cache and replication agents are executing on the standby master. Once the cache agent can connect to the Oracle Database, then the status of all autorefresh cache groups is set to Recovering. This sets the database to Recovering. Once a single cache group has received enough data to resume autorefresh, the status is set to OK. After all cache group are set to OK, the database is set to Alive.</p>
<p>Alternatively, you can fail the standby master and rollout a new standby master.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r6c1-t15" headers="r1c1-t15">
<p>Manual</p>
</td>
<td class="cellalignment2559" headers="r6c1-t15 r1c2-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r6c1-t15 r1c3-t15">
<p>Alive</p>
</td>
<td class="cellalignment2559" headers="r6c1-t15 r1c4-t15">
<p>Make sure that the cache and replication agents are executing on the active master. Use a manual refresh to recover the autorefresh cache groups on the active master. After all cache group are set to OK or have been dropped, the database is set to Alive.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r7c1-t15" headers="r1c1-t15">
<p>Manual</p>
</td>
<td class="cellalignment2559" headers="r7c1-t15 r1c2-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r7c1-t15 r1c3-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r7c1-t15 r1c4-t15">
<p>Make sure that the cache and replication agents are executing on the active master. Use a manual refresh to recover the autorefresh cache groups on the active master. After all cache group are set to OK or have been dropped, the database is set to Alive. Changes are then replicated to the standby master.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r8c1-t15" headers="r1c1-t15">
<p>None</p>
</td>
<td class="cellalignment2559" headers="r8c1-t15 r1c2-t15">
<p>Alive</p>
</td>
<td class="cellalignment2559" headers="r8c1-t15 r1c3-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r8c1-t15 r1c4-t15">
<p>Mark the standby master as failed. Execute <code>ttDestroy</code> utility for the standby master database. Duplicate the active master by executing <code>ttRepAdmin -duplicate</code> utility from the active master.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r9c1-t15" headers="r1c1-t15">
<p>None</p>
</td>
<td class="cellalignment2559" headers="r9c1-t15 r1c2-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r9c1-t15 r1c3-t15">
<p>Alive</p>
</td>
<td class="cellalignment2559" headers="r9c1-t15 r1c4-t15">
<p>Destroy the dead active master with the <code>ttDestroy</code> utility. Recover the dead active master by duplicating the standby master with the <code>ttRepAdmin -duplicate</code> utility.</p>
</td>
</tr>
<tr class="cellalignment2551">
<td class="cellalignment2559" id="r10c1-t15" headers="r1c1-t15">
<p>None</p>
</td>
<td class="cellalignment2559" headers="r10c1-t15 r1c2-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r10c1-t15 r1c3-t15">
<p>Dead</p>
</td>
<td class="cellalignment2559" headers="r10c1-t15 r1c4-t15">
<p>Roll out new masters.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformalwide" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABJFACH"></a>
<div id="TTTRB349" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Autorefresh cache group refresh with excessive waiting on resources</h3>
<p>During an <a id="sthref228"></a><a id="sthref229"></a><a id="sthref230"></a><a id="sthref231"></a><a id="sthref232"></a><a id="sthref233"></a><a id="sthref234"></a><a id="sthref235"></a><a id="sthref236"></a>autorefresh c<a id="sthref237"></a><a id="sthref238"></a><a id="sthref239"></a><a id="sthref240"></a>ache group refresh, there can be excessive buffer busy waits, row lock waits, and deadlocks on updates in the Oracle database, which can negatively affect the throughput performance. When there are multiple deadlocks on updates in the Oracle database involving the autorefresh log tables, the following may appear in the support log:</p>
<pre>Oracle native error code = 60, msg = ORA-00060: deadlock detected while waiting
for resource
An error occurred while preparing or executing the following Oracle sql 
statement: &lt;some statement involving &lt;cache admin user&gt;.TT_##_#######_L  where 
the # is some number&gt;
</pre>
<p>You can improve your performance by modifying the <code>INITRANS</code> and <code>FREELISTS</code> settings, which can affect the concurrent inserts into the autorefresh log table and internal maintenance of these tables. The application updating the base table that is being autorefreshed encounters a throughput performance hit when these settings are not appropriately configured.</p>
<p>You can automatically or manually manage these settings as follows:</p>
<ul>
<li>
<p>Use ASSM tablespace, which automatically manages <code>FREELISTS</code>.</p>
</li>
<li>
<p>Manually adjust <code>FREELISTS</code> and <code>INITRANS</code> for the autorefresh log table on the Oracle database.</p>
</li>
</ul>
<p>The following details how to manually modify <code>INITRANS</code> and <code>FREELISTS</code> for the autorefresh log table on the Oracle database:</p>
<ol>
<li>
<p>Retrieve the name of the autorefresh log table that is on the Oracle database.</p>
<p>Under the cache administration user login, execute the SQL*Plus script <code>cacheInfo.sql</code> that lists the autorefresh change log table name, along with other items. The following example executes the <code>cacheInfo.sql</code> script that lists the autorefresh change log table name as <code>tt_06_1216726_L</code>, as shown in bold:</p>
<pre>SQL&gt; @cacheInfo.sql
*************Autorefresh Objects Information  ***************
Host name: syst
Timesten datastore name: /users/OracleCache/alone1
Cache table name: ORATT.ORDERS
<span class="bold">Change log table name: tt_06_1216726_L </span>
Number of rows in change log table: 1
Maximum logseq on the change log table: 2
Timesten has autorefreshed updates upto logseq: 1
Number of updates waiting to be autorefreshed: 1
Number of updates that has not been marked with a valid logseq: 0
****************************
Host name: consyst
Timesten datastore name: /users/OracleCache/alone1
Cache table name: ORATT.ITEMS
Change log table name: tt_06_1279699_L
Number of rows in change log table: 7
Maximum logseq on the change log table: 0
Timesten has autorefreshed updates upto logseq: 0
Number of updates waiting to be autorefreshed: 5
Number of updates that has not been marked with a valid logseq: 5
****************************
 
</pre></li>
<li>
<p>Manually alter the table on the Oracle database. The following example uses the table from the previous example. This example alters the <code>INITRANS</code> and <code>FREELISTS</code> settings for the <code>bar.tt_06_1279699_L</code> table.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
See <a class="olink SQLRF52296" href="../SQLRF/clauses007.htm#SQLRF52296">&#34;INITRANS integer&#34;</a> and <a class="olink SQLRF52314" href="../SQLRF/clauses009.htm#SQLRF52314">&#34;FREELISTS&#34;</a> in the <span class="italic">Oracle Database SQL Language Reference</span> for details on what are the correct values for configuring these settings.</div>
<pre>ALTER TABLE BAR.TT_06_1279699_L INITRANS 10;
ALTER TABLE BAR.TT_06_1279699_L STORAGE(FREELISTS 5);
or
ALTER TABLE BAR.TT_06_1279699_L MOVE STORAGE(FREELISTS 5);
</pre></li>
<li>
<p>Alter the <code>INITRANS</code> and <code>FREELISTS</code> settings for the index for this table, which have the same name as the autorefresh change log table with an additional &#34;L&#34; at the end of it. For example, the index for table <code>bar.tt_06_1279699_L</code> is <code>bar.tt_06_1279699_LL</code>.</p>
<p>These settings should be the same as what you set for the autorefresh change log table.</p>
<pre>ALTER INDEX BAR.TT_06_1279699_LL INITRANS 10;
ALTER INDEX BAR.TT_06_1279699_LL STORAGE(FREELISTS 5);
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABDCHAC"></a>
<div id="TTTRB350" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Abnormally large change log and base tables degrade autorefresh performance</h3>
<p><a id="sthref241"></a><a id="sthref242"></a><a id="sthref243"></a><a id="sthref244"></a><a id="sthref245"></a>The cache thread SQL refresh joins the change log table and the base table, which identifies rows needed to be refreshed into TimesTen. The larger the cardinalities of the base table and the change log table, the longer the time necessary to perform this join. Performance degradation may occur if either the change log table or the base table is abnormally large.</p>
<p>The following describes scenarios where the change log table can become abnormally large.</p>
<ul>
<li>
<p>If the change log table is never purged in configurations where cache groups from multiple DSNs all reference the same base table, it increases in size indefinitely. If one or more of the cache agents for these groups are turned off, those DSNs will not properly refresh their cache groups and the change log tables will not be purged. If the autorefresh state is turned to paused on one of multiple nodes, the other nodes may slow down.</p>
</li>
<li>
<p>The change log table can grow abnormally large if some cache agents have been shut down. Resolve this issue by restarting the cache, which will purge all of the backlogged log rows to be purged and all of the cache groups to be synchronized after the completion of the refresh cycle for all cache groups.</p>
</li>
<li>
<p>The change log table can be abnormally large if rows inserted into the change log table are never purged and can never be purged by normal processing. This occurs when one or more DSNs are destroyed or rebuilt without first removing the cache groups. The cache group tables on the Oracle database have no information that the cache groups have been destroyed, which corrupts the entire cache group. Rebuild and reinitialize all of the cache groups associated with this base table. Alternatively, never destroy a DSN with cache groups. Instead, always drop the cache groups before destroying a DSN.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BABBBAAI"></a>
<div id="TTTRB367" class="sect2">
<h3 class="sect2">Fragmented autorefresh change log table space<a id="sthref246"></a><a id="sthref247"></a></h3>
<p>Change log tables can become fragmented when a high water mark occurs as the result of change logs building up when TimesTen is shut down, for example. If change log tables have become fragmented, you can:</p>
<ul>
<li>
<p>Coalesce their indexes. This can be done without preventing DML changes to the base tables.</p>
</li>
<li>
<p>Perform an online segment shrink. This can be done without preventing DML changes to the base tables. See <a class="olink ADMIN11600" href="../ADMIN/schema.htm#ADMIN11600">&#34;Understanding Reclaimable Unused Space&#34;</a> in <span class="italic">Oracle Database Administrator&#39;s Guide</span>.</p>
</li>
<li>
<p>Rebuild the change log tables.</p>
</li>
</ul>
<p>Check to see whether space is being wasted:</p>
<ol>
<li>
<p>Determine the name of the change log table by running the <code>cacheInfo.sql</code> script on the Oracle database.</p>
</li>
<li>
<p>Calculate the size of the change log table. Call the result A. Adapt the name of the change log table in this example.</p>
<pre>SELECT table_name, ROUND((BLOCKS*8),2)||&#39;KB&#39; &#34;size&#34; 
 FROM user_tables
 WHERE table_name LIKE &#39;TT_05_%_L&#34;;
</pre></li>
<li>
<p>Calculate the size of the data in the change log table. Call the result B. Adapt the name of the change log table in this example.</p>
<pre>SELECT table_name, ROUND((<span class="italic">num_rows</span>*<span class="italic">avg_row_length</span>/1024),2)|| &#39;KB&#39; &#34;size&#34;
 FROM user_tables
 WHERE table_name LIKE &#39;TT_05_%_L&#39;;
</pre></li>
<li>
<p>If <code>(B/A)*100</code> is greater than 50 percent, then there is at least 40 percent space wasted (assuming a <code>PCTFREE</code> storage parameter set to 10). If there is at least 40 percent space wasted, defragmenting the change log table is recommended.</p>
</li>
</ol>
<p>Perform these steps to defragment the change log table:</p>
<ol>
<li>
<p>Alter the cache group to set the autorefresh state to <code>PAUSED</code>.</p>
</li>
<li>
<p>Copy the rows in the change log table to a temporary table.</p>
</li>
<li>
<p>Truncate the change log table.</p>
</li>
<li>
<p>Insert the rows from the temporary table to the change log table.</p>
</li>
<li>
<p>Alter the cache group to set the autorefresh state to <code>ON</code>.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABFAJCF"></a>
<div id="TTTRB351" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Performance degrades when autorefresh interval is small</h3>
<p><a id="sthref248"></a><a id="sthref249"></a>When a relatively short refresh interval, such as a few hundred milliseconds, is combined with a large number of entries in the log table or in the base table, a cache refresh operation does not complete before the next refresh operation is scheduled to begin. In this case, the entries in the log table can be un-marked when the current autorefresh cycle finishes.</p>
<p>Thus, the same rows can be refreshed from the base table to the cache group in the next autorefresh cycle, by which time the rows will be marked. Make sure that the time it for the refresh is greater than the refresh interval. Set the refresh interval to a value where redundant refreshes will not occur.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABJAEEI"></a>
<div id="TTTRB352" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Declaring NOVALIDATE on constraints causes cache group creation failure</h2>
<p>If <a id="sthref250"></a><a id="sthref251"></a>the Oracle database table on which you want to create the cache group declares <code>NOVALIDATE</code> on columns with primary key, <code>UNIQUE</code> or <code>NOT NULL</code> constraints, the creation of the cache group fails.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This does not apply to any foreign key constraints. However, TimesTen recommends that any matching foreign key is in the enabled <code>VALIDATE</code> state. Your workload performance may be affected when you alter a foreign key column to the enabled <code>VALIDATE</code> state.</div>
<p>TimesTen perceives a <code>NOVALIDATE</code> on a primary key or <code>NOT NULL</code> table column definition as a <code>NULL</code> and, therefore, not qualified as a column on which to build the cache group. Thus, all columns with the primary key, <code>UNIQUE</code> and <code>NOT NULL</code> column constraints must be enabled with the <code>VALIDATE</code> state when creating a cache group from the Oracle database table.</p>
<p>When you create a cache group from an Oracle database table with one or more of these constraints, the following errors are thrown:</p>
<pre>5124: Autorefresh/propagate are not allowed on restricted cache group
5168: Restricted cache groups are deprecated
5120: No matching unique index with not null columns, unique key constraint
 with not null columns, or primary key constraint on table EVENTLOG, cache
 operations are restricted.
</pre>
<p>If you receive these errors, you can perform a <code>SELECT</code> statement to verify any existing <code>NOVALIDATE</code> constraints on the Oracle database table. The following <code>SELECT</code> statement shows all constraints on the <code>MyTable</code> table:</p>
<pre>SQL&gt; select constraint_name, constraint_type, validated, status from 
        all_constraints where table_name = &#39;MyTable&#39;;
 
CONSTRAINT_NAME                C VALIDATED     STATUS
------------------------------ - ------------- --------
REFID_CONSTRAINT               C VALIDATED     ENABLED
PKEY_CONSTRAINT                P NOT VALIDATED DISABLED
</pre>
<p><a id="sthref252"></a><a id="sthref253"></a>If the table column that is to be the primary key for the cache table is enabled as <code>NOVALIDATE</code>, perform the following steps to enable the column with the <code>VALIDATE</code> state:</p>
<ol>
<li>
<p>Enable the <code>NOVALIDATE</code> state for the primary key column.</p>
<pre>SQL&gt; alter table MyTable modify constraint PKEY_CONSTRAINT 
           enable novalidate;
Table altered.
 
SQL&gt; select constraint_name, constraint_type, validated, status 
          from all_constraints where table_name = &#39;MyTable&#39;;
 
CONSTRAINT_NAME                C VALIDATED     STATUS
------------------------------ - ------------- --------
REFID_CONSTRAINT               C VALIDATED     ENABLED
PKEY_CONSTRAINT                P NOT VALIDATED ENABLED
</pre></li>
<li>
<p>Enable the <code>VALIDATE</code> state for the primary key column.</p>
<pre>SQL&gt; alter table MyTable modify constraint PKEY_CONSTRAINT validate;
Table altered.
 
SQL&gt; select constraint_name, constraint_type, validated, status 
          from all_constraints where table_name = &#39;MyTable&#39;;
 
CONSTRAINT_NAME                C VALIDATED     STATUS
------------------------------ - ------------- --------
REFID_CONSTRAINT               C VALIDATED     ENABLED
PKEY_CONSTRAINT                P VALIDATED     ENABLED
</pre></li>
</ol>
</div>
<!-- class="sect1" -->
<a id="BABBJGCH"></a>
<div id="TTTRB353" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">AWR report showing lock contention with DBMS_LOCK</h2>
<p><a id="sthref254"></a><a id="sthref255"></a><a id="sthref256"></a>There may be some concern about lock contention when seeing <code>DBMS_LOCK</code> in the Automated Workload Repository (AWR) Report. However, this <code>DBMS_LOCK</code> wait event does not affect the application performance in an TimesTen cache grid, even though the database time consumption in the AWR report seems high. This wait event is the garbage collector session trying to place a hold on a resource that another garbage collector session from another database has already locked. Thus, only the current garbage collector session waits. The wait for the garbage collector process does not block other processes, except other garbage collectors.</p>
<p>For example, the following shows a contention event in the AWR report:</p>
<pre>AWR 
 
Top 5 Timed Events                                         Avg %Total
~~~~~~~~~~~~~~~~~~                                        wait   Call
Event                                 Waits    Time (s)   (ms)   Time Wait Class
------------------------------ ------------ ----------- ------ ------ ----------
enq: UL - contention                  2,388       6,997   2930   72.0 Application
 
</pre>
<p>In addition, only a small amount of CPU time is used for the garbage collector, as shown in the &#34;SQL ordered by CPU Time&#34; section in the PERF AWR report.</p>
<pre>SQL ordered by CPU Time              DB/Inst: REM0LNX/REM  Snaps: 14976-14977
-&gt; Resources reported for PL/SQL code includes the resources used by all SQL
   statements called by the code.
-&gt; % Total DB Time is the Elapsed Time of the SQL statement divided
   into the Total Database Time multiplied by 100
 
    CPU      Elapsed                  CPU per  % Total
  Time (s)   Time (s)  Executions     Exec (s) DB Time    SQL Id
---------- ---------- ------------ ----------- ------- -------------
         0      3,508          120        0.00    36.1 0mt5pk2501gph
Module: timestenorad@etcpro01.oracle.com (TNS V1-V3)
DECLARE v_lockHandle VARCHAR2(200); BEGIN dbms_lock.allocate_unique(
&#39;ORATT$ORA_GC1_CACHEADMIN&#39;, v_lockHandle); :retval := dbms_lock.request(
v_lockHandle, dbms_lock.x_mode, 30, FALSE); END;
         0      3,499          120        0.00    36.0 bb07h2a1v817x
Module: timestenorad@etcpro01.oracle.com (TNS V1-V3)
DECLARE v_lockHandle VARCHAR2(200); BEGIN dbms_lock.allocate_unique(
&#39;ORATT$ORA_DDSMONITOR1_CACHEADMIN&#39;, v_lockHandle); :retval := 
dbms_lock.request(v_lockHandle, dbms_lock.x_mode, 30, FALSE); END;
</pre></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2550">
<tr>
<td class="cellalignment2559">
<table class="cellalignment2555">
<tr>
<td class="cellalignment2554"><a href="datastore_trouble.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2554"><a href="rep_trouble.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2011, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2561">
<table class="cellalignment2553">
<tr>
<td class="cellalignment2554"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2554"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2554"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2554"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2554"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2554"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>