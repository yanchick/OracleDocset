<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-103717"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/MERGE"></a><title>MERGE</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1093"/>
<meta name="dcterms.created" content="2017-07-18T18:53:0Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SQL Language Reference"/>
<meta name="dcterms.identifier" content="E41329-25"/>
<meta name="dcterms.isVersionOf" content="SQLRF"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="statements_9016.htm" title="Previous" type="text/html"/>
<link rel="Next" href="statements_9018.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41329-25.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">506/555</span> <!-- End Header --><a id="i2081218"></a>
<div id="SQLRF01606" class="refsect1"><!-- infolevel="all" infotype="General" -->
<h1 class="refsect1">MERGE <a id="sthref7156"></a><a id="sthref7157"></a><a id="sthref7158"></a></h1>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref7159"></a>Purpose</p>
<p>Use the <code dir="ltr">MERGE</code> statement to select rows from one or more sources for update or insertion into a table or view. You can specify conditions to determine whether to update or insert into the target table or view.</p>
<p>This statement is a convenient way to combine multiple operations. It lets you avoid multiple <code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, and <code dir="ltr">DELETE</code> DML statements.</p>
<p><code dir="ltr">MERGE</code> is a deterministic statement. You cannot update the same row of the target table multiple times in the same <code dir="ltr">MERGE</code> statement.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In previous releases of Oracle Database, when you created an Oracle Virtual Private Database policy on an application that included the <code dir="ltr">MERGE</code> <code dir="ltr">INTO</code> statement, the <code dir="ltr">MERGE</code> <code dir="ltr">INTO</code> statement would be prevented with an <code dir="ltr">ORA-28132: Merge into syntax does not support security policies</code> error, due to the presence of the Virtual Private Database policy. Beginning with Oracle Database 11<span class="italic">g</span> Release 2 (11.2.0.2), you can create policies on applications that include <code dir="ltr">MERGE</code> <code dir="ltr">INTO</code> operations. To do so, in the <code dir="ltr">DBMS_RLS</code>.<code dir="ltr">ADD_POLICY</code> <code dir="ltr">statement_types</code> parameter, include the <code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, and <code dir="ltr">DELETE</code> statements, or just omit the <code dir="ltr">statement_types</code> parameter altogether. Refer to <a class="olink DBSEG249" href="../DBSEG/vpd.htm#DBSEG249"><span class="italic">Oracle Database Security Guide</span></a> for more information on enforcing policies on specific SQL statement types.</div>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref7160"></a>Prerequisites</p>
<p>You must have the <code dir="ltr">INSERT</code> and <code dir="ltr">UPDATE</code> object privileges on the target table and the <code dir="ltr">READ</code> or <code dir="ltr">SELECT</code> object privilege on the source table. To specify the <code dir="ltr">DELETE</code> clause of the <code dir="ltr"><span class="codeinlineitalic">merge_update_clause</span></code>, you must also have the <code dir="ltr">DELETE</code> object privilege on the target table.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref7161"></a>Syntax</p>
<p class="subhead2"><a id="SQLRF55127"></a><span class="italic">merge</span>::=</p>
<img width="616" height="263" src="img/merge.gif" alt="Description of merge.gif follows"/><br/>
<a id="sthref7162" href="img_text/merge.htm">Description of the illustration &#39;&#39;merge.gif&#39;&#39;</a><br/>
<br/>
<div class="infobox-note">
<p class="notep1">Note:</p>
You must specify at least one of the clauses <code dir="ltr"><span class="codeinlineitalic">merge_update_clause</span></code> or <code dir="ltr"><span class="codeinlineitalic">merge_insert_clause</span></code>.</div>
<p>(<a href="#BGBBBIDF"><span class="xreftitleitalic"><span class="italic">merge_update_clause</span> ::=</span></a>, <a href="#BGBGIICE"><span class="xreftitleitalic"><span class="italic">merge_insert_clause</span> ::=</span></a>, <a href="#BGBDABCJ"><span class="xreftitleitalic"><span class="italic">error_logging_clause</span> ::=</span></a></p>
<p class="subhead2"><a id="BGBBBIDF"></a><a id="SQLRF55128"></a><a href="#i2081030"><span class="xreftitleitalic"><span class="italic">merge_update_clause</span></span></a> ::=<a id="sthref7163"></a><a id="sthref7164"></a></p>
<img width="574" height="159" src="img/merge_update_clause.gif" alt="Description of merge_update_clause.gif follows"/><br/>
<a id="sthref7165" href="img_text/merge_update_clause.htm">Description of the illustration &#39;&#39;merge_update_clause.gif&#39;&#39;</a><br/>
<br/>
<p class="subhead2"><a id="BGBGIICE"></a><a id="SQLRF55129"></a><a href="#i2090698"><span class="xreftitleitalic"><span class="italic">merge_insert_clause</span></span></a> ::=<a id="sthref7166"></a><a id="sthref7167"></a></p>
<img width="537" height="199" src="img/merge_insert_clause.gif" alt="Description of merge_insert_clause.gif follows"/><br/>
<a id="sthref7168" href="img_text/merge_insert_clause.htm">Description of the illustration &#39;&#39;merge_insert_clause.gif&#39;&#39;</a><br/>
<br/>
<p class="subhead2"><a id="SQLRF55130"></a><span class="italic">where_clause</span>::=</p>
<img width="159" height="27" src="img/where_clause.gif" alt="Description of where_clause.gif follows"/><br/>
<a id="sthref7169" href="img_text/where_clause.htm">Description of the illustration &#39;&#39;where_clause.gif&#39;&#39;</a><br/>
<br/>
<p class="subhead2"><a id="BGBDABCJ"></a><a id="SQLRF55131"></a><a href="#BGBDCCEC"><span class="xreftitleitalic"><span class="italic">error_logging_clause</span></span></a> ::=</p>
<img width="662" height="166" src="img/error_logging_clause.gif" alt="Description of error_logging_clause.gif follows"/><br/>
<a id="sthref7170" href="img_text/error_logging_clause.htm">Description of the illustration &#39;&#39;error_logging_clause.gif&#39;&#39;</a><br/>
<br/></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref7171"></a>Semantics</p>
<p class="subhead1"><a id="SQLRF55132"></a>INTO Clause</p>
<p>Use the <code dir="ltr">INTO</code> clause to specify the target table or view you are updating or inserting into. In order to merge data into a view, the view must be updatable. Refer to <a href="statements_8004.htm#CEGCADFA">&#34;Notes on Updatable Views&#34;</a> for more information.</p>
<p><a id="SQLRF56715"></a><span class="subhead3">Restriction on Target Views&nbsp;</span>You cannot specify a target view on which an <code dir="ltr">INSTEAD</code> <code dir="ltr">OF</code> trigger has been defined.</p>
<p class="subhead1"><a id="SQLRF55133"></a>USING Clause</p>
<p>Use the <code dir="ltr">USING</code> clause to specify the source of the data to be updated or inserted. The source can be a table, view, or the result of a subquery.</p>
<p class="subhead1"><a id="SQLRF55134"></a>ON Clause</p>
<p>Use the <code dir="ltr">ON</code> clause to specify the condition upon which the <code dir="ltr">MERGE</code> operation either updates or inserts. For each row in the target table for which the search condition is true, Oracle Database updates the row with corresponding data from the source table. If the condition is not true for any rows, then the database inserts into the target table based on the corresponding source table row.</p>
<p><a id="SQLRF55135"></a><span class="subhead3">Restrictions on the ON Clause&nbsp;</span></p>
<p>In previous releases of Oracle Database, when you created an Oracle Virtual Private Database policy on an application that included the <code dir="ltr">MERGE</code> <code dir="ltr">INTO</code> statement, the <code dir="ltr">MERGE</code> <code dir="ltr">INTO</code> statement would be prevented with an <code dir="ltr">ORA-28132: Merge into syntax does not support security policies</code> error, due to the presence of the Virtual Private Database policy. Beginning with Oracle Database 11<span class="italic">g</span> Release 2 (11.2.0.2), you can create policies on applications that include <code dir="ltr">MERGE</code> <code dir="ltr">INTO</code> operations. To do so, in the <code dir="ltr">DBMS_RLS</code>.<code dir="ltr">ADD_POLICY</code> <code dir="ltr">statement_types</code> parameter, include the <code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, and <code dir="ltr">DELETE</code> statements, or just omit the <code dir="ltr">statement_types</code> parameter altogether. Refer to <a class="olink DBSEG249" href="../DBSEG/vpd.htm#DBSEG249"><span class="italic">Oracle Database Security Guide</span></a> for more information on enforcing policies on specific SQL statement types.</p>
<p class="subhead1"><a id="i2081030"></a><a id="SQLRF55136"></a><span class="italic">merge_update_clause <a id="sthref7172"></a><a id="sthref7173"></a><a id="sthref7174"></a></span></p>
<p>The <code dir="ltr"><span class="codeinlineitalic">merge_update_clause</span></code> specifies the new column values of the target table. Oracle performs this update if the condition of the <code dir="ltr">ON</code> clause is true. If the update clause is executed, then all update triggers defined on the target table are activated.</p>
<p>Specify the <code dir="ltr"><span class="codeinlineitalic">where_clause</span></code> if you want the database to execute the update operation only if the specified condition is true. The condition can refer to either the data source or the target table. If the condition is not true, then the database skips the update operation when merging the row into the table.</p>
<p>Specify the <code dir="ltr">DELETE</code> <code dir="ltr"><span class="codeinlineitalic">where_clause</span></code> to clean up data in a table while populating or updating it. The only rows affected by this clause are those rows in the destination table that are updated by the merge operation. The <code dir="ltr">DELETE</code> <code dir="ltr">WHERE</code> condition evaluates the updated value, not the original value that was evaluated by the <code dir="ltr">UPDATE</code> <code dir="ltr">SET</code> ... <code dir="ltr">WHERE</code> condition. If a row of the destination table meets the <code dir="ltr">DELETE</code> condition but is not included in the join defined by the <code dir="ltr">ON</code> clause, then it is not deleted. Any delete triggers defined on the target table will be activated for each row deletion.</p>
<p>You can specify this clause by itself or with the <code dir="ltr"><span class="codeinlineitalic">merge_insert_clause</span></code>. If you specify both, then they can be in either order.</p>
<p><a id="SQLRF55137"></a><span class="subhead3">Restrictions on the <span class="italic">merge_update_clause</span>&nbsp;</span>This clause is subject to the following restrictions:</p>
<ul>
<li>
<p>You cannot update a column that is referenced in the <code dir="ltr">ON</code> <code dir="ltr"><span class="codeinlineitalic">condition</span></code> clause.</p>
</li>
<li>
<p>You cannot specify <code dir="ltr">DEFAULT</code> when updating a view.</p>
</li>
</ul>
<p class="subhead1"><a id="i2090698"></a><a id="SQLRF55138"></a><span class="italic">merge_insert_clause <a id="sthref7175"></a><a id="sthref7176"></a></span></p>
<p>The <code dir="ltr"><span class="codeinlineitalic">merge_insert_clause</span></code> specifies values to insert into the column of the target table if the condition of the <code dir="ltr">ON</code> clause is false. If the insert clause is executed, then all insert triggers defined on the target table are activated. If you omit the column list after the <code dir="ltr">INSERT</code> keyword, then the number of columns in the target table must match the number of values in the <code dir="ltr">VALUES</code> clause.</p>
<p>To insert all of the source rows into the table, you can use a <span class="bold">constant filter predicate</span> in the <code dir="ltr">ON</code> clause condition. An example of a constant filter predicate is <code dir="ltr">ON</code> (<code dir="ltr">0=1</code>). Oracle Database recognizes such a predicate and makes an unconditional insert of all source rows into the table. This approach is different from omitting the <code dir="ltr"><span class="codeinlineitalic">merge_update_clause</span></code>. In that case, the database still must perform a join. With constant filter predicate, no join is performed.</p>
<p>Specify the <code dir="ltr"><span class="codeinlineitalic">where_clause</span></code> if you want Oracle Database to execute the insert operation only if the specified condition is true. The condition can refer only to the data source table. Oracle Database skips the insert operation for all rows for which the condition is not true.</p>
<p>You can specify this clause by itself or with the <code dir="ltr"><span class="codeinlineitalic">merge_update_clause</span></code>. If you specify both, then they can be in either order.</p>
<p><a id="SQLRF55139"></a><span class="subhead3">Restriction on the <span class="italic">merge_insert_clause</span>&nbsp;</span>You cannot specify <code dir="ltr">DEFAULT</code> when inserting into a view.</p>
<p class="subhead1"><a id="BGBDCCEC"></a><a id="SQLRF55140"></a><span class="italic">error_logging_clause <a id="sthref7177"></a><a id="sthref7178"></a></span></p>
<p>The <span class="italic">error_logging_clause</span> has the same behavior in a <code dir="ltr">MERGE</code> statement as in an <code dir="ltr">INSERT</code> statement. Refer to the <code dir="ltr">INSERT</code> statement <a href="statements_9015.htm#BGBEIACB"><span class="xreftitleitalic"><span class="italic">error_logging_clause</span></span></a> for more information.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="statements_9015.htm#BCEGDJDJ">&#34;Inserting Into a Table with Error Logging: Example&#34;</a></div>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref7179"></a>Examples</p>
<p><a id="i2091840"></a><a id="SQLRF55141"></a><span class="subhead3">Merging into a Table: Example&nbsp;</span>The following example uses the <code dir="ltr">bonuses</code> table in the sample schema <code dir="ltr">oe</code> with a default bonus of 100. It then inserts into the <code dir="ltr">bonuses</code> table all employees who made sales, based on the <code dir="ltr">sales_rep_id</code> column of the <code dir="ltr">oe.orders</code> table. Finally, the human resources manager decides that employees with a salary of $8000 or less should receive a bonus. Those who have not made sales get a bonus of 1% of their salary. Those who already made sales get an increase in their bonus equal to 1% of their salary. The <code dir="ltr">MERGE</code> statement implements these changes in one step:</p>
<pre dir="ltr">CREATE TABLE bonuses (employee_id NUMBER, bonus NUMBER DEFAULT 100);

INSERT INTO bonuses(employee_id)
   (SELECT e.employee_id FROM employees e, orders o
   WHERE e.employee_id = o.sales_rep_id
   GROUP BY e.employee_id); 

SELECT * FROM bonuses ORDER BY employee_id;

EMPLOYEE_ID      BONUS
----------- ----------
        153        100
        154        100
        155        100
        156        100
        158        100
        159        100
        160        100
        161        100
        163        100

MERGE INTO bonuses D
   USING (SELECT employee_id, salary, department_id FROM employees
   WHERE department_id = 80) S
   ON (D.employee_id = S.employee_id)
   WHEN MATCHED THEN UPDATE SET D.bonus = D.bonus + S.salary*.01
     DELETE WHERE (S.salary &gt; 8000)
   WHEN NOT MATCHED THEN INSERT (D.employee_id, D.bonus)
     VALUES (S.employee_id, S.salary*.01)
     WHERE (S.salary &lt;= 8000);

SELECT * FROM bonuses ORDER BY employee_id;

EMPLOYEE_ID      BONUS
----------- ----------
        153        180
        154        175
        155        170
        159        180
        160        175
        161        170
        164         72
        165         68
        166         64
        167         62
        171         74
        172         73
        173         61
        179         62
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5862">
<tr>
<td class="cellalignment5869">
<table class="cellalignment5867">
<tr>
<td class="cellalignment5866"><a href="statements_9016.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5866"><a href="statements_9018.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5871">
<table class="cellalignment5865">
<tr>
<td class="cellalignment5866"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5866"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5866"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5866"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5866"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5866"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>