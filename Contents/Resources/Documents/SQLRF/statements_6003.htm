<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-103645"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/CREATE%20MATERIALIZED%20VIEW%20LOG"></a><title>CREATE MATERIALIZED VIEW LOG</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1093"/>
<meta name="dcterms.created" content="2017-07-18T18:52:48Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SQL Language Reference"/>
<meta name="dcterms.identifier" content="E41329-25"/>
<meta name="dcterms.isVersionOf" content="SQLRF"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="statements_6002.htm" title="Previous" type="text/html"/>
<link rel="Next" href="statements_6004.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41329-25.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">434/555</span> <!-- End Header --><a id="i2064649"></a>
<div id="SQLRF01303" class="refsect1">
<h1 class="refsect1">CREATE MATERIALIZED VIEW LOG <a id="sthref5131"></a></h1>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref5132"></a>Purpose</p>
<p><a id="sthref5133"></a><a id="sthref5134"></a><a id="sthref5135"></a><a id="sthref5136"></a>Use the <code dir="ltr">CREATE</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code> statement to create a <span class="bold">materialized view log</span>, which is a table associated with the master table of a materialized view.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The keyword <code dir="ltr">SNAPSHOT</code> is supported in place of <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> for backward compatibility.</div>
<p>Materialized view logs are used for two types of materialized view refreshes: fast refresh and synchronous refresh.</p>
<p><span class="bold"><a id="sthref5137"></a>Fast</span> <span class="bold">refresh</span> uses a conventional materialized view log. During a fast refresh (also called an incremental refresh), when DML changes are made to master table data, Oracle Database stores rows describing those changes in the materialized view log and then uses the materialized view log to refresh materialized views based on the master table.</p>
<p><span class="bold"><a id="sthref5138"></a><a id="sthref5139"></a><a id="sthref5140"></a>Synchronous</span> <span class="bold">refresh</span> uses a special type of materialized view log called a <span class="bold">staging</span> <span class="bold">log</span>. During a synchronous refresh, DML changes are first described in the staging log and then applied to the master tables and the materialized views simultaneously. This guarantees that the master table data and materialized view data are in sync throughout the refresh process. This refresh method is useful in data warehousing environments.</p>
<p>Without a materialized view log, Oracle Database must reexecute the materialized view query to refresh the materialized view. This process is called a <span class="bold">complete refresh</span>. Usually, a complete refresh takes more time to complete than a fast refresh or a synchronous refresh.</p>
<p>A materialized view log is located in the master database in the same schema as the master table. A master table can have only one materialized view log defined on it.</p>
<p><a id="sthref5141"></a><a id="sthref5142"></a>To fast refresh or synchronous refresh a materialized join view, you must create a materialized view log for each of the tables referenced by the materialized view.</p>
<p>Fast refresh supports two types of materialized view logs: timestamp-based materialized view logs and commit SCN-based materialized view logs. Timestamp-based materialized view logs use timestamps and require some setup operations when preparing to refresh the materialized view. Commit SCN-based materialized view logs use commit SCN data rather than timestamps, which removes the need for the setup operations and thus can improve the speed of the materialized view refresh. If you specify the <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code> clause, then a commit SCN-based materialized view log is created. Otherwise, a time-stamp based materialized view log is created. Note that only new materialized view logs can take advantage of <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code>. Existing materialized view logs cannot be altered to add <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code> unless they are dropped and recreated. Refer to <a class="olink DWHSG0319" href="../DWHSG/refresh.htm#DWHSG0319"><span class="italic">Oracle Database Data Warehousing Guide</span></a> for more information.</p>
<p>Synchronous refresh supports only timestamp-based staging logs.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="statements_6002.htm#i2063793">CREATE MATERIALIZED VIEW</a>, <a href="statements_2002.htm#CCHECCJB">ALTER MATERIALIZED VIEW</a>, <a class="olink CNCPT411" href="../CNCPT/schemaob.htm#CNCPT411"><span class="italic">Oracle Database Concepts</span></a>, <a class="olink DWHSG008" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=DWHSG008"><span class="italic">Oracle Database Data Warehousing Guide</span></a>, and <a class="olink REPLN003" href="../REPLN/repmview.htm#REPLN003"><span class="italic">Oracle Database Advanced Replication</span></a> for information on materialized views in general</p>
</li>
<li>
<p><a href="statements_2003.htm#i2226910">ALTER MATERIALIZED VIEW LOG</a> for information on modifying a materialized view log</p>
</li>
<li>
<p><a href="statements_8023.htm#i2067172">DROP MATERIALIZED VIEW LOG</a> for information on dropping a materialized view log</p>
</li>
<li>
<p><a class="olink SUTIL003" href="../SUTIL/GUID-DD843EE2-1FAB-4E72-A115-21D97A501ECC.htm#SUTIL003"><span class="italic">Oracle Database Utilities</span></a> for information on using direct loader logs</p>
</li>
</ul>
</div>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref5143"></a>Prerequisites</p>
<p>The privileges required to create a materialized view log directly relate to the privileges necessary to create the underlying objects associated with a materialized view log.</p>
<ul>
<li>
<p>If you own the master table, then you can create an associated materialized view log if you have the <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> privilege.</p>
</li>
<li>
<p>If you are creating a materialized view log for a table in another user&#39;s schema, then you must have the <code dir="ltr">CREATE</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> and <code dir="ltr">COMMENT</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> system privileges, as well as either the <code dir="ltr">READ</code> or <code dir="ltr">SELECT</code> object privilege on the master table or the <code dir="ltr">READ</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> or <code dir="ltr">SELECT</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> system privilege.</p>
</li>
</ul>
<p>In either case, the owner of the materialized view log must have sufficient quota in the tablespace intended to hold the materialized view log or must have the <code dir="ltr">UNLIMITED</code> <code dir="ltr">TABLESPACE</code> system privilege.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DWHSG008" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=DWHSG008"><span class="italic">Oracle Database Data Warehousing Guide</span></a> for more information about the prerequisites for creating a materialized view log</div>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref5144"></a>Syntax</p>
<p class="subhead2"><a id="SQLRF54193"></a><span class="italic">create_materialized_vw_log</span>::=</p>
<img width="682" height="567" src="img/create_materialized_vw_log.gif" alt="Description of create_materialized_vw_log.gif follows"/><br/>
<a id="sthref5145" href="img_text/create_materialized_vw_log.htm">Description of the illustration &#39;&#39;create_materialized_vw_log.gif&#39;&#39;</a><br/>
<br/>
<p>(<a href="statements_6002.htm#i2116626"><span class="xreftitleitalic"><span class="italic">physical_attributes_clause</span>::=</span></a>, <a href="#i2117068"><span class="xreftitleitalic"><span class="italic">logging_clause</span>::=</span></a>, <a href="#i2116510"><span class="xreftitleitalic"><span class="italic">parallel_clause</span>::=</span></a>, <a href="statements_7002.htm#i2129707"><span class="xreftitleitalic"><span class="italic">table_partitioning_clauses</span> ::=</span></a> (in <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code>), <a href="#i2117146"><span class="xreftitleitalic"><span class="italic">new_values_clause</span>::=</span></a>, <a href="#CACBGACI"><span class="xreftitleitalic"><span class="italic">mv_log_purge_clause</span>::=</span></a>, <a href="#CCHGAFBA"><span class="xreftitleitalic"><span class="italic">for_refresh_clause</span>::=</span></a>.)</p>
<p class="subhead2"><a id="SQLRF54194"></a><a href="#i2064772"><span class="xreftitleitalic"><span class="italic">physical_attributes_clause</span></span></a>::=</p>
<img width="268" height="147" src="img/physical_attributes_clause.gif" alt="Description of physical_attributes_clause.gif follows"/><br/>
<a id="sthref5146" href="img_text/physical_attributes_clause.htm">Description of the illustration &#39;&#39;physical_attributes_clause.gif&#39;&#39;</a><br/>
<br/>
<p>(<a href="clauses009.htm#CJACEJGB"><span class="xreftitleitalic"><span class="italic">storage_clause</span>::=</span></a><span class="syntaxinlinebold"><a id="sthref5147"></a></span>)</p>
<p class="subhead2"><a id="i2117068"></a><a id="SQLRF54195"></a><span class="italic">logging_clause</span>::=</p>
<img width="237" height="91" src="img/logging_clause.gif" alt="Description of logging_clause.gif follows"/><br/>
<a id="sthref5148" href="img_text/logging_clause.htm">Description of the illustration &#39;&#39;logging_clause.gif&#39;&#39;</a><br/>
<br/>
<p class="subhead2"><a id="i2116510"></a><a id="SQLRF54196"></a><a href="#i2064829"><span class="xreftitleitalic"><span class="italic">parallel_clause</span></span></a>::=<a id="sthref5149"></a></p>
<img width="241" height="79" src="img/parallel_clause.gif" alt="Description of parallel_clause.gif follows"/><br/>
<a id="sthref5150" href="img_text/parallel_clause.htm">Description of the illustration &#39;&#39;parallel_clause.gif&#39;&#39;</a><br/>
<br/>
<p class="subhead2"><a id="i2117146"></a><a id="SQLRF54197"></a><span class="italic">new_values_clause</span>::=</p>
<img width="265" height="58" src="img/new_values_clause.gif" alt="Description of new_values_clause.gif follows"/><br/>
<a id="sthref5151" href="img_text/new_values_clause.htm">Description of the illustration &#39;&#39;new_values_clause.gif&#39;&#39;</a><br/>
<br/>
<p class="subhead2"><a id="CACBGACI"></a><a id="SQLRF54198"></a><a href="#CACCJBFD"><span class="xreftitleitalic"><span class="italic">mv_log_purge_clause</span></span></a>::=</p>
<img width="656" height="232" src="img/mv_log_purge_clause.gif" alt="Description of mv_log_purge_clause.gif follows"/><br/>
<a id="sthref5152" href="img_text/mv_log_purge_clause.htm">Description of the illustration &#39;&#39;mv_log_purge_clause.gif&#39;&#39;</a><br/>
<br/>
<p class="subhead2"><a id="CCHGAFBA"></a><a id="SQLRF56063"></a><a href="#CCHIHIEB"><span class="xreftitleitalic"><span class="italic">for_refresh_clause</span></span></a>::=</p>
<img width="477" height="58" src="img/for_refresh_clause.gif" alt="Description of for_refresh_clause.gif follows"/><br/>
<a id="sthref5153" href="img_text/for_refresh_clause.htm">Description of the illustration &#39;&#39;for_refresh_clause.gif&#39;&#39;</a><br/>
<br/></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref5154"></a>Semantics</p>
<p class="subhead1"><a id="SQLRF54199"></a><span class="italic">schema</span></p>
<p>Specify the schema containing the materialized view log master table. If you omit <code dir="ltr"><span class="codeinlineitalic">schema</span></code>, then Oracle Database assumes the master table is contained in your own schema. Oracle Database creates the materialized view log in the schema of its master table. You cannot create a materialized view log for a table in the schema of the user <code dir="ltr">SYS</code>.</p>
<p class="subhead1"><a id="SQLRF54200"></a><span class="italic">table</span></p>
<p>Specify the name of the master table for which the materialized view log is to be created. Oracle Database encrypts any columns in the materialized view log that are encrypted in the master table, using the same encryption algorithm.</p>
<p><a id="SQLRF54201"></a><span class="subhead3">Restrictions on Master Tables of Materialized View Logs&nbsp;</span>The following restrictions apply to master tables of materialized view logs:</p>
<ul>
<li>
<p>You cannot create a materialized view log for a temporary table or for a view.</p>
</li>
<li>
<p>You cannot create a materialized view log for a master table with a virtual column.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i2098404">&#34;Creating a Materialized View Log for Fast Refresh: Examples&#34;</a></div>
<p class="subhead1"><a id="i2064772"></a><a id="SQLRF54202"></a><span class="italic">physical_attributes<a id="sthref5155"></a><a id="sthref5156"></a>_clause</span></p>
<p>Use the <code dir="ltr"><span class="codeinlineitalic">physical_attributes_clause</span></code> to define physical and storage characteristics for the materialized view log.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="clauses007.htm#g1058547"><span class="xreftitleitalic"><span class="italic">physical_attributes_clause</span></span></a> and <a href="clauses007.htm#i1026834"><span class="xreftitleitalic"><span class="italic">storage_clause</span></span></a> for a complete description these clauses, including default values</div>
<p class="subhead1"><a id="SQLRF54203"></a>TABLESPACE Clause<a id="sthref5157"></a></p>
<p>Specify the tablespace in which the materialized view log is to be created. If you omit this clause, then the database creates the materialized view log in the default tablespace of the schema of the materialized view log.</p>
<p class="subhead1"><a id="SQLRF54204"></a><span class="italic">logging_clause</span><a id="sthref5158"></a></p>
<p>Specify either <code dir="ltr">LOGGING</code> or <code dir="ltr">NOLOGGING</code> to establish the logging characteristics for the materialized view log. The default is the logging characteristic of the tablespace in which the materialized view log resides.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="clauses005.htm#i999782"><span class="xreftitleitalic"><span class="italic">logging_clause</span></span></a> for a full description of this clause</div>
<p class="subhead1"><a id="SQLRF54205"></a>CACHE | NOCACHE<a id="sthref5159"></a><a id="sthref5160"></a></p>
<p>For data that will be accessed frequently, <code dir="ltr">CACHE</code> specifies that the blocks retrieved for this log are placed at the most recently used end of the least recently used (LRU) list in the buffer cache when a full table scan is performed. This attribute is useful for small lookup tables.</p>
<p><code dir="ltr">NOCACHE</code> specifies that the blocks are placed at the least recently used end of the LRU list. The default is <code dir="ltr">NOCACHE</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<code dir="ltr">NOCACHE</code> has no effect on materialized view logs for which you specify <code dir="ltr">KEEP</code> in the <code dir="ltr"><span class="codeinlineitalic">storage_clause</span></code>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="statements_7002.htm#i2095331">CREATE TABLE</a> for information about specifying <code dir="ltr">CACHE</code> or <code dir="ltr">NOCACHE</code></div>
<p class="subhead1"><a id="i2064829"></a><a id="SQLRF54206"></a><span class="italic">parallel_clause<a id="sthref5161"></a><a id="sthref5162"></a></span></p>
<p>The <code dir="ltr"><span class="codeinlineitalic">parallel_clause</span></code> lets you indicate whether parallel operations will be supported for the materialized view log.</p>
<p>For complete information on this clause, refer to <a href="statements_7002.htm#i2159323"><span class="xreftitleitalic"><span class="italic">parallel_clause</span></span></a> in the documentation on <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code>.</p>
<p class="subhead1"><a id="SQLRF54207"></a><span class="italic">table_partitioning_clauses <a id="sthref5163"></a><a id="sthref5164"></a></span></p>
<p>Use the <code dir="ltr"><span class="codeinlineitalic">table_partitioning_clauses</span></code> to indicate that the materialized view log is partitioned on specified ranges of values or on a hash function. Partitioning of materialized view logs is the same as partitioning of tables.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="statements_7002.htm#i2215406"><span class="xreftitleitalic"><span class="italic">table_partitioning_clauses</span></span></a> in the <code dir="ltr">CREATE TABLE</code> documentation</div>
<p class="subhead1"><a id="SQLRF54208"></a>WITH Clause <a id="sthref5165"></a><a id="sthref5166"></a><a id="sthref5167"></a><a id="sthref5168"></a></p>
<p>Use the <code dir="ltr">WITH</code> clause to indicate whether the materialized view log should record the primary key, rowid, object ID, or a combination of these row identifiers when rows in the master are changed. You can also use this clause to add a sequence to the materialized view log to provide additional ordering information for its records.</p>
<p>This clause also specifies whether the materialized view log records additional columns that might be referenced as <span class="bold">filter columns</span>, which are non-primary-key columns referenced by subquery materialized views, or <span class="bold">join columns</span>, which are non-primary-key columns that define a join in the subquery <code dir="ltr">WHERE</code> clause.</p>
<p>If you omit this clause, or if you specify the clause without <code dir="ltr">PRIMARY</code> <code dir="ltr">KEY</code>, <code dir="ltr">ROWID</code>, or <code dir="ltr">OBJECT</code> <code dir="ltr">ID</code>, then the database stores primary key values by default. However, the database does not store primary key values implicitly if you specify only <code dir="ltr">OBJECT</code> <code dir="ltr">ID</code> or <code dir="ltr">ROWID</code> at create time. A primary key log, created either explicitly or by default, performs additional checking on the primary key constraint.</p>
<p><a id="SQLRF54209"></a><span class="subhead3">OBJECT ID&nbsp;</span>Specify <code dir="ltr">OBJECT</code> <code dir="ltr">ID</code> to indicate that the system-generated or user-defined object identifier of every modified row should be recorded in the materialized view log.</p>
<p><a id="SQLRF54210"></a><span class="subhead3">Restriction on OBJECT ID&nbsp;</span>You can specify <code dir="ltr">OBJECT</code> <code dir="ltr">ID</code> only when creating a log on an object table, and you cannot specify it for storage tables.</p>
<p><a id="SQLRF54211"></a><span class="subhead3">PRIMARY KEY&nbsp;</span>Specify <code dir="ltr">PRIMARY</code> <code dir="ltr">KEY</code> to indicate that the primary key of all rows changed should be recorded in the materialized view log.</p>
<p><a id="SQLRF54212"></a><span class="subhead3">ROWID&nbsp;</span>Specify <code dir="ltr">ROWID</code> to indicate that the rowid of all rows changed should be recorded in the materialized view log.</p>
<p><a id="SQLRF54213"></a><span class="subhead3">SEQUENCE&nbsp;</span>Specify <code dir="ltr">SEQUENCE</code> to indicate that a sequence value providing additional ordering information should be recorded in the materialized view log. Sequence numbers are necessary to support fast refresh after some update scenarios.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DWHSG008" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=DWHSG008"><span class="italic">Oracle Database Data Warehousing Guide</span></a> for more information on the use of sequence numbers in materialized view logs and for examples that use this clause</div>
<p><a id="CCHJAHCG"></a><a id="SQLRF54214"></a><span class="subhead3">COMMIT SCN&nbsp;</span>Without the <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code> clause, the materialized view log is based on timestamps and requires some setup operations when preparing to refresh the materialized view. Specify <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code> to instruct the database to use commit SCN data rather than timestamps. This setting removes the need for the setup operations and thus can improve the speed of the materialized view refresh.</p>
<p>You can create the following types of local materialized views (including both <code dir="ltr">ON</code> <code dir="ltr">COMMIT</code> and <code dir="ltr">ON</code> <code dir="ltr">DEMAND</code>) on master tables with commit SCN-based materialized view logs:</p>
<ul>
<li>
<p>Materialized aggregate views, including materialized aggregate views on a single table</p>
</li>
<li>
<p>Materialized join views</p>
</li>
<li>
<p>Primary-key-based and rowid-based single table materialized views</p>
</li>
<li>
<p><code dir="ltr">UNION</code> <code dir="ltr">ALL</code> materialized views, where each <code dir="ltr">UNION</code> <code dir="ltr">ALL</code> branch is one of the above materialized view types</p>
</li>
</ul>
<p>You cannot create remote materialized views on master tables with commit SCN-based materialized view logs.</p>
<p><a id="SQLRF54215"></a><span class="subhead3">Restrictions on COMMIT SCN&nbsp;</span>The following restrictions apply to <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code>:</p>
<ul>
<li>
<p>Use of <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code> on a table with one or more LOB columns is not supported and causes <code dir="ltr">ORA-32421</code>.</p>
</li>
<li>
<p>Creating a materialized view on master tables with different types of materialized view logs (that is, a master table with timestamp-based materialized view logs and a master table with commit SCN-based materialized view logs) is not supported and causes <code dir="ltr">ORA-32414</code>.</p>
</li>
<li>
<p>If you specify <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code>, then you cannot specify <code dir="ltr">FOR</code> <code dir="ltr">SYNCHRONOUS</code> <code dir="ltr">REFRESH</code>.</p>
</li>
</ul>
<p><a id="SQLRF54216"></a><span class="subhead3"><span class="italic">column</span>&nbsp;</span>Specify the columns whose values you want to be recorded in the materialized view log for all rows that are changed. Typically these columns are filter columns and join columns.</p>
<p><a id="SQLRF54217"></a><span class="subhead3">Restrictions on the WITH Clause&nbsp;</span>This clause is subject to the following restrictions:</p>
<ul>
<li>
<p>You can specify only one <code dir="ltr">PRIMARY</code> <code dir="ltr">KEY</code>, one <code dir="ltr">ROWID</code>, one <code dir="ltr">OBJECT</code> <code dir="ltr">ID</code>, one <code dir="ltr">SEQUENCE</code>, and one column list for each materialized view log.</p>
</li>
<li>
<p>Primary key columns are implicitly recorded in the materialized view log. Therefore, you cannot specify any of the following combinations if <code dir="ltr"><span class="codeinlineitalic">column</span></code> contains one of the primary key columns:</p>
<pre dir="ltr">WITH ... PRIMARY KEY ... (<span class="italic">column</span>)
WITH ... (<span class="italic">column</span>) ... PRIMARY KEY
WITH (<span class="italic">column</span>)
</pre></li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="statements_6002.htm#i2063793">CREATE MATERIALIZED VIEW</a> for information on explicit and implicit inclusion of materialized view log values</p>
</li>
<li>
<p><a class="olink REPLN006" href="../REPLN/repplan.htm#REPLN006"><span class="italic">Oracle Database Advanced Replication</span></a> for more information about filter columns and join columns</p>
</li>
<li>
<p><a href="#i2098358">&#34;Specifying Filter Columns for Materialized View Logs: Example&#34;</a> and <a href="#i2098379">&#34;Specifying Join Columns for Materialized View Logs: Example&#34;</a></p>
</li>
</ul>
</div>
<p class="subhead1"><a id="SQLRF54218"></a>NEW VALUES Clause <a id="sthref5169"></a><a id="sthref5170"></a><a id="sthref5171"></a></p>
<p>The <code dir="ltr">NEW</code> <code dir="ltr">VALUES</code> clause lets you determine whether Oracle Database saves both old and new values for update DML operations in the materialized view log.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i2119924">&#34;Including New Values in Materialized View Logs: Example&#34;</a></div>
<p><a id="SQLRF54219"></a><span class="subhead3">INCLUDING&nbsp;</span>Specify <code dir="ltr">INCLUDING</code> to save both new and old values in the log. If this log is for a table on which you have a single-table materialized aggregate view, and if you want the materialized view to be eligible for fast refresh, then you must specify <code dir="ltr">INCLUDING</code>.</p>
<p><a id="SQLRF54220"></a><span class="subhead3">EXCLUDING&nbsp;</span>Specify <code dir="ltr">EXCLUDING</code> to disable the recording of new values in the log. This is the default. You can use this clause to avoid the overhead of recording new values. Do not use this clause if you have a fast-refreshable single-table materialized aggregate view defined on the master table.</p>
<p class="subhead1"><a id="CACCJBFD"></a><a id="SQLRF54221"></a><span class="italic">mv_log_purge_clause</span><a id="sthref5172"></a></p>
<p>Use this clause to specify the purge time for the materialized view log.</p>
<ul>
<li>
<p><code dir="ltr">IMMEDIATE</code> <code dir="ltr">SYNCHRONOUS</code>: the materialized view log is purged immediately after refresh. This is the default.</p>
</li>
<li>
<p><code dir="ltr">IMMEDIATE</code> <code dir="ltr">ASYNCHRONOUS</code>: the materialized view log is purged in a separate Oracle Scheduler job after the refresh operation.</p>
</li>
<li>
<p><code dir="ltr">START</code> <code dir="ltr">WITH</code>, <code dir="ltr">NEXT</code>, and <code dir="ltr">REPEAT</code> <code dir="ltr">INTERVAL</code> set up a scheduled purge that is independent of the materialized view refresh and is initiated during <code dir="ltr">CREATE</code> or <code dir="ltr">ALTER</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code> statement. This is very similar to scheduled refresh syntax in a <code dir="ltr">CREATE</code> or <code dir="ltr">ALTER</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> statement:</p>
<ul>
<li>
<p>The <code dir="ltr">START</code> <code dir="ltr">WITH</code> datetime expression specifies when the purge starts.</p>
</li>
<li>
<p>The <code dir="ltr">NEXT</code> datetime expression computes the next run time for the purge.</p>
</li>
</ul>
<p>If you specify <code dir="ltr">REPEAT</code> <code dir="ltr">INTERVAL</code>, then the next run time will be: <code dir="ltr">SYSDATE +</code> <code dir="ltr"><span class="codeinlineitalic">interval_expr</span></code>.</p>
<p>A <code dir="ltr">CREATE</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code> statement with a scheduled purge creates an Oracle Scheduler job to perform log purge. The job calls the <code dir="ltr">DBMS_SNAPSHOT</code>.<code dir="ltr">PURGE_LOG</code> procedure to purge the materialized view logs. This process allows you to amortize the purging costs over several materialized view refreshes.</p>
</li>
</ul>
<p><a id="SQLRF54222"></a><span class="subhead3">Restriction on <span class="italic">mv_log_purge_clause</span>&nbsp;</span>This clause is not valid for materialized view logs on temporary tables.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DWHSG9302" href="../DWHSG/basicmv.htm#DWHSG9302"><span class="italic">Oracle Database Data Warehousing Guide</span></a> for more information on purging materialized view logs</div>
<p class="subhead1"><a id="CCHIHIEB"></a><a id="SQLRF56064"></a><span class="italic">for_refresh_clause</span><a id="sthref5173"></a></p>
<p>Use this clause to specify the refresh method for which the materialized view log will be used. You can specify only one refresh method for any given master table.</p>
<p><a id="SQLRF56087"></a><span class="subhead3">FOR SYNCHRONOUS REFRESH&nbsp;</span>Specify this clause to create a staging log that can be used for synchronous refresh. Use <code dir="ltr"><span class="codeinlineitalic">staging_log_name</span></code> to specify the name of the staging log to be created. The staging log will be created in the schema in which the master table resides.</p>
<p>After you create the staging log, you cannot perform DML operations directly on the master table. You must use the procedures in the <code dir="ltr">DBMS_SYNC_REFRESH</code> package to prepare and execute change data operations.</p>
<p><a id="SQLRF56088"></a><span class="subhead3">Restrictions on Synchronous Refresh&nbsp;</span>The following restrictions apply to synchronous refresh:</p>
<ul>
<li>
<p>If you specify <code dir="ltr">FOR</code> <code dir="ltr">SYNCHRONOUS</code> <code dir="ltr">REFRESH</code>, then you cannot specify <code dir="ltr">COMMIT</code> <code dir="ltr">SCN</code>.</p>
</li>
<li>
<p>To be eligible for synchronous refresh, the master table must satisfy the following criteria:</p>
<ul>
<li>
<p>If the master table is a fact table, then it must be partitioned.</p>
</li>
<li>
<p>The master table must have a key. If the master table is a dimension table, then it must have a primary key defined on it. If the master table is a fact table, then the set of columns that are the foreign keys of the dimension tables joined to the fact table are deemed to be the key.</p>
</li>
<li>
<p>The master table cannot have a non-NULL Virtual Private Database (VPD) policy or a trigger defined on it.</p>
</li>
</ul>
<p>Oracle Database may allow you to create a staging log on a master table even if all of the preceding criteria are not met. However, the master table will not be eligible for synchronous refresh.</p>
</li>
<li>
<p>Any existing materialized views on the master table must be refresh-on-demand materialized views. If an existing materialized view is a refresh-on-commit materialized view, then you must change it to a refresh-on-demand materialized view with the <a href="statements_2002.htm#i2226546"><span class="xreftitleitalic"><span class="italic">alter_mv_refresh</span></span></a> clause of <code dir="ltr">ALTER</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> before you create the staging log.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink DWHSG029" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=DWHSG029"><span class="italic">Oracle Database Data Warehousing Guide</span></a> for the complete steps for using synchronous refresh</p>
</li>
<li>
<p><a class="olink ARPLS73623" href="../ARPLS/d_sync_refresh.htm#ARPLS73623"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information on the <code dir="ltr">DBMS_SYNC_REFRESH</code> package</p>
</li>
</ul>
</div>
<p><a id="SQLRF56089"></a><span class="subhead3">FOR FAST REFRESH&nbsp;</span>Specify this clause to create a materialized view log that can be used for fast refresh. The materialized view log will be created in the same schema in which the master table resides. This is the default.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="i2064930"></a>Examples <a id="sthref5174"></a></p>
<p><a id="i2098404"></a><a id="SQLRF54223"></a><span class="subhead3">Creating a Materialized View Log for Fast Refresh: Examples&nbsp;</span>The following statement creates a materialized view log on the <code dir="ltr">oe.customers</code> table that specifies physical and storage characteristics:</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW LOG ON customers
   PCTFREE 5 
   TABLESPACE example 
   STORAGE (INITIAL 10K);
</pre>
<p>The materialized view log on <code dir="ltr">customers</code> supports fast refresh for primary key materialized views only.</p>
<p>The following statement creates another version of the materialized view log with the <code dir="ltr">ROWID</code> clause, which enables fast refresh for more types of materialized views:</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW LOG ON customers WITH PRIMARY KEY, ROWID;
</pre>
<p>This materialized view log on <code dir="ltr">customers</code> makes fast refresh possible for rowid materialized views and for materialized join views. To provide for fast refresh of materialized aggregate views, you must also specify the <code dir="ltr">SEQUENCE</code> and <code dir="ltr">INCLUDING</code> <code dir="ltr">NEW</code> <code dir="ltr">VALUES</code> clauses, as shown in the example that follows.</p>
<p><a id="SQLRF54224"></a><span class="subhead3">Specify a Purge Repeat Interval for a Materialized View Log: Example&nbsp;</span>The following statement creates a materialized view log on the <code dir="ltr">oe.orders</code> table. The contents of the log will be purged once every five days, beginning five days after the creation date of the materialized view log:</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW LOG ON orders
  PCTFREE 5
  TABLESPACE example
  STORAGE (INITIAL 10K)
  PURGE REPEAT INTERVAL &#39;5&#39; DAY;
</pre>
<p><a id="i2098358"></a><a id="SQLRF54225"></a><span class="subhead3">Specifying Filter Columns for Materialized View Logs: Example&nbsp;</span>The following statement creates a materialized view log on the <code dir="ltr">sh.sales</code> table and is used in <a href="statements_6002.htm#i2092102">&#34;Creating Materialized Aggregate Views: Example&#34;</a>. It specifies as filter columns all of the columns of the table referenced in that materialized view.</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW LOG ON sales 
   WITH ROWID, SEQUENCE(amount_sold, time_id, prod_id)
   INCLUDING NEW VALUES; 
</pre>
<p><a id="i2098379"></a><a id="SQLRF54226"></a><span class="subhead3">Specifying Join Columns for Materialized View Logs: Example&nbsp;</span>The following statement creates a materialized view log on the <code dir="ltr">order_items</code> table of the sample <code dir="ltr">oe</code> schema. The log records primary keys and <code dir="ltr">product_id</code>, which is used as a join column in <a href="statements_6002.htm#i2080820">&#34;Creating a Fast Refreshable Materialized View: Example&#34;</a>.</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW LOG ON order_items WITH (product_id);
</pre>
<p><a id="i2119924"></a><a id="SQLRF54227"></a><span class="subhead3">Including New Values in Materialized View Logs: Example&nbsp;</span>The following example creates a materialized view log on the <code dir="ltr">oe.product_information</code> table that specifies <code dir="ltr">INCLUDING</code> <code dir="ltr">NEW</code> <code dir="ltr">VALUES</code>:</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW LOG ON product_information 
   WITH ROWID, SEQUENCE (list_price, min_price, category_id), PRIMARY KEY
   INCLUDING NEW VALUES;
</pre>
<p>You could create the following materialized aggregate view to use the <code dir="ltr">product_information</code> log:</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW products_mv 
   REFRESH FAST ON COMMIT
   AS SELECT SUM(list_price - min_price), category_id
         FROM product_information 
         GROUP BY category_id;
</pre>
<p>This materialized view is eligible for fast refresh because the log defined on its master table includes both old and new values.</p>
<p><a id="SQLRF56105"></a><span class="subhead3">Creating a Staging Log for Synchronous Refresh: Example&nbsp;</span>The following statement creates a staging log on the <code dir="ltr">sh.sales</code> fact table. The staging log is named <code dir="ltr">mystage_log</code> and is stored in the <code dir="ltr">sh</code> schema. It can be used for synchronous refresh.</p>
<pre dir="ltr">CREATE MATERIALIZED VIEW LOG ON sales
   PCTFREE 5 
   TABLESPACE example 
   STORAGE (INITIAL 10K)
   FOR SYNCHRONOUS REFRESH USING mystage_log;
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5862">
<tr>
<td class="cellalignment5869">
<table class="cellalignment5867">
<tr>
<td class="cellalignment5866"><a href="statements_6002.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5866"><a href="statements_6004.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5871">
<table class="cellalignment5865">
<tr>
<td class="cellalignment5866"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5866"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5866"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5866"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5866"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5866"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>