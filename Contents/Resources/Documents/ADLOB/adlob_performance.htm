<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-144"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Performance%20Guidelines"></a><title>Performance Guidelines</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="statistics, access, access statistics for LOBs, retrieving LOB access statistics, examples, LOB access statistics"/>
<meta name="dcterms.created" content="2017-03-16T22:27:47Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SecureFiles and Large Objects Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E17605-12"/>
<meta name="dcterms.isVersionOf" content="ADLOB"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2015, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="adlob_api_overview.htm" title="Previous" type="text/html"/>
<link rel="Next" href="part_sql.htm" title="Next" type="text/html"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-0EA0E7B7-96E6-4393-B2DA-1F2CA72A72B7"></a> <span id="PAGE" style="display:none;">21/34</span> <!-- End Header -->
<a id="ADLOB45549"></a>
<h1 id="ADLOB-GUID-0EA0E7B7-96E6-4393-B2DA-1F2CA72A72B7" class="sect1"><span class="enumeration_chapter">14</span> Performance Guidelines</h1>
<div>
<p>There are performance guidelines for applications that use LOB data types.</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="adlob_performance.htm#GUID-8505852E-936B-477F-B958-14574BB6EDA4">LOB Performance Guidelines</a></p>
</li>
<li>
<p><a href="adlob_performance.htm#GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F">Moving Data to LOBs in a Threaded Environment</a></p>
</li>
<li>
<p><a href="adlob_performance.htm#GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE">LOB Access Statistics</a></p>
</li>
</ul>
</div>
<a id="ADLOB45550"></a>
<div class="props_rev_3"><a id="GUID-8505852E-936B-477F-B958-14574BB6EDA4"></a>
<h2 id="ADLOB-GUID-8505852E-936B-477F-B958-14574BB6EDA4" class="sect2">LOB Performance Guidelines</h2>
<div>
<p>There are various performance guidelines that apply to applications that use LOB data types.</p>
</div>
<a id="ADLOB45551"></a>
<div class="props_rev_3"><a id="GUID-2959491E-25BA-4CE0-9930-7A5DDEB7A78D"></a>
<h3 id="ADLOB-GUID-2959491E-25BA-4CE0-9930-7A5DDEB7A78D" class="sect3">Chunk Size</h3>
<div>
<p>A chunk is one or more Oracle blocks. You can specify the chunk size for the LOB when creating the table that contains the LOB.</p>
<p>This corresponds to the data size used by Oracle Database when accessing or modifying the LOB value. Part of the chunk is used to store system-related information and the rest stores the LOB value. The API you are using has a function that returns the amount of space used in the LOB chunk to store the LOB value. In PL/SQL use <code class="codeph">DBMS_LOB.GETCHUNKSIZE</code>. In OCI, use <code class="codeph">OCILobGetChunkSize()</code>. For SecureFiles, the usable data area of the tablespace block size is returned.</p>
</div>
</div>
<a id="ADLOB45552"></a>
<div class="props_rev_3"><a id="GUID-05BECDAD-4166-4BEF-832D-47FA78BED2E7"></a>
<h3 id="ADLOB-GUID-05BECDAD-4166-4BEF-832D-47FA78BED2E7" class="sect3">Performance Guidelines for Small BasicFiles LOBs</h3>
<div>
<p>If most LOBs in your database tables are small in size, use these guidelines.</p>
<p>For LOBs in your database tables that are 8K bytes or less, with only a few rows containing LOBs larger than 8K bytes, then use these guidelines to maximize database performance:</p>
<ul style="list-style-type: disc;">
<li>
<p>Use <code class="codeph">ENABLE STORAGE IN ROW</code>.</p>
</li>
<li>
<p>Set the <code class="codeph">DB_BLOCK_SIZE</code> initialization parameter to 8K bytes and use a chunk size of 8K bytes.</p>
</li>
<li>
<p>See <span class="q">&#34;<a href="adlob_tables.htm#GUID-517E1234-EFCD-4D16-B69B-23F72A18A77D">LOB Storage Parameters</a>&#34;</span> information on tuning other parameters such as <code class="codeph">CACHE,</code> <code class="codeph">PCTVERSION</code>, and <code class="codeph">CHUNK</code> for the LOB segment.</p>
</li>
</ul>
</div>
</div>
<a id="ADLOB45553"></a>
<div class="props_rev_3"><a id="GUID-D895BC0B-A450-4B58-B05C-8EC631F38455"></a>
<h3 id="ADLOB-GUID-D895BC0B-A450-4B58-B05C-8EC631F38455" class="sect3">General Performance Guidelines for BasicFiles LOBs</h3>
<div>
<p>You can achieve maximum performance with BasicFiles LOBs.</p>
<p>Use these guidelines for maximum performance with BasicFiles LOBs:</p>
<ul style="list-style-type: disc;">
<li>
<p>When Possible, Read/Write <a id="d62034e381" class="indexterm-anchor"></a><a id="d62034e385" class="indexterm-anchor"></a><a id="d62034e387" class="indexterm-anchor"></a>Large Data Chunks at a Time:</p>
<p>Because LOBs are big, you can obtain the best performance by reading and writing large pieces of a LOB value at a time. This helps in several respects:</p>
<ol>
<li>
<p>If accessing the LOB from the client side and the client is at a different node than the server, then large reads/writes reduce network overhead.</p>
</li>
<li>
<p>If using the <code class="codeph">NOCACHE</code> option, then each small read/write incurs an I/O. Reading/writing large quantities of data reduces the I/O.</p>
</li>
<li>
<p>Writing to the LOB creates a new version of the LOB chunk. Therefore, writing small amounts at a time incurs the cost of a new version for each small write. If logging is on, then the chunk is also stored in the redo log.</p>
</li>
</ol>
</li>
<li>
<p>Use LOB Buffering to Read/Write Small Chunks of Data:</p>
<p>If you must read or write small pieces of LOB data on the client, then use LOB buffering &mdash; see <code class="codeph">OCILobEnableBuffering</code>(), <code class="codeph">OCILobDisableBuffering</code>(), <code class="codeph">OCILobFlushBuffer</code>(), <code class="codeph">OCILobWrite2</code>(), <code class="codeph">OCILobRead2</code>(). Basically, turn on LOB buffering before reading/writing small pieces of LOB data.</p>
<div class="infoboxnotealso" id="GUID-D895BC0B-A450-4B58-B05C-8EC631F38455__GUID-9E608593-D398-4F25-8E2F-3E6892D9EC8D">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="adlob_design.htm#GUID-7094DFC9-03B9-46D8-95DB-B80741AB755A">LOB Buffering Subsystem</a>&#34;</span> for more information on LOB buffering.</p>
</div>
</li>
<li>
<p>Use <code class="codeph">OCILobRead2()</code> and <code class="codeph">OCILobWrite2()</code> with Callback:</p>
<p>So that data is streamed to and from the LOB. Ensure the length of the entire write is set in the <code class="codeph">amount</code> parameter on input. Whenever possible, read and write in <span class="italic">multiples</span> of the LOB <span class="italic">chunk</span> size.</p>
</li>
<li>
<p>Use a Checkout/Check-in Model for LOBs:</p>
<p>LOBs are optimized for the following operations:</p>
<ul style="list-style-type: disc;">
<li>
<p>SQL <code class="codeph">UPDATE</code> which replaces the entire LOB value</p>
</li>
<li>
<p>Copy the entire LOB data to the client, modify the LOB data on the client side, copy the entire LOB data back to the database. This can be done using <code class="codeph">OCILobRead2</code>() and <code class="codeph">OCILobWrite2</code>() with streaming.</p>
</li>
</ul>
</li>
<li>
<p>Commit changes frequently.</p>
</li>
</ul>
</div>
</div>
<a id="ADLOB106"></a><a id="ADLOB105"></a>
<div class="props_rev_3"><a id="GUID-4E9360AA-C610-4341-AAD3-9DCDF82CF085"></a>
<h3 id="ADLOB-GUID-4E9360AA-C610-4341-AAD3-9DCDF82CF085" class="sect3">Temporary LOB Performance Guidelines</h3>
<div>
<p>In addition to the guidelines described in <span class="q">&#34;<a href="adlob_performance.htm#GUID-8505852E-936B-477F-B958-14574BB6EDA4">LOB Performance Guidelines</a>&#34;</span> on LOB performance in general, here are some guidelines for using temporary LOBs:</p>
<ul style="list-style-type: disc;">
<li>
<p>Use a separate temporary tablespace for temporary LOB storage instead of the default system tablespace</p>
<p>This avoids device contention when copying data from persistent LOBs to temporary LOBs.</p>
<p>If you use the newly provided enhanced SQL semantics functionality in your applications, then there are many more temporary LOBs created silently in SQL and PL/SQL than before. Ensure that <span class="italic"><span class="bold">temporary tablespace</span></span> for storing these temporary LOBs is <span class="italic"><span class="bold">large enough</span></span> for your applications. In particular, these temporary LOBs are silently created when you use the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>SQL functions on LOBs</p>
</li>
<li>
<p>PL/SQL built-in character functions on LOBs</p>
</li>
<li>
<p>Variable assignments from <code class="codeph">VARCHAR2</code>/<code class="codeph">RAW</code> to <code class="codeph">CLOB</code>s/<code class="codeph">BLOB</code>s, respectively.</p>
</li>
<li>
<p>Perform a <code class="codeph">LONG</code>-to-<code class="codeph">LOB</code> migration</p>
</li>
</ul>
</li>
<li>
<p>In PL/SQL, use <a id="d62034e598" class="indexterm-anchor"></a>NOCOPY to pass temporary LOB parameters by reference whenever possible.</p>
<p>Refer to the <a class="olink LNPLS" target="_blank" href="../LNPLS/toc.htm"><span class="italic">Oracle Database PL/SQL Language Reference,</span></a> for more information on passing parameters by reference and parameter aliasing.</p>
</li>
<li>
<p>Take advantage of buffer cache on temporary LOBs.</p>
<p><a id="d62034e613" class="indexterm-anchor"></a><a id="d62034e617" class="indexterm-anchor"></a><a id="d62034e621" class="indexterm-anchor"></a>Temporary LOBs created with the CACHE parameter set to true move through the buffer cache. Otherwise temporary LOBs are read directly from, and written directly to, disk.</p>
</li>
<li>
<p>For optimal performance, temporary LOBs use reference on read, copy on write semantics. When a temporary LOB locator is assigned to another locator, the physical LOB data is not copied. Subsequent READ operations using either of the LOB locators refer to the same physical LOB data. On the first WRITE operation after the assignment, the physical LOB data is copied in order to preserve LOB value semantics, that is, to ensure that each locator points to a unique LOB value. This performance consideration mainly applies to the PL/SQL and OCI environments.</p>
<p>In PL/SQL, reference on read, copy on write semantics are illustrated as follows:</p>
<pre dir="ltr">LOCATOR1 BLOB; 
LOCATOR2 BLOB; 
DBMS_LOB.CREATETEMPORARY (LOCATOR1,TRUE,DBMS_LOB.SESSION); 

-- LOB data is not copied in this assignment operation:  
LOCATOR2 := LOCATOR;  
-- These read operations refer to the same physical LOB copy: 
DBMS_LOB.READ(LOCATOR1, ...); 
DBMS_LOB.GETLENGTH(LOCATOR2, ...); 

-- A physical copy of the LOB data is made on WRITE:  
DBMS_LOB.WRITE(LOCATOR2, ...); 
</pre>
<p>In OCI, to ensure value semantics of LOB locators and data, <code class="codeph">OCILobLocatorAssign()</code> is used to copy temporary LOB locators and the LOB Data. <code class="codeph">OCILobLocatorAssign()</code> does not make a round trip to the server. The physical temporary LOB copy is made when LOB updates happen in the same round trip as the LOB update API as illustrated in the following:</p>
<pre dir="ltr">OCILobLocator *LOC1;
OCILobLocator *LOC2;
OCILobCreateTemporary(... LOC1, ... TRUE,OCI_DURATION_SESSION);

/* No round-trip is incurred in the following call. */
OCILobLocatorAssign(... LOC1, LOC2);

/* Read operations refer to the same physical LOB copy. */
OCILobRead2(... LOC1 ...)

/* One round-trip is incurred to make a new copy of the
 * LOB data and to write to the new LOB copy.
 */
OCILobWrite2(... LOC1 ...)

/* LOC2 does not see the same LOB data as LOC1. */
OCILobRead2(... LOC2 ...)

</pre>
<p>If LOB value semantics are not intended, then you can use C pointers to achieve reference semantics as illustrated in the following:</p>
<pre dir="ltr">OCILobLocator *LOC1;
OCILobLocator *LOC2;
OCILobCreateTemporary(... LOC1, ... TRUE,OCI_DURATION_SESSION);

/* Pointer is copied. LOC1 and LOC2 refer to the same LOB data. */
LOC2 = LOC1;

/* Write to LOC2. */
OCILobWrite2(...LOC2...)

/* LOC1 sees the change made to LOC2. */
OCILobRead2(...LOC1...)
</pre></li>
<li>
<p>Use OCI_OBJECT mode for temporary LOBs</p>
<p>To improve the performance of temporary LOBs on LOB assignment, use <code class="codeph">OCI_OBJECT</code> mode for <code class="codeph">OCILobLocatorAssign()</code>. In <code class="codeph">OCI_OBJECT</code> mode, the database tries to minimize the number of deep copies to be done. Hence, after <code class="codeph">OCILobLocatorAssign()</code> is done on a source temporary LOB in <code class="codeph">OCI_OBJECT</code> mode, the source and the destination locators point to the same LOB until any modification is made through either LOB locator.</p>
</li>
<li>
<p>Free up temporary LOBs returned from SQL queries and PL/SQL programs</p>
<p>In PL/SQL, C (OCI), Java and other programmatic interfaces, SQL query results or PL/SQL program executions return temporary LOBs for operation/function calls on LOBs. For example:</p>
<pre dir="ltr">SELECT substr(CLOB_Column, 4001, 32000) FROM ... 
</pre>
<p>If the query is executed in PL/SQL, then the returned temporary LOBs are automatically freed at the end of a PL/SQL program block. You can also explicitly free the temporary LOBs at any time. In OCI and Java, the returned temporary LOB must be explicitly freed.</p>
<p>Without proper deallocation of the temporary LOBs returned from SQL queries, temporary tablespace is filled and you may observe performance degradation.</p>
</li>
</ul>
</div>
</div>
<a id="ADLOB45554"></a>
<div class="props_rev_3"><a id="GUID-D5560166-21AA-4F37-8DB3-398EEB15F5F8"></a>
<h3 id="ADLOB-GUID-D5560166-21AA-4F37-8DB3-398EEB15F5F8" class="sect3">Performance Considerations for SQL Semantics and LOBs</h3>
<div>
<p>Be aware of the following performance issues when using SQL semantics with LOBs:</p>
<ul style="list-style-type: disc;">
<li>
<p>Ensure that your temporary tablespace is large enough to accommodate LOBs stored out-of-line. Persistent LOBs that are greater than approximately 4000 bytes in size are stored outside of the LOB column.</p>
</li>
<li>
<p>When possible, free unneeded temporary LOB instances. Unless you explicitly free a temporary LOB instance, the LOB remains in existence while your application is executing. More specifically, the instance exists while the scope in which the LOB was declared is executing.</p>
<div class="infoboxnotealso" id="GUID-D5560166-21AA-4F37-8DB3-398EEB15F5F8__GUID-B5BB1CE0-0695-4F94-9231-300569F2C993">
<p class="notep1">See Also:</p>
<p><a href="adlob_sql_semantics.htm#GUID-47B94072-7782-40DD-BFD7-7D3D8A65B502" title="Various SQL semantics are supported for LOBs.">SQL Semantics and LOBs</a> for details on SQL semantics support for LOBs.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<a id="ADLOB45556"></a><a id="ADLOB45557"></a><a id="ADLOB45555"></a>
<div class="props_rev_3"><a id="GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F"></a>
<h2 id="ADLOB-GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F" class="sect2">Moving Data to LOBs in a Threaded Environment</h2>
<div>
<p>There are two possible procedures that you can use to move data to LOBs in a threaded environment, one of which should be avoided.</p>
<div class="section">
<p class="subhead2">Recommended Procedure</p>
</div>
<!-- class="section" -->
<div class="section">
<div class="infobox-note" id="GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F__GUID-262E3250-3717-41A1-88F6-76678921E716">
<p class="notep1">Note:</p>
<ul style="list-style-type: disc;">
<li>
<p>There is no requirement to create an empty LOB in this procedure.</p>
</li>
<li>
<p>You can use the <code class="codeph">RETURNING</code> clause as part of the <code class="codeph">INSERT/UPDATE</code> statement to return a locked LOB locator. This eliminates the need for doing a <code class="codeph">SELECT-FOR-UPDATE</code>, as mentioned in step 3.</p>
</li>
</ul>
</div>
<p>The recommended procedure is as follows:</p>
<ol>
<li>
<p><code class="codeph">INSERT</code> an empty LOB, <code class="codeph">RETURNING</code> the LOB locator.</p>
</li>
<li>
<p>Move data into the LOB using this locator.</p>
</li>
<li>
<p><code class="codeph">COMMIT</code>. This releases the ROW locks and makes the LOB data persistent.</p>
</li>
</ol>
<p>Alternatively, you can insert more than 4000 bytes of data directly for the LOB columns or LOB attributes.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Procedure to Avoid</p>
</div>
<!-- class="section" -->
<div class="section">
<p>The following sequence requires a new connection when using a threaded environment, adversely affects performance, and is not recommended:</p>
<ol>
<li>
<p>Create an empty (non-<code class="codeph">NULL</code>) LOB</p>
</li>
<li>
<p>Perform <code class="codeph">INSERT</code> using the empty LOB</p>
</li>
<li>
<p><code class="codeph">SELECT-FOR-UPDATE</code> of the row just entered</p>
</li>
<li>
<p>Move data into the LOB</p>
</li>
<li>
<p><code class="codeph">COMMIT</code>. This releases the <code class="codeph">ROW</code> locks and makes the LOB data persistent.</p>
</li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="ADLOB0710"></a>
<div class="props_rev_3"><a id="GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE"></a>
<h2 id="ADLOB-GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE" class="sect2">LOB Access Statistics</h2>
<div>
<p>After Oracle Database 10<span class="italic">g</span> Release 2, three session-level statistics specific to LOBs are available to users: LOB reads, LOB writes, and LOB writes unaligned.</p>
<p>Session statistics are accessible through the <code class="codeph">V$MYSTAT</code>, <code class="codeph">V$SESSTAT</code>, and <code class="codeph">V$SYSSTAT</code> dynamic performance views. To query these views, the user must be granted the privileges <code class="codeph">SELECT_CATALOG_ROLE</code>, <code class="codeph">SELECT ON SYS.V_$MYSTAT</code> view, and <code class="codeph">SELECT ON SYS.V_$STATNAME</code> view.</p>
<p><a id="d62034e1000" class="indexterm-anchor"></a><a id="d62034e1002" class="indexterm-anchor"></a><a id="d62034e1004" class="indexterm-anchor"></a>LOB reads is defined as the number of LOB API read operations performed in the session/system. A single LOB API read may correspond to multiple physical/logical disk block reads.</p>
<p>LOB writes is defined as the number of LOB API write operations performed in the session/system. A single LOB API write may correspond to multiple physical/logical disk block writes.</p>
<p>LOB writes unaligned is defined as the number of LOB API write operations whose start offset or buffer size is not aligned to the internal chunk size of the LOB. Writes aligned to chunk boundaries are the most efficient write operations. The internal chunk size of a LOB is available through the LOB API (for example, using PL/SQL, by <code class="codeph">DBMS_LOB.GETCHUNKSIZE()</code>).</p>
<p>The following simple example demonstrates how LOB session statistics are updated as the user performs read/write operations on LOBs.</p>
<p>It is important to note that session statistics are aggregated across operations to all LOBs accessed in a session; the statistics are not separated or categorized by objects (that is, table, column, segment, object numbers, and so on).</p>
<p>In these examples, you reconnect to the database for each demonstration to clear the <code class="codeph">V$MYSTAT</code>. This enables you to see how the lob statistics change for the specific operation you are testing, without the potentially obscuring effect of past LOB operations within the same session.</p>
<div class="infobox-note" id="GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE__GUID-5FA04D0B-03B2-4E3F-A81D-3DB21C2485CA">
<p class="notep1">See also:</p>
<p><a class="olink REFRN103" target="_blank" href="../REFRN/GUID-2A9F2E5B-992E-43D1-8377-F4080824129C.htm#REFRN103"><span class="italic">Oracle Database Reference</span></a>, appendix E, &#34;Statistics Descriptions&#34;</p>
</div>
</div>
<a id="ADLOB45558"></a>
<div class="props_rev_3"><a id="GUID-C8AD5DF4-BA4F-411E-B2A7-B58C355F3790"></a>
<h3 id="ADLOB-GUID-C8AD5DF4-BA4F-411E-B2A7-B58C355F3790" class="sect3">Example of Retrieving LOB Access Statistics</h3>
<div>
<div class="section">
<p>This example demonstrates retrieving LOB access statistics.</p>
<pre dir="ltr">rem
rem Set up the user
rem
 
CONNECT / AS SYSDBA;
SET ECHO ON; 
GRANT SELECT_CATALOG_ROLE TO pm;
GRANT SELECT ON sys.v_$mystat TO pm;
GRANT SELECT ON sys.v_$statname TO pm;
 
rem
rem Create a simplified view for statistics queries
rem
 
CONNECT pm;
SET ECHO ON;
 
DROP VIEW mylobstats;
CREATE VIEW mylobstats
AS
SELECT  SUBSTR(n.name,1,20) name,
        m.value             value
FROM    v$mystat    m,
        v$statname  n
WHERE   m.statistic# = n.statistic#
    AND n.name LIKE &#39;lob%&#39;;
 
rem
rem Create a test table
rem
 
DROP TABLE t;
CREATE TABLE t (i NUMBER, c CLOB)
    lob(c) STORE AS (DISABLE STORAGE IN ROW);
 
rem
rem Populate some data
rem
rem This should result in unaligned writes, one for
rem each row/lob populated.
rem

CONNECT pm
SELECT * FROM mylobstats;
INSERT INTO t VALUES (1, &#39;a&#39;);
INSERT INTO t VALUES (2, rpad(&#39;a&#39;,4000,&#39;a&#39;));
COMMIT;
SELECT * FROM mylobstats;
 
rem
rem Get the lob length
rem
rem Computing lob length does not read lob data, no change
rem in read/write stats.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
SELECT LENGTH(c) FROM t;
SELECT * FROM mylobstats;
 
rem
rem Read the lobs
rem
rem Lob reads are performed, one for each lob in the table.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
SELECT * FROM t;
SELECT * FROM mylobstats;
 
rem
rem Read and manipulate the lobs (through temporary lobs)
rem
rem The use of complex operators like &#34;substr()&#34; results in
rem the implicit creation and use of temporary lobs. operations
rem on temporary lobs also update lob statistics.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
SELECT substr(c, length(c), 1) FROM t;
SELECT substr(c, 1, 1) FROM t;
SELECT * FROM mylobstats;
 
rem
rem Perform some aligned overwrites
rem
rem Only lob write statistics are updated because both the
rem byte offset of the write, and the size of the buffer
rem being written are aligned on the lob chunksize.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
DECLARE
    loc     CLOB;
    buf     LONG;
    chunk   NUMBER;
BEGIN
    SELECT c INTO loc FROM t WHERE i = 1
        FOR UPDATE;
 
    chunk := DBMS_LOB.GETCHUNKSIZE(loc);
    buf   := rpad(&#39;b&#39;, chunk, &#39;b&#39;);
 
    -- aligned buffer length and offset
    DBMS_LOB.WRITE(loc, chunk, 1, buf);
    DBMS_LOB.WRITE(loc, chunk, 1+chunk, buf);
    COMMIT;
END;
/
SELECT * FROM mylobstats;
 
rem
rem Perform some unaligned overwrites
rem 
rem Both lob write and lob unaligned write statistics are
rem updated because either one or both of the write byte offset
rem and buffer size are unaligned with the lob&#39;s chunksize.
rem 
 
CONNECT pm;
SELECT * FROM mylobstats;
DECLARE
    loc CLOB;
    buf LONG;
BEGIN
    SELECT c INTO loc FROM t WHERE i = 1
        FOR UPDATE;
 
    buf := rpad(&#39;b&#39;, DBMS_LOB.GETCHUNKSIZE(loc), &#39;b&#39;);
 
    -- unaligned buffer length
    DBMS_LOB.WRITE(loc, DBMS_LOB.GETCHUNKSIZE(loc)-1, 1, buf);
 
    -- unaligned start offset
    DBMS_LOB.WRITE(loc, DBMS_LOB.GETCHUNKSIZE(loc), 2, buf);
 
    -- unaligned buffer length and start offset
    DBMS_LOB.WRITE(loc, DBMS_LOB.GETCHUNKSIZE(loc)-1, 2, buf);
 
    COMMIT;
END;
/
SELECT * FROM mylobstats;
DROP TABLE t;
DROP VIEW mylobstats;
 
CONNECT / AS SYSDBA
REVOKE SELECT_CATALOG_ROLE FROM pm;
REVOKE SELECT ON sys.v_$mystat FROM pm;
REVOKE SELECT ON sys.v_$statname FROM pm;
 
QUIT;
</pre></div>
<!-- class="section" --></div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2782">
<tr>
<td class="cellalignment2794">
<table class="cellalignment2787">
<tr>
<td class="cellalignment2786"><a href="adlob_api_overview.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2786"><a href="part_sql.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2015, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2796">
<table class="cellalignment2785">
<tr>
<td class="cellalignment2786"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2786"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2786"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2786"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2786"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2786"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>