<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104238"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Comparing%20and%20Converging%20Data"></a><title>Comparing and Converging Data</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1044"/>
<meta name="dcterms.created" content="2015-02-12T7:14:20Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Replication Administrator&#39;s Guide"/>
<meta name="dcterms.identifier" content="E53118-02"/>
<meta name="dcterms.isVersionOf" content="STREP"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="man_gen_rep.htm" title="Previous" type="text/html"/>
<link rel="Next" href="man_lcrs.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53118-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">19/28</span> <!-- End Header -->
<div id="STREP146" class="chapter"><a id="BABCCGDE"></a>
<h1 class="chapter"><span class="secnum">13</span> Comparing and Converging Data</h1>
<p><a id="sthref603"></a>This chapter contains instructions for comparing and converging data in database objects at two different databases using the <code dir="ltr">DBMS_COMPARISON</code> package. It also contains instructions for managing comparisons after they are created and for querying data dictionary views to obtain information about comparisons and comparison results.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#BABCAHDB">About Comparing and Converging Data</a></p>
</li>
<li>
<p><a href="#BABCCBBI">Other Documentation About the DBMS_COMPARISON Package</a></p>
</li>
<li>
<p><a href="#CEGIHJFI">Quick Start: A Simple Compare and Converge Scenario</a></p>
</li>
<li>
<p><a href="#CEGBFEBI">Preparing To Compare and Converge a Shared Database Object</a></p>
</li>
<li>
<p><a href="#BABBHAAG">Diverging a Database Object at Two Databases to Complete Examples</a></p>
</li>
<li>
<p><a href="#CEGFBCAG">Comparing a Shared Database Object at Two Databases</a></p>
</li>
<li>
<p><a href="#CEGEECGH">Viewing Information About Comparisons and Comparison Results</a></p>
</li>
<li>
<p><a href="#CEGIABII">Converging a Shared Database Object</a></p>
</li>
<li>
<p><a href="#BABBHCCC">Rechecking the Comparison Results for a Comparison</a></p>
</li>
<li>
<p><a href="#BABDHBFI">Purging Comparison Results</a></p>
</li>
<li>
<p><a href="#BABGDADC">Dropping a Comparison</a></p>
</li>
<li>
<p><a href="#BABHIHIB">Using DBMS_COMPARISON in an Oracle Streams Replication Environment</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">DBMS_COMPARISON</code> package</div>
<a id="BABCAHDB"></a>
<div id="STREP151" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">About Comparing and Converging Data</h2>
<p>The <code dir="ltr">DBMS_COMPARISON</code> package enables you to compare database objects at different databases and identify differences in them. This package also enables you to converge the database objects so that they are consistent at different databases. Typically, this package is used in environments that share a database object at multiple databases. When copies of the same database object exist at multiple databases, the database object is a <span class="bold">shared database object</span>.</p>
<p>Shared database objects might be maintained by data replication. For example, materialized views or Oracle Streams components might replicate the database objects and maintain them at multiple databases. A custom application might also maintain shared database objects. When a database object is shared, it can diverge at the databases that share it. You can use the <code dir="ltr">DBMS_COMPARISON</code> package to identify differences in the shared database objects. After identifying the differences, you can optionally use this package to synchronize the shared database objects.</p>
<p>The <code dir="ltr">DBMS_COMPARISON</code> package can compare the following types of database objects:</p>
<ul>
<li>
<p>Tables</p>
</li>
<li>
<p>Single-table views</p>
</li>
<li>
<p>Materialized views</p>
</li>
<li>
<p>Synonyms for tables, single-table views, and materialized views</p>
</li>
</ul>
<p>Database objects of different types can be compared and converged at different databases. For example, a table at one database and a materialized view at another database can be compared and converged with this package.</p>
<p>You create a comparison between two database objects using the <code dir="ltr">CREATE_COMPARISON</code> procedure in the <code dir="ltr">DBMS_COMPARISON</code> package. After you create a comparison, you can run the comparison at any time using the <code dir="ltr">COMPARE</code> function. When you run the <code dir="ltr">COMPARE</code> function, it records <span class="bold">comparison results</span> in the appropriate data dictionary views. Separate comparison results are generated for each execution of the <code dir="ltr">COMPARE</code> function.</p>
<div id="STREP449" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref604"></a>
<h3 class="sect2">Scans<a id="sthref605"></a></h3>
<p>Each time the <code dir="ltr">COMPARE</code> function is run, one or more new <span class="bold">scan</span>s are performed for the specified comparison. A scan checks for differences in some or all of the rows in a shared database object at a single point in time. The comparison results for a single execution of the <code dir="ltr">COMPARE</code> function can include one or more scans. You can compare database objects multiple times, and a unique scan ID identifies each scan in the comparison results.</p>
</div>
<!-- class="sect2" -->
<div id="STREP450" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref606"></a>
<h3 class="sect2">Buckets<a id="sthref607"></a></h3>
<p>A <span class="bold">bucket</span> is a range of rows in a database object that is being compared. Buckets improve performance by splitting the database object into ranges and comparing the ranges independently. Every comparison divides the rows being compared into an appropriate number of buckets. The number of buckets used depends on the size of the database object and is always less than the maximum number of buckets specified for the comparison by the <code dir="ltr">max_num_buckets</code> parameter in the <code dir="ltr">CREATE_COMPARISON</code> procedure.</p>
<p>When a bucket is compared using the <code dir="ltr">COMPARE</code> function, the following results are possible:</p>
<ul>
<li>
<p>No differences are found. In this case, the comparison proceeds to the next bucket.</p>
</li>
<li>
<p>Differences are found. In this case, the comparison can split the bucket into smaller buckets and compare each smaller bucket. When differences are found in a smaller bucket, the bucket is split into still smaller buckets. This process continues until the minimum number of rows allowed in a bucket is reached. The minimum number of rows in a bucket for a comparison is specified by the <code dir="ltr">min_rows_in_bucket</code> parameter in the <code dir="ltr">CREATE_COMPARISON</code> procedure.</p>
<p>When the minimum number of rows in a bucket is reached, the <code dir="ltr">COMPARE</code> function reports whether there are differences in the bucket. The <code dir="ltr">COMPARE</code> function includes the <code dir="ltr">perform_row_dif</code> parameter. This parameter controls whether the <code dir="ltr">COMPARE</code> function identifies each row difference in a bucket that has differences. When this parameter is set to <code dir="ltr">TRUE</code>, the <code dir="ltr">COMPARE</code> function identifies each row difference. When this parameter is set to <code dir="ltr">FALSE</code>, the <code dir="ltr">COMPARE</code> function does not identify specific row differences. Instead, it only reports that there are differences in the bucket.</p>
</li>
</ul>
<p>You can adjust the <code dir="ltr">max_num_buckets</code> and <code dir="ltr">min_rows_in_bucket</code> parameters in the <code dir="ltr">CREATE_COMPARISON</code> procedure to achieve the best performance when comparing a particular database object. After a comparison is created, you can view the bucket specifications for the comparison by querying the <code dir="ltr">MAX_NUM_BUCKETS</code> and <code dir="ltr">MIN_ROWS_IN_BUCKET</code> columns in the <code dir="ltr">DBA_COMPARISON</code> data dictionary view.</p>
<p>The <code dir="ltr">DBMS_COMPARISON</code> package uses the <code dir="ltr">ORA_HASH</code> function on the specified columns in all the rows in a bucket to compute a hash value for the bucket. If the hash values for two corresponding buckets match, then the contents of the buckets are assumed to match. The <code dir="ltr">ORA_HASH</code> function is an efficient way to compare buckets because row values are not transferred between databases. Instead, only the hash value is transferred.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If an index column for a comparison is a <code dir="ltr">VARCHAR2</code> or <code dir="ltr">CHAR</code> column, then the number of buckets might exceed the value specified for the <code dir="ltr">max_num_buckets</code> parameter.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SQLRF06313" href="../SQLRF/functions136.htm#SQLRF06313"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about the <code dir="ltr">ORA_HASH</code> function</p>
</li>
<li>
<p><a class="olink ARPLS882" href="../ARPLS/d_comparison.htm#ARPLS882"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about index columns</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="STREP451" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref608"></a>
<h3 class="sect2">Parent Scans and Root Scans<a id="sthref609"></a><a id="sthref610"></a></h3>
<p>Each time the <code dir="ltr">COMPARE</code> function splits a bucket into smaller buckets, it performs new scans of the smaller buckets. The scan that analyzes a larger bucket is the <span class="bold">parent scan</span> of each scan that analyzes the smaller buckets into which the larger bucket was split. The <span class="bold">root scan</span> in the comparison results is the highest level parent scan. The root scan does not have a parent. You can identify parent and root scan IDs by querying the <code dir="ltr">DBA_COMPARISON_SCAN</code> data dictionary view.</p>
<p>You can recheck a scan using the <code dir="ltr">RECHECK</code> function, and you can converge a scan using the <code dir="ltr">CONVERGE</code> procedure. When you want to recheck or converge all of the rows in the comparison results, specify the root scan ID for the comparison results in the appropriate subprogram. When you want to recheck or converge a portion of the rows in comparison results, specify the scan ID of the scan that contains the differences.</p>
<p>For example, a scan with differences in 20 buckets is the parent scan for 20 additional scans, if each bucket with differences has more rows than the specified minimum number of rows in a bucket for the comparison. To view the minimum number of rows in a bucket for the comparison, query the <code dir="ltr">MIN_ROWS_IN_BUCKET</code> column in the <code dir="ltr">DBA_COMPARISON</code> data dictionary view.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about the views related to the <code dir="ltr">DBMS_COMPARISON</code> package</div>
</div>
<!-- class="sect2" -->
<div id="STREP452" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref611"></a>
<h3 class="sect2">How Scans and Buckets Identify Differences</h3>
<p>This section describes two different comparison scenarios to show how scans and buckets identify differences in shared database objects. In each scenario, the <code dir="ltr">max_num_buckets</code> parameter is set to <code dir="ltr">3</code> in the <code dir="ltr">CREATE_COMPARISON</code> procedure. Therefore, when the <code dir="ltr">COMPARE</code> or <code dir="ltr">RECHECK</code> function is run for the comparison, the comparison uses a maximum of three buckets in each scan.</p>
<p><a href="#BABDDDCB">Figure 13-1</a> shows the first scenario.</p>
<div id="STREP453" class="figure">
<p class="titleinfigure"><a id="BABDDDCB"></a>Figure 13-1 Comparison with max_num_buckets=3 and Differences in Each Bucket of Each Scan</p>
<img width="662" height="369" src="img/strep063.gif" alt="Description of Figure 13-1 follows"/><br/>
<a id="sthref612" href="img_text/strep063.htm">Description of &#34;Figure 13-1 Comparison with max_num_buckets=3 and Differences in Each Bucket of Each Scan&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#BABDDDCB">Figure 13-1</a> shows a line that represents the rows being compared in the shared database object. This figure illustrates how scans and buckets are used to identify differences when each bucket used by each scan has differences.</p>
<p>With the <code dir="ltr">max_num_buckets</code> parameter set to <code dir="ltr">3</code>, the comparison is executed in the following steps:</p>
<ol>
<li>
<p>The root scan compares all of the rows in the current comparison. The root scan uses three buckets, and differences are found in each bucket.</p>
</li>
<li id="BABHHFAG">
<p>A separate scan is performed on the rows in each bucket that was used by the root scan in the previous step. The current step uses three scans, and each scan uses three buckets. Therefore, this step uses a total of nine buckets. Differences are found in each bucket. In <a href="#BABDDDCB">Figure 13-1</a>, arrows show how each bucket from the root scan is split into three buckets for each of the scans in the current step.</p>
</li>
<li id="BABCGDDE">
<p>A separate scan is performed on the rows in each bucket used by the scans in Step&nbsp;<a href="#BABHHFAG">2</a>. This step uses nine scans, and each scan uses three buckets. Therefore, this step uses a total of 27 buckets. In <a href="#BABDDDCB">Figure 13-1</a>, arrows show how each bucket from Step <a href="#BABHHFAG">2</a> is split into three buckets for each of the scans in the current step.</p>
</li>
</ol>
<p>After Step <a href="#BABCGDDE">3</a>, the comparison results are recorded in the appropriate data dictionary views.</p>
<p><a href="#BABGEGCI">Figure 13-2</a> shows the second scenario.</p>
<div id="STREP454" class="figure">
<p class="titleinfigure"><a id="BABGEGCI"></a>Figure 13-2 Comparison with max_num_buckets=3 and Differences in One Bucket of Each Scan</p>
<img width="665" height="369" src="img/strep064.gif" alt="Description of Figure 13-2 follows"/><br/>
<a id="sthref613" href="img_text/strep064.htm">Description of &#34;Figure 13-2 Comparison with max_num_buckets=3 and Differences in One Bucket of Each Scan&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#BABGEGCI">Figure 13-2</a> shows a line that represents the rows being compared in the shared database object. This figure illustrates how scans and buckets are used to identify differences when only one bucket used by each scan has differences.</p>
<p>With the <code dir="ltr">max_num_buckets</code> parameter set to <code dir="ltr">3</code>, the comparison is executed in the following steps:</p>
<ol>
<li>
<p>The root scan compares all of the rows in the current comparison. The root scan uses three buckets, but differences are found in only one bucket.</p>
</li>
<li id="BABGHBID">
<p>A separate scan is performed on the rows in the one bucket that had differences. This step uses one scan, and the scan uses three buckets. Differences are found in only one bucket. In <a href="#BABGEGCI">Figure 13-2</a>, arrows show how the bucket with differences from the root scan is split into three buckets for the scan in the current step.</p>
</li>
<li id="BABEEAHC">
<p>A separate scan is performed on the rows in the one bucket that had differences in Step <a href="#BABGHBID">2</a>. This step uses one scan, and the scan uses three buckets. In <a href="#BABGEGCI">Figure 13-2</a>, arrows show how the bucket with differences in Step <a href="#BABGHBID">2</a> is split into three buckets for the scan in the current step.</p>
</li>
</ol>
<p>After Step <a href="#BABEEAHC">3</a>, the comparison results are recorded in the appropriate data dictionary views.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
This section describes scenarios in which the <code dir="ltr">max_num_buckets</code> parameter is set to <code dir="ltr">3</code> in the <code dir="ltr">CREATE_COMPARISON</code> procedure. This setting was chosen to illustrate how scans and buckets identify differences. Typically, the <code dir="ltr">max_num_buckets</code> parameter is set to a higher value. The default for this parameter is <code dir="ltr">1000</code>. You can adjust the parameter setting to achieve the best performance.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CEGFBCAG">&#34;Comparing a Shared Database Object at Two Databases&#34;</a></p>
</li>
<li>
<p><a href="#CEGEECGH">&#34;Viewing Information About Comparisons and Comparison Results&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABCCBBI"></a>
<div id="STREP455" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Other Documentation About the DBMS_COMPARISON Package</h2>
<p>The chapter about the <code dir="ltr">DBMS_COMPARISON</code> package in the <a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> contains advanced conceptual information about the package and detailed information about the subprograms in the package, including:</p>
<ul>
<li>
<p>Requirements for using the package</p>
</li>
<li>
<p>Descriptions of constants used in the package</p>
</li>
<li>
<p>Descriptions of each subprogram in the package and its parameters</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CEGIHJFI"></a>
<div id="STREP655" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Quick Start: A Simple Compare and Converge Scenario</h2>
<p>This section describes a simple scenario that compares and converges the <code dir="ltr">hr.departments</code> table. This section is designed to get you started with using the <code dir="ltr">DBMS_COMPARISON</code> package by illustrating how to compare and converge a single table.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#CEGIAAII">Tutorial: Preparing to Compare and Converge Data</a></p>
</li>
<li>
<p><a href="#CEGJEEAF">Tutorial: Comparing Data in Two Different Databases</a></p>
</li>
<li>
<p><a href="#CEGFIBFJ">Tutorial: Converging Divergent Data</a></p>
</li>
</ul>
<a id="CEGIAAII"></a>
<div id="STREP656" class="sect2">
<h3 class="sect2">Tutorial: Preparing to Compare and Converge Data</h3>
<p>Suppose you share the <code dir="ltr">hr.departments</code> table in two databases. You want to compare this table at these databases to see if their data is consistent. If the tables have diverged at the two databases, then you want to converge them to make them consistent.</p>
<p>Meet the following prerequisites to complete this tutorial:</p>
<ul>
<li>
<p>Configure network connectivity so that the two databases can communicate with each other. See <a class="olink ADMQS004" href="../ADMQS/GUID-C6DD213A-D37E-4905-983D-F9DCA8AE286A.htm#ADMQS004"><span class="italic">Oracle Database 2 Day DBA</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Ensure that the <code dir="ltr">hr</code> sample schema is installed on both databases. The <code dir="ltr">hr</code> sample schema is installed by default with Oracle Database.</p>
</li>
</ul>
<p>In this example, the global names of the databases are <code dir="ltr">ii1.example.com</code> and <code dir="ltr">ii2.example.com</code>, but you can substitute any two databases in your environment that meet the prerequisites.</p>
<p class="orderedlisttitle">To prepare for comparison and convergence of the hr.departments table at the ii1.example.com and ii2.example.com databases:&nbsp;</p>
<ol>
<li id="CEGGDAAD">
<p>For the purposes of this example, make the <code dir="ltr">hr.departments</code> table diverge at the two databases:</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the <code dir="ltr">ii2.example.com</code> database as <code dir="ltr">hr</code> user.</p>
<p>See <a class="olink ADMQS0361" href="../ADMQS/GUID-DE8A79BD-FAE4-4364-98FF-D2BD992A06E7.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Delete the department in the <code dir="ltr">hr.departments</code> table with the <code dir="ltr">department_id</code> equal to&nbsp;<code dir="ltr">270</code>:</p>
<pre dir="ltr">DELETE FROM hr.departments WHERE department_id=270;
COMMIT;
</pre></li>
<li>
<p>Modify the data in a row in the <code dir="ltr">hr.departments</code> table:</p>
<pre dir="ltr">UPDATE hr.departments SET manager_id=114 WHERE department_id=10;
COMMIT;
</pre></li>
<li>
<p>Insert a row into the <code dir="ltr">hr.departments</code> table:</p>
<pre dir="ltr">INSERT INTO hr.departments VALUES(280, &#39;Bean Counters&#39;, 108, 2700);
COMMIT;
</pre></li>
<li>
<p>Exit SQL*Plus:</p>
<pre dir="ltr">EXIT;
</pre></li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
Usually, Step <a href="#CEGGDAAD">1</a> is not required. It is included in this example to ensure that the <code dir="ltr">hr.departments</code> table diverges at the two databases.</div>
</li>
<li>
<p>Create a database link from the <code dir="ltr">ii1.example.com</code> database to the <code dir="ltr">ii2.example.com</code> database.</p>
<p>The database link should connect from an administrative user in <code dir="ltr">ii1.example.com</code> to an administrative user schema in <code dir="ltr">ii2.example.com</code>. The administrative user at both databases should have the necessary privileges to access and modify the <code dir="ltr">hr.departments</code> table and the necessary privileges to run subprograms in the <code dir="ltr">DBMS_COMPARISON</code> package. If you are not sure which user has these privileges, then use <code dir="ltr">SYSTEM</code> user. Also, both the name and the service name of the database link must be <code dir="ltr">ii2.example.com</code>. See <a href="prep_rep.htm#BABDCFHC">&#34;Configuring Network Connectivity and Database Links&#34;</a> for more information.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information about the <code dir="ltr">DBMS_COMPARISON</code> package</div>
</div>
<!-- class="sect2" -->
<a id="CEGJEEAF"></a>
<div id="STREP657" class="sect2">
<h3 class="sect2">Tutorial: Comparing Data in Two Different Databases<a id="sthref615"></a><a id="sthref616"></a><a id="sthref617"></a><a id="sthref618"></a></h3>
<p>This example continues the scenario described in <a href="#CEGIAAII">&#34;Tutorial: Preparing to Compare and Converge Data&#34;</a>. Complete the steps in that topic before continuing.</p>
<p>You can use the <code dir="ltr">CREATE_COMPARISON</code> procedure in the <code dir="ltr">DBMS_COMPARISON</code> package to define a comparison of a shared database object at two different databases. Once the comparison is defined, you can use the <code dir="ltr">COMPARE</code> function in this package to compare the database object specified in the comparison at the current point in time. You can run the <code dir="ltr">COMPARE</code> function multiple times for a specific comparison. Each time you run the function, it results one or more scans of the database objects, and each scan has its own scan ID.</p>
<p class="orderedlisttitle">To compare the entire hr.departments table at the ii1.example.com and ii2.example.com databases:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the <code dir="ltr">ii1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGIAAII">&#34;Tutorial: Preparing to Compare and Converge Data&#34;</a>. For example, if <code dir="ltr">SYSTEM</code> user owns the database link, then connect as <code dir="ltr">SYSTEM</code> user:</p>
<pre dir="ltr">sqlplus system@ii1.example.com
Enter password: <span class="italic">password</span>
</pre>
<p>See <a class="olink ADMQS0361" href="../ADMQS/GUID-DE8A79BD-FAE4-4364-98FF-D2BD992A06E7.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li id="CEGIDDJJ">
<p>Run the <code dir="ltr">CREATE_COMPARISON</code> procedure to create the comparison for the <code dir="ltr">hr.departments</code> table:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name =&gt; &#39;compare_departments&#39;,
    schema_name     =&gt; &#39;hr&#39;,
    object_name     =&gt; &#39;departments&#39;,
    dblink_name     =&gt; &#39;ii2.example.com&#39;);
END;
/
</pre>
<p>Note that the name of the new comparison is <code dir="ltr">compare_departments</code>. This comparison is owned by the user who runs the <code dir="ltr">CREATE_COMPARISON</code> procedure.</p>
</li>
<li id="CEGEFEFB">
<p>Run the <code dir="ltr">COMPARE</code> function to compare the <code dir="ltr">hr.departments</code> table at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; &#39;compare_departments&#39;,
                  scan_info       =&gt; scan_info,
                  perform_row_dif =&gt; TRUE);
  DBMS_OUTPUT.PUT_LINE(&#39;Scan ID: &#39;||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/

<span class="bold">Scan ID: 1</span>
<span class="bold">Differences were found.</span>
 
<span class="bold">PL/SQL procedure successfully completed.</span>
</pre>
<p>Specify the name of the comparison created in Step <a href="#CEGIDDJJ">2</a> for the <code dir="ltr">comparison_name</code> parameter.</p>
<p>The function prints the scan ID for the comparison. The scan ID is important when you are querying data dictionary views for information about the comparison and when you are converging the database objects.</p>
<p>The function also prints whether differences were found in the table at the two databases:</p>
<ul>
<li>
<p>If the function prints <code dir="ltr">&#39;No differences were found&#39;</code>, then the table is consistent at the two databases.</p>
</li>
<li>
<p>If the function prints <code dir="ltr">&#39;Differences were found&#39;</code>, then the table has diverged at the two databases.</p>
</li>
</ul>
</li>
<li id="CEGFHEEA">
<p>Make a note of the scan ID returned by the function in the previous step. In this example, assume the scan ID is <code dir="ltr">1</code>.</p>
</li>
<li>
<p><a id="sthref620"></a><a id="sthref621"></a>If differences were found in Step <a href="#CEGEFEFB">3</a>, then run the following query to show the number of differences found:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison Owner&#39; FORMAT A16
COLUMN COMPARISON_NAME HEADING &#39;Comparison Name&#39; FORMAT A20
COLUMN SCHEMA_NAME HEADING &#39;Schema Name&#39; FORMAT A11
COLUMN OBJECT_NAME HEADING &#39;Object Name&#39; FORMAT A11
COLUMN CURRENT_DIF_COUNT HEADING &#39;Differences&#39; FORMAT 9999999
 
SELECT c.OWNER, 
       c.COMPARISON_NAME, 
       c.SCHEMA_NAME, 
       c.OBJECT_NAME, 
       s.CURRENT_DIF_COUNT 
  FROM DBA_COMPARISON c, DBA_COMPARISON_SCAN s
  WHERE c.COMPARISON_NAME = s.COMPARISON_NAME AND
        c.OWNER           = s.OWNER AND
        s.SCAN_ID         = 1;
</pre>
<p>Specify the scan ID you recorded in Step <a href="#CEGFHEEA">4</a> in the <code dir="ltr">WHERE</code> clause of the query.</p>
<p>The output will be similar to the following:</p>
<pre dir="ltr"><span class="bold">Comparison Owner Comparison Name      Schema Name Object Name Differences</span>
<span class="bold">---------------- -------------------- ----------- ----------- -----------</span>
<span class="bold">SYSTEM           COMPARE_DEPARTMENTS  HR          DEPARTMENTS           3</span>
</pre></li>
<li>
<p><a id="sthref622"></a><a id="sthref623"></a><a id="sthref624"></a>To see which rows were different in the database object being compared, run the following query:</p>
<pre dir="ltr">COLUMN COLUMN_NAME HEADING &#39;Index Column&#39; FORMAT A15
COLUMN INDEX_VALUE HEADING &#39;Index Value&#39; FORMAT A15
COLUMN LOCAL_ROWID HEADING &#39;Local Row Exists?&#39; FORMAT A20
COLUMN REMOTE_ROWID HEADING &#39;Remote Row Exists?&#39; FORMAT A20
 
SELECT c.COLUMN_NAME,
       r.INDEX_VALUE, 
       DECODE(r.LOCAL_ROWID,
                NULL, &#39;No&#39;,
                      &#39;Yes&#39;) LOCAL_ROWID,
       DECODE(r.REMOTE_ROWID,
                NULL, &#39;No&#39;,
                      &#39;Yes&#39;) REMOTE_ROWID
  FROM DBA_COMPARISON_COLUMNS c,
       DBA_COMPARISON_ROW_DIF r,
       DBA_COMPARISON_SCAN s
  WHERE c.COMPARISON_NAME = &#39;COMPARE_DEPARTMENTS&#39; AND
        r.SCAN_ID         = s.SCAN_ID AND
        s.PARENT_SCAN_ID  = 1 AND
        r.STATUS          = &#39;DIF&#39; AND
        c.INDEX_COLUMN    = &#39;Y&#39; AND
        c.COMPARISON_NAME = r.COMPARISON_NAME AND
        c.OWNER           = r.OWNER
  ORDER BY r.INDEX_VALUE;
</pre>
<p>In the <code dir="ltr">WHERE</code> clause, specify the name of the comparison and the scan ID for the comparison. In this example, the name of the comparison is <code dir="ltr">compare_departments</code> and the scan ID is <code dir="ltr">1</code>.</p>
<p>The output will be similar to the following:</p>
<pre dir="ltr"><span class="bold">Index Column    Index Value     Local Row Exists?    Remote Row Exists?</span>
<span class="bold">--------------- --------------- -------------------- --------------------</span>
<span class="bold">DEPARTMENT_ID   10              Yes                  Yes</span>
<span class="bold">DEPARTMENT_ID   270             Yes                  No</span>
<span class="bold">DEPARTMENT_ID   280             No                   Yes</span>
</pre>
<p>This output shows the index column for the table being compared and the index value for each row that is different in the shared database object. In this example, the index column is the primary key column for the <code dir="ltr">hr.departments</code> table (<code dir="ltr">department_id</code>). The output also shows the type of difference for each row:</p>
<ul>
<li>
<p>If <code dir="ltr">Local</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> and <code dir="ltr">Remote</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> are both <code dir="ltr">Yes</code> for a row, then the row exists in both instances of the database object, but the data in the row is different.</p>
</li>
<li>
<p>If <code dir="ltr">Local</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">Yes</code> and <code dir="ltr">Remote</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">No</code> for a row, then the row exists in the local database object but not in the remote database object.</p>
</li>
<li>
<p>If <code dir="ltr">Local</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">No</code> and <code dir="ltr">Remote</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">Yes</code> for a row, then the row exists in the remote database object but not in the local database object.</p>
</li>
</ul>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information about the <code dir="ltr">DBMS_COMPARISON</code> package</div>
</div>
<!-- class="sect2" -->
<a id="CEGFIBFJ"></a>
<div id="STREP658" class="sect2">
<h3 class="sect2">Tutorial: Converging Divergent Data<a id="sthref625"></a><a id="sthref626"></a><a id="sthref627"></a></h3>
<p>This example continues the scenario described in <a href="#CEGJEEAF">&#34;Tutorial: Comparing Data in Two Different Databases&#34;</a>. Complete the steps in that topic before continuing.</p>
<p>When a shared database object has diverged at two different databases, you can use the <code dir="ltr">CONVERGE</code> procedure in the <code dir="ltr">DBMS_COMPARISON</code> package to converge the two instances of the database object. After the <code dir="ltr">CONVERGE</code> procedure runs successfully, the shared database object is consistent at the two databases. To run the <code dir="ltr">CONVERGE</code> procedure, you must specify the following information:</p>
<ul>
<li>
<p>The name of an existing comparison created using the <code dir="ltr">CREATE_COMPARISON</code> procedure in the <code dir="ltr">DBMS_COMPARISON</code> package</p>
</li>
<li>
<p>The scan ID of the comparison that you want to converge</p>
</li>
</ul>
<p>The scan ID contains information about the differences that will be converged. In this example, the name of the comparison is <code dir="ltr">compare_departments</code> and the scan ID is&nbsp;<code dir="ltr">1</code>.</p>
<p>Also, when you run the <code dir="ltr">CONVERGE</code> procedure, you must specify which database &#34;wins&#34; when the shared database object is converged. If you specify that the local database wins, then the data in the database object at the local database replaces the data in the database object at the remote database when the data is different. If you specify that the remote database wins, then the data in the database object at the remote database replaces the data in the database object at the local database when the data is different. In this example, the local database <code dir="ltr">ii1.example.com</code> wins.</p>
<p class="orderedlisttitle">To converge divergent data in the hr.departments table at the ii1.example.com and ii2.example.com databases:&nbsp;</p>
<ol>
<li>
<p>On a command line, open SQL*Plus and connect to the <code dir="ltr">ii1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGIAAII">&#34;Tutorial: Preparing to Compare and Converge Data&#34;</a>. For example, if the <code dir="ltr">SYSTEM</code> user owns the database link, then connect as the <code dir="ltr">SYSTEM</code> user:</p>
<pre dir="ltr">sqlplus system@ii1.example.com
Enter password: <span class="italic">password</span>
</pre>
<p>See <a class="olink ADMQS0361" href="../ADMQS/GUID-DE8A79BD-FAE4-4364-98FF-D2BD992A06E7.htm#ADMQS0361"><span class="italic">Oracle Database 2 Day DBA</span></a> for more information about starting SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">CONVERGE</code> procedure to converge the <code dir="ltr">hr.departments</code> table at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  DBMS_COMPARISON.CONVERGE(
    comparison_name  =&gt; &#39;compare_departments&#39;,
    scan_id          =&gt; 1,
    scan_info        =&gt; scan_info,
    converge_options =&gt; DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS);
  DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Merged: &#39;||scan_info.loc_rows_merged);
  DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Merged: &#39;||scan_info.rmt_rows_merged);
  DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Deleted: &#39;||scan_info.loc_rows_deleted);
  DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Deleted: &#39;||scan_info.rmt_rows_deleted);
END;
/

<span class="bold">Local Rows Merged: 0</span>
<span class="bold">Remote Rows Merged: 2</span>
<span class="bold">Local Rows Deleted: 0</span>
<span class="bold">Remote Rows Deleted: 1</span>

<span class="bold">PL/SQL procedure successfully completed.</span>
</pre></li>
</ol>
<p>The <code dir="ltr">CONVERGE</code> procedure synchronizes the portion of the database object compared by the specified scan and returns information about the changes it made. Some scans might compare a subset of the database object. In this example, the specified scan compared the entire table. So, the entire table is synchronized, assuming no new differences appeared after the comparison scan completed.</p>
<p>The local table wins in this example because the <code dir="ltr">converge_options</code> parameter is set to <code dir="ltr">DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS</code> in the procedure. That is, for the rows that are different in the two databases, the rows at the local database replace the corresponding rows at the remote database. If some rows exist at the remote database but not at the local database, then the extra rows at the remote database are deleted. If instead you want the remote database to win, then set the <code dir="ltr">converge_options</code> parameter to <code dir="ltr">DBMS_COMPARISON.CMP_CONVERGE_REMOTE_WINS</code> in the procedure.</p>
<p><a id="sthref629"></a><a id="sthref630"></a>In addition, if you run the <code dir="ltr">CONVERGE</code> procedure on a shared database object that is part of an Oracle Streams replication environment, then you might not want the changes made by the procedure to be replicated to other databases. In this case, you can set the following parameters in the <code dir="ltr">CONVERGE</code> procedure to values that will prevent the changes from being replicated:</p>
<ul>
<li>
<p><code dir="ltr">local_converge_tag</code></p>
</li>
<li>
<p><code dir="ltr">remote_converge_tag</code></p>
</li>
</ul>
<p>When one of these parameters is set to a non-<code dir="ltr">NULL</code> value, a tag is set in the session that makes the changes during convergence. The <code dir="ltr">local_converge_tag</code> parameter sets the tag in the session at the local database, while the <code dir="ltr">remote_converge_tag</code> parameter sets the tag in the session at the remote database. If you do not want the changes made by the <code dir="ltr">CONVERGE</code> procedure to be replicated, then set these parameters to a value that will prevent Oracle Streams capture processes and synchronous captures from capturing the changes.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information about the <code dir="ltr">DBMS_COMPARISON</code> package</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CEGBFEBI"></a>
<div id="STREP456" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Preparing To Compare and Converge a Shared Database Object<a id="sthref631"></a></h2>
<p>Meet the following prerequisites before comparing and converging a shared database object at two databases:</p>
<ul>
<li>
<p>Configure network connectivity so that the two databases can communicate with each other. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for information about configuring network connectivity between databases.</p>
</li>
<li>
<p>Identify or create a database user who will create, run, and manage comparisons. The database user must meet the privilege requirements described in the documentation for the <code dir="ltr">DBMS_COMPARISON</code> package in the <a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a>.</p>
<p>After you identify or create a user with the required privileges, create a database link from the database that will run the subprograms in the <code dir="ltr">DBMS_COMPARISON</code> package to the other database that shares the database object. The identified user should own the database link, and the link should connect to a user with the required privileges on the remote database.</p>
<p>For example, the following example creates a database link owned by a user named <code dir="ltr">admin</code> at the <code dir="ltr">comp1.example.com</code> database that connects to the <code dir="ltr">admin</code> user at the remote database <code dir="ltr">comp2.example.com</code>:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the local database as <code dir="ltr">admin</code> user.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create the database link:</p>
<pre dir="ltr">CREATE DATABASE LINK comp2.example.com CONNECT TO admin
   IDENTIFIED BY <span class="italic">password</span> USING &#39;comp2.example.com&#39;;
</pre></li>
</ol>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="BABBHAAG"></a>
<div id="STREP457" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Diverging a Database Object at Two Databases to Complete Examples</h2>
<p>The following sections contain examples that compare and converge a shared database object at two databases:</p>
<ul>
<li>
<p><a href="#CEGFBCAG">&#34;Comparing a Shared Database Object at Two Databases&#34;</a></p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a></p>
</li>
</ul>
<p>Most of these examples compare and converge data in the <code dir="ltr">oe.orders</code> table. This table is part of the <code dir="ltr">oe</code> sample schema that is installed by default with Oracle Database. In these examples, the global names of the databases are <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code>, but you can substitute any two databases in your environment that meet the prerequisites described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>For the purposes of the examples, make the <code dir="ltr">oe.orders</code> table diverge at two databases by completing the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp2.example.com</code> database as <code dir="ltr">oe</code> user.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Delete the orders in the <code dir="ltr">oe.orders</code> table with a <code dir="ltr">customer_id</code> equal to <code dir="ltr">147</code>:</p>
<pre dir="ltr">DELETE FROM oe.orders WHERE customer_id=147;
</pre></li>
<li>
<p>Modify the data in a row in the <code dir="ltr">oe.orders</code> table:</p>
<pre dir="ltr">UPDATE oe.orders SET sales_rep_id=163 WHERE order_id=2440;
</pre></li>
<li>
<p>Insert a row into the <code dir="ltr">oe.orders</code> table:</p>
<pre dir="ltr">INSERT INTO oe.orders VALUES(3000, TIMESTAMP &#39;2006-01-01 2:00:00&#39;, &#39;direct&#39;, 107, 3, 16285.21, 156, NULL);
</pre></li>
<li>
<p>Commit your changes and exit SQL*Plus:</p>
<pre dir="ltr">COMMIT;
EXIT
</pre></li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
Usually, these steps are not required. They are included to ensure that the <code dir="ltr">oe.orders</code> table diverges at the two databases.</div>
</div>
<!-- class="sect1" -->
<a id="CEGFBCAG"></a>
<div id="STREP458" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Comparing a Shared Database Object at Two Databases<a id="sthref632"></a><a id="sthref633"></a><a id="sthref634"></a><a id="sthref635"></a><a id="sthref636"></a></h2>
<p>The examples in this section use the <code dir="ltr">DBMS_COMPARISON</code> package to compare the <code dir="ltr">oe.orders</code> table at the <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code> databases. The examples use the package to create different types of comparisons and compare the tables with the comparisons.</p>
<p>This section contains the following examples:</p>
<ul>
<li>
<p><a href="#CEGIDBBE">Comparing a Subset of Columns in a Shared Database Object</a></p>
</li>
<li>
<p><a href="#CEGEIFAH">Comparing a Shared Database Object without Identifying Row Differences</a></p>
</li>
<li>
<p><a href="#CEGIJHJB">Comparing a Random Portion of a Shared Database Object</a></p>
</li>
<li>
<p><a href="#CEGDBBHA">Comparing a Shared Database Object Cyclically</a></p>
</li>
<li>
<p><a href="#CEGCAIDB">Comparing a Custom Portion of a Shared Database Object</a></p>
</li>
<li>
<p><a href="#BABBJDDA">Comparing a Shared Database Object That Contains CLOB or BLOB Columns</a></p>
</li>
</ul>
<a id="CEGIDBBE"></a>
<div id="STREP459" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Comparing a Subset of Columns in a Shared Database Object<a id="sthref637"></a><a id="sthref638"></a></h3>
<p>The <code dir="ltr">column_list</code> parameter in the <code dir="ltr">CREATE_COMPARISON</code> procedure enables you to compare a subset of the columns in a database object. The following are reasons to compare a subset of columns:</p>
<ul>
<li>
<p>A database object contains extra columns that do not exist in the database object to which it is being compared. In this case, the <code dir="ltr">column_list</code> parameter must only contain the columns that exist in both database objects.</p>
</li>
<li>
<p>You want to focus a comparison on a specific set of columns. For example, if a table contains hundreds of columns, then you might want to list specific columns in the <code dir="ltr">column_list</code> parameter to make the comparison more efficient.</p>
</li>
<li>
<p>Differences are expected in some columns. In this case, exclude the columns in which differences are expected from the <code dir="ltr">column_list</code> parameter.</p>
</li>
</ul>
<p>The columns in the column list must meet the following requirements:</p>
<ul>
<li>
<p>The column list must meet the index column requirements for the <code dir="ltr">DBMS_COMPARISON</code> package. See <a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about index column requirements.</p>
</li>
<li>
<p>If you plan to use the <code dir="ltr">CONVERGE</code> procedure to make changes to a database object based on comparison results, then you must include in the column list any column in this database object that has a <code dir="ltr">NOT</code> <code dir="ltr">NULL</code> constraint but no default value.</p>
</li>
</ul>
<p>This example compares the <code dir="ltr">order_id</code>, <code dir="ltr">order_date</code>, and <code dir="ltr">customer_id</code> columns in the <code dir="ltr">oe.orders</code> table at the <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code> databases:</p>
<ol>
<li>
<p>Complete the tasks described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a> and <a href="#BABBHAAG">&#34;Diverging a Database Object at Two Databases to Complete Examples&#34;</a>.</p>
</li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">CREATE_COMPARISON</code> procedure to create the comparison:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name =&gt; &#39;compare_subset_columns&#39;,
    schema_name     =&gt; &#39;oe&#39;,
    object_name     =&gt; &#39;orders&#39;,
    dblink_name     =&gt; &#39;comp2.example.com&#39;,
    column_list     =&gt; &#39;order_id,order_date,customer_id&#39;);
END;
/
</pre>
<p>Note that the name of the new comparison is <code dir="ltr">compare_subset_columns</code>. This comparison is owned by the user who runs the <code dir="ltr">CREATE_COMPARISON</code> procedure.</p>
</li>
<li>
<p>Run the <code dir="ltr">COMPARE</code> function to compare the <code dir="ltr">oe.orders</code> table at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; &#39;compare_subset_columns&#39;,
                  scan_info       =&gt; scan_info,
                  perform_row_dif =&gt; TRUE);
  DBMS_OUTPUT.PUT_LINE(&#39;Scan ID: &#39;||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/
</pre>
<p>Notice that the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">TRUE</code> in the <code dir="ltr">COMPARE</code> function. This setting instructs the <code dir="ltr">COMPARE</code> function to identify each individual row difference in the tables. When the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">FALSE</code>, the <code dir="ltr">COMPARE</code> function records whether there are differences in the tables, but does not record each individual row difference.</p>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Scan ID: 1
Differences were found.

PL/SQL procedure successfully completed.
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABFJAHB">&#34;Viewing Detailed Information About the Row Differences Found in a Scan&#34;</a></p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a> to converge the differences found in the comparison results</p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a> to recheck the comparison results</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CEGEIFAH"></a>
<div id="STREP460" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Comparing a Shared Database Object without Identifying Row Differences<a id="sthref639"></a></h3>
<p>When you run the <code dir="ltr">COMPARE</code> procedure for an existing comparison, the <code dir="ltr">perform_row_dif</code> parameter controls whether the <code dir="ltr">COMPARE</code> procedure identifies each individual row difference in the database objects:</p>
<ul>
<li>
<p>When the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">TRUE</code>, the <code dir="ltr">COMPARE</code> procedure records whether there are differences in the database objects, and it records each individual row difference. Set this parameter to <code dir="ltr">TRUE</code> when you must identify each difference in the database objects.</p>
</li>
<li>
<p>When the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">FALSE</code>, the <code dir="ltr">COMPARE</code> procedure records whether there are differences in the database objects, but does not record each individual row difference. Set this parameter to <code dir="ltr">FALSE</code> when you want to know if there are differences in the database objects, but you do not need to identify each individual difference. Setting this parameter to <code dir="ltr">FALSE</code> is the most efficient way to perform a comparison.</p>
</li>
</ul>
<p>See <a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code dir="ltr">perform_row_dif</code> parameter in the <code dir="ltr">COMPARE</code> function.</p>
<p>This example compares the entire <code dir="ltr">oe.orders</code> table at the <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code> databases without identifying individual row differences:</p>
<ol>
<li>
<p>Complete the tasks described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a> and <a href="#BABBHAAG">&#34;Diverging a Database Object at Two Databases to Complete Examples&#34;</a>.</p>
</li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">CREATE_COMPARISON</code> procedure to create the comparison:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name =&gt; &#39;compare_orders&#39;,
    schema_name     =&gt; &#39;oe&#39;,
    object_name     =&gt; &#39;orders&#39;,
    dblink_name     =&gt; &#39;comp2.example.com&#39;);
END;
/
</pre></li>
<li>
<p>Run the <code dir="ltr">COMPARE</code> function to compare the <code dir="ltr">oe.orders</code> table at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; &#39;compare_orders&#39;,
                  scan_info       =&gt; scan_info,
                  perform_row_dif =&gt; FALSE);
  DBMS_OUTPUT.PUT_LINE(&#39;Scan ID: &#39;||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/
</pre>
<p>Notice that the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">FALSE</code> in the <code dir="ltr">COMPARE</code> function.</p>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Scan ID: 4
Differences were found.

PL/SQL procedure successfully completed.
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABFJAHB">&#34;Viewing Detailed Information About the Row Differences Found in a Scan&#34;</a></p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a> to converge the differences found in the comparison results</p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a> to recheck the comparison results</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CEGIJHJB"></a>
<div id="STREP461" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Comparing a Random Portion of a Shared Database Object<a id="sthref640"></a><a id="sthref641"></a></h3>
<p>The <code dir="ltr">scan_percent</code> and <code dir="ltr">scan_mode</code> parameters in the <code dir="ltr">CREATE_COMPARISON</code> procedure enable you to compare a random portion of a shared database object instead of the entire database object. Typically, you use this option under the following conditions:</p>
<ul>
<li>
<p>You are comparing a relatively large shared database object, and you want to determine whether there might be differences without devoting the resources and time to comparing the entire database object.</p>
</li>
<li>
<p>You do not intend to use subsequent comparisons to compare different portions of the database object. If you want to compare different portions of the database object in subsequent comparisons, then see <a href="#CEGDBBHA">&#34;Comparing a Shared Database Object Cyclically&#34;</a> for instructions.</p>
</li>
</ul>
<p>This example compares a random portion of the <code dir="ltr">oe.orders</code> table at the <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code> databases:</p>
<ol>
<li>
<p>Complete the tasks described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a> and <a href="#BABBHAAG">&#34;Diverging a Database Object at Two Databases to Complete Examples&#34;</a>.</p>
</li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">CREATE_COMPARISON</code> procedure to create the comparison:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name =&gt; &#39;compare_random&#39;,
    schema_name     =&gt; &#39;oe&#39;,
    object_name     =&gt; &#39;orders&#39;,
    dblink_name     =&gt; &#39;comp2.example.com&#39;,
    scan_mode       =&gt;  DBMS_COMPARISON.CMP_SCAN_MODE_RANDOM,
    scan_percent    =&gt;  50);
END;
/
</pre>
<p>Notice that the <code dir="ltr">scan_percent</code> parameter is set to <code dir="ltr">50</code> to specify that the comparison scans half of the table. The <code dir="ltr">scan_mode</code> parameter is set to <code dir="ltr">DBMS_COMPARISON.CMP_SCAN_MODE_RANDOM</code> to specify that the comparison compares random rows in the table.</p>
</li>
<li>
<p>Run the <code dir="ltr">COMPARE</code> function to compare the <code dir="ltr">oe.orders</code> table at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; &#39;compare_random&#39;,
                  scan_info       =&gt; scan_info,
                  perform_row_dif =&gt; TRUE);
  DBMS_OUTPUT.PUT_LINE(&#39;Scan ID: &#39;||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/
</pre>
<p>Notice that the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">TRUE</code> in the <code dir="ltr">COMPARE</code> function. This setting instructs the <code dir="ltr">COMPARE</code> function to identify each individual row difference in the tables. When the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">FALSE</code>, the <code dir="ltr">COMPARE</code> function records whether there are differences in the tables, but does not record each individual row difference.</p>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Scan ID: 7
Differences were found.

PL/SQL procedure successfully completed.
</pre>
<p>This comparison scan might or might not find differences, depending on the portion of the table that is compared.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABFJAHB">&#34;Viewing Detailed Information About the Row Differences Found in a Scan&#34;</a></p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a> to converge the differences found in the comparison results</p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a> to recheck the comparison results</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CEGDBBHA"></a>
<div id="STREP462" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Comparing a Shared Database Object Cyclically<a id="sthref642"></a><a id="sthref643"></a></h3>
<p>The <code dir="ltr">scan_percent</code> and <code dir="ltr">scan_mode</code> parameters in the <code dir="ltr">CREATE_COMPARISON</code> procedure enable you to compare a portion of a shared database object cyclically. A cyclic comparison scans a portion of the database object being compared during a single comparison. When the database object is compared again, another portion of the database object is compared, starting where the last comparison ended.</p>
<p>Typically, you use this option under the following conditions:</p>
<ul>
<li>
<p>You are comparing a relatively large shared database object, and you want to determine whether there might be differences without devoting the resources and time to comparing the entire database object.</p>
</li>
<li>
<p>You want each comparison to compare a different portion of the shared database object, so that the entire database object is compared with the appropriate number of scans. For example, if you compare 25% of the shared database object, then the entire database object is compared after four comparisons. If you do not want to compare different portions of the database object in subsequent comparisons, see <a href="#CEGIJHJB">&#34;Comparing a Random Portion of a Shared Database Object&#34;</a> for instructions.</p>
</li>
</ul>
<p>This example compares <code dir="ltr">oe.orders</code> table cyclically at the <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code> databases:</p>
<ol>
<li>
<p>Complete the tasks described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a> and <a href="#BABBHAAG">&#34;Diverging a Database Object at Two Databases to Complete Examples&#34;</a>.</p>
</li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li id="BABJBBJE">
<p>Run the <code dir="ltr">CREATE_COMPARISON</code> procedure to create the comparison:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name =&gt; &#39;compare_cyclic&#39;,
    schema_name     =&gt; &#39;oe&#39;,
    object_name     =&gt; &#39;orders&#39;,
    dblink_name     =&gt; &#39;comp2.example.com&#39;,
    scan_mode       =&gt;  DBMS_COMPARISON.CMP_SCAN_MODE_CYCLIC,
    scan_percent    =&gt;  50);
END;
/
</pre>
<p>Notice that the <code dir="ltr">scan_percent</code> parameter is set to <code dir="ltr">50</code> to specify that the comparison scans half of the table. The <code dir="ltr">scan_mode</code> parameter is set to <code dir="ltr">DBMS_COMPARISON.CMP_SCAN_MODE_CYCLIC</code> to specify that the comparison compares rows in the table cyclically.</p>
</li>
<li id="BABJFBGH">
<p>Run the <code dir="ltr">COMPARE</code> function to compare the <code dir="ltr">oe.orders</code> table at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; &#39;compare_cyclic&#39;,
                  scan_info       =&gt; scan_info,
                  perform_row_dif =&gt; TRUE);
  DBMS_OUTPUT.PUT_LINE(&#39;Scan ID: &#39;||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/
</pre>
<p>Notice that the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">TRUE</code> in the <code dir="ltr">COMPARE</code> function. This setting instructs the <code dir="ltr">COMPARE</code> function to identify each individual row difference in the tables. When the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">FALSE</code>, the <code dir="ltr">COMPARE</code> function records whether there are differences in the tables, but does not record each individual row difference.</p>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Scan ID: 8
Differences were found.

PL/SQL procedure successfully completed.
</pre>
<p>This comparison scan might or might not find differences, depending on the portion of the table that is compared.</p>
</li>
<li>
<p>To compare the next portion of the database object, starting where the last comparison ended, rerun the <code dir="ltr">COMPARE</code> function that was run in Step <a href="#BABJFBGH">4</a>. In this example, running the <code dir="ltr">COMPARE</code> function twice compares the entire database object because the <code dir="ltr">scan_percent</code> parameter was set to <code dir="ltr">50</code> in Step <a href="#BABJBBJE">3</a>.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABFJAHB">&#34;Viewing Detailed Information About the Row Differences Found in a Scan&#34;</a></p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a> to converge the differences found in the comparison results</p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a> to recheck the comparison results</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CEGCAIDB"></a>
<div id="STREP463" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Comparing a Custom Portion of a Shared Database Object<a id="sthref644"></a><a id="sthref645"></a></h3>
<p>The <code dir="ltr">scan_mode</code> parameter in the <code dir="ltr">CREATE_COMPARISON</code> procedure enables you to compare a custom portion of a shared database object. After a comparison is created with the <code dir="ltr">scan_mode</code> parameter set to <code dir="ltr">CMP_SCAN_MODE_CUSTOM</code> in the <code dir="ltr">CREATE_COMPARISON</code> procedure, you can specify the exact portion of the database object to compare when you run the <code dir="ltr">COMPARE</code> function.</p>
<p>Typically, you use this option under the following conditions:</p>
<ul>
<li>
<p>You have a specific portion of a shared database object that you want to compare.</p>
</li>
<li>
<p>You are comparing a relatively large shared database object, and you want to determine whether there might be difference in a specific portion of it without devoting the resources and time to comparing the entire database object.</p>
</li>
</ul>
<p>See <a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code dir="ltr">scan_mode</code> parameter in the <code dir="ltr">CREATE_COMPARISON</code> procedure.</p>
<p>This example compares a custom portion of the <code dir="ltr">oe.orders</code> table at the <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code> databases:</p>
<ol>
<li>
<p>Complete the tasks described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a> and <a href="#BABBHAAG">&#34;Diverging a Database Object at Two Databases to Complete Examples&#34;</a>.</p>
</li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li id="BABIDCIE">
<p>Run the <code dir="ltr">CREATE_COMPARISON</code> procedure to create the comparison:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name   =&gt; &#39;compare_custom&#39;,
    schema_name       =&gt; &#39;oe&#39;,
    object_name       =&gt; &#39;orders&#39;,
    dblink_name       =&gt; &#39;comp2.example.com&#39;,
    index_schema_name =&gt; &#39;oe&#39;,
    index_name        =&gt; &#39;order_pk&#39;,
    scan_mode         =&gt;  DBMS_COMPARISON.CMP_SCAN_MODE_CUSTOM);
END;
/
</pre>
<p>Notice that the <code dir="ltr">scan_mode</code> parameter is set to <code dir="ltr">DBMS_COMPARISON.CMP_SCAN_MODE_CUSTOM</code>. When you specify this scan mode, you should specify the index to use for the comparison. This example specifies the <code dir="ltr">or.order_pk</code> index.</p>
</li>
<li>
<p>Identify the index column or columns for the comparison created in Step <a href="#BABIDCIE">3</a> by running the following query:</p>
<pre dir="ltr">SELECT COLUMN_NAME, COLUMN_POSITION FROM DBA_COMPARISON_COLUMNS 
  WHERE COMPARISON_NAME = &#39;COMPARE_CUSTOM&#39; AND
        INDEX_COLUMN    = &#39;Y&#39;;
</pre>
<p>For a custom comparison, you use the index column to specify the portion of the table to compare when you run the <code dir="ltr">COMPARE</code> function in the next step. In this example, the query should return the following output:</p>
<pre dir="ltr">COLUMN_NAME                    COLUMN_POSITION
------------------------------ ---------------
ORDER_ID                                     1
</pre>
<p>This output shows that the <code dir="ltr">order_id</code> column in the <code dir="ltr">oe.orders</code> table is the index column for the comparison.</p>
<p>For other database objects, the <code dir="ltr">CREATE_COMPARISON</code> procedure might identify multiple index columns. If there are multiple index columns, then specify values for the lead index column in the next step. The lead index column shows <code dir="ltr">1</code> for its <code dir="ltr">COLUMN_POSITION</code> value.</p>
</li>
<li>
<p>Run the <code dir="ltr">COMPARE</code> function to compare the <code dir="ltr">oe.orders</code> table at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; &#39;compare_custom&#39;,
                  scan_info       =&gt; scan_info,
                  min_value       =&gt; &#39;2430&#39;,
                  max_value       =&gt; &#39;2460&#39;,
                  perform_row_dif =&gt; TRUE);
  DBMS_OUTPUT.PUT_LINE(&#39;Scan ID: &#39;||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/
</pre>
<p>Notice the following parameter settings in the <code dir="ltr">COMPARE</code> function:</p>
<ul>
<li>
<p>The <code dir="ltr">min_value</code> and <code dir="ltr">max_value</code> parameters are set to <code dir="ltr">2430</code> and <code dir="ltr">2460</code>, respectively. Therefore, the <code dir="ltr">COMPARE</code> function only compares the range of rows that begins with <code dir="ltr">2430</code> and ends with <code dir="ltr">2460</code> in the <code dir="ltr">order_id</code> column.</p>
</li>
<li>
<p>The <code dir="ltr">min_value</code> and <code dir="ltr">max_value</code> parameters are specified as <code dir="ltr">VARCHAR2</code> data type values, even though the column data type for the <code dir="ltr">order_id</code> column is <code dir="ltr">NUMBER</code>.</p>
</li>
<li>
<p>The <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">TRUE</code> in the <code dir="ltr">COMPARE</code> function. This setting instructs the <code dir="ltr">COMPARE</code> function to identify each individual row difference in the tables. When the <code dir="ltr">perform_row_dif</code> parameter is set to <code dir="ltr">FALSE</code>, the <code dir="ltr">COMPARE</code> function records whether there are differences in the tables, but does not record each individual row difference.</p>
</li>
</ul>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Scan ID: 10
Differences were found.
 
PL/SQL procedure successfully completed.
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABFJAHB">&#34;Viewing Detailed Information About the Row Differences Found in a Scan&#34;</a></p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a> to converge the differences found in the comparison results</p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a> to recheck the comparison results</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABBJDDA"></a>
<div id="STREP597" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Comparing a Shared Database Object That Contains CLOB or BLOB Columns</h3>
<p>The <code dir="ltr">DBMS_COMPARISON</code> package does not support directly comparing a shared database object that contains a column of either <code dir="ltr">CLOB</code> or <code dir="ltr">BLOB</code> data type. However, you can complete these basic steps to compare a table with a <code dir="ltr">CLOB</code> or <code dir="ltr">BLOB</code> column:</p>
<ol>
<li id="BABCJACB">
<p>At each database, create a view based on the table and replace the <code dir="ltr">CLOB</code> or <code dir="ltr">BLOB</code> column with a <code dir="ltr">RAW</code> data type column that is generated using the <code dir="ltr">DBMS_CRYPTO.HASH</code> function.</p>
</li>
<li>
<p>Compare the views created in Step <a href="#BABCJACB">1</a>.</p>
</li>
</ol>
<p>The illustrates how complete these steps for a simple table with a <code dir="ltr">NUMBER</code> column and a <code dir="ltr">CLOB</code> column. In this example, the global names of the databases are <code dir="ltr">comp1.example.com</code> and <code dir="ltr">comp2.example.com</code>, but you can substitute any two databases in your environment that meet the prerequisites described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">DBMS_COMPARISON</code> package cannot converge a shared database object that contains LOB columns.</div>
<p>Complete the following steps:</p>
<ol>
<li>
<p>Complete the tasks described in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
</li>
<li>
<p>At the <code dir="ltr">comp1.example.com</code> database, ensure that the user who owns or will own the table with the <code dir="ltr">CLOB</code> or <code dir="ltr">BLOB</code> column has <code dir="ltr">EXECUTE</code> privilege on the <code dir="ltr">DBMS_CRYPTO</code> package.</p>
<p>In this example, assume the user who will own the table is <code dir="ltr">oe</code>. Complete the following steps to grant this privilege to <code dir="ltr">oe</code> user:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as an administrative user who can grant privileges.</p>
</li>
<li>
<p>Grant <code dir="ltr">EXECUTE</code> on the <code dir="ltr">DBMS_CRYPTO</code> package to the user:</p>
<pre dir="ltr">GRANT EXECUTE ON DBMS_CRYPTO TO oe;
</pre></li>
</ol>
</li>
<li>
<p>At the <code dir="ltr">comp2.example.com</code> database, ensure that the user who owns or will own the table with the <code dir="ltr">CLOB</code> or <code dir="ltr">BLOB</code> column has <code dir="ltr">EXECUTE</code> privilege on the <code dir="ltr">DBMS_CRYPTO</code> package.</p>
<p>In this example, assume the user who will own the table is <code dir="ltr">oe</code>. Complete the following steps to grant this privilege to <code dir="ltr">oe</code> user:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp2.example.com</code> database as an administrative user who can grant privileges.</p>
</li>
<li>
<p>Grant <code dir="ltr">EXECUTE</code> on the <code dir="ltr">DBMS_CRYPTO</code> package to the user:</p>
<pre dir="ltr">GRANT EXECUTE ON DBMS_CRYPTO TO oe;
</pre></li>
</ol>
</li>
<li>
<p>Create the table with the <code dir="ltr">CLOB</code> column and the view based on the table in the <code dir="ltr">comp1.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the user who will own the table.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create the table:</p>
<pre dir="ltr">CREATE TABLE oe.tab_lob(
  c1 NUMBER PRIMARY KEY, 
  c2 CLOB DEFAULT to_clob(&#39;c2&#39;));
</pre></li>
<li>
<p>Insert a row into the <code dir="ltr">tab_lob</code> table and commit the change:</p>
<pre dir="ltr">INSERT INTO oe.tab_lob VALUES(1, TO_CLOB(&#39;row 1&#39;));COMMIT;
</pre></li>
<li>
<p>Create the view:</p>
<pre dir="ltr">BEGIN
  EXECUTE IMMEDIATE &#39;CREATE VIEW view_lob AS SELECT 
      c1, 
      DBMS_CRYPTO.HASH(c2, &#39;||DBMS_CRYPTO.HASH_SH1||&#39;) c2_hash 
    FROM tab_lob&#39;;
END;
/
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS65676" href="../ARPLS/d_crypto.htm#ARPLS65676"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the cryptographic hash functions used in the <code dir="ltr">DBMS_CRYPTO</code> package</div>
</li>
<li>
<p>Create the table with the <code dir="ltr">CLOB</code> column and the view based on the table in the <code dir="ltr">comp2.example.com</code> database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp2.example.com</code> database as the user who will own the table.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create the table:</p>
<pre dir="ltr">CREATE TABLE oe.tab_lob(
  c1 NUMBER PRIMARY KEY, 
  c2 CLOB DEFAULT to_clob(&#39;c2&#39;));
</pre></li>
<li>
<p>Insert a row into the <code dir="ltr">tab_lob</code> table and commit the change:</p>
<pre dir="ltr">INSERT INTO oe.tab_lob VALUES(1, TO_CLOB(&#39;row 1&#39;));COMMIT;
</pre></li>
<li>
<p>Create the view:</p>
<pre dir="ltr">BEGIN
  EXECUTE IMMEDIATE &#39;CREATE VIEW view_lob AS SELECT 
      c1, 
      DBMS_CRYPTO.HASH(c2, &#39;||DBMS_CRYPTO.HASH_SH1||&#39;) c2_hash 
    FROM tab_lob&#39;;
END;
/
</pre></li>
</ol>
</li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
</li>
<li>
<p>Run the <code dir="ltr">CREATE_COMPARISON</code> procedure to create the comparison:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.CREATE_COMPARISON(
    comparison_name =&gt; &#39;compare_lob&#39;,
    schema_name     =&gt; &#39;oe&#39;,
    object_name     =&gt; &#39;view_lob&#39;,
    dblink_name     =&gt; &#39;comp2.example.com&#39;);
END;
/
</pre>
<p>Notice that the <code dir="ltr">schema_name</code> and <code dir="ltr">object_name</code> parameters specify the view <code dir="ltr">oe.view_lob</code> and not the table that contains the <code dir="ltr">CLOB</code> column.</p>
</li>
<li id="BABBIGGG">
<p>Run the <code dir="ltr">COMPARE</code> function to compare the <code dir="ltr">oe.view_lob</code> view at the two databases:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  consistent := DBMS_COMPARISON.COMPARE(
                  comparison_name =&gt; &#39;compare_lob&#39;,
                  scan_info       =&gt; scan_info,
                  perform_row_dif =&gt; TRUE);
  DBMS_OUTPUT.PUT_LINE(&#39;Scan ID: &#39;||scan_info.scan_id);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/
 
Scan ID: 1
No differences were found.
 
PL/SQL procedure successfully completed.
</pre></li>
<li>
<p>Make the <code dir="ltr">oe.tab_lob</code> table diverge at two databases by completing the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the user who owns the table.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Insert a row and commit the change:</p>
<pre dir="ltr">INSERT INTO oe.tab_lob VALUES(2, TO_CLOB(&#39;row a&#39;));
COMMIT;
</pre></li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp2.example.com</code> database as the user who owns the table.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Insert a row and commit the change:</p>
<pre dir="ltr">INSERT INTO oe.tab_lob VALUES(2, TO_CLOB(&#39;row b&#39;));
COMMIT;
</pre></li>
</ol>
</li>
<li>
<p>Run the <code dir="ltr">COMPARE</code> function again to compare the <code dir="ltr">oe.view_lob</code> view at the two databases. See Step <a href="#BABBIGGG">8</a>.</p>
<p>The shared table with the <code dir="ltr">CLOB</code> column has diverged at the two databases. Therefore, when you compare the view, the <code dir="ltr">COMPARE</code> function returns the following output:</p>
<pre dir="ltr">Scan ID: 2
Differences were found.
 
PL/SQL procedure successfully completed.
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CEGEECGH"></a>
<div id="STREP464" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Viewing Information About Comparisons and Comparison Results<a id="sthref646"></a><a id="sthref647"></a><a id="sthref648"></a></h2>
<p>The following data dictionary views contain information about comparisons created with the <code dir="ltr">DBMS_COMPARISON</code> package:</p>
<ul>
<li>
<p><code dir="ltr">DBA_COMPARISON</code></p>
</li>
<li>
<p><code dir="ltr">USER_COMPARISON</code></p>
</li>
<li>
<p><code dir="ltr">DBA_COMPARISON_COLUMNS</code></p>
</li>
<li>
<p><code dir="ltr">USER_COMPARISON_COLUMNS</code></p>
</li>
<li>
<p><code dir="ltr">DBA_COMPARISON_SCAN</code></p>
</li>
<li>
<p><code dir="ltr">USER_COMPARISON_SCAN</code></p>
</li>
<li>
<p><code dir="ltr">DBA_COMPARISON_SCAN_VALUES</code></p>
</li>
<li>
<p><code dir="ltr">USER_COMPARISON_SCAN_VALUES</code></p>
</li>
<li>
<p><code dir="ltr">DBA_COMPARISON_ROW_DIF</code></p>
</li>
<li>
<p><code dir="ltr">USER_COMPARISON_ROW_DIF</code></p>
</li>
</ul>
<p>The following sections contain sample queries that you can use to monitor comparisons and comparison results:</p>
<ul>
<li>
<p><a href="#BABGGGAJ">Viewing General Information About the Comparisons in a Database</a></p>
</li>
<li>
<p><a href="#BABDCFBC">Viewing Information Specific to Random and Cyclic Comparisons</a></p>
</li>
<li>
<p><a href="#BABEDIJI">Viewing the Columns Compared by Each Comparison in a Database</a></p>
</li>
<li>
<p><a href="#BABJCAGD">Viewing General Information About Each Scan in a Database</a></p>
</li>
<li>
<p><a href="#BABCDCJB">Viewing the Parent Scan ID and Root Scan ID for Each Scan in a Database</a></p>
</li>
<li>
<p><a href="#BABFJAHB">Viewing Detailed Information About the Row Differences Found in a Scan</a></p>
</li>
<li>
<p><a href="#BABGFGID">Viewing Information About the Rows Compared in Specific Scans</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for detailed information about the data dictionary views related to comparisons</div>
<a id="BABGGGAJ"></a>
<div id="STREP465" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing General Information About the Comparisons in a Database</h3>
<p>The <code dir="ltr">DBA_COMPARISON</code> data dictionary view contains information about the comparisons in the local database. The query in this section displays the following information about each comparison:</p>
<ul>
<li>
<p>The owner of the comparison</p>
</li>
<li>
<p>The name of the comparison</p>
</li>
<li>
<p>The schema that contains the database object compared by the comparison</p>
</li>
<li>
<p>The name of the database object compared by the comparison</p>
</li>
<li>
<p>The data type of the database object compared by the comparison</p>
</li>
<li>
<p>The scan mode used by the comparison. The following scan modes are possible:</p>
<ul>
<li>
<p><code dir="ltr">FULL</code> indicates that the entire database object is compared.</p>
</li>
<li>
<p><code dir="ltr">RANDOM</code> indicates that a random portion of the database object is compared.</p>
</li>
<li>
<p><code dir="ltr">CYCLIC</code> indicates that a portion of the database object is compared during a single comparison. When the database object is compared again, another portion of the database object is compared, starting where the last compare ended.</p>
</li>
<li>
<p><code dir="ltr">CUSTOM</code> indicates that the <code dir="ltr">COMPARE</code> function specifies the range to compare in the database object.</p>
</li>
</ul>
</li>
<li>
<p>The name of the database link used to connect with the remote database</p>
</li>
</ul>
<p>To view this information, run the following query:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison|Owner&#39; FORMAT A10
COLUMN COMPARISON_NAME HEADING &#39;Comparison|Name&#39; FORMAT A22
COLUMN SCHEMA_NAME HEADING &#39;Schema|Name&#39; FORMAT A8
COLUMN OBJECT_NAME HEADING &#39;Object|Name&#39; FORMAT A8
COLUMN OBJECT_TYPE HEADING &#39;Object|Type&#39; FORMAT A8
COLUMN SCAN_MODE HEADING &#39;Scan|Mode&#39; FORMAT A6
COLUMN DBLINK_NAME HEADING &#39;Database|Link&#39; FORMAT A15
 
SELECT OWNER,
       COMPARISON_NAME,
       SCHEMA_NAME,
       OBJECT_NAME,
       OBJECT_TYPE,
       SCAN_MODE,
       DBLINK_NAME
  FROM DBA_COMPARISON;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Comparison Comparison             Schema   Object   Object   Scan   Database
Owner      Name                   Name     Name     Type     Mode   Link
---------- ---------------------- -------- -------- -------- ------ ----------
ADMIN      COMPARE_SUBSET_COLUMNS OE       ORDERS   TABLE    FULL   COMP2.EXAM
                                                                    PLE
ADMIN      COMPARE_ORDERS         OE       ORDERS   TABLE    FULL   COMP2.EXAM
                                                                    PLE
ADMIN      COMPARE_RANDOM         OE       ORDERS   TABLE    RANDOM COMP2.EXAM
                                                                    PLE
ADMIN      COMPARE_CYCLIC         OE       ORDERS   TABLE    CYCLIC COMP2.EXAM
                                                                    PLE
ADMIN      COMPARE_CUSTOM         OE       ORDERS   TABLE    CUSTOM COMP2.EXAM
                                                                    PLE
</pre>
<p>A comparison compares the local database object with a database object at a remote database. The comparison uses the database link shown by the query to connect to the remote database and perform the comparison.</p>
<p>By default, a comparison assumes that the owner, name, and data type of the database objects being compared are the same at both databases. However, they can be different at the local and remote databases. The query in this section does not display information about the remote database object, but you can query the <code dir="ltr">REMOTE_SCHEMA_NAME</code>, <code dir="ltr">REMOTE_OBJECT_NAME</code>, and <code dir="ltr">REMOTE_OBJECT_TYPE</code> columns to view this information.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CEGFBCAG">Comparing a Shared Database Object at Two Databases</a> for information about creating the comparisons shown in the output of this query</div>
</div>
<!-- class="sect2" -->
<a id="BABDCFBC"></a>
<div id="STREP466" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing Information Specific to Random and Cyclic Comparisons</h3>
<p>When you create comparisons that use the scan modes <code dir="ltr">RANDOM</code> or <code dir="ltr">CYCLIC</code>, you specify the percentage of the shared database object to compare. The query in this section shows the following information about random and cyclic comparisons:</p>
<ul>
<li>
<p>The owner of the comparison</p>
</li>
<li>
<p>The name of the comparison</p>
</li>
<li>
<p>The schema that contains the database object compared by the comparison</p>
</li>
<li>
<p>The name of the database object compared by the comparison</p>
</li>
<li>
<p>The data type of the database object compared by the comparison</p>
</li>
<li>
<p>The scan percentage for the comparison. Each time the <code dir="ltr">COMPARE</code> function is run to perform a comparison scan, the specified percentage of the database object is compared.</p>
</li>
<li>
<p>The last lead index column value used by the comparison. The next time the <code dir="ltr">COMPARE</code> function is run, it will start with row that has a lead index column value that directly follows the value shown by the query. This value only applies to cyclic comparisons.</p>
</li>
</ul>
<p>To view this information, run the following query:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison|Owner&#39; FORMAT A10
COLUMN COMPARISON_NAME HEADING &#39;Comparison|Name&#39; FORMAT A22
COLUMN SCHEMA_NAME HEADING &#39;Schema|Name&#39; FORMAT A8
COLUMN OBJECT_NAME HEADING &#39;Object|Name&#39; FORMAT A8
COLUMN OBJECT_TYPE HEADING &#39;Object|Type&#39; FORMAT A8
COLUMN SCAN_PERCENT HEADING &#39;Scan|Percent&#39; FORMAT 999
COLUMN CYCLIC_INDEX_VALUE HEADING &#39;Cyclic|Index|Value&#39; FORMAT A10
 
SELECT OWNER,
       COMPARISON_NAME,
       SCHEMA_NAME,
       OBJECT_NAME,
       OBJECT_TYPE,
       SCAN_PERCENT,
       CYCLIC_INDEX_VALUE
  FROM DBA_COMPARISON
  WHERE SCAN_PERCENT IS NOT NULL;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">                                                                     Cyclic
Comparison Comparison             Schema   Object   Object      Scan Index
Owner      Name                   Name     Name     Type     Percent Value
---------- ---------------------- -------- -------- -------- ------- ----------
ADMIN      COMPARE_RANDOM         OE       ORDERS   TABLE         50
ADMIN      COMPARE_CYCLIC         OE       ORDERS   TABLE         50 2677
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CEGIJHJB">&#34;Comparing a Random Portion of a Shared Database Object&#34;</a></p>
</li>
<li>
<p><a href="#CEGDBBHA">&#34;Comparing a Shared Database Object Cyclically&#34;</a></p>
</li>
<li>
<p><a href="#BABGGGAJ">&#34;Viewing General Information About the Comparisons in a Database&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABEDIJI"></a>
<div id="STREP467" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing the Columns Compared by Each Comparison in a Database<a id="sthref649"></a></h3>
<p>When you create a comparison, you can specify that the comparison compares all of the columns in the shared database object or a subset of the columns. Also, you can specify an index for the comparison to use or let the system identify an index automatically.</p>
<p>The query in this section displays the following information:</p>
<ul>
<li>
<p>The owner of the comparison</p>
</li>
<li>
<p>The name of the comparison</p>
</li>
<li>
<p>The schema that contains the database object compared by the comparison</p>
</li>
<li>
<p>The name of the database object compared by the comparison</p>
</li>
<li>
<p>The column name of each column being compared in each database object</p>
</li>
<li>
<p>The column position of each column</p>
</li>
<li>
<p>Whether a column is an index column</p>
</li>
</ul>
<p>To display this information, run the following query:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison|Owner&#39; FORMAT A10
COLUMN COMPARISON_NAME HEADING &#39;Comparison|Name&#39; FORMAT A15
COLUMN SCHEMA_NAME HEADING &#39;Schema|Name&#39; FORMAT A10
COLUMN OBJECT_NAME HEADING &#39;Object|Name&#39; FORMAT A10
COLUMN COLUMN_NAME HEADING &#39;Column|Name&#39; FORMAT A12
COLUMN COLUMN_POSITION HEADING &#39;Column|Position&#39; FORMAT 9999
COLUMN INDEX_COLUMN HEADING &#39;Index|Column?&#39; FORMAT A7
 
SELECT c.OWNER,
       c.COMPARISON_NAME,
       c.SCHEMA_NAME,
       c.OBJECT_NAME,
       o.COLUMN_NAME,
       o.COLUMN_POSITION,
       o.INDEX_COLUMN
  FROM DBA_COMPARISON c, DBA_COMPARISON_COLUMNS o
  WHERE c.OWNER           = o.OWNER AND
        c.COMPARISON_NAME = o.COMPARISON_NAME
  ORDER BY COMPARISON_NAME, COLUMN_POSITION;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Comparison Comparison      Schema     Object     Column         Column Index
Owner      Name            Name       Name       Name         Position Column?
---------- --------------- ---------- ---------- ------------ -------- -------
ADMIN      COMPARE_CUSTOM  OE         ORDERS     ORDER_ID            1 Y
ADMIN      COMPARE_CUSTOM  OE         ORDERS     ORDER_DATE          2 N
ADMIN      COMPARE_CUSTOM  OE         ORDERS     ORDER_MODE          3 N
ADMIN      COMPARE_CUSTOM  OE         ORDERS     CUSTOMER_ID         4 N
ADMIN      COMPARE_CUSTOM  OE         ORDERS     ORDER_STATUS        5 N
ADMIN      COMPARE_CUSTOM  OE         ORDERS     ORDER_TOTAL         6 N
ADMIN      COMPARE_CUSTOM  OE         ORDERS     SALES_REP_ID        7 N
ADMIN      COMPARE_CUSTOM  OE         ORDERS     PROMOTION_ID        8 N
ADMIN      COMPARE_CYCLIC  OE         ORDERS     ORDER_ID            1 Y
ADMIN      COMPARE_CYCLIC  OE         ORDERS     ORDER_DATE          2 N
ADMIN      COMPARE_CYCLIC  OE         ORDERS     ORDER_MODE          3 N
ADMIN      COMPARE_CYCLIC  OE         ORDERS     CUSTOMER_ID         4 N
ADMIN      COMPARE_CYCLIC  OE         ORDERS     ORDER_STATUS        5 N
ADMIN      COMPARE_CYCLIC  OE         ORDERS     ORDER_TOTAL         6 N
ADMIN      COMPARE_CYCLIC  OE         ORDERS     SALES_REP_ID        7 N
ADMIN      COMPARE_CYCLIC  OE         ORDERS     PROMOTION_ID        8 N
.
.
.
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABCAHDB">&#34;About Comparing and Converging Data&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABJCAGD"></a>
<div id="STREP468" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing General Information About Each Scan in a Database<a id="sthref650"></a></h3>
<p>Each scan compares a bucket at the local database with a bucket at the remote database. The buckets being compared contain the same range of rows in the shared database object. The comparison results generated by a single execution of the <code dir="ltr">COMPARE</code> function can include multiple buckets and multiple scans. Each scan has a unique scan ID.</p>
<p>The query in this section shows the following information about each scan:</p>
<ul>
<li>
<p>The owner of the comparison that ran the scan</p>
</li>
<li>
<p>The name of the comparison that ran the scan</p>
</li>
<li>
<p>The schema that contains the database object compared by the scan</p>
</li>
<li>
<p>The name of the database object compared by the scan</p>
</li>
<li>
<p>The scan ID of the scan</p>
</li>
<li>
<p>The status of the scan. The following status values are possible:</p>
<ul>
<li>
<p><code dir="ltr">SUC</code> indicates that the two buckets in the two tables matched the last time this data dictionary row was updated.</p>
</li>
<li>
<p><code dir="ltr">BUCKET</code> <code dir="ltr">DIF</code> indicates that the two buckets in the two tables did not match. Each bucket consists of smaller buckets.</p>
</li>
<li>
<p><code dir="ltr">FINAL</code> <code dir="ltr">BUCKET</code> <code dir="ltr">DIF</code> indicates that the two buckets in the two tables did not match. Neither bucket is composed of smaller buckets. Because the <code dir="ltr">perform_row_dif</code> parameter in the <code dir="ltr">COMPARE</code> function or the <code dir="ltr">RECHECK</code> function was set to <code dir="ltr">FALSE</code>, individual row differences were not identified for the bucket.</p>
</li>
<li>
<p><code dir="ltr">ROW</code> <code dir="ltr">DIF</code> indicates that the two buckets in the two tables did not match. Neither bucket is composed of smaller buckets. Because the <code dir="ltr">perform_row_dif</code> parameter in the <code dir="ltr">COMPARE</code> function or the <code dir="ltr">RECHECK</code> function was set to <code dir="ltr">TRUE</code>, individual row differences were identified for the bucket.</p>
</li>
</ul>
</li>
<li>
<p>The number of rows compared in the scan</p>
</li>
<li>
<p>The last time the scan was updated</p>
</li>
</ul>
<p>To view this information, run the following query:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison|Owner&#39; FORMAT A10
COLUMN COMPARISON_NAME HEADING &#39;Comparison|Name&#39; FORMAT A15
COLUMN SCHEMA_NAME HEADING &#39;Schema|Name&#39; FORMAT A6
COLUMN OBJECT_NAME HEADING &#39;Object|Name&#39; FORMAT A6
COLUMN SCAN_ID HEADING &#39;Scan|ID&#39; FORMAT 9999
COLUMN STATUS HEADING &#39;Scan|Status&#39; FORMAT A10
COLUMN COUNT_ROWS HEADING &#39;Number|of|Rows&#39; FORMAT 9999999
COLUMN SCAN_NULLS HEADING &#39;Scan|NULLs?&#39; FORMAT A6
COLUMN LAST_UPDATE_TIME HEADING &#39;Last|Update&#39; FORMAT A11

SELECT c.OWNER,
       c.COMPARISON_NAME,
       c.SCHEMA_NAME,
       c.OBJECT_NAME,
       s.SCAN_ID,
       s.STATUS,
       s.COUNT_ROWS,
       TO_CHAR(s.LAST_UPDATE_TIME, &#39;DD-MON-YYYY HH24:MI:SS&#39;) LAST_UPDATE_TIME 
  FROM DBA_COMPARISON c, DBA_COMPARISON_SCAN s
  WHERE c.OWNER           = s.OWNER AND
        c.COMPARISON_NAME = s.COMPARISON_NAME
  ORDER BY SCAN_ID;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">                                                            Number
Comparison Comparison      Schema Object  Scan Scan             of Last
Owner      Name            Name   Name      ID Status         Rows Update
---------- --------------- ------ ------ ----- ---------- -------- -----------
ADMIN      COMPARE_SUBSET_ OE     ORDERS     1 BUCKET DIF          20-DEC-2006
           COLUMNS                                                  09:46:34
ADMIN      COMPARE_SUBSET_ OE     ORDERS     2 ROW DIF         105 20-DEC-2006
           COLUMNS                                                  09:46:34
ADMIN      COMPARE_SUBSET_ OE     ORDERS     3 ROW DIF           1 20-DEC-2006
           COLUMNS                                                  09:46:35
ADMIN      COMPARE_ORDERS  OE     ORDERS     4 BUCKET DIF          20-DEC-2006
                                                                    09:47:02
ADMIN      COMPARE_ORDERS  OE     ORDERS     5 FINAL BUCK      105 20-DEC-2006
                                               ET DIF               09:47:02
ADMIN      COMPARE_ORDERS  OE     ORDERS     6 FINAL BUCK        1 20-DEC-2006
                                               ET DIF               09:47:02
ADMIN      COMPARE_RANDOM  OE     ORDERS     7 SUC                 20-DEC-2006
                                                                    09:47:37
ADMIN      COMPARE_CYCLIC  OE     ORDERS     8 BUCKET DIF          20-DEC-2006
                                                                    09:48:22
ADMIN      COMPARE_CYCLIC  OE     ORDERS     9 ROW DIF         105 20-DEC-2006
                                                                    09:48:22
ADMIN      COMPARE_CUSTOM  OE     ORDERS    10 BUCKET DIF          20-DEC-2006
                                                                    09:49:15
ADMIN      COMPARE_CUSTOM  OE     ORDERS    11 ROW DIF          16 20-DEC-2006
                                                                    09:49:15
ADMIN      COMPARE_CUSTOM  OE     ORDERS    12 ROW DIF          13 20-DEC-2006
                                                                    09:49:15
</pre>
<p>When a scan has a status of <code dir="ltr">BUCKET</code> <code dir="ltr">DIF</code>, <code dir="ltr">FINAL</code> <code dir="ltr">BUCKET</code> <code dir="ltr">DIF</code>, or <code dir="ltr">ROW</code> <code dir="ltr">DIF</code>, you can converge the differences found in the scan by running the <code dir="ltr">CONVERGE</code> procedure and specifying the scan ID. However, to converge the all of the rows in the comparison results instead of the portion checked in a specific scan, specify the root scan ID for the comparison results when you run the <code dir="ltr">CONVERGE</code> procedure.</p>
<p>Also, when a scan shows that differences were found, you can recheck the scan using the <code dir="ltr">RECHECK</code> function. To recheck all of the rows in the comparison results, run the <code dir="ltr">RECHECK</code> function and specify the root scan ID for the comparison results.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABCDCJB">&#34;Viewing the Parent Scan ID and Root Scan ID for Each Scan in a Database&#34;</a> for information about viewing the root scan for a scan</p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a></p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a></p>
</li>
<li>
<p><a href="#BABCAHDB">&#34;About Comparing and Converging Data&#34;</a> for more information about scans and buckets</p>
</li>
<li>
<p><a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABCDCJB"></a>
<div id="STREP469" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing the Parent Scan ID and Root Scan ID for Each Scan in a Database<a id="sthref651"></a><a id="sthref652"></a></h3>
<p>The query in this section shows the parent scan ID and root scan ID of each scan in the database. Specifically, the query shows the following information:</p>
<ul>
<li>
<p>The owner of the comparison that ran the scan</p>
</li>
<li>
<p>The name of the comparison that ran the scan</p>
</li>
<li>
<p>The schema that contains the database object compared by the scan</p>
</li>
<li>
<p>The name of the database object compared by the scan</p>
</li>
<li>
<p>The scan ID of the scan</p>
</li>
<li>
<p>The scan ID of the scan&#39;s parent scan</p>
</li>
<li>
<p>The scan ID of the scan&#39;s root scan</p>
</li>
</ul>
<p>To view this information, run the following query:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison|Owner&#39; FORMAT A10
COLUMN COMPARISON_NAME HEADING &#39;Comparison|Name&#39; FORMAT A15
COLUMN SCHEMA_NAME HEADING &#39;Schema|Name&#39; FORMAT A10
COLUMN OBJECT_NAME HEADING &#39;Object|Name&#39; FORMAT A10
COLUMN SCAN_ID HEADING &#39;Scan|ID&#39; FORMAT 9999
COLUMN PARENT_SCAN_ID HEADING &#39;Parent|Scan ID&#39; FORMAT 9999
COLUMN ROOT_SCAN_ID HEADING &#39;Root|Scan ID&#39; FORMAT 9999
 
SELECT c.OWNER,
       c.COMPARISON_NAME,
       c.SCHEMA_NAME,
       c.OBJECT_NAME,
       s.SCAN_ID,
       s.PARENT_SCAN_ID,
       s.ROOT_SCAN_ID
  FROM DBA_COMPARISON c, DBA_COMPARISON_SCAN s
  WHERE c.OWNER           = s.OWNER AND
        c.COMPARISON_NAME = s.COMPARISON_NAME
  ORDER BY s.SCAN_ID;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Comparison Comparison      Schema     Object      Scan  Parent    Root
Owner      Name            Name       Name          ID Scan ID Scan ID
---------- --------------- ---------- ---------- ----- ------- -------
ADMIN      COMPARE_SUBSET_ OE         ORDERS         1               1
           COLUMNS
ADMIN      COMPARE_SUBSET_ OE         ORDERS         2       1       1
           COLUMNS
ADMIN      COMPARE_SUBSET_ OE         ORDERS         3       1       1
           COLUMNS
ADMIN      COMPARE_ORDERS  OE         ORDERS         4               4
ADMIN      COMPARE_ORDERS  OE         ORDERS         5       4       4
ADMIN      COMPARE_ORDERS  OE         ORDERS         6       4       4
ADMIN      COMPARE_RANDOM  OE         ORDERS         7               7
ADMIN      COMPARE_CYCLIC  OE         ORDERS         8               8
ADMIN      COMPARE_CYCLIC  OE         ORDERS         9       8       8
ADMIN      COMPARE_CUSTOM  OE         ORDERS        10              10
ADMIN      COMPARE_CUSTOM  OE         ORDERS        11      10      10
ADMIN      COMPARE_CUSTOM  OE         ORDERS        12      10      10
</pre>
<p>This output shows, for example, that the scan with scan ID <code dir="ltr">1</code> is the root scan in the comparison results for the <code dir="ltr">COMPARE_SUBSET_COLUMNS</code> comparison. Differences were found in this root scan, and it was split into two smaller buckets. The scan with scan ID <code dir="ltr">2</code> and the scan with scan ID <code dir="ltr">3</code> are the scans for these smaller buckets.</p>
<p>To see if there were differences found in a specific scan, run the query in <a href="#BABJCAGD">&#34;Viewing General Information About Each Scan in a Database&#34;</a>. When you <code dir="ltr">RECHECK</code> for differences or <code dir="ltr">CONVERGE</code> differences in a shared database object, you specify the scan ID of the scan you want to recheck or converge. To recheck or converge all of the rows in the comparison results, specify the root scan ID for the comparison results.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a></p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a></p>
</li>
<li>
<p><a href="#BABCAHDB">&#34;About Comparing and Converging Data&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABFJAHB"></a>
<div id="STREP470" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing Detailed Information About the Row Differences Found in a Scan<a id="sthref653"></a><a id="sthref654"></a></h3>
<p>The queries in this section display detailed information about the row differences found in comparison results. To view the information in the queries in this section, the <code dir="ltr">perform_row_dif</code> parameter in the <code dir="ltr">COMPARE</code> function or the <code dir="ltr">RECHECK</code> function that performed the comparison must have been set to <code dir="ltr">TRUE</code>.</p>
<p>If this parameter was set to <code dir="ltr">FALSE</code>, then you can query the <code dir="ltr">STATUS</code> column in the <code dir="ltr">DBA_COMPARISON_SCAN</code> view to determine whether the scan found any differences, without showing detailed information about the differences. See <a href="#BABJCAGD">&#34;Viewing General Information About Each Scan in a Database&#34;</a> for more information and a sample query.</p>
<p>The following query shows the total number of differences found for a scan with the scan ID of <code dir="ltr">8</code>:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison Owner&#39; FORMAT A16
COLUMN COMPARISON_NAME HEADING &#39;Comparison Name&#39; FORMAT A25
COLUMN SCHEMA_NAME HEADING &#39;Schema Name&#39; FORMAT A11
COLUMN OBJECT_NAME HEADING &#39;Object Name&#39; FORMAT A11
COLUMN CURRENT_DIF_COUNT HEADING &#39;Differences&#39; FORMAT 9999999

SELECT c.OWNER, 
       c.COMPARISON_NAME, 
       c.SCHEMA_NAME, 
       c.OBJECT_NAME, 
       s.CURRENT_DIF_COUNT 
  FROM DBA_COMPARISON c, DBA_COMPARISON_SCAN s
  WHERE c.COMPARISON_NAME = s.COMPARISON_NAME AND
        c.OWNER           = s.OWNER AND
        s.SCAN_ID         = 8;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Comparison Owner Comparison Name           Schema Name Object Name Differences
---------------- ------------------------- ----------- ----------- -----------
ADMIN            COMPARE_CYCLIC            OE          ORDERS                6
</pre>
<p>To view detailed information about each row difference found in the scan with scan ID <code dir="ltr">8</code> of the comparison results for the <code dir="ltr">COMPARE_CYCLIC</code> comparison, run the following query:</p>
<pre dir="ltr">COLUMN COLUMN_NAME HEADING &#39;Index Column&#39; FORMAT A15
COLUMN INDEX_VALUE HEADING &#39;Index Value&#39; FORMAT A15
COLUMN LOCAL_ROWID HEADING &#39;Local Row Exists?&#39; FORMAT A20
COLUMN REMOTE_ROWID HEADING &#39;Remote Row Exists?&#39; FORMAT A20

SELECT c.COLUMN_NAME,
       r.INDEX_VALUE, 
       DECODE(r.LOCAL_ROWID,
                NULL, &#39;No&#39;,
                      &#39;Yes&#39;) LOCAL_ROWID,
       DECODE(r.REMOTE_ROWID,
                NULL, &#39;No&#39;,
                      &#39;Yes&#39;) REMOTE_ROWID
  FROM DBA_COMPARISON_COLUMNS c,
       DBA_COMPARISON_ROW_DIF r,
       DBA_COMPARISON_SCAN s
  WHERE c.COMPARISON_NAME = &#39;COMPARE_CYCLIC&#39; AND
        r.SCAN_ID         = s.SCAN_ID AND
        s.PARENT_SCAN_ID  = 8 AND
        r.STATUS          = &#39;DIF&#39; AND
        c.INDEX_COLUMN    = &#39;Y&#39; AND
        c.COMPARISON_NAME = r.COMPARISON_NAME AND
        c.OWNER           = r.OWNER
  ORDER BY r.INDEX_VALUE;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Index Column    Index Value     Local Row Exists?    Remote Row Exists?
--------------- --------------- -------------------- --------------------
ORDER_ID        2366            Yes                  No
ORDER_ID        2385            Yes                  No
ORDER_ID        2396            Yes                  No
ORDER_ID        2425            Yes                  No
ORDER_ID        2440            Yes                  Yes
ORDER_ID        2450            Yes                  No
</pre>
<p>This output shows the index column for the table being compared and the index value for each row that is different in the shared database object. In this example, the index column is the primary key column for the <code dir="ltr">oe.orders</code> table (<code dir="ltr">order_id</code>). The output also shows the type of difference for each row:</p>
<ul>
<li>
<p>If <code dir="ltr">Local</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> and <code dir="ltr">Remote</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> are both <code dir="ltr">Yes</code> for a row, then the row exists in both instances of the database object, but the data in the row is different.</p>
</li>
<li>
<p>If <code dir="ltr">Local</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">Yes</code> and <code dir="ltr">Remote</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">No</code> for a row, then the row exists in the local database object but not in the remote database object.</p>
</li>
<li>
<p>If <code dir="ltr">Local</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">No</code> and <code dir="ltr">Remote</code> <code dir="ltr">Row</code> <code dir="ltr">Exists?</code> is <code dir="ltr">Yes</code> for a row, then the row exists in the remote database object but not in the local database object.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BABGFGID"></a>
<div id="STREP471" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Viewing Information About the Rows Compared in Specific Scans<a id="sthref655"></a></h3>
<p>Each scan compares a range of rows in a shared database object. The query in this section provides the following information about the rows compared in each scan in the database:</p>
<ul>
<li>
<p>The owner of the comparison that ran the scan</p>
</li>
<li>
<p>The name of the comparison that ran the scan</p>
</li>
<li>
<p>The column position of the row values displayed by the query</p>
</li>
<li>
<p>The minimum value for the range of rows compared by the scan</p>
</li>
<li>
<p>The maximum value for the range of rows compared by the scan</p>
</li>
</ul>
<p>A scan compares the row with the minimum value, the row with the maximum value, and all of the rows in between the minimum and maximum values in the database object. For each row returned by the query, the value displayed for the minimum value and the maximum value are the values for the column in the displayed the column position. The column position is an index column for the comparison.</p>
<p>To view this information, run the following query:</p>
<pre dir="ltr">COLUMN OWNER HEADING &#39;Comparison|Owner&#39; FORMAT A10
COLUMN COMPARISON_NAME HEADING &#39;Comparison|Name&#39; FORMAT A22
COLUMN SCAN_ID HEADING &#39;Scan|ID&#39; FORMAT 9999
COLUMN COLUMN_POSITION HEADING &#39;Column|Position&#39; FORMAT 999
COLUMN MIN_VALUE HEADING &#39;Minimum|Value&#39; FORMAT A15
COLUMN MAX_VALUE HEADING &#39;Maximum|Value&#39; FORMAT A15
 
SELECT OWNER,
       COMPARISON_NAME,
       SCAN_ID,
       COLUMN_POSITION,
       MIN_VALUE,
       MAX_VALUE
  FROM DBA_COMPARISON_SCAN_VALUES
  ORDER BY SCAN_ID;
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Comparison Comparison              Scan   Column Minimum         Maximum
Owner      Name                      ID Position Value           Value
---------- ---------------------- ----- -------- --------------- ---------------
ADMIN      COMPARE_SUBSET_COLUMNS     1        1 2354            3000
ADMIN      COMPARE_SUBSET_COLUMNS     2        1 2354            2458
ADMIN      COMPARE_SUBSET_COLUMNS     3        1 3000            3000
ADMIN      COMPARE_ORDERS             4        1 2354            3000
ADMIN      COMPARE_ORDERS             5        1 2354            2458
ADMIN      COMPARE_ORDERS             6        1 3000            3000
ADMIN      COMPARE_RANDOM             7        1 2617.3400241505 2940.3400241505
                                                 667163579712423 667163579712423
                                                 44590999096     44590999096
ADMIN      COMPARE_CYCLIC             8        1 2354            2677
ADMIN      COMPARE_CYCLIC             9        1 2354            2458
ADMIN      COMPARE_CUSTOM            10        1 2430            2460
ADMIN      COMPARE_CUSTOM            11        1 2430            2445
ADMIN      COMPARE_CUSTOM            12        1 2446            2458
</pre>
<p>This output shows the rows that were compared in each scan. For some comparisons, the scan was split into smaller buckets, and the query shows the rows compared in each smaller bucket.</p>
<p>For example, consider the output for the comparison results of the <code dir="ltr">COMPARE_CUSTOM</code> comparison:</p>
<ul>
<li>
<p>Each scan in the comparison results displays column position <code dir="ltr">1</code>. To determine which column is in column position <code dir="ltr">1</code> for the scan, run the query in <a href="#BABEDIJI">&#34;Viewing the Columns Compared by Each Comparison in a Database&#34;</a>. In this example, the column in column position <code dir="ltr">1</code> for the <code dir="ltr">COMPARE_CUSTOM</code> comparison is the <code dir="ltr">order_id</code> column in the <code dir="ltr">oe.orders</code> table.</p>
</li>
<li>
<p>Scan ID <code dir="ltr">10</code> is a root scan. This scan found differences, and the rows were split into two buckets that are represented by scan ID <code dir="ltr">11</code> and scan ID <code dir="ltr">12</code>.</p>
</li>
<li>
<p>Scan ID <code dir="ltr">11</code> compared the rows from the row with <code dir="ltr">2430</code> for <code dir="ltr">order_id</code> to the row with <code dir="ltr">2445</code> for <code dir="ltr">order_id</code>.</p>
</li>
<li>
<p>Scan ID <code dir="ltr">12</code> compared the rows from the row with <code dir="ltr">2446</code> for <code dir="ltr">order_id</code> to the row with <code dir="ltr">2458</code> for <code dir="ltr">order_id</code>.</p>
</li>
</ul>
<p>To recheck or converge the differences found in a scan, you can run the <code dir="ltr">RECHECK</code> function or <code dir="ltr">CONVERGE</code> procedure, respectively. Specify the scan ID of the scan you want to recheck or converge. To recheck or converge all of the rows in comparison results, specify the root scan ID for the comparison results.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a></p>
</li>
<li>
<p><a href="#BABBHCCC">&#34;Rechecking the Comparison Results for a Comparison&#34;</a></p>
</li>
<li>
<p><a href="#BABCAHDB">&#34;About Comparing and Converging Data&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CEGIABII"></a>
<div id="STREP472" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Converging a Shared Database Object<a id="sthref656"></a><a id="sthref657"></a><a id="sthref658"></a></h2>
<p>The <code dir="ltr">CONVERGE</code> procedure in the <code dir="ltr">DBMS_COMPARISON</code> package synchronizes the portion of the database object compared by the specified comparison scan and returns information about the changes it made. The <code dir="ltr">CONVERGE</code> procedure only converges the differences identified in the specified scan. A scan might only identify differences in a subset of the rows or columns in a table, and differences might arise after the specified scan completed. In these cases, the <code dir="ltr">CONVERGE</code> procedure might not make the shared database object completely consistent.</p>
<p>To ensure that a scan has the most current differences, it is usually best to run the <code dir="ltr">CONVERGE</code> procedure as soon as possible after running the comparison scan that is being converged. Also, you should only converge rows that are not being updated on either database. For example, if the shared database object is updated by replication components, then only converge rows for which replication changes have already been applied and ensure that no new changes are in the process of being replicated for these rows.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
If a scan identifies that a row is different in the shared database object at two databases, and the row is modified after the scan, then it can result in unexpected data in the row after the <code dir="ltr">CONVERGE</code> procedure is run.</div>
<p>This section contains the following examples:</p>
<ul>
<li>
<p><a href="#BABFAJIF">Converging a Shared Database Object for Consistency with the Local Object</a></p>
</li>
<li>
<p><a href="#BABJJGCA">Converging a Shared Database Object for Consistency with the Remote Object</a></p>
</li>
<li>
<p><a href="#BABEEDID">Converging a Shared Database Object with a Session Tag Set</a></p>
</li>
</ul>
<p>These examples converge the comparison results generated in <a href="#CEGEIFAH">&#34;Comparing a Shared Database Object without Identifying Row Differences&#34;</a>. In that example, the comparison name is <code dir="ltr">compare_orders</code> and the returned scan ID is&nbsp;<code dir="ltr">4</code>. If you completed this example, then the scan ID returned on your system might have been different. Run the following query to determine the scan ID:</p>
<pre dir="ltr">SELECT DISTINCT ROOT_SCAN_ID FROM DBA_COMPARISON_SCAN 
  WHERE COMPARISON_NAME = &#39;COMPARE_ORDERS&#39;;
</pre>
<p>If multiple values are returned, then the comparison was run more than once. In this case, use the largest scan ID returned.</p>
<p>When you want to converge all of the rows in comparison results, specify the root scan ID for the comparison results. If, however, you want to converge a portion of the rows in comparison results, then you can specify the scan ID of the scan that contains differences you want to converge.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CEGFBCAG">&#34;Comparing a Shared Database Object at Two Databases&#34;</a> for information about comparing database objects and comparison scans</p>
</li>
<li>
<p><a href="#BABJCAGD">&#34;Viewing General Information About Each Scan in a Database&#34;</a> for a query that shows which scans found differences</p>
</li>
<li>
<p><a href="#BABCDCJB">&#34;Viewing the Parent Scan ID and Root Scan ID for Each Scan in a Database&#34;</a> for a query that shows the root scan ID of each scan</p>
</li>
<li>
<p><a class="olink ARPLS871" href="../ARPLS/d_comparison.htm#ARPLS871"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">CONVERGE</code> procedure</p>
</li>
</ul>
</div>
<a id="BABFAJIF"></a>
<div id="STREP473" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Converging a Shared Database Object for Consistency with the Local Object</h3>
<p>The <code dir="ltr">converge_options</code> parameter in the <code dir="ltr">CONVERGE</code> procedure determines which database &#34;wins&#34; during a conversion. To specify that the local database wins, set the <code dir="ltr">converge_options</code> parameter to <code dir="ltr">DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS</code>. When you specify that the local database wins, the data in the database object at the local database replaces the data in the database object at the remote database for each difference found in the specified comparison scan.</p>
<p>To converge a scan of the <code dir="ltr">compare_orders</code> comparison so that both database objects are consistent with the local database, complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the comparison. The user must also have access to the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">CONVERGE</code> procedure:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  DBMS_COMPARISON.CONVERGE(
    comparison_name  =&gt; &#39;compare_orders&#39;,
    scan_id          =&gt; 4, <span class="bold">-- Substitute the scan ID from your scan.</span>
    scan_info        =&gt; scan_info,
    converge_options =&gt; DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS);
DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Merged: &#39;||scan_info.loc_rows_merged);
DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Merged: &#39;||scan_info.rmt_rows_merged);
DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Deleted: &#39;||scan_info.loc_rows_deleted);
DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Deleted: &#39;||scan_info.rmt_rows_deleted);
END;
/
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Local Rows Merged: 0
Remote Rows Merged: 6
Local Rows Deleted: 0
Remote Rows Deleted: 1
 
PL/SQL procedure successfully completed.
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABJJGCA"></a>
<div id="STREP474" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Converging a Shared Database Object for Consistency with the Remote Object</h3>
<p>The <code dir="ltr">converge_options</code> parameter in the <code dir="ltr">CONVERGE</code> procedure determines which database &#34;wins&#34; during a conversion. To specify that the remote database wins, set the <code dir="ltr">converge_options</code> parameter to <code dir="ltr">DBMS_COMPARISON.CMP_CONVERGE_REMOTE_WINS</code>. When you specify that the remote database wins, the data in the database object at the remote database replaces the data in the database object at the local database for each difference found in the specified comparison scan.</p>
<p>To converge a scan of the <code dir="ltr">compare_orders</code> comparison so that both database objects are consistent with the remote database, complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the comparison. The user must also have access to the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">CONVERGE</code> procedure:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  DBMS_COMPARISON.CONVERGE(
    comparison_name  =&gt; &#39;compare_orders&#39;,
    scan_id          =&gt; 4, <span class="bold">-- Substitute the scan ID from your scan.</span>
    scan_info        =&gt; scan_info,
    converge_options =&gt; DBMS_COMPARISON.CMP_CONVERGE_REMOTE_WINS);
DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Merged: &#39;||scan_info.loc_rows_merged);
DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Merged: &#39;||scan_info.rmt_rows_merged);
DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Deleted: &#39;||scan_info.loc_rows_deleted);
DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Deleted: &#39;||scan_info.rmt_rows_deleted);
END;
/
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Local Rows Merged: 2
Remote Rows Merged: 0
Local Rows Deleted: 5
Remote Rows Deleted: 0

PL/SQL procedure successfully completed.
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BABEEDID"></a>
<div id="STREP475" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Converging a Shared Database Object with a Session Tag Set<a id="sthref659"></a><a id="sthref660"></a><a id="sthref661"></a></h3>
<p>If the shared database object being converged is part of an Oracle Streams replication environment, then you can set a session tag so that changes made by the <code dir="ltr">CONVERGE</code> procedure are not replicated. Typically, changes made by the <code dir="ltr">CONVERGE</code> procedure should not be replicated to avoid change cycling, which means sending a change back to the database where it originated. In an Oracle Streams replication environment, you can use session tags to ensure that changes made by the <code dir="ltr">CONVERGE</code> procedure are not captured by Oracle Streams capture processes or synchronous captures and therefore not replicated.</p>
<p>To set a session tag in the session running the <code dir="ltr">CONVERGE</code> procedure, use the following procedure parameters:</p>
<ul>
<li>
<p>The <code dir="ltr">local_converge_tag</code> parameter sets a session tag at the local database. Set this parameter to a value that prevents replication when the remote database wins and the <code dir="ltr">CONVERGE</code> procedure makes changes to the local database.</p>
</li>
<li>
<p>The <code dir="ltr">remote_converge_tag</code> parameter sets a session tag at the remote database. Set this parameter to a value that prevents replication when the local database wins and the <code dir="ltr">CONVERGE</code> procedure makes changes to the remote database.</p>
</li>
</ul>
<p>The appropriate value for a session tag depends on the Oracle Streams replication environment. Set the tag to a value that prevents capture processes and synchronous captures from capturing changes made by the session.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rep_tags.htm#i1007693">&#34;Oracle Streams Tags in a Replication Environment&#34;</a></div>
<p>The example in this section specifies that the local database wins the converge operation by setting the <code dir="ltr">converge_options</code> parameter to <code dir="ltr">DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS</code>. Therefore, the example sets the <code dir="ltr">remote_converge_tag</code> parameter to the hexadecimal equivalent of <code dir="ltr">&#39;11&#39;</code>. The session tag can be set to any non-<code dir="ltr">NULL</code> value that prevents the changes made by the <code dir="ltr">CONVERGE</code> procedure to the remote database from being replicated.</p>
<p>To converge a scan of the <code dir="ltr">compare_orders</code> comparison so that the database objects are consistent with the local database and a session tag is set at the remote database, complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">comp1.example.com</code> database as the administrative user who owns the comparison. The user must also have access to the database link created in <a href="#CEGBFEBI">&#34;Preparing To Compare and Converge a Shared Database Object&#34;</a>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">CONVERGE</code> procedure:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  scan_info    DBMS_COMPARISON.COMPARISON_TYPE;
BEGIN
  DBMS_COMPARISON.CONVERGE(
    comparison_name     =&gt; &#39;compare_orders&#39;,
    scan_id             =&gt; 4, <span class="bold">-- Substitute the scan ID from your scan.</span>
    scan_info           =&gt; scan_info,
    converge_options    =&gt; DBMS_COMPARISON.CMP_CONVERGE_LOCAL_WINS,
    remote_converge_tag =&gt; HEXTORAW(&#39;11&#39;));
DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Merged: &#39;||scan_info.loc_rows_merged);
DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Merged: &#39;||scan_info.rmt_rows_merged);
DBMS_OUTPUT.PUT_LINE(&#39;Local Rows Deleted: &#39;||scan_info.loc_rows_deleted);
DBMS_OUTPUT.PUT_LINE(&#39;Remote Rows Deleted: &#39;||scan_info.rmt_rows_deleted);
END;
/
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Local Rows Merged: 0
Remote Rows Merged: 6
Local Rows Deleted: 0
Remote Rows Deleted: 1

PL/SQL procedure successfully completed.
</pre></li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">CREATE_COMPARISON</code> procedure also enables you to set local and remote convergence tag values. If a tag parameter in the <code dir="ltr">CONVERGE</code> procedure is non-<code dir="ltr">NULL</code>, then it takes precedence over the corresponding tag parameter in the <code dir="ltr">CREATE_COMPARISON</code> procedure. If a tag parameter in the <code dir="ltr">CONVERGE</code> procedure is <code dir="ltr">NULL</code>, then it is ignored, and the corresponding tag value in the <code dir="ltr">CREATE_COMPARISON</code> procedure is used.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABBHCCC"></a>
<div id="STREP476" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Rechecking the Comparison Results for a Comparison<a id="sthref662"></a><a id="sthref663"></a><a id="sthref664"></a></h2>
<p>You can recheck a previous comparison scan by using the <code dir="ltr">RECHECK</code> function in the <code dir="ltr">DBMS_COMPARISON</code> package. The <code dir="ltr">RECHECK</code> function checks the current data in the database objects for differences that were recorded in the specified comparison scan.</p>
<p>For example, to recheck the results for scan ID <code dir="ltr">4</code> of a comparison named <code dir="ltr">compare_orders</code>, log in to SQL*Plus as the owner of the comparison, and run the following procedure:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  consistent   BOOLEAN;
BEGIN
  consistent := DBMS_COMPARISON.RECHECK(
                  comparison_name =&gt; &#39;compare_orders&#39;,
                  scan_id         =&gt; 4);
  IF consistent=TRUE THEN
    DBMS_OUTPUT.PUT_LINE(&#39;No differences were found.&#39;);
  ELSE
    DBMS_OUTPUT.PUT_LINE(&#39;Differences were found.&#39;);
  END IF;
END;
/
</pre>
<p>Your output is similar to the following:</p>
<pre dir="ltr">Differences were found.

PL/SQL procedure successfully completed.
</pre>
<p>The function returns <code dir="ltr">TRUE</code> if no differences were found or <code dir="ltr">FALSE</code> if differences were found. The <code dir="ltr">compare_orders</code> comparison is created in <a href="#CEGEIFAH">&#34;Comparing a Shared Database Object without Identifying Row Differences&#34;</a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>The <code dir="ltr">RECHECK</code> function does not compare the shared database object for differences that were not recorded in the specified comparison scan. To check for those differences, run the <code dir="ltr">COMPARE</code> function.</p>
</li>
<li>
<p>If the specified comparison scan did not complete successfully, then the <code dir="ltr">RECHECK</code> function starts where the comparison scan previously ended.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CEGFBCAG">&#34;Comparing a Shared Database Object at Two Databases&#34;</a> for information about the compare function</div>
</div>
<!-- class="sect1" -->
<a id="BABDHBFI"></a>
<div id="STREP477" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Purging Comparison Results<a id="sthref665"></a><a id="sthref666"></a><a id="sthref667"></a></h2>
<p>You can purge the comparison results of one or more comparisons when they are no longer needed by using the <code dir="ltr">PURGE_COMPARISON</code> procedure in the <code dir="ltr">DBMS_COMPARISON</code> package. You can either purge all of the comparison results for a comparison or a subset of the comparison results. When comparison results are purged, they can no longer be used to recheck the comparison or converge divergent data. Also, information about the comparison results is removed from data dictionary views.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#BABFCCFF">Purging All of the Comparison Results for a Comparison</a></p>
</li>
<li>
<p><a href="#BABEJABA">Purging the Comparison Results for a Specific Scan ID of a Comparison</a></p>
</li>
<li>
<p><a href="#BABJDDGF">Purging the Comparison Results of a Comparison Before a Specified Time</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#BABCAHDB">&#34;About Comparing and Converging Data&#34;</a></div>
<a id="BABFCCFF"></a>
<div id="STREP478" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Purging All of the Comparison Results for a Comparison</h3>
<p>To purge all of the comparison results for a comparison, specify the comparison name in the <code dir="ltr">comparison_name</code> parameter, and specify the default value of <code dir="ltr">NULL</code> for the <code dir="ltr">scan_id</code> and <code dir="ltr">purge_time</code> parameters.</p>
<p>For example, to purge all of the comparison results for a comparison named <code dir="ltr">compare_orders</code>, log in to SQL*Plus as the owner of the comparison, and run the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.PURGE_COMPARISON(
    comparison_name =&gt; &#39;compare_orders&#39;,
    scan_id         =&gt; NULL,
    purge_time      =&gt; NULL);
END;
/
</pre></div>
<!-- class="sect2" -->
<a id="BABEJABA"></a>
<div id="STREP479" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Purging the Comparison Results for a Specific Scan ID of a Comparison</h3>
<p>To purge the comparison results for a specific scan of a comparison, specify the comparison name in the <code dir="ltr">comparison_name</code> parameter, and specify the scan ID in the <code dir="ltr">scan_id</code> parameter. The specified scan ID must identify a root scan. The root scan in comparison results is the highest level parent scan. The root scan does not have a parent. You can identify root scan IDs by querying the <code dir="ltr">ROOT_SCAN_ID</code> column of the <code dir="ltr">DBA_COMPARISON_SCAN</code> data dictionary view.</p>
<p>When you run the <code dir="ltr">PURGE_COMPARISON</code> procedure and specify a root scan, the root scan is purged. In addition, all direct and indirect child scans of the specified root scan are purged. Results for other scans are not purged.</p>
<p>For example, to purge the comparison results for scan ID <code dir="ltr">4</code> of a comparison named <code dir="ltr">compare_orders</code>, log in to SQL*Plus as the owner of the comparison, and run the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.PURGE_COMPARISON(
    comparison_name =&gt; &#39;compare_orders&#39;,
    scan_id         =&gt; 4); <span class="bold">-- Substitute the scan ID from your scan.</span>
END;
/
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#BABCDCJB">&#34;Viewing the Parent Scan ID and Root Scan ID for Each Scan in a Database&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS868" href="../ARPLS/d_comparison.htm#ARPLS868"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABJDDGF"></a>
<div id="STREP480" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Purging the Comparison Results of a Comparison Before a Specified Time</h3>
<p>To purge the comparison results that were recorded on or before a specific date and time for a comparison, specify the comparison name in the <code dir="ltr">comparison_name</code> parameter, and specify the date and time in the <code dir="ltr">purge_time</code> parameter. Results are purged regardless of scan ID. Comparison results that were recorded after the specified date and time are retained.</p>
<p>For example, assume that the <code dir="ltr">NLS_TIMESTAMP_FORMAT</code> initialization parameter setting in the current session is <code dir="ltr">YYYY-MM-DD HH24:MI:SS</code>. To purge the results for any scans that were recorded before 1PM on August 16, 2006 for the <code dir="ltr">compare_orders</code> comparison, log in to SQL*Plus as the owner of the comparison, and run the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_COMPARISON.PURGE_COMPARISON(
    comparison_name =&gt; &#39;compare_orders&#39;,
    purge_time      =&gt; &#39;2006-08-16 13:00:00&#39;);
END;
/
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BABGDADC"></a>
<div id="STREP481" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Dropping a Comparison<a id="sthref668"></a></h2>
<p>To drop a comparison and all of its comparison results, use the <code dir="ltr">DROP_COMPARISON</code> procedure in the <code dir="ltr">DBMS_COMPARISON</code> package. For example, to drop a comparison named <code dir="ltr">compare_subset_columns</code>, log in to SQL*Plus as the owner of the comparison, and run the following procedure:</p>
<pre dir="ltr">exec DBMS_COMPARISON.DROP_COMPARISON(&#39;compare_subset_columns&#39;);
</pre></div>
<!-- class="sect1" -->
<a id="BABHIHIB"></a>
<div id="STREP148" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using DBMS_COMPARISON in an Oracle Streams Replication Environment<a id="sthref669"></a><a id="sthref670"></a></h2>
<p>This section describes the typical uses for the <code dir="ltr">DBMS_COMPARISON</code> package in an Oracle Streams replication environment. These uses are:</p>
<ul>
<li>
<p><a href="#BABEHCGE">Checking for Consistency After Instantiation</a></p>
</li>
<li>
<p><a href="#BABGAHIA">Checking for Consistency in a Running Oracle Streams Replication Environment</a></p>
</li>
</ul>
<a id="BABEHCGE"></a>
<div id="STREP482" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Checking for Consistency After Instantiation</h3>
<p>After an instantiation, you can use the <code dir="ltr">DBMS_COMPARISON</code> package to verify the consistency of the database objects that were instantiated. Typically, you should verify consistency before the Oracle Streams replication environment is replicating changes. Ensure that you check for consistency before you allow changes to the source database object and the instantiated database object. Changes to these database objects are identified as differences by the <code dir="ltr">DBMS_COMPARISON</code> package.</p>
<p>To verify the consistency of instantiated database objects, complete the following steps:</p>
<ol>
<li>
<p>Create a comparison for each database object that was instantiated using the <code dir="ltr">CREATE_COMPARISON</code> procedure. Each comparison should specify the database object that was instantiated and its corresponding database object at the source database.</p>
<p>When you run the <code dir="ltr">CREATE_COMPARISON</code> procedure, ensure that the <code dir="ltr">comparison_mode</code>, <code dir="ltr">scan_mode</code>, and <code dir="ltr">scan_percent</code> parameters are set to their default values of <code dir="ltr">CMP_COMPARE_MODE_OBJECT</code>, <code dir="ltr">CMP_SCAN_MODE_FULL</code>, and <code dir="ltr">NULL</code>, respectively.</p>
</li>
<li>
<p>Run the <code dir="ltr">COMPARE</code> function to compare each database object that was instantiated. The database objects are consistent if no differences are found.</p>
<p>When you run the <code dir="ltr">COMPARE</code> function, ensure that the <code dir="ltr">min_value</code>, <code dir="ltr">max_value</code>, and <code dir="ltr">perform_row_dif</code> parameters are set to their default values of <code dir="ltr">NULL</code>, <code dir="ltr">NULL</code>, and <code dir="ltr">FALSE</code>, respectively.</p>
</li>
<li>
<p>If differences are found by the <code dir="ltr">COMPARE</code> function, then you can either re-instantiate the database objects or use the <code dir="ltr">CONVERGE</code> procedure to converge them. If you use the <code dir="ltr">CONVERGE</code> procedure, then typically the source database object should &#34;win&#34; during convergence.</p>
</li>
<li>
<p>When the comparison results show that the database objects are consistent, you can purge the comparison results using the <code dir="ltr">PURGE_COMPARISON</code> procedure.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CEGFBCAG">&#34;Comparing a Shared Database Object at Two Databases&#34;</a> for instructions about creating a comparison with the <code dir="ltr">CREATE_COMPARISON</code> procedure and comparing database objects with the <code dir="ltr">COMPARE</code> function</p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a></p>
</li>
<li>
<p><a href="#BABDHBFI">&#34;Purging Comparison Results&#34;</a></p>
</li>
<li>
<p><a href="instant.htm#g1012655">Chapter 8, &#34;Instantiation and Oracle Streams Replication&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="BABGAHIA"></a>
<div id="STREP483" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Checking for Consistency in a Running Oracle Streams Replication Environment</h3>
<p>Oracle Streams replication environments continually replicate changes to database objects. Therefore, the following applies to the replicated database objects:</p>
<ul>
<li>
<p>Replicated database objects should be nearly synchronized most of the time because Oracle Streams components replicate and apply changes to keep them synchronized.</p>
</li>
<li>
<p>If there are differences in replicated database objects, then Oracle Streams components will typically send and apply changes to synchronize the database objects in the near future. That is, a <code dir="ltr">COMPARE</code> function might show differences that are in the process of being replicated.</p>
</li>
</ul>
<p>Because differences are expected in database objects while changes are being replicated, using the <code dir="ltr">DBMS_COMPARISON</code> package to compare replicated database objects can be challenging. For example, assume that there is an existing comparison that compares an entire table at two databases, and consider the following scenario:</p>
<ol>
<li id="BABDDHAJ">
<p>A change is made to a row in the table at one of the databases.</p>
</li>
<li>
<p>The change is captured by an Oracle Streams capture process, but it has not yet been propagated to the other database.</p>
</li>
<li>
<p>The <code dir="ltr">COMPARE</code> function is run to compare the table tables at the two databases.</p>
</li>
<li id="BABBBAJE">
<p>The <code dir="ltr">COMPARE</code> function identifies a difference in the row that was changed in Step&nbsp;<a href="#BABDDHAJ">1</a>.</p>
</li>
<li>
<p>The change is propagated and applied at the destination database. Therefore, the difference identified in Step <a href="#BABBBAJE">4</a> no longer exists.</p>
</li>
</ol>
<p>When differences are found, and you suspect that the differences are transient, you can run the <code dir="ltr">RECHECK</code> function after some time has passed. If Oracle Streams has synchronized the database objects, then the differences will disappear.</p>
<p>If some rows in a replicated database object are constantly updated, then these rows might always show differences in comparison results. In this case, as you monitor the environment, ensure the following:</p>
<ul>
<li>
<p>No apply errors are accumulating at the destination database for these rows.</p>
</li>
<li>
<p>The rows are being updated correctly by the Oracle Streams apply process at the destination database. You can query the table that contains the rows at the destination database to ensure that the replicated changes are being applied.</p>
</li>
</ul>
<p>When both of these statements are true for the rows, then you can ignore differences in the comparison results for them.</p>
<p>Because the <code dir="ltr">COMPARE</code> function might show differences that are in the process of being replicated, it is best to run this function during times when there is the least amount of replication activity in your environment. During times of relatively little replication activity, comparison results show the following types of differences in an Oracle Streams replication environment:</p>
<ul>
<li>
<p>Differences resulting when rows are manually manipulated at only one database by an administrator or procedure. For example, an administrator or procedure might set a session tag before making changes, and the session tag might prevent a capture process from capturing the changes.</p>
</li>
<li>
<p>Differences resulting from recovery situations in which data is lost at one database and must be identified and recovered from another database.</p>
</li>
<li>
<p>Differences resulting from apply errors. In this case, the error transactions are not applied at one database because of apply errors.</p>
</li>
</ul>
<p>In any of these situations, you can run the <code dir="ltr">CONVERGE</code> procedure to synchronize the database objects if it is appropriate. For example, if there are apply errors, and it is not easy to reexecute the error transactions, then you can use the <code dir="ltr">CONVERGE</code> procedure to synchronize the database objects.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CEGFBCAG">&#34;Comparing a Shared Database Object at Two Databases&#34;</a> for instructions on creating a comparison with the <code dir="ltr">CREATE_COMPARISON</code> procedure and comparing database objects with the <code dir="ltr">COMPARE</code> function</p>
</li>
<li>
<p><a href="#BABBHCCC">Rechecking the Comparison Results for a Comparison</a> for information about the <code dir="ltr">RECHECK</code> function</p>
</li>
<li>
<p><a href="#CEGIABII">&#34;Converging a Shared Database Object&#34;</a></p>
</li>
<li>
<p><a href="rep_tags.htm#g1014437">Chapter 10, &#34;Oracle Streams Tags&#34;</a></p>
</li>
<li>
<p><a class="olink STRMS112" href="../STRMS/strms_mapply.htm#STRMS112"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about apply errors</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment91">
<tr>
<td class="cellalignment98">
<table class="cellalignment96">
<tr>
<td class="cellalignment95"><a href="man_gen_rep.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment95"><a href="man_lcrs.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment100">
<table class="cellalignment94">
<tr>
<td class="cellalignment95"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment95"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment95"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment95"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment95"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment95"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>