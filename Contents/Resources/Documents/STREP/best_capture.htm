<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104186"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Best%20Practices%20for%20Capture"></a><title>Best Practices for Capture</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1044"/>
<meta name="dcterms.created" content="2015-02-12T7:14:20Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Replication Administrator&#39;s Guide"/>
<meta name="dcterms.identifier" content="E53118-02"/>
<meta name="dcterms.isVersionOf" content="STREP"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="best_gen.htm" title="Previous" type="text/html"/>
<link rel="Next" href="best_prop.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53118-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">23/28</span> <!-- End Header -->
<div id="STREP519" class="chapter"><a id="CHDCDGGE"></a>
<h1 class="chapter"><span class="secnum">16</span> Best Practices for Capture</h1>
<p><a id="sthref744"></a>This chapter describes the best practices for capturing changes with a capture process or a synchronous capture in an Oracle Streams replication environment. This chapter includes these topics:</p>
<ul>
<li>
<p><a href="#CHDBACHF">Best Practices for Capture Process Configuration</a></p>
</li>
<li>
<p><a href="#CHDJGABJ">Best Practices for Capture Process Operation</a></p>
</li>
<li>
<p><a href="#CHDDDIEE">Best Practices for Synchronous Capture Configuration</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="best_gen.htm#CHDIAIGF">&#34;Best Practices for Oracle Real Application Clusters and Oracle Streams&#34;</a></p>
</li>
<li>
<p><a href="prep_rep.htm#g1024216">Chapter 1, &#34;Preparing for Oracle Streams Replication&#34;</a> describes best practices to follow when preparing for Oracle Streams capture processes</p>
</li>
</ul>
</div>
<a id="CHDBACHF"></a>
<div id="STREP520" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Best Practices for Capture Process Configuration<a id="sthref745"></a><a id="sthref746"></a></h2>
<p>The following sections describe best practices for configuring capture processes:</p>
<ul>
<li>
<p><a href="#CFHHEDCA">Grant the Required Privileges to the Capture User</a></p>
</li>
<li>
<p><a href="#CHDFJFBH">Set Capture Process Parallelism</a></p>
</li>
<li>
<p><a href="#CHDDECGD">Set the Checkpoint Retention Time</a></p>
</li>
</ul>
<a id="CFHHEDCA"></a>
<div id="STREP590" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Grant the Required Privileges to the Capture User<a id="sthref747"></a><a id="sthref748"></a></h3>
<p>The capture user is the user in whose security domain a capture process captures changes that satisfy its rule sets and runs custom rule-based transformations configured for capture process rules.</p>
<p>The capture user for a capture process is configured when you create a capture process, and the capture user can be modified when you alter a capture process. Grant the following privileges to the apply user:</p>
<ul>
<li>
<p><code dir="ltr">EXECUTE</code> privilege on the rule sets used by the capture process</p>
</li>
<li>
<p><code dir="ltr">EXECUTE</code> privilege on all rule-based transformation functions used in the positive rule set</p>
</li>
</ul>
<p>These privileges can be granted directly to the capture user, or they can be granted through roles.</p>
<p>In addition, the capture user must be granted <code dir="ltr">EXECUTE</code> privilege on all packages, including Oracle-supplied packages, that are invoked in rule-based transformations run by the capture process. These privileges must be granted directly to the capture user. They cannot be granted through roles.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink DBSEG004" href="../DBSEG/authorization.htm#DBSEG004"><span class="italic">Oracle Database Security Guide</span></a> for general information about granting privileges</p>
</li>
<li>
<p><a class="olink STRMS012" href="../STRMS/strms_mrules.htm#STRMS012"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about granting privileges on rule sets</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDFJFBH"></a>
<div id="STREP521" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Set Capture Process Parallelism<a id="sthref749"></a><a id="sthref750"></a></h3>
<p>Set the parallelism of each capture process by specifying the <code dir="ltr">parallelism</code> parameter in the <code dir="ltr">DBMS_CAPTURE_ADM.SET_PARAMETER</code> procedure. The <code dir="ltr">parallelism</code> parameter controls the number of processes that concurrently mine the redo log for changes.</p>
<p>The default setting for the <code dir="ltr">parallelism</code> capture process parameter is <code dir="ltr">1</code>, and the default <code dir="ltr">parallelism</code> setting is appropriate for most capture process configurations. Ensure that the <code dir="ltr">PROCESSES</code> initialization parameter is set appropriately when you set the <code dir="ltr">parallelism</code> capture process parameter.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS002" href="../STRMS/strms_capture.htm#STRMS002"><span class="italic">Oracle Streams Concepts and Administration</span></a></p>
</li>
<li>
<p><a class="olink ARPLS306" href="../ARPLS/d_cap_a.htm#ARPLS306"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDDECGD"></a>
<div id="STREP522" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Set the Checkpoint Retention Time<a id="sthref751"></a><a id="sthref752"></a></h3>
<p>Set the checkpoint retention time for each capture process. Periodically, a capture process takes a checkpoint to facilitate quicker restart. These checkpoints are maintained in the <code dir="ltr">SYSAUX</code> tablespace by default. The checkpoint retention time for a capture process controls the amount of checkpoint data it retains. The checkpoint retention time specifies the number of days before the required checkpoint SCN to retain checkpoints. When a checkpoint is older than the specified time period, the capture process purges the checkpoint.</p>
<p>When checkpoints are purged, the first SCN for the capture process moves forward, and Oracle Database writes a message including the text &#34;first scn changed&#34; to the alert log. The first SCN is the lowest possible SCN available for capturing changes. The checkpoint retention time is set when you create a capture process, and it can be set when you alter a capture process. When the checkpoint retention time is exceeded, the first SCN is moved forward, and the Oracle Streams metadata tables before this new first SCN are purged. The space used by these tables in the <code dir="ltr">SYSAUX</code> tablespace is reclaimed. To alter the checkpoint retention time for a capture process, use the <code dir="ltr">ALTER_CAPTURE</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package and specify the new retention time with the <code dir="ltr">checkpoint_retention_time</code> parameter.</p>
<p>The default value for the checkpoint retention time is <code dir="ltr">60</code> days. If checkpoints are available for a time in the past, then the capture process can recapture changes to recover a destination database. You should set the checkpoint retention time to an appropriate value for your environment. A typical setting is <code dir="ltr">7</code> days.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS152" href="../STRMS/strms_adcapture.htm#STRMS152"><span class="italic">Oracle Streams Concepts and Administration</span></a></p>
</li>
<li>
<p><a class="olink ARPLS302" href="../ARPLS/d_cap_a.htm#ARPLS302"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">ALTER_CAPTURE</code> procedure</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDJGABJ"></a>
<div id="STREP523" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Best Practices for Capture Process Operation<a id="sthref753"></a><a id="sthref754"></a></h2>
<p>The following sections describe best practices for operating existing capture processes:</p>
<ul>
<li>
<p><a href="#CHDGDDDC">Configure a Heartbeat Table at Each Source Database in an Oracle Streams Environment</a></p>
</li>
<li>
<p><a href="#CHDGCFJD">Perform a Dictionary Build and Prepare Database Objects for Instantiation Periodically</a></p>
</li>
<li>
<p><a href="#CHDGJEJC">Minimize the Performance Impact of Batch Processing</a></p>
</li>
</ul>
<a id="CHDGDDDC"></a>
<div id="STREP524" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configure a Heartbeat Table at Each Source Database in an Oracle Streams Environment<a id="sthref755"></a><a id="sthref756"></a></h3>
<p>You can use a heartbeat table to ensure that changes are being replicated in an Oracle Streams replication environment. Specifically, you can check the <code dir="ltr">APPLIED_SCN</code> value in the <code dir="ltr">DBA_CAPTURE</code> data dictionary view at the capture database to ensure that it is updated periodically. A heartbeat table is especially useful for databases that have a low activity rate because you can ensure that the replication environment is working properly even if there are few replicated changes.</p>
<p>An Oracle Streams capture process requests a checkpoint after every 10 MB of generated redo. During the checkpoint, the metadata for Oracle Streams is maintained if there are active transactions. Implementing a heartbeat table ensures that there are open transactions occurring regularly in the source database, thereby providing additional opportunities for the metadata to be updated frequently. Additionally, the heartbeat table provides quick feedback to the database administrator about the health of the Oracle Streams replication environment.</p>
<p>To implement a heartbeat table, complete the following steps:</p>
<ol>
<li>
<p>Create a table at the source database that includes a date or time stamp column and the global name of the source database.</p>
</li>
<li>
<p>Instantiate the table at the destination database. If there are multiple destination databases, then instantiate the heartbeat table at each destination database.</p>
</li>
<li>
<p>Add a rule to the positive rule set for the capture process that captures changes to the source database. The rule instructs the capture process to capture changes to the heartbeat table.</p>
</li>
<li>
<p>Add a rule to the positive rule set for the propagation that propagates changes from the source database to the destination database. The rule instructs the propagation to propagate LCRs for the heartbeat table. If there are multiple propagations, then add the rule to the rule set for each propagation. If your environment uses directed networks, then you might need to add rules to propagations at several databases.</p>
</li>
<li>
<p>Add a rule to the positive rule set for the apply process that applies changes that originated at the source database. The rule instructs the apply process to apply changes to the heartbeat table. If there are multiple apply processes at multiple databases that apply the changes that originated at the source database, then add a rule to each the apply process.</p>
</li>
<li>
<p>Configure an automated job to update the heartbeat table at the source database periodically. For example, the table might be updated every minute.</p>
</li>
<li>
<p>Monitor the Oracle Streams replication environment to verify that changes to the heartbeat table at the source database are being replicated to the destination database.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDGCFJD"></a>
<div id="STREP525" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Perform a Dictionary Build and Prepare Database Objects for Instantiation Periodically<a id="sthref757"></a><a id="sthref758"></a><a id="sthref759"></a><a id="sthref760"></a></h3>
<p>Perform a data dictionary build in the source database redo periodically. Run the <code dir="ltr">DBMS_CAPTURE_ADM.BUILD</code> procedure to build a current copy of the data dictionary in the redo log. Ideally, database objects should be prepared for instantiation after a build is performed. Run one or more of the following procedures in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package to prepare database objects for instantiation:</p>
<ul>
<li>
<p><code dir="ltr">PREPARE_GLOBAL_INSTANTIATION</code></p>
</li>
<li>
<p><code dir="ltr">PREPARE_SCHEMA_INSTANTIATION</code></p>
</li>
<li>
<p><code dir="ltr">PREPARE_TABLE_INSTANTIATION</code></p>
</li>
</ul>
<p>Each of the database objects for which a capture process captures changes should be prepared for instantiation periodically. You can reduce the amount of redo data that must be processed if additional capture process are created or if an existing capture process must be re-created by performing a build and preparing shared objects for instantiation periodically.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS123" href="../STRMS/strms_capture.htm#STRMS123"><span class="italic">Oracle Streams Concepts and Administration</span></a></p>
</li>
<li>
<p><a href="instant.htm#i1007217">&#34;Capture Rules and Preparation for Instantiation&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDGJEJC"></a>
<div id="STREP526" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Minimize the Performance Impact of Batch Processing<a id="sthref761"></a><a id="sthref762"></a><a id="sthref763"></a></h3>
<p>For best performance, the commit point for a batch processing job should be kept low. Also, if a large batch processing job must be run at a source database, then consider running it at each Oracle Streams replication database independently. If this technique is used, then ensure that the changes resulting from the batch processing job are not replicated. To accomplish this, run the <code dir="ltr">DBMS_STREAMS.SET_TAG</code> procedure in the session that runs the batch processing job, and set the session tag to a value that <span class="italic">will not</span> be captured by a capture process.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rep_tags.htm#g1014437">Chapter 10, &#34;Oracle Streams Tags&#34;</a></div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDDDIEE"></a>
<div id="STREP527" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Best Practices for Synchronous Capture Configuration<a id="sthref764"></a><a id="sthref765"></a></h2>
<p>Creating and managing a synchronous capture is simplified when you use the <code dir="ltr">DBMS_STREAMS_ADM</code> package. Specifically, use the following procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create a synchronous capture and configure synchronous capture rules:</p>
<ul>
<li>
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</li>
<li>
<p><code dir="ltr">ADD_SUBSET_RULES</code></p>
</li>
</ul>
<p>Also, use the <code dir="ltr">REMOVE_RULE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to remove a rule from a synchronous capture rule set or to drop a rule in a synchronous capture rule set.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="ccap.htm#BEHCGJFF">&#34;Configuring Synchronous Capture&#34;</a></div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment91">
<tr>
<td class="cellalignment98">
<table class="cellalignment96">
<tr>
<td class="cellalignment95"><a href="best_gen.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment95"><a href="best_prop.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment100">
<table class="cellalignment94">
<tr>
<td class="cellalignment95"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment95"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment95"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment95"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment95"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment95"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>