<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104187"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Best%20Practices%20for%20Oracle%20Streams%20Replication%20Databases"></a><title>Best Practices for Oracle Streams Replication Databases</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1044"/>
<meta name="dcterms.created" content="2015-02-12T7:14:20Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Replication Administrator&#39;s Guide"/>
<meta name="dcterms.identifier" content="E53118-02"/>
<meta name="dcterms.isVersionOf" content="STREP"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="ptrep_best.htm" title="Previous" type="text/html"/>
<link rel="Next" href="best_capture.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53118-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">22/28</span> <!-- End Header -->
<div id="STREP501" class="chapter"><a id="CDDHIJDB"></a>
<h1 class="chapter"><span class="secnum">15</span> Best Practices for Oracle Streams Replication Databases</h1>
<p>An Oracle Streams replication database is a database that participates in an Oracle Streams replication environment. An Oracle Streams replication environment uses Oracle Streams clients to replicate database changes from one database to another. Oracle Streams clients include capture processes, synchronous captures, propagations, and apply processes. This chapter describes general best practices for Oracle Streams replication databases.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#CHDBDCEA">Best Practices for Oracle Streams Database Configuration</a></p>
</li>
<li>
<p><a href="#CHDEJGHB">Best Practices for Oracle Streams Database Operation</a></p>
</li>
<li>
<p><a href="#CHDIAIGF">Best Practices for Oracle Real Application Clusters and Oracle Streams</a></p>
</li>
</ul>
<a id="CHDBDCEA"></a>
<div id="STREP502" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Best Practices for Oracle Streams Database Configuration<a id="sthref716"></a></h2>
<p>For your Oracle Streams replication environment to run properly and efficiently, follow the best practices in this section when you are configuring the environment. This section contains these topics:</p>
<ul>
<li>
<p><a href="#CHDCAHJI">Use a Separate Queue for Capture and Apply Oracle Streams Clients</a></p>
</li>
<li>
<p><a href="#CHDJGICA">Automate the Oracle Streams Replication Configuration</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="prep_rep.htm#g1024216">Chapter 1, &#34;Preparing for Oracle Streams Replication&#34;</a> describes best practices to follow when preparing for Oracle Streams replication</div>
<a id="CHDCAHJI"></a>
<div id="STREP503" class="sect2">
<h3 class="sect2">Use a Separate Queue for Capture and Apply Oracle Streams Clients</h3>
<p>Configure a separate queue for each capture process, for each synchronous capture, and for each apply process, and ensure that each queue has its own queue table. Using separate queues is especially important when configuring bidirectional replication between two databases or when a single database receives messages from several other databases.</p>
<p>For example, suppose a database called <code dir="ltr">db1</code> is using a capture process to capture changes that will be sent to other databases and is receiving changes from a database named <code dir="ltr">db2</code>. The changes received from <code dir="ltr">db2</code> are applied by an apply process running on <code dir="ltr">db1</code>. In this scenario, create a separate queue for the capture process and apply process at <code dir="ltr">db1</code>, and ensure that these queues use different queue tables.</p>
<p>The following example creates the queue for the capture process. The queue name is <code dir="ltr">capture_queue</code>, and this queue uses queue table <code dir="ltr">qt_capture_queue</code>:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.qt_capture_queue&#39;,
    queue_name  =&gt; &#39;strmadmin.capture_queue&#39;);
END;
/
</pre>
<p>The following example creates the queue for the apply process. The queue name is <code dir="ltr">apply_queue</code>, and this queue uses queue table <code dir="ltr">qt_apply_queue</code>:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.qt_apply_queue&#39;,
    queue_name  =&gt; &#39;strmadmin.apply_queue&#39;);
END;
/
</pre>
<p>Subsequently, specify the queue <code dir="ltr">strmadmin.capture_queue</code> when you configure the capture process at <code dir="ltr">db1</code>, and specify the queue <code dir="ltr">strmadmin.apply_queue</code> when you configure the apply process at <code dir="ltr">db1</code>. If necessary, the <code dir="ltr">SET_UP_QUEUE</code> procedure lets you specify a <code dir="ltr">storage_clause</code> parameter to configure separate tablespace and storage specifications for each queue table.</p>
<p>If you automate the configuration, as described in <a href="#CHDJGICA">&#34;Automate the Oracle Streams Replication Configuration&#34;</a>, then each Oracle Streams client is configured with its own queue automatically.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="cprop.htm#i1006170">&#34;Creating an ANYDATA Queue&#34;</a></p>
</li>
<li>
<p><a href="ccap.htm#i1006171">&#34;Configuring a Capture Process&#34;</a></p>
</li>
<li>
<p><a href="capply.htm#CHDCACFH">Chapter 7, &#34;Configuring Implicit Apply&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDJGICA"></a>
<div id="STREP504" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Automate the Oracle Streams Replication Configuration<a id="sthref717"></a></h3>
<p>Use the following procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create your Oracle Streams replication environment whenever possible:</p>
<ul>
<li>
<p><a class="olink ARPLS825" href="../ARPLS/d_streams_adm.htm#ARPLS825"><code dir="ltr">MAINTAIN_GLOBAL</code></a> configures an Oracle Streams environment that replicates changes at the database level between two databases.</p>
</li>
<li>
<p><a class="olink ARPLS826" href="../ARPLS/d_streams_adm.htm#ARPLS826"><code dir="ltr">MAINTAIN_SCHEMAS</code></a> configures an Oracle Streams environment that replicates changes to specified schemas between two databases.</p>
</li>
<li>
<p><a class="olink ARPLS863" href="../ARPLS/d_streams_adm.htm#ARPLS863"><code dir="ltr">MAINTAIN_SIMPLE_TTS</code></a> clones a simple tablespace from a source database at a destination database and uses Oracle Streams to maintain this tablespace at both databases.</p>
</li>
<li>
<p><a class="olink ARPLS827" href="../ARPLS/d_streams_adm.htm#ARPLS827"><code dir="ltr">MAINTAIN_TABLES</code></a> configures an Oracle Streams environment that replicates changes to specified tables between two databases.</p>
</li>
<li>
<p><a class="olink ARPLS864" href="../ARPLS/d_streams_adm.htm#ARPLS864"><code dir="ltr">MAINTAIN_TTS</code></a> clones a set of tablespaces from a source database at a destination database and uses Oracle Streams to maintain these tablespaces at both databases.</p>
</li>
<li>
<p><a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> and <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> configure an Oracle Streams environment that replicates changes either at the database level or to specified tablespaces between two databases. These procedures must be used together, and instantiation actions must be performed manually, to complete the Oracle Streams replication configuration.</p>
</li>
</ul>
<p>These procedures automate the entire configuration of the Oracle Streams clients at multiple databases. Further, the configuration follows Oracle Streams best practices. For example, these procedures create queue-to-queue propagations whenever possible.</p>
<p>If these procedures are not suitable for your environment, then use the following procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create Oracle Streams clients, rules sets, and rules:</p>
<ul>
<li>
<p><a class="olink ARPLS308" href="../ARPLS/d_streams_adm.htm#ARPLS308"><code dir="ltr">ADD_TABLE_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS329" href="../ARPLS/d_streams_adm.htm#ARPLS329"><code dir="ltr">ADD_SUBSET_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS309" href="../ARPLS/d_streams_adm.htm#ARPLS309"><code dir="ltr">ADD_SCHEMA_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS310" href="../ARPLS/d_streams_adm.htm#ARPLS310"><code dir="ltr">ADD_GLOBAL_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS316" href="../ARPLS/d_streams_adm.htm#ARPLS316"><code dir="ltr">ADD_TABLE_PROPAGATION_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS394" href="../ARPLS/d_streams_adm.htm#ARPLS394"><code dir="ltr">ADD_SUBSET_PROPAGATION_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS317" href="../ARPLS/d_streams_adm.htm#ARPLS317"><code dir="ltr">ADD_SCHEMA_PROPAGATION_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS318" href="../ARPLS/d_streams_adm.htm#ARPLS318"><code dir="ltr">ADD_GLOBAL_PROPAGATION_RULES</code></a></p>
</li>
</ul>
<p>These procedures minimize the number of steps required to configure Oracle Streams clients. It is also possible to create rules for nonexistent objects, so ensure that you check the spelling of each object specified in a rule carefully.</p>
<p>Although it is typically not recommended, a propagation or apply process can be used without rule sets or rules if you always want to propagate or apply all of the messages in a queue. However, a capture process requires one or more rule sets with rules, and a synchronous capture requires a positive rule set. You can use the <code dir="ltr">ADD_GLOBAL_RULES</code> procedure to capture data manipulation language (DML) changes to an entire database with a capture process if a negative rule set is configured for the capture process to filter out changes to unsupported objects. You can also use the <code dir="ltr">ADD_GLOBAL_RULES</code> procedure to capture all data definition language (DDL) changes to the database with a capture process.</p>
<p>The rules in the rule set for a propagation can differ from the rules specified for a capture process or a synchronous capture. For example, to configure that all captured changes be propagated to a destination database, you can run the <code dir="ltr">ADD_GLOBAL_PROPAGATION_RULES</code> procedure for the propagation even though multiple rules might have been configured using <code dir="ltr">ADD_TABLE_RULES</code> for the capture process or synchronous capture. Similarly, the rules in the rule set for an apply process can differ from the rules specified for the capture process, synchronous capture, and propagation(s) that capture and propagate messages to the apply process.</p>
<p>An Oracle Streams client can process changes for multiple tables or schemas. For the best performance, ensure that the rules for these multiple tables or schemas are simple. Complex rules will impact the performance of Oracle Streams. For example, rules with conditions that include <code dir="ltr">LIKE</code> clauses are complex. When you use a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create rules, the rules are always simple.</p>
<p>When you configure multiple source databases in an Oracle Streams replication environment, change cycling should be avoided. Change cycling means sending a change back to the database where it originated. You can use Oracle Streams tags to prevent change cycling.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="config_simple.htm#CACJHHAA">&#34;Configuring Replication Using the DBMS_STREAMS_ADM Package&#34;</a></p>
</li>
<li>
<p><a href="best_prop.htm#CEGEEBFH">&#34;Use Queue-to-Queue Propagations&#34;</a></p>
</li>
<li>
<p><a href="rep_tags.htm#i1007693">&#34;Oracle Streams Tags in a Replication Environment&#34;</a> for information about using Oracle Streams tags to avoid change cycling</p>
</li>
<li>
<p><a class="olink STRMS005" href="../STRMS/strms_adrules.htm#STRMS005"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about simple and complex rules</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDEJGHB"></a>
<div id="STREP505" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Best Practices for Oracle Streams Database Operation<a id="sthref718"></a></h2>
<p>After the Oracle Streams replication environment is configured, follow the best practices in this section to keep it running properly and efficiently. This section contains these topics:</p>
<ul>
<li>
<p><a href="#CHDFEGAC">Follow the Best Practices for the Global Name of an Oracle Streams Database</a></p>
</li>
<li>
<p><a href="#CHDFIEHF">Monitor Performance and Make Adjustments When Necessary</a></p>
</li>
<li>
<p><a href="#CHDEAFJE">Monitor Capture Process&#39;s and Synchronous Capture&#39;s Queues for Size</a></p>
</li>
<li>
<p><a href="#CHDGIJGI">Follow the Oracle Streams Best Practices for Backups</a></p>
</li>
<li>
<p><a href="#CHDHCBJE">Adjust the Automatic Collection of Optimizer Statistics</a></p>
</li>
<li>
<p><a href="#CHDDFDCB">Check the Alert Log for Oracle Streams Information</a></p>
</li>
<li>
<p><a href="#CHDFHEBF">Follow the Best Practices for Removing an Oracle Streams Configuration at a Database</a></p>
</li>
</ul>
<a id="CHDFEGAC"></a>
<div id="STREP506" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Follow the Best Practices for the Global Name of an Oracle Streams Database<a id="sthref719"></a><a id="sthref720"></a></h3>
<p>Oracle Streams uses the global name of a database to identify changes from or to a particular database. For example, the system-generated rules for capture, propagation, and apply typically specify the global name of the source database. In addition, changes captured by an Oracle Streams capture process or synchronous capture automatically include the current global name of the source database. If possible, do not modify the global name of a database that is participating in an Oracle Streams replication environment after the environment has been configured. The <code dir="ltr">GLOBAL_NAMES</code> initialization parameter must also be set to <code dir="ltr">TRUE</code> to guarantee that database link names match the global name of each destination database.</p>
<p>If the global name of an Oracle Streams database must be modified, then do so at a time when no user changes are possible on the database, the queues are empty, and no outstanding changes must be applied by any apply process. When these requirements are met, you can modify the global name of a database and re-create the parts of the Oracle Streams configuration that reference the modified database. All queue subscribers, including propagations and apply processes, must be re-created if the source database global name is changed.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="man_gen_rep.htm#i1019206">&#34;Changing the DBID or Global Name of a Source Database&#34;</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDFIEHF"></a>
<div id="STREP507" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Monitor Performance and Make Adjustments When Necessary<a id="sthref721"></a><a id="sthref722"></a><a id="sthref723"></a><a id="sthref724"></a><a id="sthref725"></a></h3>
<p>For Oracle Database 11<span class="italic">g</span> Release 1 (11.1) and later databases, the Oracle Streams Performance Advisor provides information about how Oracle Streams components are performing. You can use this advisor to monitor the performance of multiple Oracle Streams components in your environment and make adjustments to improve performance when necessary.</p>
<p>The <code dir="ltr">UTL_SPADV</code> package also provides performance statistics for an Oracle Streams environment. This package uses the Oracle Streams Performance Advisor to gather performance statistics. The package enables you to format the statistics in output that can be imported into a spreadsheet for analysis.</p>
<p>For databases before Oracle Database 11<span class="italic">g</span> Release 1 (11.1), you can use <code dir="ltr">STRMMON</code> to monitor the performance of an Oracle Streams environment. You can use this tool to obtain a quick overview of the Oracle Streams activity in a database. <code dir="ltr">STRMMON</code> reports information in a single line display. You can configure the reporting interval and the number of iterations to display. <code dir="ltr">STRMMON</code> is available in the <code dir="ltr">rdbms/demo</code> directory in your Oracle home.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STRMS170" href="../STRMS/strms_topology.htm#STRMS170"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about the Oracle Streams Performance Advisor</p>
</li>
<li>
<p><a class="olink ARPLS883" href="../ARPLS/u_spadv.htm#ARPLS883"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">UTL_SPADV</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDEAFJE"></a>
<div id="STREP508" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Monitor Capture Process&#39;s and Synchronous Capture&#39;s Queues for Size<a id="sthref726"></a><a id="sthref727"></a></h3>
<p>You should monitor the queues used by a capture process to check for queue size. The number of messages in a queue used by a capture process or synchronous capture increases if the messages in the queue cannot be propagated to one or more destination queues. When a source queue becomes large, it often indicates that there is a problem with the Oracle Streams replication environment. Common reasons why messages cannot be propagated include the following:</p>
<ul>
<li>
<p>One of the destination databases is down for an extended period.</p>
</li>
<li>
<p>An apply process at a destination database is disabled for an extended period.</p>
</li>
<li>
<p>The queue is the source queue for a propagation that cannot deliver the messages to a particular destination queue for an extended period due to network problems or propagation job problems.</p>
</li>
</ul>
<p>When a capture process&#39;s queue becomes large, the capture process pauses for flow control to minimize the number of messages that are spilled to disk. You can monitor the number of messages in a capture process&#39;s queue by querying the <code dir="ltr">V$BUFFERED_QUEUES</code> dynamic performance view. This view shows the number of messages in memory and the number of messages spilled to disk.</p>
<p>You can monitor the number of messages in a synchronous capture&#39;s queue by querying the <code dir="ltr">V$PERSISTENT_QUEUES</code> or <code dir="ltr">V$AQ</code> dynamic performance view. This view shows the number of messages in different message states in the persistent queue.</p>
<p>Propagation is implemented using Oracle Scheduler. If a job cannot execute 16 successive times, the job is marked as &#34;broken&#34; and is aborted. Check propagation jobs periodically to ensure that they are running successfully to minimize the size of the source queue.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="best_prop.htm#CEGFFDCC">&#34;Restart Broken Propagations&#34;</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDGIJGI"></a>
<div id="STREP509" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Follow the Oracle Streams Best Practices for Backups<a id="sthref728"></a><a id="sthref729"></a></h3>
<p>The following sections contain information about best practices for backing up source databases and destination databases in an Oracle Streams replication environment. A single database can be both a source database and a destination database.</p>
<div id="STREP510" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref730"></a>
<h4 class="sect3">Best Practices for Backups of an Oracle Streams Source Database</h4>
<p>A source database is a database where changes captured by a capture process are generated in a redo log or a database where an Oracle Streams synchronous capture is configured. Follow these best practices for backups of an Oracle Streams source database:</p>
<ul>
<li>
<p>Use an Oracle Streams tag in the session that runs the online backup SQL statements to ensure that the capture process which captures changes to the source database <span class="italic">will not</span> capture the backup statements. An online backup statement uses the <code dir="ltr">BEGIN</code> <code dir="ltr">BACKUP</code> and <code dir="ltr">END</code> <code dir="ltr">BACKUP</code> clauses in an <code dir="ltr">ALTER</code> <code dir="ltr">TABLESPACE</code> or <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> statement. To set an Oracle Streams session tag, use the <code dir="ltr">DBMS_STREAMS.SET_TAG</code> procedure.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Backups performed using Recovery Manager (RMAN) do not need to set an Oracle Streams session tag.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rep_tags.htm#g1014437">Chapter 10, &#34;Oracle Streams Tags&#34;</a></div>
</li>
<li>
<p>Do not allow any automated backup of the archived logs that might remove archive logs required by a capture process. It is especially important in an Oracle Streams environment that all required archive log files remain available online and in the expected location until the capture process has finished processing them. If a log required by a capture process is unavailable, then the capture process will abort.</p>
<p>To list each required archive redo log file in a database, run the following query:</p>
<pre dir="ltr">COLUMN CONSUMER_NAME HEADING &#39;Capture|Process|Name&#39; FORMAT A15
COLUMN SOURCE_DATABASE HEADING &#39;Source|Database&#39; FORMAT A10
COLUMN SEQUENCE# HEADING &#39;Sequence|Number&#39; FORMAT 99999
COLUMN NAME HEADING &#39;Required|Archived Redo Log|File Name&#39; FORMAT A40
 
SELECT r.CONSUMER_NAME,
       r.SOURCE_DATABASE,
       r.SEQUENCE#, 
       r.NAME 
  FROM DBA_REGISTERED_ARCHIVED_LOG r, DBA_CAPTURE c
  WHERE r.CONSUMER_NAME =  c.CAPTURE_NAME AND
        r.NEXT_SCN      &gt;= c.REQUIRED_CHECKPOINT_SCN;
</pre></li>
<li>
<p>Ensure that all archive log files from all threads are available. Database recovery depends on the availability of these logs, and a missing log will result in incomplete recovery.</p>
</li>
<li>
<p>In situations that result in incomplete recovery (point-in-time recovery) at a source database, follow the instructions in <a href="man_gen_rep.htm#i1017951">&#34;Performing Point-in-Time Recovery on the Source in a Single-Source Environment&#34;</a> or <a href="man_gen_rep.htm#i1013127">&#34;Performing Point-in-Time Recovery in a Multiple-Source Environment&#34;</a>.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="STREP511" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref731"></a>
<h4 class="sect3">Best Practices for Backups of an Oracle Streams Destination Database</h4>
<p>In an Oracle Streams replication environment, a destination database is a database where an apply process applies changes. Follow these best practices for backups of an Oracle Streams destination database:</p>
<ul>
<li>
<p>Ensure that the <code dir="ltr">commit_serialization</code> apply process parameter is set to <code dir="ltr">FULL</code>.</p>
</li>
<li>
<p>In situations that result in incomplete recovery (point-in-time recovery) at a destination database, follow the instructions in <a href="man_gen_rep.htm#i1011204">&#34;Performing Point-in-Time Recovery on a Destination Database&#34;</a>.</p>
</li>
</ul>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDHCBJE"></a>
<div id="STREP512" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Adjust the Automatic Collection of Optimizer Statistics<a id="sthref732"></a><a id="sthref733"></a></h3>
<p>Every night by default, the optimizer automatically collects statistics on tables whose statistics have become stale. For volatile tables, such as Oracle Streams queue tables, it is likely that the statistics collection job runs when these tables might not have data that is representative of their full load period.</p>
<p>You create these volatile queue tables using the <code dir="ltr">DBMS_AQADM.CREATE_QUEUE_TABLE</code> or <code dir="ltr">DBMS_STREAMS_ADM.SETUP_QUEUE</code> procedure. You specify the queue table name when you run these procedures. In addition to the queue table, the following tables are created when the queue table is created and are also volatile:</p>
<ul>
<li>
<p><code dir="ltr">AQ$_</code><code dir="ltr"><span class="codeinlineitalic">queue_table_name</span></code><code dir="ltr">_I</code></p>
</li>
<li>
<p><code dir="ltr">AQ$_</code><code dir="ltr"><span class="codeinlineitalic">queue_table_name</span></code><code dir="ltr">_H</code></p>
</li>
<li>
<p><code dir="ltr">AQ$_</code><code dir="ltr"><span class="codeinlineitalic">queue_table_name</span></code><code dir="ltr">_T</code></p>
</li>
<li>
<p><code dir="ltr">AQ$_</code><code dir="ltr"><span class="codeinlineitalic">queue_table_name</span></code><code dir="ltr">_P</code></p>
</li>
<li>
<p><code dir="ltr">AQ$_</code><code dir="ltr"><span class="codeinlineitalic">queue_table_name</span></code><code dir="ltr">_D</code></p>
</li>
<li>
<p><code dir="ltr">AQ$_</code><code dir="ltr"><span class="codeinlineitalic">queue_table_name</span></code><code dir="ltr">_C</code></p>
</li>
</ul>
<p>Replace <code dir="ltr"><span class="codeinlineitalic">queue_table_name</span></code> with the name of the queue table.</p>
<p>Oracle recommends that you collect statistics on volatile tables by completing the following steps:</p>
<ol>
<li>
<p>Run the <code dir="ltr">DBMS_STATS.GATHER_TABLE_STATS</code> procedure manually on volatile tables when these tables are at their fullest.</p>
</li>
<li>
<p>Immediately after the statistics are collected on volatile tables, run the <code dir="ltr">DBMS_STATS.LOCK_TABLE_STATS</code> procedure on these tables.</p>
</li>
</ol>
<p>Locking the statistics on volatile tables ensures that the automatic statistics collection job skips these tables, and the tables are not analyzed.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink TGSQL389" href="../TGSQL/tgsql_stats.htm#TGSQL389"><span class="italic">Oracle Database SQL Tuning Guide</span></a> for more information about managing optimizer statistics</div>
</div>
<!-- class="sect2" -->
<a id="CHDDFDCB"></a>
<div id="STREP513" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Check the Alert Log for Oracle Streams Information<a id="sthref734"></a><a id="sthref735"></a></h3>
<p>By default, the alert log contains information about why Oracle Streams capture and apply processes stopped. Also, Oracle Streams capture and apply processes report long-running and large transactions in the alert log.</p>
<p>Long-running transactions are open transactions with no activity (that is, no new change records, rollbacks, or commits) for an extended period (20 minutes). Large transactions are open transactions with a large number of change records. The alert log reports whether a long-running or large transaction has been seen every 20 minutes. Not all such transactions are reported, because only one transaction is reported for each 20 minute period. When the commit or rollback is received, this information is reported in the alert log as well.</p>
<p>You can use the following views for information about long-running transactions:</p>
<ul>
<li>
<p>The <code dir="ltr">V$STREAMS_TRANSACTION</code> dynamic performance view enables monitoring of long running transactions that are currently being processed by Oracle Streams capture processes and apply processes.</p>
</li>
<li>
<p>The <code dir="ltr">DBA_APPLY_SPILL_TXN</code> and <code dir="ltr">V$STREAMS_APPLY_READER</code> views enable you to monitor the number of transactions and messages spilled by an apply process.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">V$STREAMS_TRANSACTION</code> view does not pertain to synchronous captures.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STRMS132" href="../STRMS/strms_trouble.htm#STRMS132"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about Oracle Streams information in the alert log</div>
</div>
<!-- class="sect2" -->
<a id="CHDFHEBF"></a>
<div id="STREP514" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Follow the Best Practices for Removing an Oracle Streams Configuration at a Database<a id="sthref736"></a></h3>
<p>To completely remove the Oracle Streams configuration at a database, complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the database as an administrative user.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for instructions about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">DBMS_STREAMS_ADM.REMOVE_STREAMS_CONFIGURATION</code> procedure.</p>
</li>
<li>
<p>Drop the Oracle Streams administrator, if possible.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIAIGF"></a>
<div id="STREP153" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Best Practices for Oracle Real Application Clusters and Oracle Streams<a id="sthref737"></a><a id="sthref738"></a></h2>
<p>The following best practices are for Oracle Real Application Clusters (Oracle RAC) databases in Oracle Streams replication environments:</p>
<ul>
<li>
<p><a href="#CHDGCHEG">Make Archive Log Files of All Threads Available to Capture Processes</a></p>
</li>
<li>
<p><a href="#CHDHCGJJ">Follow the Best Practices for the Global Name of an Oracle RAC Database</a></p>
</li>
<li>
<p><a href="#CHDEIEEG">Follow the Best Practices for Configuring and Managing Propagations</a></p>
</li>
<li>
<p><a href="#CHDDCFHJ">Follow the Best Practices for Queue Ownership</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STRMS179" href="../STRMS/ap_other.htm#STRMS179"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information about how Oracle Streams works with Oracle RAC</div>
<a id="CHDGCHEG"></a>
<div id="STREP515" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Make Archive Log Files of All Threads Available to Capture Processes<a id="sthref739"></a><a id="sthref740"></a></h3>
<p>The archive log files of all threads from all instances must be available to any instance running a capture process. This requirement pertains to both local and downstream capture processes.</p>
</div>
<!-- class="sect2" -->
<a id="CHDHCGJJ"></a>
<div id="STREP516" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Follow the Best Practices for the Global Name of an Oracle RAC Database<a id="sthref741"></a></h3>
<p>The general best practices described in <a href="#CHDFEGAC">&#34;Follow the Best Practices for the Global Name of an Oracle Streams Database&#34;</a> also apply to Oracle Real Application Clusters (Oracle RAC) databases in an Oracle Streams environment. In addition, if the global name of an Oracle RAC destination database does not match the <code dir="ltr"><span class="codeinlineitalic">DB_NAME.DB_DOMAIN</span></code> of the database, then include the global name for the database in the list of services for the database specified by the <code dir="ltr">SERVICE_NAMES</code> initialization parameter.</p>
<p>In the <code dir="ltr">tnsnames.ora</code> file, ensure that the <code dir="ltr">CONNECT_DATA</code> clause in the connect descriptor specifies the global name of the destination database for the <code dir="ltr">SERVICE_NAME</code>. Also, ensure that the <code dir="ltr">CONNECT_DATA</code> clause does not include the <code dir="ltr">INSTANCE_NAME</code> parameter.</p>
<p>If the global name of an Oracle RAC database that contains Oracle Streams propagations is changed, then drop and re-create all propagations. Ensure that the new propagations are queue-to-queue propagations by setting the <code dir="ltr">queue_to_queue</code> parameter set to <code dir="ltr">TRUE</code> during creation.</p>
<p>If the global name of an Oracle RAC destination database must be changed, then ensure that the queue used by each apply process is empty and that there are no unapplied transactions before changing the global name. After the global name is changed, drop and re-create each apply process&#39;s queue and each apply process.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDDCFHJ">&#34;Follow the Best Practices for Queue Ownership&#34;</a> for more information about the <code dir="ltr">SERVICE_NAME</code> parameter in the <code dir="ltr">tnsnames.ora</code> file</div>
</div>
<!-- class="sect2" -->
<a id="CHDEIEEG"></a>
<div id="STREP517" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Follow the Best Practices for Configuring and Managing Propagations<a id="sthref742"></a></h3>
<p>The general best practices described in <a href="best_prop.htm#CEGFFDCC">&#34;Restart Broken Propagations&#34;</a> also apply to Oracle Real Application Clusters (Oracle RAC) databases in an Oracle Streams environment. Use the procedures <code dir="ltr">START_PROPAGATION</code> and <code dir="ltr">STOP_PROPAGATION</code> in the <code dir="ltr">DBMS_PROPAGATION_ADM</code> package to start and stop propagations. These procedures automatically handle queue-to-queue propagation.</p>
<p>Also, on an Oracle RAC database, a service is created for each buffered queue. This service always runs on the owner instance of the destination queue and follows the ownership of this queue upon queue ownership switches, which include instance startup, instance shutdown, and so on. This service is used by queue-to-queue propagations. You can query <code dir="ltr">NETWORK_NAME</code> column of the <code dir="ltr">DBA_SERVICES</code> data dictionary view to determine the service name for a queue-to-queue propagation. If you are running Oracle RAC instances, and you have queues that were created before Oracle Database 10<span class="italic">g</span> Release 2, then drop and re-create these queues to take advantage of the automatic service generation and queue-to-queue propagation. Ensure that you re-create these queues when they are empty and no new messages are being enqueued into them.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="best_prop.htm#CEGEEBFH">&#34;Use Queue-to-Queue Propagations&#34;</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDDCFHJ"></a>
<div id="STREP518" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Follow the Best Practices for Queue Ownership<a id="sthref743"></a></h3>
<p>All Oracle Streams processing is done at the owning instance of the queue used by the Oracle Streams client. To determine the owning instance of each <code dir="ltr">ANYDATA</code> queue in a database, run the following query:</p>
<pre dir="ltr">SELECT q.OWNER, q.NAME, t.QUEUE_TABLE, t.OWNER_INSTANCE
   FROM DBA_QUEUES q, DBA_QUEUE_TABLES t
   WHERE t.OBJECT_TYPE = &#39;SYS.ANYDATA&#39; AND
         q.QUEUE_TABLE = t.QUEUE_TABLE AND
         q.OWNER = t.OWNER;
</pre>
<p>When Oracle Streams is configured in an Oracle Real Application Clusters (Oracle RAC) environment, each queue table has an owning instance. Also, all queues within an individual queue table are owned by the same instance. The following Oracle Streams clients use the owning instance of the relevant queue to perform their work:</p>
<ul>
<li>
<p>Each capture process is run at the owning instance of its queue.</p>
</li>
<li>
<p>Each propagation is run at the owning instance of the propagation&#39;s source queue.</p>
</li>
<li>
<p>Each propagation must connect to the owning instance of the propagation&#39;s destination queue.</p>
</li>
<li>
<p>Each apply process is run at the owning instance of its queue.</p>
</li>
</ul>
<p>You can configure ownership of a queue to remain on a specific instance, if that instance is available, by running the <code dir="ltr">DBMS_AQADM.ALTER_QUEUE_TABLE</code> procedure and setting the <code dir="ltr">primary_instance</code> and <code dir="ltr">secondary_instance</code> parameters. When the primary instance of a queue table is set to a specific instance, the queue ownership will return to the specified instance whenever the instance is running.</p>
<p>Capture processes and apply processes automatically follow the ownership of the queue. If the ownership changes while process is running, then the process stops on the current instance and restarts on the new owner instance.</p>
<p>Queue-to-queue propagations send messages only to the specific queue identified as the destination queue. Also, the source database link for the destination database connect descriptor must specify the correct service to connect to the destination database. The <code dir="ltr">CONNECT_DATA</code> clause in the connect descriptor should specify the global name of the destination database for the <code dir="ltr">SERVICE_NAME</code>.</p>
<p>For example, consider the <code dir="ltr">tnsnames.ora</code> file for a database with the global name <code dir="ltr">db.mycompany.com</code>. Assume that the alias name for the first instance is <code dir="ltr">db1</code> and that the alias for the second instance is <code dir="ltr">db2</code>. The <code dir="ltr">tnsnames.ora</code> file for this database might include the following entries:</p>
<pre dir="ltr">db.mycompany.com= 
 (description= 
  (load_balance=on)
   (address=(protocol=tcp)(host=node1-vip)(port=1521))
   (address=(protocol=tcp)(host=node2-vip)(port=1521))
  (connect_data=
     (service_name=db.mycompany.com)))
 
db1.mycompany.com=
 (description=
  (address=(protocol=tcp)(host=node1-vip)(port=1521))
  (connect_data= 
    (service_name=db.mycompany.com)
    (instance_name=db1)))
 
db2.mycompany.com= 
 (description= 
  (address=(protocol=tcp)(host=node2-vip)(port=1521))
  (connect_data= 
    (service_name=db.mycompany.com)
    (instance_name=db2)))
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment91">
<tr>
<td class="cellalignment98">
<table class="cellalignment96">
<tr>
<td class="cellalignment95"><a href="ptrep_best.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment95"><a href="best_capture.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment100">
<table class="cellalignment94">
<tr>
<td class="cellalignment95"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment95"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment95"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment95"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment95"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment95"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>