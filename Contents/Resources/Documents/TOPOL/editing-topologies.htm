<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-107352"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Editing%20Topologies"></a><title>Editing Topologies</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="topology, editing, TopoMap objects, description, cache, TopoMap object associated with, topology maps, topology parameter, SDO_TOPO subprograms, topo_map parameter, process for using to edit topologies, exception handling, topology editing, error handling, nodes, adding, moving, removing, removing obsolete, obsolete, obsolete nodes, edges, updating, changing coordinates"/>
<meta name="dcterms.created" content="2017-03-12T16:47:56Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Spatial and Graph Topology Data Model and Network Data Model Graph Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E53120-04"/>
<meta name="dcterms.isVersionOf" content="TOPOL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="topology-data-model-overview.htm" title="Previous" type="text/html"/>
<link rel="Next" href="SDO_TOPO-reference.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53120-04.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-A457C07B-627F-45D7-BFED-336C8ED9D2DA"></a> <span id="PAGE" style="display:none;">9/15</span> <!-- End Header -->
<a id="TOPOL150"></a>
<h1 id="TOPOL-GUID-A457C07B-627F-45D7-BFED-336C8ED9D2DA" class="sect1"><span class="enumeration_chapter">2</span> Editing Topologies</h1>
<div>
<p>This chapter explains how to edit node and edge data in a topology. The operations include adding, moving, and removing nodes and edges, and updating the coordinates of an edge.</p>
<p>This chapter explains two approaches to editing topology data, and it explains why one approach (creating and using a special cache) is better in most cases. It also describes the behavior and implications of some major types of editing operations. It contains the following major sections:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="editing-topologies.htm#GUID-3855F8F8-35C3-43F7-97AE-612C98A4F3CF">Approaches for Editing Topology Data</a></p>
</li>
<li>
<p><a href="editing-topologies.htm#GUID-FC9B2AC9-2B65-4327-91F6-893A4EAC2A40">Performing Operations on Nodes</a></p>
</li>
<li>
<p><a href="editing-topologies.htm#GUID-48615C1B-6AAA-4088-B575-B9183737931C">Performing Operations on Edges</a></p>
</li>
</ul>
<p>The explanations in this chapter refer mainly to the PL/SQL application programming interface (API) provided in the MDSYS.SDO_TOPO_MAP package, which is documented in <a href="SDO_TOPO_MAP-reference.htm#GUID-7DDDFF77-C1B6-43A3-8F7A-684F03B4F0F0">SDO_TOPO_MAP Package Subprograms</a>. However, you can also perform topology editing operations using the client-side Java API, which is introduced in <a href="topology-data-model-overview.htm#GUID-961510D5-308C-4AFC-BED3-27E533F3522A">Topology Data Model Java Interface</a> and is explained in the Javadoc-generated documentation.</p>
<p>To edit topology data, always use the PL/SQL or Java API. Do not try to perform editing operations by directly modifying the node, edge, or face information tables.</p>
<p>For cross-schema topology editing considerations, see <a href="topology-data-model-overview.htm#GUID-C9C61D47-EE18-42E8-BC46-984CC8322566">Cross-Schema Topology Editing</a>.</p>
</div>
<a id="TOPOL792"></a>
<div class="props_rev_3"><a id="GUID-3855F8F8-35C3-43F7-97AE-612C98A4F3CF"></a>
<h2 id="TOPOL-GUID-3855F8F8-35C3-43F7-97AE-612C98A4F3CF" class="sect2">Approaches for Editing Topology Data</h2>
<div>
<p>Whenever you need to edit a topology, you can use PL/SQL or Java API. In both cases, Oracle Spatial and Graph uses an in-memory topology cache, specifically, a TopoMap object (described in <a href="editing-topologies.htm#GUID-0323CEFB-CF1B-4435-AA16-6BBF93D1CB87">TopoMap Objects</a>):</p>
<ul style="list-style-type: disc;">
<li>
<p>If you use the PL/SQL API, you can either explicitly create and use the cache or allow Spatial and Graph to create and use the cache automatically.</p>
</li>
<li>
<p>If you use the Java API, you must explicitly create and use the cache.</p>
</li>
</ul>
<p>Allowing Spatial and Graph to create and manage the cache automatically is simpler, because it involves fewer steps than creating and using a cache. However, because allowing Spatial and Graph to create and manage the cache involves more database activity and disk accesses, it is less efficient when you need to edit more than a few topological elements.</p>
</div>
<a id="TOPOL793"></a>
<div class="props_rev_3"><a id="GUID-0323CEFB-CF1B-4435-AA16-6BBF93D1CB87"></a>
<h3 id="TOPOL-GUID-0323CEFB-CF1B-4435-AA16-6BBF93D1CB87" class="sect3">TopoMap Objects</h3>
<div>
<p>A <span class="bold">TopoMap object</span> is associated with an in-memory cache that is associated with a topology. If you explicitly create and use a cache for editing a topology, you must create a TopoMap object to be associated with a topology, load all or some of the topology into the cache, edit objects, periodically update the topology to write changes to the database, commit the changes made in the cache, and clear the cache.</p>
<p>Although this approach involves more steps than allowing Spatial and Graph to create and use the cache automatically, it is much faster and more efficient for most topology editing sessions, which typically affect hundreds or thousands of topological elements. It is the approach shown in most explanations and illustrations.</p>
<p><a id="d12844e149" class="indexterm-anchor"></a><a id="d12844e153" class="indexterm-anchor"></a><a id="d12844e157" class="indexterm-anchor"></a><a id="d12844e159" class="indexterm-anchor"></a>A TopoMap object can be updatable or read-only, depending on the value of the <code class="codeph">allow_updates</code> parameter when you call the <a href="SDO_TOPO_MAP-reference.htm#GUID-B178D720-02C0-4A24-921D-E8FACB84C2F2">SDO_TOPO_MAP.LOAD_TOPO_MAP</a> function or procedure:</p>
<ul style="list-style-type: disc;">
<li>
<p>With a read-only TopoMap object, topological elements (primitives) are loaded but not locked.</p>
</li>
<li>
<p>With an updatable TopoMap object, topological elements (primitives) are loaded and locked. If you specified a rectangular window for an updatable TopoMap object, you can edit only those topological elements inside the specified window. (The TopoMap object may also contain locked topological elements that you cannot edit directly, but that Oracle Spatial and Graph can modify indirectly as needed.)</p>
<p>For more information about what occurs when you use an updatable TopoMap object, see the Usage Notes for the <a href="SDO_TOPO_MAP-reference.htm#GUID-B178D720-02C0-4A24-921D-E8FACB84C2F2">SDO_TOPO_MAP.LOAD_TOPO_MAP</a> function or procedure.</p>
</li>
</ul>
<p>The following procedures set an updatable TopoMap object to be read-only:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="SDO_TOPO_MAP-reference.htm#GUID-AE05A693-8EEB-4EEC-905C-AF96943B0B10">SDO_TOPO_MAP.COMMIT_TOPO_MAP</a></p>
</li>
<li>
<p><a href="SDO_TOPO_MAP-reference.htm#GUID-5C4DC6C5-4F4C-48CD-BC1A-96A039B5B38C">SDO_TOPO_MAP.ROLLBACK_TOPO_MAP</a></p>
</li>
<li>
<p><a href="SDO_TOPO_MAP-reference.htm#GUID-224A6A71-AB01-4D9B-939C-7366AACD3376">SDO_TOPO_MAP.CLEAR_TOPO_MAP</a></p>
</li>
</ul>
<p>Within a user session at any given time, there can be no more than one updatable TopoMap object. However, multiple different user sessions can work with updatable TopoMap objects based on the same topology, as long as their editing windows do not contain any topological elements that are in any other updatable TopoMap objects. There can be multiple read-only TopoMap objects within and across user sessions.</p>
<p>Two or more users can edit a topology at the same time as long as their editing windows (specified in the call to the <a href="SDO_TOPO_MAP-reference.htm#GUID-B178D720-02C0-4A24-921D-E8FACB84C2F2">SDO_TOPO_MAP.LOAD_TOPO_MAP</a> function or procedure) do not overlap.</p>
</div>
</div>
<a id="TOPOL794"></a>
<div class="props_rev_3"><a id="GUID-E483DC2C-7692-4BBC-86EF-369D2A0EB85B"></a>
<h3 id="TOPOL-GUID-E483DC2C-7692-4BBC-86EF-369D2A0EB85B" class="sect3">Specifying the Editing Approach with the Topology Parameter</h3>
<div>
<p>For many SDO_TOPO_MAP package functions and procedures that edit topologies, such as <a href="SDO_TOPO_MAP-reference.htm#GUID-04E9B2DD-AB7E-4343-907B-C7315F20BEF2">SDO_TOPO_MAP.ADD_NODE</a> or <a href="SDO_TOPO_MAP-reference.htm#GUID-3EF0E053-EEE0-45EE-B4FD-E782115942BC">SDO_TOPO_MAP.MOVE_EDGE</a>, you indicate the approach you are using for editing by specifying either a topology name or a null value for the first parameter, which is named <code class="codeph">topology</code>:</p>
<ul style="list-style-type: disc;">
<li>
<p>If you specify a topology name, Spatial and Graph checks to see if an updatable TopoMap object already exists in the user session; and if one does not exist, Spatial and Graph creates an internal TopoMap object, uses that cache to perform the editing operation, commits the change (or rolls back changes to the savepoint at the beginning of the process if an exception occurred), and deletes the TopoMap object. (If an updatable TopoMap object already exists, an exception is raised.) For example, the following statement removes the node with node ID value 99 from the <code class="codeph">MY_TOPO</code> topology:</p>
<pre dir="ltr">CALL SDO_TOPO_MAP.REMOVE_NODE(&#39;MY_TOPO&#39;, 99);
</pre></li>
<li>
<p>If you specify a null value, Spatial and Graph checks to see if an updatable TopoMap object already exists in the user session; and if one does exist, Spatial and Graph performs the operation in the TopoMap object&#39;s cache. (If no updatable TopoMap object exists, an exception is raised.) For example, the following statement removes the node with node ID value 99 from the current updatable TopoMap object:</p>
<pre dir="ltr">CALL SDO_TOPO_MAP.REMOVE_NODE(null, 99);
</pre></li>
</ul>
</div>
</div>
<a id="TOPOL795"></a>
<div class="props_rev_3"><a id="GUID-7EF84B42-0144-47C6-A42D-DE8713EB92CB"></a>
<h3 id="TOPOL-GUID-7EF84B42-0144-47C6-A42D-DE8713EB92CB" class="sect3">Using GET_xxx Topology Functions</h3>
<div>
<p>Some SDO_TOPO_MAP package functions that get information about topologies have <code class="codeph">topology</code> and <code class="codeph">topo_map</code> as their first two parameters. Examples of such functions are <a href="SDO_TOPO_MAP-reference.htm#GUID-8579639E-B35B-4186-9AB5-A9C8CAE8D943">SDO_TOPO_MAP.GET_EDGE_COORDS</a> and <a href="SDO_TOPO_MAP-reference.htm#GUID-FF02C5F8-CF94-4E91-AEE8-6E6067F07124">SDO_TOPO_MAP.GET_NODE_STAR</a>. To use these functions, specify a valid value for one parameter and a null value for the other parameter, as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>If you specify a valid <code class="codeph">topology</code> parameter value, Spatial and Graph retrieves the information for the specified topology. It creates an internal TopoMap object, uses that cache to perform the operation, and deletes the TopoMap object. For example, the following statement returns the edge coordinates of the edge with an ID value of 1 from the <code class="codeph">CITY_DATA</code> topology:</p>
<pre dir="ltr">SELECT SDO_TOPO_MAP.GET_EDGE_COORDS(&#39;CITY_DATA&#39;, null, 1) FROM DUAL;
</pre></li>
<li>
<p>If you specify a null <code class="codeph">topology</code> parameter value and a valid <code class="codeph">topo_map</code> parameter value, Spatial and Graph uses the specified TopoMap object (which can be updatable or read-only) to retrieve the information for the specified topology. For example, the following statement returns the edge coordinates of the edge with an ID value of 1 from the <code class="codeph">CITY_DATA_TOPOMAP</code> TopoMap object:</p>
<pre dir="ltr">SELECT SDO_TOPO_MAP.GET_EDGE_COORDS(null, &#39;CITY_DATA_TOPOMAP&#39;, 1) FROM DUAL;
</pre></li>
<li>
<p>If you specify a null or invalid value for both the <code class="codeph">topology</code> and <code class="codeph">topo_map</code> parameters, an exception is raised.</p>
</li>
</ul>
<p>Some SDO_TOPO_MAP package functions that get information about topology editing operations have no parameters. Examples of such functions are <a href="SDO_TOPO_MAP-reference.htm#GUID-83435605-07A4-4BAD-A77B-B7BB1F2A54B9">SDO_TOPO_MAP.GET_FACE_ADDITIONS</a> and <a href="SDO_TOPO_MAP-reference.htm#GUID-0FEF9A33-788D-4BE1-B93D-489B873EF5B5">SDO_TOPO_MAP.GET_NODE_CHANGES</a>. These functions use the current updatable TopoMap object. If no updatable TopoMap object exists, an exception is raised. For example, the following statement returns an SDO_NUMBER_ARRAY object (described in <a href="topology-data-model-overview.htm#GUID-CC31A2D6-2225-492F-B930-B8C438E28E3B">SDO_EDGE_ARRAY and SDO_NUMBER_ARRAY Types</a>) with the node ID values of nodes that have been added to the current updatable TopoMap object:</p>
<pre dir="ltr">SELECT SDO_TOPO_MAP.GET_NODE_ADDITIONS FROM DUAL;
</pre></div>
</div>
<a id="TOPOL797"></a><a id="TOPOL796"></a>
<div class="props_rev_3"><a id="GUID-787B4DAE-DE0B-4D0B-9DA2-4690EDCB97AB"></a>
<h3 id="TOPOL-GUID-787B4DAE-DE0B-4D0B-9DA2-4690EDCB97AB" class="sect3">Process for Editing Using Cache Explicitly (PL/SQL API)</h3>
<div>
<p><a href="editing-topologies.htm#GUID-787B4DAE-DE0B-4D0B-9DA2-4690EDCB97AB__CEGBBECG">Figure 2-1</a> shows the recommended process for editing topological elements using the PL/SQL API and explicitly using a TopoMap object and its associated cache.</p>
<div class="figure" id="GUID-787B4DAE-DE0B-4D0B-9DA2-4690EDCB97AB__CEGBBECG">
<p class="titleinfigure">Figure 2-1 Editing Topologies Using the TopoMap Object Cache (PL/SQL API)</p>
<img width="589" height="443" src="img/GUID-E52DC23C-F7E6-42E9-9425-19EFE16F2BC6-default.gif" alt="Description of Figure 2-1 follows" title="Description of Figure 2-1 follows"/><br/>
<a href="img_text/GUID-E52DC23C-F7E6-42E9-9425-19EFE16F2BC6-print.htm">Description of &#34;Figure 2-1 Editing Topologies Using the TopoMap Object Cache (PL/SQL API)&#34;</a></div>
<!-- class="figure" -->
<p>As <a href="editing-topologies.htm#GUID-787B4DAE-DE0B-4D0B-9DA2-4690EDCB97AB__CEGBBECG">Figure 2-1</a> shows, the basic sequence is as follows:</p>
<ol>
<li>
<p>Create the TopoMap object, using the <a href="SDO_TOPO_MAP-reference.htm#GUID-846D5683-FCFD-4BBB-8969-47B41ADAEE0D">SDO_TOPO_MAP.CREATE_TOPO_MAP</a> procedure.</p>
<p>This creates an in-memory cache for editing objects associated with the specified topology.</p>
</li>
<li>
<p>Load the entire topology or a rectangular window from the topology into the TopoMap object cache for update, using the <a href="SDO_TOPO_MAP-reference.htm#GUID-B178D720-02C0-4A24-921D-E8FACB84C2F2">SDO_TOPO_MAP.LOAD_TOPO_MAP</a> function or procedure.</p>
<p>You can specify that in-memory R-tree indexes be built on the edges and faces that are being loaded. These indexes use some memory resources and take some time to create and periodically rebuild; however, they significantly improve performance if you edit a large number of topological elements in the session. (They can also improve performance for queries that use a read-only TopoMap object.)</p>
</li>
<li>
<p>Perform a number of topology editing operations (for example, add 1000 nodes).</p>
<p>Periodically, validate the cache by calling the <a href="SDO_TOPO_MAP-reference.htm#GUID-0B1B7F60-E0C0-4D5F-9EF5-96EF14E4E4B1">SDO_TOPO_MAP.VALIDATE_TOPO_MAP</a> function.</p>
<p>You can rebuild existing in-memory R-tree indexes on edges and faces in the TopoMap object, or create new indexes if none exist, by using the <a href="SDO_TOPO_MAP-reference.htm#GUID-92DF4764-8E33-4854-B869-B6C67D163FE1">SDO_TOPO_MAP.CREATE_EDGE_INDEX</a> and <a href="SDO_TOPO_MAP-reference.htm#GUID-CDE0AF3B-444A-4C93-B4F9-B77E0D04FCB5">SDO_TOPO_MAP.CREATE_FACE_INDEX</a> procedures. For best index performance, these indexes should be rebuilt periodically when you are editing a large number of topological elements.</p>
<p>If you want to discard edits made in the cache, call the <a href="SDO_TOPO_MAP-reference.htm#GUID-224A6A71-AB01-4D9B-939C-7366AACD3376">SDO_TOPO_MAP.CLEAR_TOPO_MAP</a> procedure. This procedure fails if there are any uncommitted updates; otherwise, it clears the data in the cache and sets the cache to be read-only.</p>
</li>
<li>
<p>Update the topology by calling the <a href="SDO_TOPO_MAP-reference.htm#GUID-620FE4C3-0AC3-48C0-BCF4-B3E8AAA1DC6E">SDO_TOPO_MAP.UPDATE_TOPO_MAP</a> procedure.</p>
</li>
<li>
<p>Repeat Steps 3 and 4 (editing objects, validating the cache, rebuilding the R-tree indexes, and updating the topology) as often as needed, until you have finished the topology editing operations.</p>
</li>
<li>
<p>Commit the topology changes by calling the <a href="SDO_TOPO_MAP-reference.htm#GUID-AE05A693-8EEB-4EEC-905C-AF96943B0B10">SDO_TOPO_MAP.COMMIT_TOPO_MAP</a> procedure. (The <a href="SDO_TOPO_MAP-reference.htm#GUID-AE05A693-8EEB-4EEC-905C-AF96943B0B10">SDO_TOPO_MAP.COMMIT_TOPO_MAP</a> procedure automatically performs the actions of the <a href="SDO_TOPO_MAP-reference.htm#GUID-620FE4C3-0AC3-48C0-BCF4-B3E8AAA1DC6E">SDO_TOPO_MAP.UPDATE_TOPO_MAP</a> procedure before it commits the changes.) After the commit operation, the cache is made read-only (that is, it is no longer updatable). However, if you want to perform further editing operations using the same TopoMap object, you can load it again and use it (that is, repeat Steps 2 through 5, clearing the cache first if necessary).</p>
<p>To perform further editing operations, clear the TopoMap object cache by calling the <a href="SDO_TOPO_MAP-reference.htm#GUID-224A6A71-AB01-4D9B-939C-7366AACD3376">SDO_TOPO_MAP.CLEAR_TOPO_MAP</a> procedure, and then go to Step 2.</p>
<p>If you want to discard all uncommitted topology changes, you can call the <a href="SDO_TOPO_MAP-reference.htm#GUID-5C4DC6C5-4F4C-48CD-BC1A-96A039B5B38C">SDO_TOPO_MAP.ROLLBACK_TOPO_MAP</a> procedure at any time. After the rollback operation, the cache is cleared.</p>
</li>
<li>
<p>Remove the TopoMap object by calling the <a href="SDO_TOPO_MAP-reference.htm#GUID-48216A60-21E7-4DFB-8AE9-D1C8D50EE6DA">SDO_TOPO_MAP.DROP_TOPO_MAP</a> procedure.</p>
<p>This procedure removes the TopoMap object and frees any resources that it had used. (If you forget to drop the TopoMap object, it will automatically be dropped when the user session ends.) This procedure also rolls back any topology changes in the cache that have not been committed.</p>
<p>If the application terminates abnormally, all uncommitted changes to the database will be discarded.</p>
</li>
</ol>
<p>If you plan to perform a very large number of topology editing operations, you can divide the operations among several editing sessions, each of which performs Steps 1 through 7 in the preceding list.</p>
</div>
</div>
<a id="TOPOL799"></a><a id="TOPOL798"></a>
<div class="props_rev_3"><a id="GUID-E6572550-0C53-422B-BE94-51E8F07AC138"></a>
<h3 id="TOPOL-GUID-E6572550-0C53-422B-BE94-51E8F07AC138" class="sect3">Process for Editing Using the Java API</h3>
<div>
<p><a href="editing-topologies.htm#GUID-E6572550-0C53-422B-BE94-51E8F07AC138__CEGHDDBF">Figure 2-2</a> shows the recommended process for editing topological elements using the client-side Java API, which is introduced in <a href="topology-data-model-overview.htm#GUID-961510D5-308C-4AFC-BED3-27E533F3522A">Topology Data Model Java Interface</a> and is explained in the Javadoc-generated documentation. The Java API requires that you create and manage a TopoMap object and its associated cache.</p>
<div class="figure" id="GUID-E6572550-0C53-422B-BE94-51E8F07AC138__CEGHDDBF">
<p class="titleinfigure">Figure 2-2 Editing Topologies Using the TopoMap Object Cache (Java API)</p>
<img width="551" height="443" src="img/GUID-3BA8FC91-E8BC-4014-AA27-01375430E823-default.gif" alt="Description of Figure 2-2 follows" title="Description of Figure 2-2 follows"/><br/>
<a href="img_text/GUID-3BA8FC91-E8BC-4014-AA27-01375430E823-print.htm">Description of &#34;Figure 2-2 Editing Topologies Using the TopoMap Object Cache (Java API)&#34;</a></div>
<!-- class="figure" -->
<p>As <a href="editing-topologies.htm#GUID-E6572550-0C53-422B-BE94-51E8F07AC138__CEGHDDBF">Figure 2-2</a> shows, the basic sequence is as follows:</p>
<ol>
<li>
<p>Create the TopoMap object, using a constructor of the <code class="codeph">TopoMap</code> class, specifying a topology and a database connection.</p>
<p>This creates an in-memory cache for editing objects associated with the specified topology.</p>
</li>
<li>
<p>Load the entire topology or a rectangular window from the topology into the TopoMap object cache for update, using the <code class="codeph">loadTopology</code> or <code class="codeph">loadWindow</code> method of the <code class="codeph">TopoMap</code> class.</p>
<p>You can specify that in-memory R-tree indexes be built on the edge and edge face that are being affected. These indexes use some memory resources and take some time to create and periodically rebuild; however, they significantly improve performance if you edit a large number of topological elements during the database connection.</p>
</li>
<li>
<p>Perform a number of topology editing operations (for example, add 1000 nodes), and update the topology by calling the <code class="codeph">updateTopology</code> method of the <code class="codeph">TopoMap</code> class.</p>
<p>Periodically, validate the cache by calling the <code class="codeph">validateCache</code> method of the <code class="codeph">TopoMap</code> class.</p>
<p>If you caused in-memory R-tree indexes to be created when you loaded the TopoMap object (in Step 2), you can periodically (for example, after each addition of 100 nodes) rebuild the indexes by calling the <code class="codeph">createEdgeIndex</code> and <code class="codeph">createFaceIndex</code> methods of the <code class="codeph">TopoMap</code> class. For best index performance, these indexes should be rebuilt periodically when you are editing a large number of topological elements.</p>
<p>If you do not want to update the topology but instead want to discard edits made in the cache since the last update, call the <code class="codeph">clearCache</code> method of the <code class="codeph">TopoMap</code> class. The <code class="codeph">clearCache</code> method fails if there are any uncommitted updates; otherwise, it clears the data in the cache and sets the cache to be read-only.</p>
</li>
<li>
<p>Update the topology by calling the <code class="codeph">updateTopology</code> method of the <code class="codeph">TopoMap</code> class.</p>
</li>
<li>
<p>Repeat Steps 3 and 4 (editing objects, validating the cache, rebuilding the R-tree indexes, and updating the topology) as often as needed, until you have finished the topology editing operations.</p>
</li>
<li>
<p>Commit the topology changes by calling the <code class="codeph">commitDB</code> method of the <code class="codeph">TopoMap</code> class. (The <code class="codeph">commitDB</code> method automatically calls the <code class="codeph">updateTopology</code> method before it commits the changes.) After the commit operation, the cache is made read-only (that is, it is no longer updatable). However, if you want to perform further editing operations using the same TopoMap object, you can load it again and use it (that is, repeat Steps 2 through 5, clearing the cache first if necessary).</p>
<p>To perform further editing operations, clear the TopoMap object cache by calling the <code class="codeph">clearCache</code> method of the <code class="codeph">TopoMap</code> class, and then go to Step 2.</p>
<p>If you want to discard all uncommitted topology changes, you can call the <code class="codeph">rollbackDB</code> method of the <code class="codeph">TopoMap</code> class at any time. After the rollback operation, the cache is cleared.</p>
</li>
<li>
<p>Remove the TopoMap object by setting the TopoMap object to null, which makes the object available for garbage collection and frees any resources that it had used. (If you forget to remove the TopoMap object, it will automatically be garbage collected when the application ends.)</p>
<p>If the application terminates abnormally, all uncommitted changes to the database will be discarded.</p>
</li>
</ol>
<p>If you plan to perform a very large number of topology editing operations, you can divide the operations among several editing sessions, each of which performs Steps 1 through 7 in the preceding list.</p>
</div>
</div>
<a id="TOPOL800"></a>
<div class="props_rev_3"><a id="GUID-C909018F-4031-48DF-8EAB-81F4152B90CD"></a>
<h3 id="TOPOL-GUID-C909018F-4031-48DF-8EAB-81F4152B90CD" class="sect3">Error Handling for Topology Editing</h3>
<div>
<p>This section discusses the following conditions:</p>
<ul style="list-style-type: disc;">
<li>
<p>Input parameter errors</p>
</li>
<li>
<p>All exceptions</p>
</li>
</ul>
</div>
<a id="TOPOL801"></a>
<div class="props_rev_3"><a id="GUID-A9CD95C6-F639-40E8-9B0E-DE1BEBE357BB"></a>
<h4 id="TOPOL-GUID-A9CD95C6-F639-40E8-9B0E-DE1BEBE357BB" class="sect4">Input Parameter Errors</h4>
<div>
<p>When an SDO_TOPO_MAP PL/SQL subprogram or a public method in the <code class="codeph">TopoMap</code> Java class is called, it validates the values of the input parameters, and it uses or creates a TopoMap object to perform the editing or read-only operation. Whenever there is an input error, an <code class="codeph">oracle.spatial.topo.TopoDataException</code> exception is thrown. Other errors may occur when the underlying TopoMap object performs an operation.</p>
<p>If the method is called from SQL or PL/SQL, the caller gets the following error message:</p>
<pre dir="ltr">ORA-29532: Java call terminated by uncaught Java exception:
&lt;specific error message text&gt;
</pre>
<p>The following PL/SQL example shows how you can handle a <code class="codeph">TopoDataException</code> exception:</p>
<pre dir="ltr">DECLARE
  topo_data_error EXCEPTION;
  PRAGMA EXCEPTION_INIT(topo_data_error, -29532);
BEGIN
  sdo_topo_map.create_topo_map(null, null, 100, 100, 100);
EXCEPTION
  WHEN topo_data_error THEN
    DBMS_OUTPUT.PUT_LINE(SQLERRM);
END;/
 
</pre>
<p>The preceding example generates the following output:</p>
<pre dir="ltr">ORA-29532: Java call terminated by uncaught Java exception:oracle.spatial.topo.TopoDataException: invalid TopoMap name
</pre></div>
</div>
<a id="TOPOL802"></a>
<div class="props_rev_3"><a id="GUID-DBEA9CB9-EDCC-4416-B0A6-9B2A83CE2EA5"></a>
<h4 id="TOPOL-GUID-DBEA9CB9-EDCC-4416-B0A6-9B2A83CE2EA5" class="sect4">All Exceptions</h4>
<div>
<p>The following actions are performed automatically when any exception occurs in a call to any of the following SDO_TOPO_MAP PL/SQL subprograms or their associated methods in the <code class="codeph">TopoMap</code> Java class: <a href="SDO_TOPO_MAP-reference.htm#GUID-D3945002-582C-484A-8D86-F20CF35C4555">SDO_TOPO_MAP.ADD_EDGE</a> (<code class="codeph">addEdge</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-7752EB56-41C8-4180-8C85-920B8E1A831A">SDO_TOPO_MAP.ADD_ISOLATED_NODE</a> (<code class="codeph">addIsolatedNode</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-D25D7695-9ABE-4087-93B7-A11E4A760027">SDO_TOPO_MAP.ADD_LOOP</a> (<code class="codeph">addLoop</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-04E9B2DD-AB7E-4343-907B-C7315F20BEF2">SDO_TOPO_MAP.ADD_NODE</a> (<code class="codeph">addNode</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-F469AC4E-0985-483F-A9FB-A3C2D22DD488">SDO_TOPO_MAP.ADD_POINT_GEOMETRY</a> (<code class="codeph">addPointGeometry</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-3D557747-2249-4BAF-B3C8-3D4A6CA80876">SDO_TOPO_MAP.ADD_POLYGON_GEOMETRY</a> (<code class="codeph">addPolygonGeometry</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-785884A2-4894-469B-B272-10E480F9EFC9">SDO_TOPO_MAP.CHANGE_EDGE_COORDS</a> (<code class="codeph">changeEdgeCoords</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-7D9214F5-D127-4A34-B34C-A1F4D807564E">SDO_TOPO_MAP.MOVE_ISOLATED_NODE</a> (<code class="codeph">moveIsolatedNode</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-5A836D8B-A319-46F2-B644-E845D6B804B9">SDO_TOPO_MAP.MOVE_NODE</a> (<code class="codeph">moveNode</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-3EF0E053-EEE0-45EE-B4FD-E782115942BC">SDO_TOPO_MAP.MOVE_EDGE</a> (<code class="codeph">moveEdge</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-B3C764F7-A021-4FBC-9ACB-ABB748DB1971">SDO_TOPO_MAP.REMOVE_EDGE</a> (<code class="codeph">removeEdge</code>), <a href="SDO_TOPO_MAP-reference.htm#GUID-087936D6-3E29-4598-9B86-A340C112F81C">SDO_TOPO_MAP.REMOVE_NODE</a> (<code class="codeph">removeNode</code>), and <a href="SDO_TOPO_MAP-reference.htm#GUID-620FE4C3-0AC3-48C0-BCF4-B3E8AAA1DC6E">SDO_TOPO_MAP.UPDATE_TOPO_MAP</a> (<code class="codeph">updateTopology</code>).</p>
<ul style="list-style-type: disc;">
<li>
<p>The transaction is rolled back.</p>
</li>
<li>
<p>The TopoMap object cache is cleared.</p>
</li>
<li>
<p>The TopoMap object is made read-only.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="TOPOL803"></a>
<div class="props_rev_3"><a id="GUID-FC9B2AC9-2B65-4327-91F6-893A4EAC2A40"></a>
<h2 id="TOPOL-GUID-FC9B2AC9-2B65-4327-91F6-893A4EAC2A40" class="sect2">Performing Operations on Nodes</h2>
<div>
<p>This section contains sections that describe the effects of adding, moving, and removing nodes, and that explain how to perform these operations using the PL/SQL API.</p>
</div>
<a id="TOPOL805"></a><a id="TOPOL806"></a><a id="TOPOL804"></a>
<div class="props_rev_3"><a id="GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61"></a>
<h3 id="TOPOL-GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61" class="sect3">Adding a Node</h3>
<div>
<p>Adding a non-isolated node adds the node to an edge at a point that is currently on the edge. This operation also splits the edge, causing the original edge to be divided into two edges. Spatial and Graph automatically adjusts the definition of the original edge and creates a new edge (assigning it an ID value that is unique among edges in the topology).</p>
<p>To add a non-isolated node, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-04E9B2DD-AB7E-4343-907B-C7315F20BEF2">SDO_TOPO_MAP.ADD_NODE</a> function. To add an isolated node, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-7752EB56-41C8-4180-8C85-920B8E1A831A">SDO_TOPO_MAP.ADD_ISOLATED_NODE</a> function.</p>
<p><a href="editing-topologies.htm#GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61__CEGCJDJE">Figure 2-3</a> shows the addition of a node (N3) on edge E1.</p>
<div class="figure" id="GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61__CEGCJDJE">
<p class="titleinfigure">Figure 2-3 Adding a Non-Isolated Node</p>
<img width="450" height="141" src="img/GUID-B8FB0150-D20D-4118-B9D2-9C0C2D7B6455-default.gif" alt="Description of Figure 2-3 follows" title="Description of Figure 2-3 follows"/><br/>
<a href="img_text/GUID-B8FB0150-D20D-4118-B9D2-9C0C2D7B6455-print.htm">Description of &#34;Figure 2-3 Adding a Non-Isolated Node&#34;</a></div>
<!-- class="figure" -->
<p>As a result of the operation shown in <a href="editing-topologies.htm#GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61__CEGCJDJE">Figure 2-3</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Edge E1 is redefined to be between the original edge&#39;s start point and the point at the added node (N3).</p>
</li>
<li>
<p>Edge E2 is created. Its start point is the point at node N3, and its end point is the end point of the original edge.</p>
</li>
<li>
<p>If any linear features were defined on the original edge, they are automatically redefined to be on both resulting edges, the edge is split, and a record is added to the history information table (explained in <a href="topology-data-model-overview.htm#GUID-68020A3E-978F-4EB7-AAA8-8DABA17533BF">History Information Table</a>) for the topology. For example, if a street named Main Street had been defined on the original edge E1 in <a href="editing-topologies.htm#GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61__CEGCJDJE">Figure 2-3</a>, then after the addition of node N3, Main Street would be defined on both edges E1 and E2.</p>
</li>
</ul>
<p><a href="editing-topologies.htm#GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61__CEGHJIEE">Figure 2-4</a> shows a more complicated example of adding a node, where the result depends on whether or not the added node is a new shape point of the original edge (that is, on the value of the <code class="codeph">is_new_shape_point</code> parameter to the <a href="SDO_TOPO_MAP-reference.htm#GUID-04E9B2DD-AB7E-4343-907B-C7315F20BEF2">SDO_TOPO_MAP.ADD_NODE</a> function).</p>
<div class="figure" id="GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61__CEGHJIEE">
<p class="titleinfigure">Figure 2-4 Effect of is_new_shape_point Value on Adding a Node</p>
<img width="452" height="401" src="img/GUID-C541F098-E037-4B8E-AFC0-79AAC8A71BAE-default.gif" alt="Description of Figure 2-4 follows" title="Description of Figure 2-4 follows"/><br/>
<a href="img_text/GUID-C541F098-E037-4B8E-AFC0-79AAC8A71BAE-print.htm">Description of &#34;Figure 2-4 Effect of is_new_shape_point Value on Adding a Node&#34;</a></div>
<!-- class="figure" -->
<p>In <a href="editing-topologies.htm#GUID-BFB9FFEE-D6AD-4DD0-9703-257BC3778C61__CEGHJIEE">Figure 2-4</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>In the top part of the figure, the original edge (E1) starts at node N1, ends at node N2, and has two intermediate shape points.</p>
</li>
<li>
<p>In the middle part of the figure, a new node (N3) is added that is not a shape point of the original edge, but instead is a new shape point (that is, <code class="codeph">is_new_shape_point=&gt;&#39;TRUE&#39;</code>). The new node is added at the location specified with the <code class="codeph">point</code> parameter, and is added after the vertex specified in the <code class="codeph">coord_index</code> parameter (in this case, <code class="codeph">coord_index=&gt;1</code> to indicate after the first vertex). The new node becomes the end node for edge E1 and the start node for the new edge E2, which ends at node N2.</p>
</li>
<li>
<p>In the bottom part of the figure, a new node (N3) is added that is a shape point of the original edge, and is thus not a new shape point (that is, <code class="codeph">is_new_shape_point=&gt;&#39;FALSE&#39;</code>). Because it is not a new shape point, the node is added at the vertex specified with the <code class="codeph">coord_index</code> parameter (in this case, <code class="codeph">coord_index=&gt;2</code>). As in the middle part of the figure, the new node becomes the end node for edge E1 and the start node for the new edge E2, which ends at node N2.</p>
</li>
</ul>
</div>
</div>
<a id="TOPOL808"></a><a id="TOPOL809"></a><a id="TOPOL810"></a><a id="TOPOL807"></a>
<div class="props_rev_3"><a id="GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B"></a>
<h3 id="TOPOL-GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B" class="sect3">Moving a Node</h3>
<div>
<p>Moving a non-isolated node to a new position causes the ends of all edges that are attached to the node to move with the node. You must specify the vertices for all edges affected by the moving of the node; each point (start or end) that is attached to the node must have the same coordinates as the new location of the node, and the other end points (not the moved node) of each affected edge must remain the same.</p>
<p>To move a non-isolated node, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-5A836D8B-A319-46F2-B644-E845D6B804B9">SDO_TOPO_MAP.MOVE_NODE</a> procedure. To move an isolated node, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-7D9214F5-D127-4A34-B34C-A1F4D807564E">SDO_TOPO_MAP.MOVE_ISOLATED_NODE</a> procedure.</p>
<p><a href="editing-topologies.htm#GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGHFDHJ">Figure 2-5</a> shows the original topology before node N1 is moved.</p>
<div class="figure" id="GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGHFDHJ">
<p class="titleinfigure">Figure 2-5 Topology Before Moving a Non-Isolated Node</p>
<img width="206" height="195" src="img/GUID-96589733-AF16-4048-A343-76E52658B0CB-default.gif" alt="Description of Figure 2-5 follows" title="Description of Figure 2-5 follows"/><br/>
<a href="img_text/GUID-96589733-AF16-4048-A343-76E52658B0CB-print.htm">Description of &#34;Figure 2-5 Topology Before Moving a Non-Isolated Node&#34;</a></div>
<!-- class="figure" -->
<p><a href="editing-topologies.htm#GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGCJDDC">Figure 2-6</a> shows two cases of the original topology after node N1 is moved. In one case, no reshaping occurs; that is, all edges affected by the movement are specified as straight lines. In the other case, reshaping occurs; that is, one or more affected edges are specified as line segments with multiple vertices.</p>
<div class="figure" id="GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGCJDDC">
<p class="titleinfigure">Figure 2-6 Topology After Moving a Non-Isolated Node</p>
<img width="421" height="226" src="img/GUID-865379BD-5064-4292-B7DD-1B82D6FEA47D-default.gif" alt="Description of Figure 2-6 follows" title="Description of Figure 2-6 follows"/><br/>
<a href="img_text/GUID-865379BD-5064-4292-B7DD-1B82D6FEA47D-print.htm">Description of &#34;Figure 2-6 Topology After Moving a Non-Isolated Node&#34;</a></div>
<!-- class="figure" -->
<p>In both cases shown in <a href="editing-topologies.htm#GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGCJDDC">Figure 2-6</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>The topology does not change. That is, the number of nodes, edges, and faces does not change, and the relationships (such as adjacency and connectivity) among the nodes, edges, and faces do not change.</p>
</li>
<li>
<p>All features defined on the nodes, edges, and faces retain their definitions.</p>
</li>
</ul>
<p>Any isolated nodes and edges might remain in the same face or be moved to a different face as a result of a move operation on a non-isolated node. The <a href="SDO_TOPO_MAP-reference.htm#GUID-5A836D8B-A319-46F2-B644-E845D6B804B9">SDO_TOPO_MAP.MOVE_NODE</a> procedure has two output parameters, <code class="codeph">moved_iso_nodes</code> and <code class="codeph">moved_iso_edges</code>, that store the ID numbers of any isolated nodes and edges that were moved to a different face as a result of the operation.</p>
<p>A node cannot be moved if, as a result of the move, any of the following would happen:</p>
<ul style="list-style-type: disc;">
<li>
<p>Any edges attached to the node would intersect any other edge. For example, assume that the original topology shown in <a href="editing-topologies.htm#GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGCJDDC">Figure 2-6</a> had included another edge E20 that passed just above and to the right of node N1. If the movement of node N1 would cause edge E3, E4, E6, E8, or E9 to intersect edge E20, the move operation is not performed.</p>
</li>
<li>
<p>The node would be moved to a face that does not currently bound the node. For example, if the movement of node N1 would place it outside the original topology shown in <a href="editing-topologies.htm#GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGCJDDC">Figure 2-6</a>, the move operation is not performed.</p>
</li>
<li>
<p>The node would be moved to the opposite side of an isolated face. This is not allowed because the move would change the topology by changing one or more of the following: the relationship or ordering of edges around the face, and the left and right face for each edge. <a href="editing-topologies.htm#GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGDACBI">Figure 2-7</a> shows a node movement (flipping node N1 from one side of isolated face F1 to the other side) that would not be allowed.</p>
<div class="figure" id="GUID-E280BEF9-D608-420A-93A6-DAE60A49CB8B__CEGDACBI">
<p class="titleinfigure">Figure 2-7 Node Move Is Not Allowed</p>
<img width="424" height="203" src="img/GUID-1FC9D93B-13D1-45F4-A0B6-BBE4A48DD62F-default.gif" alt="Description of Figure 2-7 follows" title="Description of Figure 2-7 follows"/><br/>
<a href="img_text/GUID-1FC9D93B-13D1-45F4-A0B6-BBE4A48DD62F-print.htm">Description of &#34;Figure 2-7 Node Move Is Not Allowed&#34;</a></div>
<!-- class="figure" --></li>
</ul>
</div>
<a id="TOPOL812"></a><a id="TOPOL811"></a>
<div class="props_rev_3"><a id="GUID-BBAC43C9-01E2-4484-B453-4C013FC9DCF4"></a>
<h4 id="TOPOL-GUID-BBAC43C9-01E2-4484-B453-4C013FC9DCF4" class="sect4">Additional Examples of Allowed and Disallowed Node Moves</h4>
<div>
<p>This section provides additional examples of node movement operations that are either allowed or not allowed. All refer to the topology shown in <a href="editing-topologies.htm#GUID-BBAC43C9-01E2-4484-B453-4C013FC9DCF4__CEGBEJIF">Figure 2-8</a>.</p>
<div class="figure" id="GUID-BBAC43C9-01E2-4484-B453-4C013FC9DCF4__CEGBEJIF">
<p class="titleinfigure">Figure 2-8 Topology for Node Movement Examples</p>
<img width="261" height="221" src="img/GUID-51DFCCB8-744E-4F7A-9EFA-7D6C57586B07-default.gif" alt="Description of Figure 2-8 follows" title="Description of Figure 2-8 follows"/><br/>
<a href="img_text/GUID-51DFCCB8-744E-4F7A-9EFA-7D6C57586B07-print.htm">Description of &#34;Figure 2-8 Topology for Node Movement Examples&#34;</a></div>
<!-- class="figure" -->
<p>In the topology shown in <a href="editing-topologies.htm#GUID-BBAC43C9-01E2-4484-B453-4C013FC9DCF4__CEGBEJIF">Figure 2-8</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Attempts will be made to move node N1 to points P1, P2, P3, and P4. (These points are locations but are not existing nodes.)</p>
</li>
<li>
<p>The edges have no shape points, either before or after the move operation.</p>
</li>
<li>
<p>New vertices are specified for the edges E1, E2, E3, and E4, but the ID values of the start and end points for the edges remain the same.</p>
</li>
</ul>
<p>When the following node move operations are attempted using the topology shown in <a href="editing-topologies.htm#GUID-BBAC43C9-01E2-4484-B453-4C013FC9DCF4__CEGBEJIF">Figure 2-8</a>, the following results occur:</p>
<ul style="list-style-type: disc;">
<li>
<p>Moving node N1 to point P1: Not allowed, because one or more of the four attached edges would intersect edge E5. (Edge E3 would definitely intersect edge E5 if the move were allowed.)</p>
</li>
<li>
<p>Moving node N1 to point P2: Allowed.</p>
</li>
<li>
<p>Moving node N1 to point P3: Allowed. However, this operation causes the isolated node N2 to change from face F2 to face F1, and this might cause the application to want to roll back or disallow the movement of node N1. Similarly, if the movement of a node would cause any isolated edges or faces to change from one face to another, the application might want to roll back or disallow the node move operation.</p>
</li>
<li>
<p>Moving node N1 to point P4: Not allowed, because the node must be moved to a point in a face that bounds the original (current) position of the node.</p>
</li>
</ul>
</div>
</div>
</div>
<a id="TOPOL814"></a><a id="TOPOL813"></a>
<div class="props_rev_3"><a id="GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867"></a>
<h3 id="TOPOL-GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867" class="sect3">Removing a Node</h3>
<div>
<p>You can remove individual nodes (isolated or non-isolated), as explained in this section, and you can remove all obsolete nodes in a topology, as explained in <a href="editing-topologies.htm#GUID-723A45B4-D759-4807-8A30-081552D0C8DF">Removing Obsolete Nodes</a>.</p>
<p>Removing a non-isolated node deletes the node and merges the edges that were attached to the node into a single edge. (Spatial and Graph applies complex rules, which are not documented, to determine the ID value and direction of the resulting edge.)</p>
<p>To remove a non-isolated or isolated node, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-087936D6-3E29-4598-9B86-A340C112F81C">SDO_TOPO_MAP.REMOVE_NODE</a> procedure.</p>
<p><a href="editing-topologies.htm#GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867__CEGCDECG">Figure 2-9</a> shows the removal of a node (N1) that is attached to edges E1 and E2.</p>
<div class="figure" id="GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867__CEGCDECG">
<p class="titleinfigure">Figure 2-9 Removing a Non-Isolated Node</p>
<img width="449" height="135" src="img/GUID-C1E3A949-5201-4277-9DA2-B1A0C0FB3D2C-default.gif" alt="Description of Figure 2-9 follows" title="Description of Figure 2-9 follows"/><br/>
<a href="img_text/GUID-C1E3A949-5201-4277-9DA2-B1A0C0FB3D2C-print.htm">Description of &#34;Figure 2-9 Removing a Non-Isolated Node&#34;</a></div>
<!-- class="figure" -->
<p>As a result of the operation shown in <a href="editing-topologies.htm#GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867__CEGCDECG">Figure 2-9</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Edge E1 is redefined to consist of the line segments that had represented the original edges E1 and E2.</p>
</li>
<li>
<p>Edge E2 is deleted.</p>
</li>
<li>
<p>If any linear features were defined on both original edges, they are automatically redefined to be on the resulting edge, and a record is added to the history information table (explained in <a href="topology-data-model-overview.htm#GUID-68020A3E-978F-4EB7-AAA8-8DABA17533BF">History Information Table</a>) for the topology. For example, if a street named Main Street had been defined on the original edges E1 and E2 in <a href="editing-topologies.htm#GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867__CEGCDECG">Figure 2-9</a>, then after the removal of node N1, Main Street would be defined on edge E1.</p>
</li>
</ul>
<p>A node cannot be removed if one or more of the following are true:</p>
<ul style="list-style-type: disc;">
<li>
<p>A point feature is defined on the node. For example, if a point feature named Metropolitan Art Museum had been defined on node N1 in <a href="editing-topologies.htm#GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867__CEGCDECG">Figure 2-9</a>, node N1 cannot be removed. Before you can remove the node in this case, you must remove the definition of any point features on the node.</p>
</li>
<li>
<p>A linear feature defined on either original edge is not also defined on both edges. For example, if a linear feature named Main Street had been defined on edge E1 but not edge E2 in <a href="editing-topologies.htm#GUID-56FF6B73-2042-44C4-9E4C-46AF6DE2B867__CEGCDECG">Figure 2-9</a>, node N1 cannot be removed.</p>
</li>
</ul>
</div>
</div>
<a id="TOPOL816"></a><a id="TOPOL815"></a>
<div class="props_rev_3"><a id="GUID-723A45B4-D759-4807-8A30-081552D0C8DF"></a>
<h3 id="TOPOL-GUID-723A45B4-D759-4807-8A30-081552D0C8DF" class="sect3">Removing Obsolete Nodes</h3>
<div>
<p>An <span class="bold">obsolete node</span> is a node that is connected to only two distinct edges, is not assigned to any point feature, and does not serve as the demarcation between different linear features. Obsolete nodes can result when the <a href="SDO_TOPO_MAP-reference.htm#GUID-3D557747-2249-4BAF-B3C8-3D4A6CA80876">SDO_TOPO_MAP.ADD_POLYGON_GEOMETRY</a> function is used repeatedly to build a topology, or when edges have been removed during editing operations, leaving some unnecessary nodes. Therefore, it is recommended that you use the <a href="SDO_TOPO_MAP-reference.htm#GUID-6C17F5AA-0233-475B-BB32-0094E9C7C182">SDO_TOPO_MAP.REMOVE_OBSOLETE_NODES</a> procedure to remove obsolete nodes in such cases.</p>
<p>Spatial and Graph automatically updates the appropriate entries in the &lt;topology-name&gt;_NODE$ and &lt;topology-name&gt;_EDGE$ tables, and in the &lt;topology-name&gt;_FACE$ table if necessary.</p>
<p><a href="editing-topologies.htm#GUID-723A45B4-D759-4807-8A30-081552D0C8DF__CEGCIIAA">Figure 2-10</a> shows the removal of obsolete nodes in a simple topology. In this topology, node N1 has a point feature named Art Museum defined on it, and node N3 has a point feature named Town Hall defined on it. Edges E1, E2, and E3 have a linear feature named Main Street defined on them, and edge E4 has a linear feature named First Avenue defined on it.</p>
<div class="figure" id="GUID-723A45B4-D759-4807-8A30-081552D0C8DF__CEGCIIAA">
<p class="titleinfigure">Figure 2-10 Removing Obsolete Nodes</p>
<img width="453" height="336" src="img/GUID-170DA8F7-7D39-47D7-AE58-E6FDAE4072BC-default.gif" alt="Description of Figure 2-10 follows" title="Description of Figure 2-10 follows"/><br/>
<a href="img_text/GUID-170DA8F7-7D39-47D7-AE58-E6FDAE4072BC-print.htm">Description of &#34;Figure 2-10 Removing Obsolete Nodes&#34;</a></div>
<!-- class="figure" -->
<p>In <a href="editing-topologies.htm#GUID-723A45B4-D759-4807-8A30-081552D0C8DF__CEGCIIAA">Figure 2-10</a>, the only node removed is N2, because only that node satisfies all the criteria for an obsolete node. As for the other nodes:</p>
<ul style="list-style-type: disc;">
<li>
<p>N1 is connected to only one edge (E1), and it has a point feature defined on it (Art Museum).</p>
</li>
<li>
<p>N3 has a point feature defined on it (Town Hall).</p>
</li>
<li>
<p>N4 is the demarcation between two different linear features (Main Street and First Avenue).</p>
</li>
<li>
<p>N5 is connected to only one edge (E4).</p>
</li>
<li>
<p>Node N6 is an isolated node (not connected to any edges).</p>
</li>
</ul>
<p>Also as a result of the operation shown in <a href="editing-topologies.htm#GUID-723A45B4-D759-4807-8A30-081552D0C8DF__CEGCIIAA">Figure 2-10</a>, edge E2 was removed as a result of the removal of node N2.</p>
</div>
</div>
</div>
<a id="TOPOL817"></a>
<div class="props_rev_3"><a id="GUID-48615C1B-6AAA-4088-B575-B9183737931C"></a>
<h2 id="TOPOL-GUID-48615C1B-6AAA-4088-B575-B9183737931C" class="sect2">Performing Operations on Edges</h2>
<div>
<p>This section describes the effects of adding, moving, removing, and updating edges, and explains how to perform these operations using the PL/SQL API.</p>
</div>
<a id="TOPOL819"></a><a id="TOPOL818"></a>
<div class="props_rev_3"><a id="GUID-C9D44B8A-6D3E-4179-822D-5BB8EB82A364"></a>
<h3 id="TOPOL-GUID-C9D44B8A-6D3E-4179-822D-5BB8EB82A364" class="sect3">Adding an Edge</h3>
<div>
<p>Adding a non-isolated edge adds the edge to a face. It also splits the face, causing the original face to be divided into two faces. Spatial and Graph automatically adjusts the definition of the original face and creates a new face (assigning it an ID value that is unique among faces in the topology).</p>
<p>To add an edge, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-D3945002-582C-484A-8D86-F20CF35C4555">SDO_TOPO_MAP.ADD_EDGE</a> procedure. You must specify existing nodes as the start and end nodes of the added edge.</p>
<p><a href="editing-topologies.htm#GUID-C9D44B8A-6D3E-4179-822D-5BB8EB82A364__CEGFGGBC">Figure 2-11</a> shows the addition of an edge (E7) between nodes N3 and N5 on face F3.</p>
<div class="figure" id="GUID-C9D44B8A-6D3E-4179-822D-5BB8EB82A364__CEGFGGBC">
<p class="titleinfigure">Figure 2-11 Adding a Non-Isolated Edge</p>
<img width="482" height="261" src="img/GUID-A2309C0C-384A-470A-AC59-B54588C635A0-default.gif" alt="Description of Figure 2-11 follows" title="Description of Figure 2-11 follows"/><br/>
<a href="img_text/GUID-A2309C0C-384A-470A-AC59-B54588C635A0-print.htm">Description of &#34;Figure 2-11 Adding a Non-Isolated Edge&#34;</a></div>
<!-- class="figure" -->
<p>As a result of the operation shown in <a href="editing-topologies.htm#GUID-C9D44B8A-6D3E-4179-822D-5BB8EB82A364__CEGFGGBC">Figure 2-11</a>, face F3 is redefined to be two faces, F1 and F3. (Spatial and Graph applies complex rules, which are not documented, to determine the ID values of the resulting faces.)</p>
<p>Any polygon features that were defined on the original face are automatically redefined to be on both resulting faces. For example, if a park named Walden State Park had been defined on the original face F3 in <a href="editing-topologies.htm#GUID-C9D44B8A-6D3E-4179-822D-5BB8EB82A364__CEGFGGBC">Figure 2-11</a>, then after the addition of edge E7, Walden State Park would be defined on both faces F1 and F3.</p>
</div>
</div>
<a id="TOPOL821"></a><a id="TOPOL820"></a>
<div class="props_rev_3"><a id="GUID-FDF038F6-1A6B-4224-BB2A-37A643C21447"></a>
<h3 id="TOPOL-GUID-FDF038F6-1A6B-4224-BB2A-37A643C21447" class="sect3">Moving an Edge</h3>
<div>
<p>Moving a non-isolated edge keeps the start or end point of the edge in the same position and moves the other of those two points to another existing node position. You must specify the source node (location before the move of the node to be moved), the target node (location after the move of the node being moved), and the vertices for the moved edge.</p>
<p>To move an edge, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-3EF0E053-EEE0-45EE-B4FD-E782115942BC">SDO_TOPO_MAP.MOVE_EDGE</a> procedure.</p>
<p><a href="editing-topologies.htm#GUID-FDF038F6-1A6B-4224-BB2A-37A643C21447__CEGEGBHJ">Figure 2-12</a> shows the movement of edge E7, which was originally between nodes N3 and N5, to be between nodes N2 and N5.</p>
<div class="figure" id="GUID-FDF038F6-1A6B-4224-BB2A-37A643C21447__CEGEGBHJ">
<p class="titleinfigure">Figure 2-12 Moving a Non-Isolated Edge</p>
<img width="482" height="261" src="img/GUID-6973B5DF-5258-476D-AE60-8D026A726051-default.gif" alt="Description of Figure 2-12 follows" title="Description of Figure 2-12 follows"/><br/>
<a href="img_text/GUID-6973B5DF-5258-476D-AE60-8D026A726051-print.htm">Description of &#34;Figure 2-12 Moving a Non-Isolated Edge&#34;</a></div>
<!-- class="figure" -->
<p>As a result of the operation shown in <a href="editing-topologies.htm#GUID-FDF038F6-1A6B-4224-BB2A-37A643C21447__CEGEGBHJ">Figure 2-12</a>, faces F1 and F3 are automatically redefined to reflect the coordinates of their edges, including the new coordinates for edge E7.</p>
<p>Any isolated nodes and edges might remain in the same face or be moved to a different face as a result of a move operation on a non-isolated edge. The <a href="SDO_TOPO_MAP-reference.htm#GUID-3EF0E053-EEE0-45EE-B4FD-E782115942BC">SDO_TOPO_MAP.MOVE_EDGE</a> procedure has two output parameters, <code class="codeph">moved_iso_nodes</code> and <code class="codeph">moved_iso_edges</code>, that store the ID numbers of any isolated nodes and edges that were moved to a different face as a result of the operation.</p>
<p>An edge cannot be moved if, as a result of the move, any of the following would happen:</p>
<ul style="list-style-type: disc;">
<li>
<p>The moved edge would intersect any other edge. For example, assume that the topology before the move, as shown in <a href="editing-topologies.htm#GUID-FDF038F6-1A6B-4224-BB2A-37A643C21447__CEGEGBHJ">Figure 2-12</a>, had included another edge (E10) that was between nodes N3 and N4. In this case, the movement of edge E7 would cause it to intersect edge E10, and therefore the move operation is not performed.</p>
</li>
<li>
<p>The node would be moved to a face that does not currently bound the edge. For example, if the movement of edge E7 would place its terminating point at a node outside the faces shown in <a href="editing-topologies.htm#GUID-FDF038F6-1A6B-4224-BB2A-37A643C21447__CEGEGBHJ">Figure 2-12</a> (F1 and F3), the move operation is not performed.</p>
</li>
</ul>
</div>
</div>
<a id="TOPOL823"></a><a id="TOPOL822"></a>
<div class="props_rev_3"><a id="GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6"></a>
<h3 id="TOPOL-GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6" class="sect3">Removing an Edge</h3>
<div>
<p>Removing a non-isolated edge deletes the edge and merges the faces that bounded the edge. (Spatial and Graph applies complex rules, which are not documented, to determine the ID value of the resulting face.)</p>
<p>To remove an edge, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-B3C764F7-A021-4FBC-9ACB-ABB748DB1971">SDO_TOPO_MAP.REMOVE_EDGE</a> procedure.</p>
<p><a href="editing-topologies.htm#GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6__CEGCFABJ">Figure 2-13</a> shows the removal of an edge (E7) that is bounded by faces F1 and F3.</p>
<div class="figure" id="GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6__CEGCFABJ">
<p class="titleinfigure">Figure 2-13 Removing a Non-Isolated Edge</p>
<img width="482" height="253" src="img/GUID-1276504C-9AE4-4784-B956-FBD9774FC670-default.gif" alt="Description of Figure 2-13 follows" title="Description of Figure 2-13 follows"/><br/>
<a href="img_text/GUID-1276504C-9AE4-4784-B956-FBD9774FC670-print.htm">Description of &#34;Figure 2-13 Removing a Non-Isolated Edge&#34;</a></div>
<!-- class="figure" -->
<p>As a result of the operation shown in <a href="editing-topologies.htm#GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6__CEGCFABJ">Figure 2-13</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Face F1 is redefined to consist of the area of the original faces F1 and F3.</p>
</li>
<li>
<p>Face F3 is deleted.</p>
</li>
<li>
<p>The start and end nodes of the deleted edge (nodes N3 and N5) are not removed.</p>
</li>
</ul>
<p><a id="d12844e1568" class="indexterm-anchor"></a>Any polygon features that were defined on both original faces are automatically redefined to be on the resulting face. For example, if a park named Adams Park had been defined on the original faces F1 and F3 in <a href="editing-topologies.htm#GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6__CEGCFABJ">Figure 2-13</a>, then after the removal of edge E7, Adams Park would be defined on face F1.</p>
<p>A non-isolated edge cannot be removed if one or more of the following are true:</p>
<ul style="list-style-type: disc;">
<li>
<p>A linear feature is defined on the edge. For example, if a linear feature named Main Street had been defined on edge E7 in <a href="editing-topologies.htm#GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6__CEGCFABJ">Figure 2-13</a>, edge E7 cannot be removed. Before you can remove the edge in this case, you must remove the definition of any linear features on the edge.</p>
</li>
<li>
<p>A polygon feature defined on either original face is not also defined on both faces. For example, if a linear feature named Adams Park had been defined on face F1 but not face F3 in <a href="editing-topologies.htm#GUID-4DC460E7-BF63-4170-BE98-BEC80C7995F6__CEGCFABJ">Figure 2-13</a>, edge E7 cannot be removed.</p>
</li>
</ul>
</div>
</div>
<a id="TOPOL824"></a>
<div class="props_rev_3"><a id="GUID-CB25F5C8-6F22-44FB-8107-367BFA327C4D"></a>
<h3 id="TOPOL-GUID-CB25F5C8-6F22-44FB-8107-367BFA327C4D" class="sect3">Updating an Edge</h3>
<div>
<p>Updating an isolated edge means changing one or more coordinates of the edge, but without changing the start point and end point.</p>
<p>To update an edge, use the <a href="SDO_TOPO_MAP-reference.htm#GUID-785884A2-4894-469B-B272-10E480F9EFC9">SDO_TOPO_MAP.CHANGE_EDGE_COORDS</a> procedure.</p>
<p>Any isolated nodes and edges might remain in the same face or be moved to a different face as a result of an update operation on a non-isolated edge. The <a href="SDO_TOPO_MAP-reference.htm#GUID-785884A2-4894-469B-B272-10E480F9EFC9">SDO_TOPO_MAP.CHANGE_EDGE_COORDS</a> procedure has two output parameters, <code class="codeph">moved_iso_nodes</code> and <code class="codeph">moved_iso_edges</code>, that store the ID numbers of any isolated nodes and edges that were moved to a different face as a result of the operation.</p>
<p>An edge cannot be updated if, as a result of the operation, it would intersect any other edge. See the Usage Notes for the <a href="SDO_TOPO_MAP-reference.htm#GUID-785884A2-4894-469B-B272-10E480F9EFC9">SDO_TOPO_MAP.CHANGE_EDGE_COORDS</a> procedure for more information about updating an edge.</p>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment106">
<tr>
<td class="cellalignment121">
<table class="cellalignment111">
<tr>
<td class="cellalignment110"><a href="topology-data-model-overview.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment110"><a href="SDO_TOPO-reference.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment123">
<table class="cellalignment109">
<tr>
<td class="cellalignment110"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment110"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment110"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment110"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment110"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment110"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>