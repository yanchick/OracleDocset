<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-114015"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20Oracle%20Clusterware%20to%20Manage%20Active%20Standby%20Pairs"></a><title>Using Oracle Clusterware to Manage Active Standby Pairs</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 726"/>
<meta name="dcterms.created" content="2014-09-29T11:11:55Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="TimesTen In-Memory Database Replication Guide"/>
<meta name="dcterms.identifier" content="E21635-11"/>
<meta name="dcterms.isVersionOf" content="TTREP"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2012, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="alterpair.htm" title="Previous" type="text/html"/>
<link rel="Next" href="design.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E21635-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">12/21</span> <!-- End Header -->
<div id="TTREP257" class="chapter"><a id="CCHCFAAD"></a>
<h1 class="chapter"><span class="secnum">8</span> Using Oracle Clusterware to Manage Active Standby Pairs</h1>
<p><a id="sthref361"></a>Oracle Clusterware monitors and controls applications to provide high availability. The following sections describe how to use Oracle Clusterware to manage availability for a TimesTen active standby pair:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For more information about Oracle Clusterware, see <a class="olink CWADD" href="../CWADD/toc.htm"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> in the Oracle Database documentation.</div>
<ul>
<li>
<p><a href="#CCHHBDIC">Overview of how Oracle Clusterware can manage TimesTen</a></p>
</li>
<li>
<p><a href="#CCHEEJEE">Configuring Oracle Clusterware management with the cluster.oracle.ini file</a></p>
</li>
<li>
<p><a href="#CCHDDHFB">Creating and initializing a cluster</a></p>
</li>
<li>
<p><a href="#BGBICBAD">Using Oracle Clusterware with a TimesTen cache grid</a></p>
</li>
<li>
<p><a href="#CCHGCBAG">Recovering from failures</a></p>
</li>
<li>
<p><a href="#CCHJIGGC">Clusterware management</a></p>
</li>
<li>
<p><a href="#BGBGBFBF">Monitoring cluster status</a></p>
</li>
</ul>
<a id="CCHHBDIC"></a>
<div id="TTREP258" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of how Oracle Clusterware can manage TimesTen</h2>
<p>Use Oracle Clusterware to manage only the following configurations:</p>
<ul>
<li>
<p>Active standby pair with or without read-only subscribers</p>
</li>
<li>
<p>Active standby pair (with or without read-only subscribers) with AWT cache groups, read-only cache groups, and global cache groups</p>
</li>
</ul>
<p><a href="#CCHIFBHJ">Figure 8-1</a> shows an active standby pair with one read-only subscriber in the same local network. The active database, the standby database and the read-only subscriber are on different nodes. There are two nodes that are not part of the active standby pair that are also running TimesTen. An application updates the active database. An application reads from the standby and the subscriber. All of the nodes are connected to shared storage.</p>
<div id="TTREP259" class="figure">
<p class="titleinfigure"><a id="CCHIFBHJ"></a>Figure 8-1 Active standby pair with one subscriber</p>
<img width="450" height="348" src="img/cluster.gif" alt="Description of Figure 8-1 follows"/><br/>
<a id="sthref362" href="img_text/cluster.htm">Description of &#34;Figure 8-1 Active standby pair with one subscriber&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>You can use Oracle Clusterware to start, monitor, and automatically fail over TimesTen databases and applications in response to node failures and other events. See <a href="#CCHJIGGC">&#34;Clusterware management&#34;</a> and <a href="#CCHGCBAG">&#34;Recovering from failures&#34;</a> for details.</p>
<p>Oracle Clusterware can be implemented at two levels of availability for TimesTen.</p>
<ul>
<li>
<p>The <a id="sthref363"></a><span class="italic">basic</span> level of availability manages two master nodes and up to 127 read-only subscriber nodes in the cluster. The active standby pair is defined with local host names or IP addresses. If both master nodes fail, user intervention is necessary to migrate the active standby scheme to new hosts. When both master nodes fail, Oracle Clusterware notifies the user.</p>
</li>
<li>
<p>The <a id="sthref364"></a><span class="italic">advanced</span> level of availability uses <a id="sthref365"></a><a id="sthref366"></a><a id="sthref367"></a>virtual IP addresses for the active, standby, and read-only subscriber databases. Extra nodes can be included in the cluster that are not part of the initial active standby pair. If a failure occurs, the use of virtual IP addresses enables one of the extra nodes to take on the role of a failed node automatically.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
If your applications connect to TimesTen in a client/server configuration, automatic client failover enables the client to reconnect automatically to the master database with the active role after a failure<a id="sthref368"></a><a id="sthref369"></a>. See <a href="definepair.htm#CHDEIBIA">&#34;Using automatic client failover for an active standby pair&#34;</a> and <a class="olink TTREF194" href="../TTREF/attribute.htm#TTREF194">&#34;TTC_FailoverPortRange&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</div>
<p>The <code><a id="sthref370"></a>ttCWAdmin</code> utility is used to administer TimesTen active standby pairs in a cluster that is managed by Oracle Clusterware. The configuration for each active standby pair is manually created in an initialization file called <code><a id="sthref371"></a>cluster.oracle.ini</code>. The information in this file is used to create Oracle Clusterware <span class="italic">resources</span>. <a id="sthref372"></a>Resources are used to manage the TimesTen daemon, TimesTen databases, TimesTen processes, user applications, and virtual IP addresses. You can run the <code>ttCWAdmin</code> utility from any host in the cluster, as long as the <code>cluster.oracle.ini</code> file is reachable and readable from this host. For more information about the <code>ttCWAdmin</code> utility, see <a class="olink TTREF336" href="../TTREF/util.htm#TTREF336">&#34;ttCWAdmin&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Reference</span>. For more information about the <code>cluster.oracle.ini</code> file, see <a href="#CCHEEJEE">&#34;Configuring Oracle Clusterware management with the cluster.oracle.ini file&#34;</a>.</p>
<div id="TTREP261" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref373"></a>
<h3 class="sect2">Required privileges<a id="sthref374"></a><a id="sthref375"></a></h3>
<p>See &#34;<a class="olink TTREF336" href="../TTREF/util.htm#TTREF336">ttCWAdmin</a>&#34; in <span class="italic">Oracle TimesTen In-Memory Database Reference</span> for information about the privileges required to run <code>ttCWAdmin</code> commands.</p>
</div>
<!-- class="sect2" -->
<div id="TTREP262" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref376"></a>
<h3 class="sect2">Hardware and software requirements</h3>
<p>TimesTen does not support Clusterware on Windows platforms.</p>
<p>TimesTen supports Oracle Clusterware releases 11.2.0.2 and 11.2.0.3 with TimesTen active standby pair replication. See <a class="olink CWADD" href="../CWADD/toc.htm"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for network and storage requirements and information about Oracle Clusterware configuration files.</p>
<p>Oracle Clusterware and TimesTen should be installed in the same location on all nodes. The TimesTen instance administrator must belong to the same UNIX primary group as the Oracle Clusterware installation owner.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>/tmp</code> directory contains essential TimesTen Oracle Clusterware directories. Their names have the prefix <code><a id="sthref377"></a><a id="sthref378"></a><a id="sthref379"></a>crsTT</code>. Do not delete them.</div>
<p>All hosts should use Network Time Protocol (<a id="sthref380"></a><a id="sthref381"></a><a id="sthref382"></a>NTP) or a similar system so that clocks on the hosts remain within 250 milliseconds of each other. When adjusting the system clocks on any nodes to be synchronized with each other, do not set any clock backward in time.</p>
</div>
<!-- class="sect2" -->
<div id="TTREP263" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref383"></a>
<h3 class="sect2">Restricted commands and SQL statements<a id="sthref384"></a></h3>
<p>When you use Oracle Clusterware with TimesTen, the active standby pair replication scheme is created on the active master with the <code>ttCWAdmin -create</code> command and dropped with the <code>ttCWAdmin -drop</code> command. In between the <code>ttCWAdmin -create</code> and <code>ttCWAdmin -drop</code> commands, you cannot execute any of the following commands or SQL statements. However, you can perform these commands or SQL statements when you use the <code>ttCWAdmin -beginAlterSchema</code> and the <code>ttCWAdmin -endAlterSchema</code> commands, as described in <a href="#CCHIHEFI">&#34;Changing the schema&#34;</a>.</p>
<ul>
<li>
<p>Creating, altering, or dropping the active standby pair with the <code>CREATE ACTIVE STANDBY PAIR</code>, <code>ALTER ACTIVE STANDBY PAIR</code>, and <code>DROP ACTIVE STANDBY PAIR</code> SQL statements.</p>
</li>
<li>
<p>Starting or stopping the replication agent with either the <code>-repStart</code> and <code>-repStop</code> options of the <code>ttAdmin</code> utility or the <code>ttRepStart</code> or <code>ttRepStop</code> built-in procedures.</p>
</li>
<li>
<p>Starting or stopping the cache agent after the active standby pair has been created with either the <code>-cacheStart</code> and <code>-cacheStop</code> options of the <code>ttAdmin</code> utility or the <code>ttCacheStart</code> and <code>ttCacheStop</code> built-in procedures.</p>
</li>
<li>
<p>Duplicating the database with the <code>-duplicate</code> option of the <code>ttRepAdmin</code> utility.</p>
</li>
<li>
<p>Executing any built-in procedures for managing a cache grid when the active standby pair in a cluster is a member of a grid.</p>
</li>
</ul>
<p>In addition, do not call <code>ttDaemonAdmin -stop</code> before calling <code>ttCWAdmin -shutdown</code>.</p>
<p>The TimesTen integration with Oracle Clusterware accomplishes these operations with the <code>ttCWAdmin</code> utility and the attributes specified in the <code>cluster.oracle.ini</code> file.</p>
<p>For more information about the built-ins and utilities, see <a class="olink TTREF" href="../TTREF/toc.htm"><span class="italic">Oracle TimesTen In-Memory Database Reference</span></a>. For more information about the SQL statements, see <a class="olink TTSQL" href="../TTSQL/toc.htm"><span class="italic">Oracle TimesTen In-Memory Database SQL Reference</span></a>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CCHEEJEE"></a>
<div id="TTREP264" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuring Oracle Clusterware management with the cluster.oracle.ini file<a id="sthref385"></a></h2>
<p>The information in the <code>cluster.oracle.ini</code> file is used to create Oracle Clusterware resources that manage TimesTen databases, TimesTen processes, user applications, and virtual IP addresses. Create an initialization file called <code>cluster.oracle.ini</code> as a text file.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
See <a href="clusterattributes.htm#BGBJFHBD">Appendix A, &#34;TimesTen Configuration Attributes for Oracle Clusterware&#34;</a> for details on all of the attributes that can be used in the <code>cluster.oracle.ini</code> file.</div>
<p><a id="sthref386"></a>The <code>ttCWAdmin -create</code> command reads this file for configuration information, so the location of the text file must be reachable and readable by <code>ttCWAdmin</code>. The <code><a id="sthref387"></a>ttCWAdmin</code> utility is used to administer TimesTen active standby pairs in a cluster that is managed by Oracle Clusterware.</p>
<p>It is recommended that you place this file in the TimesTen daemon home directory on the host for the active database. However, you can place this file in any directory or shared drive on the same host as where you run the <code>ttCWAdmin -create</code> command.</p>
<p>The default location for this file is in the <code><span class="codeinlineitalic">install_dir</span></code><code>/info</code> directory. If you place this file in another location, identify the path of the location with the <code>-ttclusterini</code> option.</p>
<p>The entry name in the <code>cluster.oracle.ini</code> file must be the same as an existing system DSN in the <code>sys.odbc.ini</code> file. <a id="sthref388"></a><a id="sthref389"></a>For example, <code>[basicDSN]</code> is the entry name in the <code>cluster.oracle.ini</code> file described in <a href="#CCHDFIAF">&#34;Configuring basic availability&#34;</a>. <code>[basicDSN]</code> must also be the <code>DataStore</code> and <code>Data Source Name</code> data store attributes in the <code>sys.odbc.ini</code> files on each host. For example, the <code>sys.odbc.ini</code> file for the <code>basicDSN</code> DSN on <code>host1</code> might be:</p>
<pre>[basicDSN]
DataStore=/path1/basicDSN
LogDir=/path1/log
DatabaseCharacterSet=AL32UTF8
ConnectionCharacterSet=AL32UTF8
</pre>
<p>The <code>sys.odbc.ini</code> file for <code>basicDSN</code> on <code>host2</code> can have a different path, but all other attributes should be the same:</p>
<pre>[basicDSN]
DataStore=/path2/basicDSN
LogDir=/path2/log
DatabaseCharacterSet=AL32UTF8
ConnectionCharacterSet=AL32UTF8
</pre>
<p>The following sections demonstrate sample configurations of the <code>cluster.oracle.ini</code> file:</p>
<ul>
<li>
<p><a href="#CCHDFIAF">Configuring basic availability</a></p>
</li>
<li>
<p><a href="#CCHCJGEA">Configuring advanced availability</a></p>
</li>
<li>
<p><a href="#CCHBEDGJ">Including cache groups in the active standby pair</a></p>
</li>
<li>
<p><a href="#BGBEDHCA">Including the active standby pair in a cache grid</a></p>
</li>
<li>
<p><a href="#CCHCCDEA">Implementing application failover</a></p>
</li>
<li>
<p><a href="#CCHEDEHA">Recovering from permanent failure of both master nodes</a></p>
</li>
<li>
<p><a href="#CCHHFJIE">Using the RepDDL attribute</a></p>
</li>
</ul>
<a id="CCHDFIAF"></a>
<div id="TTREP265" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring basic availability<a id="sthref390"></a></h3>
<p>This example shows an active standby pair with no subscribers. The host for the active database is the first <code>MasterHost</code> defined (<code>host1</code>) and the standby database is the second <code>MasterHost</code> in the list (<code>host2</code>). Each host in the list is delimited by commas. You can include spaces for readability, if desired.</p>
<pre>[basicDSN]
<a href="clusterattributes.htm#BGBEBCCI">MasterHosts</a>=host1,host2
</pre>
<p>The following is an <a id="sthref391"></a>example of a <code>cluster.oracle.ini</code> file for an active standby pair with one subscriber on <code>host3</code>:</p>
<pre>[basicSubscriberDSN]
MasterHosts=host1,host2
<a href="clusterattributes.htm#BGBHIDIC">SubscriberHosts</a>=host3
</pre></div>
<!-- class="sect2" -->
<a id="CCHCJGEA"></a>
<div id="TTREP266" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configuring advanced availability<a id="sthref392"></a></h3>
<p>Advanced availability involves configuring spare master or subscriber hosts that are idle until needed to replace master or subscriber hosts (used in the active standby pair replication scheme) that either shut down unexpectedly or experience an unrecoverable error.</p>
<p>As mentioned in <a href="#CCHDFIAF">&#34;Configuring basic availability&#34;</a>, the <code>MasterHosts</code> attribute in the <code>cluster.oracle.ini</code> file configures the hosts that are used as the master nodes. For an active standby pair replication scheme, you only need two master hosts. In the event of a failure, the host that did not fail becomes the active database (if not already the active database) and the failed host is recovered and becomes the standby master. However, if the failed host cannot be recovered and if you specified more than two hosts as master hosts in the <code>cluster.oracle.ini</code> file, then the next master host in the list can be instantiated to take the place of an unrecoverable master host.</p>
<p>For example, the following shows a configuration of several master hosts. The first two master hosts (<code>host1</code> and <code>host2</code>) are used for the active and standby masters; the latter two master hosts (<code>host3</code> and <code>host4</code>) can be used to take the place of either <code>host1</code> or <code>host2</code> if either encounter an unrecoverable failure.</p>
<pre>MasterHosts=host1,host2,host3,host4
</pre>
<p>When you configure more than two multiple hosts, you should also configure two virtual IP (VIP) addresses used only by Oracle Clusterware resources that manage TimesTen resources. With these VIP addresses, TimesTen internal processes (those that manage replication) are isolated from any master host changes that may occur because of an unrecoverable host error.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The Oracle Clusterware resource that manage these VIP addresses (used in advanced availability) are created with the <code>ttCWAdmin -createVIPs</code> command, as described in <a href="#CCHGAGGB">&#34;Create the Oracle Clusterware resources to manage virtual IP addresses&#34;</a>.</div>
<p>These VIP addresses must be different from any other VIP addresses defined for Oracle Clusterware use or any VIP addresses that are to be used by user applications. Furthermore, if an application does use these VIP addresses, then the application may encounter errors when a master host fails (either recoverable or unrecoverable). These VIP addresses cannot be used by a user application as a method for client failover or as a method to isolate themselves if an active database and standby master switch.</p>
<p>Specify two VIP addresses in the <code><a href="clusterattributes.htm#BGBEAAIG">MasterVIP</a></code> parameter, one for each master host in the active standby pair replication scheme. The VIP addresses specified for the TimesTen cluster must be different from any VIP addresses already defined and used by Oracle Clusterware. In particular, the VIP addresses that are created during the Oracle Clusterware install cannot be used with TimesTen.</p>
<pre>MasterVIP=192.168.1.1, 192.168.1.2
</pre>
<p>The following parameters are also associated with advanced availability in the <code>cluster.oracle.ini</code> file:</p>
<ul>
<li>
<p><code><a href="clusterattributes.htm#BGBHIDIC">SubscriberHosts</a></code>, similar to <code><a href="clusterattributes.htm#BGBEBCCI">MasterHosts</a></code> lists the host names that can contain subscriber databases.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBIBHIA">SubscriberVIP</a></code>, similar to <code><a href="clusterattributes.htm#BGBEAAIG">MasterVIP</a></code>, provides VIP addresses that can be used by TimesTen internally to manage a subscriber node.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBJABEC">VIPInterface</a></code> is the name of the public network adaptor.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBEBGBG">VIPNetMask</a></code> defines the netmask of the virtual IP addresses.</p>
</li>
</ul>
<p>In the following example, the hosts for the active database and the standby database are <code>host1</code> and <code>host2</code>. The hosts available for instantiation in case of an unrecoverable error are <code>host3</code> and <code>host4</code>. There are no subscriber nodes. <code>VIPInterface</code> is the name of the public network adaptor. <code>VIPNetMask</code> defines the netmask of the virtual IP addresses.</p>
<pre>[advancedDSN]
MasterHosts=host1,host2,host3,host4
MasterVIP=192.168.1.1, 192.168.1.2
VIPInterface=eth0
VIPNetMask=255.255.255.0
</pre>
<p>The following <a id="sthref393"></a>example configures a single subscriber on <code>host4</code>. There is one extra host defined in <code>SubscriberHosts</code> that can be used for failover of the master databases and one extra node that can be used for failover of the subscriber database. <code>MasterVIP</code> and <code><a href="clusterattributes.htm#BGBIBHIA">SubscriberVIP</a></code> specify the virtual IP addresses defined for the master and subscriber hosts.</p>
<pre>[advancedSubscriberDSN]
MasterHosts=host1,host2,host3
SubscriberHosts=host4,host5
MasterVIP=192.168.1.1, 192.168.1.2
SubscriberVIP=192.168.1.3
VIPInterface=eth0
VIPNetMask=255.255.255.0
</pre>
<p>Ensure that the extra master nodes:</p>
<ul>
<li>
<p>Have TimesTen installed</p>
</li>
<li>
<p>Have the direct-linked application installed if this is part of the configuration. See <a href="#CCHCCDEA">&#34;Implementing application failover&#34;</a>.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CCHBEDGJ"></a>
<div id="TTREP267" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Including cache groups in the active standby pair<a id="sthref394"></a><a id="sthref395"></a></h3>
<p>If the active standby pair replicates one or more AWT or read-only cache groups, set the <code><a href="clusterattributes.htm#BGBJBEGH">CacheConnect</a></code> attribute to <code>y</code>.</p>
<p>This example specifies an active standby pair with one subscriber in an advanced availability configuration. The active standby pair replicates one or more cache groups.</p>
<pre>[advancedCacheDSN]
MasterHosts=host1,host2,host3
SubscriberHosts=host4, host5
MasterVIP=192.168.1.1, 192.168.1.2
SubscriberVIP=192.168.1.3
VIPInterface=eth0
VIPNetMask=255.255.255.0
CacheConnect=y
</pre></div>
<!-- class="sect2" -->
<a id="BGBEDHCA"></a>
<div id="TTREP682" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Including the active standby pair in a cache grid<a id="sthref396"></a><a id="sthref397"></a></h3>
<p>If the active standby pair is a member of a cache grid, assign port numbers for the active and standby databases by setting the <a id="sthref398"></a><a id="sthref399"></a><code><a href="clusterattributes.htm#BABIDFGI">GridPort</a></code> attribute.</p>
<p>This example specifies an active standby pair with no subscribers in an advanced availability configuration. The active standby pair is a member of a cache grid.</p>
<pre>[advancedGridDSN]
MasterHosts=host1,host2,host3
MasterVIP=192.168.1.1, 192.168.1.2
VIPInterface=eth0
VIPNetMask=255.255.255.0
CacheConnect=y
GridPort=16101, 16102
</pre>
<p>For more information about using Oracle Clusterware with a cache grid, see <a href="#BGBICBAD">&#34;Using Oracle Clusterware with a TimesTen cache grid&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="CCHCCDEA"></a>
<div id="TTREP268" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Implementing application failover<a id="sthref400"></a><a id="sthref401"></a></h3>
<p>TimesTen integration with Oracle Clusterware can facilitate the failover of a TimesTen application that is linked to any of the databases in the active standby pair. TimesTen can manage both direct-linked and client/server applications that are on the same host as Oracle Clusterware and TimesTen.</p>
<p>The required attributes in the <code>cluster.oracle.ini</code> file for failing over a TimesTen application are as follows:</p>
<ul>
<li>
<p><code><a href="clusterattributes.htm#BGBHGJCI">AppName</a></code> - Name of the application to be managed by Oracle Clusterware</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBIDJGF">AppStartCmd</a></code> - Command line for starting the application</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBCJHGC">AppStopCmd</a></code> - Command line for stopping the application</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBIHDGF">AppCheckCmd</a></code> - Command line for executing an application that checks the status of the application specified by <code>AppName</code></p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBGHCCD">AppType</a></code> - Determines the database to which the application is linked. The possible values are <code>Active</code>, <code>Standby</code>, <code>DualMaster</code>, <code>Subscriber (all)</code> and <code>Subscriber</code><code>[</code><code><span class="codeinlineitalic">index</span></code><code>]</code>.</p>
</li>
</ul>
<p>There are also several optional attributes that you can configure, such as <code><a href="clusterattributes.htm#BGBCGJAE">AppFailureThreshold</a></code>, <code><a href="clusterattributes.htm#BGBHEEDD">DatabaseFailoverDelay</a></code>, and <code><a href="clusterattributes.htm#BGBJBHDJ">AppScriptTimeout</a></code>. All optional attributes (and their default values) are listed and described in <a href="clusterattributes.htm#BGBFGHFE">Table A-3, &#34;Optional attributes&#34;</a>.</p>
<p>The TimesTen application monitor process uses the user-supplied script or program specified by <code>AppCheckCmd</code> to monitor the application. The script that checks the status of the application must be written to return <code>0</code> for success and a nonzero number for failure. When Oracle Clusterware detects a nonzero value, it takes action to recover the failed application.</p>
<p>This <a id="sthref402"></a>example shows advanced availability configured for an active standby pair with with no subscribers. The <code>reader</code> application is an application that queries the data in the standby database. <code>AppStartCmd</code>, <code>AppStopCmd</code> and <code>AppCheckCmd</code> can include arguments such as <code>start</code>, <code>stop</code> and <code>check</code> commands.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Do not use quotes in the values for <code>AppStartCmd</code>, <code>AppStopCmd</code> and <code>AppCheckCmd</code>.</div>
<pre>[appDSN]
MasterHosts=host1,host2,host3,host4
MasterVIP=192.168.1.1, 192.168.1.2
VIPInterface=eth0
VIPNetMask=255.255.255.0
AppName=reader
AppType=Standby
AppStartCmd=/mycluster/reader/app_start.sh start
AppStopCmd=/mycluster/reader/app_stop.sh stop
AppCheckCmd=/mycluster/reader/app_check.sh check
</pre>
<p>You can configure failover for more than one application. Use <code>AppName</code> to name the application and provide values for <code>AppType</code>, <code>AppStartCmd</code>, <code>AppStopCmd</code> and <code>AppCheckCmd</code> immediately following the <code>AppName</code> attribute. You can include blank lines for readability. For example:</p>
<pre>[app2DSN]
MasterHosts=host1,host2,host3,host4
MasterVIP=192.168.1.1, 192.168.1.2
VIPInterface=eth0
VIPNetMask=255.255.255.0

AppName=reader
AppType=Standby
AppStartCmd=/mycluster/reader/app_start.sh
AppStopCmd=/mycluster/reader/app_stop.sh
AppCheckCmd=/mycluster/reader/app_check.sh

AppName=update
AppType=Active
AppStartCmd=/mycluster/update/app2_start.sh
AppStopCmd=/mycluster/update/app2_stop.sh
AppCheckCmd=/mycluster/update/app2_check.sh
</pre>
<p>If you set <code><a href="clusterattributes.htm#BGBGHCCD">AppType</a></code> to <code><a id="sthref403"></a><a id="sthref404"></a>DualMaster</code>, the application starts on both the active and the standby hosts. The failure of the application on the active host causes the active database and all other applications on the host to fail over to the standby host. You can configure the failure interval, the number of restart attempts, and the uptime threshold by setting the <code><a href="clusterattributes.htm#BABBHDAH">AppFailureInterval</a></code>, <code><a href="clusterattributes.htm#BABIDBFB">AppRestartAttempts</a></code> and <code><a href="clusterattributes.htm#BABDECHA">AppUptimeThreshold</a></code> attributes. These attributes have default values. For example:</p>
<pre>[appDualDSN]
MasterHosts=host1,host2,host3,host4
MasterVIP=192.168.1.1, 192.168.1.2
VIPInterface=eth0
VIPNetMask=255.255.255.0
AppName=update
AppType=DualMaster
AppStartCmd=/mycluster/update/app2_start.sh
AppStopCmd=/mycluster/update/app2_stop.sh
AppCheckCmd=/mycluster/update/app2_check.sh
AppRestartAttempts=5
AppUptimeThreshold=300
AppFailureInterval=30
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
For a full description of all configuration attributes, see <a href="clusterattributes.htm#BGBJFHBD">Appendix A, &#34;TimesTen Configuration Attributes for Oracle Clusterware&#34;</a>.</div>
</div>
<!-- class="sect2" -->
<a id="CCHEDEHA"></a>
<div id="TTREP269" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Recovering from permanent failure of both master nodes<a id="sthref405"></a><a id="sthref406"></a></h3>
<p>If both master nodes fail and then come back up, Oracle Clusterware can automatically recover the master databases. Automatic recovery of temporary dual failure requires the following:</p>
<ul>
<li>
<p><code>RETURN TWOSAFE</code> is not specified for the active standby pair.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBGGIDC">AutoRecover</a></code> is set to <code>y</code>.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBEJFJA">RepBackupDir</a></code> specifies a directory on shared storage.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBEFEHC">RepBackupPeriod</a></code> is set to a value greater than <code>0</code>.</p>
</li>
</ul>
<p>If both master nodes fail permanently, Oracle Clusterware can automatically recover the master databases to two new nodes if the following is true:</p>
<ul>
<li>
<p>Advanced availability is configured (virtual IP addresses and at least four hosts).</p>
</li>
<li>
<p>The active standby pair does not replicate cache groups.</p>
</li>
<li>
<p>A cache grid is not configured.</p>
</li>
<li>
<p><code>RETURN TWOSAFE</code> is not specified.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBGGIDC">AutoRecover</a></code> is set to <code>y</code>.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBEJFJA">RepBackupDir</a></code> specifies a directory on shared storage.</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBEFEHC">RepBackupPeriod</a></code> must be set to a value greater than <code>0</code>.</p>
</li>
</ul>
<p>TimesTen first performs a full backup of the active database and then performs incremental backups. You can specify the optional attribute <code><a href="clusterattributes.htm#BGBCDBAF">RepFullBackupCycle</a></code> to manage when TimesTen performs subsequent full backup. By default, TimesTen performs a full backup after every five incremental backups.</p>
<p>If <code>RepBackupDir</code> and <code>RepBackupPeriod</code> are configured for backups, TimesTen performs backups for any master database that becomes active. <a id="sthref407"></a>It does not delete backups that were performed for a database that used to be active and has become the standby unless the database becomes active again. Ensure that the shared storage has enough space for two complete database backups. The <code>ttCWAdmin -restore</code> command automatically chooses the correct backup files.</p>
<p>Incremental backups increase the amount of log records in the transaction log files. Ensure that the values of <code>RepBackupPeriod</code> and <code>RepFullBackupCycle</code> are small enough to prevent a large amount of log records in the transaction log file.</p>
<p>This <a id="sthref408"></a>example shows attribute settings for automatic recovery.</p>
<pre>[autorecoveryDSN]
MasterHosts=host1,host2,host3,host4
MasterVIP=192.168.1.1, 192.168.1.2
VIPInterface=eth0
VIPNetMask=255.255.255.0
AutoRecover=y
RepBackupDir=/<span class="italic">shared_drive</span>/dsbackup
RepBackupPeriod=3600
</pre>
<p>If you have cache groups in the active standby pair or prefer to <a id="sthref409"></a>recover manually from failure of both master hosts, ensure that <code>AutoRecover</code> is set to <code>n</code> (the default). Manual recovery requires the following:</p>
<ul>
<li>
<p><code><a href="clusterattributes.htm#BGBEJFJA">RepBackupDir</a></code> specifies a directory on shared storage</p>
</li>
<li>
<p><code><a href="clusterattributes.htm#BGBEFEHC">RepBackupPeriod</a></code> must be set to a value greater than <code>0</code></p>
</li>
</ul>
<p>This example shows attribute settings for manual recovery. The default value for <code>AutoRecover</code> is <code>n</code>, so it is not included in the file.</p>
<pre>[manrecoveryDSN]
MasterHosts=host1,host2,host3
MasterVIP=192.168.1.1, 192.168.1.2
VIPInterface=eth0
VIPNetMask=255.255.255.0
RepBackupDir=/<span class="italic">shared_drive</span>/dsbackup
RepBackupPeriod=3600
</pre></div>
<!-- class="sect2" -->
<a id="CCHHFJIE"></a>
<div id="TTREP270" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Using the <a id="sthref410"></a><a id="sthref411"></a>RepDDL attribute</h3>
<p>The <code><a href="clusterattributes.htm#BGBDGJFB">RepDDL</a></code> attribute represents the SQL statement that creates the active standby pair. The <code>RepDDL</code> attribute is optional. You can use it to exclude tables, cache groups and sequences from the active standby pair.</p>
<p>If you include <code>RepDDL</code> in the <code>cluster.oracle.ini</code> file, do not specify <code>ReturnServiceAttribute</code>, <code>MasterStoreAttribute</code> or <code>SubscriberStoreAttribute</code> in the <code>cluster.oracle.ini</code> file. Include those replication settings in the <code>RepDDL</code> attribute.</p>
<p>When you specify a value for <code>RepDDL</code>, use the <code>&lt;DSN&gt;</code> macro for the database file name prefix. Use the <code>&lt;MASTERHOST[1]&gt;</code> and <code>&lt;MASTERHOST[2]&gt;</code> macros to specify the master host names. TimesTen substitutes the correct values from the <code>MasterHosts</code> or <code>MasterVIP</code> attributes, depending on whether your configuration uses virtual IP addresses. Similarly, use the <code>&lt;SUBSCRIBERHOST[</code><code><span class="codeinlineitalic">n</span></code><code>]&gt;</code> macro to specify subscriber host names, where <code><span class="codeinlineitalic">n</span></code> is a number from 1 to the total number of <code>SubscriberHosts</code> attribute values or 1 to the total number of <code>SubscriberVIP</code> attribute values if virtual IP addresses are used.</p>
<p>U<a id="sthref412"></a>se the <code>RepDDL</code> attribute to exclude tables, cache groups, and sequences from the active standby pair:</p>
<pre>[excludeDSN]
MasterHosts=host1,host2,host3,host4
SubscriberHosts=host5,host6
MasterVIP=192.168.1.1, 192.168.1.2
SubscriberVIP=192.168.1.3
VIPInterface=eth0
VIPNetMask=255.255.255.0
RepDDL=CREATE ACTIVE STANDBY PAIR \
&lt;DSN&gt; ON &lt;MASTERHOST[1]&gt;, &lt;DSN&gt; ON &lt;MASTERHOST[2]&gt;
SUBSCRIBER &lt;DSN&gt; ON &lt;SUBSCRIBERHOST[1]&gt;\
EXCLUDE TABLE pat.salaries, \
EXCLUDE CACHE GROUP terry.salupdate, \
EXCLUDE SEQUENCE ttuser.empcount
</pre>
<p>The <a id="sthref413"></a><a id="sthref414"></a><a id="sthref415"></a><a id="sthref416"></a>replication agent transmitter obtains route information as follows, in order of priority:</p>
<ol>
<li>
<p>From the <code>ROUTE</code> clause in the <code>RepDDL</code> setting, if a <code>ROUTE</code> clause is specified. Do not specify a <code>ROUTE</code> clause if you are configuring advanced availability.</p>
</li>
<li>
<p>From Oracle Clusterware, which provides the private host names and public host names of the local and remote hosts as well as the remote daemon port number. The private host name is preferred over the public host name. If the replication agent transmitter cannot connect to the IPC socket, it attempts to connect to the remote daemon using information that Oracle Clusterware maintains about the replication scheme.</p>
</li>
<li>
<p>From the active and standby hosts. If they fail, then the replication agent chooses the connection method based on host name.</p>
</li>
</ol>
<p>This is an example of specifying the <code>ROUTE</code> clause in <code>RepDDL</code>:</p>
<pre>[routeDSN]
MasterHosts=host1,host2,host3,host4
RepDDL=CREATE ACTIVE STANDBY PAIR \
&lt;DSN&gt; ON &lt;MASTERHOST[1]&gt;, &lt;DSN&gt; ON &lt;MASTERHOST[2]&gt;\
ROUTE MASTER &lt;DSN&gt; ON &lt;MASTERHOST[1]&gt;  SUBSCRIBER &lt;DSN&gt; ON &lt;MASTERHOST[2]&gt;\
MASTERIP &#34;192.168.1.2&#34; PRIORITY 1\
SUBSCRIBERIP &#34;192.168.1.3&#34; PRIORITY 1\ 
MASTERIP &#34;10.0.0.1&#34; PRIORITY 2\
SUBSCRIBERIP &#34;10.0.0.2&#34; PRIORITY 2\
MASTERIP &#34;140.87.11.203&#34; PRIORITY 3\
SUBSCRIBERIP &#34;140.87.11.204&#34; PRIORITY 3\
ROUTE MASTER &lt;DSN&gt; ON &lt;MASTERHOST[2]&gt;  SUBSCRIBER &lt;DSN&gt; ON &lt;MASTERHOST[1]&gt;\
MASTERIP &#34;192.168.1.3&#34; PRIORITY 1\
SUBSCRIBERIP &#34;192.168.1.2&#34; PRIORITY 1\ 
MASTERIP &#34;10.0.0.2&#34; PRIORITY 2\
SUBSCRIBERIP &#34;10.0.0.1&#34; PRIORITY 2\
MASTERIP &#34;140.87.11.204&#34; PRIORITY 3\
SUBSCRIBERIP &#34;140.87.11.203&#34; PRIORITY 3\
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CCHDDHFB"></a>
<div id="TTREP271" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Creating and initializing a cluster</h2>
<p>To create and initialize a cluster, perform these tasks:</p>
<ul>
<li>
<p><a href="#CCHBEDEF">Install Oracle Clusterware</a></p>
</li>
<li>
<p><a href="#CCHJIBEJ">Install TimesTen on each host</a></p>
</li>
<li>
<p><a href="#CCHEFEDD">Register the TimesTen cluster information</a></p>
</li>
<li>
<p><a href="#CCHEIGJJ">Start the TimesTen cluster agent</a></p>
</li>
<li>
<p><a href="#CCHHDIJH">Create and populate a TimesTen database on one host</a></p>
</li>
<li>
<p><a href="#BGBHDFHF">Create system DSN files on other hosts</a></p>
</li>
<li>
<p><a href="#CCHHDGCC">Create a cluster.oracle.ini file</a></p>
</li>
<li>
<p><a href="#CCHGAGGB">Create the Oracle Clusterware resources to manage virtual IP addresses</a></p>
</li>
<li>
<p><a href="#CCHCCAFE">Create an active standby pair replication scheme</a></p>
</li>
<li>
<p><a href="#CCHDBBDG">Start the active standby pair and the applications</a></p>
</li>
<li>
<p><a href="#BGBFAAAB">Load cache groups</a></p>
</li>
<li>
<p><a href="#CCHFJGIC">Include more than one active standby pair in a cluster</a></p>
</li>
<li>
<p><a href="#BGBEEFAH">Configure an Oracle database as a disaster recovery subscriber</a></p>
</li>
<li>
<p><a href="#BGBFDBGB">Configure a read-only subscriber that is not managed by Oracle Clusterware</a></p>
</li>
</ul>
<p>If you plan to have more than one active standby pair in the cluster, see <a href="#CCHFJGIC">&#34;Include more than one active standby pair in a cluster&#34;</a>.</p>
<p>If you want to configure an Oracle database as a remote disaster recovery subscriber, see <a href="#BGBEEFAH">&#34;Configure an Oracle database as a disaster recovery subscriber&#34;</a>.</p>
<p>If you want to set up a read-only subscriber that is not managed by Oracle Clusterware, see <a href="#BGBFDBGB">&#34;Configure a read-only subscriber that is not managed by Oracle Clusterware&#34;</a>.</p>
<a id="CCHBEDEF"></a>
<div id="TTREP272" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Install Oracle Clusterware<a id="sthref417"></a><a id="sthref418"></a></h3>
<p>Install Oracle Clusterware. By default, the installation occurs on all hosts concurrently. See Oracle Clusterware installation documentation for your platform.</p>
<p>Oracle Clusterware starts automatically after successful installation.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can verify whether Oracle Clusterware is running on all hosts in the cluster by executing the following:
<pre>crsctl check crs -all
</pre></div>
</div>
<!-- class="sect2" -->
<a id="CCHJIBEJ"></a>
<div id="TTREP273" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Install TimesTen on each host</h3>
<p>Install TimesTen in the same location on each host in the cluster, including extra hosts. The instance name must be the same on each host. The user name of the instance administrator must be the same on all hosts. The TimesTen instance administrator must belong to the same UNIX primary group as the Oracle Clusterware installation owner.</p>
<p>The installer prompts you for values for the following, each of which are stored in the <a id="sthref419"></a><code>ttcrsagent.options</code> file:</p>
<ul>
<li>
<p>The TCP/IP port number associated with the TimesTen cluster <a id="sthref420"></a><a id="sthref421"></a>agent. The port number must be the same on all nodes of the cluster. If you do not provide a port number, then TimesTen adds six to the default TimesTen daemon port number to be the TCP/IP port number associated with the TimesTen cluster agent. Thus, the default daemon port number associated with the TimesTen cluster agent is 53398 for 32-bit systems and 53402 for 64-bit systems.</p>
</li>
<li>
<p>The Oracle Clusterware location. The location must be the same on each host.</p>
</li>
<li>
<p>The hosts included in the cluster, including spare hosts, with host names separated by commas. This list must be the same on each host.</p>
</li>
</ul>
<p>The <code>ttCWAdmin &ndash;init</code> and <code>ttCWAdmin &ndash;shutdown</code> commands use the <code>ttcrsagent.options</code> file to initiate and shut down the TimesTen cluster. The <code>ttcrsagent.options</code> file is located in the TimesTen daemon home directory.</p>
<p>You should not manually alter the <code>ttcrsagent.options</code> file. Instead, use the <code>ttmodinstall -crs</code> command to create or modify the information in this file after the TimesTen cluster has been initiated. You can also use the <code>-record</code> and <code>-batch</code> options for <code>setup.sh</code> to perform identical installations on additional hosts.</p>
<p>The current home location of Oracle Clusterware is set in the <code>CRS_HOME</code> environment variable. In addition, the <code>ttmodinstall -crs</code> command shows the current location of the Oracle Clusterware home as part of the prompts.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For more information on the <a id="sthref422"></a><code>ttcrsagent.options</code> file, see <a href="#CCHEIGJJ">&#34;Start the TimesTen cluster agent&#34;</a>. For more information about <code>ttmodinstall</code>, see <a class="olink TTREF352" href="../TTREF/util.htm#TTREF352">&#34;ttmodinstall&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</div>
<p>The following example shows how the <code>ttmodinstall -crs</code> prompts for you to modify each item in the <code>ttcrsagent.options</code> file:</p>
<pre>% ttmodinstall -crs

Cannot find instance_info file : /etc/TimesTen/instance_info

Would you like to modify the existing TimesTen Replication with Oracle 
Clusterware configuration? [ no ] yes

This TimesTen instance is configured to use an Oracle Clusterware installation
located in : /mydir/oracle/crs/app/11.2.0/grid
Would you like to change this value? [ no ] no

The TimesTen Clusterware agent is configured to use port 54504
Would you like to change this value? [ no ] no

The TimesTen Clusterware agent is currently configured with these nodes :
 
node1
node2
node3
node4
 
Would you like to change these values? [ no ]

Overwrite the existing TimesTen Clusterware options file? [ no ] no
</pre></div>
<!-- class="sect2" -->
<a id="CCHEFEDD"></a>
<div id="TTREP661" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Register the TimesTen cluster information</h3>
<p>TimesTen <a id="sthref423"></a><a id="sthref424"></a><a id="sthref425"></a>cluster information is stored in the Oracle Cluster Registry (OCR). As the root user, enter this command:</p>
<pre>ttCWAdmin -ocrConfig
</pre>
<p>As long as Oracle Clusterware and TimesTen are installed on the hosts, this step never needs to be repeated.</p>
</div>
<!-- class="sect2" -->
<a id="CCHEIGJJ"></a>
<div id="TTREP274" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Start the TimesTen cluster agent</h3>
<p>Start a TimesTen cluster agent and TimesTen cluster daemon monitor on all hosts in the cluster by executing the <code>ttCWAdmin -init</code> command. You can execute this command on any host in the cluster that is defined in the <code>ttcrsagent.options</code> file.</p>
<p>For example:</p>
<pre>ttCWAdmin -init
</pre>
<p>The <code>ttCWAdmin -init</code> command performs the following:</p>
<ul>
<li>
<p>Reads the <code>ttcrsagent.options</code> file and launches the TimesTen main daemon on each of the hosts defined in this file.</p>
</li>
<li>
<p>Starts and registers the TimesTen cluster agent (<code><a id="sthref426"></a><a id="sthref427"></a><a id="sthref428"></a>ttCRSAgent</code>) and the TimesTen cluster daemon monitor (<code><a id="sthref429"></a><a id="sthref430"></a><a id="sthref431"></a>ttCRSDaemon</code>) on the all hosts in the cluster. There is one TimesTen cluster agent and one TimesTen cluster daemon monitor for the TimesTen installation on each host. When the TimesTen cluster agent has started, Oracle Clusterware begins monitoring the TimesTen daemon on each host and restarts a TimesTen daemon if it fails.</p>
</li>
</ul>
<p>To start and register the TimesTen cluster agent (<code><a id="sthref432"></a><a id="sthref433"></a><a id="sthref434"></a>ttCRSAgent</code>) and the TimesTen cluster daemon monitor (<code><a id="sthref435"></a><a id="sthref436"></a><a id="sthref437"></a>ttCRSDaemon</code>) on specific hosts in the cluster, use the <code>-hosts</code> command to specify the desired hosts in the cluster to start.</p>
<pre>ttCWAdmin -init -hosts &#34;host1, host2&#34;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
You <a id="sthref438"></a><a id="sthref439"></a>must stop the TimesTen cluster agent on the local host with the <code>ttCWAdmin -shutdown</code> before you run a <code>ttDaemonAdmin -stop</code> command; otherwise the cluster agent restarts the TimesTen daemon.</div>
</div>
<!-- class="sect2" -->
<a id="CCHHDIJH"></a>
<div id="TTREP275" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Create and populate a TimesTen database on one host</h3>
<p>Create a database on the host where you intend the active database to reside. The DSN must be the same as the database file name.</p>
<p>Create schema objects (such as tables, AWT cache groups, and read-only cache groups) and populate with data as appropriate. However, before you create cache groups, you must first decide when to load the cache groups.</p>
<ul>
<li>
<p>For best performance, load the cache group tables from the Oracle database tables before the <code>ttCWAdmin -create</code> command. There is less performance overhead when cache groups are loaded with initial data before the duplicate is performed on the active master to create the standby master (and any subscribers).</p>
<p>For this option, perform the following:</p>
<ol>
<li>
<p>Start the cache agent as follows:</p>
<pre>Command&gt; call ttCacheStart;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Since this is before the <code>ttCWAdmin -start</code> command, you can start the cache agent at this time. The <code>ttCWAdmin -start</code> command notes that the cache agent is already started and continues.</div>
</li>
<li>
<p>Use the <code>LOAD CACHE GROUP</code> statement to load the cache group tables from the Oracle database tables.</p>
</li>
<li>
<p>If using autorefresh cache groups, set the autorefresh state to pause with the <code>ALTER CACHE GROUP SET AUTOREFRESH STATE PAUSED</code> statement. The autorefresh state will be set to <code>ON</code> as part of the <code>ttCWAdmin -start</code> command.</p>
</li>
</ol>
<p>The following example demonstrates how to create a read-only autorefresh cache group, load the data, and then set the autorefresh state to pause:</p>
<pre>Command&gt; call ttCacheStart;
Command&gt; CREATE READONLY CACHE GROUP my_cg
  AUTOREFRESH MODE INCREMENTAL INTERVAL 60 SECONDS
  FROM t1 (c1 NUMBER(22) NOT NULL PRIMARY KEY, c2 DATE, c3 VARCHAR(30));

Command&gt; LOAD CACHE GROUP my_cg COMMIT EVERY 100 ROWS PARALLEL 4;
Command&gt; ALTER CACHE GROUP my_cg SET AUTOREFRESH STATE PAUSED;
</pre></li>
<li>
<p>Alternatively, wait to load the cache group tables after the <code>ttCWAdmin -start</code> as described in <a href="#BGBFAAAB">&#34;Load cache groups&#34;</a>. The data will be replicated to the standby master and any subscribers.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BGBHDFHF"></a>
<div id="TTREP683" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Create system DSN files on other hosts</h3>
<p>On all hosts that are to be included in the cluster, create the system DSN (<code>sys.odbc.ini</code>) files. The <code>DataStore</code> attribute and the <code>Data Source Name</code> must be the same as the entry name for the <code>cluster.oracle.ini</code> file. See <a href="#CCHEEJEE">&#34;Configuring Oracle Clusterware management with the cluster.oracle.ini file&#34;</a> for information about the contents of the <code>sys.odbc.ini</code> files.</p>
</div>
<!-- class="sect2" -->
<a id="CCHHDGCC"></a>
<div id="TTREP276" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Create a cluster.oracle.ini file</h3>
<p>Create a <code>cluster.oracle.ini</code> file as a text file. See <a href="#CCHEEJEE">&#34;Configuring Oracle Clusterware management with the cluster.oracle.ini file&#34;</a> for details about its contents and acceptable locations for the file.</p>
</div>
<!-- class="sect2" -->
<a id="CCHGAGGB"></a>
<div id="TTREP277" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Create the Oracle Clusterware resources to manage virtual IP addresses</h3>
<p>Advanced availability involves configuring spare master or subscriber hosts that are idle until needed to replace master or subscriber hosts (used in the active standby pair replication scheme) that either shut down unexpectedly or experience an unrecoverable error. This is an optional step that is only necessary if you decide to configure advanced availability.</p>
<p>If you are planning on providing additional master or subscriber hosts for advanced availability, then you need to configure virtual IP addresses (one for each master host and subscriber actively used in the active standby pair). See <a href="#CCHCJGEA">&#34;Configuring advanced availability&#34;</a> for more details on how many virtual IP addresses should be created.</p>
<p>In this case, perform the following:</p>
<ol>
<li>
<p>Designate (or create) new virtual IP addresses on the network that are to be used solely for managing multiple hosts in a TimesTen replication environment managed by Oracle Clusterware.</p>
</li>
<li>
<p>Configure these VIP addresses for use to manage multiple hosts for advanced availability in the <code>cluster.oracle.ini</code> file, as described in <a href="#CCHCJGEA">&#34;Configuring advanced availability&#34;</a>.</p>
</li>
<li>
<p>Create the Oracle Clusterware resources that manage these VIP addresses by executing the <code>ttCWAdmin -createVIPs</code> command as the <code>root</code> user on any host in the cluster.</p>
<p>For example:</p>
<pre>ttCWAdmin -createVIPs -dsn myDSN
</pre>
<p>The VIP address names created by this command start with <code>network_</code> followed by the TimesTen instance name, TimesTen instance administrator, and the DSN. Whereas, the VIP addresses created for use by Oracle Clusterware are prefixed with <code>ora</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>ttCWAdmin -createVIPs</code> command must be executed before the <code>ttCWAdmin -create</code> command. If you decide that you want to use VIP addresses for advanced availability after you have executed the <code>ttCWAdmin -create</code> command, you must perform the following:
<ol>
<li>
<p>Execute <code>ttCWadmin -drop</code> to drop the active standby pair replication scheme.</p>
</li>
<li>
<p>Add VIP addresses into <code>cluster.oracle.ini</code> file.</p>
</li>
<li>
<p>Execute <code>ttCWadmin -createVIPs</code> to create the resources to manage the VIP addresses.</p>
</li>
<li>
<p>Execute <code>ttCWAdmin -create</code> to create the active standby pair replication scheme managed by Oracle Clusterware.</p>
</li>
</ol>
</div>
</li>
</ol>
<p>Once created, the only way to drop the Oracle Clusterware resources that manage the VIP addresses is to execute the <code>ttCWAdmin -dropVIPs</code> command. Before you can drop the virtual IP addresses, you must first execute the <code>ttCWAdmin -drop</code> command.</p>
<p>The following is an example of how to drop the virtual IP addresses:</p>
<pre>ttCWAdmin -dropVIPs -dsn myDSN 
</pre>
<p>For an example of when to use the <code>ttCWAdmin -dropVIPs</code> command, see <a href="#CCHCIDAE">&#34;Removing an active standby pair from a cluster&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="CCHCCAFE"></a>
<div id="TTREP278" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Create an active standby pair replication scheme</h3>
<p>Create an active standby pair replication scheme by executing the <code>ttCWAdmin -create</code> command on any host in the cluster.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>cluster.oracle.ini</code> file contains the configuration needed to perform the <code>ttCWAdmin -create</code> command and so must reachable by the <code>ttCWAdmin</code> executable. See <a href="#CCHEEJEE">&#34;Configuring Oracle Clusterware management with the cluster.oracle.ini file&#34;</a> for more details.</div>
<p>For example:</p>
<pre>ttCWAdmin -create -dsn myDSN
</pre>
<p>The <code>ttCWAdmin -create</code> command prompts for the following:</p>
<ul>
<li>
<p>Prompts for the name of a TimesTen user with <code>ADMIN</code> privileges. If cache groups are being managed by Oracle Clusterware, enter the TimesTen cache manager user name.</p>
</li>
<li>
<p>Prompts for the TimesTen password for the previously entered user name.</p>
</li>
<li>
<p>If cache groups are being used, prompts for the password for the Oracle user that has the same name as the cache manager user. This password is provided in the <code>OraclePWD</code> connection attribute when the cache manager user connects.</p>
</li>
<li>
<p>Prompts for a random string used to encrypt the above information.</p>
</li>
</ul>
<p>If you want to specify the path and name of a file to be used as the <code>cluster.oracle.ini</code> file, use the <code>-ttclusterini</code> command.</p>
<pre>ttCWAdmin -create -dsn myDSN -ttclusterini path/to/cluster/mycluster.ini
</pre>
<p>To drop the active standby pair, use the <code>ttCWAdmin -drop</code> command, as follows:</p>
<pre>ttCWAdmin -drop -dsn myDSN
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If your application connects to the TimesTen database using the virtual IP address, then this connection drops with the <code>ttCWAdmin -drop</code> command, since the virtual IP address is managed by Oracle Clusterware. However, if your application connects to the TimesTen database using the host name, the connection is not dropped.</div>
<p>For examples showing the sequence in which to use the <code>ttCWAdmin -create</code> and <code>ttCWAdmin -drop</code> commands, see <a href="#CCHCDDAD">&#34;Managing active standby pairs in a cluster&#34;</a> and <a href="#CCHGEFJJ">&#34;Managing read-only subscribers in the active standby pair&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="CCHDBBDG"></a>
<div id="TTREP279" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Start the active standby pair and the applications</h3>
<p>Start the cluster with the active standby pair replication scheme by executing the <code>ttCWAdmin -start</code> command on any host. This starts the cache agent (if not already started) and replication agent on the active database, performs the duplicate to create the standby master (and any subscribers), and starts the cache agent and replication agent on the standby master (and any subscribers).</p>
<p>If you do not specify <code>-noApp</code>, the applications are also started. If you do specify <code>-noApp</code>, then you can start and stop the applications with the <code>-startApps</code> and <code>-stopApps</code> commands respectively.</p>
<p>For example:</p>
<pre>ttCWAdmin -start -dsn myDSN
</pre>
<p>This command starts the following processes for the active standby pair:</p>
<ul>
<li>
<p><code><a id="sthref440"></a>ttCRSMaster</code></p>
</li>
<li>
<p><code><a id="sthref441"></a>ttCRSActiveService</code></p>
</li>
<li>
<p><code><a id="sthref442"></a>ttCRSsubservice</code></p>
</li>
<li>
<p>Monitor for application <code><a href="clusterattributes.htm#BGBHGJCI">AppName</a></code></p>
</li>
</ul>
<p>The following example starts the cache and replication agents, but does not start the applications because of the inclusion of the <code>-noapp</code> command:</p>
<pre>ttCWAdmin -start -noapp -dsn myDSN
</pre>
<p>To start and stop applications, use the <code>-startApps</code> and <code>-stopApps</code> commands as shown below:</p>
<pre>ttCWAdmin -startapps -dsn myDSN
...
ttCWAdmin -stopapps -dsn myDSN
</pre>
<p>To stop the cache agent and replication agent and disconnect the application from both databases, execute the <code>ttCWAdmin -stop</code> command.</p>
<pre>ttCWAdmin -stop -dsn myDSN
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If your application connects to the TimesTen database using a virtual IP address, then this connection drops with the <code>ttCWAdmin -stop</code> command, since the virtual IP address is managed by Oracle Clusterware. However, if your application connects to the TimesTen database using the host name, the connection is not dropped; however, replication to the standby master does not occur.</div>
<p>For examples showing the sequence in which to use the <code>ttCWAdmin -start</code> and <code>ttCWAdmin -stop</code> commands, see <a href="#CCHCDDAD">&#34;Managing active standby pairs in a cluster&#34;</a> and <a href="#CCHGEFJJ">&#34;Managing read-only subscribers in the active standby pair&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BGBFAAAB"></a>
<div id="TTREP684" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Load cache groups</h3>
<p>If the active standby pair includes cache groups and you have not already loaded the cache group (as described in <a href="#CCHHDIJH">&#34;Create and populate a TimesTen database on one host&#34;</a>), use the <code>LOAD CACHE GROUP</code> statement to load the cache group tables from the Oracle database tables.</p>
<p>For more information on when to load cache groups, see <a href="#CCHHDIJH">&#34;Create and populate a TimesTen database on one host&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="CCHFJGIC"></a>
<div id="TTREP280" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Include more than one active standby pair in a cluster</h3>
<p>If you want to use Oracle Clusterware to manage more than one active standby pair in a cluster, include additional configuration in the <code>cluster.oracle.ini</code> file. Oracle Clusterware can only manage more than one active standby pair in a cluster if all TimesTen databases are a part of the same TimesTen instance on a single host.</p>
<p>For example, the following <code>cluster.oracle.ini</code> file contains configuration information for two active standby pair replication schemes on the same host:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For details on configuration attributes in the <code>cluster.oracle.ini</code> file, see <a href="clusterattributes.htm#BGBJFHBD">Appendix A, &#34;TimesTen Configuration Attributes for Oracle Clusterware&#34;</a>.</div>
<pre>[advancedSubscriberDSN]
MasterHosts=host1,host2,host3
SubscriberHosts=host4, host5
MasterVIP=192.168.1.1, 192.168.1.2
SubscriberVIP=192.168.1.3
VIPInterface=eth0
VIPNetMask=255.255.255.0

[advSub2DSN]
MasterHosts=host1,host2,host3
SubscriberHosts=host4, host5
MasterVIP=192.168.1.4, 192.168.1.5
SubscriberVIP=192.168.1.6
VIPInterface=eth0
VIPNetMask=255.255.255.0
</pre>
<p>Perform these tasks for additional replication schemes:</p>
<ol>
<li>
<p>Create and populate the databases.</p>
</li>
<li>
<p>Create the virtual IP addresses. Use the <code>ttCWAdmin -createVIPs</code> command.</p>
</li>
<li>
<p>Create the active standby pair replication scheme. Use the <code>ttCWAdmin -create</code> command.</p>
</li>
<li>
<p>Start the active standby pair. Use the <code>ttCWAdmin -start</code> command.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BGBEEFAH"></a>
<div id="TTREP685" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configure an Oracle database as a disaster recovery subscriber<a id="sthref443"></a><a id="sthref444"></a></h3>
<p>You can create an active standby pair on the primary site with an Oracle database as a remote disaster recovery subscriber. See <a href="standbycache.htm#CBAJDJBD">&#34;Using a disaster recovery subscriber in an active standby pair&#34;</a>. Oracle Clusterware manages the active standby pair, but does not manage the disaster recovery subscriber. The user must perform a switchover if the primary site fails.</p>
<p>To use Oracle Clusterware to manage an active standby pair that has a remote disaster recovery subscriber, perform these tasks:</p>
<ol>
<li>
<p>Use the <code><a href="clusterattributes.htm#BGBDGJFB">RepDDL</a></code> or <code><a href="clusterattributes.htm#BGBJDAHC">RemoteSubscriberHosts</a></code> Clusterware attribute to provide information about the remote disaster recovery subscriber. For example:</p>
<pre>[advancedDRsubDSN]
MasterHosts=host1,host2,host3
SubscriberHosts=host4, host5
RemoteSubscriberHosts=host6
MasterVIP=192.168.1.1, 192.168.1.2
SubscriberVIP=192.168.1.3
VIPInterface=eth0
VIPNetMask=255.255.255.0
CacheConnect=y
</pre></li>
<li>
<p>Use <code>ttCWAdmin -create</code> to create the active standby pair replication scheme on the primary site. This does not create the disaster recovery subscriber.</p>
</li>
<li>
<p>Use <code>ttCWAdmin -start</code> to start the active standby pair replication scheme.</p>
</li>
<li>
<p>Load the cache groups that are replicated by the active standby pair.</p>
</li>
<li>
<p>Set up the disaster recovery subscriber using the procedure in <a href="standbycache.htm#CBADGDFJ">&#34;Rolling out a disaster recovery subscriber&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="BGBFDBGB"></a>
<div id="TTREP731" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Configure a read-only subscriber that is not managed by Oracle Clusterware<a id="sthref445"></a></h3>
<p>You can include a read-only TimesTen subscriber database that is not managed by Oracle Clusterware. Perform these tasks:</p>
<ol>
<li>
<p>Include the <code><a href="clusterattributes.htm#BGBJDAHC">RemoteSubscriberHosts</a></code> Clusterware attribute in the <code>cluster.oracle.ini</code> file. For example:</p>
<pre>[advancedROsubDSN]
MasterHosts=host1,host2,host3
RemoteSubscriberHosts=host6
MasterVIP=192.168.1.1, 192.168.1.2
SubscriberVIP=192.168.1.3
VIPInterface=eth0
VIPNetMask=255.255.255.0
</pre></li>
<li>
<p>Use <code>ttCWAdmin -create</code> to create the active standby pair replication scheme on the primary site.</p>
</li>
<li>
<p>Use <code>ttCWAdmin -start</code> to start the active standby pair replication scheme. This does not create the read-only subscriber.</p>
</li>
<li>
<p>Use the <code>ttRepStateGet</code> built-in procedure to verify that the state of the standby database is <code>STANDBY</code>.</p>
</li>
<li>
<p>On the subscriber host, use <code>ttRepAdmin -duplicate</code> option to duplicate the standby database to the read-only subscriber. See <a href="definepair.htm#CBAGAJGF">&#34;Duplicating a database&#34;</a>.</p>
</li>
<li>
<p>Start the replication agent on the subscriber host.</p>
</li>
</ol>
<p>To add or drop a read-only subscriber to or from an existing configuration, see <a href="#BGBEIJHI">&#34;Adding or dropping a read-only subscriber not managed by Oracle Clusterware&#34;</a>.</p>
<p>To rebuild a read-only subscriber, see <a href="#BGBIAEJG">&#34;Rebuilding a read-only subscriber not managed by Oracle Clusterware&#34;</a>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BGBICBAD"></a>
<div id="TTREP700" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using Oracle Clusterware with a TimesTen cache grid<a id="sthref446"></a><a id="sthref447"></a></h2>
<p>You can use the TimesTen implementation of Oracle Clusterware to manage a cache grid when each grid member is an active standby pair. TimesTen does not support using Oracle Clusterware to manage standalone grid members.</p>
<p>This section includes:</p>
<ul>
<li>
<p><a href="#BGBCIFJF">Creating and initializing a cluster of cache grid members</a></p>
</li>
<li>
<p><a href="#BGBIDHFH">Failure and recovery for active standby pair grid members</a></p>
</li>
<li>
<p><a href="#BGBCCFEE">Making schema changes to active standby pairs in a grid</a></p>
</li>
</ul>
<a id="BGBCIFJF"></a>
<div id="TTREP701" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Creating and initializing a cluster of cache grid members<a id="sthref448"></a><a id="sthref449"></a></h3>
<p>See <a href="#CCHJIBEJ">&#34;Install TimesTen on each host&#34;</a> for installation requirements. In addition, each grid member must have a DSN that is unique within the cache grid.</p>
<p>Perform the tasks described in <a href="#CCHDDHFB">&#34;Creating and initializing a cluster&#34;</a> for each grid member. Include the <a href="clusterattributes.htm#BABIDFGI">GridPort</a> Clusterware attribute in the <code>cluster.oracle.ini</code> file as described in <a href="#BGBEDHCA">&#34;Including the active standby pair in a cache grid&#34;</a>. Ensure that the specified port numbers are not in use.</p>
<p>The <code>ttCWAdmin -start</code> command automatically attaches a grid member to the cache grid. The <code>ttCWAdmin -stop</code> command automatically detaches a grid member from the cache grid.</p>
</div>
<!-- class="sect2" -->
<a id="BGBIDHFH"></a>
<div id="TTREP702" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Failure and recovery for active standby pair grid members<a id="sthref450"></a><a id="sthref451"></a></h3>
<p>If both nodes of an active standby pair grid member fail, then the grid member fails. Oracle Clusterware evicts the failed grid member from the grid automatically. However, when a cache grid is configured, any further automatic recovery after a dual failure, whether temporary or permanent, is not possible. In this case, you can only recover manually. For details, see <a href="#CCHFHHDC">&#34;Manual recovery of both nodes of an active standby pair grid member&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BGBCCFEE"></a>
<div id="TTREP703" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Making schema changes to active standby pairs in a grid<a id="sthref452"></a><a id="sthref453"></a></h3>
<p>You can add, drop, or change a cache group while the active master database is attached to the grid.</p>
<p>Use the <a id="sthref454"></a><a id="sthref455"></a><code>ttCWAdmin -beginAlterSchema</code> command to make these schema changes. This command stops the replication agents on both the active and standby master nodes, but allows the active master database to remain attached to the grid. The <a id="sthref456"></a><a id="sthref457"></a><code>ttCWAdmin -endAlterSchema</code> command initiates a duplicate to propagate certain changes to the standby master database (and any subscribers), registers the altered replication scheme, restarts both replication agents, and reinstates Oracle Clusteware control.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>ttCWadmin -endAlterSchema</code> command initiates a duplicate for this case since cache groups are included in the replication schema, but the DDL statements for cache groups are not replicated. For full details, see <a href="#CCHIHEFI">&#34;Changing the schema&#34;</a>.</div>
<p>To add or drop a replicated table into the active standby pair, see <a href="alterpair.htm#BABCAHEB">&#34;Making DDL changes in an active standby pair&#34;</a>.</p>
<a id="BGBDJBIH"></a>
<div id="TTREP707" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Add a cache group<a id="sthref458"></a><a id="sthref459"></a></h4>
<p>Perform these steps on the active database of <span class="italic">each</span> active standby pair grid member.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
These steps are the same whether the active standby pair is or is not included in a cache grid.</div>
<ol>
<li>
<p>Enable the addition of the cache group to the active standby pair by temporarily suspending Oracle Clusterware management and stopping the replication agents with the <code>ttCWAdmin -beginAlterSchema</code> command.</p>
<pre>ttCWAdmin -beginAlterSchema -dsn advancedDSN
</pre></li>
<li>
<p>Create the cache group.</p>
</li>
<li>
<p>If the cache group is a read-only cache group, alter the active standby pair to include the cache group.</p>
<pre>ALTER ACTIVE STANDBY PAIR INCLUDE CACHE GROUP samplecachegroup;
</pre></li>
<li>
<p>Complete your changes by executing the <code>ttCWAdmin -endAlterSchema</code> command. Since you added a cache group object, a duplicate occurs to propagate these schema changes to the standby master database.</p>
<pre>ttCWAdmin -endAlterSchema -dsn advancedDSN
</pre></li>
</ol>
<p>You can load the cache group at any time after you create the cache group.</p>
</div>
<!-- class="sect3" -->
<a id="BGBJEDDG"></a>
<div id="TTREP708" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Drop a cache group<a id="sthref460"></a><a id="sthref461"></a></h4>
<p>Perform these steps to drop a cache group.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
These steps are the same whether the active standby pair is or is not included in a cache grid.</div>
<ol>
<li>
<p>Unload the cache group. When using a cache grid, you must unload the cache group in all members of the cache grid.</p>
<pre>CALL ttOptSetFlag(&#39;GlobalProcessing&#39;, 1);
UNLOAD CACHE GROUP samplecachegroup;
</pre></li>
<li>
<p>On the active database of an active standby pair, enable dropping the cache group.</p>
<pre>ttCWAdmin -beginAlterSchema -dsn advancedDSN
</pre></li>
<li>
<p>If the cache group is a read-only cache group, alter the active standby pair to exclude the cache group.</p>
<pre>ALTER ACTIVE STANDBY PAIR EXCLUDE CACHE GROUP samplecachegroup;
</pre></li>
<li>
<p>If the cache group is a read-only cache group, set the autorefresh state to <code>PAUSED</code>.</p>
<pre>ALTER CACHE GROUP samplecachegroup SET AUTOREFRESH STATE PAUSED;
</pre></li>
<li>
<p>Drop the cache group.</p>
<pre>DROP CACHE GROUP samplecachegroup;
</pre></li>
<li>
<p>If the cache group was a read-only cache group, run the <code><span class="codeinlineitalic">TimesTen_install_dir</span></code><code>/oraclescripts/cacheCleanUp.sql</code> SQL*Plus script as the cache administration user on the Oracle database to drop the Oracle database objects used to implement autorefresh operations.</p>
</li>
<li>
<p>Complete your changes by executing the <code>ttCWAdmin -endAlterSchema</code> command. Since you dropped a cache group object, a duplicate occurs to propagate these schema changes to the standby master database.</p>
<pre>ttCWAdmin -endAlterSchema -dsn advancedDSN
</pre></li>
<li>
<p>Repeat steps 2 through 7 on the active database of each active standby pair grid member.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<div id="TTREP709" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref462"></a>
<h4 class="sect3">Change an existing cache group</h4>
<p>To change an existing cache group, first drop the existing cache group as described in <a href="#BGBJEDDG">&#34;Drop a cache group&#34;</a>. Then add the cache group with the desired changes as described in <a href="#BGBDJBIH">&#34;Add a cache group&#34;</a>.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CCHGCBAG"></a>
<div id="TTREP281" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Recovering from failures</h2>
<p>Oracle Clusterware can recover automatically from many kinds of failures. The following sections describe several failure scenarios and how Oracle Clusterware manages the failures.</p>
<ul>
<li>
<p><a href="#BGBEHHFD">How TimesTen performs recovery when Oracle Clusterware is configured</a></p>
</li>
<li>
<p><a href="#CCHCJHAB">When an active database or its host fails</a></p>
</li>
<li>
<p><a href="#CCHBCGJI">When a standby database or its host fails</a></p>
</li>
<li>
<p><a href="#CCHIBACF">When read-only subscribers or their hosts fail</a></p>
</li>
<li>
<p><a href="#CCHIBFBC">When failures occur on both master nodes</a></p>
</li>
<li>
<p><a href="#CCHEGFHC">When more than two master hosts fail</a></p>
</li>
<li>
<p><a href="#BGBBBJAB">Perform a forced switchover after failure of the active database or host</a></p>
</li>
</ul>
<a id="BGBEHHFD"></a>
<div id="TTREP727" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">How TimesTen performs recovery when Oracle Clusterware is configured<a id="sthref463"></a></h3>
<p>The TimesTen database monitor (<code>ttCRSmaster</code> process) performs recovery. It attempts to connect to the failed database without using the <code>forceconnect</code> option. If the connection fails with error 994 (<code>Data store connection terminated</code>), the database monitor tries to connect 10 times. If the connection fails with error 707 (<code>Attempt to connect to a data store that has been manually unloaded from RAM</code>), the database monitor changes the RAM policy and tries to connect again. If the database monitor cannot connect, it returns connection failure.</p>
<p>If the database monitor can connect to the database, then it performs these tasks:</p>
<ul>
<li>
<p>It queries the <code>CHECKSUM</code> column in the <code>TTREP.REPLICATIONS</code> replication table.</p>
</li>
<li>
<p>If the value in the <code>CHECKSUM</code> column matches the checksum stored in the Oracle Cluster Registry, then the database monitor verifies the role of the database. If the role is <code>&#39;ACTIVE</code>&#39;, then recovery is complete.</p>
<p>If the role is not <code>&#39;ACTIVE&#39;</code>, then the database monitor queries the replication Commit Ticket Number (CTN) in the local database and the CTN in the active database to find out whether there are transactions that have not been replicated. If all transactions have been replicated, then recovery is complete.</p>
</li>
<li>
<p>If the checksum does not match or if some transactions have not been replicated, then the database monitor performs a duplicate operation from the remote database to re-create the local database.</p>
</li>
</ul>
<p>If the database monitor fails to connect with the database because of error 8110 or 8111 (master catchup required or in progress), then it uses the <code>forceconnect=1</code> option to connect and starts master catchup. Recovery is complete when master catchup has been completed. If master catchup fails with error 8112 (<code>Operation not permitted</code>), then the database monitor performs a duplicate operation from the remote database. For more information about master catchup, see <a href="failure.htm#CFHHHGGG">&#34;Automatic catch-up of a failed master database&#34;</a>.</p>
<p>If the connection fails because of other errors, then the database monitor tries to perform a duplicate operation from the remote database.</p>
<p>The duplicate operation verifies that:</p>
<ul>
<li>
<p>The remote database is available.</p>
</li>
<li>
<p>The replication agent is running.</p>
</li>
<li>
<p>The remote database has the correct role. The role must be <code>&#39;ACTIVE&#39;</code> when the duplicate operation is attempted for creation of a standby database. The role must be <code>&#39;STANDBY&#39;</code> or <code>&#39;ACTIVE&#39;</code> when the duplicate operation is attempted for creation of a read-only subscriber.</p>
</li>
</ul>
<p>When the conditions for the duplicate operation are satisfied, the existing failed database is destroyed and the duplicate operation starts.</p>
</div>
<!-- class="sect2" -->
<a id="CCHCJHAB"></a>
<div id="TTREP282" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">When an active database or its host fails</h3>
<p>If there is a failure on the node where the active database resides, Oracle Clusterware automatically changes the state of the standby database to <code>&#39;ACTIVE&#39;</code>. If application failover is configured, then the application begins updating the new active database.</p>
<p><a href="#CCHBEFCI">Figure 8-2</a> shows that the state of the standby database has changed to <code>&#39;ACTIVE&#39;</code> and that the application is updating the new active database.</p>
<div id="TTREP283" class="figure">
<p class="titleinfigure"><a id="CCHBEFCI"></a>Figure 8-2 Standby database becomes active</p>
<img width="477" height="381" src="img/cluster_activefail.gif" alt="Description of Figure 8-2 follows"/><br/>
<a id="sthref464" href="img_text/cluster_activefail.htm">Description of &#34;Figure 8-2 Standby database becomes active&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Oracle Clusterware tries to restart the database or host where the failure occurred. If it is successful, then that database becomes the standby database.</p>
<p><a href="#CCHHBHEJ">Figure 8-3</a> shows a cluster where the former active node becomes the standby node.</p>
<div id="TTREP284" class="figure">
<p class="titleinfigure"><a id="CCHHBHEJ"></a>Figure 8-3 Standby database starts on former active host</p>
<img width="468" height="354" src="img/cluster_activeswitch.gif" alt="Description of Figure 8-3 follows"/><br/>
<a id="sthref465" href="img_text/cluster_activeswitch.htm">Description of &#34;Figure 8-3 Standby database starts on former active host&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>If the failure of the former active node is permanent and advanced availability is configured, Oracle Clusterware starts a standby database on one of the extra nodes.</p>
<p><a href="#CCHGJCGG">Figure 8-4</a> shows a cluster in which the standby database is started on one of the extra nodes.</p>
<div id="TTREP285" class="figure">
<p class="titleinfigure"><a id="CCHGJCGG"></a>Figure 8-4 Standby database starts on extra host</p>
<img width="490" height="366" src="img/cluster_activefail2.gif" alt="Description of Figure 8-4 follows"/><br/>
<a id="sthref466" href="img_text/cluster_activefail2.htm">Description of &#34;Figure 8-4 Standby database starts on extra host&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>If you do not want to wait for these automatic actions to occur, see <a href="#BGBBBJAB">&#34;Perform a forced switchover after failure of the active database or host&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="CCHBCGJI"></a>
<div id="TTREP286" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">When a standby database or its host fails</h3>
<p>If there is a failure on the standby node, Oracle Clusterware first tries to restart the database or host. If it cannot restart the standby database on the same host and advanced availability is configured, Oracle Clusterware starts the standby database on an extra node.</p>
<p><a href="#CCHDCAJB">Figure 8-5</a> shows a cluster in which the standby database is started on one of the extra nodes.</p>
<div id="TTREP287" class="figure">
<p class="titleinfigure"><a id="CCHDCAJB"></a>Figure 8-5 Standby database on new host</p>
<img width="478" height="411" src="img/cluster_standbyfail.gif" alt="Description of Figure 8-5 follows"/><br/>
<a id="sthref467" href="img_text/cluster_standbyfail.htm">Description of &#34;Figure 8-5 Standby database on new host&#34;</a><br/>
<br/></div>
<!-- class="figure" --></div>
<!-- class="sect2" -->
<a id="CCHIBACF"></a>
<div id="TTREP288" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">When read-only subscribers or their hosts fail</h3>
<p>If there is a failure on a subscriber node, Oracle Clusterware first tries to restart the database or host. If it cannot restart the database on the same host and advanced availability is configured, Oracle Clusterware starts the subscriber database on an extra node.</p>
</div>
<!-- class="sect2" -->
<a id="CCHIBFBC"></a>
<div id="TTREP289" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">When failures occur on both master nodes</h3>
<p>This section includes these topics:</p>
<ul>
<li>
<p><a href="#CCHEBBCF">Automatic recovery when not attached to a grid</a></p>
</li>
<li>
<p><a href="#CCHFHHDC">Manual recovery of both nodes of an active standby pair grid member</a></p>
</li>
<li>
<p><a href="#CCHIGBHJ">Manual recovery for advanced availability</a></p>
</li>
<li>
<p><a href="#CCHDEJEE">Manual recovery for basic availability</a></p>
</li>
<li>
<p><a href="#CCHIDCAC">Manual recovery to the same master nodes when databases are corrupt</a></p>
</li>
<li>
<p><a href="#BGBHFFHF">Manual recovery when RETURN TWOSAFE is configured</a></p>
</li>
</ul>
<a id="CCHEBBCF"></a>
<div id="TTREP290" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Automatic recovery when not attached to a grid<a id="sthref468"></a></h4>
<p>Oracle Clusterware can achieve automatic recovery from <span class="italic">temporary</span> failure on both master nodes after the nodes come back up if:</p>
<ul>
<li>
<p><code>RETURN TWOSAFE</code> is not specified for the active standby pair.</p>
</li>
<li>
<p><code>AutoRecover</code> is set to <code>y</code>.</p>
</li>
<li>
<p><code>RepBackupDir</code> specifies a directory on shared storage.</p>
</li>
<li>
<p><code>RepBackupPeriod</code> is set to a value greater than <code>0</code>.</p>
</li>
</ul>
<p>Oracle Clusterware can achieve automatic recovery from <span class="italic">permanent</span> failure on both master nodes if:</p>
<ul>
<li>
<p>Advanced availability is configured (virtual IP addresses and at least four hosts).</p>
</li>
<li>
<p>The active standby pair does not replicate cache groups.</p>
</li>
<li>
<p>A cache grid is not configured.</p>
</li>
<li>
<p><code>RETURN TWOSAFE</code> is not specified for the active standby pair.</p>
</li>
<li>
<p><code>AutoRecover</code> is set to <code>y</code>.</p>
</li>
<li>
<p><code>RepBackupDir</code> specifies a directory on shared storage.</p>
</li>
<li>
<p><code>RepBackupPeriod</code> is set to a value greater than <code>0</code>.</p>
</li>
</ul>
<p>See <a href="#CCHEDEHA">&#34;Recovering from permanent failure of both master nodes&#34;</a> for examples of <code>cluster.oracle.ini</code> files.</p>
</div>
<!-- class="sect3" -->
<a id="CCHFHHDC"></a>
<div id="TTREP752" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Manual recovery of both nodes of an active standby pair grid member<a id="sthref469"></a><a id="sthref470"></a></h4>
<p>If both nodes of an active standby pair grid member fail, then the grid member fails. Oracle Clusterware evicts the failed grid member from the grid automatically. After the failed grid member is removed from the grid, you can continue to recover manually. However, when a cache grid is configured, any further automatic recovery after a dual failure, whether temporary or permanent, is not possible.</p>
<p>If the active standby pair grid member is in an asynchronous replication scheme, the grid member is recovered automatically and reattached to the grid. If the active standby pair grid member is in a replication scheme with <code>RETURN TWOSAFE</code> configured, perform these steps to recover the grid member and reattach it to the grid:</p>
<ol>
<li>
<p>Stop the replication agent and the cache agent and disconnect the application from both databases. This step detaches the grid member from the grid.</p>
<pre>ttCWAdmin -stop advancedGridDSN
</pre></li>
<li>
<p>Drop the active standby pair.</p>
<pre>ttCWAdmin -drop advancedGridDSN
</pre></li>
<li>
<p>Create the active standby pair replication scheme.</p>
<pre>ttCWAdmin -create advancedGridDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme. This step attaches the grid member to the grid.</p>
<pre>ttCWAdmin -start advancedGridDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CCHIGBHJ"></a>
<div id="TTREP291" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Manual recovery for advanced availability<a id="sthref471"></a></h4>
<p>This section assumes that the failed master nodes are recovered to new hosts on which TimesTen and Oracle Clusterware are installed. These steps use the <code>manrecoveryDSN</code> database and <code>cluster.oracle.ini</code> file for examples.</p>
<p>To perform manual recovery in an advanced availability configuration, perform these tasks:</p>
<ol>
<li>
<p>Ensure that the TimesTen cluster agent is running on the local host.</p>
<pre>ttCWAdmin -init -hosts localhost
</pre></li>
<li>
<p>Restore the backup database. Ensure that there is not already a database on the host with the same DSN as the database you want to restore.</p>
<pre>ttCWAdmin -restore -dsn manrecoveryDSN
</pre></li>
<li>
<p>If there are cache groups in the database, drop and re-create the cache groups.</p>
</li>
<li>
<p>If the new hosts are not already specified by <code>MasterHosts</code> and <code>SubscriberHosts</code> in the <code>cluster.oracle.ini</code> file, then modify the file to include the new hosts.</p>
<p>These steps use <code>manrecoveryDSN</code>. This step is not necessary for <code>manrecoveryDSN</code> because extra hosts are already specified in the <code>cluster.oracle.ini</code> file.</p>
</li>
<li>
<p>Re-create the active standby pair replication scheme.</p>
<pre>ttCWAdmin -create -dsn manrecoveryDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn manrecoveryDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CCHDEJEE"></a>
<div id="TTREP292" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Manual recovery for basic availability<a id="sthref472"></a></h4>
<p>This section assumes that the failed master nodes are recovered to new hosts on which TimesTen and Oracle Clusterware are installed. These steps use the <code>basicDSN</code> database and <code>cluster.oracle.ini</code> file for examples.</p>
<p>To perform manual recovery in a basic availability configuration, perform these steps:</p>
<ol>
<li>
<p>Acquire new hosts for the databases in the active standby pair.</p>
</li>
<li>
<p>Ensure that the TimesTen cluster agent is running on the local host.</p>
<pre>ttCWAdmin -init -hosts localhost
</pre></li>
<li>
<p>Restore the backup database. Ensure that there is not already a database on the host with the same DSN as the database you want to restore.</p>
<pre>ttCWAdmin -restore -dsn basicDSN
</pre></li>
<li>
<p>If there are cache groups in the database, drop and re-create the cache groups.</p>
</li>
<li>
<p>Update the <code>MasterHosts</code> and <code>SubscriberHosts</code> entries in the <code>cluster.oracle.ini</code> file. This example uses the <code>basicDSN</code> database. The <code>MasterHosts</code> entry changes from <code>host1</code> to <code>host10</code>. The <code>SubscriberHosts</code> entry changes from <code>host2</code> to <code>host20</code>.</p>
<pre>[basicDSN]
MasterHosts=host10,host20
</pre></li>
<li>
<p>Re-create the active standby pair replication scheme.</p>
<pre>ttCWAdmin -create -dsn basicDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn basicDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CCHIDCAC"></a>
<div id="TTREP662" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Manual recovery to the same master nodes when databases are corrupt</h4>
<p>Failures can occur on both master nodes so that the databases are corrupt. If you want to recover to the same master nodes, perform the following steps:</p>
<ol>
<li>
<p>Ensure that the replication agent and the cache agent are stopped and that applications are disconnected from both databases. This example uses the <code>basicDSN</code> database.</p>
<pre>ttCWAdmin -stop -dsn basicDSN
</pre></li>
<li>
<p>On the node where you want the new active database to reside, destroy the databases by using the <code>ttDestroy</code> utility.</p>
<pre>ttDestroy basicDSN
</pre></li>
<li>
<p>Restore the backup database.</p>
<pre>ttCWAdmin -restore -dsn basicDSN
</pre></li>
<li>
<p>If there are cache groups in the database, drop and re-create the cache groups.</p>
</li>
<li>
<p>Re-create the active standby pair replication scheme.</p>
<pre>ttCWAdmin -create -dsn basicDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn basicDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BGBHFFHF"></a>
<div id="TTREP686" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Manual recovery when RETURN TWOSAFE is configured<a id="sthref473"></a><a id="sthref474"></a><a id="sthref475"></a></h4>
<p>You can configure an active standby pair to have a return service of <code>RETURN TWOSAFE</code> by using the <code><a href="clusterattributes.htm#BGBGGFDB">ReturnServiceAttribute</a></code> Clusterware attribute in the <code>cluster.oracle.ini</code> file. When <code>RETURN TWOSAFE</code> is configured, the database logs may be available on one or both nodes after both nodes fail.</p>
<p>This <code>cluster.oracle.ini</code> example includes backup configuration in case the database logs are not available:</p>
<pre>[basicTwosafeDSN]
MasterHosts=host1,host2
ReturnServiceAttribute=RETURN TWOSAFE
RepBackupDir=/<span class="italic">shared_drive</span>/dsbackup
RepBackupPeriod=3600
</pre>
<p>Perform these recovery tasks:</p>
<ol>
<li>
<p>Ensure that the replication agent and the cache agent are stopped and that applications are disconnected from both databases.</p>
<pre>ttCWAdmin -stop -dsn basicTwosafeDSN
</pre></li>
<li>
<p>Drop the active standby pair.</p>
<pre>ttCWAdmin -drop -dsn basicTwosafeDSN
</pre></li>
<li>
<p>Decide whether the former active or standby database is more up to date and re-create the active standby pair using the chosen database. The command prompts you to choose the host on which the active database resides.</p>
<pre>ttCWAdmin -create -dsn basicTwosafeDSN
</pre>
<p>If neither database is usable, restore the database from backups.</p>
<pre>ttCWAdmin -restore -dsn basicTwosafeDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn basicTwosafeDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CCHEGFHC"></a>
<div id="TTREP293" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">When more than two master hosts fail<a id="sthref476"></a></h3>
<p>Approach a failure of more than two master hosts as a more extreme case of dual host failure. Use these guidelines:</p>
<ul>
<li>
<p>Address the root cause of the failure if it is something like a power outage or network failure.</p>
</li>
<li>
<p>Identify or obtain at least two healthy hosts for the active and standby databases.</p>
</li>
<li>
<p>Update the <code>MasterHosts</code> and <code>SubscriberHosts</code> entries in the <code>cluster.oracle.ini</code> file.</p>
</li>
<li>
<p>See <a href="#CCHIGBHJ">&#34;Manual recovery for advanced availability&#34;</a> and <a href="#CCHDEJEE">&#34;Manual recovery for basic availability&#34;</a> for guidelines on subsequent actions to take.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BGBBBJAB"></a>
<div id="TTREP734" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Perform a forced switchover after failure of the active database or host<a id="sthref477"></a><a id="sthref478"></a><a id="sthref479"></a></h3>
<p>If you want to force a switchover to the standby database without waiting for automatic recovery to be performed by TimesTen and Oracle Clusterware, you can write an application that uses Oracle Clusterware commands.</p>
<p>Perform the following:</p>
<ol>
<li>
<p>Use the <code>crsctl stop resource</code> command to stop the <code>ttCRSmaster</code> resource on the active database. This causes the role of the standby database to change to active.</p>
</li>
<li>
<p>Use the <code>crsctl start resource</code> command to restart the <code>ttCRSmaster</code> resource on the former active database. This causes the database to recover and become the standby database.</p>
</li>
</ol>
<p>The following example demonstrates a forced switchover from the active database on <code>host1</code> to the standby database on <code>host2</code>.</p>
<ol>
<li>
<p>Find all TimesTen resources using the <code>crsctl status resource</code> command.</p>
<pre>% crsctl status resource | grep TT
  NAME=TT_Activeservice_tt1122_ttadmin_REP1
  NAME=TT_Agent_tt1122_ttadmin_HOST1
  NAME=TT_Agent_tt1122_ttadmin_HOST2
  NAME=TT_App_tt1122_ttadmin_REP1_updateemp
  NAME=TT_Daemon_tt1122_ttadmin_HOST1
  NAME=TT_Daemon_tt1122_ttadmin_HOST2
  NAME=TT_Master_tt1122_ttadmin_REP1_0
  NAME=TT_Master_tt1122_ttadmin_REP1_1
  NAME=TT_Subservice_tt1122_ttadmin_REP1
</pre></li>
<li>
<p>Find the host where the active database resides by retrieving the status of the <code>ttCRSActiveService</code> resource.</p>
<pre>% crsctl status resource TT_Activeservice_tt1122_ttadmin_REP1
  NAME=TT_Activeservice_tt1122_ttadmin_REP1
  TYPE=application
  TARGET=ONLINE
  STATE=ONLINE on host1
</pre></li>
<li>
<p>There are two <code>ttCRSmaster</code> resources listed in the initial status report. Discover which <code>ttCRSmaster</code> resource is on the same host as the active database.</p>
<pre>% crsctl status resource TT_Master_tt1122_ttadmin_REP1_0
  NAME=TT_Master_tt1122_ttadmin_REP1_0
  TYPE=application
  TARGET=ONLINE
  STATE=ONLINE on host1

% crsctl status resource TT_Master_tt1122_ttadmin_REP1_1
  NAME=TT_Master_tt1122_ttadmin_REP1_1
  TYPE=application
  TARGET=ONLINE
  STATE=ONLINE on host2
</pre></li>
<li>
<p>Stop the <code>ttCRSmaster</code> resource on the host where the active database resides.</p>
<pre>% crsctl stop resource TT_Master_tt1122_ttadmin_REP1_0
  CRS-2673: Attempting to stop &#39;TT_Master_tt1122_ttadmin_REP1_0&#39;
  on &#39;host1&#39;
  CRS-2677: Stop of &#39;TT_Master_tt1122_ttadmin_REP1_0&#39; on
 &#39;host1&#39; succeeded
</pre></li>
<li>
<p>Restart the <code>ttCRSmaster</code> resource on the former active database.</p>
<pre>% crsctl start resource TT_Master_tt1122_ttadmin_REP1_0
  CRS-2672: Attempting to start &#39;TT_Master_tt1122_ttadmin_REP1_0&#39;
  on &#39;host1&#39;
  CRS-2676: Start of &#39;TT_Master_tt1122_ttadmin_REP1_0&#39; on
 &#39;host1&#39; succeeded
</pre></li>
<li>
<p>Confirm that the forced switchover succeeds by checking where the <code>ttCRSActiveService</code> and <code>ttCRSsubservice</code> resources are located.</p>
<pre>% crsctl status resource TT_Activeservice_tt1122_ttadmin_REP1
  NAME=TT_Activeservice_tt1122_ttadmin_REP1
  TYPE=application
  TARGET=ONLINE
  STATE=ONLINE on host2
 
% crsctl status resource TT_Subservice_tt1122_ttadmin_REP1
  NAME=TT_Subservice_tt1122_ttadmin_REP1
  TYPE=application
  TARGET=ONLINE
  STATE=ONLINE on host1
</pre></li>
</ol>
<p>See <a class="olink CWADD" href="../CWADD/toc.htm"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for more information about the <code>crsctl start resource</code> and <code>crsctl stop resource</code> commands.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CCHJIGGC"></a>
<div id="TTREP294" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Clusterware management</h2>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#CCHHFCIG">Performing a rolling upgrade of Oracle Clusterware software</a></p>
</li>
<li>
<p><a href="#CCHHFAII">Upgrading TimesTen</a></p>
</li>
<li>
<p><a href="#CCHJCIIB">Managing hosts in the cluster</a></p>
</li>
<li>
<p><a href="#CCHCDDAD">Managing active standby pairs in a cluster</a></p>
</li>
<li>
<p><a href="#CCHGEFJJ">Managing read-only subscribers in the active standby pair</a></p>
</li>
<li>
<p><a href="#CCHIHEFI">Changing the schema</a></p>
</li>
<li>
<p><a href="#CCHFFADB">Reversing the roles of the master databases</a></p>
</li>
<li>
<p><a href="#CCHFBEHE">Moving a database to a different host</a></p>
</li>
<li>
<p><a href="#CCHCDFED">Performing host or network maintenance</a></p>
</li>
<li>
<p><a href="#CCHBFCDJ">Performing maintenance on the entire cluster</a></p>
</li>
<li>
<p><a href="#CCHDJDEJ">Changing user names or passwords when using Oracle Clusterware</a></p>
</li>
</ul>
<a id="CCHHFCIG"></a>
<div id="TTREP296" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Performing a rolling upgrade of Oracle Clusterware <a id="sthref480"></a>software</h3>
<p>See <a class="olink CWADD" href="../CWADD/toc.htm"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a>.</p>
</div>
<!-- class="sect2" -->
<a id="CCHHFAII"></a>
<div id="TTREP297" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Upgrading TimesTen<a id="sthref481"></a></h3>
<p>See <a class="olink TTINS297" href="../TTINS/upgrade.htm#TTINS297">&#34;Performing an online TimesTen upgrade when using Oracle Clusterware&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Installation Guide</span>.</p>
</div>
<!-- class="sect2" -->
<a id="CCHJCIIB"></a>
<div id="TTREP755" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Managing hosts in the cluster</h3>
<p>The following sections describe how to add or remove hosts when using a cluster:</p>
<ul>
<li>
<p><a href="#CCHGJGGA">Adding a host to the cluster</a></p>
</li>
<li>
<p><a href="#CCHCDBJH">Removing a host from the cluster</a></p>
</li>
</ul>
<a id="CCHGJGGA"></a>
<div id="TTREP302" class="sect3">
<h4 class="sect3">Adding a host to the cluster<a id="sthref482"></a></h4>
<p>Adding a host requires that the cluster be configured for advanced availability. The examples in this section use the <code>advancedSubscriberDSN</code>.</p>
<p>To add two spare master hosts to a cluster, enter a command similar to the following:</p>
<pre>ttCWAdmin -addMasterHosts -hosts &#34;host8,host9&#34; -dsn advancedSubscriberDSN
</pre>
<p>To add a spare subscriber host to a cluster, enter a command similar to the following:</p>
<pre>ttCWAdmin -addSubscriberHosts -hosts &#34;subhost1&#34; -dsn advancedSubscriberDSN
</pre></div>
<!-- class="sect3" -->
<a id="CCHCDBJH"></a>
<div id="TTREP303" class="sect3">
<h4 class="sect3">Removing a host from the cluster<a id="sthref483"></a></h4>
<p>Removing a host from the cluster requires that the cluster be configured for advanced availability. <code>MasterHosts</code> must list more than two hosts if one of the master hosts is to be removed. <code>SubscriberHosts</code> must list at least one more host than the number of subscriber databases if one of the subscriber hosts is to be removed.</p>
<p>The examples in this section use the <code>advancedSubscriberDSN</code>.</p>
<p>To remove two spare master host from the cluster, enter a command similar to the following:</p>
<pre>ttCWAdmin -delMasterHosts &#34;host8,host9&#34; -dsn advancedSubscriberDSN
</pre>
<p>To remove a spare subscriber hosts from the cluster, enter a command similar to the following:</p>
<pre>ttCWAdmin -delSubscriberHosts &#34;subhost1&#34; -dsn advancedSubscriberDSN
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CCHCDDAD"></a>
<div id="TTREP756" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Managing active standby pairs in a cluster</h3>
<p>The following sections describe how to add or remove an active standby pair to a cluster:</p>
<ul>
<li>
<p><a href="#CCHJHABH">Adding an active standby pair to a cluster</a></p>
</li>
<li>
<p><a href="#CCHCIDAE">Removing an active standby pair from a cluster</a></p>
</li>
</ul>
<a id="CCHJHABH"></a>
<div id="TTREP300" class="sect3">
<h4 class="sect3">Adding an active standby pair to a <a id="sthref484"></a>cluster</h4>
<p>To add an active standby pair (with or without subscribers) to a cluster that is already managing an active standby pair, perform these tasks:</p>
<ol>
<li>
<p>Create and populate a database on the host where you intend the active database to reside initially. See <a href="#CCHHDIJH">&#34;Create and populate a TimesTen database on one host&#34;</a>.</p>
</li>
<li>
<p>Modify the <code>cluster.oracle.ini</code> file. This example adds <code>advSub2DSN</code> to the <code>cluster.oracle.ini</code> file that already contains the configuration for <code>advancedSubscriberDSN</code>. The new active standby pair is on different hosts from the original active standby pair.</p>
<pre>[advancedSubscriberDSN]
MasterHosts=host1,host2,host3
SubscriberHosts=host4, host5
MasterVIP=192.168.1.1, 192.168.1.2
SubscriberVIP=192.168.1.3
VIPInterface=eth0
VIPNetMask=255.255.255.0

[advSub2DSN]
MasterHosts=host6,host7,host8
SubscriberHosts=host9, host10
MasterVIP=192.168.1.4, 192.168.1.5
SubscriberVIP=192.168.1.6
VIPInterface=eth0
VIPNetMask=255.255.255.0
</pre></li>
<li>
<p>Create new virtual IP addresses as the <code>root</code> user.</p>
<pre>ttCWAdmin -createVIPs -dsn advSub2DSN
</pre></li>
<li>
<p>Create the new active standby pair replication scheme.</p>
<pre>ttCWAdmin -create -dsn advSub2DSN
</pre></li>
<li>
<p>Start the new active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn advSub2DSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CCHCIDAE"></a>
<div id="TTREP301" class="sect3">
<h4 class="sect3">Removing an active standby pair from a cluster<a id="sthref485"></a></h4>
<p>To remove an active standby pair (with or without subscribers) from a cluster, perform these tasks:</p>
<ol>
<li>
<p>Stop the replication agents on all databases in the active standby pair. This example uses <code>advSub2DSN</code>, which was added in <a href="#CCHJHABH">&#34;Adding an active standby pair to a cluster&#34;</a>.</p>
<pre>ttCWAdmin -stop -dsn advSub2DSN
</pre></li>
<li>
<p>Drop the active standby replication scheme.</p>
<pre>ttCWAdmin -drop -dsn advSub2DSN
</pre></li>
<li>
<p>Drop the virtual IP addresses for the active standby pair.</p>
<pre>ttCWAdmin -dropVIPs -dsn advSub2DSN
</pre></li>
<li>
<p>Modify the <code>cluster.oracle.ini</code> file (optional). Remove the entries for <code>advSub2DSN</code>.</p>
</li>
<li>
<p>If you want to destroy the databases, log onto each host that was included in the configuration for this active standby pair and use the <code>ttDestroy</code> utility.</p>
<pre>ttDestroy advSub2DSN
</pre>
<p>For more information about <code>ttDestroy</code>, see <a class="olink TTREF341" href="../TTREF/util.htm#TTREF341">&#34;ttDestroy&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CCHGEFJJ"></a>
<div id="TTREP757" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Managing read-only subscribers in the active standby pair</h3>
<p>The following sections describe how to manage read-only subscribers in the active standby pair that is managed by Oracle Clusterware:</p>
<ul>
<li>
<p><a href="#CCHEGFIE">Adding a read-only subscriber managed by Oracle Clusterware</a></p>
</li>
<li>
<p><a href="#CCHFCEEH">Removing a read-only subscriber managed by Oracle Clusterware</a></p>
</li>
<li>
<p><a href="#BGBEIJHI">Adding or dropping a read-only subscriber not managed by Oracle Clusterware</a></p>
</li>
<li>
<p><a href="#BGBIAEJG">Rebuilding a read-only subscriber not managed by Oracle Clusterware</a></p>
</li>
</ul>
<a id="CCHEGFIE"></a>
<div id="TTREP298" class="sect3">
<h4 class="sect3">Adding a read-only subscriber managed by Oracle Clusterware<a id="sthref486"></a></h4>
<p>To add a read-only subscriber that is to be managed by Oracle Clusterware to an active standby pair replication scheme, perform these steps:</p>
<ol>
<li>
<p>Stop the replication agents on all databases. This example uses the <code>advancedSubscriberDSN</code>, which already has a subscriber and is configured for advanced availability.</p>
<pre>ttCWAdmin -stop -dsn advancedSubscriberDSN
</pre></li>
<li>
<p>Drop the active standby pair.</p>
<pre>ttCWAdmin -drop -dsn advancedSubscriberDSN
</pre></li>
<li>
<p>Modify the <code>cluster.oracle.ini</code> file.</p>
<ul>
<li>
<p>Add the subscriber to the <code>SubscriberHosts</code> attribute.</p>
</li>
<li>
<p>If the cluster is configured for advanced availability, add a virtual IP address to the <code>SubscriberVIP</code> attribute.</p>
</li>
</ul>
<p>See <a href="#CCHCJGEA">&#34;Configuring advanced availability&#34;</a> for an example using these attributes.</p>
</li>
<li>
<p>Create the active standby pair replication scheme.</p>
<pre>ttCWAdmin -create -dsn advancedSubscriberDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn advancedSubscriberDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CCHFCEEH"></a>
<div id="TTREP299" class="sect3">
<h4 class="sect3">Removing a read-only <a id="sthref487"></a>subscriber managed by Oracle Clusterware</h4>
<p>To remove a read-only subscriber that is managed by Oracle Clusterware from an active standby pair, perform these steps:</p>
<ol>
<li>
<p>Stop the replication agents on all databases. This example uses the <code>advancedSubscriberDSN</code>, which has a subscriber and is configured for advanced availability.</p>
<pre>ttCWAdmin -stop -dsn advancedSubscriberDSN
</pre></li>
<li>
<p>Drop the active standby pair.</p>
<pre>ttCWAdmin -drop -dsn advancedSubscriberDSN
</pre></li>
<li>
<p>Modify the <code>cluster.oracle.ini</code> file.</p>
<ul>
<li>
<p>Remove the subscriber from the <code>SubscriberHosts</code> attribute or remove the attribute altogether if there are no subscribers left in the active standby pair.</p>
</li>
<li>
<p>Remove a virtual IP from the <code>SubscriberVIP</code> attribute or remove the attribute altogether if there are no subscribers left in the active standby pair.</p>
</li>
</ul>
</li>
<li>
<p>Create the active standby pair replication scheme.</p>
<pre>ttCWAdmin -create -dsn advancedSubscriberDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn advancedSubscriberDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BGBEIJHI"></a>
<div id="TTREP735" class="sect3">
<h4 class="sect3">Adding or dropping a read-only subscriber not managed by Oracle Clusterware<a id="sthref488"></a></h4>
<p>You can add or drop a read-only subscriber that is not managed by Oracle Clusterware to or from an existing active standby pair replication scheme that is managed by Oracle Clusterware. Using the <code>ttCWAdmin -beginAlterSchema</code> command enables you to add a subscriber without dropping and re-creating the replication scheme. Oracle Clusterware does not manage the subscriber, because it is not part of the configuration that was set up for Oracle Clusterware management.</p>
<p>Perform these steps:</p>
<ol>
<li>
<p>Execute the <code>ttCWAdmin -beginAlterSchema</code> command to stop the replication agent on the active and standby databases.</p>
</li>
<li>
<p>Using <code>ttIsql</code> to connect to the active database, you can add or drop the subscriber to or from the replication scheme by using an <code>ALTER ACTIVE STANDBY PAIR</code> statement. For example, to add a subscriber:</p>
<pre>ALTER ACTIVE STANDBY PAIR ADD SUBSCRIBER ROsubDSN ON host6;
</pre>
<p>To drop a subscriber:</p>
<pre>ALTER ACTIVE STANDBY PAIR DROP SUBSCRIBER ROsubDSN ON host6;
</pre></li>
<li>
<p>Execute the <code>ttCWAdmin -endAlterSchema</code> command that registers the altered replication scheme and starts replication. If you are adding a subscriber, this also initiates a duplicate to the standby master database.</p>
</li>
<li>
<p>Execute the <code>ttIsql repschemes</code> command to verify that the read-only subscriber has been added to or dropped from the replication scheme.</p>
</li>
<li>
<p>Use the <code>ttRepStateGet</code> built-in procedure to verify that the state of the standby database is <code>STANDBY</code>.</p>
</li>
<li>
<p>If you added a subscriber, then execute <code>ttRepAdmin -duplicate</code> on the subscriber host to duplicate the standby database to the read-only subscriber. See <a href="definepair.htm#CBAGAJGF">&#34;Duplicating a database&#34;</a>.</p>
</li>
<li>
<p>If you added a subscriber, start the replication agent on the subscriber host.</p>
</li>
</ol>
<p>If you added a subscriber, ensure that the read-only subscriber is included if the cluster is dropped and re-created by adding the <a href="clusterattributes.htm#BGBJDAHC">RemoteSubscriberHosts</a> Clusterware attribute for the read-only subscriber in the <code>cluster.oracle.ini</code> file as described in Step 1 in <a href="#BGBFDBGB">&#34;Configure a read-only subscriber that is not managed by Oracle Clusterware&#34;</a>. Alternatively, if you dropped a subscriber, remove the <code>RemoteSubscriberHosts</code> Clusterware attribute for the dropped subscriber in the <code>cluster.oracle.ini</code> file (if it is configured).</p>
</div>
<!-- class="sect3" -->
<a id="BGBIAEJG"></a>
<div id="TTREP733" class="sect3">
<h4 class="sect3">Rebuilding a read-only subscriber not managed by Oracle Clusterware<a id="sthref489"></a></h4>
<p>Perform the following tasks to destroy and rebuild a read-only subscriber that is not managed by Oracle Clusterware:</p>
<ol>
<li>
<p>Stop the replication agent on the subscriber host.</p>
</li>
<li>
<p>Use the <code>ttDestroy</code> utility to destroy the subscriber database.</p>
</li>
<li>
<p>On the subscriber host, use <code>ttRepAdmin -duplicate</code> to duplicate the standby database to the read-only subscriber. See <a href="definepair.htm#CBAGAJGF">&#34;Duplicating a database&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CCHIHEFI"></a>
<div id="TTREP295" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Changing the <a id="sthref490"></a><a id="sthref491"></a>schema</h3>
<p>When using Oracle Clusterware to manage an active standby pair, you can modify the schema by executing DDL statements as in a normal replication environment, except that Oracle Clusterware must start and stop all replication agents, when it is necessary to do so.</p>
<p>Thus, when you change the schema, note the following:</p>
<ul>
<li>
<p>For those DDL statements on objects that are automatically replicated, you do not need to stop the replication agents. In this case, no further action is required, since these DDL statements are automatically propagated and applied to the standby master and any subscribers. The <code>DDLReplicationLevel</code> connection attribute controls what DDL statements are replicated.</p>
</li>
<li>
<p>For those objects that are a part of the replication scheme, but any DDL statements executed on these objects are not replicated (these objects are listed in <a href="alterpair.htm#BABJAICG">&#34;Making other changes to an active standby pair&#34;</a>), run the Oracle Clusterware <code>ttCWAdmin -beginAlterSchema</code> command on the active master, which stops the replication agents on each node in the replication scheme. Then, execute the DDL statement on the active master in the replication scheme. Finally, run the Oracle Clusterware <code>ttCWAdmin -endAlterSchema</code> command on the active master to restart all replication agents.</p>
<p>Because these objects are a part of the replication scheme, but the DDL statements are not replicated, a duplicate occurs after the <code>ttCWAdmin -endAlterSchema</code> command to propagate these schema changes to the standby master and any subscribers. This is the only scenario when a duplicate is used to propagate the schema changes.</p>
<p>Follow the instructions described in <a href="#CCHFAEJF">&#34;Facilitating schema change for Oracle Clusterware&#34;</a>.</p>
</li>
<li>
<p>For those DDL statements on objects that are not automatically replicated and are not part of the replication scheme, run the Oracle Clusterware <code>ttCWAdmin -beginAlterSchema</code> command on the active master, which stops the replication agents on all nodes. Then, you can synchronize all nodes by manually executing these DDL statements as indicated in <a href="alterpair.htm#BABCAHEB">&#34;Making DDL changes in an active standby pair.&#34;</a> Finally, run the Oracle Clusterware <code>ttCWAdmin -endAlterSchema</code> command on the active master to restart all replication agents.</p>
<p>Follow the instructions described in <a href="#CCHFAEJF">&#34;Facilitating schema change for Oracle Clusterware&#34;</a>.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <a href="alterpair.htm#BABCAHEB">&#34;Making DDL changes in an active standby pair&#34;</a> and <a href="alterpair.htm#BABJAICG">&#34;Making other changes to an active standby pair&#34;</a> sections describe which DDL statements are and are not automatically replicated for an active standby pair. These sections also describe what objects are a part of the replication scheme.</div>
<a id="CCHFAEJF"></a>
<div id="TTREP759" class="sect3">
<h4 class="sect3">Facilitating schema change for Oracle Clusterware</h4>
<p>Use the <a id="sthref492"></a><a id="sthref493"></a><code>ttCWAdmin -beginAlterSchema</code> and <code>-endAlterSchema</code> commands to facilitate the schema changes on the active and standby master databases that requires the replication agents are stopped.</p>
<ul>
<li>
<p>The <a id="sthref494"></a><a id="sthref495"></a><code>ttCWAdmin -beginAlterSchema</code> command prepares for schema changes by stopping replication agents on both the active and standby master nodes in preparation for any schema changes.</p>
</li>
<li>
<p>After you complete all schema changes, run the <a id="sthref496"></a><a id="sthref497"></a><code>ttCWAdmin -endAlterSchema</code> command. For those objects that are a part of the replication scheme, but any DDL statements executed on these objects are not automatically replicated, a duplicate occurs after the <code>ttCWAdmin -endAlterSchema</code> command to propagate only these schema changes to the standby and any subscribers. This command registers the altered replication scheme, restarts the replication agents on the active and standby master nodes, and reinstates Oracle Clusteware control.</p>
</li>
</ul>
<p>Perform the following tasks when altering the schema of the active standby pair when using Oracle Clusterware:</p>
<ol>
<li>
<p>Enable the changes to the schema of the active standby pair by stopping the replication agents on both the active and standby masters.</p>
<pre>ttCWAdmin -beginAlterSchema -dsn advancedDSN
</pre></li>
<li>
<p>Make any desired schema changes.</p>
<p>If you create, alter, or drop any objects where the DDL for these objects are not replicated, you should also manually create, alter, or drop the same objects on the standby master and subscribers while the replication agents are inactive to ensure that the same objects exist on all databases in the replication scheme. For example, if you create a materialized view on the active database, create the materialized view on the databases on the standby master and subscriber nodes at this time.</p>
</li>
<li>
<p>If the object is not automatically replicated but is a part of the replication scheme, (such as a sequence) and you want to include it in the active standby pair replication scheme, alter the active standby pair.</p>
<pre>ALTER ACTIVE STANDBY PAIR INCLUDE samplesequence;
</pre></li>
<li>
<p>If the object is a cache group, see the instructions for creating, altering, or dropping a cache group in <a href="#BGBCCFEE">&#34;Making schema changes to active standby pairs in a grid&#34;</a>.</p>
</li>
<li>
<p>Run the <code>ttCWAdmin -endAlterSchema</code> command to restart the replication agents on the active and standby master nodes. If you modified objects that are a part of the replication scheme, but any DDL statements executed on these objects are not automatically replicated, a duplicate occurs after the <code>ttCWAdmin -endAlterSchema</code> command to propagate only these schema changes to the standby and any subscribers.</p>
<pre>ttCWAdmin -endAlterSchema -dsn advancedDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CCHHCAEJ"></a>
<div id="TTREP760" class="sect3">
<h4 class="sect3">Managing subscribers and database attributes</h4>
<p>To add or drop a subscriber database or alter database attributes, perform the following tasks:</p>
<ol>
<li>
<p>Stop the replication agents on the databases in the active standby pair. These commands use the <code>advancedCacheDSN</code> as an example.</p>
<pre>ttCWAdmin -stop -dsn advancedCacheDSN
</pre></li>
<li>
<p>Drop the active standby pair.</p>
<pre>ttCWAdmin -drop  -dsn advancedCacheDSN
</pre></li>
<li>
<p>Modify the schema as desired.</p>
</li>
<li>
<p>Re-create the active standby pair replication scheme.</p>
<pre>ttCWAdmin -create -dsn advancedCacheDSN
</pre></li>
<li>
<p>Start the active standby pair replication scheme.</p>
<pre>ttCWAdmin -start -dsn advancedCacheDSN
</pre></li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CCHFFADB"></a>
<div id="TTREP658" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Reversing the roles of the master databases<a id="sthref498"></a><a id="sthref499"></a></h3>
<p>After a failover, the active and standby databases are on different hosts than they were before the failover. You can use the <code>-switch</code> option of the <code>ttCWAdmin</code> utility to restore the original configuration. Optionally, you can also use the <code>-timeout</code> option with the <code>-switch</code> option to set a timeout for the number of seconds to wait for the active and standby database switch to complete.</p>
<p>For example:</p>
<pre>ttCWAdmin -switch -dsn basicDSN
</pre>
<p>Ensure that there are no open transactions before using the <code>-switch</code> option. If there are open transactions, the command fails.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For more details on the <code>-switch</code> and <code>-timeout</code> options, see <a class="olink TTREF336" href="../TTREF/util.htm#TTREF336">&#34;ttCWAdmin&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</div>
<p><a href="#BGBEHGCE">Figure 8-6</a> shows the hosts for an active standby pair. The active database resides on host A, and the standby database resides on host B.</p>
<div id="TTREP728" class="figure">
<p class="titleinfigure"><a id="BGBEHGCE"></a>Figure 8-6 Hosts for an active standby pair</p>
<img width="660" height="245" src="img/switch.gif" alt="Description of Figure 8-6 follows"/><br/>
<a id="sthref500" href="img_text/switch.htm">Description of &#34;Figure 8-6 Hosts for an active standby pair&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>The <code>ttCWAdmin -switch</code> command performs these tasks:</p>
<ul>
<li>
<p>Deactivates the TimesTen cluster agent (<code>ttCRSAgent</code>) on host A (the active node).</p>
</li>
<li>
<p>Disables the database monitor (<code>ttCRSmaster</code>) on host A.</p>
</li>
<li>
<p>Calls the <code>ttRepSubscriberWait</code>, <code>ttRepStop</code> and <code>ttRepDeactivate</code> built-in procedures on host A.</p>
</li>
<li>
<p>Stops the active service (<code>ttCRSActiveService</code>) on host A and reports a failure event to the Oracle Clusterware <code>CRSD</code> process.</p>
</li>
<li>
<p>Enables monitoring on host A and moves the active service to host B.</p>
</li>
<li>
<p>Starts the replication agent on host A, stops the standby service (<code>ttCRSsubservice</code>) on host B and reports a failure event to the Oracle Clusterware <code>CRSD</code> process on host B.</p>
</li>
<li>
<p>Starts the standby service (<code>ttCRSsubservice</code>) on host A.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CCHFBEHE"></a>
<div id="TTREP654" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Moving a database to a different host<a id="sthref501"></a><a id="sthref502"></a></h3>
<p>When a cluster is configured for advanced availability, you can use the <code>-relocate</code> option of the <code>ttCWAdmin</code> utility to move a database from the local host to the next available spare host specified in the <code>MasterHosts</code> attribute in the <code>cluster.oracle.ini</code> file. If the database on the local host has the active role, the <code>-relocate</code> option first reverses the roles. Thus, the newly migrated active database becomes the standby and the standby becomes the active.</p>
<p>The <code>-relocate</code> option is useful for relocating a database if you decide to take the host offline. Ensure that there are no open transactions before you use the command.</p>
<p>If the <code>-relocate</code> option requires a role switch, then you can optionally use the <code>-timeout</code> option with the <code>-relocate</code> option to set a timeout for the number of seconds to wait for the role switch.</p>
<p>For example:</p>
<pre>ttCWAdmin -relocate -dsn advancedDSN
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
For more details on the <code>-relocate</code> and <code>-timeout</code> options, see <a class="olink TTREF336" href="../TTREF/util.htm#TTREF336">&#34;ttCWAdmin&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database Reference</span>.</div>
</div>
<!-- class="sect2" -->
<a id="CCHCDFED"></a>
<div id="TTREP304" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Performing host or network maintenance<a id="sthref503"></a><a id="sthref504"></a></h3>
<p>If you decide to upgrade the operating system or hardware for a host or perform network maintenance, shut down Oracle Clusterware and disable automatic startup. Execute these Oracle Clusterware commands as <code>root</code> or OS administrator:</p>
<pre># crsctl stop crs

# crsctl disable crs
</pre>
<p>Shut down TimesTen. See <a class="olink TTOPR214" href="../TTOPR/daemon.htm#TTOPR214">&#34;Shutting down a TimesTen application&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Operations Guide</span>.</p>
<p>Perform the host maintenance. Then enable automatic startup and start Oracle Clusterware:</p>
<pre># crsctl enable crs

# crsctl start crs
</pre>
<p>See <a class="olink CWADD" href="../CWADD/toc.htm"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for more information about these commands.</p>
</div>
<!-- class="sect2" -->
<a id="CCHBFCDJ"></a>
<div id="TTREP305" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Performing maintenance on the entire cluster<a id="sthref505"></a></h3>
<p>When all of the hosts in the cluster need to be brought down, stop Oracle Clusterware on each host individually. Execute these Oracle Clusterware commands as <code>root</code> or OS administrator:</p>
<pre># crsctl stop crs

# crsctl disable crs
</pre>
<p>Shut down TimesTen. See <a class="olink TTOPR214" href="../TTOPR/daemon.htm#TTOPR214">&#34;Shutting down a TimesTen application&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Operations Guide</span>.</p>
<p>Perform the maintenance. Then enable automatic startup and start Oracle Clusterware:</p>
<pre># crsctl enable crs

# crsctl start crs
</pre>
<p>See <a class="olink CWADD" href="../CWADD/toc.htm"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for more information about these commands.</p>
</div>
<!-- class="sect2" -->
<a id="CCHDJDEJ"></a>
<div id="TTREP659" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Changing user names or passwords when using Oracle Clusterware<a id="sthref506"></a><a id="sthref507"></a></h3>
<p>When you create the active standby pair replication scheme with the <code>ttCWAdmin -create</code> command, Oracle Clusterware prompts for the required user names and passwords in order to manage the TimesTen environment. Oracle Clusterware stores these user names and passwords. After modifying any user name or password, you must execute the <code>ttCWAdmin -reauthenticate</code> command to enable Oracle Clusterware to store these new user names and passwords.</p>
<ol>
<li>
<p>Ensure that the <code>DDLReplicationLevel</code> connection attribute is set to 3. This value replicates changes to the user names or passwords on the active master to the standby master.</p>
</li>
<li>
<p>Modify any of the user names or passwords in the same manner (and with the same restrictions) as described in <a href="standbycache.htm#BABHHHHH">&#34;Changing user names or passwords used by replication&#34;</a>.</p>
</li>
<li>
<p>Ensure that all password changes are replicated to the standby master by calling the <code>ttRepSubscriberWait</code> built-in procedure (or the <code>ttRepAdmin -wait</code> command) on the active master database using the DSN and host of the standby master database. For example, to ensure that all transactions are replicated to the <code>master2</code> standby master on the <code>host2</code> host:</p>
<pre>Command&gt; CALL ttRepSubscriberWait(NULL, NULL, &#39;master2&#39;, &#39;host2&#39;, -1);
</pre></li>
<li>
<p>Store the new passwords in Oracle Clusterware by executing the <code>ttCWAdmin -reauthenticate</code> command.</p>
<pre>ttCWAdmin -reauthenticate -dsn myDSN
</pre>
<p>This command prompts for the same information as requested for the <code>ttCWAdmin -create</code> command, which is discussed in <a href="#CCHCCAFE">&#34;Create an active standby pair replication scheme&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<div id="TTREP829" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref508"></a>
<h3 class="sect2">Managing the TimesTen database <a id="sthref509"></a><a id="sthref510"></a>RAM policy</h3>
<p>By default, the TimesTen database RAM policy is set to <code>Always</code> when Oracle Clusterware manages the TimesTen database. However, if you stop Oracle Clusterware management, the TimesTen database RAM policy is set to <code>In Use</code>.</p>
<p>If you no longer use Oracle Clusterware to manage TimesTen, you should set the TimesTen RAM policy to what is appropriate for your envioronment. Typically, the recommended setting is <code>Manual</code>.</p>
<p>For more information on the TimesTen database RAM policy, see <a class="olink TTOPR728" href="../TTOPR/using.htm#TTOPR728">&#34;Specifying a RAM policy&#34;</a> in the <span class="italic">Oracle TimesTen In-Memory Database Operations Guide</span>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="BGBGBFBF"></a>
<div id="TTREP688" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Monitoring cluster status<a id="sthref511"></a><a id="sthref512"></a><a id="sthref513"></a><a id="sthref514"></a><a id="sthref515"></a></h2>
<p>The following sections describe how to retrieve the status of the cluster:</p>
<ul>
<li>
<p><a href="#BGBBCIIF">Obtaining cluster status</a></p>
</li>
<li>
<p><a href="#BGBJFJEB">Message log files</a></p>
</li>
</ul>
<a id="BGBBCIIF"></a>
<div id="TTREP704" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Obtaining cluster status</h3>
<p>The <code>-status</code> option of the <code>ttCWAdmin</code> utility reports information about all of the active standby pairs in an instance that are managed by the same instance administrator. If you specify the DSN, the utility reports information for the active standby pair with that DSN.</p>
<div id="TTREP689" class="example">
<p class="titleinexample"><a id="sthref516"></a>Example 8-1 Status after creating an active standby pair</p>
<p>After you have created an active standby pair replication scheme but have not yet started replication, <code>ttCWAdmin -status</code> returns information such as this. Note that the grid states are displayed before replication is started, regardless of whether there is a cache grid.</p>
<pre>$ ttCWAdmin -status
TimesTen Cluster status report as of Thu Nov 11 13:54:35 2010
 
====================================================================
TimesTen daemon monitors:
Host:HOST1 Status: online
Host:HOST2 Status: online
 
====================================================================
====================================================================
TimesTen Cluster agents
Host:HOST1 Status: online
Host:HOST2 Status: online
 
====================================================================
 
Status of Cluster related to DSN MYDSN:
====================================================================
1. Status of Cluster monitoring components:
Monitor Process for Active datastore:NOT RUNNING
Monitor Process for Standby datastore:NOT RUNNING
Monitor Process for Master Datastore 1 on Host host1: NOT RUNNING
Monitor Process for Master Datastore 2 on Host host2: NOT RUNNING
 
2.Status of  Datastores comprising the cluster
Master Datastore 1:
Host:host1
Status:AVAILABLE
State:ACTIVE
Grid:NO GRID
Master Datastore 2:
Host:host2
Status:UNAVAILABLE
State:UNKNOWN
Grid:UNKNOWN
====================================================================
The cluster containing the replicated DSN is offline
</pre></div>
<!-- class="example" -->
<div id="TTREP690" class="example">
<p class="titleinexample"><a id="sthref517"></a>Example 8-2 Status when the active database is running</p>
<p>After you have started the replication scheme and the active database is running but the standby database is not yet running, <code>ttCWAdmin -status</code> returns information like this when a cache grid is not configured.</p>
<pre>$ ttcwadmin -status
TimesTen Cluster status report as of Thu Nov 11 13:58:25 2010
 
====================================================================
TimesTen daemon monitors:
Host:HOST1 Status: online
Host:HOST2 Status: online
 
====================================================================
====================================================================
TimesTen Cluster agents
Host:HOST1 Status: online
Host:HOST2 Status: online
 
====================================================================
 
Status of Cluster related to DSN MYDSN:
====================================================================
1. Status of Cluster monitoring components:
Monitor Process for Active datastore:RUNNING on Host host1
Monitor Process for Standby datastore:RUNNING on Host host1
Monitor Process for Master Datastore 1 on Host host1: RUNNING
Monitor Process for Master Datastore 2 on Host host2: RUNNING
 
2.Status of  Datastores comprising the cluster
Master Datastore 1:
Host:host1
Status:AVAILABLE
State:ACTIVE
Grid:NO GRID
Master Datastore 2:
Host:host2
Status:AVAILABLE
State:IDLE
Grid:NO GRID
====================================================================
The cluster containing the replicated DSN is online
</pre>
<p>If a cache grid is configured, then the last section appears as follows:</p>
<pre>2.Status of  Datastores comprising the cluster
Master Datastore 1:
Host:host1
Status:AVAILABLE
State:ACTIVE
Grid:AVAILABLE
Master Datastore 2:
Host:host2
Status:AVAILABLE
State:IDLE
Grid:NO GRID
</pre></div>
<!-- class="example" -->
<div id="TTREP691" class="example">
<p class="titleinexample"><a id="sthref518"></a>Example 8-3 Status when the active and the standby databases are running</p>
<p>After you have started the replication scheme and the active database and the standby database are both running, <code>ttCWAdmin -status</code> returns information like this when a cache grid is not configured.</p>
<pre>$ ttcwadmin -status
TimesTen Cluster status report as of Thu Nov 11 13:59:20 2010
 
====================================================================
TimesTen daemon monitors:
Host:HOST1 Status: online
Host:HOST2 Status: online
 
====================================================================
====================================================================
TimesTen Cluster agents
Host:HOST1 Status: online
Host:HOST2 Status: online
 
====================================================================
 
Status of Cluster related to DSN MYDSN:
====================================================================
1. Status of Cluster monitoring components:
Monitor Process for Active datastore:RUNNING on Host host1
Monitor Process for Standby datastore:RUNNING on Host host2
Monitor Process for Master Datastore 1 on Host host1: RUNNING
Monitor Process for Master Datastore 2 on Host host2: RUNNING
 
2.Status of  Datastores comprising the cluster
Master Datastore 1:
Host:host1
Status:AVAILABLE
State:ACTIVE
Grid:NO GRID
Master Datastore 2:
Host:host2
Status:AVAILABLE
State:STANDBY
Grid:NO GRID
====================================================================
The cluster containing the replicated DSN is online
</pre>
<p>If a cache grid is configured, then the last section appears as follows:</p>
<pre>2.Status of  Datastores comprising the cluster
Master Datastore 1:
Host:host1
Status:AVAILABLE
State:ACTIVE
Grid:AVAILABLE
Master Datastore 2:
Host:host2
Status:AVAILABLE
State:STANDBY
Grid:AVAILABLE
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="BGBJFJEB"></a>
<div id="TTREP705" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Message log files<a id="sthref519"></a><a id="sthref520"></a><a id="sthref521"></a></h3>
<p>The monitor processes report events and errors to the <code>ttcwerrors.log</code> and <code>ttcwmsg.log</code> files. The files are located in the <code><span class="codeinlineitalic">daemon_home</span></code><code>/info</code> directory. The default size of these files is the same as the default maximum size of the user log. The maximum number of log files is the same as the default number of files for the user log. When the maximum number of files has been written, additional errors and messages overwrite the files, beginning with the oldest file.</p>
<p>For the default values for number of log files and log file size, see <a class="olink TTOPR218" href="../TTOPR/daemon.htm#TTOPR218">&#34;Modifying informational messages&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Operations Guide</span>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5803">
<tr>
<td class="cellalignment5812">
<table class="cellalignment5808">
<tr>
<td class="cellalignment5807"><a href="alterpair.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5807"><a href="design.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2012, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5814">
<table class="cellalignment5806">
<tr>
<td class="cellalignment5807"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5807"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5807"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5807"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5807"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5807"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>