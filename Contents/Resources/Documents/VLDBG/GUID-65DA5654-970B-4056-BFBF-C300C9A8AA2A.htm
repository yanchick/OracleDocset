<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-114333"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Partition%20Pruning%20with%20Zone%20Maps"></a><title>Partition Pruning with Zone Maps</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2016-07-20T13:00:08Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database VLDB and Partitioning Guide"/>
<meta name="dcterms.identifier" content="E41057-12"/>
<meta name="dcterms.isVersionOf" content="VLDBG"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-F57D9DC0-31D6-4A0F-A787-5A82723D88F5.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-6C660105-8ECE-4426-A795-5884E84B0A48.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41057-12.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-65DA5654-970B-4056-BFBF-C300C9A8AA2A"></a> <span id="PAGE" style="display:none;">63/481</span> <!-- End Header --><a id="VLDBG14224"></a><a id="VLDBG14225"></a><a id="VLDBG14101"></a>
<h1 id="VLDBG-GUID-65DA5654-970B-4056-BFBF-C300C9A8AA2A" class="sect1">Partition Pruning with Zone Maps</h1>
<div>
<p>Partition pruning is enhanced to take advantage of zone maps for pruning of complete partitions. Providing enhanced pruning capabilities provides better performance with less resource consumption and shorter time-to-information.</p>
<p>A zone map is a independent access structure that can be built for a table. During table scans, zone maps enable you to prune disk blocks of a table and partitions of a partitioned table based on predicates on the table columns. Zone maps have no correlation to the partition key columns of a partitioned table, so statements on partitioned tables with zone maps can prune partitions based on non-partition key columns.</p>
<div class="infoboxnotealso" id="GUID-65DA5654-970B-4056-BFBF-C300C9A8AA2A__GUID-A3F299E6-864B-4596-9592-9C09F3D54B92">
<p class="notep1">See Also:</p>
<p><a class="olink DWHSG8916" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=DWHSG8916"><span class="italic">Oracle Database Data Warehousing Guide</span></a> for information about zone maps and attribute clustering</p>
</div>
<p>Partition pruning with zone maps is especially effective when the zone map column values correlate with partition key column values. For example, the correlation can be between columns of the partitioned table itself, such as a shipping date that has a correlation to the partition key column order date in the same partitioned table, or within the join zone map columns and the partitioned table, such as a join zone map column month description from a dimension table times that correlates with the partition key column day of the partitioned table.</p>
<p><a href="GUID-65DA5654-970B-4056-BFBF-C300C9A8AA2A.htm#GUID-65DA5654-970B-4056-BFBF-C300C9A8AA2A__BABHBCEG">Example 3-2</a> illustrates partition pruning with zone maps for correlated columns of a partitioned table. Column <code>s_shipdate</code> in the partitioned table <code>sales_range</code> correlates with the partition key column <code>order_date</code> because orders are normally shipped within a couple of days after an order was received.</p>
<p>Due to the correlation of <code>s_shipdate</code> and the partition key column any selective predicate on this column has a high likelihood to enable partition pruning for the partitioned table <code>sales_range</code>, without having the column as part of the partitioning key.</p>
<p>The following <code>SELECT</code> statement looks for all orders that were shipped in the first quarter of 1999:</p>
<pre dir="ltr">SELECT * FROM sales_range 
      WHERE s_shipdate BETWEEN to_date(&#39;01/01/1999&#39;,&#39;dd/mm/yyyy&#39;) 
      AND to_date(&#39;03/01/1999&#39;,&#39;mm/dd/yyyy&#39;);
</pre>
<p>In the following execution plan for the previous <code>SELECT</code> statement, zone maps are used for partition pruning and also to prune blocks from the partitions that have to be accessed.</p>
<p>Partition pruning with zone maps is identified by having <code>KEY(ZM)</code> in the <code>PSTART</code> and <code>PSTOP</code> columns of the execution plan. The block level pruning of all accessed partitions is identified by the filter predicate at table access time (<code>id 2</code>).</p>
<div class="example" id="GUID-65DA5654-970B-4056-BFBF-C300C9A8AA2A__BABHBCEG">
<p class="titleinexample">Example 3-2 Partitioned table sales_range with attribute clustering and a zone map on a correlated column</p>
<pre dir="ltr">CREATE TABLE sales_range( 
  s_productid      NUMBER,
  s_saledate       DATE,
  s_shipdate       DATE,
  s_custid         NUMBER,
  s_totalprice     NUMBER)
CLUSTERING BY (s_shipdate)
WITH MATERIALIZED ZONEMAP
PARTITION BY RANGE (s_saledate)
 (PARTITION sal99q1 VALUES LESS THAN
   (TO_DATE(&#39;01-APR-1999&#39;, &#39;DD-MON-YYYY&#39;)),
  PARTITION sal99q2 VALUES LESS THAN
   (TO_DATE(&#39;01-JUL-1999&#39;, &#39;DD-MON-YYYY&#39;)),
  PARTITION sal99q3 VALUES LESS THAN
   (TO_DATE(&#39;01-OCT-1999&#39;, &#39;DD-MON-YYYY&#39;)),
  PARTITION sal99q4 VALUES LESS THAN
   (TO_DATE(&#39;01-JAN-2000&#39;, &#39;DD-MON-YYYY&#39;)));
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-65DA5654-970B-4056-BFBF-C300C9A8AA2A__GUID-DE5F25E7-383A-4A46-B6D9-BEF785DBE0DA">
<p class="titleinexample">Example 3-3 Execution plan for partition pruning with zone maps</p>
<pre dir="ltr">---------------------------------------------------------------------------------------------------------------
| Id  | Operation                       | Name        | Rows  | Bytes | Cost (%CPU)| Time     | Pstart| Pstop |
---------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                |             |       |       |     3 (100)|          |       |       |
|   1 |  PARTITION RANGE ITERATOR       |             |    58 |  3306 |     3   (0)| 00:00:01 |KEY(ZM)|KEY(ZM)|
|*  2 |   TABLE ACCESS FULL WITH ZONEMAP| SALES_RANGE |    58 |  3306 |     3   (0)| 00:00:01 |KEY(ZM)|KEY(ZM)|
---------------------------------------------------------------------------------------------------------------
</pre>
<pre dir="ltr">Predicate Information (identified by operation id):
---------------------------------------------------

2 - filter((SYS_ZMAP_FILTER(&#39;/* ZM_PRUNING */ SELECT &#34;ZONE_ID$&#34;, CASE WHEN
 BITAND(zm.&#34;ZONE_STATE$&#34;,1)=1 THEN 1 ELSE CASE WHEN (zm.&#34;MAX_1_S_SHIPDATE&#34; &lt; :1 OR
 zm.&#34;MIN_1_S_SHIPDATE&#34; &gt; :2) THEN 3 ELSE 2 END END FROM &#34;SH&#34;.&#34;ZMAP$_SALES_RANGE&#34; zm WHERE
 zm.&#34;ZONE_LEVEL$&#34;=0 ORDER BY zm.&#34;ZONE_ID$&#34;&#39;,SYS_OP_ZONE_ID(ROWID),TO_DATE(&#39; 1999-01-01 00:00:00&#39;,
 &#39;syyyy-mm-dd hh24:mi:ss&#39;),TO_DATE(&#39; 1999-03-01 00:00:00&#39;, &#39;syyyy-mm-dd hh24:mi:ss&#39;))&lt;3 AND
 &#34;S_SHIPDATE&#34;&gt;=TO_DATE(&#39; 1999-01-01 00:00:00&#39;,&#39;syyyy-mm-dd hh24:mi:ss&#39;) AND &#34;S_SHIPDATE&#34;&lt;=TO_DATE(&#39;
  1999-03-01 00:00:00&#39;, &#39;syyyy-mm-dd hh24:mi:ss&#39;)))
</pre></div>
<!-- class="example" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2957">
<tr>
<td class="cellalignment2964">
<table class="cellalignment2962">
<tr>
<td class="cellalignment2961"><a href="GUID-F57D9DC0-31D6-4A0F-A787-5A82723D88F5.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2961"><a href="GUID-6C660105-8ECE-4426-A795-5884E84B0A48.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2966">
<table class="cellalignment2960">
<tr>
<td class="cellalignment2961"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2961"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2961"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2961"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2961"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2961"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>