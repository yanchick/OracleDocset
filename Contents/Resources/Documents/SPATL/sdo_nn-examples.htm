<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-101461"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/SDO_NN%20Examples"></a><title>SDO_NN Examples</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="SDO_NN operator, complex examples, SDO_NN_DISTANCE operator"/>
<meta name="dcterms.created" content="2017-01-26T11:46:57Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Spatial and Graph Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49172-07"/>
<meta name="dcterms.isVersionOf" content="SPATL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="sdo_within_distance-examples.htm" title="Previous" type="text/html"/>
<link rel="Next" href="loading-esri-shapefiles-spatial-and-graph.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49172-07.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79"></a> <span id="PAGE" style="display:none;">466/475</span> <!-- End Header -->
<a id="SPATL1283"></a><a id="SPATL1284"></a><a id="SPATL1282"></a>
<h1 id="SPATL-GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79" class="sect1"><span class="enumeration_section">C.3</span> SDO_NN Examples</h1>
<div>
<p>The <a href="sdo_nn.htm">SDO_NN</a> operator determines the nearest neighbor geometries to a geometry. No assumptions should be made about the order of the returned results, unless you specify the <a href="sdo_nn_distance.htm">SDO_NN_DISTANCE</a> ancillary operator in the ORDER BY clause to have the results returned in distance order. If you specify no optional parameters, one nearest neighbor geometry is returned.</p>
<p>If you specify the optional <code>sdo_num_res</code> keyword, you can request how many nearest neighbors you want, but no other conditions in the WHERE clause are evaluated. For example, assume that you want the five closest banks from an intersection, but only where the bank name is <code>CHASE</code>. If the five closest banks are not named <code>CHASE</code>, <a href="sdo_nn.htm">SDO_NN</a> with <code>sdo_num_res=5</code> will return no rows because the <code>sdo_num_res</code> keyword only takes proximity into account, and not any other conditions in the WHERE clause.</p>
<p>If you specify the optional <code>sdo_batch_size</code> keyword, any <code>sdo_num_res</code> specification is ignored, and <a href="sdo_nn.htm">SDO_NN</a> keeps returning neighbor geometries in distance order to the WHERE clause. If the WHERE clause specifies <code>bank_name = &#39;CHASE&#39; AND rownum &lt; 6</code>, you can return the five closest banks with <code>bank_name = &#39;CHASE&#39;</code>.</p>
<p><a href="sdo_nn_distance.htm">SDO_NN_DISTANCE</a> is an ancillary operator to the SDO_NN operator. It returns the distance of an object returned by the <a href="sdo_nn.htm">SDO_NN</a> operator and is valid only within a call to the <a href="sdo_nn.htm">SDO_NN</a> operator.</p>
<p>See also <a href="using-partitioned-spatial-indexes.htm#GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61__BABEBDJH">Example 5-1</a>in <a href="using-partitioned-spatial-indexes.htm">Using Partitioned Spatial Indexes</a>.</p>
<div class="example" id="GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHHJHBE">
<p class="titleinexample">Example C-3 Finding the Cities Nearest to a Highway</p>
<p><a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHHJHBE">Example C-3</a> finds the five cities nearest to the interstate highway I170 and the distance in miles from the highway for each city, ordered by distance in miles.</p>
<pre dir="ltr">SELECT /*+ ORDERED */
       c.city,
       sdo_nn_distance (1) distance_in_miles
FROM geod_interstates i, 
     geod_cities c 
WHERE i.highway = &#39;I170&#39;
  AND sdo_nn(c.location, i.geom,
             &#39;sdo_num_res=5 unit=mile&#39;, 1) = &#39;TRUE&#39;
ORDER BY distance_in_miles;
</pre>
<p>In <a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHHJHBE">Example C-3</a>, because the <code>/*+ ORDERED*/</code> optimizer hint is used, it is important to have an index on the GEOD_INTERSTATES.HIGHWAY column. In this example, the hint forces the query to locate highway I170 before it tries to find nearest neighbor geometries. In the <code>WHERE</code> clause of this example:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>i.highway</code> refers to the HIGHWAY column of the GEOD_INTERSTATES table, and <code>I170</code> is a value from the HIGHWAY column.</p>
</li>
<li>
<p><code>c.location</code> specifies the search column (<code>geometry1</code>). This is the LOCATION column of the GEOD_CITIES table.</p>
</li>
<li>
<p><code>i.geom</code> specifies the query window (<code>geometry2</code>). This is the spatial geometry in the GEOM column of the GEOD_INTERSTATES table, in the row whose HIGHWAY column contains the value <code>I170</code>.</p>
</li>
<li>
<p><code>sdo_num_res=5</code> specifies how many nearest neighbor geometries to find.</p>
</li>
<li>
<p><code>unit=mile</code> specifies the unit of measurement to associate with distances returned by the <a href="sdo_nn_distance.htm">SDO_NN_DISTANCE</a> ancillary operator.</p>
</li>
<li>
<p><code>1</code> (in <code>sdo_nn_distance (1)</code> and <code>&#39;sdo_num_res=5 unit=mile&#39;, 1</code>) is the <code>number</code> parameter value that associates the call to <a href="sdo_nn.htm">SDO_NN</a> with the call to <a href="sdo_nn_distance.htm">SDO_NN_DISTANCE</a>.</p>
</li>
</ul>
<p>In <a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHHJHBE">Example C-3</a>, <code>ORDER BY distance_in_miles</code> orders the results from the WHERE clause by distance in miles.</p>
<p>The statement in <a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHHJHBE">Example C-3</a> produces the following output (slightly reformatted for readability):</p>
<pre dir="ltr">CITY                    DISTANCE_IN_MILES
----------------------  ------------------------------
St Louis                  5.36297295
Springfield              78.7997464
Peoria                  141.478022
Evansville              158.22422
Springfield             188.508631
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHBHFCA">
<p class="titleinexample">Example C-4 Finding the Cities Above a Specified Population Nearest to a Highway</p>
<p><a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHBHFCA">Example C-4</a> extends <a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHHJHBE">Example C-3</a> by limiting the results to cities with a 1990 population over a certain number. It finds the five cities nearest to the interstate highway I170 that have a population greater than 300,000, the 1990 population for each city, and the distance in miles from the highway for each city, ordered by distance in miles.</p>
<pre dir="ltr">SELECT /*+ ORDERED  NO_INDEX(c pop90_idx) */
       c.city, pop90,
       sdo_nn_distance (1) distance_in_miles
FROM geod_interstates i,
     geod_cities c
WHERE i.highway = &#39;I170&#39;
  AND sdo_nn(c.location, i.geom,
            &#39;sdo_batch_size=10 unit=mile&#39;, 1) = &#39;TRUE&#39;
  AND c.pop90 &gt; 300000
  AND rownum &lt; 6
ORDER BY distance_in_miles;
</pre>
<p>In <a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHBHFCA">Example C-4</a>, because the <code>ORDERED</code> optimizer hint is used, it is important to have an index on the GEOD_INTERSTATES.HIGHWAY column. In this example, the hint forces the query to locate highway I170 before it tries to find nearest neighbor geometries.</p>
<p>To ensure correct results, disable all nonspatial indexes on columns that come from the same table as the SDO_NN search column (<code>geometry1</code>). In this example, the <code>NO_INDEX(c pop90_idx)</code> optimizer hint disables the nonspatial index on the POP90 column.</p>
<p>In the <code>WHERE</code> clause of this example:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>sdo_batch_size=10</code> causes geometries to be returned continually (in distance order, in batches of 10 geometries), to be checked to see if they satisfy the other conditions in the WHERE clause.</p>
</li>
<li>
<p><code>c.pop90 &gt; 300000</code> restricts the results to rows where the POP90 column value is greater than 300000.</p>
</li>
<li>
<p><code>rownum &lt; 6</code> limits the number of results returned to five.</p>
</li>
</ul>
<p>In <a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHBHFCA">Example C-4</a>, <code>ORDER BY distance_in_miles</code> orders the results from the WHERE clause by distance in miles.</p>
<p>The statement in <a href="sdo_nn-examples.htm#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79__CIHBHFCA">Example C-4</a> produces the following output (slightly reformatted for readability):</p>
<pre dir="ltr">CITY               POP90    DISTANCE_IN_MILES
-----------------  -------  ---------------------
St Louis            396685     5.36297295
Kansas City         435146   227.404883
Indianapolis        741952   234.708666
Memphis             610337   244.202072
Chicago            2783726   253.547961
</pre></div>
<!-- class="example" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment142">
<tr>
<td class="cellalignment149">
<table class="cellalignment147">
<tr>
<td class="cellalignment146"><a href="sdo_within_distance-examples.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment146"><a href="loading-esri-shapefiles-spatial-and-graph.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment151">
<table class="cellalignment145">
<tr>
<td class="cellalignment146"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment146"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment146"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment146"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment146"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment146"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>