<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-101232"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/SDO_GEOMETRY%20Objects%20in%20Function-Based%20Indexes"></a><title>SDO_GEOMETRY Objects in Function-Based Indexes</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="SDO_GEOMETRY object type, in function-based indexes, function-based indexes, with SDO_GEOMETRY objects, indexes, function-based with SDO_GEOMETRY objects, embedding in user-defined type, user-defined data types, embedding SDO_GEOMETRY objects in, object types"/>
<meta name="dcterms.created" content="2017-01-26T11:46:57Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Spatial and Graph Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49172-07"/>
<meta name="dcterms.isVersionOf" content="SPATL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="sdo_geometry-objects-user-defined-type-definitions.htm" title="Previous" type="text/html"/>
<link rel="Next" href="spatial-web-services.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49172-07.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-CFB6B6DB-4B97-43D1-86A1-21C1BA853089"></a> <span id="PAGE" style="display:none;">114/475</span> <!-- End Header -->
<a id="SPATL799"></a>
<h1 id="SPATL-GUID-CFB6B6DB-4B97-43D1-86A1-21C1BA853089" class="sect1"><span class="enumeration_section">9.2</span> SDO_GEOMETRY Objects in Function-Based Indexes</h1>
<div>
<p>A function-based spatial index facilitates queries that use locational information (of type SDO_GEOMETRY) returned by a function or expression. In this case, the spatial index is created based on the precomputed values returned by the function or expression.</p>
<p>If you are not already familiar with function-based indexes, see the following for detailed explanations of their benefits, options, and requirements, as well as usage examples:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADFNS00505" target="_blank" href="../ADFNS/adfns_indexes.htm#ADFNS00505"><span class="italic">Oracle Database Development Guide</span></a></p>
</li>
<li>
<p><a class="olink ADMIN11730" target="_blank" href="../ADMIN/indexes.htm#ADMIN11730"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a></p>
</li>
</ul>
<p>The procedure for using an SDO_GEOMETRY object in a function-based index is as follows:</p>
<ol>
<li>
<p>Create the function that returns an SDO_GEOMETRY object.</p>
<p>The function must be declared as DETERMINISTIC.</p>
</li>
<li>
<p>If the spatial data table does not already exist, create it, and insert data into the table.</p>
</li>
<li>
<p>Update the USER_SDO_GEOM_METADATA view.</p>
</li>
<li>
<p>Create the spatial index.</p>
<p>For a function-based spatial index, the number of parameters must not exceed 32.</p>
</li>
<li>
<p>Perform queries on the data.</p>
</li>
</ol>
<p>The rest of this section describes two examples of using function-based indexes. In both examples, a function is created that returns an SDO_GEOMETRY object, and a spatial index is created on that function. In the first example, the input parameters to the function are a standard Oracle data type (NUMBER). In the second example, the input to the function is a user-defined object type.</p>
</div>
<a id="SPATL800"></a>
<div class="props_rev_3"><a id="GUID-C662ABEA-7BE3-4D17-83E7-20CAA5556D71"></a>
<h2 id="SPATL-GUID-C662ABEA-7BE3-4D17-83E7-20CAA5556D71" class="sect2"><span class="enumeration_section">9.2.1</span> Example: Function with Standard Types</h2>
<div>
<p>In the following example, the input parameters to the function used for the function-based index are standard numeric values (longitude and latitude).</p>
<p>Assume that you want to create a function that returns the longitude and latitude of a point and to use that function in a spatial index. First, create the function, as in the following example that creates a function named GET_LONG_LAT_PT:</p>
<pre dir="ltr">-- Create a function to return a point geometry (SDO_GTYPE = 2001) with
-- input of 2 numbers: longitude and latitude (SDO_SRID = 8307, for
-- &#34;Longitude / Latitude (WGS 84)&#34;,  probably the most widely used 
--  coordinate system, and the one used for GPS devices.
-- Specify DETERMINISTIC for the function.

create or replace function get_long_lat_pt(longitude in number, 
                                           latitude in number)
return SDO_GEOMETRY deterministic is
begin
     return sdo_geometry(2001, 8307, 
                sdo_point_type(longitude, latitude, NULL),NULL, NULL);
end;
/
</pre>
<p>If the spatial data table does not already exist, create the table and add data to it, as in the following example that creates a table named LONG_LAT_TABLE:</p>
<pre dir="ltr">create table LONG_LAT_TABLE 
(lon number, lat number, name varchar2(32));

insert into LONG_LAT_TABLE values (10,10, &#39;Place1&#39;);
insert into LONG_LAT_TABLE values (20,20, &#39;Place2&#39;);
insert into LONG_LAT_TABLE values (30,30, &#39;Place3&#39;);
</pre>
<p>Update the USER_SDO_GEOM_METADATA view, using dot-notation to specify the schema name and function name. The following example specifies SCOTT.GET_LONG_LAT_PT(LON,LAT) as the COLUMN_NAME (explained in <a href="geometry-metadata-views.htm#GUID-39C747F5-69B7-473A-8B66-0CF5CF38D1F6">COLUMN_NAME</a>) in the metadata view.</p>
<pre dir="ltr">-- Set up the metadata entry for this table.
-- The column name sets up the function on top
-- of the two columns used in this function,
-- along with the owner of the function.
insert into user_sdo_geom_metadata values(&#39;LONG_LAT_TABLE&#39;,
 &#39;scott.get_long_lat_pt(lon,lat)&#39;,
 sdo_dim_array(
   sdo_dim_element(&#39;Longitude&#39;, -180, 180, 0.005),
   sdo_dim_element(&#39;Latitude&#39;, -90, 90, 0.005)), 8307);
</pre>
<p>Create the spatial index, specifying the function name with parameters. For example:</p>
<pre dir="ltr">create index LONG_LAT_TABLE_IDX on 
   LONG_LAT_TABLE(get_long_lat_pt(lon,lat))
   indextype is mdsys.spatial_index;
</pre>
<p>Perform queries on the data. The following example specifies the user-defined function in a call to the <a href="sdo_filter.htm">SDO_FILTER</a> operator.</p>
<pre dir="ltr">select name from LONG_LAT_TABLE a
  where sdo_filter(
    get_long_lat_pt(a.lon,a.lat), 
    sdo_geometry(2001, 8307, sdo_point_type(10,10,NULL), NULL, NULL)
  )=&#39;TRUE&#39;;

NAME
--------------------------------
Place1
</pre></div>
</div>
<a id="SPATL801"></a>
<div class="props_rev_3"><a id="GUID-846CC1C6-5E84-4959-B284-501BDFBCB909"></a>
<h2 id="SPATL-GUID-846CC1C6-5E84-4959-B284-501BDFBCB909" class="sect2"><span class="enumeration_section">9.2.2</span> Example: Function with a User-Defined Object Type</h2>
<div>
<p>In the following example, the input parameter to the function used for the function-based index is an object of a user-defined type that includes the longitude and latitude.</p>
<p>Assume that you want to create a function that returns the longitude and latitude of a point and to create a spatial index on that function. First, create the user-defined data type, as in the following example that creates an object type named LONG_LAT and its member function GetGeometry:</p>
<pre dir="ltr">create type long_lat as object ( 
   longitude number, 
   latitude number, 
member function GetGeometry(SELF in long_lat) 
RETURN SDO_GEOMETRY DETERMINISTIC) 
/ 

create or replace type body long_lat as 
  member function GetGeometry(self in long_lat) 
  return SDO_GEOMETRY is 
    begin 
       return sdo_geometry(2001, 8307, 
           sdo_point_type(longitude, latitude, NULL), NULL,NULL); 
    end; 
end; 
/ 
  
</pre>
<p>If the spatial data table does not already exist, create the table and add data to it, as in the following example that creates a table named TEST_LONG_LAT:</p>
<pre dir="ltr">create table test_long_lat 
   (location long_lat, name varchar2(32)); 

insert into test_long_lat values (long_lat(10,10), &#39;Place1&#39;); 
insert into test_long_lat values (long_lat(20,20), &#39;Place2&#39;); 
insert into test_long_lat values (long_lat(30,30), &#39;Place3&#39;); 
</pre>
<p>Update the USER_SDO_GEOM_METADATA view, using dot-notation to specify the schema name, table name, and function name and parameter value. The following example specifies SCOTT.LONG_LAT.GetGeometry(LOCATION) as the COLUMN_NAME (explained in <a href="geometry-metadata-views.htm#GUID-39C747F5-69B7-473A-8B66-0CF5CF38D1F6">COLUMN_NAME</a>) in the metadata view.</p>
<pre dir="ltr">insert into user_sdo_geom_metadata values(&#39;test_long_lat&#39;, 
 &#39;scott.long_lat.GetGeometry(location)&#39;, 
 sdo_dim_array( 
   sdo_dim_element(&#39;Longitude&#39;, -180, 180, 0.005),
   sdo_dim_element(&#39;Latitude&#39;, -90, 90, 0.005)), 8307);
</pre>
<p>Create the spatial index, specifying the column name and function name using dot-notation. For example:</p>
<pre dir="ltr">create index test_long_lat_idx on test_long_lat(location.GetGeometry()) 
  indextype is mdsys.spatial_index;
</pre>
<p>Perform queries on the data. The following query performs a primary filter operation, asking for the names of geometries that are likely to interact spatially with point (10,10).</p>
<pre dir="ltr">SELECT a.name FROM test_long_lat a
  WHERE SDO_FILTER(a.location.GetGeometry(),
            SDO_GEOMETRY(2001, 8307,
                SDO_POINT_TYPE(10,10,NULL), NULL, NULL)
            ) = &#39;TRUE&#39;;
</pre></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment142">
<tr>
<td class="cellalignment149">
<table class="cellalignment147">
<tr>
<td class="cellalignment146"><a href="sdo_geometry-objects-user-defined-type-definitions.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment146"><a href="spatial-web-services.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment151">
<table class="cellalignment145">
<tr>
<td class="cellalignment146"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment146"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment146"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment146"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment146"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment146"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>