<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-106649"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Tuning%20the%20Result%20Cache"></a><title>Tuning the Result Cache</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-01-18T01:24:57Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Performance Tuning Guide"/>
<meta name="dcterms.identifier" content="E49058-08"/>
<meta name="dcterms.isVersionOf" content="TGDBA"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="tune_shared_pool.htm" title="Previous" type="text/html"/>
<link rel="Next" href="tune_pga.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49058-08.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-FA30CC32-17AB-477A-9E4C-B47BFE0968A1"></a> <span id="PAGE" style="display:none;">22/27</span> <!-- End Header -->
<a id="TGDBA616"></a>
<h1 id="TGDBA-GUID-FA30CC32-17AB-477A-9E4C-B47BFE0968A1" class="sect1"><span class="enumeration_chapter">15</span> Tuning the Result Cache</h1>
<div>
<p>This chapter describes how to tune the result cache and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-9C00174C-9046-4EB1-BC1C-5E7FA03FB9AA">About the Result Cache</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-B4EB65AF-CBDB-4340-A526-254401AEA8D2">Configuring the Result Cache</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-93F518A7-1531-4CBB-8A0F-DE3248813A4C">Specifying Queries for Result Caching</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-F99D9B4F-FFFC-4C5B-BB17-96730F3C1820">Monitoring the Result Cache</a></p>
</li>
</ul>
</div>
<a id="TGDBA617"></a>
<div class="props_rev_3"><a id="GUID-9C00174C-9046-4EB1-BC1C-5E7FA03FB9AA"></a>
<h2 id="TGDBA-GUID-9C00174C-9046-4EB1-BC1C-5E7FA03FB9AA" class="sect2">About the Result Cache</h2>
<div>
<p>A result cache is an area of memory, either in the Shared Global Area (SGA) or client application memory, that stores the results of a database query or query block for reuse. The cached rows are shared across SQL statements and sessions unless they become stale.</p>
<p>This section describes the two types of result cache and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-60F72D26-3DD0-4DBB-9DCE-3A7634559A3C">Server Result Cache Concepts</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-39C521D4-5C6E-44B1-B7C7-DEADD7D9CAF0">Client Result Cache Concepts</a></p>
</li>
</ul>
</div>
<a id="TGDBA618"></a>
<div class="props_rev_3"><a id="GUID-60F72D26-3DD0-4DBB-9DCE-3A7634559A3C"></a>
<h3 id="TGDBA-GUID-60F72D26-3DD0-4DBB-9DCE-3A7634559A3C" class="sect3">Server Result Cache Concepts</h3>
<div>
<p>The server result cache is a memory pool within the shared pool. This memory pool consists of the SQL query result cache&mdash;which stores results of SQL queries&mdash;and the PL/SQL function result cache, which stores values returned by PL/SQL functions.</p>
<p>This section describes the server result cache and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-25608BFE-B8DB-469E-9BAD-6414A0816F85">Benefits of Using the Server Result Cache</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-6A7E9B2D-F2F1-4C3A-9C91-8569FA7F1938">Understanding How the Server Result Cache Works</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-60F72D26-3DD0-4DBB-9DCE-3A7634559A3C__GUID-7CFB7251-2749-4A6B-8ED9-1EC7CF623288">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink CNCPT1919" target="_blank" href="../CNCPT/memory.htm#CNCPT1919"><span class="italic">Oracle Database Concepts</span></a> for information about the server result cache</p>
</li>
<li>
<p><a class="olink LNPLS00817" target="_blank" href="../LNPLS/subprograms.htm#LNPLS00817"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for information about the PL/SQL function result cache</p>
</li>
</ul>
</div>
</div>
<a id="TGDBA619"></a>
<div class="props_rev_3"><a id="GUID-25608BFE-B8DB-469E-9BAD-6414A0816F85"></a>
<h4 id="TGDBA-GUID-25608BFE-B8DB-469E-9BAD-6414A0816F85" class="sect4">Benefits of Using the Server Result Cache</h4>
<div>
<p>The benefits of using the server result cache depend on the application. OLAP applications can benefit significantly from its use. Good candidates for caching are queries that access a high number of rows but return a small number, such as those in a data warehouse. For example, you can use advanced query rewrite with equivalences to create materialized views that materialize queries in the result cache instead of using tables.</p>
<div class="infoboxnotealso" id="GUID-25608BFE-B8DB-469E-9BAD-6414A0816F85__GUID-5E7D9F65-C605-40CC-B637-4235B3DBADDB">
<p class="notep1">See Also:</p>
<p><a class="olink DWHSG0807" target="_blank" href="../DWHSG/qradv.htm#DWHSG0807"><span class="italic">Oracle Database Data Warehousing Guide</span></a> for information about using the result cache and advance query rewrite with equivalences</p>
</div>
</div>
</div>
<a id="TGDBA620"></a>
<div class="props_rev_3"><a id="GUID-6A7E9B2D-F2F1-4C3A-9C91-8569FA7F1938"></a>
<h4 id="TGDBA-GUID-6A7E9B2D-F2F1-4C3A-9C91-8569FA7F1938" class="sect4">Understanding How the Server Result Cache Works</h4>
<div>
<p>When a query executes, the database searches the cache memory to determine whether the result exists in the result cache. If the result exists, then the database retrieves the result from memory instead of executing the query. If the result is not cached, then the database executes the query, returns the result as output, and stores the result in the result cache.</p>
<p>When users execute queries and functions repeatedly, the database retrieves rows from the cache, decreasing response time. Cached results become invalid when data in dependent database objects is modified.</p>
<p>The following sections contains examples of how to retrieve results from the server result cache:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-91493D24-813B-4075-BB4B-9BE96FA358C6">How Results are Retrieved in a Query</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-5892D688-A878-467F-88C3-3C6DA566278D">How Results are Retrieved in a View</a></p>
</li>
</ul>
</div>
<a id="TGDBA622"></a><a id="TGDBA623"></a><a id="TGDBA621"></a>
<div class="props_rev_3"><a id="GUID-91493D24-813B-4075-BB4B-9BE96FA358C6"></a>
<h5 id="TGDBA-GUID-91493D24-813B-4075-BB4B-9BE96FA358C6" class="sect5">How Results are Retrieved in a Query</h5>
<div>
<div class="section">
<p>The following example shows a query of <code>hr.employees</code> that uses the <code>RESULT_CACHE</code> hint to retrieve rows from the server result cache.</p>
<pre dir="ltr">SELECT /*+ RESULT_CACHE */ department_id, AVG(salary)
  FROM hr.employees
 GROUP BY department_id;
</pre>
<p>A portion of the execution plan of this query might look like the following:</p>
<pre dir="ltr">--------------------------------------------------------------
| Id | Operation          | Name                       |Rows
--------------------------------------------------------------
| 0 | SELECT STATEMENT    |                            | 11
| 1 |  <span class="bold">RESULT CACHE</span>       | <span class="bold">8fpza04gtwsfr6n595au15yj4y</span> |
| 2 |   HASH GROUP BY     |                            | 11
| 3 |    TABLE ACCESS FULL| EMPLOYEES                  | 107
--------------------------------------------------------------
</pre>
<p>In this example, the results are retrieved directly from the cache, as indicated in step 1 of the execution plan. The value in the <code>Name</code> column is the cache ID of the result.</p>
<p>The following example shows a query of the <code>V$RESULT_CACHE_OBJECTS</code> view to retrieve detailed statistics about the cached result.</p>
<pre dir="ltr">SELECT id, type, creation_timestamp, block_count,
       column_count, pin_count, row_count
  FROM V$RESULT_CACHE_OBJECTS
 WHERE cache_id = &#39;8fpza04gtwsfr6n595au15yj4y&#39;;
</pre>
<p>In this example, the value of <code>CACHE_ID</code> is the cache ID obtained from the explain plan in the earlier example. The output of this query might look like the following:</p>
<pre dir="ltr">        ID TYPE       CREATION_ BLOCK_COUNT COLUMN_COUNT  PIN_COUNT  ROW_COUNT
---------- ---------- --------- ----------- ------------ ---------- ----------
         2 Result     06-NOV-11           1            2          0         12
</pre></div>
<!-- class="section" --></div>
</div>
<a id="TGDBA625"></a><a id="TGDBA624"></a>
<div class="props_rev_3"><a id="GUID-5892D688-A878-467F-88C3-3C6DA566278D"></a>
<h5 id="TGDBA-GUID-5892D688-A878-467F-88C3-3C6DA566278D" class="sect5">How Results are Retrieved in a View</h5>
<div>
<div class="section">
<p><a href="tune_result_cache.htm#GUID-5892D688-A878-467F-88C3-3C6DA566278D__CDEHBEJH">Example 15-1</a> shows a query that uses the <code>RESULT_CACHE</code> hint within a <code>WITH</code> clause view.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-5892D688-A878-467F-88C3-3C6DA566278D__CDEHBEJH">
<p class="titleinexample">Example 15-1 RESULT_CACHE Hint Specified in a WITH View</p>
<pre dir="ltr">WITH summary AS
( SELECT /*+ RESULT_CACHE */ department_id, avg(salary) avg_sal
    FROM hr.employees
   GROUP BY department_id )
SELECT d.*, avg_sal
  FROM hr.departments d, summary s
 WHERE d.department_id = s.department_id;
</pre>
<p>A portion of the execution plan of this query might look like the following:</p>
<pre dir="ltr">------------------------------------------------------------------------------------------------
| Id| Operation             | Name                      | Rows | Bytes | Cost (%CPU)| Time     |
------------------------------------------------------------------------------------------------
|  0| SELECT STATEMENT      |                           |   11 |   517 |     7  (29)| 00:00:01 |
|* 1|  HASH JOIN            |                           |   11 |   517 |     7  (29)| 00:00:01 |
|  2|   VIEW                |                           |   11 |   286 |     4  (25)| 00:00:01 |
|  3|    <span class="bold">RESULT CACHE</span>       | <span class="bold">8nknkh64ctmz94a5muf2tyb8r</span> |      |       |            |          |
|  4|     HASH GROUP BY     |                           |   11 |    77 |     4  (25)| 00:00:01 |
|  5|      TABLE ACCESS FULL| EMPLOYEES                 |  107 |   749 |     3   (0)| 00:00:01 |
|  6|   TABLE ACCESS FULL   | DEPARTMENTS               |   27 |   567 |     2   (0)| 00:00:01 |
------------------------------------------------------------------------------------------------
</pre>
<p>In this example, the <code>summary</code> view results are retrieved directly from the cache, as indicated in step 3 of the execution plan. The value in the <code>Name</code> column is the cache ID of the result.</p>
</div>
<!-- class="example" --></div>
</div>
</div>
</div>
<a id="TGDBA626"></a>
<div class="props_rev_3"><a id="GUID-39C521D4-5C6E-44B1-B7C7-DEADD7D9CAF0"></a>
<h3 id="TGDBA-GUID-39C521D4-5C6E-44B1-B7C7-DEADD7D9CAF0" class="sect3">Client Result Cache Concepts</h3>
<div>
<p>The Oracle Call Interface (OCI) client result cache is a memory area inside a client process that caches SQL query result sets for OCI applications. This client cache exists for each client process and is shared by all sessions inside the process. Oracle recommends client result caching for queries of read-only or read-mostly tables.</p>
<div class="infobox-note" id="GUID-39C521D4-5C6E-44B1-B7C7-DEADD7D9CAF0__GUID-CBA589A6-1521-48BE-AC92-5C0F78A48022">
<p class="notep1">Note:</p>
<p>The client result cache is distinct from the server result cache, which resides in the SGA. When client result caching is enabled, the query result set can be cached on the client, server, or both. Client caching can be enabled even if the server result cache is disabled.</p>
</div>
<p>This section describes the client result cache and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-F11479BE-6C28-4293-90E5-18AFAEEB488E">Benefits of Using the Client Result Cache</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-4B9DD91E-7F5B-4C8C-80AA-347C2FAEC725">Understanding How the Client Result Cache Works</a></p>
</li>
</ul>
</div>
<a id="TGDBA627"></a>
<div class="props_rev_3"><a id="GUID-F11479BE-6C28-4293-90E5-18AFAEEB488E"></a>
<h4 id="TGDBA-GUID-F11479BE-6C28-4293-90E5-18AFAEEB488E" class="sect4">Benefits of Using the Client Result Cache</h4>
<div>
<p>OCI drivers, such as OCCI, the JDBC OCI driver, and ODP.NET, support client result caching. Performance benefits of using the client result cache include:</p>
<ul style="list-style-type: disc;">
<li>
<p>Reduced query response time</p>
<p>When queries are executed repeatedly, the application retrieves results directly from the client cache memory, resulting in faster query response time.</p>
</li>
<li>
<p>More efficient use of database resources</p>
<p>The reduction in server round trips may result in substantial performance savings of server resources, such as server CPU and I/O. These resources are freed for other tasks, thereby making the server more scalable.</p>
</li>
<li>
<p>Reduced memory cost</p>
<p>The result cache uses client memory, which may be less expensive than server memory.</p>
</li>
</ul>
</div>
</div>
<a id="TGDBA629"></a><a id="TGDBA628"></a>
<div class="props_rev_3"><a id="GUID-4B9DD91E-7F5B-4C8C-80AA-347C2FAEC725"></a>
<h4 id="TGDBA-GUID-4B9DD91E-7F5B-4C8C-80AA-347C2FAEC725" class="sect4">Understanding How the Client Result Cache Works</h4>
<div>
<p>The client result cache stores the results of the outermost query, which are the columns defined by the OCI application. Subqueries and query blocks are not cached.</p>
<p><a href="tune_result_cache.htm#GUID-4B9DD91E-7F5B-4C8C-80AA-347C2FAEC725__CDEGCHGA">Figure 15-1</a> illustrates a client process with a database login session. This client process has one client result cache shared amongst multiple application sessions running in the client process. If the first application session runs a query, then it retrieves rows from the database and caches them in the client result cache. If other application sessions run the same query, then they also retrieve rows from the client result cache.</p>
<div class="figure" id="GUID-4B9DD91E-7F5B-4C8C-80AA-347C2FAEC725__CDEGCHGA">
<p class="titleinfigure">Figure 15-1 Client Result Cache</p>
<img width="608" height="297" src="img/GUID-2AB80866-81DF-473E-AC2C-3E464E7E3A83-default.gif" alt="Description of Figure 15-1 follows" title="Description of Figure 15-1 follows"/><br/>
<a href="img_text/GUID-2AB80866-81DF-473E-AC2C-3E464E7E3A83-print.htm">Description of &#34;Figure 15-1 Client Result Cache&#34;</a></div>
<!-- class="figure" -->
<p>The client result cache transparently keeps the result set consistent with session state or database changes that affect it. When a transaction changes the data or metadata of database objects used to build the cached result, the database sends an invalidation to the OCI client on its next round trip to the server.</p>
<div class="infoboxnotealso" id="GUID-4B9DD91E-7F5B-4C8C-80AA-347C2FAEC725__GUID-9F047B09-6A6F-417E-80BE-58FE8C516FD0">
<p class="notep1">See Also:</p>
<p><a class="olink LNOCI10103" target="_blank" href="../LNOCI/oci10new.htm#LNOCI10103"><span class="italic">Oracle Call Interface Programmer&#39;s Guide</span></a> for details about the client result cache</p>
</div>
</div>
</div>
</div>
</div>
<a id="TGDBA630"></a>
<div class="props_rev_3"><a id="GUID-B4EB65AF-CBDB-4340-A526-254401AEA8D2"></a>
<h2 id="TGDBA-GUID-B4EB65AF-CBDB-4340-A526-254401AEA8D2" class="sect2">Configuring the Result Cache</h2>
<div>
<p>This section describes how to configure the server and client result cache and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-E26C1BB2-F2A3-4FFD-93B0-B8A791017289">Configuring the Server Result Cache</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-21CAA1E7-9E46-4442-9F3E-CE09EEF60D92">Configuring the Client Result Cache</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-D2FA7B29-301B-4AB8-8294-2B1B015899F9">Setting the Result Cache Mode</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-7E0D0BAD-ACBA-451E-AB38-1EF981AC44ED">Requirements for the Result Cache</a></p>
</li>
</ul>
</div>
<a id="TGDBA631"></a>
<div class="props_rev_3"><a id="GUID-E26C1BB2-F2A3-4FFD-93B0-B8A791017289"></a>
<h3 id="TGDBA-GUID-E26C1BB2-F2A3-4FFD-93B0-B8A791017289" class="sect3">Configuring the Server Result Cache</h3>
<div>
<p>By default, on database startup, Oracle Database allocates memory to the server result cache in the shared pool. The memory size allocated depends on the memory size of the shared pool and the selected memory management system:</p>
<ul style="list-style-type: disc;">
<li>
<p>Automatic shared memory management</p>
<p>If you are managing the size of the shared pool using the <code>SGA_TARGET</code> initialization parameter, Oracle Database allocates 0.50% of the value of the <code>SGA_TARGET</code> parameter to the result cache.</p>
</li>
<li>
<p>Manual shared memory management</p>
<p>If you are managing the size of the shared pool using the <code>SHARED_POOL_SIZE</code> initialization parameter, then Oracle Database allocates 1% of the shared pool size to the result cache.</p>
</li>
</ul>
<div class="infobox-note" id="GUID-E26C1BB2-F2A3-4FFD-93B0-B8A791017289__GUID-8848C6B3-8143-451A-8194-F45464225567">
<p class="notep1">Note:</p>
<p>Oracle Database will not allocate more than 75% of the shared pool to the server result cache.</p>
</div>
<p>The size of the server result cache grows until it reaches the maximum size. Query results larger than the available space in the cache are not cached. The database employs a Least Recently Used (LRU) algorithm to age out cached results, but does not otherwise automatically release memory from the server result cache.</p>
<p>This section describes how to configure the server result cache and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-753CE20B-ADC5-457C-8669-83250B79DD32">Sizing the Server Result Cache Using Initialization Parameters</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-847E4770-FF77-4011-BA35-15C28BCE1E6A">Managing the Server Result Cache Using DBMS_RESULT_CACHE</a></p>
</li>
</ul>
</div>
<a id="TGDBA633"></a><a id="TGDBA632"></a>
<div class="props_rev_3"><a id="GUID-753CE20B-ADC5-457C-8669-83250B79DD32"></a>
<h4 id="TGDBA-GUID-753CE20B-ADC5-457C-8669-83250B79DD32" class="sect4">Sizing the Server Result Cache Using Initialization Parameters</h4>
<div>
<div class="section">
<p><a href="tune_result_cache.htm#GUID-753CE20B-ADC5-457C-8669-83250B79DD32__CDEHIIBJ" title="This table lists the database initialization parameters that control the server result cache.">Table 15-1</a> lists the database initialization parameters that control the server result cache.</p>
<div class="tblformal" id="GUID-753CE20B-ADC5-457C-8669-83250B79DD32__CDEHIIBJ">
<p class="titleintable">Table 15-1 Server Result Cache Initialization Parameters</p>
<table class="cellalignment11" title="Server Result Cache Initialization Parameters" summary="This table lists the database initialization parameters that control the server result cache.">
<thead>
<tr class="cellalignment2">
<th class="cellalignment53" id="d39609e753">Parameter</th>
<th class="cellalignment54" id="d39609e756">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment55" id="d39609e761" headers="d39609e753">
<p><code>RESULT_CACHE_MAX_SIZE</code></p>
</td>
<td class="cellalignment56" headers="d39609e761 d39609e756">
<p>Specifies the memory allocated to the server result cache. To disable the server result cache, set this parameter to 0.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment55" id="d39609e769" headers="d39609e753">
<p><code>RESULT_CACHE_MAX_RESULT</code></p>
</td>
<td class="cellalignment56" headers="d39609e769 d39609e756">
<p>Specifies the maximum amount of server result cache memory (in percent) that can be used for a single result. Valid values are between 1 and 100. The default value is 5%. You can set this parameter at the system or session level.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment55" id="d39609e777" headers="d39609e753">
<p><code>RESULT_CACHE_REMOTE_EXPIRATION</code></p>
</td>
<td class="cellalignment56" headers="d39609e777 d39609e756">
<p>Specifies the expiration time (in minutes) for a result in the server result cache that depends on remote database objects. The default value is 0, which specifies that results using remote objects will not be cached. If a non-zero value is set for this parameter, DML on the remote database does not invalidate the server result cache.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To change the memory allocated to the server result cache:</p>
<ul style="list-style-type: disc;">
<li>
<p>Set the value of the <code>RESULT_CACHE_MAX_SIZE</code> initialization parameter to the desired size.</p>
<p>In an Oracle Real Application Clusters (Oracle RAC) environment, the result cache is specific to each database instance and can be sized differently on each instance. However, invalidations work across instances. To disable the server result cache in a cluster, you must explicitly set this parameter to 0 for each instance startup.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-753CE20B-ADC5-457C-8669-83250B79DD32__GUID-A9F1B55B-39CC-4219-A134-02D8D4A713F8">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN" target="_blank" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about the server result cache initialization parameters</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGDBA634"></a>
<div class="props_rev_3"><a id="GUID-847E4770-FF77-4011-BA35-15C28BCE1E6A"></a>
<h4 id="TGDBA-GUID-847E4770-FF77-4011-BA35-15C28BCE1E6A" class="sect4">Managing the Server Result Cache Using DBMS_RESULT_CACHE</h4>
<div>
<p>The <code>DBMS_RESULT_CACHE</code> package provides statistics, information, and operators that enable you to manage memory allocation for the server result cache. Use the <code>DBMS_RESULT_CACHE</code> package to perform operations such as retrieving statistics on the cache memory usage and flushing the cache.</p>
<p>This section describes how to manage the server result cache using the <code>DBMS_RESULT_CACHE</code> package and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-208B207B-A624-4361-A187-CEF43C3C21FB">Viewing Memory Usage Statistics for the Server Result Cache</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-97121C67-75F3-4EDE-968D-17489386ACA5">Flushing the Server Result Cache</a></p>
</li>
</ul>
</div>
<a id="TGDBA636"></a><a id="TGDBA635"></a>
<div class="props_rev_3"><a id="GUID-208B207B-A624-4361-A187-CEF43C3C21FB"></a>
<h5 id="TGDBA-GUID-208B207B-A624-4361-A187-CEF43C3C21FB" class="sect5">Viewing Memory Usage Statistics for the Server Result Cache</h5>
<div>
<div class="section">
<p>This section describes how to view memory allocation statistics for the result cache using the <code>DBMS_RESULT_CACHE</code> package.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To view memory usage statistics for the result cache:</p>
<ul style="list-style-type: disc;">
<li>
<p>Execute the <code>DBMS_RESULT_CACHE</code>.<code>MEMORY_REPORT</code> procedure.</p>
<p><a href="tune_result_cache.htm#GUID-208B207B-A624-4361-A187-CEF43C3C21FB__CDECBJGJ">Example 15-2</a> shows an execution of this procedure.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="example" id="GUID-208B207B-A624-4361-A187-CEF43C3C21FB__CDECBJGJ">
<p class="titleinexample">Example 15-2 Using the DBMS_RESULT_CACHE Package</p>
<pre dir="ltr">SQL&gt; SET SERVEROUTPUT ON
SQL&gt; EXECUTE DBMS_RESULT_CACHE.MEMORY_REPORT
</pre>
<p>The output of this command might look like the following:</p>
<pre dir="ltr">R e s u l t  C a c h e  M e m o r y  R e p o r t
[Parameters]
Block Size = 1024 bytes
Maximum Cache Size = 950272 bytes (928 blocks)
Maximum Result Size = 47104 bytes (46 blocks)
[Memory]
Total Memory = 46340 bytes [0.048% of the Shared Pool]
... Fixed Memory = 10696 bytes [0.011% of the Shared Pool]
... State Object Pool = 2852 bytes [0.003% of the Shared Pool]
... Cache Memory = 32792 bytes (32 blocks) [0.034% of the Shared Pool]
....... Unused Memory = 30 blocks
....... Used Memory = 2 blocks
........... Dependencies = 1 blocks
........... Results = 1 blocks
............... SQL = 1 blocks

PL/SQL procedure successfully completed.
</pre></div>
<!-- class="example" --></div>
</div>
<a id="TGDBA637"></a>
<div class="props_rev_3"><a id="GUID-97121C67-75F3-4EDE-968D-17489386ACA5"></a>
<h5 id="TGDBA-GUID-97121C67-75F3-4EDE-968D-17489386ACA5" class="sect5">Flushing the Server Result Cache</h5>
<div>
<div class="section">
<p>This section describes how to remove all existing results and purge the result cache memory using the <code>DBMS_RESULT_CACHE</code> package.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To flush the server result cache:</p>
<ul style="list-style-type: disc;">
<li>
<p>Execute the <code>DBMS_RESULT_CACHE</code>.<code>FLUSH</code> procedure.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-97121C67-75F3-4EDE-968D-17489386ACA5__GUID-1DF0A718-4244-4E43-967C-76C331D5E118">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS" target="_blank" href="../ARPLS/toc.htm"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_RESULT_CACHE</code> package</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<a id="TGDBA639"></a><a id="TGDBA638"></a>
<div class="props_rev_3"><a id="GUID-21CAA1E7-9E46-4442-9F3E-CE09EEF60D92"></a>
<h3 id="TGDBA-GUID-21CAA1E7-9E46-4442-9F3E-CE09EEF60D92" class="sect3">Configuring the Client Result Cache</h3>
<div>
<div class="section">
<p><a href="tune_result_cache.htm#GUID-21CAA1E7-9E46-4442-9F3E-CE09EEF60D92__CDEICADD" title="This table lists the database initialization parameters that enable or influence the behavior of the client result cache.">Table 15-2</a> lists the database initialization parameters that enable or influence the behavior of the client result cache.</p>
<div class="tblformal" id="GUID-21CAA1E7-9E46-4442-9F3E-CE09EEF60D92__CDEICADD">
<p class="titleintable">Table 15-2 Client Result Cache Initialization Parameters</p>
<table class="cellalignment11" title="Client Result Cache Initialization Parameters" summary="This table lists the database initialization parameters that enable or influence the behavior of the client result cache.">
<thead>
<tr class="cellalignment2">
<th class="cellalignment57" id="d39609e1046">Parameter</th>
<th class="cellalignment58" id="d39609e1049">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment59" id="d39609e1054" headers="d39609e1046">
<p><code>CLIENT_RESULT_CACHE_SIZE</code></p>
</td>
<td class="cellalignment60" headers="d39609e1054 d39609e1049">
<p>Specifies the maximum size of the client result cache for each client process. To enable the client result cache, set the size to 32768 bytes or greater. A lesser value, including the default of 0, disables the client result cache.</p>
<p><span class="bold">Note:</span> If the <code>CLIENT_RESULT_CACHE_SIZE</code> setting disables the client cache, then a client node cannot enable it. If the <code>CLIENT_RESULT_CACHE_SIZE</code> setting enables the client cache, however, then a client node can override the setting. For example, a client node can disable client result caching or increase the size of its cache.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment59" id="d39609e1072" headers="d39609e1046">
<p><code>CLIENT_RESULT_CACHE_LAG</code></p>
</td>
<td class="cellalignment60" headers="d39609e1072 d39609e1049">
<p>Specifies the amount of lag time (in milliseconds) for the client result cache. The default value is 3000 (3 seconds). If the OCI application does not perform any database calls for a period of time, then this setting forces the next statement execution call to check for validations.</p>
<p>If the OCI application accesses the database infrequently, then setting this parameter to a low value results in more round trips from the OCI client to the database to keep the client result cache synchronized with the database.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment59" id="d39609e1082" headers="d39609e1046">
<p><code>COMPATIBLE</code></p>
</td>
<td class="cellalignment60" headers="d39609e1082 d39609e1049">
<p>Specifies the release with which Oracle Database must maintain compatibility. For the client result cache to be enabled, this parameter must be set to 11.0.0.0 or higher. For client caching on views, this parameter must be set to 11.2.0.0.0 or higher.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>An optional client configuration file overrides client result cache initialization parameters set in the server parameter file.</p>
<div class="infobox-note" id="GUID-21CAA1E7-9E46-4442-9F3E-CE09EEF60D92__GUID-2C5081CC-DA08-4C97-904D-D755D47F93D3">
<p class="notep1">Note:</p>
<p>The client result cache lag can only be set with the <code>CLIENT_RESULT_CACHE_LAG</code> initialization parameter.</p>
</div>
<div class="infoboxnotealso" id="GUID-21CAA1E7-9E46-4442-9F3E-CE09EEF60D92__GUID-1FD83DFE-B42B-4B0F-BA70-91867BFA013C">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN" target="_blank" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about the client result cache initialization parameters</p>
</li>
<li>
<p><a class="olink LNOCI10103" target="_blank" href="../LNOCI/oci10new.htm#LNOCI10103"><span class="italic">Oracle Call Interface Programmer&#39;s Guide</span></a> for information about the parameters that can be set in the client configuration file</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGDBA641"></a><a id="TGDBA640"></a>
<div class="props_rev_3"><a id="GUID-D2FA7B29-301B-4AB8-8294-2B1B015899F9"></a>
<h3 id="TGDBA-GUID-D2FA7B29-301B-4AB8-8294-2B1B015899F9" class="sect3">Setting the Result Cache Mode</h3>
<div>
<div class="section">
<p>The result cache mode is a database setting that determines which queries are eligible to store result sets in the server and client result caches. If a query is eligible for caching, then the application checks the result cache to determine whether the query result set exists in the cache. If it exists, then the result is retrieved directly from the result cache. Otherwise, the database executes the query and returns the result as output and stores it in the result cache. Oracle recommends result caching for queries of read-only or read-mostly database objects.</p>
<p>When the result cache is enabled, the database also caches queries that call non-deterministic PL/SQL functions. When caching <code>SELECT</code> statements that call such functions, the result cache tracks data dependencies for the PL/SQL functions and the database objects. However, if the function uses data that are not being tracked (such as sequences, <code>SYSDATE</code>, <code>SYS_CONTEXT</code>, and package variables), using the result cache on queries that call this function can produce stale results. In this regard, the behavior of the result cache is identical to caching PL/SQL functions. Therefore, always consider data accuracy, as well as performance, when choosing to enable the result cache.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To set the result cache mode:</p>
<ul style="list-style-type: disc;">
<li>
<p>Set the value of the <a id="d39609e1172" class="indexterm-anchor"></a><code>RESULT_CACHE_MODE</code> initialization parameter to determine the behavior of the result cache.</p>
<p>You can set this parameter for the instance (<code>ALTER SYSTEM</code>), session (<code>ALTER SESSION</code>), or in the server parameter file.</p>
<p><a href="tune_result_cache.htm#GUID-D2FA7B29-301B-4AB8-8294-2B1B015899F9__CDEICIAI" title="This table lists the possible value for the RESULT_CACHE_MODE initialization parameter.">Table 15-3</a> describes the values for this parameter.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<div class="tblformal" id="GUID-D2FA7B29-301B-4AB8-8294-2B1B015899F9__CDEICIAI">
<p class="titleintable">Table 15-3 Values for the RESULT_CACHE_MODE Parameter</p>
<table class="cellalignment11" title="Values for the RESULT_CACHE_MODE Parameter" summary="This table lists the possible value for the RESULT_CACHE_MODE initialization parameter.">
<thead>
<tr class="cellalignment2">
<th class="cellalignment61" id="d39609e1204">Value</th>
<th class="cellalignment62" id="d39609e1207">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment63" id="d39609e1212" headers="d39609e1204">
<p><code>MANUAL</code></p>
</td>
<td class="cellalignment64" headers="d39609e1212 d39609e1207">
<p>Query results can only be stored in the result cache by using a query hint or table annotation. This is the default and recommended value.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment63" id="d39609e1220" headers="d39609e1204">
<p><code>FORCE</code></p>
</td>
<td class="cellalignment64" headers="d39609e1220 d39609e1207">
<p>All results are stored in the result cache. If a query result is not in the cache, then the database executes the query and stores the result in the cache. Subsequent executions of the same SQL statement, including the result cache hint, retrieve data from the cache. Sessions uses these results if possible. To exclude query results from the cache, the <code>/*+ NO_RESULT_CACHE */</code> query hint must be used.</p>
<p><span class="bold">Note:</span> <code>FORCE</code> mode is not recommended because the database and clients will attempt to cache all queries, which may create significant performance and latching overhead. Moreover, because queries that call non-deterministic PL/SQL functions are also cached, enabling the result cache in such a broad-based manner may cause material changes to the results.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-D2FA7B29-301B-4AB8-8294-2B1B015899F9__GUID-757476F9-D314-4852-A69D-F021F2C7D2F7">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN10270" target="_blank" href="../REFRN/GUID-DEC2BDE4-8CF4-4378-A04C-6EE50A0FA250.htm#REFRN10270"><span class="italic">Oracle Database Reference</span></a> for information about the <code>RESULT_CACHE_MODE</code> initialization parameter</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGDBA642"></a>
<div class="props_rev_3"><a id="GUID-7E0D0BAD-ACBA-451E-AB38-1EF981AC44ED"></a>
<h3 id="TGDBA-GUID-7E0D0BAD-ACBA-451E-AB38-1EF981AC44ED" class="sect3">Requirements for the Result Cache</h3>
<div>
<p>Enabling the result cache does not <span class="italic">guarantee</span> that a specific result set will be included in the server or client result cache. In order for results to be cached, the following requirements must be met:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-7D6142DF-69C5-4043-81B4-7CD90E0945E6">Read Consistency Requirements</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-E5652497-60D0-4F37-944C-208232735937">Query Parameter Requirements</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-A76DEAB3-AB92-4B1F-BF87-1B0016B6A93F">Restrictions for the Result Cache</a></p>
</li>
</ul>
</div>
<a id="TGDBA643"></a>
<div class="props_rev_3"><a id="GUID-7D6142DF-69C5-4043-81B4-7CD90E0945E6"></a>
<h4 id="TGDBA-GUID-7D6142DF-69C5-4043-81B4-7CD90E0945E6" class="sect4">Read Consistency Requirements</h4>
<div>
<p>For a snapshot to be reusable, it must have read consistency. For a result set to be eligible for caching, at least one of the following conditions must be true:</p>
<ul style="list-style-type: disc;">
<li>
<p>The read-consistent snapshot used to build the result must retrieve the most current, committed state of the data.</p>
</li>
<li>
<p>The query points to an explicit point in time using flashback query.</p>
</li>
</ul>
<p>If the current session has an active transaction referencing objects in a query, then the results from this query are not eligible for caching.</p>
</div>
</div>
<a id="TGDBA644"></a>
<div class="props_rev_3"><a id="GUID-E5652497-60D0-4F37-944C-208232735937"></a>
<h4 id="TGDBA-GUID-E5652497-60D0-4F37-944C-208232735937" class="sect4">Query Parameter Requirements</h4>
<div>
<p>Cache results can be reused if they are parameterized with variable values when queries are equivalent and the parameter values are the same. Different values or bind variable names may cause cache misses. Results are parameterized if any of the following constructs are used in the query:</p>
<ul style="list-style-type: disc;">
<li>
<p>Bind variables</p>
</li>
<li>
<p>The SQL functions <code>DBTIMEZONE</code>, <code>SESSIONTIMEZONE</code>, <code>USERENV/SYS_CONTEXT</code> (with constant variables), <code>UID</code>, and <code>USER</code></p>
</li>
<li>
<p>NLS parameters</p>
</li>
</ul>
</div>
</div>
<a id="TGDBA645"></a>
<div class="props_rev_3"><a id="GUID-A76DEAB3-AB92-4B1F-BF87-1B0016B6A93F"></a>
<h4 id="TGDBA-GUID-A76DEAB3-AB92-4B1F-BF87-1B0016B6A93F" class="sect4">Restrictions for the Result Cache</h4>
<div>
<p>Results cannot be cached when the following objects or functions are in a query:</p>
<ul style="list-style-type: disc;">
<li>
<p>Temporary tables and tables in the <code>SYS</code> or <code>SYSTEM</code> schemas</p>
</li>
<li>
<p>Sequence <code>CURRVAL</code> and <code>NEXTVAL</code> pseudo columns</p>
</li>
<li>
<p>SQL functions <code>CURRENT_DATE</code>, <code>CURRENT_TIMESTAMP</code>, <code>LOCAL_TIMESTAMP</code>, <code>USERENV/SYS_CONTEXT</code> (with non-constant variables), <code>SYS_GUID</code>, <code>SYSDATE</code>, and <code>SYS_TIMESTAMP</code></p>
</li>
</ul>
<p>The client result cache has additional restrictions for result caching.</p>
<div class="infoboxnotealso" id="GUID-A76DEAB3-AB92-4B1F-BF87-1B0016B6A93F__GUID-12D1FFA9-E3F3-4670-A8BD-5281AEEE44D9">
<p class="notep1">See Also:</p>
<p><a class="olink LNOCI10103" target="_blank" href="../LNOCI/oci10new.htm#LNOCI10103"><span class="italic">Oracle Call Interface Programmer&#39;s Guide</span></a> for information about additional restrictions for the client result cache</p>
</div>
</div>
</div>
</div>
</div>
<a id="TGDBA646"></a>
<div class="props_rev_3"><a id="GUID-93F518A7-1531-4CBB-8A0F-DE3248813A4C"></a>
<h2 id="TGDBA-GUID-93F518A7-1531-4CBB-8A0F-DE3248813A4C" class="sect2">Specifying Queries for Result Caching</h2>
<div>
<p>This section describes how to specify queries for result caching and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-443C9B44-738B-420F-B6D2-25EBBD950119">Using SQL Result Cache Hints</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-57DDBE23-9A6D-4556-AEF5-01D427BA716D">Using Result Cache Table Annotations</a></p>
</li>
</ul>
</div>
<a id="TGDBA647"></a>
<div class="props_rev_3"><a id="GUID-443C9B44-738B-420F-B6D2-25EBBD950119"></a>
<h3 id="TGDBA-GUID-443C9B44-738B-420F-B6D2-25EBBD950119" class="sect3">Using SQL Result Cache Hints</h3>
<div>
<p>Use result cache hints at the application level to control caching behavior. The SQL result cache hints take precedence over the result cache mode and result cache table annotations.</p>
<p>This section describes how to use SQL result cache hints and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-433B9410-AA0F-4E03-ACAD-D90DE73F1C85">Using the RESULT_CACHE Hint</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-A69E55B9-CDAE-429D-B45F-FDB71969C6F9">Using the NO_RESULT_CACHE Hint</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-8755E774-1152-4A9D-A3D0-7AFE12AB732F">Using the RESULT_CACHE Hint in Views</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-443C9B44-738B-420F-B6D2-25EBBD950119__GUID-BB9A63B8-CBC6-41AA-9AD0-8F859B673D10">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF20004" target="_blank" href="../SQLRF/sql_elements006.htm#SQLRF20004"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about the <code>RESULT_CACHE</code> and <code>NO_RESULT_CACHE</code> hints</p>
</div>
</div>
<a id="TGDBA649"></a><a id="TGDBA648"></a>
<div class="props_rev_3"><a id="GUID-433B9410-AA0F-4E03-ACAD-D90DE73F1C85"></a>
<h4 id="TGDBA-GUID-433B9410-AA0F-4E03-ACAD-D90DE73F1C85" class="sect4">Using the RESULT_CACHE Hint</h4>
<div>
<div class="section">
<p>When the result cache mode is <code>MANUAL</code>, the <code>/*+ RESULT_CACHE */</code> hint instructs the database to cache the results of a query block and to use the cached results in future executions.</p>
<p><a href="tune_result_cache.htm#GUID-433B9410-AA0F-4E03-ACAD-D90DE73F1C85__CDEIEGGF">Example 15-3</a> shows a query that uses the <code>RESULT_CACHE</code> hint.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-433B9410-AA0F-4E03-ACAD-D90DE73F1C85__CDEIEGGF">
<p class="titleinexample">Example 15-3 Using the RESULT_CACHE Hint</p>
<pre dir="ltr">SELECT /*+ RESULT_CACHE */ prod_id, SUM(amount_sold)
  FROM sales 
 GROUP BY prod_id
 ORDER BY prod_id;
</pre>
<p>In this example, the query instructs the database to cache rows for a query of the <code>sales</code> table.</p>
</div>
<!-- class="example" --></div>
</div>
<a id="TGDBA651"></a><a id="TGDBA650"></a>
<div class="props_rev_3"><a id="GUID-A69E55B9-CDAE-429D-B45F-FDB71969C6F9"></a>
<h4 id="TGDBA-GUID-A69E55B9-CDAE-429D-B45F-FDB71969C6F9" class="sect4">Using the NO_RESULT_CACHE Hint</h4>
<div>
<div class="section">
<p>The <code>/*+ NO_RESULT_CACHE */</code> hint instructs the database <span class="italic">not</span> to cache the results in either the server or client result caches.</p>
<p><a href="tune_result_cache.htm#GUID-A69E55B9-CDAE-429D-B45F-FDB71969C6F9__CDEIJICA">Example 15-4</a> shows a query that uses the <code>NO_RESULT_CACHE</code> hint.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-A69E55B9-CDAE-429D-B45F-FDB71969C6F9__CDEIJICA">
<p class="titleinexample">Example 15-4 Using the NO_RESULT_CACHE Hint</p>
<pre dir="ltr">SELECT /*+ NO_RESULT_CACHE */ prod_id, SUM(amount_sold) 
  FROM sales 
 GROUP BY prod_id
 ORDER BY prod_id;
</pre>
<p>In this example, the query instructs the database not to cache rows for a query of the <code>sales</code> table.</p>
</div>
<!-- class="example" --></div>
</div>
<a id="TGDBA653"></a><a id="TGDBA654"></a><a id="TGDBA652"></a>
<div class="props_rev_3"><a id="GUID-8755E774-1152-4A9D-A3D0-7AFE12AB732F"></a>
<h4 id="TGDBA-GUID-8755E774-1152-4A9D-A3D0-7AFE12AB732F" class="sect4">Using the RESULT_CACHE Hint in Views</h4>
<div>
<div class="section">
<p>The <code>RESULT_CACHE</code> hint applies only to the query block in which the hint is specified. If the hint is specified only in a view, then only these results are cached. View caching has the following characteristics:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The view must be one of the following types:</p>
<ul style="list-style-type: disc;">
<li>
<p>A standard view (a view created with the <code>CREATE ... VIEW</code> statement)</p>
</li>
<li>
<p>An inline view specified in the <code>FROM</code> clause of a <code>SELECT</code> statement</p>
</li>
<li>
<p>An inline view created with the <code>WITH</code> clause</p>
</li>
</ul>
</li>
<li>
<p>The result of a view query with a correlated column (a reference to an outer query block) cannot be cached.</p>
</li>
<li>
<p>Query results are stored in the server result cache, not the client result cache.</p>
</li>
<li>
<p>A caching view is not merged into its outer (or referring) query block.</p>
<p>Adding the <code>RESULT_CACHE</code> hint to inline views disables optimizations between the outer query and inline view to maximize reusability of the cached result.</p>
</li>
</ul>
<p>The following example shows a query of the inline view <code>view1</code>.</p>
<pre dir="ltr">SELECT *
  FROM ( SELECT /*+ RESULT_CACHE */ department_id, manager_id, count(*) count
           FROM hr.employees 
          GROUP BY department_id, manager_id ) view1
 WHERE department_id = 30;
</pre>
<p>In this example, the <code>SELECT</code> statement from <code>view1</code> is the outer block, whereas the <code>SELECT</code> statement from <code>employees</code> is the inner block. Because the <code>RESULT_CACHE</code> hint is specified only in the inner block, the results of the inner query are stored in the server result cache, but the results of the outer query are not cached.</p>
<p>Assume that the same session run a query of the view <code>view2</code> as shown in the following example.</p>
<pre dir="ltr">WITH view2 AS
( SELECT /*+ RESULT_CACHE */ department_id, manager_id, count(*) count
    FROM hr.employees 
   GROUP BY department_id, manager_id ) 
SELECT *
  FROM view2 
 WHERE count BETWEEN 1 and 5;
</pre>
<p>In this example, because the <code>RESULT_CACHE</code> hint is specified only in the query block in the <code>WITH</code> clause, the results of the <code>employees</code> query are eligible to be cached. Because these results are cached from the query in the first example, the <code>SELECT</code> statement in the <code>WITH</code> clause in the second example can retrieve the cached rows.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGDBA656"></a><a id="TGDBA655"></a>
<div class="props_rev_3"><a id="GUID-57DDBE23-9A6D-4556-AEF5-01D427BA716D"></a>
<h3 id="TGDBA-GUID-57DDBE23-9A6D-4556-AEF5-01D427BA716D" class="sect3">Using Result Cache Table Annotations</h3>
<div>
<p>You can also use table annotations to control result caching. Table annotations affect the entire query, not query segments. The primary benefit of using table annotations is avoiding the necessity of adding result cache hints to queries at the application level. Because a table annotation has a lower precedence than a SQL result cache hint, you can override table and session settings by using hints at the query level.</p>
<p><a href="tune_result_cache.htm#GUID-57DDBE23-9A6D-4556-AEF5-01D427BA716D__CDEJEFFD" title="This table lists the valid values for the RESULT_CACHE table annotation.">Table 15-4</a> describes the valid values for the <code>RESULT_CACHE</code> table annotation.</p>
<div class="tblformal" id="GUID-57DDBE23-9A6D-4556-AEF5-01D427BA716D__CDEJEFFD">
<p class="titleintable">Table 15-4 Values for the RESULT_CACHE Table Annotation</p>
<table class="cellalignment11" title="Values for the RESULT_CACHE Table Annotation" summary="This table lists the valid values for the RESULT_CACHE table annotation.">
<thead>
<tr class="cellalignment2">
<th class="cellalignment31" id="d39609e1923">Value</th>
<th class="cellalignment65" id="d39609e1926">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment34" id="d39609e1931" headers="d39609e1923">
<p><code>DEFAULT</code></p>
</td>
<td class="cellalignment66" headers="d39609e1931 d39609e1926">
<p>If at least one table in a query is set to <code>DEFAULT</code>, then result caching is <span class="italic">not</span> enabled at the table level for this query, unless if the <code>RESULT_CACHE_MODE</code> initialization parameter is set to <code>FORCE</code> or the <code>RESULT_CACHE</code> hint is specified. This is the default value.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment34" id="d39609e1954" headers="d39609e1923">
<p><code>FORCE</code></p>
</td>
<td class="cellalignment66" headers="d39609e1954 d39609e1926">
<p>If all the tables of a query are marked as <code>FORCE</code>, then the query result is considered for caching. The table annotation <code>FORCE</code> takes precedence over the <code>RESULT_CACHE_MODE</code> parameter value of <code>MANUAL</code> set at the session level.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>This section describes how to use the <code>RESULT_CACHE</code> table annotations and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tune_result_cache.htm#GUID-9FAEB29F-C63E-46D5-8C4B-9E4927F45616">Using the DEFAULT Table Annotation</a></p>
</li>
<li>
<p><a href="tune_result_cache.htm#GUID-ACE3ED57-357F-4186-98AE-AAFD7F512FA8">Using the FORCE Table Annotation</a></p>
</li>
</ul>
</div>
<a id="TGDBA658"></a><a id="TGDBA657"></a>
<div class="props_rev_3"><a id="GUID-9FAEB29F-C63E-46D5-8C4B-9E4927F45616"></a>
<h4 id="TGDBA-GUID-9FAEB29F-C63E-46D5-8C4B-9E4927F45616" class="sect4">Using the DEFAULT Table Annotation</h4>
<div>
<div class="section">
<p>The <code>DEFAULT</code> table annotation prevents the database from caching results at the table level.</p>
<p><a href="tune_result_cache.htm#GUID-9FAEB29F-C63E-46D5-8C4B-9E4927F45616__CDEEFHDD">Example 15-5</a> shows a <code>CREATE</code> <code>TABLE</code> statement that uses the <code>DEFAULT</code> table annotation to create a table <code>sales</code> and a query of this table.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-9FAEB29F-C63E-46D5-8C4B-9E4927F45616__CDEEFHDD">
<p class="titleinexample">Example 15-5 Using the DEFAULT Table Annotation</p>
<pre dir="ltr">CREATE TABLE sales (...) RESULT_CACHE (MODE DEFAULT);

SELECT prod_id, SUM(amount_sold)
  FROM sales 
 GROUP BY prod_id 
 ORDER BY prod_id;
</pre>
<p>In this example, the <code>sales</code> table is created with a table annotation that disables result caching. The example also shows a query of the <code>sales</code> table, whose results are not considered for caching because of the table annotation.</p>
<div class="infoboxnotealso" id="GUID-9FAEB29F-C63E-46D5-8C4B-9E4927F45616__GUID-9ABC114C-D755-4E2C-B153-CCB8B2F4C3C6">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF01402" target="_blank" href="../SQLRF/statements_7002.htm#SQLRF01402"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about the <code>CREATE</code> <code>TABLE</code> statement and its syntax</p>
</div>
</div>
<!-- class="example" --></div>
</div>
<a id="TGDBA660"></a><a id="TGDBA659"></a>
<div class="props_rev_3"><a id="GUID-ACE3ED57-357F-4186-98AE-AAFD7F512FA8"></a>
<h4 id="TGDBA-GUID-ACE3ED57-357F-4186-98AE-AAFD7F512FA8" class="sect4">Using the FORCE Table Annotation</h4>
<div>
<div class="section">
<p>The FORCE table annotation forces the database to cache results at the table level.</p>
<p>Using the <code>sales</code> table created in <a href="tune_result_cache.htm#GUID-9FAEB29F-C63E-46D5-8C4B-9E4927F45616__CDEEFHDD">Example 15-5</a>, assume that you decide to force result caching for this table, you can do so by using the <code>FORCE</code> table annotation.</p>
<p><a href="tune_result_cache.htm#GUID-ACE3ED57-357F-4186-98AE-AAFD7F512FA8__CDEDCICC">Example 15-6</a> shows an <code>ALTER</code> <code>TABLE</code> statement that uses the <code>FORCE</code> table annotation on the <code>sales</code> table.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-ACE3ED57-357F-4186-98AE-AAFD7F512FA8__CDEDCICC">
<p class="titleinexample">Example 15-6 Using the FORCE Table Annotation</p>
<pre dir="ltr">ALTER TABLE sales RESULT_CACHE (MODE FORCE);

SELECT prod_id, SUM(amount_sold)
  FROM sales 
 GROUP BY prod_id 
HAVING prod_id=136;

SELECT /*+ NO_RESULT_CACHE */ * 
  FROM sales
 ORDER BY time_id DESC;
</pre>
<p>This example includes two queries of the <code>sales</code> table. The first query, which is frequently used and returns few rows, is eligible for caching because of the table annotation. The second query, which is a one-time query that returns many rows, uses a hint to prevent result caching.</p>
</div>
<!-- class="example" --></div>
</div>
</div>
</div>
<a id="TGDBA662"></a><a id="TGDBA663"></a><a id="TGDBA664"></a><a id="TGDBA661"></a>
<div class="props_rev_3"><a id="GUID-F99D9B4F-FFFC-4C5B-BB17-96730F3C1820"></a>
<h2 id="TGDBA-GUID-F99D9B4F-FFFC-4C5B-BB17-96730F3C1820" class="sect2">Monitoring the Result Cache</h2>
<div>
<div class="section">
<p>To view information about the server and client result caches, query the relevant database views and tables.</p>
<p><a href="tune_result_cache.htm#GUID-F99D9B4F-FFFC-4C5B-BB17-96730F3C1820__CDECIHEI" title="This table lists the database views and tables that contain information about the result cache.">Table 15-5</a> describes the most useful views and tables for monitoring the result cache.</p>
<div class="tblformal" id="GUID-F99D9B4F-FFFC-4C5B-BB17-96730F3C1820__CDECIHEI">
<p class="titleintable">Table 15-5 Views and Tables with Information About the Result Cache</p>
<table class="cellalignment11" title="Views and Tables with Information About the Result Cache" summary="This table lists the database views and tables that contain information about the result cache.">
<thead>
<tr class="cellalignment2">
<th class="cellalignment67" id="d39609e2203">View/Table</th>
<th class="cellalignment68" id="d39609e2206">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment69" id="d39609e2211" headers="d39609e2203">
<p><code>V$RESULT_CACHE_STATISTICS</code></p>
</td>
<td class="cellalignment70" headers="d39609e2211 d39609e2206">
<p>Lists various server result cache settings and memory usage statistics.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment69" id="d39609e2219" headers="d39609e2203">
<p><code>V$RESULT_CACHE_MEMORY</code></p>
</td>
<td class="cellalignment70" headers="d39609e2219 d39609e2206">
<p>Lists all the memory blocks in the server result cache and their corresponding statistics.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment69" id="d39609e2227" headers="d39609e2203">
<p><code>V$RESULT_CACHE_OBJECTS</code></p>
</td>
<td class="cellalignment70" headers="d39609e2227 d39609e2206">
<p>Lists all the objects whose results are in the server result cache along with their attributes.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment69" id="d39609e2235" headers="d39609e2203">
<p><code>V$RESULT_CACHE_DEPENDENCY</code></p>
</td>
<td class="cellalignment70" headers="d39609e2235 d39609e2206">
<p>Lists the dependency details between the results in the server result cache and dependencies among these results.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment69" id="d39609e2243" headers="d39609e2203">
<p><code>CLIENT_RESULT_CACHE_STATS$</code></p>
</td>
<td class="cellalignment70" headers="d39609e2243 d39609e2206">
<p>Stores cache settings and memory usage statistics for the client result caches obtained from the OCI client processes. This statistics table contains entries for each client process that uses result caching. After the client processes terminate, the database removes their entries from this table. The client table contains information similar to <code>V$RESULT_CACHE_STATISTICS</code>.</p>
</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment69" id="d39609e2254" headers="d39609e2203">
<p><code>DBA_TABLES</code>, <code>USER_TABLES</code>, <code>ALL_TABLES</code></p>
</td>
<td class="cellalignment70" headers="d39609e2254 d39609e2206">
<p>Contains a <code>RESULT_CACHE</code> column that shows the result cache mode annotation for the table. If the table is not annotated, then this column shows <code>DEFAULT</code>. This column applies to both server and client result caches.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The following example shows a query of the <code>V$RESULT_CACHE_STATISTICS</code> view to monitor server result cache statistics.</p>
<pre dir="ltr">COLUMN name FORMAT a20
SELECT name, value
  FROM V$RESULT_CACHE_STATISTICS;
</pre>
<p>The output of this query might look like the following:</p>
<pre dir="ltr">NAME                          VALUE
--------------------     ----------
Block Size (Bytes)             1024
Block Count Maximum            3136
Block Count Current              32
Result Size Maximum (Blocks)    156
Create Count Success              2
Create Count Failure              0
Find Count                        0
Invalidation Count                0
Delete Count Invalid              0
Delete Count Valid                0
</pre>
<p>The following example shows a query of the <code>CLIENT_RESULT_CACHE_STATS$</code> table to monitor the client result cache statistics.</p>
<pre dir="ltr">SELECT stat_id, SUBSTR(name,1,20), value, cache_id
  FROM CLIENT_RESULT_CACHE_STATS$
 ORDER BY cache_id, stat_id;
</pre>
<p>The output of this query might look like the following:</p>
<pre dir="ltr">STAT_ID    NAME OF STATISTICS      VALUE   CACHE_ID
=======    ==================      =====   ========
    1      Block Size               256         124
    2      Block Count Max          256         124
    3      Block Count Current      128         124
    4      Hash Bucket Count       1024         124
    5      Create Count Success      10         124
    6      Create Count Failure       0         124
    7      Find Count                12         124
    8      Invalidation Count         8         124
    9      Delete Count Invalid       0         124
   10      Delete Count Valid         0         124
</pre>
<p>The <code>CLIENT_RESULT_CACHE_STATS$</code> table contains statistics entries for each active client process performing client result caching. Every client process has a unique cache ID.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To find the client connection information for the sessions performing client caching:</p>
<ol>
<li>
<p>Obtain the session IDs from the <code>CLIENT_REGID</code> column in the <code>GV$SESSION_CONNECT_INFO</code> view that corresponds to the <code>CACHE_ID</code> column in the <code>CLIENT_RESULT_CACHE_STATS$</code> table.</p>
</li>
<li>
<p>Query the relevant columns from the <code>GV$SESSION_CONNECT_INFO</code> and <code>GV$SESSION</code> views.</p>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p>For both server and client result cache statistics, a database that is optimized for result caching should show relatively low values for the <code>Create Count Failure</code> and <code>Delete Count Valid</code> statistics, while showing relatively high values for the <code>Find Count</code> statistic.</p>
<div class="infoboxnotealso" id="GUID-F99D9B4F-FFFC-4C5B-BB17-96730F3C1820__GUID-34A23D99-5B55-48AB-A811-797726BA5A2F">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN" target="_blank" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about these views and tables</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1">
<tr>
<td class="cellalignment8">
<table class="cellalignment6">
<tr>
<td class="cellalignment5"><a href="tune_shared_pool.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5"><a href="tune_pga.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment10">
<table class="cellalignment4">
<tr>
<td class="cellalignment5"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>