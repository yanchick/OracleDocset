<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-74003"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Direct%20Path%20Load%20Interface"></a><title>Direct Path Load Interface</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="The direct path loading functions are used to load data from external files into tables and partitions."/>
<meta name="keywords" content="direct path loading, handles, direct path context handle, direct path function context, direct path column array handle, direct path stream handle, functions, limitations, example, date cache, of date columns, OCI_ATTR_DIRPATH_DCACHE_SIZE, OCI_ATTR_DIRPATH_DCACHE_NUM, OCI_ATTR_DIRPATH_DCACHE_MISSES, OCI_ATTR_DIRPATH_DCACHE_HITS, OCI_ATTR_DIRPATH_DCACHE_DISABLE, nested table, direct path loading of, column objects, OCI_DIRPATH_COL_ERROR, REF columns, OCI_DIRPATH_EXPR_REF_TBLNAME, object tables, nonfinal object tables, in pieces, OCI_ATTR_DIRPATH_OBJ_CONSTR, direct path context attribute, OCI_ATTR_NAME, function context attribute, OCI_ATTR_DIRPATH_EXPR_TYPE, function context attribute, OCI_ATTR_DIRPATH_NO_INDEX_ERRORS, attribute, OCI_ATTR_NUM_COLS, direct path loading, OCI_ATTR_NUM_ROWS, column array attribute, OCI_ATTR_DIRPATH_SID, column array attribute, OCI_DIRPATH_OID column array attribute"/>
<meta name="dcterms.created" content="2017-06-09T09:07:30Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Call Interface Programmer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49886-11"/>
<meta name="dcterms.isVersionOf" content="LNOCI"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="oci12oty.htm" title="Previous" type="text/html"/>
<link rel="Next" href="oci14oca.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49886-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-596F5F9B-47A1-48DB-8702-FEED7BE038B9"></a> <span id="PAGE" style="display:none;">20/84</span> <!-- End Header -->
<a id="LNOCI120"></a>
<h1 id="LNOCI-GUID-596F5F9B-47A1-48DB-8702-FEED7BE038B9" class="sect1"><span class="enumeration_chapter">13</span> Direct Path Load Interface</h1>
<div>
<p>The direct path loading functions are used to load data from external files into tables and partitions.</p>
<p>This chapter contains these topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-5636C859-A1CD-4229-9CDF-0D477238AA05" title="Lists the external data types that are valid for scalar columns in a direct path load operation.A direct path load corresponds to a direct path array insert operation.Use the direct path function context handle to describe named type and REF columns: column objects, REF columns, and SQL string columns.Lists and describes the functions used with the direct path load interface.This section describes the direct path load examples for scalar columns.The date cache feature provides improved performance when loading Oracle date and time-stamp values that require data type conversions to be stored in the table.">Direct Path Loading Overview</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-DD759C3F-DE1C-4227-92F7-D744BC283590" title="The use of the direct path function contexts to load various nonscalar types is discussed in this section.">Direct Path Loading of Object Types</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-A2811AF9-FD71-49E7-9658-931C9C73B363" title="To support loading data that does not all fit in memory at one time, use loading in pieces.">Direct Path Loading in Pieces</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-E66F9F47-5465-481F-8CBE-E2B00194E102" title="The following discussion gives the supplemental details of the handles and attributes.">Direct Path Context Handles and Attributes for Object Types</a></p>
</li>
</ul>
</div>
<a id="LNOCI16908"></a><a id="LNOCI16907"></a>
<div class="props_rev_3"><a id="GUID-5636C859-A1CD-4229-9CDF-0D477238AA05"></a>
<h2 id="LNOCI-GUID-5636C859-A1CD-4229-9CDF-0D477238AA05" class="sect2">Direct Path Loading Overview</h2>
<div>
<p>The direct path load interface enables an OCI application to access the direct path load engine of Oracle Database to perform the functions of the SQL*Loader utility. This functionality provides the ability to load data from external files into either a table or a partition of a partitioned table.</p>
<p><a href="oci13obn.htm#GUID-5636C859-A1CD-4229-9CDF-0D477238AA05__CHDDEJBF">Figure 13-1</a> introduces the subject of this chapter. On the client side of the illustration, data enters a column array through an input buffer. The <a href="oci17msc004.htm#GUID-3A9445D3-EBE2-40DB-B303-F204CE065356">OCIDirPathColArrayToStream()</a> call moves the data to the server side through stream formats. These pass data to a column array that uses a block formatter to send the data to the database table.</p>
<div class="figure" id="GUID-5636C859-A1CD-4229-9CDF-0D477238AA05__CHDDEJBF">
<p class="titleinfigure">Figure 13-1 Direct Path Loading</p>
<img width="660" height="323" src="img/GUID-667D04ED-4935-489E-8C39-396148339177-default.gif" alt="Description of Figure 13-1 follows" title="Description of Figure 13-1 follows"/><br/>
<a href="img_text/GUID-667D04ED-4935-489E-8C39-396148339177-print.htm">Description of &#34;Figure 13-1 Direct Path Loading&#34;</a></div>
<!-- class="figure" -->
<p>The OCI direct path load interface can load multiple rows by loading a direct path stream that contains data for multiple rows.</p>
<p>To use the direct path API, the client application performs the following steps:</p>
<ol>
<li>
<p>Initialize OCI.</p>
</li>
<li>
<p>Allocate a direct path context handle and set the attributes.</p>
</li>
<li>
<p>Supply the name of the object (table, partition, or subpartition) to be loaded.</p>
</li>
<li>
<p>Describe the external data types of the columns of the object.</p>
</li>
<li>
<p>Prepare the direct path interface.</p>
</li>
<li>
<p>Allocate one or more column arrays.</p>
</li>
<li>
<p>Allocate one or more direct path streams.</p>
</li>
<li>
<p>Set entries in the column array to point to the input data value for each column.</p>
</li>
<li>
<p>Convert a column array to a direct path stream format.</p>
</li>
<li>
<p>Load the direct path stream.</p>
</li>
<li>
<p>Retrieve any errors that may have occurred.</p>
</li>
<li>
<p>Invoke the direct path finishing function.</p>
</li>
<li>
<p>Free handles and data structures.</p>
</li>
<li>
<p>Disconnect from the server.</p>
</li>
</ol>
<p>Steps 8 through 11 can be repeated many times, depending on the data to be loaded.</p>
<p>A direct load operation requires that the object being loaded is locked to prevent DML operations on the object. Note that queries are lock-free and are allowed while the object is being loaded. The mode of the DML lock, and which DML locks are obtained, depend upon the specification of the <a id="d145923e404" class="indexterm-anchor"></a><code class="codeph">OCI_ATTR_DIRPATH_PARALLEL</code> option, and if a partition or subpartition load is being done as opposed to an entire table load.</p>
<ul style="list-style-type: disc;">
<li>
<p>For a table load, if the <code class="codeph">OCI_ATTR_DIRPATH_PARALLEL</code> option is set to:</p>
<ul style="list-style-type: disc;">
<li>
<p>FALSE, then the table DML X-Lock is acquired</p>
</li>
<li>
<p>TRUE, then the table DML S-Lock is acquired</p>
</li>
</ul>
</li>
<li>
<p>For a partition load, if the <code class="codeph">OCI_ATTR_DIRPATH_PARALLEL</code> option is set to:</p>
<ul style="list-style-type: disc;">
<li>
<p>FALSE, then the table DML SX-Lock and partition DML X-Lock are acquired</p>
</li>
<li>
<p>TRUE, then the table DML SS-Lock and partition DML S-Lock are acquired</p>
</li>
</ul>
</li>
</ul>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-73F3D1BF-001E-4556-A7E5-17907873FCE8" title="Lists the external data types that are valid for scalar columns in a direct path load operation.">Data Types Supported for Direct Path Loading</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-87B6B60E-4EBA-4F25-A671-8E592998A781" title="A direct path load corresponds to a direct path array insert operation.">Direct Path Handles</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493" title="Lists and describes the functions used with the direct path load interface.">About Direct Path Interface Functions</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-E6D0C66F-5918-42C9-BB87-BED0A415F326">Limitations and Restrictions of the Direct Path Load Interface</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-C8D48A95-575A-46A4-86A9-A77274D94C82" title="This section describes the direct path load examples for scalar columns.">Direct Path Load Examples for Scalar Columns</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-E41A3E45-BE34-48B2-B8D0-49A04F86725D" title="The date cache feature provides improved performance when loading Oracle date and time-stamp values that require data type conversions to be stored in the table.">About Using a Date Cache in Direct Path Loading of Dates in OCI</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-5636C859-A1CD-4229-9CDF-0D477238AA05__GUID-8C20C27F-4DF1-455A-8AFF-C54A23BB5AF5">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="ociaahan.htm#GUID-07F0F31C-94FF-4E3B-B8E1-C2394CB94390">Direct Path Context Handle (OCIDirPathCtx) Attributes</a>&#34;</span></p>
</div>
</div>
<a id="LNOCI16909"></a>
<div class="props_rev_3"><a id="GUID-73F3D1BF-001E-4556-A7E5-17907873FCE8"></a>
<h3 id="LNOCI-GUID-73F3D1BF-001E-4556-A7E5-17907873FCE8" class="sect3">Data Types Supported for Direct Path Loading</h3>
<div>
<p>Lists the external data types that are valid for scalar columns in a direct path load operation.</p>
<p><a id="d145923e638" class="indexterm-anchor"></a><a id="d145923e642" class="indexterm-anchor"></a>The following external data types are valid for scalar columns in a direct path load operation:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">SQLT_CHR</code></p>
</li>
<li>
<p><code class="codeph">SQLT_DAT</code></p>
</li>
<li>
<p><code class="codeph">SQLT_INT</code></p>
</li>
<li>
<p><code class="codeph">SQLT_UIN</code></p>
</li>
<li>
<p><code class="codeph">SQLT_FLT</code></p>
</li>
<li>
<p><code class="codeph">SQLT_BIN</code></p>
</li>
<li>
<p><code class="codeph">SQLT_NUM</code></p>
</li>
<li>
<p><code class="codeph">SQLT_PDN</code></p>
</li>
<li>
<p><code class="codeph">SQLT_CLOB</code></p>
</li>
<li>
<p><code class="codeph">SQLT_BLOB</code></p>
</li>
<li>
<p><code class="codeph">SQLT_DATE</code></p>
</li>
<li>
<p><code class="codeph">SQLT_TIMESTAMP</code></p>
</li>
<li>
<p><code class="codeph">SQLT_TIMESTAMP_TZ</code></p>
</li>
<li>
<p><code class="codeph">SQLT_TIMESTAMP_LTZ</code></p>
</li>
<li>
<p><code class="codeph">SQLT_INTERVAL_YM</code></p>
</li>
<li>
<p><code class="codeph">SQLT_INTERVAL_DS</code></p>
</li>
</ul>
<p>The following external object data types are supported:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">SQLT_NTY</code> - column objects (<code class="codeph">FINAL</code> and <code class="codeph">NOT FINAL</code>) and SQL string columns</p>
</li>
<li>
<p><code class="codeph">SQLT_REF</code> - <code class="codeph">REF</code> columns (<code class="codeph">FINAL</code> and <code class="codeph">NOT FINAL</code>)</p>
</li>
</ul>
<p>The following table types are supported:</p>
<ul style="list-style-type: disc;">
<li>
<p>Nested tables</p>
</li>
<li>
<p>Object tables (<code class="codeph">FINAL</code> and <code class="codeph">NOT FINAL</code>)</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-73F3D1BF-001E-4556-A7E5-17907873FCE8__GUID-7F3D4E68-D21B-4AF9-976E-E7CD22CB6A5F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="ociaahan.htm#GUID-4F32F807-FA24-49D3-9ECB-B51212A12E26" title="Lists and describes direct path column parameter attributes.">About Accessing Column Parameter Attributes</a> for information on setting or retrieving the data type of a column</p>
</li>
<li>
<p><a href="oci03typ.htm#GUID-D69455D9-CE01-44CC-B5A9-E541C7774805__CEGIEEJI" title="This table has 4 columns. Column 1 is the external Oracle Database data type, column 2 is the data type code, and column 3 is the program variable type for C, and column 4 is the OCI-defined constant.">Table 3-2</a> for information about data types</p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16910"></a>
<div class="props_rev_3"><a id="GUID-87B6B60E-4EBA-4F25-A671-8E592998A781"></a>
<h3 id="LNOCI-GUID-87B6B60E-4EBA-4F25-A671-8E592998A781" class="sect3">Direct Path Handles</h3>
<div>
<p>A direct path load corresponds to a direct path array insert operation.</p>
<p>The direct path load interface uses the following handles to keep track of the objects loaded and the specification of the data operated on:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-845C453B-42D4-44BB-9EB2-03A42F782427">Direct Path Context</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-D50053C8-AAB1-4040-90C0-750281F7B242" title="Use the direct path function context handle to describe named type and REF columns: column objects, REF columns, and SQL string columns.">OCI Direct Path Function Context</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-B38DA3AB-4EDE-43B3-A434-99DAE0EAF62F">Direct Path Column Array and Direct Path Function Column Array</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-B613D75C-020C-4C65-968D-E6EF90A5ADBC">Direct Path Stream</a></p>
<div class="infoboxnotealso" id="GUID-87B6B60E-4EBA-4F25-A671-8E592998A781__GUID-CDB66B71-19B5-401A-9DC6-ED0EF9EF6E50">
<p class="notep1">See Also:</p>
<p><a href="ociaahan.htm#GUID-0097B016-DAD2-4AFA-9D3C-37689FA75B41" title="Lists and describes direct path loading handle attributes.">Direct Path Loading Handle Attributes</a> and all the descriptions of direct path attributes that follow</p>
</div>
</li>
</ul>
</div>
<a id="LNOCI72725"></a><a id="LNOCI16911"></a>
<div class="props_rev_3"><a id="GUID-845C453B-42D4-44BB-9EB2-03A42F782427"></a>
<h4 id="LNOCI-GUID-845C453B-42D4-44BB-9EB2-03A42F782427" class="sect4">Direct Path Context</h4>
<div>
<p>The direct path context handle must be allocated for each object, either a table or a partition of a partitioned table, being loaded. Because an <code class="codeph">OCIDirPathCtx</code> handle is the parent handle of the <code class="codeph">OCIDirPathFuncCtx</code>, <code class="codeph">OCIDirPathColArray,</code> and <code class="codeph">OCIDirPathStream</code> handles, freeing an <code class="codeph">OCIDirPathCtx</code> handle frees its child handles also (although for good coding practices, free child handles individually before you free the parent handle).</p>
<p>A direct path context is allocated with <a href="oci16rel002.htm#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a>. Note that the parent handle of a direct path context is always the environment handle. A direct path context is freed with <a href="oci16rel002.htm#GUID-E87E9F91-D3DC-4F35-BE7C-F1EFBFEEBA0A">OCIHandleFree()</a>. Include the header files in the first two lines in all direct path programs, as shown in <a href="oci13obn.htm#GUID-845C453B-42D4-44BB-9EB2-03A42F782427__CACIIBIB">Example 13-1</a>.</p>
<div class="example" id="GUID-845C453B-42D4-44BB-9EB2-03A42F782427__CACIIBIB">
<p class="titleinexample">Example 13-1 Direct Path Programs Must Include the Header Files</p>
<pre dir="ltr">...
#include &lt;cdemodp0.h&gt;
#include &lt;cdemodp.h&gt;

OCIEnv *envp;
OCIDirPathCtx *dpctx;
sword error;
error = OCIHandleAlloc((void  *)envp, (void  **)&amp;dpctx,
                    OCI_HTYPE_DIRPATH_CTX, (size_t)0,(void  **)0);
...
error = OCIHandleFree(dpctx, OCI_HTYPE_DIRPATH_CTX);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI72726"></a><a id="LNOCI16912"></a>
<div class="props_rev_3"><a id="GUID-D50053C8-AAB1-4040-90C0-750281F7B242"></a>
<h4 id="LNOCI-GUID-D50053C8-AAB1-4040-90C0-750281F7B242" class="sect4">OCI Direct Path Function Context</h4>
<div>
<p>Use the direct path function context handle to describe named type and <code class="codeph">REF</code> columns: column objects, REF columns, and SQL string columns.</p>
<p>The direct path function context handle, of type <code class="codeph">OCIDirPathFuncCtx</code>, is used to describe the following named type and <code class="codeph">REF</code> columns:</p>
<ul style="list-style-type: disc;">
<li>
<p>Column objects. The function context here describes the object type, which is to be used as the default constructor to construct the object, and the object attributes of the constructor.</p>
</li>
<li>
<p><code class="codeph">REF</code> columns. The function context here describes a single object table (optional) to reference row objects from, and the <code class="codeph">REF</code> arguments that identify each row object.</p>
</li>
<li>
<p>SQL string columns. The function context here describes a SQL string and its arguments to compute the value to be loaded into the column.</p>
</li>
</ul>
<p>The handle type <code class="codeph">OCI_HTYPE_DIRPATH_FN_CTX</code> is passed to <code class="codeph">OCIHandleAlloc()</code> to indicate that a function context is to be allocated, as shown in <a href="oci13obn.htm#GUID-D50053C8-AAB1-4040-90C0-750281F7B242__CACGFJGC">Example 13-2</a>.</p>
<p>Note that the parent handle of a direct path function context is always the direct path context handle. A direct path function context handle is freed with <code class="codeph">OCIHandleFree()</code>:</p>
<pre dir="ltr">error = OCIHandleFree(dpfnctx, OCI_HTYPE_DIRPATH_FN_CTX);
</pre>
<div class="example" id="GUID-D50053C8-AAB1-4040-90C0-750281F7B242__CACGFJGC">
<p class="titleinexample">Example 13-2 Passing the Handle Type to Allocate the Function Context</p>
<pre dir="ltr">OCIDirPathCtx *dpctx;       /* direct path context */
OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
sword error;

error = OCIHandleAlloc((void  *)dpctx, (void  **)&amp;dpfnctx,
                       OCI_HTYPE_DIRPATH_FN_CTX,
                       (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-D50053C8-AAB1-4040-90C0-750281F7B242__GUID-372F46CA-57CB-4C8B-899D-BCFF4C689B5C">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADOBJ7192" target="_blank" href="../ADOBJ/adobjenv.htm#ADOBJ7192"><span><cite>Oracle Database Object-Relational Developer&#39;s Guide</cite></span></a> for more information about the data types supported</p>
</li>
<li>
<p><a href="oci16rel002.htm#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a></p>
</li>
<li>
<p><a href="oci16rel002.htm#GUID-E87E9F91-D3DC-4F35-BE7C-F1EFBFEEBA0A">OCIHandleFree()</a></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI72727"></a><a id="LNOCI72728"></a><a id="LNOCI16913"></a>
<div class="props_rev_3"><a id="GUID-B38DA3AB-4EDE-43B3-A434-99DAE0EAF62F"></a>
<h4 id="LNOCI-GUID-B38DA3AB-4EDE-43B3-A434-99DAE0EAF62F" class="sect4">Direct Path Column Array and Direct Path Function Column Array</h4>
<div>
<p>The direct path column array handle and direct path function column handle are used to present an array of rows to the direct path interface. A row is represented by three arrays: column values, column lengths, and column flags. Methods used on a column array include: allocate the array handle and set or get values corresponding to an array entry.</p>
<p>Both handles share the same data structure, <code class="codeph">OCIDirPathColArray</code>, but these column array handles differ in parent handles and handle types.</p>
<p>A direct path column array handle is allocated with <a href="oci16rel002.htm#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a>. The code fragment in <a href="oci13obn.htm#GUID-B38DA3AB-4EDE-43B3-A434-99DAE0EAF62F__CACBICAG">Example 13-3</a> shows explicit allocation of the direct path column array handle.</p>
<p>A direct path column array handle is freed with <code class="codeph">OCIHandleFree()</code>.</p>
<pre dir="ltr">error = OCIHandleFree(dpca, OCI_HTYPE_DIRPATH_COLUMN_ARRAY);
</pre>
<p><a href="oci13obn.htm#GUID-B38DA3AB-4EDE-43B3-A434-99DAE0EAF62F__CACEDGCI">Example 13-4</a> shows that a direct path function column array handle is allocated in almost the same way.</p>
<p>A direct path function column array is freed with <code class="codeph">OCIHandleFree()</code>:</p>
<pre dir="ltr">error = OCIHandleFree(dpfnca, OCI_HTYPE_DIRPATH_FN_COL_ARRAY);
</pre>
<p>Freeing an <code class="codeph">OCIDirPathColArray</code> handle also frees the column array associated with the handle.</p>
<div class="example" id="GUID-B38DA3AB-4EDE-43B3-A434-99DAE0EAF62F__CACBICAG">
<p class="titleinexample">Example 13-3 Explicit Allocation of Direct Path Column Array Handle</p>
<pre dir="ltr">OCIDirPathCtx *dpctx;      /* direct path context */
OCIDirPathColArray *dpca;  /* direct path column array */
sword error;
error = OCIHandleAlloc((void  *)dpctx, (void  **)&amp;dpca,
               OCI_HTYPE_DIRPATH_COLUMN_ARRAY, 
               (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-B38DA3AB-4EDE-43B3-A434-99DAE0EAF62F__CACEDGCI">
<p class="titleinexample">Example 13-4 Explicit Allocation of Direct Path Function Column Array Handle</p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx;   /* direct path function context */
OCIDirPathColArray *dpfnca;   /* direct path function column array */
sword error;
error = OCIHandleAlloc((void  *)dpfnctx, (void  **)&amp;dpfnca,
                        (ub4)OCI_HTYPE_DIRPATH_FN_COL_ARRAY,
                        (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI72729"></a><a id="LNOCI16914"></a>
<div class="props_rev_3"><a id="GUID-B613D75C-020C-4C65-968D-E6EF90A5ADBC"></a>
<h4 id="LNOCI-GUID-B613D75C-020C-4C65-968D-E6EF90A5ADBC" class="sect4">Direct Path Stream</h4>
<div>
<p>The direct path stream handle is used by the conversion operation, <a href="oci17msc004.htm#GUID-3A9445D3-EBE2-40DB-B303-F204CE065356">OCIDirPathColArrayToStream()</a>, and by the load operation, <a href="oci17msc004.htm#GUID-309D9948-26C2-40F7-813D-ECDA2BF3D99C">OCIDirPathLoadStream()</a>.</p>
<p>Direct path stream handles are allocated by the client with <a href="oci16rel002.htm#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a>. The structure of an <code class="codeph">OCIDirPathStream</code> handle can be thought of as a pair in the form (buffer, buffer length).</p>
<p>A direct path stream is a linear representation of Oracle table data. The conversion operations always append to the end of the stream. Load operations always start from the beginning of the stream. After a stream is completely loaded, the stream must be reset by calling <a href="oci17msc004.htm#GUID-24744BD2-9B4B-411D-A9DB-CCAD82B335E3">OCIDirPathStreamReset()</a>.</p>
<p><a href="oci13obn.htm#GUID-B613D75C-020C-4C65-968D-E6EF90A5ADBC__CACGGEEA">Example 13-5</a> shows a direct path stream handle allocated with <a href="oci16rel002.htm#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a>. The parent handle is always an <code class="codeph">OCIDirPathCtx</code> handle.</p>
<p>A direct path stream handle is freed using <code class="codeph">OCIHandleFree()</code>.</p>
<pre dir="ltr">error = OCIHandleFree(dpstr, OCI_HTYPE_DIRPATH_STREAM);
</pre>
<p>Freeing an <code class="codeph">OCIDirPathStream</code> handle also frees the stream buffer associated with the handle.</p>
<div class="example" id="GUID-B613D75C-020C-4C65-968D-E6EF90A5ADBC__CACGGEEA">
<p class="titleinexample">Example 13-5 Allocating a Direct Path Stream Handle</p>
<pre dir="ltr">OCIDirPathCtx *dpctx;    /* direct path context */
OCIDirPathStream *dpstr; /* direct path stream */
sword error;
error = OCIHandleAlloc((void  *)dpctx, (void  **)&amp;dpstr,
               OCI_HTYPE_DIRPATH_STREAM, (size_t)0,(void  **)0);
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="LNOCI16916"></a><a id="LNOCI16917"></a><a id="LNOCI16915"></a>
<div class="props_rev_3"><a id="GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493"></a>
<h3 id="LNOCI-GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493" class="sect3">About Direct Path Interface Functions</h3>
<div>
<p>Lists and describes the functions used with the direct path load interface.</p>
<p>The functions listed in this section are used with the direct path load interface.</p>
<p>Operations on the direct path context are performed by the functions in <a href="oci13obn.htm#GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493__CACFGHAG" title="This table has 2 columns. Column 1 is the direct path context function name and column 2 describes its purpose.">Table 13-1</a>.</p>
<div class="tblformal" id="GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493__CACFGHAG">
<p class="titleintable">Table 13-1 Direct Path Context Functions</p>
<table class="cellalignment6175" title="Direct Path Context Functions" summary="This table has 2 columns. Column 1 is the direct path context function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6220" id="d145923e1980">Function</th>
<th class="cellalignment6217" id="d145923e1983">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d145923e1988" headers="d145923e1980">
<p><a href="oci17msc004.htm#GUID-18E9C795-0770-4793-A176-EF9C114ADD62">OCIDirPathAbort()</a></p>
</td>
<td class="cellalignment6219" headers="d145923e1988 d145923e1983">
<p>Terminates a direct path operation</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d145923e1997" headers="d145923e1980">
<p><a href="oci17msc004.htm#GUID-BAFCC070-7E97-4F77-8CF9-D78E05420FF2">OCIDirPathDataSave()</a></p>
</td>
<td class="cellalignment6219" headers="d145923e1997 d145923e1983">
<p>Executes a data savepoint</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d145923e2006" headers="d145923e1980">
<p><a href="oci17msc004.htm#GUID-EA1DCB4D-40FB-4B32-B001-14936A079C7E">OCIDirPathFinish()</a></p>
</td>
<td class="cellalignment6219" headers="d145923e2006 d145923e1983">
<p>Commits the loaded data</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d145923e2015" headers="d145923e1980">
<p><a href="oci17msc004.htm#GUID-4F459030-42F8-49D0-8EC8-6D2D9E63BC40">OCIDirPathFlushRow()</a></p>
</td>
<td class="cellalignment6219" headers="d145923e2015 d145923e1983">
<p>Flushes a partially loaded row from the server. This function is deprecated.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d145923e2024" headers="d145923e1980">
<p><a href="oci17msc004.htm#GUID-309D9948-26C2-40F7-813D-ECDA2BF3D99C">OCIDirPathLoadStream()</a></p>
</td>
<td class="cellalignment6219" headers="d145923e2024 d145923e1983">
<p>Loads the data that has been converted to direct path stream format</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d145923e2033" headers="d145923e1980">
<p><a href="oci17msc004.htm#GUID-8EE17BD0-02A9-4065-B501-CAF087BA4317">OCIDirPathPrepare()</a></p>
</td>
<td class="cellalignment6219" headers="d145923e2033 d145923e1983">
<p>Prepares the direct path interface to convert or load rows</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Operations on the direct path column array are performed by the functions in <a href="oci13obn.htm#GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493__G434329" title="This table has 2 columns. Column 1 is the direct path column array function name and column 2 describes its purpose.">Table 13-2</a>.</p>
<div class="tblformal" id="GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493__G434329">
<p class="titleintable">Table 13-2 Direct Path Column Array Functions</p>
<table class="cellalignment6175" title="Direct Path Column Array Functions" summary="This table has 2 columns. Column 1 is the direct path column array function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6188" id="d145923e2058">Function</th>
<th class="cellalignment6239" id="d145923e2061">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6191" id="d145923e2066" headers="d145923e2058">
<p><a href="oci17msc004.htm#GUID-12EE690E-3987-400E-B069-17D9F5ABEB7F">OCIDirPathColArrayEntryGet()</a></p>
</td>
<td class="cellalignment6240" headers="d145923e2066 d145923e2061">
<p>Gets a specified entry in a column array</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6191" id="d145923e2075" headers="d145923e2058">
<p><a href="oci17msc004.htm#GUID-4E4E74F4-3F15-4176-8229-C5783DC3811D">OCIDirPathColArrayEntrySet()</a></p>
</td>
<td class="cellalignment6240" headers="d145923e2075 d145923e2061">
<p>Sets a specified entry in a column array to a specific value</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6191" id="d145923e2084" headers="d145923e2058">
<p><a href="oci17msc004.htm#GUID-CBFB73B8-2DDE-45A5-8C4F-EED73BFAA432">OCIDirPathColArrayRowGet()</a></p>
</td>
<td class="cellalignment6240" headers="d145923e2084 d145923e2061">
<p>Gets the base row pointers for a specified row number</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6191" id="d145923e2093" headers="d145923e2058">
<p><a href="oci17msc004.htm#GUID-AFFEAFE6-CFC6-4D77-ABB3-5F7C005F2519">OCIDirPathColArrayReset()</a></p>
</td>
<td class="cellalignment6240" headers="d145923e2093 d145923e2061">
<p>Resets the row array state</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6191" id="d145923e2102" headers="d145923e2058">
<p><a href="oci17msc004.htm#GUID-3A9445D3-EBE2-40DB-B303-F204CE065356">OCIDirPathColArrayToStream()</a></p>
</td>
<td class="cellalignment6240" headers="d145923e2102 d145923e2061">
<p>Converts from a column array format to a direct path stream format</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Operations on the direct path stream are performed by the function <a href="oci17msc004.htm#GUID-24744BD2-9B4B-411D-A9DB-CCAD82B335E3">OCIDirPathStreamReset()</a> that resets the direct stream state.</p>
<div class="infoboxnotealso" id="GUID-F4DD008E-B9C0-42B2-9E61-19CD1C022493__GUID-985EC478-FA83-4349-AF1F-1EDAEEB944E1">
<p class="notep1">See Also:</p>
<p><a href="oci17msc004.htm#GUID-47DC91B9-305F-4649-AC1C-D01F09F3067C">Direct Path Loading Functions</a> for detailed descriptions of each function</p>
</div>
</div>
</div>
<a id="LNOCI16918"></a>
<div class="props_rev_3"><a id="GUID-E6D0C66F-5918-42C9-BB87-BED0A415F326"></a>
<h3 id="LNOCI-GUID-E6D0C66F-5918-42C9-BB87-BED0A415F326" class="sect3">Limitations and Restrictions of the Direct Path Load Interface</h3>
<div>
<p>The direct path load interface has the following limitations that are the same as SQL*Loader:</p>
<ul style="list-style-type: disc;">
<li>
<p>Triggers are not supported.</p>
</li>
<li>
<p>Referential integrity constraints are not supported.</p>
</li>
<li>
<p>Clustered tables are not supported.</p>
</li>
<li>
<p>Loading of remote objects is not supported.</p>
</li>
<li>
<p><code class="codeph">LONGs</code> must be specified last.</p>
</li>
<li>
<p>SQL strings that return LOBs, objects, or collections are not supported.</p>
</li>
<li>
<p>Loading of <code class="codeph">VARRAY</code> columns is not supported.</p>
</li>
<li>
<p>All partitioning columns must come before any LOBs. This is because you must determine what partition the LOB goes into before you start writing to it.</p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16919"></a>
<div class="props_rev_3"><a id="GUID-C8D48A95-575A-46A4-86A9-A77274D94C82"></a>
<h3 id="LNOCI-GUID-C8D48A95-575A-46A4-86A9-A77274D94C82" class="sect3">Direct Path Load Examples for Scalar Columns</h3>
<div>
<p>This section describes the direct path load examples for scalar columns.</p>
<div class="p">This is described in the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-5D0D980B-F171-43E4-9092-DB08EC38F500">Data Structures Used in Direct Path Loading Example</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E">Outline of an Example of a Direct Path Load for Scalar Columns</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI72730"></a><a id="LNOCI72731"></a><a id="LNOCI16920"></a>
<div class="props_rev_3"><a id="GUID-5D0D980B-F171-43E4-9092-DB08EC38F500"></a>
<h4 id="LNOCI-GUID-5D0D980B-F171-43E4-9092-DB08EC38F500" class="sect4">Data Structures Used in Direct Path Loading Example</h4>
<div>
<p><a href="oci13obn.htm#GUID-5D0D980B-F171-43E4-9092-DB08EC38F500__CACBDCEE">Example 13-6</a> shows the data structure used in <a href="oci13obn.htm#GUID-5D0D980B-F171-43E4-9092-DB08EC38F500__CACBEJCG">Example 13-7</a> through <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACDGHIB">Example 13-17</a>.</p>
<p><a href="oci13obn.htm#GUID-5D0D980B-F171-43E4-9092-DB08EC38F500__CACBEJCG">Example 13-7</a> shows the header file <code class="codeph">cdemodp.h</code> from the <code class="codeph">demo</code> directory, which defines several structs.</p>
<div class="example" id="GUID-5D0D980B-F171-43E4-9092-DB08EC38F500__CACBDCEE">
<p class="titleinexample">Example 13-6 Data Structures Used in Direct Path Loading Examples</p>
<pre dir="ltr">/* load control structure */
struct loadctl
{
  ub4                 nrow_ctl;            /* number of rows in column array */
  ub2                 ncol_ctl;         /* number of columns in column array */
  OCIEnv             *envhp_ctl;                       /* environment handle */
  OCIServer          *srvhp_ctl;                            /* server handle */
  OCIError           *errhp_ctl;                             /* error handle */
  OCIError           *errhp2_ctl;                /* yet another error handle */
  OCISvcCtx          *svchp_ctl;                          /* service context */
  OCISession         *authp_ctl;                   /* authentication context */
  OCIParam           *colLstDesc_ctl;        /* column list parameter handle */
  OCIDirPathCtx      *dpctx_ctl;                      /* direct path context */
  OCIDirPathColArray *dpca_ctl;           /* direct path column array handle */
  OCIDirPathColArray *dpobjca_ctl;          /* dp column array handle for obj*/
  OCIDirPathColArray *dpnestedobjca_ctl;  /* dp col array hndl for nested obj*/
  OCIDirPathStream   *dpstr_ctl;                /* direct path stream handle */
  ub1                *buf_ctl;    /* pre-alloc&#39;d buffer for out-of-line data */
  ub4                 bufsz_ctl;                 /* size of buf_ctl in bytes */
  ub4                 bufoff_ctl;                     /* offset into buf_ctl */
  ub4                *otor_ctl;                  /* Offset to Recnum mapping */
  ub1                *inbuf_ctl;                 /* buffer for input records */
  struct pctx         pctx_ctl;                     /* partial field context */
  boolean             loadobjcol_ctl;             /* load to obj col(s)? T/F */
};
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-5D0D980B-F171-43E4-9092-DB08EC38F500__CACBEJCG">
<p class="titleinexample">Example 13-7 Contents of the Header File cdemodp.h</p>
<pre dir="ltr">#ifndef cdemodp_ORACLE
# define cdemodp_ORACLE

# include &lt;oratypes.h&gt;

# ifndef externdef
#  define externdef
# endif

/* External column attributes */
struct col
{
  text *name_col;                                             /* column name */
  ub2   id_col;                                            /* column load ID */
  ub2   exttyp_col;                                         /* external type */
  text *datemask_col;                             /* datemask, if applicable */
  ub1   prec_col;                                /* precision, if applicable */
  sb1   scale_col;                                   /* scale, if applicable */
  ub2   csid_col;                                        /* character set ID */
  ub1   date_col;            /* is column a chrdate or date? 1=TRUE. 0=FALSE */
  struct obj * obj_col;          /* description of object, if applicable */
#define COL_OID 0x1                                         /* col is an OID */
  ub4   flag_col;
};

/* Input field descriptor
 * For this example (and simplicity),
 * fields are strictly positional.
 */
struct fld
{
  ub4  begpos_fld;                             /* 1-based beginning position */
  ub4  endpos_fld;                             /* 1-based ending    position */
  ub4  maxlen_fld;                       /* max length for out-of-line field */
  ub4    flag_fld;
#define FLD_INLINE            0x1
#define FLD_OUTOFLINE         0x2
#define FLD_STRIP_LEAD_BLANK  0x4
#define FLD_STRIP_TRAIL_BLANK 0x8
};

struct obj
{
  text               *name_obj;                                /* type  name*/
  ub2                 ncol_obj;              /* number of columns in col_obj*/
  struct col         *col_obj;                          /* column attributes*/
  struct fld         *fld_obj;                           /* field descriptor*/
  ub4                 rowoff_obj;  /* current row offset in the column array*/
  ub4                 nrows_obj;              /* number of rows in col array*/
  OCIDirPathFuncCtx  *ctx_obj;       /* Function context for this obj column*/
  OCIDirPathColArray *ca_obj;           /* column array  for this obj column*/
  ub4                 flag_obj;                              /* type of obj */
#define OBJ_OBJ  0x1                                             /* obj col */
#define OBJ_OPQ  0x2                                  /* opaque/sql str col */
#define OBJ_REF  0x4                                             /* ref col */
};

struct tbl
{
  text        *owner_tbl;                                     /* table owner */
  text        *name_tbl;                                       /* table name */
  text        *subname_tbl;                        /* subname, if applicable */
  ub2          ncol_tbl;                     /* number of columns in col_tbl */
  text        *dfltdatemask_tbl;            /* table level default date mask */
  struct col  *col_tbl;                                 /* column attributes */
  struct fld  *fld_tbl;                                  /* field descriptor */
  ub1          parallel_tbl;                         /* parallel: 1 for true */
  ub1          nolog_tbl;                          /* no logging: 1 for true */
  ub4          xfrsz_tbl;                   /* transfer buffer size in bytes */
  text         *objconstr_tbl;   /* obj constr/type if loading a derived obj */
};

struct sess                        /* options for a direct path load session */
{
  text        *username_sess;                                        /* user */
  text        *password_sess;                                    /* password */
  text        *inst_sess;                            /* remote instance name */
  text        *outfn_sess;                                /* output filename */
  ub4          maxreclen_sess;          /* max size of input record in bytes */
};
#endif                                              /* cdemodp_ORACLE */
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI72733"></a><a id="LNOCI72735"></a><a id="LNOCI72737"></a><a id="LNOCI72739"></a><a id="LNOCI72741"></a><a id="LNOCI72743"></a><a id="LNOCI72745"></a><a id="LNOCI72747"></a><a id="LNOCI72749"></a><a id="LNOCI72732"></a><a id="LNOCI72734"></a><a id="LNOCI72736"></a><a id="LNOCI72738"></a><a id="LNOCI72740"></a><a id="LNOCI72742"></a><a id="LNOCI72744"></a><a id="LNOCI72746"></a><a id="LNOCI72748"></a><a id="LNOCI72750"></a><a id="LNOCI16921"></a>
<div class="props_rev_3"><a id="GUID-044CA338-D429-4657-8D90-FC8C521D777E"></a>
<h4 id="LNOCI-GUID-044CA338-D429-4657-8D90-FC8C521D777E" class="sect4">Outline of an Example of a Direct Path Load for Scalar Columns</h4>
<div>
<div class="section">
<p><a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACHIHDD">Example 13-8</a> shows sample code that illustrates the use of several of the OCI direct path interfaces. It is not a complete code example.</p>
<p>The <span class="italic">init_load</span> function performs a direct path load using the direct path API on the table described by <span class="italic">tblp</span>. The <span class="italic">loadctl</span> structure given by <span class="italic">ctlp</span> has an appropriately initialized environment and service context. A connection has been made to the server.</p>
<p>Additional attributes, such as <code class="codeph">OCI_ATTR_SUB_NAME</code> and <code class="codeph">OCI_ATTR_SCHEMA_NAME</code>, are also set here. After the attributes have been set, prepare the load.</p>
<pre dir="ltr">  OCI_CHECK(ctlp-&gt;errhp_ctl, OCI_HTYPE_ERROR, ociret, ctlp,
            OCIDirPathPrepare(dpctx, ctlp-&gt;svchp_ctl, ctlp-&gt;errhp_ctl));
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Allocate the Column Array and Stream Handles</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Note that the direct path context handle is the parent handle for the column array and stream handles, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACIBGCE">Example 13-9</a>. Also note that errors are returned with the environment handle associated with the direct path context.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Get the Number of Rows and Columns</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Get the number of rows and columns in the column array just allocated, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACEDHIG">Example 13-10</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Set the Input Data Fields</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Set the input data fields to their corresponding data columns, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACEEJGJ">Example 13-11</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Reset the Column Array State</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Reset the column array state in case a previous conversion must be continued or a row is expecting more data, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACGHJED">Example 13-12</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Reset the Stream State</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Reset the stream state to start a new stream, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACJCJHC">Example 13-13</a>. Otherwise, data in the stream is appended to existing data.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Convert the Data in the Column Array to Stream Format</p>
</div>
<!-- class="section" -->
<div class="section">
<p>After inputting the data, convert the data in the column array to stream format and filter out any bad records, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACIIBGH">Example 13-14</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Load the Stream</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Note that the position in the stream is maintained internally to the stream handle, along with offset information for the column array that produced the stream. When the conversion to stream format is done, the data is appended to the stream, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACGJIHI">Example 13-15</a>. It is the responsibility of the caller to reset the stream when appropriate. On errors, the position is moved to the next row, or to the end of the stream if the error occurs on the last row. The next <a href="oci17msc004.htm#GUID-309D9948-26C2-40F7-813D-ECDA2BF3D99C">OCIDirPathLoadStream()</a> call starts on the next row, if any. If an <code class="codeph">OCIDirPathLoadStream()</code> call is made and the end of a stream has been reached, <code class="codeph">OCI_NO_DATA</code> is returned.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Finish the Direct Path Load</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Finish the direct path load as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACHAHGB">Example 13-16</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Free the Direct Path Handles</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Free all the direct path handles allocated, as shown in <a href="oci13obn.htm#GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACDGHIB">Example 13-17</a>. Note that the direct path column array and stream handles are freed before the parent direct path context handle is freed.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACHIHDD">
<p class="titleinexample">Example 13-8 Use of OCI Direct Path Interfaces</p>
<pre dir="ltr">STATICF void
init_load(ctlp, tblp)
struct loadctl *ctlp;
struct tbl     *tblp;
{
  struct  col   *colp;
  struct  fld   *fldp;
  sword          ociret;                       /* return code from OCI calls */
  OCIDirPathCtx *dpctx;                               /* direct path context */
  OCIParam      *colDesc;                     /* column parameter descriptor */
  ub1            parmtyp;
  ub1           *timestamp = (ub1 *)0;
  ub4            size;
  ub4            i;
  ub4            pos;

  /* allocate and initialize a direct path context */
  /* See cdemodp.c for the definition of OCI_CHECK */
  OCI_CHECK(ctlp-&gt;envhp_ctl, OCI_HTYPE_ENV, ociret, ctlp,
            OCIHandleAlloc((void  *)ctlp-&gt;envhp_ctl,
                           (void  **)&amp;ctlp-&gt;dpctx_ctl,
                           (ub4)OCI_HTYPE_DIRPATH_CTX,
                           (size_t)0, (void  **)0));

  dpctx = ctlp-&gt;dpctx_ctl;                                      /* shorthand */

  OCI_CHECK(ctlp-&gt;errhp_ctl, OCI_HTYPE_ERROR, ociret, ctlp,
            OCIAttrSet((void  *)dpctx, (ub4)OCI_HTYPE_DIRPATH_CTX,
                       (void  *)tblp-&gt;name_tbl,
                       (ub4)strlen((const char *)tblp-&gt;name_tbl),
                       (ub4)OCI_ATTR_NAME, ctlp-&gt;errhp_ctl));
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACIBGCE">
<p class="titleinexample">Example 13-9 Allocating the Column Array and Stream Handles</p>
<pre dir="ltr">   OCI_CHECK(ctlp-&gt;envhp_ctl, OCI_HTYPE_ENV, ociret, ctlp,
            OCIHandleAlloc((void  *)ctlp-&gt;dpctx_ctl, (void  **)&amp;ctlp-&gt;dpca_ctl,
                           (ub4)OCI_HTYPE_DIRPATH_COLUMN_ARRAY,
                           (size_t)0, (void  **)0));

  OCI_CHECK(ctlp-&gt;envhp_ctl, OCI_HTYPE_ENV, ociret, ctlp,
            OCIHandleAlloc((void  *)ctlp-&gt;dpctx_ctl,(void  **)&amp;ctlp-&gt;dpstr_ctl,
                           (ub4)OCI_HTYPE_DIRPATH_STREAM,
                           (size_t)0, (void  **)0));
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACEDHIG">
<p class="titleinexample">Example 13-10 Getting the Number of Rows and Columns</p>
<pre dir="ltr">  OCI_CHECK(ctlp-&gt;errhp_ctl, OCI_HTYPE_ERROR, ociret, ctlp,
            OCIAttrGet(ctlp-&gt;dpca_ctl, (ub4)OCI_HTYPE_DIRPATH_COLUMN_ARRAY,
                       &amp;ctlp-&gt;nrow_ctl, 0, OCI_ATTR_NUM_ROWS,
                       ctlp-&gt;errhp_ctl));

   OCI_CHECK(ctlp-&gt;errhp_ctl, OCI_HTYPE_ERROR, ociret, ctlp,
            OCIAttrGet(ctlp-&gt;dpca_ctl, (ub4)OCI_HTYPE_DIRPATH_COLUMN_ARRAY,
                       &amp;ctlp-&gt;ncol_ctl, 0, OCI_ATTR_NUM_COLS,
                       ctlp-&gt;errhp_ctl));
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACEEJGJ">
<p class="titleinexample">Example 13-11 Setting Input Data Fields</p>
<pre dir="ltr">ub4            rowoff;                          /* column array row offset */
ub4            clen;                                      /* column length */
ub1            cflg;                                  /* column state flag */
ub1           *cval;                             /* column character value */

OCI_CHECK(ctlp-&gt;errhp_ctl, OCI_HTYPE_ERROR, ociret, ctlp,
            OCIDirPathColArrayEntrySet(ctlp-&gt;dpca_ctl, ctlp-&gt;errhp_ctl,
                                       rowoff, colp-&gt;id_col,
                                       cval, clen, cflg));
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACGHJED">
<p class="titleinexample">Example 13-12 Resetting the Column Array State</p>
<pre dir="ltr">(void) OCIDirPathColArrayReset(ctlp-&gt;dpca_ctl, ctlp-&gt;errhp_ctl);
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACJCJHC">
<p class="titleinexample">Example 13-13 Resetting the Stream State</p>
<pre dir="ltr">(void) OCIDirPathStreamReset(ctlp-&gt;dpstr_ctl, ctlp-&gt;errhp_ctl);
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACIIBGH">
<p class="titleinexample">Example 13-14 Converting Data to Stream Format</p>
<pre dir="ltr">ub4            rowcnt;                   /* number of rows in column array */
ub4            startoff;         /* starting row offset into column array  */

/* convert array to stream, filter out bad records */
ocierr = OCIDirPathColArrayToStream(ctlp-&gt;dpca_ctl, ctlp-&gt;dpctx_ctl,
                                        ctlp-&gt;dpstr_ctl, ctlp-&gt;errhp_ctl,
                                        rowcnt, startoff);
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACGJIHI">
<p class="titleinexample">Example 13-15 Loading the Stream</p>
<pre dir="ltr">/* load the stream */
ociret = OCIDirPathLoadStream(ctlp-&gt;dpctx_ctl, ctlp-&gt;dpstr_ctl,
            ctlp-&gt;errhp_ctl);
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACHAHGB">
<p class="titleinexample">Example 13-16 Finishing the Direct Path Load Operation</p>
<pre dir="ltr">/* finish the direct path load operation */
OCI_CHECK(ctlp-&gt;errhp_ctl, OCI_HTYPE_ERROR, ociret, ctlp,
          OCIDirPathFinish(ctlp-&gt;dpctx_ctl, ctlp-&gt;errhp_ctl));
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-044CA338-D429-4657-8D90-FC8C521D777E__CACDGHIB">
<p class="titleinexample">Example 13-17 Freeing the Direct Path Handles</p>
<pre dir="ltr">/* free up server data structures for the load */
ociret = OCIHandleFree((void  *)ctlp-&gt;dpca_ctl,
                           OCI_HTYPE_DIRPATH_COLUMN_ARRAY);
ociret = OCIHandleFree((void  *)ctlp-&gt;dpstr_ctl,
                           OCI_HTYPE_DIRPATH_STREAM);
ociret = OCIHandleFree((void  *)ctlp-&gt;dpctx_ctl, 
                          OCI_HTYPE_DIRPATH_CTX);
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="LNOCI16931"></a>
<div class="props_rev_3"><a id="GUID-E41A3E45-BE34-48B2-B8D0-49A04F86725D"></a>
<h3 id="LNOCI-GUID-E41A3E45-BE34-48B2-B8D0-49A04F86725D" class="sect3">About Using a Date Cache in Direct Path Loading of Dates in OCI</h3>
<div>
<p>The <span class="italic">date cache</span> feature provides improved performance when loading Oracle date and time-stamp values that require data type conversions to be stored in the table.</p>
<p>For more information about using this feature in direct path loading, see <a class="olink SUTIL1327" target="_blank" href="../SUTIL/GUID-B1815406-BBA4-4769-AFFE-E1FCBA10779F.htm#SUTIL1327"><span><cite>Oracle Database Utilities</cite></span></a>.</p>
<p>This feature is specifically targeted to direct path loads where the same input date or timestamp values are being loaded over and over again. Date conversions are very expensive and can account for a large percentage of the total load time, especially if multiple date columns are being loaded. The date cache feature can significantly improve performance by reducing the actual number of date conversions done when many duplicate date values occur in the input data. However, date cache only improves performance when many duplicate input date values are being loaded into date columns (the word <span class="italic">date</span> in this chapter applies to all the date and time-stamp data types).</p>
<p>The date cache is enabled by default. When you explicitly specify the date cache size, the date cache feature is not disabled, by default. To override this behavior, set <code class="codeph">OCI_ATTR_DIRPATH_DCACHE_DISABLE</code> to 1. Otherwise, the cache continues to be searched to avoid date conversions. However, any misses (entries for which there are no duplicate values) are converted the usual way using expensive date conversion functions without the benefit of using the date cache feature.</p>
<p>Query the attributes <code class="codeph">OCI_ATTR_DIRPATH_DCACHE_NUM</code>, <code class="codeph">OCI_ATTR_DIRPATH_DCACHE_MISSES</code>, and <code class="codeph">OCI_ATTR_DIRPATH_DCACHE_HITS</code> and then tune the cache size for future loads.</p>
<p>You can lower the cache size when there are no misses and the number of elements in the cache is less than the cache size. The cache size can be increased if there are many cache misses and relatively few hits (entries for which there are duplicate values). Excessive date cache misses, however, can cause the application to run slower than not using the date cache at all. Note that increasing the cache size too much can cause other problems, like paging or exhausting memory. If increasing the cache size does not improve performance, the feature should not be used.</p>
<p>The date cache feature can be explicitly and totally disabled by setting the date cache size to 0.</p>
<div class="p">The following OCI direct path context attributes support this functionality:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-F4343F83-F22E-4B69-B900-B1445CD0432D">OCI_ATTR_DIRPATH_DCACHE_SIZE</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-44914454-D7F9-46EE-A837-8F42475C5AFA">OCI_ATTR_DIRPATH_DCACHE_NUM</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-23944163-22A2-429B-B221-A5CB4C4AEF56">OCI_ATTR_DIRPATH_DCACHE_MISSES</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-ADC5F56B-A558-489C-B6E0-8BBCEFFA16CE">OCI_ATTR_DIRPATH_DCACHE_HITS</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-195C7996-803F-41A8-8EB2-D2012EEF2EBB">OCI_ATTR_DIRPATH_DCACHE_DISABLE</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16932"></a>
<div class="props_rev_3"><a id="GUID-F4343F83-F22E-4B69-B900-B1445CD0432D"></a>
<h4 id="LNOCI-GUID-F4343F83-F22E-4B69-B900-B1445CD0432D" class="sect4">OCI_ATTR_DIRPATH_DCACHE_SIZE</h4>
<div>
<p>This attribute, when not equal to 0, sets the date cache size (in elements) for a table. For example, if the date cache size is set to 200, then at most 200 unique date or time-stamp values can be stored in the cache. The date cache size cannot be changed once <a href="oci17msc004.htm#GUID-8EE17BD0-02A9-4065-B501-CAF087BA4317">OCIDirPathPrepare()</a> has been called. The default value is 0, meaning a date cache is not created for a table. A date cache is created for a table only if one or more date or time-stamp values are loaded that require data type conversions and the attribute value is nonzero.</p>
</div>
</div>
<a id="LNOCI16933"></a>
<div class="props_rev_3"><a id="GUID-44914454-D7F9-46EE-A837-8F42475C5AFA"></a>
<h4 id="LNOCI-GUID-44914454-D7F9-46EE-A837-8F42475C5AFA" class="sect4">OCI_ATTR_DIRPATH_DCACHE_NUM</h4>
<div>
<p>This attribute is used to query the current number of entries in a date cache.</p>
</div>
</div>
<a id="LNOCI16934"></a>
<div class="props_rev_3"><a id="GUID-23944163-22A2-429B-B221-A5CB4C4AEF56"></a>
<h4 id="LNOCI-GUID-23944163-22A2-429B-B221-A5CB4C4AEF56" class="sect4">OCI_ATTR_DIRPATH_DCACHE_MISSES</h4>
<div>
<p>This attribute is used to query the current number of date cache misses. If the number of misses is high, consider using a larger date cache size. If increasing the date cache size does not cause this number to decrease significantly, the date cache should probably not be used. Date cache misses are expensive, due to hashing and lookup times.</p>
</div>
</div>
<a id="LNOCI16935"></a>
<div class="props_rev_3"><a id="GUID-ADC5F56B-A558-489C-B6E0-8BBCEFFA16CE"></a>
<h4 id="LNOCI-GUID-ADC5F56B-A558-489C-B6E0-8BBCEFFA16CE" class="sect4">OCI_ATTR_DIRPATH_DCACHE_HITS</h4>
<div>
<p>This attribute is used to query the number of date cache hits. This number should be relatively large to see any benefit of using the date cache support.</p>
</div>
</div>
<a id="LNOCI16936"></a>
<div class="props_rev_3"><a id="GUID-195C7996-803F-41A8-8EB2-D2012EEF2EBB"></a>
<h4 id="LNOCI-GUID-195C7996-803F-41A8-8EB2-D2012EEF2EBB" class="sect4">OCI_ATTR_DIRPATH_DCACHE_DISABLE</h4>
<div>
<p>Setting this attribute to 1 indicates that the date cache should be disabled if the size is exceeded. Note that this attribute cannot be changed or set after <a href="oci17msc004.htm#GUID-8EE17BD0-02A9-4065-B501-CAF087BA4317">OCIDirPathPrepare()</a> has been called.</p>
<p>The default (= 0) is to not disable a cache on overflow. When not disabled, the cache is searched to avoid conversions, but overflow input date value entries are not added to the date cache, and are converted using expensive date conversion functions. Again, excessive date cache misses can cause the application to run slower than not using the date cache at all.</p>
<p>This attribute can also be queried to see if a date cache has been disabled due to overflow.</p>
<div class="infoboxnotealso" id="GUID-195C7996-803F-41A8-8EB2-D2012EEF2EBB__GUID-73463EF8-DAC8-4C53-B52A-F37D06DDFB12">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="ociaahan.htm#GUID-07F0F31C-94FF-4E3B-B8E1-C2394CB94390">Direct Path Context Handle (OCIDirPathCtx) Attributes</a>&#34;</span></p>
</div>
</div>
</div>
</div>
</div>
<a id="LNOCI16937"></a>
<div class="props_rev_3"><a id="GUID-DD759C3F-DE1C-4227-92F7-D744BC283590"></a>
<h2 id="LNOCI-GUID-DD759C3F-DE1C-4227-92F7-D744BC283590" class="sect2">Direct Path Loading of Object Types</h2>
<div>
<p>The use of the direct path function contexts to load various nonscalar types is discussed in this section.</p>
<p>The nonscalar types are:</p>
<ul style="list-style-type: disc;">
<li>
<p>Nested tables</p>
</li>
<li>
<p>Object tables (<code class="codeph">FINAL</code> and <code class="codeph">NOT FINAL</code>)</p>
</li>
<li>
<p>Column objects (<code class="codeph">FINAL</code> and <code class="codeph">NOT FINAL</code>)</p>
</li>
<li>
<p><code class="codeph">REF</code> columns (<code class="codeph">FINAL</code> and <code class="codeph">NOT FINAL</code>)</p>
</li>
<li>
<p>SQL string columns</p>
</li>
</ul>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-6C29873B-9E4B-48FB-88AA-5C8DC049FA3B" title="Lists and describes loading the parent table with a nested table column, whichis a separate action from loading the child nested table.">Direct Path Loading of Nested Tables</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-F155292D-2DBE-4EC3-A2F1-4D567DFC1E4E" title="A column object is a table column that is defined as an object.">Direct Path Loading of Column Objects</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-74AF095C-98B2-4E8D-AC7D-4C94260851FF" title="A column value can be computed by a SQL string. SQL strings can be used for scalar column types.">Direct Path Loading of SQL String Columns</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-2CE26A43-4193-4C8D-9C12-77A943811958" title="The REF type is a pointer, or reference, to a row object in an object table.">Direct Path Loading of REF Columns</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-4001897C-6736-4B0B-BCB7-F0C3EB608A70" title="Recall that SQL object inheritance is based on a family tree of object types that forms a type hierarchy.">Direct Path Loading of NOT FINAL Object and REF Columns</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-8C639AF1-1A8B-4BAA-A02E-FF4F8B37BD38">Direct Path Loading of Object Tables</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-04BF14FF-1FF4-4F3A-BBB8-EA2500471DDF">Direct Path Loading a NOT FINAL Object Table</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-DD759C3F-DE1C-4227-92F7-D744BC283590__GUID-6F8B7C9D-A68C-4C7A-8658-5B4AE1D4B7E0">
<p class="notep1">See Also:</p>
<p><a href="ociabdem.htm#GUID-75E18629-0C54-4495-A747-AFB346034F26__CACCAHCE" title="This table has 2 columns. Column 1 is the OCI demonstration program name and column 2 describes the corresponding features illustrated.">Table B-1</a> for a listing of the programs demonstrating direct path loading that are available with your Oracle Database installation</p>
</div>
</div>
<a id="LNOCI16938"></a>
<div class="props_rev_3"><a id="GUID-6C29873B-9E4B-48FB-88AA-5C8DC049FA3B"></a>
<h3 id="LNOCI-GUID-6C29873B-9E4B-48FB-88AA-5C8DC049FA3B" class="sect3">Direct Path Loading of Nested Tables</h3>
<div>
<p>Nested tables are stored in a separate table. Using the direct path loading API, a nested table is loaded separately from its parent table with a foreign key, called a <code class="codeph">SETID</code>, to link the two tables together.</p>
<div class="infobox-note" id="GUID-6C29873B-9E4B-48FB-88AA-5C8DC049FA3B__GUID-D687F83E-46A6-4BA1-A0A8-C52EB32E2936">
<p class="notep1">Note:</p>
<ul style="list-style-type: disc;">
<li>
<p>Currently, the <code class="codeph">SETID</code>s must be user-supplied and are not system-generated.</p>
</li>
<li>
<p>When loading the parent and child tables separately, it is possible for orphaned children to be created when the rows are inserted in to the child table, but the corresponding parent row is not inserted in to the parent table. It is also possible to insert a parent row in to the parent table without inserting child rows in to the child table, so that the parent row has missing children.</p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16939"></a>
<div class="props_rev_3"><a id="GUID-8FFC6108-F2CD-4D03-8B9C-CA41A3CC6C11"></a>
<h4 id="LNOCI-GUID-8FFC6108-F2CD-4D03-8B9C-CA41A3CC6C11" class="sect4">Describing a Nested Table Column and Its Nested Table</h4>
<div>
<p>Lists and describes loading the parent table with a nested table column, whichis a separate action from loading the child nested table.</p>
<div class="section">
<div class="infobox-note" id="GUID-8FFC6108-F2CD-4D03-8B9C-CA41A3CC6C11__GUID-63DE114E-6418-4D9B-97DF-19F211EA6935">
<p class="notep1">Note:</p>
<p>Steps that are different from loading scalar data are in italic.</p>
</div>
<p>Loading the parent table with a nested table column is a separate action from loading the child nested table.</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">To load the parent table with a nested table column:</span></p>
<ol>
<li>
<p>Describe the parent table and its columns as usual, except:</p>
</li>
<li>
<p><span class="italic">When describing the nested table column, this is the column that stores the</span> <span class="italic">SETIDs</span><span class="italic">. Its external data type is SQLT_CHR if the</span> <span class="italic">SETID</span><span class="italic">s in the data file are in characters, SQLT_BIN if binary.</span></p>
</li>
</ol>
</li>
<li>
<p><span class="italic">To load the nested table (child):</span></p>
<ol>
<li>
<p>Describe the nested table and its columns as usual.</p>
</li>
<li>
<p><span class="italic">The</span> <span class="italic">SETID</span> <span class="italic">column is required.</span></p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">Set its OCI_ATTR_NAME using a dummy name (for example &#34;setid&#34;), because the API does not expect you to know its system name.</span></p>
</li>
<li>
<p><span class="italic">Set the column attribute with OCI_ATTR_DIRPATH_SID to indicate that this is a</span> <span class="italic">SETID</span> <span class="italic">column:</span></p>
<pre dir="ltr">ub1 flg = 1;
sword error;

error = OCIAttrSet((void  *)colDesc,
                   OCI_DTYPE_PARAM,
                   (void  *)&amp;flg, (ub4)0,
                   OCI_ATTR_DIRPATH_SID, ctlp-&gt;errhp_ctl);
</pre></li>
</ul>
</li>
</ol>
</li>
</ul>
<p>This section includes the following topic: <a href="oci13obn.htm#GUID-8FFC6108-F2CD-4D03-8B9C-CA41A3CC6C11" title="Lists and describes loading the parent table with a nested table column, whichis a separate action from loading the child nested table.">Describing a Nested Table Column and Its Nested Table</a>.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="LNOCI16940"></a>
<div class="props_rev_3"><a id="GUID-F155292D-2DBE-4EC3-A2F1-4D567DFC1E4E"></a>
<h3 id="LNOCI-GUID-F155292D-2DBE-4EC3-A2F1-4D567DFC1E4E" class="sect3">Direct Path Loading of Column Objects</h3>
<div>
<p>A column object is a table column that is defined as an object.</p>
<p>Currently only the default constructor, which consists of all of the constituent attributes, is supported.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-01B4EA72-B9F5-4152-9251-01FADADEBB9D">Describing a Column Object</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-9F981453-A689-40D5-AB33-C0ED743F56FC">Allocating the Array Column for the Column Object</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-1B2F7386-6BEE-4FCD-99C9-E38AD3E00323">Loading Column Object Data into the Column Array</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-C67EFBE6-677E-4E3C-8024-8412857C3BE0">OCI_DIRPATH_COL_ERROR</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16941"></a>
<div class="props_rev_3"><a id="GUID-01B4EA72-B9F5-4152-9251-01FADADEBB9D"></a>
<h4 id="LNOCI-GUID-01B4EA72-B9F5-4152-9251-01FADADEBB9D" class="sect4">Describing a Column Object</h4>
<div>
<div class="section">
<p>To describe a column object and its object attributes, use a direct path function context. Describing a column object requires setting its object constructor. Describing object attributes is similar to describing a list of scalar columns.</p>
<p>To describe a column object:</p>
<div class="infobox-note" id="GUID-01B4EA72-B9F5-4152-9251-01FADADEBB9D__GUID-9074A4C4-66C1-48AA-8C15-85564BDA3245">
<p class="notep1">Note:</p>
<ul style="list-style-type: disc;">
<li>
<p>Nested column objects are supported.</p>
</li>
<li>
<p>The steps shown here are similar to those describing a list of scalar columns to be loaded for a table. Steps that are different from loading scalar data are in italic.</p>
</li>
</ul>
</div>
<ol>
<li>
<p>Allocate a parameter handle on the column object with <code class="codeph">OCI_DTYPE_PARAM</code>. This parameter handle is used to set the column&#39;s external attributes.</p>
</li>
<li>
<p>Set the column name and its other external column attributes (for example, maximum data size, precision, scale).</p>
</li>
<li>
<p><span class="italic">Set the external type as SQLT_NTY (named type) with OCI_ATTR_DATA_TYPE.</span></p>
</li>
<li>
<p><span class="italic">Allocate a direct path function context handle. This context is used to describe the column&#39;s object type and attributes:</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx  /* direct path function context */;
sword error;
error = OCIHandleAlloc((void  *)dpctx, (void  **)&amp;dpfnctx,
               OCI_HTYPE_DIRPATH_FN_CTX, 
               (size_t)0, (void  **)0);
</pre></li>
<li>
<p><span class="italic">Set the column&#39;s object type name (for example, &#34;Employee&#34;) with OCI_ATTR_NAME in the function context:</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
text *obj_type;   /* column object&#39;s object type */
sword error;

error = OCIAttrSet((void  *)dpfnctx,
                   OCI_HTYPE_DIRPATH_FN_CTX,
                   (void  *)obj_type, (ub4)strlen((const char *)obj_type),
                   OCI_ATTR_NAME, ctlp-&gt;errhp_ctl);
</pre></li>
<li>
<p><span class="italic">Set the expression type, OCI_ATTR_DIRPATH_EXPR_TYPE, to be OCI_DIRPATH_EXPR_OBJ_CONSTR. This indicates that the expression set with OCI_ATTR_NAME is used as the default object constructor:</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
ub1 expr_type = OCI_DIRPATH_EXPR_OBJ_CONSTR;
sword error;

error = OCIAttrSet((void  *)dpfnctx,
                   OCI_HTYPE_DIRPATH_FN_CTX,
                   (void  *)&amp;expr_type, (ub4)0,
                   OCI_ATTR_DIRPATH_EXPR_TYPE,
                   ctlp-&gt;errhp_ctl);
</pre></li>
<li>
<p><span class="italic">Set the number of columns or object attributes that are to be loaded for this column object using OCI_ATTR_NUM_COLS.</span></p>
</li>
<li>
<p><span class="italic">Get the column or attribute parameter list for the function context</span> <span class="italic"><code class="codeph">OCIDirPathFuncCtx</code></span><span class="italic">.</span></p>
</li>
<li>
<p><span class="italic">For each object attribute:</span></p>
<ol>
<li>
<p>Get the column descriptor for the object attribute with <code class="codeph">OCI_DTYPE_PARAM</code>.</p>
</li>
<li>
<p>Set the attribute&#39;s column name with <code class="codeph">OCI_ATTR_NAME</code>.</p>
</li>
<li>
<p>Set the external column type (the type of the data that is to be passed to the direct path API) with <code class="codeph">OCI_ATTR_DATA_TYPE</code>.</p>
</li>
<li>
<p>Set any other external column attributes (maximum data size, precision, scale, and so on.)</p>
</li>
<li>
<p><span class="italic">If this attribute column is a column object, then do Steps 3 through 10 for its object attributes.</span></p>
</li>
<li>
<p>Free the handle to the column descriptor.</p>
</li>
</ol>
</li>
<li>
<p><span class="italic">Set the function context</span> <span class="italic"><code class="codeph">OCIDirPathFuncCtx</code></span> <span class="italic">that was created in Step 4 into the parent column object&#39;s parameter handle with OCI_ATTR_DIRPATH_FN_CTX.</span></p>
</li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI72751"></a><a id="LNOCI16942"></a>
<div class="props_rev_3"><a id="GUID-9F981453-A689-40D5-AB33-C0ED743F56FC"></a>
<h4 id="LNOCI-GUID-9F981453-A689-40D5-AB33-C0ED743F56FC" class="sect4">Allocating the Array Column for the Column Object</h4>
<div>
<div class="section">
<p>When you direct path load a column object, the data for its object attributes is loaded into a separate column array created just for that object. A child column array is allocated for each column object, whether it is nested or not. Each row of object attributes in the child column array maps to the corresponding non-NULL row of its parent column object in the parent column array.</p>
<p>Use the column object&#39;s direct path function context handle and function column array value <a id="d145923e5188" class="indexterm-anchor"></a><code class="codeph">OCI_HTYPE_DIRPATH_FN_COL_ARRAY</code>.</p>
<p><a href="oci13obn.htm#GUID-9F981453-A689-40D5-AB33-C0ED743F56FC__CACJDIFA">Example 13-18</a> shows how to allocate a child column array for a column object.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-9F981453-A689-40D5-AB33-C0ED743F56FC__CACJDIFA">
<p class="titleinexample">Example 13-18 Allocating a Child Column Array for a Column Object</p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
OCIDirPathColArray *dpfnca;   /* direct path function column array */
sword error;

error = OCIHandleAlloc((void  *)dpfnctx, (void  **)&amp;dpfnca,
                       OCI_HTYPE_DIRPATH_FN_COL_ARRAY,
                       (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI16943"></a>
<div class="props_rev_3"><a id="GUID-1B2F7386-6BEE-4FCD-99C9-E38AD3E00323"></a>
<h4 id="LNOCI-GUID-1B2F7386-6BEE-4FCD-99C9-E38AD3E00323" class="sect4">Loading Column Object Data into the Column Array</h4>
<div>
<div class="section">
<p>If a column is scalar, its value is set in the column array by passing the address of its value to <a href="oci17msc004.htm#GUID-4E4E74F4-3F15-4176-8229-C5783DC3811D">OCIDirPathColArrayEntrySet()</a>. If a column is an object, the address of its child column array handle is passed instead. The child column array contains the data of the object attributes.</p>
<p>To load data into a column object:</p>
<div class="infobox-note" id="GUID-1B2F7386-6BEE-4FCD-99C9-E38AD3E00323__GUID-6628C045-5BE1-4012-A066-262115E74566">
<p class="notep1">Note:</p>
<p>Steps that are different from loading scalar data are in italic.</p>
</div>
<p><span class="italic">(Start.) For each column object:</span></p>
<ol>
<li>
<p><span class="italic">If the column is non-NULL:</span></p>
<ol>
<li>
<p><span class="italic">For each of its object attribute columns:</span></p>
<p><span class="italic">If an object attribute is a nested column object, then go to (Start.) and do this entire procedure recursively.</span></p>
<p><span class="italic">Set the data in the child column array using</span> <span class="italic">OCIDirPathColArrayEntrySet()</span><span class="italic">.</span></p>
</li>
<li>
<p><span class="italic">Set the column object&#39;s data in the column array by passing the address of its child column array handle to</span> <span class="italic"><code class="codeph">OCIDirPathColArrayEntrySet()</code></span>.</p>
</li>
</ol>
</li>
<li>
<p>Else if the column is NULL:</p>
<p>Set the column object&#39;s data in the column array by passing a NULL address for the data, a length of 0, and an <code class="codeph">OCI_DIRPATH_COL_NULL</code> flag to <a href="oci17msc004.htm#GUID-4E4E74F4-3F15-4176-8229-C5783DC3811D">OCIDirPathColArrayEntrySet()</a>.</p>
</li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI16944"></a>
<div class="props_rev_3"><a id="GUID-C67EFBE6-677E-4E3C-8024-8412857C3BE0"></a>
<h4 id="LNOCI-GUID-C67EFBE6-677E-4E3C-8024-8412857C3BE0" class="sect4">OCI_DIRPATH_COL_ERROR</h4>
<div>
<p>The <code class="codeph">OCI_DIRPATH_COL_ERROR</code> value is passed to <code class="codeph">OCIDirPathColArrayEntry()</code> to indicate that the current column array row should be ignored. A typical use of this value is to back out all previous conversions for a row when an error occurs, providing that more data for a partial column (<code class="codeph">OCI_NEED_DATA</code> was returned from the previous <a href="oci17msc004.htm#GUID-3A9445D3-EBE2-40DB-B303-F204CE065356">OCIDirPathColArrayToStream()</a> call). Any previously converted data placed in the output stream buffer for the current row is removed. Conversion then continues with the next row in the column array. The purged row is counted in the converted row count.</p>
<p>When <code class="codeph">OCI_DIRPATH_COL_ERROR</code> is specified, the current row is ignored, as well as any corresponding rows in any child column arrays referenced, starting from the top-level column array row. Any <code class="codeph">NULL</code> child column array references are ignored when moving all referenced child column arrays to their next row.</p>
</div>
</div>
</div>
<a id="LNOCI16945"></a>
<div class="props_rev_3"><a id="GUID-74AF095C-98B2-4E8D-AC7D-4C94260851FF"></a>
<h3 id="LNOCI-GUID-74AF095C-98B2-4E8D-AC7D-4C94260851FF" class="sect3">Direct Path Loading of SQL String Columns</h3>
<div>
<p>A column value can be computed by a SQL string. SQL strings can be used for scalar column types.</p>
<p>SQL strings cannot be used for object types, but can be used for object attributes of scalar column types. They cannot be used for nested tables, sequences, and <code class="codeph">LONG</code>s.</p>
<p>A SQL expression is represented to the direct path API using the <code class="codeph">OCIDirPathFuncCtx</code>. Its <code class="codeph">OCI_ATTR_NAME</code> value is the SQL string with the parameter list of the named bind variables for the expression.</p>
<p>The bind variable namespace is limited to a column&#39;s SQL string. The same bind variable name can be used for multiple columns, but any arguments with the same name only apply to the SQL string of that column.</p>
<p>If a SQL string of a column contains multiple references to a bind variable and multiple arguments are specified for that name, all of the values must be the same; otherwise, the results are undefined. Only one argument is actually required for this case, as all references to the same bind variable name in a particular SQL expression are bound to that single argument.</p>
<p>A SQL string example is:</p>
<pre dir="ltr">substr(substr(:string, :offset, :length), :offset, :length)
</pre>
<p>Things to note about this example are:</p>
<ul style="list-style-type: disc;">
<li>
<p>SQL expressions can be nested.</p>
</li>
<li>
<p>Bind variable names can be repeated within the expression.</p>
</li>
</ul>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-AEA27B9F-BB45-4DF0-8123-6F7B14869F45">Describing a SQL String Column</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-AEDE6422-320A-423D-8A99-4F8CDC74AA8A">Allocating the Column Array for SQL String Columns</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-033C2E65-7F4C-4128-8DAC-8219FC6C937E" title="If a column is scalar, its value would be set in the column array by passing the address of its value to OCIDirPathColArrayEntrySet().">Loading the SQL String Data into the Column Array</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16946"></a>
<div class="props_rev_3"><a id="GUID-AEA27B9F-BB45-4DF0-8123-6F7B14869F45"></a>
<h4 id="LNOCI-GUID-AEA27B9F-BB45-4DF0-8123-6F7B14869F45" class="sect4">Describing a SQL String Column</h4>
<div>
<div class="section">
<div class="infobox-note" id="GUID-AEA27B9F-BB45-4DF0-8123-6F7B14869F45__GUID-F72679A4-A6B2-4C88-9509-094FEF9C954A">
<p class="notep1">Note:</p>
<p>Steps that are different from loading scalar data are in italic.</p>
</div>
<ol>
<li>
<p>Allocate a parameter handle on the SQL string column with <code class="codeph">OCI_DTYPE_PARAM</code>. This parameter handle is used to set the column&#39;s external attributes.</p>
</li>
<li>
<p>Set the column name and its other external column attributes (for example, maximum data size, precision, scale).</p>
</li>
<li>
<p><span class="italic">Set the SQL string column&#39;s external type as SQLT_NTY with OCI_ATTR_DATA_TYPE.</span></p>
</li>
<li>
<p><span class="italic">Allocate a direct path function context handle. This context is used to describe the arguments of the SQL string.</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx  /* direct path function context */;
sword error;
error = OCIHandleAlloc((void  *)dpctx, (void  **)&amp;dpfnctx,
               OCI_HTYPE_DIRPATH_FN_CTX, 
               (size_t)0, (void  **)0);
</pre></li>
<li>
<p><span class="italic">Set the column&#39;s SQL string in OCI_ATTR_NAME in the function context.</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
text *sql_str;   /* column&#39;s SQL string expression */
sword error;

error = OCIAttrSet((void  *)dpfnctx,
                   OCI_HTYPE_DIRPATH_FN_CTX,
                   (void  *)sql_str, (ub4)strlen((const char *)sql_str),
                   OCI_ATTR_NAME, ctlp-&gt;errhp_ctl);
</pre></li>
<li>
<p><span class="italic">Set the expression type, OCI_ATTR_DIRPATH_EXPR_TYPE, to be OCI_DIRPATH_EXPR_SQL. This indicates that the expression set with OCI_ATTR_NAME is used as the SQL string to derive the value from.</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
ub1 expr_type = OCI_DIRPATH_EXPR_SQL;
sword error;

error = OCIAttrSet((void  *)dpfnctx,
                   OCI_HTYPE_DIRPATH_FN_CTX,
                   (void  *)&amp;expr_type, (ub4)0,
                   OCI_ATTR_DIRPATH_EXPR_TYPE, ctlp-&gt;errhp_ctl);
</pre></li>
<li>
<p><span class="italic">Set the number of arguments that are to be passed to the SQL string with OCI_ATTR_NUM_COLS.</span></p>
</li>
<li>
<p><span class="italic">Get the column or attribute parameter list for the function context.</span></p>
</li>
<li>
<p><span class="italic">For each SQL string argument:</span></p>
<ol>
<li>
<p>Get the column descriptor for the object attribute with <code class="codeph">OCI_DTYPE_PARAM</code>.</p>
</li>
<li>
<p><span class="italic">The order in which the SQL string arguments are defined does not matter. The order does not have to match the order used in the SQL string.</span></p>
</li>
<li>
<p>Set the attribute&#39;s column name with <code class="codeph">OCI_ATTR_NAME</code>.</p>
</li>
<li>
<p><span class="italic">Use the naming convention for SQL string arguments.</span></p>
</li>
<li>
<p><span class="italic">The argument names must match the bind variable names used in the SQL string in content but not in case. For example, if the SQL string is &#34;substr(:INPUT_STRING, 3, 5)&#34;, then it is acceptable if you give the argument name as &#34;input_string&#34;.</span></p>
</li>
<li>
<p><span class="italic">If an argument is used multiple times in a SQL string, declaring it once and counting it as one argument only is correct.</span></p>
</li>
<li>
<p>Set the external column type (the type of the data that is to be passed to the direct path API) with <code class="codeph">OCI_ATTR_DATA_TYPE</code>.</p>
</li>
<li>
<p>Set any other external column attributes (maximum data size, precision, scale, and so on).</p>
</li>
<li>
<p>Free the handle to the column descriptor.</p>
</li>
</ol>
</li>
<li>
<p><span class="italic">Set the function context</span> <span class="italic"><code class="codeph">OCIDirPathFuncCtx</code></span> <span class="italic">that was created in Step 4 into the parent column object&#39;s parameter handle with OCI_ATTR_DIRPATH_FN_CTX.</span></p>
</li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI72752"></a><a id="LNOCI16947"></a>
<div class="props_rev_3"><a id="GUID-AEDE6422-320A-423D-8A99-4F8CDC74AA8A"></a>
<h4 id="LNOCI-GUID-AEDE6422-320A-423D-8A99-4F8CDC74AA8A" class="sect4">Allocating the Column Array for SQL String Columns</h4>
<div>
<div class="section">
<p>When you direct path load a SQL string column, the data for its arguments is loaded into a separate column array created just for that SQL string column. A child column array is allocated for each SQL string column. Each row of arguments in the child column array maps to the corresponding non-NULL row of its parent SQL string column in the parent column array.</p>
<p><a href="oci13obn.htm#GUID-AEDE6422-320A-423D-8A99-4F8CDC74AA8A__CACDIEEJ">Example 13-19</a> shows how to allocate a child column array for a SQL string column.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-AEDE6422-320A-423D-8A99-4F8CDC74AA8A__CACDIEEJ">
<p class="titleinexample">Example 13-19 Allocating a Child Column Array for a SQL String Column</p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx;        /* direct path function context */
OCIDirPathColArray *dpfnca;   /* direct path function column array */
sword error;

error = OCIHandleAlloc((void  *)dpfnctx, (void  **)&amp;dpfnca, 
                       OCI_HTYPE_DIRPATH_FN_COL_ARRAY,
                       (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI16948"></a>
<div class="props_rev_3"><a id="GUID-033C2E65-7F4C-4128-8DAC-8219FC6C937E"></a>
<h4 id="LNOCI-GUID-033C2E65-7F4C-4128-8DAC-8219FC6C937E" class="sect4">Loading the SQL String Data into the Column Array</h4>
<div>
<p>If a column is scalar, its value would be set in the column array by passing the address of its value to <code class="codeph">OCIDirPathColArrayEntrySet()</code>.</p>
<div class="section">
<p>If a column is of a SQL string type, the address of its child column array handle would be passed instead. The child column array would contain the SQL string&#39;s argument data.</p>
<p>To load data into a SQL string column:</p>
<div class="infobox-note" id="GUID-033C2E65-7F4C-4128-8DAC-8219FC6C937E__GUID-548C1F60-F6C9-41F0-9E7B-B379B514FB4D">
<p class="notep1">Note:</p>
<p>Steps that are different from loading scalar data are in italic.</p>
</div>
<p><span class="italic">For each SQL string column:</span></p>
<ol>
<li>
<p><span class="italic">If the column is non-NULL:</span></p>
<ol>
<li>
<p><span class="italic">For each of its function argument columns:</span></p>
<p><span class="italic">Set the data in the child column array using</span> <span class="italic">OCIDirPathColArrayEntrySet()</span><span class="italic">.</span></p>
</li>
<li>
<p><span class="italic">Set the SQL string column&#39;s data into the column array by passing the address of its child column array handle to</span> <span class="italic">OCIDirPathColArrayEntrySet()</span><span class="italic">.</span></p>
</li>
</ol>
</li>
<li>
<p>Else if the column is NULL:</p>
<p>Set the SQL string column data into the column array by passing a NULL address for the data, a length of 0, and an <code class="codeph">OCI_DIRPATH_COL_NULL</code> flag to <code class="codeph">OCIDirPathColArrayEntrySet()</code>.</p>
</li>
</ol>
<p>This process is similar to that for column objects.</p>
<div class="infoboxnotealso" id="GUID-033C2E65-7F4C-4128-8DAC-8219FC6C937E__GUID-05CCBFDE-9ACB-4CDA-9725-4564B52D0EA8">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-C67EFBE6-677E-4E3C-8024-8412857C3BE0">OCI_DIRPATH_COL_ERROR</a> for more information about passing the <code class="codeph">OCI_DIRPATH_COL_ERROR</code> value to <code class="codeph">OCIDirPathColArrayEntry()</code> to indicate that the current column array row should be ignored when an error occurs</p>
</li>
<li>
<p><a href="oci17msc004.htm#GUID-4E4E74F4-3F15-4176-8229-C5783DC3811D">OCIDirPathColArrayEntrySet()</a></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="LNOCI16949"></a>
<div class="props_rev_3"><a id="GUID-2CE26A43-4193-4C8D-9C12-77A943811958"></a>
<h3 id="LNOCI-GUID-2CE26A43-4193-4C8D-9C12-77A943811958" class="sect3">Direct Path Loading of REF Columns</h3>
<div>
<p>The <code class="codeph">REF</code> type is a pointer, or reference, to a row object in an object table.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-02A4DC87-333F-4460-8B3A-70DB1E1E0FD9">Describing the REF Column</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-09E1B9FB-28B9-4EC8-A02E-3723A2BE835C">Allocating the Column Array for a REF Column</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-23DC0D22-8828-4B5F-A483-6BE3CA8689CE" title="If a column is scalar, its value is set in the column array by passing the address of its value to OCIDirPathColArrayEntrySet().">Loading the REF Data into the Column Array</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16950"></a>
<div class="props_rev_3"><a id="GUID-02A4DC87-333F-4460-8B3A-70DB1E1E0FD9"></a>
<h4 id="LNOCI-GUID-02A4DC87-333F-4460-8B3A-70DB1E1E0FD9" class="sect4">Describing the REF Column</h4>
<div>
<div class="section">
<p>Describing the arguments to a <code class="codeph">REF</code> column is similar to describing the list of columns to be loaded for a table.</p>
<div class="infobox-note" id="GUID-02A4DC87-333F-4460-8B3A-70DB1E1E0FD9__GUID-A2BFD008-BDE1-4C5D-B319-21CBB93A5F78">
<p class="notep1">Note:</p>
<p>A <code class="codeph">REF</code> column can be a top-table-level column or nested as an object attribute to a column object.</p>
<p>Steps that are different from loading scalar data are in italic.</p>
</div>
<ol>
<li>
<p>Get a parameter handle on the <code class="codeph">REF</code> column with <code class="codeph">OCI_DTYPE_PARAM</code>. This parameter handle is used to set the column&#39;s external attributes.</p>
</li>
<li>
<p>Set the column name and its other external column attributes (for example, maximum data size, precision, scale).</p>
</li>
<li>
<p><span class="italic">Set the REF column&#39;s external type as SQLT_REF with OCI_ATTR_DATA_TYPE.</span></p>
</li>
<li>
<p><span class="italic">Allocate a direct path function context handle. This context is used to describe the REF column&#39;s arguments.</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
sword error;

error = OCIHandleAlloc((void  *)dpctx, (void  **)&amp;dpfnctx,
                       OCI_HTYPE_DIRPATH_FN_CTX,
                       (size_t)0, (void  **)0);
</pre></li>
<li>
<p><span class="italic">OPTIONAL: Set the REF column&#39;s table name in OCI_ATTR_NAME in the function context. See the next step for more details.</span></p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
text *ref_tbl;     /* column&#39;s reference table */
sword error;

error = OCIAttrSet((void  *)dpfnctx,
                   OCI_HTYPE_DIRPATH_FN_CTX,
                   (void  *)ref_tbl, (ub4)strlen((const char *)ref_tbl),
                   OCI_ATTR_NAME, ctlp-&gt;errhp_ctl);
</pre></li>
<li>
<p><span class="italic">OPTIONAL: Set the expression type, OCI_ATTR_DIRPATH_EXPR_TYPE, to be OCI_DIRPATH_EXPR_REF_TBLNAME. Set this only if Step 5 was done. This indicates that the expression set with OCI_ATTR_NAME is to be used as the object table to reference row objects from. This parameter is optional. The behavior for this parameter varies for the REF type.</span></p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">Unscoped REF columns (unscoped, system-OID-based):</span></p>
<p><span class="italic">If not set, then by the definition of an &#34;unscoped&#34; REF column, this REF column is required to have a reference table name as its argument for every data row.</span></p>
<p><span class="italic">If set, this REF column can only refer to row objects from this specified object table for the duration of the load. And the REF column is not allowed to have a reference table name as its argument. (The direct path API is providing this parameter as a shortcut to users who will be loading to an unscoped REF column that refers to the same reference object table during the entire load.)</span></p>
</li>
<li>
<p><span class="italic">Scoped REF columns (scoped, system-OID-based, and primary-key-based):</span></p>
<p><span class="italic">If not set, the direct path API uses the reference table specified in the schema.</span></p>
<p><span class="italic">If set, the reference table name must match the object table specified in the schema for this scoped REF column. An error occurs if the table names do not match.</span></p>
<p><span class="italic">Whether this parameter is set or not, it does not matter to the API whether this reference table name is in the data row or not. If the name is in the data row, it must match the table name specified in the schema. If it is not in the data row, the API uses the reference table specified in the schema.</span></p>
</li>
</ul>
</li>
<li>
<p><span class="italic">Set the number of REF arguments that are to be used to reference a row object with OCI_ATTR_NUM_COLS. The number of arguments required varies for the REF column type. This number is derived from Step 6 earlier.</span></p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">Unscoped REF columns (unscoped, system-OID-based REF columns):</span></p>
<p><span class="italic">One if OCI_DIRPATH_EXPR_REF_TBLNAME is used. None for the reference table name, and one for the OID value.</span></p>
<p><span class="italic">Two if OCI_DIRPATH_EXPR_REF_TBLNAME is not used. One for the reference table name, and one for the OID value.</span></p>
</li>
<li>
<p><span class="italic">Scoped REF columns (scoped, system-OID-based, and primary-key-based):</span></p>
<p><span class="italic">N or N+1 are acceptable, where N is the number of columns making up the object ID, regardless if OCI_DIRPATH_EXPR_REF_TBLNAME is used or not. Minimum is N if the reference table name is not in the data row. It is N+1 if the reference table name is in the data row. Note: If the REF is system-OID-based, then N is one. If the REF is primary-key-based, then N is the number of component columns that make up the primary key. If the reference table name is in the data row, then add one to N.</span></p>
<div class="infobox-note" id="GUID-02A4DC87-333F-4460-8B3A-70DB1E1E0FD9__GUID-E130411A-8645-4B1C-AD27-B4C8018AFEAF">
<p class="notep1">Note:</p>
<p>To simplify the error message if you pass in some <code class="codeph">REF</code> arguments other than N or N+1, the error message says that it found so-and-so number of arguments when it expects N. Although N+1 is not stated in the message, N+1 is acceptable (even though the reference table name is not needed) and does not invoke an error message.</p>
</div>
</li>
</ul>
</li>
<li>
<p><span class="italic">Get the column or attribute parameter list for the function context.</span></p>
</li>
<li>
<p><span class="italic">For each REF argument or attribute:</span></p>
<ol>
<li>
<p>Get the column descriptor for the <code class="codeph">REF</code> argument using <code class="codeph">OCI_DTYPE_PARAM</code>.</p>
</li>
<li>
<p>Set the attribute&#39;s column name using <code class="codeph">OCI_ATTR_NAME</code>.</p>
<p><span class="italic">The order of the REF arguments given matter.</span> <span class="italic">The reference table name comes first, if given.</span> <span class="italic">The object ID, whether it is system-generated or primary-key-based, comes next.</span></p>
<p><span class="italic">There is a naming convention for the REF arguments.</span> <span class="italic">Because the reference table name is not a table column, you can use any dummy names for its column name, such as &#34;ref-tbl.&#34;</span> <span class="italic">For a system-generated OID column, you can use any dummy names for its column name, such as &#34;sys-OID&#34;.</span> <span class="italic">For a primary-key-based object ID, list all the primary-key columns to load into. There is no need to create a dummy name for OID. The component column names, if given (see shortcut note later), can be given in any order.</span></p>
<p><span class="italic">Do not set the attribute column names for the object ID to use the shortcut.</span></p>
<p><span class="italic"><span class="bold">Shortcut.</span></span> <span class="italic">If loading a system-OID-based REF column, do not set the column name with a name. The API figures it out. But you must still set other column attributes, such as external data type.</span></p>
<p><span class="italic">If loading a primary-key REF column and its primary key consists of multiple columns, the shortcut is not to set their column names. But you must still set other column attributes, such as external data type.</span></p>
<div class="infobox-note" id="GUID-02A4DC87-333F-4460-8B3A-70DB1E1E0FD9__GUID-B3B92ADA-0821-4EE1-9B71-7AB5498B9A43">
<p class="notep1">Note:</p>
<p>If the component column names are NULL, then the API code determines the column names in the position or order in which they were defined for the primary key. So, when you set column attributes other than the name, ensure that the attributes are set for the component columns in the correct order.</p>
</div>
</li>
<li>
<p>Set the external column type (the type of the data that is to be passed to the direct path API) using <code class="codeph">OCI_ATTR_DATA_TYPE</code>.</p>
</li>
<li>
<p>Set any other external column attributes (max data size, precision, scale, and so on).</p>
</li>
<li>
<p>Free the handle to the column descriptor.</p>
</li>
<li>
<p><span class="italic">Set the function context</span> <span class="italic"><code class="codeph">OCIDirPathFuncCtx</code></span> <span class="italic">that was created in Step 4 in the parent column object&#39;s parameter handle using OCI_ATTR_DIRPATH_FN_CTX.</span></p>
</li>
</ol>
</li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI72753"></a><a id="LNOCI16951"></a>
<div class="props_rev_3"><a id="GUID-09E1B9FB-28B9-4EC8-A02E-3723A2BE835C"></a>
<h4 id="LNOCI-GUID-09E1B9FB-28B9-4EC8-A02E-3723A2BE835C" class="sect4">Allocating the Column Array for a REF Column</h4>
<div>
<div class="section">
<p><a href="oci13obn.htm#GUID-09E1B9FB-28B9-4EC8-A02E-3723A2BE835C__CACJJCCB">Example 13-20</a> shows how to allocate a child column array for a <code class="codeph">REF</code> column.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-09E1B9FB-28B9-4EC8-A02E-3723A2BE835C__CACJJCCB">
<p class="titleinexample">Example 13-20 Allocating a Child Column Array for a REF Column</p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
OCIDirPathColArray *dpfnca; /* direct path function column array */
sword error;

error = OCIHandleAlloc((void  *)dpfnctx, (void  **)&amp;dpfnca,
                       OCI_HTYPE_DIRPATH_FN_COL_ARRAY,
                       (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI16952"></a>
<div class="props_rev_3"><a id="GUID-23DC0D22-8828-4B5F-A483-6BE3CA8689CE"></a>
<h4 id="LNOCI-GUID-23DC0D22-8828-4B5F-A483-6BE3CA8689CE" class="sect4">Loading the REF Data into the Column Array</h4>
<div>
<p>If a column is scalar, its value is set in the column array by passing the address of its value to <code class="codeph">OCIDirPathColArrayEntrySet()</code>.</p>
<div class="section">
<p>If a column is a <code class="codeph">REF</code>, the address of its child column array handle is passed instead. The child column array contains the <code class="codeph">REF</code> arguments&#39; data.</p>
<p>To load data into a <code class="codeph">REF</code> column:</p>
<div class="infobox-note" id="GUID-23DC0D22-8828-4B5F-A483-6BE3CA8689CE__GUID-62F14D2B-1169-4A52-B861-E82B38F446BD">
<p class="notep1">Note:</p>
<p>Steps that are different from loading scalar data are in italic.</p>
</div>
<p><span class="italic">For each REF column:</span></p>
<ol>
<li>
<p><span class="italic">If the column is non-NULL:</span></p>
<ol>
<li>
<p><span class="italic">For each of its REF argument columns:</span></p>
<p><span class="italic">Set its data in the child column array using</span> <span class="italic">OCIDirPathColArrayEntrySet()</span><span class="italic">.</span></p>
</li>
<li>
<p><span class="italic">Set the REF column&#39;s data into the column array by passing the address of its child column array handle to</span> <span class="italic">OCIDirPathColArrayEntrySet()</span><span class="italic">.</span></p>
</li>
</ol>
</li>
<li>
<p>Else if the column is NULL:</p>
<p>Set the <code class="codeph">REF</code> column&#39;s data into the column array by passing a NULL address for the data, a length of 0, and an <code class="codeph">OCI_DIRPATH_COL_NULL</code> flag to <code class="codeph">OCIDirPathColArrayEntrySet()</code>.</p>
<div class="infoboxnotealso" id="GUID-23DC0D22-8828-4B5F-A483-6BE3CA8689CE__GUID-19B41CED-4815-409D-ADBD-FA53FF897401">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-C67EFBE6-677E-4E3C-8024-8412857C3BE0">OCI_DIRPATH_COL_ERROR</a></p>
</li>
<li>
<p><a href="oci17msc004.htm#GUID-4E4E74F4-3F15-4176-8229-C5783DC3811D">OCIDirPathColArrayEntrySet()</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="LNOCI16953"></a>
<div class="props_rev_3"><a id="GUID-4001897C-6736-4B0B-BCB7-F0C3EB608A70"></a>
<h3 id="LNOCI-GUID-4001897C-6736-4B0B-BCB7-F0C3EB608A70" class="sect3">Direct Path Loading of NOT FINAL Object and REF Columns</h3>
<div>
<p>Recall that SQL object inheritance is based on a family tree of object types that forms a type hierarchy.</p>
<p>The type hierarchy consists of a parent object type, called a supertype, and one or more levels of child object types, called subtypes, which are derived from the parent.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-EAF14E36-0523-4C20-ACC1-BBA8097EB0E0" title="Recall that for an object type to be inheritable, the object type definition must specify that it is inheritable.">Inheritance Hierarchy</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-68DE4F77-4C16-4436-B1D6-CA4E471B1CE2" title="Note that the steps to describe a NOT FINAL or substitutable object columns and REF columns of a fixed, derived type are similar to the steps that describe its FINAL counterpart.">About Describing a Fixed, Derived Type to Be Loaded</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-BE30BD66-BF95-4E29-9335-0249E3C3C41B">About Allocating the Column Array</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-4C7BA004-49EE-4E66-9829-C00335812363">About Loading the Data into the Column Array</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI72754"></a><a id="LNOCI16954"></a>
<div class="props_rev_3"><a id="GUID-EAF14E36-0523-4C20-ACC1-BBA8097EB0E0"></a>
<h4 id="LNOCI-GUID-EAF14E36-0523-4C20-ACC1-BBA8097EB0E0" class="sect4">Inheritance Hierarchy</h4>
<div>
<p>Recall that for an object type to be inheritable, the object type definition must specify that it is inheritable.</p>
<p><a href="oci13obn.htm#GUID-EAF14E36-0523-4C20-ACC1-BBA8097EB0E0__CACEJFED">Figure 13-2</a> diagrams the inheritance hierarchy for a column of type <code class="codeph">Person</code>. The <code class="codeph">Person</code> supertype is at the top of the hierarchy with two attributes: <code class="codeph">Name</code>, <code class="codeph">Address</code>. <code class="codeph">Person</code> has two subtypes, <code class="codeph">Employee</code> and <code class="codeph">Student</code>. The <code class="codeph">Employee</code> subtype has two attributes: <code class="codeph">Manager</code>, <code class="codeph">Deptid</code>. The <code class="codeph">Student</code> subtype has two attributes: <code class="codeph">Units</code>, <code class="codeph">GPA</code>. <code class="codeph">ParttimeEmployee</code> is a subtype of <code class="codeph">Employee</code> and appears below it. The subtype <code class="codeph">ParttimeEmployee</code> has one attribute: <code class="codeph">Hours</code>. These are the types that can be stored in a <code class="codeph">Person</code> column.</p>
<div class="figure" id="GUID-EAF14E36-0523-4C20-ACC1-BBA8097EB0E0__CACEJFED">
<p class="titleinfigure">Figure 13-2 Inheritance Hierarchy for a Column of Type Person</p>
<img width="300" height="156" src="img/GUID-44D472A4-5C2D-4BFA-9D84-9B202A25D88D-default.gif" alt="Description of Figure 13-2 follows" title="Description of Figure 13-2 follows"/><br/>
<a href="img_text/GUID-44D472A4-5C2D-4BFA-9D84-9B202A25D88D-default.htm">Description of &#34;Figure 13-2 Inheritance Hierarchy for a Column of Type Person&#34;</a></div>
<!-- class="figure" -->
<p>Once specified, subtypes can be derived from it. To specify an object to be inheritable, the keyword <code class="codeph">NOT FINAL</code> must be specified in its type definition. To specify an object to not be inheritable, the keyword FINAL must be specified in its type definition.</p>
<p>When you direct path load a table that contains a column of type <code class="codeph">Person</code>, the actual set of types could include any of these four: the <code class="codeph">NOT FINAL</code> type <code class="codeph">Person</code>, and its three subtypes: <code class="codeph">Student</code>, <code class="codeph">Employee</code>, and <code class="codeph">ParttimeEmployee</code>. Because the direct path load API only supports the loading of one fixed, derived type to this <code class="codeph">NOT FINAL</code> column for the duration of this load, the direct path load API must know which one of these types is to be loaded, the attributes to load for this type, and the function used to create this type.</p>
<p>So when you describe and load a derived type, you must specify all of the attributes for that type that are to be loaded. Think of a subtype as a flattened representation of all the object attributes that are unique to this type, plus all the attributes of its ancestors. Therefore, any of these attribute columns that are to be loaded into, you must describe and count.</p>
<p>For example, to load all columns in <code class="codeph">ParttimeEmployee</code>, you must describe and count five object attributes to load into: <code class="codeph">Name</code>, <code class="codeph">Address</code>, <code class="codeph">Manager</code>, <code class="codeph">Deptid</code>, and <code class="codeph">Hours.</code></p>
<div class="infoboxnotealso" id="GUID-EAF14E36-0523-4C20-ACC1-BBA8097EB0E0__GUID-EFCE1B21-54B9-4E9E-976E-29B3CE03D922">
<p class="notep1">See Also:</p>
<p><a class="olink ADOBJ7103" target="_blank" href="../ADOBJ/adobjbas.htm#ADOBJ7103"><span><cite>Oracle Database Object-Relational Developer&#39;s Guide</cite></span></a> for more information about defining <code class="codeph">FINAL</code> and <code class="codeph">NOT FINAL</code> types.</p>
</div>
</div>
</div>
<a id="LNOCI16955"></a>
<div class="props_rev_3"><a id="GUID-68DE4F77-4C16-4436-B1D6-CA4E471B1CE2"></a>
<h4 id="LNOCI-GUID-68DE4F77-4C16-4436-B1D6-CA4E471B1CE2" class="sect4">About Describing a Fixed, Derived Type to Be Loaded</h4>
<div>
<p>Note that the steps to describe a <code class="codeph">NOT FINAL</code> or substitutable object columns and <code class="codeph">REF</code> columns of a fixed, derived type are similar to the steps that describe its <code class="codeph">FINAL</code> counterpart.</p>
<p>These sections describe a <code class="codeph">FINAL</code> column of this type. Because the derived type (could be a supertype or a subtype) is fixed for the duration of the load, the client interface for describing a <code class="codeph">NOT FINAL</code> column is the same as for describing a <code class="codeph">FINAL</code> column.</p>
<p>A subtype can be thought of as a flattened representation of all the object attributes that are unique to this type plus all the attributes of its ancestors. Therefore, any of these attribute columns that are to be loaded into must be described and counted.</p>
<div class="infoboxnotealso" id="GUID-68DE4F77-4C16-4436-B1D6-CA4E471B1CE2__GUID-539E9049-B579-456C-ACDB-97B83387014A">
<p class="notep1">See Also:</p>
<p><a href="oci13obn.htm#GUID-F155292D-2DBE-4EC3-A2F1-4D567DFC1E4E" title="A column object is a table column that is defined as an object.">Direct Path Loading of Column Objects</a> or <a href="oci13obn.htm#GUID-2CE26A43-4193-4C8D-9C12-77A943811958" title="The REF type is a pointer, or reference, to a row object in an object table.">Direct Path Loading of REF Columns</a> for information about how to describe a <code class="codeph">NOT FINAL</code> column of type X (where X is an object or a <code class="codeph">REF</code>)</p>
</div>
</div>
</div>
<a id="LNOCI16956"></a>
<div class="props_rev_3"><a id="GUID-BE30BD66-BF95-4E29-9335-0249E3C3C41B"></a>
<h4 id="LNOCI-GUID-BE30BD66-BF95-4E29-9335-0249E3C3C41B" class="sect4">About Allocating the Column Array</h4>
<div>
<p>Allocating the column array is the same as for a <code class="codeph">FINAL</code> column of the same type.</p>
</div>
</div>
<a id="LNOCI16957"></a>
<div class="props_rev_3"><a id="GUID-4C7BA004-49EE-4E66-9829-C00335812363"></a>
<h4 id="LNOCI-GUID-4C7BA004-49EE-4E66-9829-C00335812363" class="sect4">About Loading the Data into the Column Array</h4>
<div>
<p>Loading the data into the column array is the same as for a <code class="codeph">FINAL</code> column of the same type.</p>
</div>
</div>
</div>
<a id="LNOCI72755"></a><a id="LNOCI72756"></a><a id="LNOCI72758"></a><a id="LNOCI72757"></a><a id="LNOCI16958"></a>
<div class="props_rev_3"><a id="GUID-8C639AF1-1A8B-4BAA-A02E-FF4F8B37BD38"></a>
<h3 id="LNOCI-GUID-8C639AF1-1A8B-4BAA-A02E-FF4F8B37BD38" class="sect3">Direct Path Loading of Object Tables</h3>
<div>
<p>An object table is a table in which each row is an object (or row object). Each column in the table is an object attribute.</p>
<div class="section">
<p class="subhead3">Describing an Object Table</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Describing an object table is very similar to describing a non-object table. Each object attribute is a column in the table. The only difference is that you may need to describe the OID, which could be system-generated, user-generated, or primary-key-based.</p>
<p>To describe an object table:</p>
<div class="infobox-note" id="GUID-8C639AF1-1A8B-4BAA-A02E-FF4F8B37BD38__GUID-750904BD-D018-4D13-BBE5-F7BB616F25F7">
<p class="notep1">Note:</p>
<p>Steps that are different from loading a non-object table are in italic.</p>
</div>
<p><span class="italic">For each object attribute column:</span></p>
<p>Describe each object attribute column as it must be described, depending on its type (for example, <code class="codeph">NUMBER</code>, <code class="codeph">REF</code>):</p>
<p><span class="italic">For the object table OID (Oracle Internet Directory):</span></p>
<ol>
<li>
<p><span class="italic">If the object ID is system-generated:</span></p>
<p><span class="italic">There is nothing extra to do. The system generates OIDs for each row object.</span></p>
</li>
<li>
<p><span class="italic">If the object ID is user-generated:</span></p>
<ol>
<li>
<p><span class="italic">Use a dummy name to represent the column name for the OID (for example, &#34;cust_oid&#34;).</span></p>
</li>
<li>
<p><span class="italic">Set the OID column attribute with OCI_ATTR_DIRPATH_OID.</span></p>
</li>
</ol>
</li>
<li>
<p><span class="italic">If the object ID is primary-key-based:</span></p>
<ol>
<li>
<p><span class="italic">Load all of the primary-key columns making up the OID.</span></p>
</li>
<li>
<p><span class="italic">Do not set OCI_ATTR_DIRPATH_OID, because no OID column with a dummy name was created.</span></p>
</li>
</ol>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Allocating the Column Array for the Object Table</p>
</div>
<!-- class="section" -->
<div class="section">
<p><a href="oci13obn.htm#GUID-8C639AF1-1A8B-4BAA-A02E-FF4F8B37BD38__CACDAFEE">Example 13-21</a> shows that allocating the column array for the object table is the same as allocating a column array for a non-object table.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Loading Data into the Column Array</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Loading data into the column array is the same as loading data into a non-object table.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-8C639AF1-1A8B-4BAA-A02E-FF4F8B37BD38__CACDAFEE">
<p class="titleinexample">Example 13-21 Allocating the Column Array for the Object Table</p>
<pre dir="ltr">OCIDirPathColArray *dpca;  /* direct path column array */
sword error;

error = OCIHandleAlloc((void  *)dpctx, (void  **)&amp;dpca,
                       OCI_HTYPE_DIRPATH_COLUMN_ARRAY,
                       (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI72759"></a><a id="LNOCI72760"></a><a id="LNOCI16962"></a>
<div class="props_rev_3"><a id="GUID-04BF14FF-1FF4-4F3A-BBB8-EA2500471DDF"></a>
<h3 id="LNOCI-GUID-04BF14FF-1FF4-4F3A-BBB8-EA2500471DDF" class="sect3">Direct Path Loading a NOT FINAL Object Table</h3>
<div>
<p>A <code class="codeph">NOT FINAL</code> object table supports inheritance and a <code class="codeph">FINAL</code> object table cannot.</p>
<div class="section">
<p class="subhead3">Describing a NOT FINAL Object Table</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Describing a <code class="codeph">NOT FINAL</code> object table of a fixed derived type is very similar to describing a <code class="codeph">FINAL</code> object table.</p>
<p>To describe a <code class="codeph">NOT FINAL</code> object table of a fixed derived type:</p>
<div class="infobox-note" id="GUID-04BF14FF-1FF4-4F3A-BBB8-EA2500471DDF__GUID-95C4ACBF-922F-4845-9AC5-F57F374145DB">
<p class="notep1">Note:</p>
<p>Steps that are different from describing a <code class="codeph">FINAL</code> object table are in italic.</p>
</div>
<ol>
<li>
<p><span class="italic">Set the object table&#39;s object type in the direct path context with OCI_ATTR_DIRPATH_OBJ_CONSTR. This indicates that the object type, whether it is a supertype or a derived type, are used as the default object constructor when loading to this table for the duration of the load.</span></p>
<pre dir="ltr">text *obj_type;            /* the object type to load into this NOT FINAL */
                           /* object table */
sword error;

error = OCIAttrSet((void  *)dpctx,
                   OCI_HTYPE_DIRPATH_CTX,
                   (void  *) obj_type,
                   (ub4)strlen((const char *) obj_type),
                   OCI_ATTR_DIRPATH_OBJ_CONSTR, ctlp-&gt;errhp_ctl);
</pre></li>
<li>
<p>Describe according to its data type each of the object attribute columns to be loaded. Describe the object ID, if needed. This is the same as describing a <code class="codeph">FINAL</code> object table.</p>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Allocating the Column Array for the NOT FINAL Object Table</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Allocating the column array for the <code class="codeph">NOT FINAL</code> object table is the same as for a <code class="codeph">FINAL</code> object table.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="LNOCI16965"></a>
<div class="props_rev_3"><a id="GUID-A2811AF9-FD71-49E7-9658-931C9C73B363"></a>
<h2 id="LNOCI-GUID-A2811AF9-FD71-49E7-9658-931C9C73B363" class="sect2">Direct Path Loading in Pieces</h2>
<div>
<p>To support loading data that does not all fit in memory at one time, use loading in pieces.</p>
<div class="section">
<p>The direct path API supports loading <code class="codeph">LONG</code>s and LOBs incrementally. This is accomplished through the following steps:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Set the first piece into the column array using <code class="codeph">OCIDirPathColArrayEntrySet()</code> and passing in the <code class="codeph">OCI_DIRPATH_COL_PARTIAL</code> flag to indicate that all the data for this column has not been loaded yet.</span></li>
<li><span>Convert the column array to a stream.</span></li>
<li><span>Load the stream.</span></li>
<li><span>Set the next piece of that data into the column array. If it is not complete, set the partial flag and go back to Step 2. If it is complete, then set the <code class="codeph">OCI_DIRPATH_COL_COMPLETE</code> flag and continue to the next column.</span></li>
</ol>
<div class="section">
<p>This approach is essentially the same for dealing with large attributes for column objects and large arguments for SQL string types.</p>
<div class="infobox-note" id="GUID-A2811AF9-FD71-49E7-9658-931C9C73B363__GUID-C8C0D3A0-3557-443B-8BCB-B39029A52375">
<p class="notep1">Note:</p>
<p>Collections are not loaded in pieces, as such. Nested tables are loaded separately and are loaded like a top-level table. Nested tables can be loaded incrementally and can have columns that are loaded in pieces. Therefore, do not set the <code class="codeph">OCI_DIRPATH_COL_PARTIAL</code> flag for the column containing the collection.</p>
<p>This section includes the following topic: <a href="oci13obn.htm#GUID-6A934E62-30AA-40CF-9469-61075AE9845E" title="Objects are loaded into a separate column array from the parent table that contains them.">Loading Object Types in Pieces</a>.</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-A2811AF9-FD71-49E7-9658-931C9C73B363__GUID-0326ED44-459B-4B85-806F-3659D8A38961">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-C67EFBE6-677E-4E3C-8024-8412857C3BE0">OCI_DIRPATH_COL_ERROR</a> for more information about passing the <code class="codeph">OCI_DIRPATH_COL_ERROR</code> value to <code class="codeph">OCIDirPathColArrayEntry()</code> to indicate that the current column array row should be ignored when an error occurs</p>
</li>
<li>
<p><a href="oci17msc004.htm#GUID-4E4E74F4-3F15-4176-8229-C5783DC3811D">OCIDirPathColArrayEntrySet()</a></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
<a id="LNOCI16966"></a>
<div class="props_rev_3"><a id="GUID-6A934E62-30AA-40CF-9469-61075AE9845E"></a>
<h3 id="LNOCI-GUID-6A934E62-30AA-40CF-9469-61075AE9845E" class="sect3">Loading Object Types in Pieces</h3>
<div>
<p>Objects are loaded into a separate column array from the parent table that contains them.</p>
<div class="section">
<p>Therefore, when they need to be loaded in pieces you must set the elements in the child column array up to and including the pieced element.</p>
<p>The general steps are:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>For the pieced element, set the <code class="codeph">OCI_DIRPATH_COL_PARTIAL</code> flag.</span></li>
<li><span>Set the child column array handle into the parent column array and mark that entry with the <code class="codeph">OCI_DIRPATH_COL_PARTIAL</code> flag as well.</span></li>
<li><span>Convert the parent column array to a stream. This converts the child column array as well.</span></li>
<li><span>Load the stream.</span></li>
<li><span>Go back to Step 1 and continue loading the remaining data for that element until it is complete.</span></li>
</ol>
<div class="section">
<p>Here are some rules about loading in pieces:</p>
<ul style="list-style-type: disc;">
<li>
<p>There can only be one partial element at a time at any level. Once one partial element is marked complete, then another one at that level can be partial.</p>
</li>
<li>
<p>If an element is partial and it is not top-level, then all of its ancestors up the containment hierarchy must be marked partial as well.</p>
</li>
<li>
<p>If there are multiple levels of nesting, it is necessary to go up to a level where the data can be converted into a stream. This is a top-level table.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-6A934E62-30AA-40CF-9469-61075AE9845E__GUID-4E84B9BD-4967-4B0A-894D-8322955704D4">
<p class="notep1">See Also:</p>
<p><a href="oci13obn.htm#GUID-C67EFBE6-677E-4E3C-8024-8412857C3BE0">OCI_DIRPATH_COL_ERROR</a> for more information about passing the <code class="codeph">OCI_DIRPATH_COL_ERROR</code> value to <code class="codeph">OCIDirPathColArrayEntry()</code> to indicate that the current column array row should be ignored when an error occurs.</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="LNOCI16967"></a>
<div class="props_rev_3"><a id="GUID-E66F9F47-5465-481F-8CBE-E2B00194E102"></a>
<h2 id="LNOCI-GUID-E66F9F47-5465-481F-8CBE-E2B00194E102" class="sect2">Direct Path Context Handles and Attributes for Object Types</h2>
<div>
<p>The following discussion gives the supplemental details of the handles and attributes.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-24206542-CD29-4FAE-826E-B8A31F8C5789" title="There is one direct path context attribute.">Direct Path Context Attributes</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-2A9A675D-B914-4A61-B0A3-C0B455EA7E26" title="Here is a summary of the attributes for function context handles.">Direct Path Function Context and Attributes</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-49105A08-EFF7-4FEE-A457-FE6ABB29851E" title="When you describe an object, SQL string, or REF column, one of its column attributes is a function context.">Direct Path Column Parameter Attributes</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-56DA52A3-8A3B-496F-8267-D6EF4C5427B1" title="The handle type OCI_HTYPE_DIRPATH_FN_COL_ARRAY is used if the column is an object, SQL string, or REF.">Direct Path Function Column Array Handle for Nonscalar Columns</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-E66F9F47-5465-481F-8CBE-E2B00194E102__GUID-631DCF59-BDAA-4DDD-B279-28E3052BEBB0">
<p class="notep1">See Also:</p>
<p><a href="ociaahan.htm#GUID-CB59C987-07E7-42D4-ADDF-96142CBD3D11" title="This appendix describes the attributes for OCI handles and descriptors.">Handle and Descriptor Attributes</a> for a discussion that gives the supplemental details of the handles and attributes</p>
</div>
</div>
<a id="LNOCI16968"></a>
<div class="props_rev_3"><a id="GUID-24206542-CD29-4FAE-826E-B8A31F8C5789"></a>
<h3 id="LNOCI-GUID-24206542-CD29-4FAE-826E-B8A31F8C5789" class="sect3">Direct Path Context Attributes</h3>
<div>
<p>There is one direct path context attribute.</p>
<div class="infoboxnotealso" id="GUID-24206542-CD29-4FAE-826E-B8A31F8C5789__GUID-B4E49628-8A7E-4A56-AE30-6EBABB876752">
<p class="notep1">See Also:</p>
<p><a href="oci13obn.htm#GUID-455EEEFF-312F-4B7D-A7EF-DE23FF69E5D0">OCI_ATTR_DIRPATH_OBJ_CONSTR</a> is the only direct path context attribute</p>
</div>
</div>
<a id="LNOCI16969"></a>
<div class="props_rev_3"><a id="GUID-455EEEFF-312F-4B7D-A7EF-DE23FF69E5D0"></a>
<h4 id="LNOCI-GUID-455EEEFF-312F-4B7D-A7EF-DE23FF69E5D0" class="sect4">OCI_ATTR_DIRPATH_OBJ_CONSTR</h4>
<div>
<p>Indicates the object type to load into a <code class="codeph">NOT FINAL</code> object table.</p>
<pre dir="ltr">ttext *obj_type;            /* the object type to load into this NOT FINAL */
                           /* object table */
sword error;

error = OCIAttrSet((void  *)dpctx,
                   OCI_HTYPE_DIRPATH_CTX,
                   (void  *) obj_type,
                   (ub4)strlen((const char *) obj_type),
                   OCI_ATTR_DIRPATH_OBJ_CONSTR, ctlp-&gt;errhp_ctl);
</pre></div>
</div>
</div>
<a id="LNOCI16970"></a>
<div class="props_rev_3"><a id="GUID-2A9A675D-B914-4A61-B0A3-C0B455EA7E26"></a>
<h3 id="LNOCI-GUID-2A9A675D-B914-4A61-B0A3-C0B455EA7E26" class="sect3">Direct Path Function Context and Attributes</h3>
<div>
<p>Here is a summary of the attributes for function context handles.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-9092B214-63E1-4DD3-AF84-288A6DE85554">OCI_ATTR_DIRPATH_OBJ_CONSTR</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-ED73E051-3467-4498-8659-01E595F6A272">OCI_ATTR_NAME</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-3D326302-0366-476F-A6E6-F94F872C7833">OCI_ATTR_DIRPATH_EXPR_TYPE</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-39F85D35-2B27-4FF3-AE83-828E1090C5D3" title="When OCI_ATTR_DIRPATH_NO_INDEX_ERRORS is 1, indexes are not set unusable at any time during the load.">OCI_ATTR_DIRPATH_NO_INDEX_ERRORS</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-286D5D9F-EC97-4013-8EC9-00F3588AD383">OCI_ATTR_NUM_COLS</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-3426FD61-9AF7-4F73-8C20-9AF46B98971F">OCI_ATTR_NUM_ROWS</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-2A9A675D-B914-4A61-B0A3-C0B455EA7E26__GUID-B448889C-6C02-4991-9096-7218488B7042">
<p class="notep1">See Also:</p>
<p><a href="ociaahan.htm#GUID-07F0F31C-94FF-4E3B-B8E1-C2394CB94390">Direct Path Context Handle (OCIDirPathCtx) Attributes</a></p>
</div>
</div>
<a id="LNOCI16971"></a>
<div class="props_rev_3"><a id="GUID-9092B214-63E1-4DD3-AF84-288A6DE85554"></a>
<h4 id="LNOCI-GUID-9092B214-63E1-4DD3-AF84-288A6DE85554" class="sect4">OCI_ATTR_DIRPATH_OBJ_CONSTR</h4>
<div>
<p>Indicates the object type to load into a substitutable object table.</p>
<pre dir="ltr">text *obj_type; /* stores an object type name */
sword error;

error = OCIAttrSet((void  *)dpctx,
                   OCI_HTYPE_DIRPATH_CTX,
                   (void  *) obj_type,
                   (ub4)strlen((const char *) obj_type),
                   OCI_ATTR_DIRPATH_OBJ_CONSTR, ctlp-&gt;errhp_ctl);
</pre></div>
</div>
<a id="LNOCI72761"></a><a id="LNOCI72762"></a><a id="LNOCI72763"></a><a id="LNOCI16972"></a>
<div class="props_rev_3"><a id="GUID-ED73E051-3467-4498-8659-01E595F6A272"></a>
<h4 id="LNOCI-GUID-ED73E051-3467-4498-8659-01E595F6A272" class="sect4">OCI_ATTR_NAME</h4>
<div>
<p>When a function context is created, set <code class="codeph">OCI_ATTR_NAME</code> equal to the expression that describes the nonscalar column. Then set an OCI attribute to indicate the type of the expression. The expression type varies depending on whether it is a column object, a <code class="codeph">REF</code> column, or a SQL string column.</p>
<div class="section">
<p class="subhead3">Column Objects</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This required expression is the object type name. The object type is used as the default object constructor.</p>
<p>Set the expression type <code class="codeph">OCI_ATTR_DIRPATH_EXPR_TYPE</code> to <code class="codeph">OCI_DIRPATH_EXPR_OBJ_CONSTR</code> to indicate that this expression is an object type name.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">REF Columns</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This optional expression is the reference table name. This table is the object table from which the <code class="codeph">REF</code> column is to reference row objects.</p>
<p>Set the expression type <code class="codeph">OCI_ATTR_DIRPATH_EXPR_TYPE</code> to <code class="codeph">OCI_DIRPATH_EXPR_REF_TBLNAME</code> to indicate that this expression is a reference object table.</p>
<p>The behavior for this parameter, set or not set, varies for each <code class="codeph">REF</code> type.</p>
<ul style="list-style-type: disc;">
<li>
<p>Unscoped <code class="codeph">REF</code> columns (unscoped, system-OID-based):</p>
<ul style="list-style-type: disc;">
<li>
<p>If not set, then by the definition of an &#34;unscoped&#34; <code class="codeph">REF</code> column, this <code class="codeph">REF</code> column must have a reference table name as its argument for every data row.</p>
</li>
<li>
<p>If set, this <code class="codeph">REF</code> column can only refer to row objects from this specified object table for the duration of the load. The <code class="codeph">REF</code> column is not allowed to have a reference table name as its argument. (Direct path API provides this parameter as a shortcut for the users who will be loading to an unscoped <code class="codeph">REF</code> column that refers to the same reference object table during the entire load.)</p>
</li>
</ul>
</li>
<li>
<p>Scoped <code class="codeph">REF</code>columns (scoped, system-OID-based and primary-key-based):</p>
<ul style="list-style-type: disc;">
<li>
<p>If not set, the direct path API uses the reference table specified in the schema.</p>
</li>
<li>
<p>If set, the reference table name must match the object table specified in the schema for this scoped <code class="codeph">REF</code> column. An error occurs if the table names do not match.</p>
</li>
<li>
<p>Whether this parameter is set or not, it does not matter to the API whether this reference table name is in the data row or not. If the name is in the data row, it must match the table name specified in the schema. If it is not in the data row, the API uses the reference table defined in the schema.</p>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">SQL String Columns</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This mandatory expression contains a SQL string to derive the value that is to be stored in the column.</p>
<p>Set the expression type <code class="codeph">OCI_ATTR_DIRPATH_EXPR_TYPE</code> to <code class="codeph">OCI_DIRPATH_EXPR_SQL</code> to indicate that this expression is a SQL string.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI72764"></a><a id="LNOCI16973"></a>
<div class="props_rev_3"><a id="GUID-3D326302-0366-476F-A6E6-F94F872C7833"></a>
<h4 id="LNOCI-GUID-3D326302-0366-476F-A6E6-F94F872C7833" class="sect4">OCI_ATTR_DIRPATH_EXPR_TYPE</h4>
<div>
<p>This attribute is used to indicate the type of the expression specified in <code class="codeph">OCI_ATTR_NAME</code> for the nonscalar column&#39;s function context.</p>
<p>If <code class="codeph">OCI_ATTR_NAME</code> is set, then <code class="codeph">OCI_ATTR_DIRPATH_EXPR_TYPE</code> is required.</p>
<p>The possible values for <code class="codeph">OCI_ATTR_DIRPATH_EXPR_TYPE</code> are:</p>
<ul style="list-style-type: disc;">
<li>
<p><a id="d145923e10424" class="indexterm-anchor"></a><code class="codeph">OCI_DIRPATH_EXPR_OBJ_CONSTR</code></p>
<ul style="list-style-type: disc;">
<li>
<p>Indicates that the expression is an object type name and is to be used as the default object constructor for a column object.</p>
</li>
<li>
<p>Is required for column objects.</p>
</li>
</ul>
</li>
<li>
<p><a id="d145923e10437" class="indexterm-anchor"></a><code class="codeph">OCI_DIRPATH_EXPR_REF_TBLNAME</code></p>
<ul style="list-style-type: disc;">
<li>
<p>Indicates that the expression is a reference object table name. This table is the object table from which the <code class="codeph">REF</code> column is referencing row objects.</p>
</li>
<li>
<p>Is optional for <code class="codeph">REF</code> columns.</p>
</li>
</ul>
</li>
<li>
<p><a id="d145923e10456" class="indexterm-anchor"></a><code class="codeph">OCI_DIRPATH_EXPR_SQL</code></p>
<ul style="list-style-type: disc;">
<li>
<p>Indicates that the expression is a SQL string that is executed to derive a value to be stored in the column.</p>
</li>
<li>
<p>Is required for SQL string columns.</p>
</li>
</ul>
</li>
</ul>
<p><a href="oci13obn.htm#GUID-3D326302-0366-476F-A6E6-F94F872C7833__CACBHCFG">Example 13-22</a> shows the pseudocode that illustrates the preceding rules and values.</p>
<div class="example" id="GUID-3D326302-0366-476F-A6E6-F94F872C7833__CACBHCFG">
<p class="titleinexample">Example 13-22 Specifying Values for the OCI_ATTR_DIRPATH_EXPR_TYPE Attribute</p>
<pre dir="ltr">OCIDirPathFuncCtx  *dpfnctx; /* function context for this nonscalar column */
ub1 expr_type; /* expression type */
sword error;

if (...) /* (column type is an object) */
expr_type = OCI_DIRPATH_EXPR_OBJ_CONSTR;
...
if (...) /* (column type is a REF &amp;&amp; function context name exists) */
expr_type = OCI_DIRPATH_EXPR_REF_TBLNAME;
...
if (...) /* (column type is a SQL string) */
expr_type = OCI_DIRPATH_EXPR_SQL;
...
error = OCIAttrSet((void  *)(dpfnctx),
                   OCI_HTYPE_DIRPATH_FN_CTX,
                   (void  *)&amp;expr_type, (ub4)0,
                   OCI_ATTR_DIRPATH_EXPR_TYPE, ctlp-&gt;errhp_ctl);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI16974"></a>
<div class="props_rev_3"><a id="GUID-39F85D35-2B27-4FF3-AE83-828E1090C5D3"></a>
<h4 id="LNOCI-GUID-39F85D35-2B27-4FF3-AE83-828E1090C5D3" class="sect4">OCI_ATTR_DIRPATH_NO_INDEX_ERRORS</h4>
<div>
<p>When <code class="codeph">OCI_ATTR_DIRPATH_NO_INDEX_ERRORS</code> is 1, indexes are not set unusable at any time during the load.</p>
<p>If any index errors are detected, the load is terminated. That is, no rows are loaded, and the indexes are left as is. The default is 0.</p>
<div class="infoboxnotealso" id="GUID-39F85D35-2B27-4FF3-AE83-828E1090C5D3__GUID-AFF01947-D645-49F2-8A7E-DA483AA3B98F">
<p class="notep1">See Also:</p>
<p><a href="ociaahan.htm#GUID-07F0F31C-94FF-4E3B-B8E1-C2394CB94390__BAJGFDEH">OCI_ATTR_DIRPATH_NO_INDEX_ERRORS</a></p>
</div>
</div>
</div>
<a id="LNOCI72765"></a><a id="LNOCI72766"></a><a id="LNOCI72767"></a><a id="LNOCI16975"></a>
<div class="props_rev_3"><a id="GUID-286D5D9F-EC97-4013-8EC9-00F3588AD383"></a>
<h4 id="LNOCI-GUID-286D5D9F-EC97-4013-8EC9-00F3588AD383" class="sect4">OCI_ATTR_NUM_COLS</h4>
<div>
<p>This attribute describes the number of attributes or arguments that are to be loaded or processed for a nonscalar column. This parameter must be set before the column list can be retrieved. The expression type varies depending on whether it is a column object, a SQL string column, or a <code class="codeph">REF</code> column.</p>
<div class="section">
<p class="subhead3">Column Objects</p>
</div>
<!-- class="section" -->
<div class="section">
<p>The number of object attribute columns to be loaded for this column object.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">SQL String Columns</p>
</div>
<!-- class="section" -->
<div class="section">
<p>The number of arguments to be passed to the SQL string.</p>
<p>If an argument is used multiple times in the function, counting it as one is correct.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">REF Columns</p>
</div>
<!-- class="section" -->
<div class="section">
<p>The number of <code class="codeph">REF</code> arguments to identify the row object the <code class="codeph">REF</code> column should point to.</p>
<p>The number of arguments required varies for the <code class="codeph">REF</code> column type:</p>
<ul style="list-style-type: disc;">
<li>
<p>Unscoped <code class="codeph">REF</code> columns (unscoped, system-OID-based <code class="codeph">REF</code> columns):</p>
<ul style="list-style-type: disc;">
<li>
<p>If <code class="codeph">OCI_DIRPATH_EXPR_REF_TBLNAME</code> is used. None for the reference table name, and one for the OID value. (Only the OID values are in the data rows.)</p>
</li>
<li>
<p>If <code class="codeph">OCI_DIRPATH_EXPR_REF_TBLNAME</code> is not used. One for the reference table name, and one for the OID value. (Both the reference table names and the OID values are in the data rows.)</p>
</li>
</ul>
</li>
<li>
<p>Scoped <code class="codeph">REF</code> columns (scoped, system-OID-based and primary-key-based):</p>
<ul style="list-style-type: disc;">
<li>
<p>N or N+1 are acceptable, where N is the number of columns making up the object ID, regardless if <code class="codeph">OCI_DIRPATH_EXPR_REF_TBLNAME</code> is used or not. The minimum is N if the reference table name is not in the data row. Use N+1 if the reference table name is in the data row.</p>
</li>
<li>
<p>If the <code class="codeph">REF</code> is system-OID-based, then N is 1. If the <code class="codeph">REF</code> is primary-key-based, then N is the number of component columns that make up the primary key. If the reference table name is in the data row, then add 1 to N.</p>
</li>
</ul>
<div class="infobox-note" id="GUID-286D5D9F-EC97-4013-8EC9-00F3588AD383__GUID-91896311-B279-47C4-B237-CBFEE3722195">
<p class="notep1">Note:</p>
<p>To simplify the error message if you pass in some <code class="codeph">REF</code> arguments other than N or N+1, the error message says that it found so-and-so number of arguments when it expects N. Although N+1 is not stated in the message, N+1 is acceptable (even though the reference table name is not needed) and does not invoke an error message.</p>
</div>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI16976"></a>
<div class="props_rev_3"><a id="GUID-3426FD61-9AF7-4F73-8C20-9AF46B98971F"></a>
<h4 id="LNOCI-GUID-3426FD61-9AF7-4F73-8C20-9AF46B98971F" class="sect4">OCI_ATTR_NUM_ROWS</h4>
<div>
<p>This attribute, when used for an <code class="codeph">OCI_HTYPE_DIRPATH_FN_CTX</code> (function context), is retrievable only, and cannot be set by the user. You can only use this attribute in <a href="oci16rel002.htm#GUID-FA199A99-4D7A-42C2-BB0A-C20047B95DF9" title="Gets the value of an attribute of a handle.">OCIAttrGet()</a> and not <a href="oci16rel002.htm#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a>. When <a href="oci16rel002.htm#GUID-FA199A99-4D7A-42C2-BB0A-C20047B95DF9" title="Gets the value of an attribute of a handle.">OCIAttrGet()</a> is called with OCI_ATTR_NUM_ROWS, the number of rows loaded so far is returned.</p>
<p>However, the attribute <code class="codeph">OCI_ATTR_NUM_ROWS</code>, when used for an <code class="codeph">OCI_HTYPE_DIRPATH_CTX</code> (table-level context), can be both set and retrieved by the user.</p>
<p>Calling <a href="oci16rel002.htm#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a> with <code class="codeph">OCI_ATTR_NUM_ROWS</code> and <code class="codeph">OCI_HTYPE_DIRPATH_CTX</code> sets the number of rows to be allocated for the table-level column array. If not set, the direct path API code derives a &#34;reasonable&#34; number based on the maximum record size and the transfer buffer size. To see how many rows were allocated, call <a href="oci16rel002.htm#GUID-FA199A99-4D7A-42C2-BB0A-C20047B95DF9" title="Gets the value of an attribute of a handle.">OCIAttrGet()</a> with <code class="codeph">OCI_ATTR_NUM_ROWS</code> on <code class="codeph">OCI_HTYPE_DIRPATH_COLUMN_ARRAY</code> for a table-level column array, and with <a id="d145923e11106" class="indexterm-anchor"></a><code class="codeph">OCI_HTYPE_DIRPATH_FN_COL_ARRAY</code> for a function column array.</p>
<p>Calling <a href="oci16rel002.htm#GUID-FA199A99-4D7A-42C2-BB0A-C20047B95DF9" title="Gets the value of an attribute of a handle.">OCIAttrGet()</a> with <code class="codeph">OCI_ATTR_NUM_ROWS</code> and <code class="codeph">OCI_HTYPE_DIRPATH_CTX</code> returns the number of rows loaded so far.</p>
<p>This attribute cannot be set by the user for a function context. You are not allowed to specify the number of rows desired in a function column array through <code class="codeph">OCI_ATTR_NUM_ROWS</code> with <a href="oci16rel002.htm#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a> because then all function column arrays will have the same number of rows as the table-level column array. Thus this attribute can only be set for a table-level context and not for a function context.</p>
</div>
</div>
</div>
<a id="LNOCI72768"></a><a id="LNOCI16977"></a>
<div class="props_rev_3"><a id="GUID-49105A08-EFF7-4FEE-A457-FE6ABB29851E"></a>
<h3 id="LNOCI-GUID-49105A08-EFF7-4FEE-A457-FE6ABB29851E" class="sect3">Direct Path Column Parameter Attributes</h3>
<div>
<p>When you describe an object, SQL string, or <code class="codeph">REF</code> column, one of its column attributes is a function context.</p>
<p>If a column is an object, then its function context describes its object type and object attributes. If the column is a SQL string, then its function context describes the expression to be called. If the column is a REF, its function context describes the reference table name and row object identifiers.</p>
<p><a href="oci13obn.htm#GUID-49105A08-EFF7-4FEE-A457-FE6ABB29851E__CACGEACB">Example 13-23</a> shows that when you set a function context as a column attribute, <code class="codeph">OCI_ATTR_DIRPATH_FN_CTX</code> is used in the <code class="codeph">OCIAttrSet()</code> call.</p>
<p>Attributes for column parameter context handles follow.</p>
<div class="example" id="GUID-49105A08-EFF7-4FEE-A457-FE6ABB29851E__CACGEACB">
<p class="titleinexample">Example 13-23 Setting a Function Context as a Column Attribute</p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
sword error;

error = OCIAttrSet((void  *)colDesc,
                   OCI_DTYPE_PARAM,
                   (void  *)(dpfnctx), (ub4)0,
                   OCI_ATTR_DIRPATH_FN_CTX, ctlp-&gt;errhp_ctl);
</pre></div>
<!-- class="example" -->
<div class="section">
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci13obn.htm#GUID-E24516A9-6CAB-4524-BEF1-D9A9B5A65CD1">OCI_ATTR_NAME</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-57923468-BE53-468B-96B9-7D6568632D74">OCI_ATTR_DIRPATH_SID</a></p>
</li>
<li>
<p><a href="oci13obn.htm#GUID-80ACA14B-1493-4A87-9ACE-D33975DCD68A">OCI_ATTR_DIRPATH_OID</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-49105A08-EFF7-4FEE-A457-FE6ABB29851E__GUID-766E3390-405D-4C8C-A7DB-CC2AEA65465B">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="ociaahan.htm#GUID-CAC89BC1-BB9A-4E49-A473-81AE0538DD8D" title="Describes how direct path column parameter attributes are used.">Direct Path Column Parameter Attributes</a></p>
</li>
<li>
<p><a href="oci16rel002.htm#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a></p>
</li>
</ul>
</div>
</div>
</div>
<!-- class="section" --></div>
<a id="LNOCI16978"></a>
<div class="props_rev_3"><a id="GUID-E24516A9-6CAB-4524-BEF1-D9A9B5A65CD1"></a>
<h4 id="LNOCI-GUID-E24516A9-6CAB-4524-BEF1-D9A9B5A65CD1" class="sect4">OCI_ATTR_NAME</h4>
<div>
<p>The naming conventions for loading nested tables, object tables, SQL string columns, and <code class="codeph">REF</code> columns are described in the following paragraphs.</p>
<p>In general, a dummy column name is used if you are loading data into a column that is a system column with a system name that you are not aware of (for example, an object table&#39;s system-generated object ID (<code class="codeph">OID</code>) column or a nested table&#39;s <code class="codeph">SETID</code> (<code class="codeph">SID</code>) column) or if a column is an argument that does not have a database table column (for example, SQL string and <code class="codeph">REF</code> arguments).</p>
<p>If the column is a database table column but a dummy name was used, then a column attribute must be set so that the function can identify the column even though it is not under the name known to the database.</p>
<p>The naming rules are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>Child nested table&#39;s <code class="codeph">SETID</code> (<code class="codeph">SID</code>) column</p>
<p>The SETID column is required. Set its <code class="codeph">OCI_ATTR_NAME</code> using a dummy name, because the API does not expect the user to know its system name. Then set the column attribute with <code class="codeph">OCI_ATTR_DIRPATH_SID</code> to indicate that this is a <code class="codeph">SID</code> column.</p>
</li>
<li>
<p>Object table&#39;s object ID (<code class="codeph">OID</code>) column</p>
<p>An object ID is required if:</p>
<ol>
<li>
<p>The object ID is system-generated:</p>
<p>Use a dummy name as its column name (for example, &#34;cust_oid&#34;).</p>
<p>Set its column attribute with <code class="codeph">OCI_ATTR_DIRPATH_OID</code>. So if you have multiple columns with dummy names, you know which one represents the system-generated <code class="codeph">OID</code>.</p>
</li>
<li>
<p>The object id is primary-key-based:</p>
<p>You cannot use a dummy name as its column name. Therefore, you do not need to set its column attribute with <code class="codeph">OCI_ATTR_DIRPATH_OID</code>.</p>
</li>
</ol>
</li>
<li>
<p>SQL string argument</p>
<ol>
<li>
<p>Set the attribute&#39;s column name with <code class="codeph">OCI_ATTR_NAME</code>.</p>
</li>
<li>
<p>The order of the SQL string arguments given does not matter. The order does not have to match the order used in the SQL string.</p>
</li>
<li>
<p>Use the naming convention for SQL string arguments.</p>
<ul style="list-style-type: disc;">
<li>
<p>The argument names must match the bind variable names used in the SQL string in content but not in case. For example, if the SQL string is <code class="codeph">substr(:INPUT_STRING, 3, 5)</code>, then you can give the argument name as &#34;input_string&#34;.</p>
</li>
<li>
<p>If an argument is used multiple times in an SQL string, then you can declare it once and count it as only one argument.</p>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p><code class="codeph">REF</code> argument</p>
<ol>
<li>
<p>Set the attribute&#39;s column name using <code class="codeph">OCI_ATTR_NAME</code>.</p>
<p>The order of the <code class="codeph">REF</code> arguments does matter.</p>
<ul style="list-style-type: disc;">
<li>
<p>The reference table name comes first, if given.</p>
</li>
<li>
<p>The object ID, whether it is system-generated or primary-key-based, comes next.</p>
</li>
</ul>
</li>
<li>
<p>Use the naming convention for the <code class="codeph">REF</code> arguments.</p>
<ul style="list-style-type: disc;">
<li>
<p>For the reference table name argument, use any dummy name for its column name, for example, &#34;ref-tbl.&#34;</p>
</li>
<li>
<p>For the system-generated OID argument, use any dummy name for its column name, such as &#34;sys-OID.&#34; Note: Because this column is used as an argument and not as a column to load into, do not set this column with <code class="codeph">OCI_ATTR_DIRPATH_OID</code>.</p>
</li>
<li>
<p>For a primary-key-based object ID, list all the primary-key columns to load into. There is no need to create a dummy name for OID. The component column names, if given (see step for shortcut later), can be given in any order.</p>
</li>
</ul>
</li>
<li>
<p>Do not set the attribute column names for the object ID to use the shortcut.</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="bold">Shortcut.</span> If loading a system-OID-based <code class="codeph">REF</code> column, do not set the column name with a name. The API figures it out. But you must still set other column attributes, such as external data type.</p>
</li>
<li>
<p>If loading a primary-key <code class="codeph">REF</code> column and its primary key consists of multiple columns, the shortcut is not to set their column names. However, you must set other column attributes, such as the external data type.</p>
<div class="infobox-note" id="GUID-E24516A9-6CAB-4524-BEF1-D9A9B5A65CD1__GUID-0B775A89-551A-4231-AB40-F993A6EBEE15">
<p class="notep1">Note:</p>
<p>If the component column names are NULL, then the API code determines the column names in the position or order in which they were defined for the primary key. So, when you set column attributes other than the name, ensure that the attributes are set for the component columns in the correct order.</p>
</div>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</div>
</div>
<a id="LNOCI16979"></a>
<div class="props_rev_3"><a id="GUID-57923468-BE53-468B-96B9-7D6568632D74"></a>
<h4 id="LNOCI-GUID-57923468-BE53-468B-96B9-7D6568632D74" class="sect4">OCI_ATTR_DIRPATH_SID</h4>
<div>
<p>Indicates that a column is a nested table&#39;s <code class="codeph">SETID</code> column. Required if loading to a nested table.</p>
<pre dir="ltr">ub1 flg = 1;
sword error;

error = OCIAttrSet((void  *)colDesc, 
                   OCI_DTYPE_PARAM,
                   (void  *)&amp;flg, (ub4)0,
                   OCI_ATTR_DIRPATH_SID, ctlp-&gt;errhp_ctl);
</pre></div>
</div>
<a id="LNOCI16980"></a>
<div class="props_rev_3"><a id="GUID-80ACA14B-1493-4A87-9ACE-D33975DCD68A"></a>
<h4 id="LNOCI-GUID-80ACA14B-1493-4A87-9ACE-D33975DCD68A" class="sect4">OCI_ATTR_DIRPATH_OID</h4>
<div>
<p>Indicates that a column is an object table&#39;s object ID column.</p>
<pre dir="ltr">ub1 flg = 1;
sword error;

error = OCIAttrSet((void  *)colDesc, 
                   OCI_DTYPE_PARAM,
                   (void  *)&amp;flg, (ub4)0,
                   OCI_ATTR_DIRPATH_OID, ctlp-&gt;errhp_ctl);
</pre></div>
</div>
</div>
<a id="LNOCI72769"></a><a id="LNOCI16981"></a>
<div class="props_rev_3"><a id="GUID-56DA52A3-8A3B-496F-8267-D6EF4C5427B1"></a>
<h3 id="LNOCI-GUID-56DA52A3-8A3B-496F-8267-D6EF4C5427B1" class="sect3">Direct Path Function Column Array Handle for Nonscalar Columns</h3>
<div>
<p>The handle type <code class="codeph">OCI_HTYPE_DIRPATH_FN_COL_ARRAY</code> is used if the column is an object, SQL string, or <code class="codeph">REF</code>.</p>
<p>The structure <code class="codeph">OCIDirPathColArray</code> is the same for both scalar and nonscalar columns.</p>
<p><a href="oci13obn.htm#GUID-56DA52A3-8A3B-496F-8267-D6EF4C5427B1__CACCHAJG">Example 13-24</a> shows how to allocate a child column array for a function context.</p>
<div class="example" id="GUID-56DA52A3-8A3B-496F-8267-D6EF4C5427B1__CACCHAJG">
<p class="titleinexample">Example 13-24 Allocating a Child Column Array for a Function Context</p>
<pre dir="ltr">OCIDirPathFuncCtx *dpfnctx; /* direct path function context */
OCIDirPathColArray *dpfnca; /* direct path function column array */
sword error;

error = OCIHandleAlloc((void  *)dpfnctx, (void  **)&amp;dpfnca,
                       OCI_HTYPE_DIRPATH_FN_COL_ARRAY,
                       (size_t)0, (void  **)0);
</pre></div>
<!-- class="example" -->
<div class="section">
<p>This section includes the following topic: <a href="oci13obn.htm#GUID-5101FEF3-48EE-4C5C-9870-1E8BAFE997CF">OCI_ATTR_NUM_ROWS Attribute</a>.</p>
<div class="infoboxnotealso" id="GUID-56DA52A3-8A3B-496F-8267-D6EF4C5427B1__GUID-26E46B88-AB9B-4EC6-8E3D-2CDECAE94EF3">
<p class="notep1">See Also:</p>
<p><a href="ociaahan.htm#GUID-1AA176F1-DD77-4DB8-8619-6DBE84D05FA1">Direct Path Function Column Array Handle (OCIDirPathColArray) Attributes</a></p>
</div>
</div>
<!-- class="section" --></div>
<a id="LNOCI16982"></a>
<div class="props_rev_3"><a id="GUID-5101FEF3-48EE-4C5C-9870-1E8BAFE997CF"></a>
<h4 id="LNOCI-GUID-5101FEF3-48EE-4C5C-9870-1E8BAFE997CF" class="sect4">OCI_ATTR_NUM_ROWS Attribute</h4>
<div>
<p>This attribute, when used for an <code class="codeph">OCI_HTYPE_DIRPATH_FN_COL_ARRAY</code> (function column array), is retrievable only, and cannot be set by the user. When the <code class="codeph">OCI_ATTR_NUM_ROWS</code> attribute is called with the function <a href="oci16rel002.htm#GUID-FA199A99-4D7A-42C2-BB0A-C20047B95DF9" title="Gets the value of an attribute of a handle.">OCIAttrGet()</a>, the number of rows allocated for the function column array is returned.</p>
</div>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment6150">
<tr>
<td class="cellalignment6162">
<table class="cellalignment6155">
<tr>
<td class="cellalignment6154"><a href="oci12oty.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment6154"><a href="oci14oca.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment6164">
<table class="cellalignment6153">
<tr>
<td class="cellalignment6154"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment6154"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment6154"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment6154"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment6154"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment6154"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>