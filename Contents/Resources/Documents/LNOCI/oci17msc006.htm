<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-74914"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Transaction%20Functions"></a><title>Transaction Functions</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="transactions, functions, OCITransCommit(), OCITransDetach(), OCITransForget(), OCITransMultiPrepare(), OCITransPrepare(), OCITransRollback(), OCITransStart()"/>
<meta name="dcterms.created" content="2017-06-09T09:07:30Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Call Interface Programmer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49886-11"/>
<meta name="dcterms.isVersionOf" content="LNOCI"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="oci17msc005.htm" title="Previous" type="text/html"/>
<link rel="Next" href="oci17msc007.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49886-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-69F748A0-89C2-431C-A126-1C0DF0552084"></a> <span id="PAGE" style="display:none;">33/84</span> <!-- End Header -->
<a id="LNOCI17276"></a><a id="LNOCI166"></a>
<h1 id="LNOCI-GUID-69F748A0-89C2-431C-A126-1C0DF0552084" class="sect1">Transaction Functions</h1>
<div>
<div class="section">
<p><a href="oci17msc006.htm#GUID-69F748A0-89C2-431C-A126-1C0DF0552084__CIHFIBHC" title="This table has 2 columns. Column 1 is the OCI function name and column 2 describes its purpose.">Table 17-6</a> lists the transaction functions that are described in this section.</p>
</div>
<!-- class="section" -->
<div class="tblformalwide" id="GUID-69F748A0-89C2-431C-A126-1C0DF0552084__CIHFIBHC">
<p class="titleintable">Table 17-6 Transaction Functions</p>
<table class="cellalignment6157" title="Transaction Functions" summary="This table has 2 columns. Column 1 is the OCI function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6201" id="d207079e170">Function</th>
<th class="cellalignment6251" id="d207079e173">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6204" id="d207079e178" headers="d207079e170">
<p><span class="q">&#34;<a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a>&#34;</span></p>
</td>
<td class="cellalignment6252" headers="d207079e178 d207079e173">
<p>Commit a transaction on a service context</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6204" id="d207079e191" headers="d207079e170">
<p><span class="q">&#34;<a href="oci17msc006.htm#GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09">OCITransDetach()</a>&#34;</span></p>
</td>
<td class="cellalignment6252" headers="d207079e191 d207079e173">
<p>Detach a transaction from a service context</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6204" id="d207079e201" headers="d207079e170">
<p><span class="q">&#34;<a href="oci17msc006.htm#GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00">OCITransForget()</a>&#34;</span></p>
</td>
<td class="cellalignment6252" headers="d207079e201 d207079e173">
<p>Forget a prepared global transaction</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6204" id="d207079e211" headers="d207079e170">
<p><span class="q">&#34;<a href="oci17msc006.htm#GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7">OCITransMultiPrepare()</a> &#34;</span></p>
</td>
<td class="cellalignment6252" headers="d207079e211 d207079e173">
<p>Prepare a transaction with multiple branches in a single cell</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6204" id="d207079e221" headers="d207079e170">
<p><span class="q">&#34;<a href="oci17msc006.htm#GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3">OCITransPrepare()</a>&#34;</span></p>
</td>
<td class="cellalignment6252" headers="d207079e221 d207079e173">
<p>Prepare a global transaction for commit</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6204" id="d207079e231" headers="d207079e170">
<p><span class="q">&#34;<a href="oci17msc006.htm#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366">OCITransRollback()</a>&#34;</span></p>
</td>
<td class="cellalignment6252" headers="d207079e231 d207079e173">
<p>Roll back a transaction</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6204" id="d207079e241" headers="d207079e170">
<p><span class="q">&#34;<a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a>&#34;</span></p>
</td>
<td class="cellalignment6252" headers="d207079e241 d207079e173">
<p>Start a transaction on a service context</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<a id="LNOCI13112"></a>
<div class="props_rev_3"><a id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4"></a>
<h2 id="LNOCI-GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" class="sect2">OCITransCommit()</h2>
<div>
<p>Commits the transaction associated with a specified service context.</p>
<div class="section">
<p class="subhead2">Purpose</p>
<p>Commits the transaction associated with a specified service context.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Syntax</p>
<pre dir="ltr">sword OCITransCommit ( OCISvcCtx    *svchp,
                       OCIError     *errhp,
                       ub4           flags );
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Parameters</p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74891"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-F2FFDCD2-C177-4BE8-9989-98BCFF07B452"><!-- --></a><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74892"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-176CA3A7-9C2E-4886-B7B0-F90E94DD427C"><!-- --></a><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <code class="codeph">OCIErrorGet()</code> for diagnostic information when there is an error.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74893"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-45DB65B3-D111-49F2-8340-80B03783E248"><!-- --></a><span class="bold">flags (IN)</span></dt>
<dd>
<p>A flag used for one-phase commit optimization in global transactions.</p>
<p><code class="codeph">OCI_DEFAULT</code> - If the transaction is nondistributed, the flags parameter is ignored, and <code class="codeph">OCI_DEFAULT</code> can be passed as its value.</p>
<p><code class="codeph">OCI_TRANS_TWOPHASE</code> - OCI applications managing global transactions should pass this value to the flags parameter for a two-phase commit. The default is one-phase commit.</p>
<p><code class="codeph">OCI_TRANS_WRITEIMMED</code> - I/O is initiated by LGWR (Log Writer Process in the background) to write the (in-memory) redo buffers to the online redo logs. <code class="codeph">IMMEDIATE</code> means that the redo buffers of the transaction are written out immediately by sending a message to LGWR, which processes the message immediately.</p>
<p><code class="codeph">OCI_TRANS_WRITEBATCH</code> - No I/O is issued by LGWR to write the in-memory redo buffers of the transaction to the online redo logs. <code class="codeph">BATCH</code> means that the LGWR batches the redo buffers before initiating I/O for the entire batch. An error occurs when you specify both <code class="codeph">BATCH</code> and <code class="codeph">IMMEDIATE</code>. <code class="codeph">IMMEDIATE</code> is the default.</p>
<p><code class="codeph">OCI_TRANS_WRITEWAIT</code> - LGWR is requested to write the redo for the commit to the online redo logs, and the commit waits for the redo buffers to be written to the online redo logs. <code class="codeph">WAIT</code> means that the commit does not return until the in-memory redo buffers corresponding to the transaction are written in the (persistent) online redo logs.</p>
<p><code class="codeph">OCI_TRANS_WRITENOWAIT</code> - LGWR is requested to write the redo for the commit to the online redo logs, but the commit returns without waiting for the buffers to be written to the online redo logs. <code class="codeph">NOWAIT</code> means that the commit returns to the user before the in-memory redo buffers are flushed to the online redo logs. An error occurs when you specify both <code class="codeph">WAIT</code> and <code class="codeph">NOWAIT</code>. <code class="codeph">WAIT</code> is the default.</p>
<div class="infobox-note" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-A46BB779-9928-4668-9C5A-49164B5A3A6B">
<p class="notep1">Note:</p>
<p>There is a potential for silent transaction loss when you use <code class="codeph">OCI_TRANS_WRITENOWAIT</code>. Transaction loss occurs silently with shutdown abort, startup force, and any instance or node failure. On an Oracle RAC system, asynchronously committed changes may not be immediately available to read on other instances.</p>
</div>
<p>These last four options only affect the commit of top-level nondistributed transactions and are ignored for externally coordinated distributed transactions. They can be combined using the <code class="codeph">OR</code> operator, subject to the stated restrictions.</p>
</dd>
</dl>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Comments</p>
<p>The transaction currently associated with the service context is committed. If it is a global transaction that the server cannot commit, this call additionally retrieves the state of the transaction from the database to be returned to the user in the error handle.</p>
<p>If the application has defined multiple transactions, this function operates on the transaction currently associated with the service context. If the application is working with only the implicit local transaction created when database changes are made, that implicit transaction is committed.</p>
<p>If the application is running in the object mode, then the modified or updated objects in the object cache for this transaction are also flushed and committed.</p>
<p>Under normal circumstances, <code class="codeph">OCITransCommit()</code> returns with a status indicating that the transaction has either been committed or rolled back. With global transactions, it is possible that the transaction is now in doubt, meaning that it is neither committed nor terminated. In this case, <code class="codeph">OCITransCommit()</code> attempts to retrieve the status of the transaction from the server. The status is returned.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Example</p>
<p>The following code example demonstrates the use of a simple local transaction, as described in <span class="q">&#34;<a href="oci08sca.htm#GUID-7190D8FF-EA02-4D7B-9967-62A3FC458605" title="Many applications work with only simple local transactions.">Simple Local Transactions</a>&#34;</span>.</p>
<p>Using OCITransCommit() in a Simple Local Transaction</p>
<pre dir="ltr">int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCIStmt *stmthp;
  void      *tmp;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4) OCI_HTYPE_ERROR,
                (size_t)0, (void  **) 0);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4) OCI_HTYPE_SERVER,
                (size_t)0, (void  **) 0);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                (size_t)0, (void  **) 0);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  OCILogon(envhp, errhp, &amp;svchp, (text *)&#34;HR&#34;, strlen(&#34;HR&#34;),
                 (text *)&#34;HR&#34;, strlen(&#34;HR&#34;), 0, 0);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, &#34;UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE  EMPLOYEE_ID = 7902&#34;);

  OCIStmtPrepare(stmthp, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);
  OCITransCommit(svchp, errhp, (ub4) 0);

  /* update hr.employees employee_id=7902, increment salary again, but rollback */
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);
  OCITransRollback(svchp, errhp, (ub4) 0);
}
</pre></div>
<!-- class="section" --></div>
</div>
<a id="LNOCI17277"></a>
<div class="props_rev_3"><a id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09"></a>
<h2 id="LNOCI-GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" class="sect2">OCITransDetach()</h2>
<div>
<div class="section">
<p class="subhead2">Purpose</p>
<p>Detaches a global transaction.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Syntax</p>
<pre dir="ltr">sword OCITransDetach ( OCISvcCtx    *svchp,
                       OCIError     *errhp,
                       ub4          flags );
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Parameters</p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74894"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-5379F0BF-8DF7-42D6-B8FA-2744C8215BC0"><!-- --></a><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74895"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-8DA3D419-4C2A-4641-9367-3097C3C57FF1"><!-- --></a><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74896"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-C1F25EAD-6D17-4D95-9A91-912900F4F8C7"><!-- --></a><span class="bold">flags</span> (IN)</dt>
<dd>
<p>You must pass a value of <code class="codeph">OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Comments</p>
<p>Detaches a global transaction from the service context handle. The transaction currently attached to the service context handle becomes inactive at the end of this call. The transaction may be resumed later by calling <a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a>, specifying a flags value of <code class="codeph">OCI_TRANS_RESUME</code>.</p>
<p>When a transaction is detached, the value that was specified in the <code class="codeph">timeout</code> parameter of <a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a> when the transaction was started is used to determine the amount of time the branch can remain inactive before being deleted by the server&#39;s <code class="codeph">PMON</code> process.</p>
<div class="infobox-note" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-2B3BD6E7-81B9-47C4-B59B-3DE789B39609">
<p class="notep1">Note:</p>
<p>The transaction can be resumed by a different process than the one that detached it, if the transaction has the same authorization. If this function is called before a transaction is actually started, this function has no effect.</p>
</div>
<p>For example code demonstrating the use of <code class="codeph">OCITransDetach()</code>, see the Examples section of <a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Related Functions</p>
<p><a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a></p>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI17278"></a>
<div class="props_rev_3"><a id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00"></a>
<h2 id="LNOCI-GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" class="sect2">OCITransForget()</h2>
<div>
<div class="section">
<p class="subhead2">Purpose</p>
<p>Causes the server to forget a heuristically completed global transaction.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Syntax</p>
<pre dir="ltr">sword OCITransForget ( OCISvcCtx     *svchp, 
                       OCIError      *errhp,
                       ub4           flags );
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2"><span class="bold">Parameters</span></p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74897"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-9E30D41E-0CC7-4349-A6B8-DB61CAA0EF3E"><!-- --></a><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle in which the transaction resides.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74898"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-D268B6A8-DC7E-43D7-A799-5A4C01BC7E18"><!-- --></a><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74899"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-3FB91A76-F11C-4E94-AC37-A427116D1864"><!-- --></a>flags (IN)</dt>
<dd>
<p>You must pass <code class="codeph">OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Comments</p>
<p>Forgets a heuristically completed global transaction. The server deletes the status of the transaction from the system&#39;s pending transaction table.</p>
<p>You set the XID of the transaction to be forgotten as an attribute of the transaction handle (<code class="codeph">OCI_ATTR_XID</code>).</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Related Functions</p>
<p><a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a>, <a href="oci17msc006.htm#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366">OCITransRollback()</a></p>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI17279"></a>
<div class="props_rev_3"><a id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7"></a>
<h2 id="LNOCI-GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7" class="sect2">OCITransMultiPrepare()</h2>
<div>
<div class="section">
<p class="subhead2">Purpose</p>
<p>Prepares a transaction with multiple branches in a single call.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Syntax</p>
<pre dir="ltr">sword OCITransMultiPrepare ( OCISvcCtx   *svchp, 
                             ub4         numBranches, 
                             OCITrans    **txns, 
                             OCIError    **errhp);
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2"><span class="bold">Parameters</span></p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74900"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-70A94F00-E8BD-459C-AE69-EC25E072F567"><!-- --></a>srvchp (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74901"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-DB67F55E-54F6-4268-876B-F0D293E55BD5"><!-- --></a>numBranches (IN)</dt>
<dd>
<p>The number of branches expected. It is also the array size for the next two parameters.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74902"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-32F5BC4B-2123-4E2D-AD15-2B0B75A7452D"><!-- --></a>txns (IN)</dt>
<dd>
<p>The array of transaction handles for the branches to prepare. They should all have the <code class="codeph">OCI_ATTR_XID</code> set. The global transaction ID should be the same.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74903"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-A4F40037-4E87-4A13-BA0D-6211F218076B"><!-- --></a>errhp (IN)</dt>
<dd>
<p>The array of error handles. If <code class="codeph">OCI_SUCCESS</code> is not returned, then these indicate which branches received which errors.</p>
</dd>
</dl>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Comments</p>
<p>Prepares the specified global transaction for commit. This call is valid only for distributed transactions. This call is an advanced performance feature intended for use only in situations where the caller is responsible for preparing all the branches in a transaction.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Related Functions</p>
<p><a href="oci17msc006.htm#GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3">OCITransPrepare()</a></p>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI17280"></a>
<div class="props_rev_3"><a id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3"></a>
<h2 id="LNOCI-GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" class="sect2">OCITransPrepare()</h2>
<div>
<div class="section">
<p class="subhead2">Purpose</p>
<p>Prepares a global transaction for commit.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Syntax</p>
<pre dir="ltr">sword OCITransPrepare ( OCISvcCtx    *svchp, 
                        OCIError     *errhp,
                        ub4          flags );
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2"><span class="bold">Parameters</span></p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74904"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-BAE1828C-ED34-4CAA-BAB3-D97473F3FC8C"><!-- --></a><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>The service context handle.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74905"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-25447DA7-DB1B-4ABC-9799-0598248D40E6"><!-- --></a><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74906"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-900E10FB-C0CA-4C81-A595-50903A9EB92B"><!-- --></a>flags (IN)</dt>
<dd>
<p>You must pass <code class="codeph">OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Comments</p>
<p>Prepares the specified global transaction for commit.</p>
<p>This call is valid only for global transactions.</p>
<p>The call returns <code class="codeph">OCI_SUCCESS_WITH_INFO</code> if the transaction has not made any changes. The error handle indicates that the transaction is read-only. The <code class="codeph">flags</code> parameter is not currently used.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Related Functions</p>
<p><a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a>, <a href="oci17msc006.htm#GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00">OCITransForget()</a></p>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI17281"></a>
<div class="props_rev_3"><a id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366"></a>
<h2 id="LNOCI-GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" class="sect2">OCITransRollback()</h2>
<div>
<div class="section">
<p class="subhead2">Purpose</p>
<p>Rolls back the current transaction.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Syntax</p>
<pre dir="ltr">sword OCITransRollback ( void         *svchp, 
                         OCIError     *errhp,
                         ub4          flags );
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Parameters</p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74907"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-AE70ED24-0E28-4901-BD15-C73716DE1703"><!-- --></a><span class="bold">svchp</span> (IN)</dt>
<dd>
<p>A service context handle. The transaction currently set in the service context handle is rolled back.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74908"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-E73915F8-9EC3-4E9B-8002-F7B8453D1FF6"><!-- --></a><span class="bold">errhp</span> (IN)</dt>
<dd>
<p>An error handle that you can pass to <a href="oci17msc007.htm#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a> for diagnostic information when there is an error.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74909"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-86DAAED8-945D-4FED-BFEF-47DDECC421CA"><!-- --></a><span class="bold">flags</span> (IN)</dt>
<dd>
<p>You must pass a value of <code class="codeph">OCI_DEFAULT</code> for this parameter.</p>
</dd>
</dl>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Comments</p>
<p>The current transaction&mdash; defined as the set of statements executed since the last <a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a> or since <a href="oci16rel001.htm#GUID-31B1FDB3-056E-4AF9-9B89-8DA6AA156947">OCISessionBegin()</a>&mdash;is rolled back.</p>
<p>If the application is running under object mode, then the modified or updated objects in the object cache for this transaction are also rolled back.</p>
<p>Attempting to roll back a global transaction that is not currently active causes an error.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Examples</p>
<p>For example code demonstrating the use of <code class="codeph">OCITransRollback()</code> see the Examples section of <a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Related Functions</p>
<p><a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></p>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI17282"></a>
<div class="props_rev_3"><a id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8"></a>
<h2 id="LNOCI-GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" class="sect2">OCITransStart()</h2>
<div>
<div class="section">
<p class="subhead2">Purpose</p>
<p>Sets the beginning of a transaction.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Syntax</p>
<pre dir="ltr">sword OCITransStart ( OCISvcCtx    *svchp, 
                      OCIError     *errhp, 
                      uword        timeout,
                      ub4          flags );
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Parameters</p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74910"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-8BF25001-5A67-4497-83BD-5698FC9240E7"><!-- --></a><span class="bold">svchp</span> (IN/OUT)</dt>
<dd>
<p>The service context handle. The transaction context in the service context handle is initialized at the end of the call if the flag specified a new transaction to be started.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74911"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-B73FF5FF-B936-4376-919F-0D2B651DCED1"><!-- --></a>errhp (IN/OUT)</dt>
<dd>
<p>The OCI error handle. If there is an error, it is recorded in <code class="codeph">err</code> and this function returns <code class="codeph">OCI_ERROR</code>. Diagnostic information can be obtained by calling <a href="oci17msc007.htm#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a>.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74912"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-75388E09-1371-4AF8-99FA-3A53B5FE6A9D"><!-- --></a>timeout (IN)</dt>
<dd>
<p>The time, in seconds, to wait for a transaction to become available for resumption when <code class="codeph">OCI_TRANS_RESUME</code> is specified. When <code class="codeph">OCI_TRANS_NEW</code> is specified, the timeout parameter indicates the number of seconds the transaction can be inactive before it is automatically terminated by the system. A transaction is inactive between the time it is detached (with <a href="oci17msc006.htm#GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09">OCITransDetach()</a>) and the time it is resumed with <code class="codeph">OCITransStart()</code>.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74913"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-22062DD4-2877-4E4F-9F18-37CB68F33402"><!-- --></a>flags (IN)</dt>
<dd>
<p>Specifies whether a new transaction is being started or an existing transaction is being resumed. Also specifies serializability or read-only status. More than a single value can be specified. By default, a read/write transaction is started. The flag values are:</p>
</dd>
</dl>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">OCI_TRANS_NEW</code> - Starts a new transaction branch. By default starts a tightly coupled and migratable branch.</p>
</li>
<li>
<p><code class="codeph">OCI_TRANS_TIGHT</code> - Explicitly specifies a tightly coupled branch.</p>
</li>
<li>
<p><code class="codeph">OCI_TRANS_LOOSE</code> - Specifies a loosely coupled branch.</p>
</li>
<li>
<p><code class="codeph">OCI_TRANS_RESUME</code> - Resumes an existing transaction branch.</p>
</li>
<li>
<p><code class="codeph">OCI_TRANS_READONLY</code> - Starts a read-only transaction.</p>
</li>
<li>
<p><code class="codeph">OCI_TRANS_SERIALIZABLE</code> - Starts a serializable transaction.</p>
</li>
<li>
<p><code class="codeph">OCI_TRANS_SEPARABLE</code> - Separates the transaction after each call.</p>
<p>This flag results in a warning that the transaction was started using <span class="italic">regular</span> transactions. Separated transactions are not supported through release 9.0.1 of the server.</p>
</li>
</ul>
<p>An error message results if there is an error in your code or the transaction service. The error indicates that you attempted an action on a transaction that has already been prepared.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Comments</p>
<p>This function sets the beginning of a global or serializable transaction. The transaction context currently associated with the service context handle is initialized at the end of the call if the <code class="codeph">flags</code> parameter specifies that a new transaction should be started.</p>
<p>The XID of the transaction is set as an attribute of the transaction handle (<code class="codeph">OCI_ATTR_XID</code>)</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Examples</p>
<p>The following code example and the one following that one demonstrate the use of OCI transactional calls for manipulating global transactions. The concept for a single session operating on different branches, as shown in the following code example, is illustrated by <a href="oci08sca.htm#GUID-9C16201F-7975-4E14-8162-62695B1C9AE4__I433197">Figure 8-2</a>.</p>
<p>Using OCITransStart() in a Single Session Operating on Different Branches</p>
<pre dir="ltr">int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCISession *usrhp;
  OCIStmt *stmthp1, *stmthp2;
  OCITrans *txnhp1, *txnhp2;
  void      *tmp;
  XID gxid;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4)
                OCI_HTYPE_ERROR, 52, (void  **) &amp;tmp);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4)
               OCI_HTYPE_SERVER, 52, (void  **) &amp;tmp);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                52, (void  **) &amp;tmp);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp1, OCI_HTYPE_STMT, 0, 0);
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp2, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  /* set the external name and internal name in server handle */
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) &#34;demo&#34;, 0,
                  OCI_ATTR_EXTERNAL_NAME, errhp);
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) &#34;txn demo&#34;, 0,
                          OCI_ATTR_INTERNAL_NAME, errhp);

  /* allocate a user context handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
                (size_t) 0, (void  **) 0);

  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)&#34;HR&#34;,
             (ub4)strlen(&#34;HR&#34;), OCI_ATTR_USERNAME, errhp);
  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)&#34;HR&#34;,
             (ub4)strlen(&#34;HR&#34;),OCI_ATTR_PASSWORD, errhp);

  OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS, 0);

  OCIAttrSet((void  *)svchp, (ub4)OCI_HTYPE_SVCCTX,
                (void  *)usrhp, (ub4)0, OCI_ATTR_SESSION, errhp);

  /* allocate transaction handle 1 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp1,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp1, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 1 with 60-second time to live when detached */
  OCITransStart(svchp, errhp, 60, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, &#34;UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                           WHERE EMPLOYEE_ID = 7902&#34;);
  OCIStmtPrepare(stmthp1, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp1, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* allocate transaction handle 2 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp2,  OCI_HTYPE_TRANS, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 124, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 124 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 4;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp2, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 2 with 90 second time to live when detached */
  OCITransStart(svchp, errhp, 90, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7934, increment salary */
  sprintf((char *)sqlstmt, &#34;UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE EMPLOYEE_ID = 7934&#34;);
  OCIStmtPrepare(stmthp2, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp2, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* Resume transaction 1, increment salary and commit it */
  /* Set transaction handle 1 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* attach to transaction 1, wait for 10 seconds if the transaction is busy */
  /* The wait is clearly not required in this example because no other */
  /* process/thread is using the transaction. It is only for illustration */
  OCITransStart(svchp, errhp, 10, OCI_TRANS_RESUME);
  OCIStmtExecute(svchp, stmthp1, errhp, 1, 0, 0, 0, 0);
  OCITransCommit(svchp, errhp, (ub4) 0);

  /* attach to transaction 2 and commit it */
  /* set transaction handle2 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);
  OCITransCommit(svchp, errhp, (ub4) 0);
}
</pre>
<p>Using OCITransStart() in a Single Session Operating on Multiple Branches Sharing the Same Transaction</p>
<pre dir="ltr">int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCISession *usrhp;
  OCIStmt *stmthp;
  OCITrans *txnhp1, *txnhp2;
  void      *tmp;
  XID gxid;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4) OCI_HTYPE_ERROR,
                52, (void  **) &amp;tmp);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4) OCI_HTYPE_SERVER,
                52, (void  **) &amp;tmp);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                52, (void  **) &amp;tmp);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  /* set the external name and internal name in server handle */
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) &#34;demo&#34;, 0,
                  OCI_ATTR_EXTERNAL_NAME, errhp);
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) &#34;txn demo2&#34;, 0,
                  OCI_ATTR_INTERNAL_NAME, errhp);

  /* allocate a user context handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
                (size_t) 0, (void  **) 0);

  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)&#34;HR&#34;,
             (ub4)strlen(&#34;HR&#34;), OCI_ATTR_USERNAME, errhp);
  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)&#34;HR&#34;,
             (ub4)strlen(&#34;HR&#34;),OCI_ATTR_PASSWORD, errhp);

  OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS, 0);

  OCIAttrSet((void  *)svchp, (ub4)OCI_HTYPE_SVCCTX,
                (void  *)usrhp, (ub4)0, OCI_ATTR_SESSION, errhp);

  /* allocate transaction handle 1 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp1,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp1, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 1 with 60-second time to live when detached */
  OCITransStart(svchp, errhp, 60, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, &#34;UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE EMPLOYEE_ID = 7902&#34;);
  OCIStmtPrepare(stmthp, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* allocate transaction handle 2 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp2,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 2] */
  /* The global transaction is tightly coupled with earlier transactions */
  /* There is not much practical value in doing this but the example */
  /* illustrates the use of tightly coupled transaction branches. */
  /* In a practical case, the second transaction that tightly couples with */
  /* the first can be executed from a different process/thread. */

  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 2 */
  gxid.data[3] = 2;

  OCIAttrSet((void  *)txnhp2, OCI_HTYPE_TRANS, (void  *)&amp;gxid,
sizeof(XID), OCI_ATTR_XID, errhp);

  /* start global transaction 2 with 90-second time to live when detached */
  OCITransStart(svchp, errhp, 90, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  /* This is possible even if the earlier transaction has locked this row */
  /* because the two global transactions are tightly coupled */
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* Resume transaction 1 and prepare it. This returns */
  /* OCI_SUCCESS_WITH_INFO because all branches except the last branch */
  /* are treated as read-only transactions for tightly coupled transactions */

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);
  if (OCITransPrepare(svchp, errhp, (ub4) 0) == OCI_SUCCESS_WITH_INFO)
  {
    text errbuf[512];
    ub4 buflen;
    sb4 errcode;

    OCIErrorGet ((void  *) errhp, (ub4) 1, (text *) NULL, &amp;errcode,
    errbuf, (ub4) sizeof(errbuf), (ub4) OCI_HTYPE_ERROR);
    printf(&#34;OCITransPrepare - %s\n&#34;, errbuf);
  }

  /* attach to transaction 2 and commit it */
  /* set transaction handle2 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);
  OCITransCommit(svchp, errhp, (ub4) 0);
}
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Related Functions</p>
<p><a href="oci17msc006.htm#GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09">OCITransDetach()</a></p>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment6150">
<tr>
<td class="cellalignment6162">
<table class="cellalignment6155">
<tr>
<td class="cellalignment6154"><a href="oci17msc005.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment6154"><a href="oci17msc007.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment6164">
<table class="cellalignment6153">
<tr>
<td class="cellalignment6154"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment6154"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment6154"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment6154"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment6154"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment6154"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>