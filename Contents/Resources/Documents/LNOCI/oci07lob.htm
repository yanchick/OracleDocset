<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-73978"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/LOB%20and%20BFILE%20Operations"></a><title>LOB and BFILE Operations</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="This chapter describes LOB and BFILE operations."/>
<meta name="keywords" content="LOBs, creating, modifying, FILE, associating with operating system file, objects, LOB attributes of transient objects, transient objects, attributes, attributes of transient objects, size maximum, greater than 4 GB, OCI functions, buffering, buffering LOB operations, callbacks, for LOB operations, LOB streaming interface, for reading LOBs, for writing LOBs, temporary, creating temporary, freeing temporary, duration of temporary, example of temporary, prefetching, OCI_ATTR_DEFAULT_LOBPREFETCH_SIZE, OCI_ATTR_LOBPREFETCH_LENGTH, OCILobArrayRead(), SECUREFILE parameter, BASICFILE parameter, SecureFiles LOBs, SecureFiles, DEDUPLICATE, KEEP_DUPLICATES, NOCOMPRESS"/>
<meta name="dcterms.created" content="2017-06-09T09:07:30Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Call Interface Programmer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49886-11"/>
<meta name="dcterms.isVersionOf" content="LNOCI"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="oci06des.htm" title="Previous" type="text/html"/>
<link rel="Next" href="oci08sca.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49886-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-0A094518-F97C-40BE-A336-259AA82BD0A2"></a> <span id="PAGE" style="display:none;">14/84</span> <!-- End Header -->
<script>
//<![CDATA[
window.name='oci07lob'
//]]>
</script> <script>
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" ><head><title>');
   
    msg.document.write('Footnote&amp;nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('');
    msg.document.write('<style> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
</script><noscript>
<p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
</noscript><a id="LNOCI070"></a>
<h1 id="LNOCI-GUID-0A094518-F97C-40BE-A336-259AA82BD0A2" class="sect1"><span class="enumeration_chapter">7</span> LOB and BFILE Operations</h1>
<div>
<p>This chapter describes LOB and BFILE operations.</p>
<p>This chapter contains these topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-CD11DD8F-77C6-4C14-BF75-DDB107CB246B" title="OCI includes a set of functions for performing operations on large objects (LOBs) in a database.">About Using OCI Functions for LOBs</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-301C3875-9A32-4C37-A4A6-4FCF705EF1B2" title="LOB instances can be either persistent (stored in the database) or temporary (existing only in the scope of your application).">About Creating and Modifying Persistent LOBs</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-C416EA63-3DFE-4778-8163-8EFDEA1F8503" title="The BFILENAME function can be used in an INSERT statement to associate an external server-side (operating system) file with a BFILE column or attribute in a table.">About Associating a BFILE in a Table with an Operating System File</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-4622680F-D454-4DFE-8300-E74E74E39DBA" title="An OCI application can use the OCIObjectNew() function to create a persistent or transient object with a LOB attribute.">LOB Attributes of an Object</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-93695EB3-E9D2-4F2B-B027-2D9AD99B586D" title="You can use the OCI array interface with LOBs, just as with any other data type.">Array Interface for LOBs</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-EC49588A-0534-4E43-8CB1-3D0FAE205BAB" title="Starting with Oracle Database 10g Release 1 of OCI, functions were introduced to support LOBs of size greater than 4 GB. These new functions can also be used in new applications for LOBs of less than 4 GB.">About Using LOBs of Size Greater than 4 GB</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-7595F604-B560-4121-8254-57801341B02F" title="In all LOB operations that involve offsets into the data, the offset begins at 1. For LOB operations, such as OCILobCopy2(), OCILobErase2(), OCILobLoadFromFile2(), and OCILobTrim2(), the amount parameter is in characters for CLOBs and NCLOBs, regardless of the client-side character set.">LOB and BFILE Functions in OCI</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-B9A9B78B-570B-4B54-A4C4-A2F2D2808B06" title="OCI provides functions for creating and freeing temporary LOBs, OCILobCreateTemporary() and OCILobFreeTemporary(), and a function for determining whether a LOB is temporary, OCILobIsTemporary().">Temporary LOB Support</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-3F7FEAFF-F4EF-42CC-8F95-598D227C5D83" title="To improve OCI access of smaller LOBs, LOB data can be prefetched and cached while also fetching the locator.">Prefetching of LOB Data, Length, and Chunk Size</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-5DEEF1FA-0024-48B4-B587-506386EA5240" title="For SecureFiles (LOBs with the STORE AS SECUREFILE option, which were introduced in Oracle Database 11g Release 1) you can specify the SQL parameter DEDUPLICATE in CREATE TABLE and ALTER TABLE statements.">Options of SecureFiles LOBs</a></p>
</li>
</ul>
</div>
<a id="LNOCI16500"></a>
<div class="props_rev_3"><a id="GUID-CD11DD8F-77C6-4C14-BF75-DDB107CB246B"></a>
<h2 id="LNOCI-GUID-CD11DD8F-77C6-4C14-BF75-DDB107CB246B" class="sect2">About Using OCI Functions for LOBs</h2>
<div>
<p>OCI includes a set of functions for performing operations on large objects (LOBs) in a database.</p>
<p>Persistent LOBs (<code class="codeph">BLOB</code>s, <code class="codeph">CLOB</code>s, <code class="codeph">NCLOB</code>s) are stored in the database tablespaces in a way that optimizes space and provides efficient access. These LOBs have the full transactional support of the Oracle database. <code class="codeph">BFILE</code>s are large data objects stored in the server&#39;s operating system files outside the database tablespaces.</p>
<p>OCI also provides support for temporary LOBs, which can be used like local variables for operating on LOB data.</p>
<p><code class="codeph">BFILE</code>s are read-only. Oracle Database supports only binary <code class="codeph">BFILE</code>s.</p>
<div class="infoboxnotealso" id="GUID-CD11DD8F-77C6-4C14-BF75-DDB107CB246B__GUID-39122048-791C-48F1-BFD4-95EB8F069524">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="ociabdem.htm#GUID-75E18629-0C54-4495-A747-AFB346034F26" title="Lists example programs with sample code demonstrating the allocation and use of OCI handles.">OCI Demonstration Programs</a> for code samples showing the use of LOBs</p>
</li>
<li>
<p><code class="codeph">$ORACLE_HOME/rdbms/demo/lobs/oci/</code> for specific LOB code samples</p>
</li>
<li>
<p><a class="olink ARPLS020" target="_blank" href="../ARPLS/d_lob.htm#ARPLS020"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for the <code class="codeph">DBMS_LOB</code> package</p>
</li>
<li>
<p><a class="olink ADLOB001" target="_blank" href="../ADLOB/adlob_intro.htm#ADLOB001"><span><cite>Oracle Database SecureFiles and Large Objects Developer&#39;s Guide</cite></span></a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI13233"></a>
<div class="props_rev_3"><a id="GUID-301C3875-9A32-4C37-A4A6-4FCF705EF1B2"></a>
<h2 id="LNOCI-GUID-301C3875-9A32-4C37-A4A6-4FCF705EF1B2" class="sect2">About Creating and Modifying Persistent LOBs</h2>
<div>
<p>LOB instances can be either persistent (stored in the database) or temporary (existing only in the scope of your application).</p>
<p>Do not confuse the concept of a persistent LOB with a persistent object.</p>
<p>There are two ways of creating and modifying persistent LOBs:</p>
<ul style="list-style-type: disc;">
<li>
<p><span>Using the data interface</span></p>
<p>You can create a LOB by inserting character data into a <code class="codeph">CLOB</code> column or <code class="codeph">RAW</code> data into a <code class="codeph">BLOB</code> column directly. You can also modify LOBs by using a SQL <code class="codeph">UPDATE</code> statement, to bind character data into a <code class="codeph">CLOB</code> column or <code class="codeph">RAW</code> data into a <code class="codeph">BLOB</code> column.</p>
<p>Insert, update, and select of remote LOBs (over a dblink) is supported because neither the remote server nor the local server is of a release earlier than Oracle Database 10<span class="italic">g</span> Release 2. The data interface only supports data size up to 2 GB &ndash; 1, the maximum size of an <code class="codeph">sb4</code> data type.</p>
</li>
<li>
<p><span>Using the LOB locator</span></p>
<p>You create a new internal LOB by initializing a new LOB locator using <code class="codeph">OCIDescriptorAlloc()</code>, calling <code class="codeph">OCIAttrSet()</code> to set it to empty (using the <code class="codeph">OCI_ATTR_LOBEMPTY</code> attribute), and then binding the locator to a placeholder in an <code class="codeph">INSERT</code> statement. Doing so inserts the empty locator into a table with a LOB column or attribute. You can then perform a <code class="codeph">SELECT</code>...<code class="codeph">FOR</code> <code class="codeph">UPDATE</code> operation on this row to get the locator, and write to it using one of the OCI LOB functions.</p>
<div class="infobox-note" id="GUID-301C3875-9A32-4C37-A4A6-4FCF705EF1B2__GUID-3943ECBE-1CE2-4970-A226-C8CDB59AA7A3">
<p class="notep1">Note:</p>
<p>To modify a LOB column or attribute (write, copy, trim, and so forth), you must lock the row containing the LOB. One way to do this is to use a <code class="codeph">SELECT...FOR UPDATE</code> statement to select the locator before performing the operation.</p>
</div>
</li>
</ul>
<p>For any LOB write command to be successful, a transaction must be open. If you commit a transaction before writing the data, you must lock the row again (by reissuing the <code class="codeph">SELECT...FOR UPDATE</code> statement, for example), because the commit closes the transaction.</p>
<div class="infoboxnotealso" id="GUID-301C3875-9A32-4C37-A4A6-4FCF705EF1B2__GUID-C4389A93-0A54-4153-83C9-5BE4B1A74226">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADLOB1300" target="_blank" href="../ADLOB/adlob_data_interface.htm#ADLOB1300"><span><cite>Oracle Database SecureFiles and Large Objects Developer&#39;s Guide</cite></span></a> chapter about data interface for persistent LOBs for more information and examples</p>
</li>
<li>
<p><a href="oci05bnd.htm#GUID-D757C946-BCDA-4A32-867B-BE951BA9BBF4" title="Oracle Database allows nonzero binds for INSERTs and UPDATEs of any size LOB.">About Binding LOB Data</a> for usage and examples for both <code class="codeph">INSERT</code> and <code class="codeph">UPDATE</code></p>
</li>
<li>
<p><a href="oci16rel002.htm#GUID-E9EF2766-E078-49A7-B1D1-738E4BA4814F">OCIDescriptorAlloc()</a></p>
</li>
<li>
<p><a href="oci16rel002.htm#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16501"></a>
<div class="props_rev_3"><a id="GUID-C416EA63-3DFE-4778-8163-8EFDEA1F8503"></a>
<h2 id="LNOCI-GUID-C416EA63-3DFE-4778-8163-8EFDEA1F8503" class="sect2">About Associating a BFILE in a Table with an Operating System File</h2>
<div>
<p>The <code class="codeph">BFILENAME</code> function can be used in an <code class="codeph">INSERT</code> statement to associate an external server-side (operating system) file with a <code class="codeph">BFILE</code> column or attribute in a table.</p>
<p>Using <code class="codeph">BFILENAME</code> in an <code class="codeph">UPDATE</code> statement associates the <code class="codeph">BFILE</code> column or attribute with a different operating system file. <code class="codeph">OCILobFileSetName()</code> can also be used to associate a <code class="codeph">BFILE</code> in a table with an operating system file. <code class="codeph">BFILENAME</code> is usually used in an <code class="codeph">INSERT</code> or <code class="codeph">UPDATE</code> statement without bind variables, and <code class="codeph">OCILobFileSetName()</code> is used for bind variables.</p>
<div class="infoboxnotealso" id="GUID-C416EA63-3DFE-4778-8163-8EFDEA1F8503__GUID-4311FD20-8A1A-4E5B-9589-8C1024FCC871">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-507AC0EF-4CAB-437E-BB94-1FD77EDC1B5C" title="Sets the directory object and file name in the BFILE locator.">OCILobFileSetName()</a></p>
</li>
<li>
<p><a class="olink ADLOB45143" target="_blank" href="../ADLOB/adlob_working.htm#ADLOB45143"><span><cite>Oracle Database SecureFiles and Large Objects Developer&#39;s Guide</cite></span></a> for more information about the <code class="codeph">BFILENAME</code> function</p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16502"></a>
<div class="props_rev_3"><a id="GUID-4622680F-D454-4DFE-8300-E74E74E39DBA"></a>
<h2 id="LNOCI-GUID-4622680F-D454-4DFE-8300-E74E74E39DBA" class="sect2">LOB Attributes of an Object</h2>
<div>
<p>An OCI application can use the <code class="codeph">OCIObjectNew()</code> function to create a persistent or transient object with a LOB attribute.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-DF80FECE-7F0A-46C7-B89B-EA2FB04358E5" title="It is possible to use OCI to create a new persistent object with a LOB attribute and write to that LOB attribute.">Writing to a LOB Attribute of an Object</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-B3E83C32-6E92-4E04-A381-BD738B064901" title="An application can call OCIObjectNew() and create a transient object with an internal LOB (BLOB, CLOB, NCLOB) attribute.">Transient Objects with LOB Attributes</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-4622680F-D454-4DFE-8300-E74E74E39DBA__GUID-F1B102F3-9FA4-49C4-82E0-CD2A3E51DC78">
<p class="notep1">See Also:</p>
<p><a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a></p>
</div>
</div>
<a id="LNOCI16503"></a>
<div class="props_rev_3"><a id="GUID-DF80FECE-7F0A-46C7-B89B-EA2FB04358E5"></a>
<h3 id="LNOCI-GUID-DF80FECE-7F0A-46C7-B89B-EA2FB04358E5" class="sect3">Writing to a LOB Attribute of an Object</h3>
<div>
<p>It is possible to use OCI to create a new persistent object with a LOB attribute and write to that LOB attribute.</p>
<div class="section">
<p>The application would follow these steps when using a <span class="italic">LOB locator</span>:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Call <code class="codeph">OCIObjectNew()</code> to create a persistent object with a LOB attribute.</span></li>
<li class="stepexpand"><span>Mark the object as &#34;dirty&#34; (modified).</span></li>
<li class="stepexpand"><span>Flush the object, thereby inserting a row into the table.</span></li>
<li class="stepexpand"><span>Repin the latest version of the object (or refresh the object), thereby retrieving the object from the database and acquiring a valid locator for the LOB.</span></li>
<li class="stepexpand"><span>Call <code class="codeph">OCIObjectWrite2()</code> using the LOB locator in the object to write the data.</span></li>
</ol>
<div class="section">
<p>There is a second way of writing to a LOB attribute. When using the <span class="italic">data interface</span>, you can bind or define character data for a <code class="codeph">CLOB</code> attribute or <code class="codeph">RAW</code> data for a <code class="codeph">BLOB</code> attribute.</p>
<div class="infoboxnotealso" id="GUID-DF80FECE-7F0A-46C7-B89B-EA2FB04358E5__GUID-E78FCF32-F9DD-4449-8BE6-6DC048CD645B">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci11obj.htm#GUID-8A9E9784-9D10-40B1-ADE9-4CE9325255E5" title="This chapter introduces the OCI facility for working with objects in an Oracle database. It also discusses the object navigational function calls of OCI.">OCI Object-Relational Programming</a> and the chapters that follow it for more information about objects</p>
</li>
<li>
<p><a href="oci05bnd.htm#GUID-D757C946-BCDA-4A32-867B-BE951BA9BBF4" title="Oracle Database allows nonzero binds for INSERTs and UPDATEs of any size LOB.">About Binding LOB Data</a> for usage and examples for both <code class="codeph">INSERT</code> and <code class="codeph">UPDATE statements</code></p>
</li>
<li>
<p><a href="oci05bnd.htm#GUID-FE7DB3D8-9310-41ED-8869-B5106E60D29E">About Defining LOB Data</a> for usage and examples of <code class="codeph">SELECT</code> statements</p>
</li>
<li>
<p><a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI16504"></a>
<div class="props_rev_3"><a id="GUID-B3E83C32-6E92-4E04-A381-BD738B064901"></a>
<h3 id="LNOCI-GUID-B3E83C32-6E92-4E04-A381-BD738B064901" class="sect3">Transient Objects with LOB Attributes</h3>
<div>
<p>An application can call <code class="codeph">OCIObjectNew()</code> and create a transient object with an internal LOB (<code class="codeph">BLOB</code>, <code class="codeph">CLOB</code>, <code class="codeph">NCLOB</code>) attribute.</p>
<p>However, you cannot perform any operations, such as read or write, on the LOB attribute because transient objects with LOB attributes are not supported. Calling <code class="codeph">OCIObjectNew()</code> to create a transient internal LOB type does not fail, but the application cannot use any LOB operations with the transient LOB.</p>
<p>An application can, however, create a transient object with a <code class="codeph">BFILE</code> attribute and use the <code class="codeph">BFILE</code> attribute to read data from a file stored in the server&#39;s file system. The application can also call <code class="codeph">OCIObjectNew()</code> to create a transient <code class="codeph">BFILE</code>.</p>
<div class="infoboxnotealso" id="GUID-B3E83C32-6E92-4E04-A381-BD738B064901__GUID-A88A569E-54CB-4E55-95F0-5371AC542FC0">
<p class="notep1">See Also:</p>
<p><a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a></p>
</div>
</div>
</div>
</div>
<a id="LNOCI16505"></a>
<div class="props_rev_3"><a id="GUID-93695EB3-E9D2-4F2B-B027-2D9AD99B586D"></a>
<h2 id="LNOCI-GUID-93695EB3-E9D2-4F2B-B027-2D9AD99B586D" class="sect2">Array Interface for LOBs</h2>
<div>
<p>You can use the OCI array interface with LOBs, just as with any other data type.</p>
<p>There are two ways of using the array interface.</p>
<ul style="list-style-type: disc;">
<li>
<p><span>Using the data interface</span></p>
<p>You can bind or define arrays of character data for a <code class="codeph">CLOB</code> column or <code class="codeph">RAW</code> data for a <code class="codeph">BLOB</code> column. You can use array bind and define interfaces to insert and select multiple rows with LOBs in <span class="italic">one round-trip</span> to the server.</p>
</li>
<li>
<p><span>Using the LOB locator</span></p>
<p>When using the LOB locator you must allocate the descriptors, as shown in the following code example.</p>
<p>Using the LOB Locator and Allocating the Descriptors</p>
<pre dir="ltr">/* First create an array of OCILobLocator pointers: */
OCILobLocator *lobp[10];

for (i=0; i &lt; 10; i++)
{ OCIDescriptorAlloc (...,&amp;lobp[i],...);

/* Then bind the descriptor as follows */
  OCIBindByPos(... &amp;lobp[i], ...);
</pre></li>
</ul>
<div class="infoboxnotealso" id="GUID-93695EB3-E9D2-4F2B-B027-2D9AD99B586D__GUID-1CA332F0-0381-4847-B209-C6ADA9394448">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci05bnd.htm#GUID-D757C946-BCDA-4A32-867B-BE951BA9BBF4" title="Oracle Database allows nonzero binds for INSERTs and UPDATEs of any size LOB.">About Binding LOB Data</a> for usage and examples for both <code class="codeph">INSERT</code> and <code class="codeph">UPDATE statements</code></p>
</li>
<li>
<p><a href="oci05bnd.htm#GUID-FE7DB3D8-9310-41ED-8869-B5106E60D29E">About Defining LOB Data</a> for usage and examples of <code class="codeph">SELECT</code> statements</p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16506"></a>
<div class="props_rev_3"><a id="GUID-EC49588A-0534-4E43-8CB1-3D0FAE205BAB"></a>
<h2 id="LNOCI-GUID-EC49588A-0534-4E43-8CB1-3D0FAE205BAB" class="sect2">About Using LOBs of Size Greater than 4 GB</h2>
<div>
<p>Starting with Oracle Database 10<span class="italic">g</span> Release 1 of OCI, functions were introduced to support LOBs of size greater than 4 GB. These new functions can also be used in new applications for LOBs of less than 4 GB.</p>
<p>Oracle Database enables you to create tablespaces with block sizes different from the database block size. The maximum size of a LOB depends on the size of the tablespace blocks. The tablespace block size in which the LOB is stored controls the value of <code class="codeph">CHUNK</code>, which is a parameter of LOB storage. When you create a LOB column, you specify a value for <code class="codeph">CHUNK</code>, which is the number of bytes to be allocated for LOB manipulation. The value must be a multiple of the tablespace block size, or Oracle Database rounds up to the next multiple. (If the tablespace block size equals the database block size, then <code class="codeph">CHUNK</code> is also a multiple of the database block size.) The default <code class="codeph">CHUNK</code> size is one tablespace block, and the maximum value is 32 KB.</p>
<p>In this guide, 4 GB is defined as 4 gigabytes &ndash; 1, or 4,294,967,295 bytes. The maximum size of a LOB, persistent or temporary, is (4 gigabytes &ndash; 1) * (<code class="codeph">CHUNK</code>). The maximum LOB size can range from 8 terabytes (TB) to 128 TB.</p>
<p>For example, suppose that your database block size is 32 KB and you create a tablespace with a nonstandard block size of 8 KB. Further suppose that you create a table with a LOB column and specify a <code class="codeph">CHUNK</code> size of 16 KB (which is a multiple of the 8 KB tablespace block size). Then the maximum size of a LOB in this column is (4 gigabytes &ndash; 1) * 16 KB.</p>
<p>The maximum size of a <code class="codeph">BFILE</code> is the maximum file size allowed in the operating system, or <code class="codeph">UB8MAXVAL</code>, whichever is smaller.</p>
<p>Older LOB functions use <code class="codeph">ub4</code> as the data types of some parameters, and the <code class="codeph">ub4</code> data type can only hold up to 4 GB. The newer functions use parameters of 8-byte length, <code class="codeph">oraub8</code>, which is a data type defined in <code class="codeph">oratypes.h</code>. The data types <code class="codeph">oraub8</code> and <code class="codeph">orasb8</code> are mapped to appropriate 64-bit native data types depending on the compiler and operating system. Macros are used to not define <code class="codeph">oraub8</code> and <code class="codeph">orasb8</code> if compiling in 32-bit mode with strict ANSI option.</p>
<p><code class="codeph">OCILobGetChunkSize()</code> returns the usable chunk size in bytes for <code class="codeph">BLOB</code>s, <code class="codeph">CLOB</code>s, and <code class="codeph">NCLOB</code>s. The number of bytes stored in a chunk is actually less than the size of the <code class="codeph">CHUNK</code> parameter due to internal storage overhead. The function <code class="codeph">OCILobGetStorageLimit()</code> is provided to return the maximum size in bytes of internal LOBs in the current installation.</p>
<div class="infobox-note" id="GUID-EC49588A-0534-4E43-8CB1-3D0FAE205BAB__GUID-847EF166-6894-46AE-A4B2-D1BC378D7686">
<p class="notep1">Note:</p>
<p>Oracle Database does not support <code class="codeph">BFILE</code>s larger than 4 gigabytes in any programmatic environment. An additional file size limit imposed by your operating system also applies to <code class="codeph">BFILE</code>s.</p>
</div>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-4B5035F2-104E-4368-B603-09E069ED4544" title="Eight functions with names that end in &#34;2&#34; and that use the data type oraub8 in place of the data type ub4 were introduced in Oracle Database 10g Release 1.">Functions to Use for the Increased LOB Sizes</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-24301AFA-3446-46A0-AA27-2C7E223E0D39" title="Existing OCI programs can be enhanced to process larger amounts of LOB data that are greater than 4 GB.">Compatibility and Migration</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-ABB71585-172E-4F3E-A0CF-F70D709F2072" title="Gets the chunk size of a LOB.">OCILobGetChunkSize()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-0CBDB3C7-8A27-4A82-8C46-698B83C45A27" title="Gets the maximum length of an internal LOB (BLOB, CLOB, or NCLOB) in bytes.">OCILobGetStorageLimit()</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16507"></a>
<div class="props_rev_3"><a id="GUID-4B5035F2-104E-4368-B603-09E069ED4544"></a>
<h3 id="LNOCI-GUID-4B5035F2-104E-4368-B603-09E069ED4544" class="sect3">Functions to Use for the Increased LOB Sizes</h3>
<div>
<p>Eight functions with names that end in &#34;2&#34; and that use the data type <code class="codeph">oraub8</code> in place of the data type <code class="codeph">ub4</code> were introduced in Oracle Database 10<span class="italic">g</span> Release 1.</p>
<p>Other changes were made in the read and write functions (<code class="codeph">OCILobRead2()</code>, <code class="codeph">OCILobWrite2()</code>, and <code class="codeph">OCILobWriteAppend2()</code>) to solve several problems:</p>
<p>Problem: Before Oracle Database 10<span class="italic">g</span> Release 1, the parameter <code class="codeph">amtp</code> assumed either byte or char length for LOBs based on the locator type and character set. It was complicated and users did not have the flexibility to use byte length or char length according to their requirements.</p>
<p>Solution: Read/Write calls should take both <code class="codeph">byte_amtp</code> and <code class="codeph">char_amtp</code> parameters as replacement for the <code class="codeph">amtp</code> parameter. The <code class="codeph">char_amtp</code> parameter is preferred for <code class="codeph">CLOB</code> and <code class="codeph">NCLOB</code>, and the <code class="codeph">byte_amtp</code> parameter is only considered as input if <code class="codeph">char_amtp</code> is zero. On output for <code class="codeph">CLOB</code> and <code class="codeph">NCLOB</code>, both <code class="codeph">byte_amtp</code> and <code class="codeph">char_amtp</code> parameters are filled. For <code class="codeph">BLOB</code> and <code class="codeph">BFILE</code>, the <code class="codeph">char_ampt</code> parameter is ignored for both input and output.</p>
<p>Problem: For <code class="codeph">OCILobRead2()</code>, there is no flag to indicate polling mode. There is no easy way for the users to say &#34;I have a 100-byte buffer. Fill it as much as you can.&#34; Previously, they had to estimate how many characters to specify for the amount. If they guessed too much, they were forced into polling mode unintentionally. The user code thus can get trapped in the polling mode and subsequent OCI calls are all blocked.</p>
<p>Solution: This call should take <code class="codeph">piece</code> as an input parameter and if <code class="codeph">OCI_ONE_PIECE</code> is passed, it should fill the buffer as much as possible and come out even if the amount indicated by the <code class="codeph">byte_amtp</code> parameter or <code class="codeph">char_amtp</code> parameter is more than the buffer length. The value of <code class="codeph">bufl</code> is used to specify the maximum amount of bytes to read.</p>
<p>Problem: After calling for a LOB write in polling mode, users do not know how many chars or bytes are actually fetched till the end of the polling.</p>
<p>Solution: Both the <code class="codeph">byte_amtp</code> and <code class="codeph">char_amtp</code> parameters must be updated after each call in polling mode.</p>
<p>Problem: While reading or writing data in streaming mode with callback, users must use the same buffer for each piece of data.</p>
<p>Solution: The callback function must have two new parameters to provide the buffer and the buffer length. Callback functions can set the buffer parameter to <code class="codeph">NULL</code> to follow old behavior: to use the default buffer passed in the first call for all the pieces.</p>
<div class="infoboxnotealso" id="GUID-4B5035F2-104E-4368-B603-09E069ED4544__GUID-C216CCF5-9AE5-4FCD-902A-302BC69FABB6">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-699FFE4B-07C8-4904-959F-3686E73B8188" title="Starts a user duration for a temporary LOB.Terminates a user duration for a temporary LOB.Closes a previously opened LOB or BFILE.Creates a temporary LOB.Closes a previously opened BFILE.Closes all open BFILEs on a given service context.Tests to see if the BFILE exists on the server&#39;s operating system.Gets the BFILE locator&#39;s directory object and file name.Tests to see if the BFILE is open.Opens a BFILE on the file system of the server for read-only access.Sets the directory object and file name in the BFILE locator.Gets the chunk size of a LOB.Gets the maximum length of an internal LOB (BLOB, CLOB, or NCLOB) in bytes. Tests whether a LOB or BFILE is open.Tests to see if a given LOB or BFILE locator is initialized.Opens a LOB, internal or external, in the indicated mode.Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB. Writes data starting at the end of a LOB. This function must be used for LOBs of size greater than 4 GB.">LOB Functions</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-87D3275A-B042-4991-B261-AB531BB83CA2" title="Writes data starting at the end of a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWriteAppend2()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16509"></a><a id="LNOCI16508"></a>
<div class="props_rev_3"><a id="GUID-24301AFA-3446-46A0-AA27-2C7E223E0D39"></a>
<h3 id="LNOCI-GUID-24301AFA-3446-46A0-AA27-2C7E223E0D39" class="sect3">Compatibility and Migration</h3>
<div>
<p>Existing OCI programs can be enhanced to process larger amounts of LOB data that are greater than 4 GB.</p>
<div class="section">
<p><a href="oci07lob.htm#GUID-24301AFA-3446-46A0-AA27-2C7E223E0D39__G446324" title="This table has 4 columns. Column 1 is the LOB function name, column 2 is old client/new or old server. column 3 is new client/old server, and column 4 is new client/new server.">Table 7-1</a> summarizes compatibility issues in this table, &#34;old&#34; refers to releases before Oracle Database 10<span class="italic">g</span> Release 1, and NA means not applicable.</p>
</div>
<!-- class="section" -->
<div class="tblformalwide" id="GUID-24301AFA-3446-46A0-AA27-2C7E223E0D39__G446324">
<p class="titleintable">Table 7-1 LOB Functions Compatibility and Migration</p>
<table class="cellalignment6157" title="LOB Functions Compatibility and Migration " summary="This table has 4 columns. Column 1 is the LOB function name, column 2 is old client/new or old server. column 3 is new client/old server, and column 4 is new client/new server.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6165" id="d92511e2655">LOB Function</th>
<th class="cellalignment6166" id="d92511e2658">Old Client/New or Old Server(1)</th>
<th class="cellalignment6167" id="d92511e2664">New Client/Old Server</th>
<th class="cellalignment6168" id="d92511e2667">New Client/New Server</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2672" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-47652C79-0635-4595-A34B-CD03B7F81A9F">OCILobArrayRead()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2672 d92511e2658">
<p><a id="fn_2" href="#fn_2" onclick="footdisplay(2,&#34;NA means not applicable. &#34;)"><sup>Foot&nbsp;2</sup></a>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2672 d92511e2664">
<p>OK until piece size and offset are &lt; 4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e2672 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2690" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-10AB60C9-13FE-4CC9-9C62-CAD45DBB3B93">OCILobArrayWrite()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2690 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2690 d92511e2664">
<p>OK until piece size and offset are &lt; 4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e2690 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2705" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-404C8A50-516F-4DFD-939D-646A232AF7DF">OCILobCopy2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2705 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2705 d92511e2664">
<p>OK until LOB size, piece size (amount) and offset are &lt; 4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e2705 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2720" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-2E89A469-397B-45BD-871B-4A7E7A5815C1" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobCopy()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2720 d92511e2658">
<p>OK; limit is 4 GB.</p>
</td>
<td class="cellalignment6171" headers="d92511e2720 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2720 d92511e2667">
<p>OK; limit is 4 GB.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2741" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-264797B2-B3EA-4F6D-9A0E-BF8A4DDA13FA">OCILobErase2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2741 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2741 d92511e2664">
<p>OK until piece size and offset are &lt; 4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e2741 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2756" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-FD529B73-7D7B-4F93-BB01-4A4625503C36" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobErase()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2756 d92511e2658">
<p>OK; limit is 4 GB.</p>
</td>
<td class="cellalignment6171" headers="d92511e2756 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2756 d92511e2667">
<p>OK; limit is 4 GB.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2777" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-9BC0A78A-37CB-432F-AE2B-22C905608C4C">OCILobGetLength2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2777 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2777 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2777 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2792" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-3CEE9E79-A7E5-4078-949B-BD0ED3FB4124" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobGetLength()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2792 d92511e2658">
<p>OK; limit is 4 GB.</p>
</td>
<td class="cellalignment6171" headers="d92511e2792 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2792 d92511e2667">
<p>OK; <code class="codeph">OCI_ERROR</code> if LOB size &gt; 4 GB.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2816" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-DA1CD18B-7044-4E40-B1F4-4FCC1FCAB6C4">OCILobLoadFromFile2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2816 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2816 d92511e2664">
<p>OK until LOB size, piece size (amount), and offset are &lt; 4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e2816 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2831" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-87C6AE88-5E71-4D89-A2B8-B391BFF73AC6" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobLoadFromFile()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2831 d92511e2658">
<p>OK; limit is 4 GB.</p>
</td>
<td class="cellalignment6171" headers="d92511e2831 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2831 d92511e2667">
<p>OK; limit is 4 GB.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2852" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2852 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2852 d92511e2664">
<p>OK until LOB size, piece size (amount), and offset are &lt; 4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e2852 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2874" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-4F904ADC-547E-40CE-8F2F-98C7D7480D03" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobRead()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2874 d92511e2658">
<p>OK; limit 4 GB.</p>
<p>With new server: <code class="codeph">OCI_ERROR</code> is returned if you try to read any amount &gt;= 4 GB from any offset &lt; 4 GB. This is because when you read any amount &gt;= 4 GB, that results in an overflow of returned value in *amtp, and so it is flagged as an error.</p>
<p>Note:</p>
<ul style="list-style-type: disc;">
<li>
<p>If you read up to 4 GB &ndash; 1 from offset, that is not flagged as an error.</p>
</li>
<li>
<p>When you use streaming mode with polling, no error is returned if no attempt is made to use piece size &gt; 4 GB (you can read data &gt; 4 GB in this case).</p>
</li>
</ul>
</td>
<td class="cellalignment6171" headers="d92511e2874 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2874 d92511e2667">
<p>OK.</p>
<p><code class="codeph">OCI_ERROR</code> is returned if you try to read any amount &gt;= 4 GB from any offset &lt; 4 GB. This is because when you read any amount &gt;= 4 GB, that results in an overflow of returned value in *amtp, and so it is flagged as an error.</p>
<p>Note:</p>
<ul style="list-style-type: disc;">
<li>
<p>If you read up to 4 GB &ndash; 1 from offset, that is not to be flagged as an error.</p>
</li>
<li>
<p>When you use streaming mode with polling, no error is returned if no attempt is made to use piece size &gt; 4 GB.</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2922" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-ABDB1543-1782-4216-AD80-55FA82CFF733">OCILobTrim2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2922 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2922 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2922 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2937" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-2D1D8F83-040B-4923-9F02-108D1F636B20" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobTrim()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2937 d92511e2658">
<p>OK; limit 4 GB.</p>
</td>
<td class="cellalignment6171" headers="d92511e2937 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2937 d92511e2667">
<p>OK; limit 4 GB.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2958" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2958 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e2958 d92511e2664">
<p>OK until LOB size, piece size (amount) and offset are &lt; 4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e2958 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e2976" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-CA0A90B9-0BB0-4017-AC53-996A102A7854" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobWrite()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e2976 d92511e2658">
<p>OK; limit 4 GB.</p>
<p>With new server:</p>
<p><code class="codeph">OCI_ERROR</code> is returned if you write any amount &gt;= 4 GB (from any offset &lt; 4 GB) because that results an in overflow of returned value in <code class="codeph">*amtp</code>.</p>
<p>Note: Updating a LOB of 10 GB from any offset up to 4 GB &ndash;1 by up to 4 GB &ndash;1 amount of data is not flagged as an error.</p>
</td>
<td class="cellalignment6171" headers="d92511e2976 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e2976 d92511e2667">
<p>OK.</p>
<p><code class="codeph">OCI_ERROR</code> is returned if you write any amount &gt; =4 GB (from any offset &lt; 4 GB) because that results in an overflow of returned value in *amtp.</p>
<p>Note: Updating a LOB of 10 GB from any offset up to 4 GB &ndash;1 by up to 4 GB &ndash;1 amount of data is not flagged as an error.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e3014" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-87D3275A-B042-4991-B261-AB531BB83CA2" title="Writes data starting at the end of a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWriteAppend2()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e3014 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e3014 d92511e2664">
<p>OK until LOB size and piece size are &lt;4 GB.</p>
</td>
<td class="cellalignment6172" headers="d92511e3014 d92511e2667">
<p>OK</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e3032" headers="d92511e2655">
<p><a href="ociaedep003.htm#GUID-BC03A84A-5747-414F-9A79-BAAF0EE71EF8" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobWriteAppend()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e3032 d92511e2658">
<p>OK; limit 4 GB.</p>
<p>With new server: <code class="codeph">OCI_ERROR</code> is returned if you append any amount &gt;= 4 GB of data because that results in an overflow of returned value in <code class="codeph">*amtp</code>.</p>
</td>
<td class="cellalignment6171" headers="d92511e3032 d92511e2664">
<p>OK</p>
</td>
<td class="cellalignment6172" headers="d92511e3032 d92511e2667">
<p>OK; limit 4 GB.</p>
<p><code class="codeph">OCI_ERROR</code> is returned if you append any amount &gt;= 4 GB of data because that results in an overflow of returned value in <code class="codeph">*amtp</code>.</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6169" id="d92511e3068" headers="d92511e2655">
<p><a href="oci17msc002.htm#GUID-0CBDB3C7-8A27-4A82-8C46-698B83C45A27" title="Gets the maximum length of an internal LOB (BLOB, CLOB, or NCLOB) in bytes.">OCILobGetStorageLimit()</a></p>
</td>
<td class="cellalignment6170" headers="d92511e3068 d92511e2658">
<p>NA</p>
</td>
<td class="cellalignment6171" headers="d92511e3068 d92511e2664">
<p>Error</p>
</td>
<td class="cellalignment6172" headers="d92511e3068 d92511e2667">
<p>OK</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;1</sup> The term &#34;old&#34; refers to releases before Oracle Database 10g Release 1.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;2</sup></p>
<p>NA means not applicable.</p>
<div class="section">
<p>Use the functions that end in &#34;2&#34; when using the current server and current client. Mixing deprecated functions with functions that end in &#34;2&#34; can result in unexpected situations, such as data written using <code class="codeph">OCILobWrite2()</code> being greater than 4 GB if the application tries to read it with <code class="codeph">OCILobRead()</code> and gets only partial data (if a callback function is not used). In most cases, the application gets an error message when the size crosses 4 GB and the deprecated functions are used. However, there is no issue if you use those deprecated functions for LOBs of size smaller than 4 GB.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="LNOCI16510"></a>
<div class="props_rev_3"><a id="GUID-7595F604-B560-4121-8254-57801341B02F"></a>
<h2 id="LNOCI-GUID-7595F604-B560-4121-8254-57801341B02F" class="sect2">LOB and BFILE Functions in OCI</h2>
<div>
<p>In all LOB operations that involve offsets into the data, the offset begins at 1. For LOB operations, such as <code class="codeph">OCILobCopy2()</code>, <code class="codeph">OCILobErase2()</code>, <code class="codeph">OCILobLoadFromFile2()</code>, and <code class="codeph">OCILobTrim2()</code>, the <code class="codeph">amount</code> parameter is in characters for <code class="codeph">CLOB</code>s and <code class="codeph">NCLOB</code>s, regardless of the client-side character set.</p>
<p>These LOB operations refer to the amount of LOB data on the server. When the client-side character set is of varying width, the following general rules apply to the <code class="codeph">amount</code> and <code class="codeph">offset</code> parameters in LOB calls:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">amount</code> - When the amount parameter refers to the server-side LOB, the amount is in characters. When the amount parameter refers to the client-side buffer, the amount is in bytes.</p>
</li>
<li>
<p><code class="codeph">offset</code> - Regardless of whether the client-side character set is varying-width, the offset parameter is always in characters for <code class="codeph">CLOB</code>s or <code class="codeph">NCLOB</code>s and in bytes for <code class="codeph">BLOB</code>s or <code class="codeph">BFILE</code>s.</p>
</li>
</ul>
<p>Exceptions to these general rules are noted in the description of the specific LOB call.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-8C5ABC9E-3048-49AE-BFE3-DB4CB1A63AB3" title="How to improve LOB Read/Write performance.">About Improving LOB Read/Write Performance</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-A88C554E-5397-477E-BC5D-1675D959D287" title="What functions are provided for LOB buffering.">LOB Buffering Functions</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-7BFEAAEE-0BF5-4104-844B-0AF8C4C6D6C9" title="OCI provides functions to explicitly open a LOB, OCILobOpen(), to close a LOB, OCILobClose(), and to test whether a LOB is open, OCILobIsOpen().">Functions for Opening and Closing LOBs</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-FFFD9E4C-03CE-469C-AA47-DFD73C0C9C69" title="OCI supports read and write callback functions.">LOB Read and Write Callbacks</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-7595F604-B560-4121-8254-57801341B02F__GUID-C40EC1D2-A511-487A-8E6D-0483F0549346">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-699FFE4B-07C8-4904-959F-3686E73B8188" title="Starts a user duration for a temporary LOB.Terminates a user duration for a temporary LOB.Closes a previously opened LOB or BFILE.Creates a temporary LOB.Closes a previously opened BFILE.Closes all open BFILEs on a given service context.Tests to see if the BFILE exists on the server&#39;s operating system.Gets the BFILE locator&#39;s directory object and file name.Tests to see if the BFILE is open.Opens a BFILE on the file system of the server for read-only access.Sets the directory object and file name in the BFILE locator.Gets the chunk size of a LOB.Gets the maximum length of an internal LOB (BLOB, CLOB, or NCLOB) in bytes. Tests whether a LOB or BFILE is open.Tests to see if a given LOB or BFILE locator is initialized.Opens a LOB, internal or external, in the indicated mode.Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB. Writes data starting at the end of a LOB. This function must be used for LOBs of size greater than 4 GB.">LOB Functions</a></p>
</li>
<li>
<p><a href="oci05bnd.htm#GUID-2A4C92CD-74EF-4990-9786-C50E7E1B1DEA" title="Do not set OCI_ATTR_MAXDATA_SIZE for OUT binds or for PL/SQL binds. Only set OCI_ATTR_MAXDATA_SIZE for INSERT or UPDATE statements.">Buffer Expansion During OCI Binding</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-404C8A50-516F-4DFD-939D-646A232AF7DF">OCILobCopy2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-264797B2-B3EA-4F6D-9A0E-BF8A4DDA13FA">OCILobErase2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-DA1CD18B-7044-4E40-B1F4-4FCC1FCAB6C4">OCILobLoadFromFile2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-ABDB1543-1782-4216-AD80-55FA82CFF733">OCILobTrim2()</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16511"></a>
<div class="props_rev_3"><a id="GUID-8C5ABC9E-3048-49AE-BFE3-DB4CB1A63AB3"></a>
<h3 id="LNOCI-GUID-8C5ABC9E-3048-49AE-BFE3-DB4CB1A63AB3" class="sect3">About Improving LOB Read/Write Performance</h3>
<div>
<p>How to improve LOB Read/Write performance.</p>
<div class="p">Here are some hints to improve performance:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-46577645-65A6-4530-B784-21404578F672" title="You can bind or define character data for a CLOB column or RAW data for a BLOB column.">About Using Data Interface for LOBs</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-7FE1C621-757B-48AC-A3C4-4FE6B5570DAC" title="OCILobGetChunkSize() returns the usable chunk size in bytes for BLOBs, CLOBs, and NCLOBs.">About Using OCILobGetChunkSize()</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-AA23DEDD-1C1D-48DB-898E-CC6D2A403F49" title="OCI provides a shortcut for more efficient writing of data to the end of a LOB.">About Using OCILobWriteAppend2()</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-79FAE125-5AF2-4B7A-B82D-5690196E3595" title="You can improve performance by using by using OCILobArrayRead() to read LOB data for multiple LOB locators and OCILobArrayWrite() to write LOB data for multiple LOB locators.">About Using OCILobArrayRead() and OCILobArrayWrite()</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16512"></a>
<div class="props_rev_3"><a id="GUID-46577645-65A6-4530-B784-21404578F672"></a>
<h4 id="LNOCI-GUID-46577645-65A6-4530-B784-21404578F672" class="sect4">About Using Data Interface for LOBs</h4>
<div>
<p>You can bind or define character data for a <code class="codeph">CLOB</code> column or <code class="codeph">RAW</code> data for a <code class="codeph">BLOB</code> column.</p>
<p>This requires only one round-trip for inserting or selecting a LOB, as opposed to the traditional LOB interface that requires multiple round-trips.</p>
<div class="infoboxnotealso" id="GUID-46577645-65A6-4530-B784-21404578F672__GUID-12CCC473-A8E8-4C0F-93A9-0FB0CA97FD46">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci05bnd.htm#GUID-D757C946-BCDA-4A32-867B-BE951BA9BBF4" title="Oracle Database allows nonzero binds for INSERTs and UPDATEs of any size LOB.">About Binding LOB Data</a> for usage and examples for both <code class="codeph">INSERT</code> and <code class="codeph">UPDATE</code> <span>statements</span></p>
</li>
<li>
<p><a href="oci05bnd.htm#GUID-FE7DB3D8-9310-41ED-8869-B5106E60D29E">About Defining LOB Data</a> for usage and examples of <code class="codeph">SELECT</code> statements</p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16513"></a>
<div class="props_rev_3"><a id="GUID-7FE1C621-757B-48AC-A3C4-4FE6B5570DAC"></a>
<h4 id="LNOCI-GUID-7FE1C621-757B-48AC-A3C4-4FE6B5570DAC" class="sect4">About Using OCILobGetChunkSize()</h4>
<div>
<p><code class="codeph">OCILobGetChunkSize()</code> returns the usable chunk size in bytes for <code class="codeph">BLOB</code>s, <code class="codeph">CLOB</code>s, and <code class="codeph">NCLOB</code>s.</p>
<p>You can use the <code class="codeph">OCILobGetChunkSize()</code> call to improve the performance of LOB read and write operations for BasicFile LOBs. When a read or write is done on BasicFile LOB data whose size is a multiple of the usable chunk size and the operation starts on a chunk boundary, performance is improved. There is no requirement for SecureFile LOBs to be written or read with <code class="codeph">OCILobGetChunkSize()</code> alignment.</p>
<p>Calling <code class="codeph">OCILobGetChunkSize()</code> returns the usable chunk size of the LOB, so that an application can batch a series of write operations for the entire chunk, rather than issuing multiple LOB write calls for the same chunk.</p>
<div class="infoboxnotealso" id="GUID-7FE1C621-757B-48AC-A3C4-4FE6B5570DAC__GUID-5BC49F72-5B8C-485D-977D-2EA258523754">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-5DEEF1FA-0024-48B4-B587-506386EA5240" title="For SecureFiles (LOBs with the STORE AS SECUREFILE option, which were introduced in Oracle Database 11g Release 1) you can specify the SQL parameter DEDUPLICATE in CREATE TABLE and ALTER TABLE statements.">Options of SecureFiles LOBs</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-ABB71585-172E-4F3E-A0CF-F70D709F2072" title="Gets the chunk size of a LOB.">OCILobGetChunkSize()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16514"></a>
<div class="props_rev_3"><a id="GUID-AA23DEDD-1C1D-48DB-898E-CC6D2A403F49"></a>
<h4 id="LNOCI-GUID-AA23DEDD-1C1D-48DB-898E-CC6D2A403F49" class="sect4">About Using OCILobWriteAppend2()</h4>
<div>
<p>OCI provides a shortcut for more efficient writing of data to the end of a LOB.</p>
<p>The <code class="codeph">OCILobWriteAppend2()</code> call appends data to the end of a LOB without first requiring a call to <code class="codeph">OCILobGetLength2()</code> to determine the starting point for an <code class="codeph">OCILobWrite2()</code> operation. <code class="codeph">OCILobWriteAppend2()</code> does both steps.</p>
<div class="infoboxnotealso" id="GUID-AA23DEDD-1C1D-48DB-898E-CC6D2A403F49__GUID-1CAD009D-571F-497F-9A10-8C69675C8A0B">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-87D3275A-B042-4991-B261-AB531BB83CA2" title="Writes data starting at the end of a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWriteAppend2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-9BC0A78A-37CB-432F-AE2B-22C905608C4C">OCILobGetLength2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI11597"></a>
<div class="props_rev_3"><a id="GUID-79FAE125-5AF2-4B7A-B82D-5690196E3595"></a>
<h4 id="LNOCI-GUID-79FAE125-5AF2-4B7A-B82D-5690196E3595" class="sect4">About Using OCILobArrayRead() and OCILobArrayWrite()</h4>
<div>
<p>You can improve performance by using by using <code class="codeph">OCILobArrayRead()</code> to read LOB data for multiple LOB locators and <code class="codeph">OCILobArrayWrite()</code> to write LOB data for multiple LOB locators.</p>
<p>These functions, which were introduced in Oracle Database 10g Release 2, reduce the number of round-trips for these operations.</p>
<div class="infoboxnotealso" id="GUID-79FAE125-5AF2-4B7A-B82D-5690196E3595__GUID-989E9FDB-B869-4A69-BC97-8F3011A54787">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADLOB1400" target="_blank" href="../ADLOB/adlob_lob_ops.htm#ADLOB1400"><span><cite>Oracle Database SecureFiles and Large Objects Developer&#39;s Guide</cite></span></a> sections &#34;LOB Array Read&#34; and &#34;LOB Array Write&#34; for more information and code examples that show how to use these functions with callback functions and in piecewise mode</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-47652C79-0635-4595-A34B-CD03B7F81A9F">OCILobArrayRead()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-10AB60C9-13FE-4CC9-9C62-CAD45DBB3B93">OCILobArrayWrite()</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="LNOCI16515"></a>
<div class="props_rev_3"><a id="GUID-A88C554E-5397-477E-BC5D-1675D959D287"></a>
<h3 id="LNOCI-GUID-A88C554E-5397-477E-BC5D-1675D959D287" class="sect3">LOB Buffering Functions</h3>
<div>
<p>What functions are provided for LOB buffering.</p>
<p>OCI provides several calls for controlling LOB buffering for small reads and writes of internal LOB values:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">OCILobEnableBuffering()</code></p>
</li>
<li>
<p><code class="codeph">OCILobDisableBuffering()</code></p>
</li>
<li>
<p><code class="codeph">OCILobFlushBuffer()</code></p>
</li>
</ul>
<p>These functions enable applications that are using internal LOBs (<code class="codeph">BLOB</code>, <code class="codeph">CLOB</code>, <code class="codeph">NCLOB</code>) to buffer small reads and writes in client-side buffers. This reduces the number of network round-trips and LOB versions, thereby improving LOB performance significantly.</p>
<div class="infoboxnotealso" id="GUID-A88C554E-5397-477E-BC5D-1675D959D287__GUID-8F3C0713-CF09-43BC-8F2C-DA47A722AF94">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADLOB45321" target="_blank" href="../ADLOB/adlob_design.htm#ADLOB45321"><span class="italic">Oracle Database SecureFiles and Large Objects Developer&#39;s Guide.</span></a> For more information on LOB buffering, see the chapter about using LOB APIs.</p>
</li>
<li>
<p><a href="ociacrou.htm#GUID-AD3700EF-9293-4E14-807E-43A6B395CBD5" title="Describes for each OCI LOB function the number of server round-trips.">LOB Function Round-Trips</a> for a list of the server round-trips required for each function</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-588B17BE-DB5F-4D2D-8FF1-7E4BEABFA917">OCILobEnableBuffering()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-6BE287D0-3385-4514-850A-349940ECB26A">OCILobDisableBuffering()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-E63ACF53-B64F-4E57-9EBE-B7B73C033EE1">OCILobFlushBuffer()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16516"></a>
<div class="props_rev_3"><a id="GUID-7BFEAAEE-0BF5-4104-844B-0AF8C4C6D6C9"></a>
<h3 id="LNOCI-GUID-7BFEAAEE-0BF5-4104-844B-0AF8C4C6D6C9" class="sect3">Functions for Opening and Closing LOBs</h3>
<div>
<p>OCI provides functions to explicitly open a LOB, <code class="codeph">OCILobOpen()</code>, to close a LOB, <code class="codeph">OCILobClose()</code>, and to test whether a LOB is open, <code class="codeph">OCILobIsOpen()</code>.</p>
<p>These functions mark the beginning and end of a series of LOB operations so that specific processing, such as updating indexes, can be performed when a LOB is closed.</p>
<p>For internal LOBs, the concept of openness is associated with a LOB and not its locator. The locator does not store any information about the state of the LOB. It is possible for more than one locator to point to the same open LOB. However, for <code class="codeph">BFILE</code>s, being open is associated with a specific locator. Hence, more than one open call can be performed on the same <code class="codeph">BFILE</code> by using different locators.</p>
<p>If an application does not wrap LOB operations within a set of <code class="codeph">OCILobOpen()</code> and <code class="codeph">OCILobClose()</code> calls, then each modification to the LOB implicitly opens and closes the LOB, thereby firing any triggers associated with changes to the LOB.</p>
<p>If LOB operations are not wrapped within open and close calls, any extensible indexes on the LOB are updated as LOB modifications are made, and thus are always valid and may be used at any time. If the LOB is modified within a set of <code class="codeph">OCILobOpen()</code> and <code class="codeph">OCILobClose()</code> calls, triggers are not fired for individual LOB modifications. Triggers are only fired after the <code class="codeph">OCILobClose()</code> call, so indexes are not updated until after the close call and thus are not valid within the open and close calls. <code class="codeph">OCILobIsOpen()</code> can be used with internal LOBs and <code class="codeph">BFILEs</code>.</p>
<p>An error is returned when you commit the transaction before closing all opened LOBs that were opened by the transaction. When the error is returned, the LOB is no longer marked as open, but the transaction is successfully committed. Hence, all the changes made to the LOB and non-LOB data in the transaction are committed, but the domain and functional indexing are not updated. If this happens, rebuild your functional and domain indexes on the LOB column.</p>
<p>A LOB opened when there is no transaction must be closed before the end of the session. If there are LOBs open at the end of session, the LOB is no longer marked as open and the domain and functional indexing is not updated. If this happens, rebuild your functional and domain indexes on the LOB column.</p>
<p>This section includes the following topic: <a href="oci07lob.htm#GUID-5B778EC5-B4C3-49BF-9254-E9BB853DE61D" title="What are the restrictions on opening and closing LOBs.">Restrictions on Opening and Closing LOBs</a>.</p>
<div class="infoboxnotealso" id="GUID-7BFEAAEE-0BF5-4104-844B-0AF8C4C6D6C9__GUID-8D571BCD-9877-4C37-BD29-0C108B74C7AA">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-B007A3C7-999B-4AD7-8BF7-C6D14572F470" title="Opens a LOB, internal or external, in the indicated mode.">OCILobOpen()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-CBEB9238-6B47-4A08-8C8D-FC2E5ED56557" title="Closes a previously opened LOB or BFILE.">OCILobClose()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-FFF883CE-3B99-4319-A81C-A11F8740209E" title="Tests whether a LOB or BFILE is open.">OCILobIsOpen()</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16517"></a>
<div class="props_rev_3"><a id="GUID-5B778EC5-B4C3-49BF-9254-E9BB853DE61D"></a>
<h4 id="LNOCI-GUID-5B778EC5-B4C3-49BF-9254-E9BB853DE61D" class="sect4">Restrictions on Opening and Closing LOBs</h4>
<div>
<p>What are the restrictions on opening and closing LOBs.</p>
<p>The LOB opening and closing mechanism has the following restrictions:</p>
<ul style="list-style-type: disc;">
<li>
<p>An application must close all previously opened LOBs before committing a transaction. Failing to do so results in an error. If a transaction is rolled back, all open LOBs are discarded along with the changes made. Because the LOBs are not closed, so the associated triggers are not fired.</p>
</li>
<li>
<p>Although there is no limit to the number of open internal LOBs, there is a limit on the number of open files as determined by the <code class="codeph">SESSION_MAX_OPEN_FILES</code> parameter. Assigning an already opened locator to another locator does not count as opening a new LOB.</p>
</li>
<li>
<p>It is an error to open or close the same internal LOB twice within the same transaction, either with different locators or the same locator.</p>
</li>
<li>
<p>It is an error to close a LOB that has not been opened.</p>
<div class="infobox-note" id="GUID-5B778EC5-B4C3-49BF-9254-E9BB853DE61D__GUID-9D5AD462-6E56-40D6-B102-0A9DCC769D12">
<p class="notep1">Note:</p>
<p>The definition of a <span class="italic">transaction</span> within which an open LOB value must be closed is one of the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Between <code class="codeph">SET TRANSACTION</code> and <code class="codeph">COMMIT</code></p>
</li>
<li>
<p>Between <code class="codeph">DATA</code> <code class="codeph">MODIFYING</code> <code class="codeph">DML</code> or <code class="codeph">SELECT</code> <code class="codeph">... FOR UPDATE</code> and <code class="codeph">COMMIT</code>.</p>
</li>
<li>
<p>Within an autonomous transaction block</p>
</li>
</ul>
</div>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-5B778EC5-B4C3-49BF-9254-E9BB853DE61D__GUID-3D1E1245-9440-49DC-A2B4-A1D55F36E53F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">SESSION_MAX_OPEN_FILES</code> parameter in <a class="olink REFRN10196" target="_blank" href="../REFRN/GUID-19E28C4B-600C-49BA-9E13-84E01280E3CA.htm#REFRN10196"><span><cite>Oracle Database Reference</cite></span></a></p>
</li>
<li>
<p><a href="ociabdem.htm#GUID-75E18629-0C54-4495-A747-AFB346034F26" title="Lists example programs with sample code demonstrating the allocation and use of OCI handles.">OCI Demonstration Programs</a> for examples of the use of the <a href="oci17msc002.htm#GUID-B007A3C7-999B-4AD7-8BF7-C6D14572F470" title="Opens a LOB, internal or external, in the indicated mode.">OCILobOpen()</a> and <a href="oci17msc002.htm#GUID-CBEB9238-6B47-4A08-8C8D-FC2E5ED56557" title="Closes a previously opened LOB or BFILE.">OCILobClose()</a> calls in the online demonstration programs</p>
</li>
<li>
<p><a href="ociacrou.htm#GUID-AD3700EF-9293-4E14-807E-43A6B395CBD5__CACHAFFI" title="This table has 2 columns. Column 1 is the function name and column 2 describes the number of server round-trips.">Table C-2</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="LNOCI16518"></a>
<div class="props_rev_3"><a id="GUID-FFFD9E4C-03CE-469C-AA47-DFD73C0C9C69"></a>
<h3 id="LNOCI-GUID-FFFD9E4C-03CE-469C-AA47-DFD73C0C9C69" class="sect3">LOB Read and Write Callbacks</h3>
<div>
<p>OCI supports read and write callback functions.</p>
<div class="p">The following sections describe the use of callbacks in more detail:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-94EB10D8-73A4-4F90-8610-3A2B31D1F5C0">Callback Interface for Streaming</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-5DB4A35A-BCE1-4D7B-B836-63FD2C83195E">Reading LOBs by Using Callbacks</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-4BE362B6-B13C-4959-94B2-599CBC2B581D">Writing LOBs by Using Callbacks</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16519"></a>
<div class="props_rev_3"><a id="GUID-94EB10D8-73A4-4F90-8610-3A2B31D1F5C0"></a>
<h4 id="LNOCI-GUID-94EB10D8-73A4-4F90-8610-3A2B31D1F5C0" class="sect4">Callback Interface for Streaming</h4>
<div>
<p>User-defined read and write callback functions for inserting or retrieving data provide an alternative to the polling methods for streaming LOBs. These functions are implemented by you and registered with OCI through the <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a>, <a href="oci17msc002.htm#GUID-87D3275A-B042-4991-B261-AB531BB83CA2" title="Writes data starting at the end of a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWriteAppend2()</a>, and <a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a> calls. These callback functions are called by OCI whenever they are required.</p>
</div>
</div>
<a id="LNOCI72636"></a><a id="LNOCI16520"></a>
<div class="props_rev_3"><a id="GUID-5DB4A35A-BCE1-4D7B-B836-63FD2C83195E"></a>
<h4 id="LNOCI-GUID-5DB4A35A-BCE1-4D7B-B836-63FD2C83195E" class="sect4">Reading LOBs by Using Callbacks</h4>
<div>
<div class="section">
<p>The user-defined read callback function is registered through the <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a> function. The callback function should have the following prototype:</p>
<pre dir="ltr">CallbackFunctionName ( void *ctxp, CONST void *bufp, oraub8 len, ub1 piece,
                       void **changed_bufpp, oraub8 *changed_lenp);
</pre>
<p>The first parameter, <code class="codeph">ctxp</code>, is the context of the callback that is passed to OCI in the <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a> function call. When the callback function is called, the information provided by you in <code class="codeph">ctxp</code> is passed back to you (OCI does not use this information on the way IN). The <code class="codeph">bufp</code> parameter in <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a>) is the pointer to the storage where the LOB data is returned and <code class="codeph">bufl</code> is the length of this buffer. It tells you how much data has been read into the buffer provided.</p>
<p>If the buffer length provided in the original <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a> call is insufficient to store all the data returned by the server, then the user-defined callback is called. In this case, the <code class="codeph">piece</code> parameter indicates whether the information returned in the buffer is the first, next, or last piece.</p>
<p>The parameters <code class="codeph">changed_bufpp</code> and <code class="codeph">changed_lenp</code> can be used inside the callback function to change the buffer dynamically. The <code class="codeph">changed_bufpp</code> parameter should point to the address of the changed buffer and the <code class="codeph">changed_lenp</code> parameter should point to the length of the changed buffer. The <code class="codeph">changed_bufpp</code> and <code class="codeph">changed_lenp</code> parameters need not be used inside the callback function if the application does not change the buffer dynamically.</p>
<p><a href="oci07lob.htm#GUID-5DB4A35A-BCE1-4D7B-B836-63FD2C83195E__BGBBBEDI">Example 7-1</a> shows a code fragment that implements read callback functions using <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a>. Assume that <code class="codeph">lobl</code> is a valid locator that has been previously selected, <code class="codeph">svchp</code> is a valid service handle, and <code class="codeph">errhp</code> is a valid error handle. In the example, the user-defined function <code class="codeph">cbk_read_lob()</code> is repeatedly called until all the LOB data has been read.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-5DB4A35A-BCE1-4D7B-B836-63FD2C83195E__BGBBBEDI">
<p class="titleinexample">Example 7-1 Implementing Read Callback Functions Using OCILobRead2()</p>
<pre dir="ltr">...
oraub8   offset = 1;
oraub8   loblen = 0; 
oraub8   byte_amt = 0;
oraub8   char_amt = 0
ub1      bufp[MAXBUFLEN];

sword retval; 
byte_amtp = 4294967297;     /* 4 gigabytes plus 1 */ 

if (retval = OCILobRead2(svchp, errhp, lobl, &amp;byte_amt, &amp;char_amt, offset,
  (void *) bufp, (oraub8) MAXBUFLEN, (void *) 0, OCI_FIRST_PIECE, 
  cbk_read_lob, (ub2) 0, (ub1) SQLCS_IMPLICIT))
{
     (void) printf(&#34;ERROR: OCILobRead2() LOB.\n&#34;);
     report_error();
}
...
sb4 cbk_read_lob(ctxp, bufxp, len, piece, changed_bufpp, changed_lenp)
void       *ctxp;
CONST void *bufxp;
oraub8      len;
ub1         piece;
void       **changed_bufpp;
oraub8      *changed_lenp; 
{ 
    static ub4 piece_count = 0; 
    piece_count++; 

    switch (piece)
   {
      case OCI_LAST_PIECE:     /*--- buffer processing code goes here ---*/ 
          (void) printf(&#34;callback read the %d th piece\n\n&#34;, piece_count);
          piece_count = 0;
          break;
      case OCI_FIRST_PIECE:   /*--- buffer processing code goes here ---*/ 
          (void) printf(&#34;callback read the %d th piece\n&#34;, piece_count);
          /* --Optional code to set changed_bufpp and changed_lenp if the
              buffer must be changed dynamically --*/
          break;
      case OCI_NEXT_PIECE:   /*--- buffer processing code goes here ---*/
          (void) printf(&#34;callback read the %d th piece\n&#34;, piece_count);
         /* --Optional code to set changed_bufpp and changed_lenp if the
             buffer must be changed dynamically --*/
          break;
      default:
          (void) printf(&#34;callback read error: unknown piece = %d.\n&#34;, piece);
           return OCI_ERROR;
     } 
    return OCI_CONTINUE;
}
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI72637"></a><a id="LNOCI16521"></a>
<div class="props_rev_3"><a id="GUID-4BE362B6-B13C-4959-94B2-599CBC2B581D"></a>
<h4 id="LNOCI-GUID-4BE362B6-B13C-4959-94B2-599CBC2B581D" class="sect4">Writing LOBs by Using Callbacks</h4>
<div>
<div class="section">
<p>Similar to read callbacks, the user-defined write callback function is registered through the <a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a> function. The callback function should have the following prototype:</p>
<pre dir="ltr">CallbackFunctionName ( void *ctxp, void *bufp, oraub8 *lenp, ub1 *piecep,
                        void **changed_bufpp, oraub8 *changed_lenp);
</pre>
<p>The first parameter, <code class="codeph">ctxp</code>, is the context of the callback that is passed to OCI in the <a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a> function call. The information provided by you in <code class="codeph">ctxp</code> is passed back to you when the callback function is called by OCI (OCI does not use this information on the way IN). The <code class="codeph">bufp</code> parameter is the pointer to a storage area; you provide this pointer in the call to <a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a>.</p>
<p>After inserting the data provided in the call to <a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a> any data remaining is inserted by the user-defined callback. In the callback, provide the data to insert in the storage indicated by <code class="codeph">bufp</code> and also specify the length in <code class="codeph">lenp</code>. You also indicate whether it is the next (<code class="codeph">OCI_NEXT_PIECE</code>) or the last (<code class="codeph">OCI_LAST_PIECE</code>) piece using the <code class="codeph">piecep</code> parameter. You must ensure that the storage pointer that is provided by the application does not write more than the allocated size of the storage.</p>
<p>The parameters <code class="codeph">changed_bufpp</code> and <code class="codeph">changed_lenp</code> can be used inside the callback function to change the buffer dynamically. The <code class="codeph">changed_bufpp</code> parameter should point to the address of the changed buffer and the <code class="codeph">changed_lenp</code> parameter should point to the length of the changed buffer. The <code class="codeph">changed_bufpp</code> and <code class="codeph">changed_lenp</code> parameters need not be used inside the callback function if the application does not change the buffer dynamically.</p>
<p><a href="oci07lob.htm#GUID-4BE362B6-B13C-4959-94B2-599CBC2B581D__BGBCHBJA">Example 7-2</a> shows a code fragment that implements write callback functions using <a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a>. Assume that <code class="codeph">lobl</code> is a valid locator that has been locked for updating, <code class="codeph">svchp</code> is a valid service handle, and <code class="codeph">errhp</code> is a valid error handle. The user-defined function <code class="codeph">cbk_write_lob()</code> is repeatedly called until the <code class="codeph">piecep</code> parameter indicates that the application is providing the last piece.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-4BE362B6-B13C-4959-94B2-599CBC2B581D__BGBCHBJA">
<p class="titleinexample">Example 7-2 Implementing Write Callback Functions Using OCILobWrite2()</p>
<pre dir="ltr">...
 
ub1      bufp[MAXBUFLEN];
oraub8   byte_amt = MAXBUFLEN * 20;
oraub8   char_amt = 0;
oraub8   offset = 1;
oraub8   nbytes = MAXBUFLEN; 

/*-- code to fill bufp with data goes here. nbytes should reflect the size and
 should be less than or equal to MAXBUFLEN --*/
if (retval = OCILobWrite2(svchp, errhp, lobl, &amp;byte_amt, &amp;char_amt, offset,
    (void*)bufp, (ub4)nbytes, OCI_FIRST_PIECE, (void *)0, cbk_write_lob, 
    (ub2) 0, (ub1) SQLCS_IMPLICIT)) 
{
   (void) printf(&#34;ERROR: OCILobWrite2().\n&#34;);
   report_error();
   return;
}
... 
sb4 cbk_write_lob(ctxp, bufxp, lenp,  piecep, changed_bufpp, changed_lenp)
void    *ctxp; 
void    *bufxp; 
oraub8  *lenp; 
ub1       *piecep;
void  **changed_bufpp;
oraub8  *changed_lenp; 
{ 
    /*-- code to fill bufxp with data goes here. *lenp should reflect the
        size and should be less than or equal to MAXBUFLEN -- */
    /* --Optional code to set changed_bufpp and changed_lenp if the
        buffer must be changed dynamically --*/
    if (this is the last data buffer) 
        *piecep = OCI_LAST_PIECE; 
    else
        *piecep = OCI_NEXT_PIECE; 
    return OCI_CONTINUE;
}
</pre></div>
<!-- class="example" --></div>
</div>
</div>
</div>
<a id="LNOCI16522"></a>
<div class="props_rev_3"><a id="GUID-B9A9B78B-570B-4B54-A4C4-A2F2D2808B06"></a>
<h2 id="LNOCI-GUID-B9A9B78B-570B-4B54-A4C4-A2F2D2808B06" class="sect2">Temporary LOB Support</h2>
<div>
<p>OCI provides functions for creating and freeing temporary LOBs, <code class="codeph">OCILobCreateTemporary()</code> and <code class="codeph">OCILobFreeTemporary()</code>, and a function for determining whether a LOB is temporary, <code class="codeph">OCILobIsTemporary()</code>.</p>
<p>Temporary LOBs are not permanently stored in the database, but act like local variables for operating on LOB data. OCI functions that operate on standard (persistent) LOBs can also be used on temporary LOBs.</p>
<p>As with persistent LOBs, all functions operate on the locator for the temporary LOB, and the actual LOB data is accessed through the locator.</p>
<p>Temporary LOB locators can be used as arguments to the following types of SQL statements:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">UPDATE</code> - The temporary LOB locator can be used as a value in a <code class="codeph">WHERE</code> clause when testing for nullity or as a parameter to a function. The locator can also be used in a <code class="codeph">SET</code> clause.</p>
</li>
<li>
<p><code class="codeph">DELETE</code> - The temporary LOB locator can be used in a <code class="codeph">WHERE</code> clause when testing for nullity or as a parameter to a function.</p>
</li>
<li>
<p><code class="codeph">SELECT</code> - The temporary LOB locator can be used in a <code class="codeph">WHERE</code> clause when testing for nullity or as a parameter to a function. The temporary LOB can also be used as a return variable in a <code class="codeph">SELECT...INTO</code> statement when selecting the return value of a function.</p>
</li>
</ul>
<div class="infobox-note" id="GUID-B9A9B78B-570B-4B54-A4C4-A2F2D2808B06__GUID-FF3460B5-AEF2-49A0-82E0-FA95A7123DCC">
<p class="notep1">Note:</p>
<p>If you select a permanent locator into a temporary locator, the temporary locator is overwritten with the permanent locator. In this case, the temporary LOB is not implicitly freed. You must explicitly free the temporary LOB before the <code class="codeph">SELECT...INTO</code> operation. If the temporary LOB is not freed explicitly, it is not freed until the end of its specified <code class="codeph">duration</code>. Unless you have another temporary locator pointing to the same LOB, you no longer have a locator pointing to the temporary LOB, because the original locator was overwritten by the <code class="codeph">SELECT...INTO</code> operation.</p>
</div>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci07lob.htm#GUID-7A401AB9-FFFB-49B9-86FE-BEFFBF0EF438">Creating and Freeing Temporary LOBs</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-5291BFEA-E35C-4097-AC29-59D03166546A">Temporary LOB Durations</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-19F5922C-3560-476B-B414-27F13B5C2BAC">About Freeing Temporary LOBs</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-793BD3A1-0D07-4A59-A9ED-CDF7A4976B5D" title="Special care must be taken when assigning OCILobLocator pointers.">Take Care When Assigning Pointers</a></p>
</li>
<li>
<p><a href="oci07lob.htm#GUID-8A0523FD-25E9-45AE-A623-CCB8940713D4" title="Shows how temporary LOBs can be used.">Temporary LOB Example</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-B9A9B78B-570B-4B54-A4C4-A2F2D2808B06__GUID-6B2776B2-4CEC-45CD-9A84-42F44D5B793C">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-63F75EC5-EB14-4E25-B593-270FF814615A" title="Creates a temporary LOB.">OCILobCreateTemporary()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-E0FBF017-1B08-410C-9E53-F6E14008813A">OCILobFreeTemporary()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-071D8134-F9E7-4C5A-8E63-E90831FA7AC3">OCILobIsTemporary()</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16523"></a>
<div class="props_rev_3"><a id="GUID-7A401AB9-FFFB-49B9-86FE-BEFFBF0EF438"></a>
<h3 id="LNOCI-GUID-7A401AB9-FFFB-49B9-86FE-BEFFBF0EF438" class="sect3">Creating and Freeing Temporary LOBs</h3>
<div>
<p>You create a temporary LOB with the <a href="oci17msc002.htm#GUID-63F75EC5-EB14-4E25-B593-270FF814615A" title="Creates a temporary LOB.">OCILobCreateTemporary()</a> function. The parameters passed to this function include a value for the duration of the LOB. The default duration is for the length of the current session. All temporary LOBs are deleted at the end of the duration. Users can reclaim temporary LOB space by explicitly freeing the temporary LOB with the <a href="oci17msc002.htm#GUID-E0FBF017-1B08-410C-9E53-F6E14008813A">OCILobFreeTemporary()</a> function. A temporary LOB is empty when it is created.</p>
<p>When creating a temporary LOB, you can also specify whether the temporary LOB is read into the server&#39;s buffer cache.</p>
<p>To make a temporary LOB permanent, use <a href="oci17msc002.htm#GUID-404C8A50-516F-4DFD-939D-646A232AF7DF">OCILobCopy2()</a> to copy the data from the temporary LOB into a permanent one. You can also use the temporary LOB in the <code class="codeph">VALUES</code> clause of an <code class="codeph">INSERT</code> statement, as the source of the assignment in an <code class="codeph">UPDATE</code> statement, or assign it to a persistent LOB attribute and then flush the object. Temporary LOBs can be modified using the same functions that are used for standard LOBs.</p>
<div class="infobox-note" id="GUID-7A401AB9-FFFB-49B9-86FE-BEFFBF0EF438__GUID-A7A1D5BE-60E3-4867-B110-FB9865EAF1DD">
<p class="notep1">Note:</p>
<p>The most efficient way to<a id="d92511e6483" class="indexterm-anchor"></a><a id="d92511e6485" class="indexterm-anchor"></a> insert an empty LOB is to bind a temporary LOB with no value assigned to it. This uses less resources than the following method.</p>
<pre dir="ltr">INSERT INTO tab1 VALUES(EMPTY_CLOB())
</pre></div>
</div>
</div>
<a id="LNOCI16524"></a>
<div class="props_rev_3"><a id="GUID-5291BFEA-E35C-4097-AC29-59D03166546A"></a>
<h3 id="LNOCI-GUID-5291BFEA-E35C-4097-AC29-59D03166546A" class="sect3">Temporary LOB Durations</h3>
<div>
<p>OCI supports several predefined durations for temporary LOBs, and a set of functions that the application can use to define application-specific durations. The predefined durations and their associated attributes are:</p>
<ul style="list-style-type: disc;">
<li>
<p>Call, <code class="codeph">OCI_DURATION_CALL</code>, only on the server side</p>
</li>
<li>
<p>Session, <code class="codeph">OCI_DURATION_SESSION</code></p>
</li>
</ul>
<p>The session duration expires when the containing session or connection ends. The call duration expires at the end of the current OCI call.</p>
<p>When you run in object mode, you can also define application-specific durations. An application-specific duration, also referred to as a user duration, is defined by specifying the start of a duration using <a href="oci20ext002.htm#GUID-7DE91342-CFF9-4227-8E67-58296C2C8F69">OCIDurationBegin()</a> and the end of the duration using <a href="oci20ext002.htm#GUID-23B6E6E2-FAB7-4862-A81E-25C94112E05E">OCIDurationEnd()</a>.</p>
<div class="infobox-note" id="GUID-5291BFEA-E35C-4097-AC29-59D03166546A__GUID-922A6C12-F5BF-4BA2-BDFB-1E1D596D22C1">
<p class="notep1">Note:</p>
<p>User-defined durations are only available if an application has been initialized in object mode.</p>
</div>
<p>Each application-specific duration has a duration identifier that is returned by <a href="oci20ext002.htm#GUID-7DE91342-CFF9-4227-8E67-58296C2C8F69">OCIDurationBegin()</a> and is guaranteed to be unique until <a href="oci20ext002.htm#GUID-23B6E6E2-FAB7-4862-A81E-25C94112E05E">OCIDurationEnd()</a> is called. An application-specific duration can be as long as a session duration.</p>
<p>At the end of a duration, all temporary LOBs associated with that duration are freed. The descriptor associated with the temporary LOB must be freed explicitly with the <a href="oci16rel002.htm#GUID-A32BF051-3DC1-491C-AAFD-A46034DD1629">OCIDescriptorFree()</a> call.</p>
<p>User-defined durations can be nested; one duration can be defined as a child duration of another user duration. It is possible for a parent duration to have child durations that have their own child durations.</p>
<div class="infobox-note" id="GUID-5291BFEA-E35C-4097-AC29-59D03166546A__GUID-EDF7A261-7692-43A6-8213-74C1FFCDDF98">
<p class="notep1">Note:</p>
<p>When a duration is started with <a href="oci20ext002.htm#GUID-7DE91342-CFF9-4227-8E67-58296C2C8F69">OCIDurationBegin()</a>, one of the parameters is the identifier of a parent duration. When a parent duration is ended, all child durations are also ended.</p>
</div>
</div>
</div>
<a id="LNOCI16525"></a>
<div class="props_rev_3"><a id="GUID-19F5922C-3560-476B-B414-27F13B5C2BAC"></a>
<h3 id="LNOCI-GUID-19F5922C-3560-476B-B414-27F13B5C2BAC" class="sect3">About Freeing Temporary LOBs</h3>
<div>
<p>Any time that your OCI program obtains a LOB locator from SQL or PL/SQL, use the <a href="oci17msc002.htm#GUID-071D8134-F9E7-4C5A-8E63-E90831FA7AC3">OCILobIsTemporary()</a> function to check that the locator is temporary. If it is, then free the locator when your application is finished with it by using the <a href="oci17msc002.htm#GUID-E0FBF017-1B08-410C-9E53-F6E14008813A">OCILobFreeTemporary()</a> call. The locator can be from a define during a select or an out bind. A temporary LOB duration is always upgraded to a session duration when it is shipped to the client side. The application must do the following before the locator is overwritten by the locator of the next row:</p>
<pre dir="ltr">OCILobIsTemporary(env, err, locator, is_temporary);
if(is_temporary)
    OCILobFreeTemporary(svc, err, locator);
</pre>
<div class="infoboxnotealso" id="GUID-19F5922C-3560-476B-B414-27F13B5C2BAC__GUID-5B9D6058-CD86-4CFB-A493-78723F0D0540">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="oci17msc002.htm#GUID-071D8134-F9E7-4C5A-8E63-E90831FA7AC3">OCILobIsTemporary()</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="oci17msc002.htm#GUID-E0FBF017-1B08-410C-9E53-F6E14008813A">OCILobFreeTemporary()</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16526"></a>
<div class="props_rev_3"><a id="GUID-793BD3A1-0D07-4A59-A9ED-CDF7A4976B5D"></a>
<h3 id="LNOCI-GUID-793BD3A1-0D07-4A59-A9ED-CDF7A4976B5D" class="sect3">Take Care When Assigning Pointers</h3>
<div>
<p>Special care must be taken when assigning <code class="codeph">OCILobLocator</code> pointers.</p>
<p>Pointer assignments create a shallow copy of the LOB. After the pointer assignment, source and target LOBs point to the same copy of data. This behavior is different from using LOB APIs, such as <code class="codeph">OCILobAssign()</code> or <code class="codeph">OCILobLocatorAssign()</code>, to perform assignments. When the APIs are used, the locators logically point to independent copies of data after assignment.</p>
<p>For temporary LOBs, before pointer assignments, you must ensure that any temporary LOB in the target LOB locator is freed by <code class="codeph">OCILobFreeTemporary()</code>. When <code class="codeph">OCILobLocatorAssign()</code> is used, the original temporary LOB in the target LOB locator variable, if any, is freed before the assignment happens.</p>
<p>Before an out-bind variable is reused in executing a SQL statement, you must free any temporary LOB in the existing out-bind LOB locator buffer by using the <code class="codeph">OCILobFreeTemporary()</code> call.</p>
<div class="infoboxnotealso" id="GUID-793BD3A1-0D07-4A59-A9ED-CDF7A4976B5D__GUID-67C193DC-A4E0-474C-BCFA-6CB36BAA2880">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADLOB105" target="_blank" href="../ADLOB/adlob_performance.htm#ADLOB105"><span><cite>Oracle Database SecureFiles and Large Objects Developer&#39;s Guide</cite></span></a> for information in the section about temporary LOB performance guidelines</p>
</li>
<li>
<p><a class="olink ADLOB106" target="_blank" href="../ADLOB/adlob_performance.htm#ADLOB106"><span><cite>Oracle Database SecureFiles and Large Objects Developer&#39;s Guide</cite></span></a> for a discussion of optimal performance of temporary LOBs</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-B052C110-D039-44A1-85C6-F5CC7348E2DC">OCILobAssign()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-F7887376-4B3C-430C-94A3-11FE96E26627">OCILobLocatorAssign()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-E0FBF017-1B08-410C-9E53-F6E14008813A">OCILobFreeTemporary()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-F7887376-4B3C-430C-94A3-11FE96E26627">OCILobLocatorAssign()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI72638"></a><a id="LNOCI16527"></a>
<div class="props_rev_3"><a id="GUID-8A0523FD-25E9-45AE-A623-CCB8940713D4"></a>
<h3 id="LNOCI-GUID-8A0523FD-25E9-45AE-A623-CCB8940713D4" class="sect3">Temporary LOB Example</h3>
<div>
<p>Shows how temporary LOBs can be used.</p>
<div class="section">
<p><a href="oci07lob.htm#GUID-8A0523FD-25E9-45AE-A623-CCB8940713D4__BGBDECFH">Example 7-3</a> shows how temporary LOBs can be used.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-8A0523FD-25E9-45AE-A623-CCB8940713D4__BGBDECFH">
<p class="titleinexample">Example 7-3 Using Temporary LOBs</p>
<pre dir="ltr">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;oci.h&gt;

/* Function Prototype */
static void checkerr (/*_ OCIError *errhp, sword status _*/);
sb4 select_and_createtemp (OCILobLocator *lob_loc,
                           OCIError      *errhp,
                           OCISvcCtx     *svchp,
                           OCIStmt       *stmthp,
                           OCIEnv        *envhp);
/* This function reads in a single video frame from the print_media table.
Then it creates a temporary LOB. The temporary LOB that is created is read
through the CACHE, and is automatically cleaned up at the end of the user&#39;s
session, if it is not explicitly freed sooner. This function returns OCI_SUCCESS
if it completes successfully or OCI_ERROR if it fails. */

sb4 select_and_createtemp (OCILobLocator *lob_loc,
                           OCIError      *errhp,
                           OCISvcCtx     *svchp,
                           OCIStmt       *stmthp,
                           OCIEnv        *envhp)
{
  OCIDefine     *defnp1;
  OCIBind       *bndhp;
  text          *sqlstmt;
  int rowind =1;
  ub4 loblen = 0;
  OCILobLocator *tblob;
  printf (&#34;in select_and_createtemp \n&#34;);
    if(OCIDescriptorAlloc((void*)envhp, (void **)&amp;tblob,
                          (ub4)OCI_DTYPE_LOB, (size_t)0, (void**)0))
  {
    printf(&#34;failed in OCIDescriptor Alloc in select_and_createtemp \n&#34;);
    return OCI_ERROR;
 }
  /* arbitrarily select where Clip_ID =1 */
  sqlstmt=(text *)&#34;SELECT Frame FROM print_media WHERE product_ID = 1 FOR UPDATE&#34;;
  if (OCIStmtPrepare2(svchp, stmthp, errhp, sqlstmt, (ub4) strlen((char *)sqlstmt),
                     NULL, 0, (ub4) OCI_NTV_SYNTAX, (ub4) OCI_DEFAULT))
  {
      (void) printf(&#34;FAILED: OCIStmtPrepare() sqlstmt\n&#34;);
      return OCI_ERROR;
  }
  /* Define for BLOB */
  if (OCIDefineByPos(stmthp, &amp;defnp1, errhp, (ub4)1, (void *) &amp;lob_loc, (sb4)0,
             (ub2) SQLT_BLOB, (void *)0, (ub2 *)0, (ub2 *)0, (ub4) OCI_DEFAULT))
  {
    (void) printf(&#34;FAILED: Select locator: OCIDefineByPos()\n&#34;);
    return OCI_ERROR;
  }
  /* Execute the select and fetch one row */
  if (OCIStmtExecute(svchp, stmthp, errhp, (ub4) 1, (ub4) 0,
                   (CONST OCISnapshot*) 0, (OCISnapshot*) 0, (ub4) OCI_DEFAULT))
  {
    (void) printf(&#34;FAILED: OCIStmtExecute() sqlstmt\n&#34;);
    return OCI_ERROR;
  }
  if(OCILobCreateTemporary(svchp, errhp, tblob, (ub2)0, SQLCS_IMPLICIT,
                         OCI_TEMP_BLOB, OCI_ATTR_NOCACHE, OCI_DURATION_SESSION))
  {
    (void) printf(&#34;FAILED: CreateTemporary() \n&#34;);
    return OCI_ERROR;
  }
  if (OCILobGetLength(svchp, errhp, lob_loc, &amp;loblen) != OCI_SUCCESS)
  {
    printf(&#34;OCILobGetLength FAILED\n&#34;);
    return OCI_ERROR;
  }
  if (OCILobCopy(svchp, errhp, tblob,lob_loc,(ub4)loblen, (ub4) 1, (ub4) 1))
  {
    printf( &#34;OCILobCopy FAILED \n&#34;);
  }
  if(OCILobFreeTemporary(svchp,errhp,tblob))
  {
    printf (&#34;FAILED: OCILobFreeTemporary call \n&#34;);
    return OCI_ERROR;
  }
     return OCI_SUCCESS;
}
int main(char *argv, int argc)
{
  /* OCI Handles */
  OCIEnv        *envhp;
  OCIServer     *srvhp;
  OCISvcCtx     *svchp;
  OCIError      *errhp;
  OCISession    *authp;
  OCIStmt       *stmthp;
  OCILobLocator *clob, *blob;
  OCILobLocator *lob_loc;
  int type =1;
  /* Initialize and Log on */
  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void *)0, 0, 0, 0,
        (size_t)0, (void *)0);
  (void) OCIHandleAlloc( (void *) envhp, (void **) &amp;errhp, OCI_HTYPE_ERROR,
                          (size_t) 0, (void **) 0);
  /* server contexts */
  (void) OCIHandleAlloc( (void *) envhp, (void **) &amp;srvhp, OCI_HTYPE_SERVER,
                         (size_t) 0, (void **) 0);
   /* service context */
  (void) OCIHandleAlloc( (void *) envhp, (void **) &amp;svchp, OCI_HTYPE_SVCCTX,
                         (size_t) 0, (void **) 0);
    /* attach to Oracle Database */
  (void) OCIServerAttach( srvhp, errhp, (text *)&#34;&#34;, strlen(&#34;&#34;), 0);
    /* set attribute server context in the service context */
  (void) OCIAttrSet ((void *) svchp, OCI_HTYPE_SVCCTX,
                     (void *)srvhp, (ub4) 0,
                     OCI_ATTR_SERVER, (OCIError *) errhp);
   (void) OCIHandleAlloc((void *) envhp,
                        (void **)&amp;authp, (ub4) OCI_HTYPE_SESSION,
                        (size_t) 0, (void **) 0);
   (void) OCIAttrSet((void *) authp, (ub4) OCI_HTYPE_SESSION,
                    (void *) &#34;scott&#34;, (ub4)5,
                    (ub4) OCI_ATTR_USERNAME, errhp);
  (void) OCIAttrSet((void *) authp, (ub4) OCI_HTYPE_SESSION,
                    (void *) &#34;<span class="italic">password</span>&#34;, (ub4) 5,
                    (ub4) OCI_ATTR_PASSWORD, errhp);
  /* Begin a User Session */
  checkerr(errhp, OCISessionBegin ( svchp,  errhp, authp, OCI_CRED_RDBMS,
                                    (ub4) OCI_DEFAULT));
  (void) OCIAttrSet((void *) svchp, (ub4) OCI_HTYPE_SVCCTX,
                    (void *) authp, (ub4) 0,
                    (ub4) OCI_ATTR_SESSION, errhp);
  /* ------- Done logging in ----------------------------------*/
   /* allocate a statement handle */
  checkerr(errhp, OCIHandleAlloc( (void *) envhp, (void **) &amp;stmthp,
                             OCI_HTYPE_STMT, (size_t) 0, (void **) 0));
  checkerr(errhp, OCIDescriptorAlloc((void *)envhp, (void **)&amp;lob_loc,
                   (ub4) OCI_DTYPE_LOB, (size_t) 0, (void **) 0));
  /* Subroutine calls begin here */
  printf(&#34;calling select_and_createtemp\n&#34;);
  select_and_createtemp (lob_loc, errhp, svchp,stmthp,envhp);
  return 0;
}
void checkerr(errhp, status)
OCIError *errhp;
sword status;
{
  text errbuf[512];
  sb4 errcode = 0;
  switch (status)
  {
  case OCI_SUCCESS:
    break;
  case OCI_SUCCESS_WITH_INFO:
    (void) printf(&#34;Error - OCI_SUCCESS_WITH_INFO\n&#34;);
    break;
  case OCI_NEED_DATA:
    (void) printf(&#34;Error - OCI_NEED_DATA\n&#34;);
    break;
  case OCI_NO_DATA:
    (void) printf(&#34;Error - OCI_NODATA\n&#34;);
    break;
  case OCI_ERROR:
    (void) OCIErrorGet((void *)errhp, (ub4) 1, (text *) NULL, &amp;errcode,
                        errbuf, (ub4) sizeof(errbuf), OCI_HTYPE_ERROR);
    (void) printf(&#34;Error - %.*s\n&#34;, 512, errbuf);
    break;
  case OCI_INVALID_HANDLE:
    (void) printf(&#34;Error - OCI_INVALID_HANDLE\n&#34;);
    break;
  case OCI_STILL_EXECUTING:
    (void) printf(&#34;Error - OCI_STILL_EXECUTE\n&#34;);
    break;
  case OCI_CONTINUE:
    (void) printf(&#34;Error - OCI_CONTINUE\n&#34;);
    break;
  default:
    break;
  }
}
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="LNOCI72639"></a><a id="LNOCI07100"></a>
<div class="props_rev_3"><a id="GUID-3F7FEAFF-F4EF-42CC-8F95-598D227C5D83"></a>
<h2 id="LNOCI-GUID-3F7FEAFF-F4EF-42CC-8F95-598D227C5D83" class="sect2">Prefetching of LOB Data, Length, and Chunk Size</h2>
<div>
<p>To improve OCI access of smaller LOBs, LOB data can be prefetched and cached while also fetching the locator.</p>
<div class="section">
<p>This applies to internal LOBs, temporary LOBs, and <code class="codeph">BFILE</code>s. Take the following steps to prepare your application:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Set the <code class="codeph">OCI_ATTR_DEFAULT_LOBPREFETCH_SIZE</code> attribute for the session handle. The value of this attribute indicates the default prefetch data size for a LOB locator. This attribute value enables prefetching for all the LOB locators fetched in the session. The default value for this attribute is zero (no prefetch of LOB data). This option relieves the application developer from setting the prefetch LOB size for each define handle. You can either set this attribute or set (in Step 3) <code class="codeph">OCI_ATTR_LOBPREFETCH_SIZE</code>.</span></li>
<li><span>Perform the prepare and define steps for the statement to be executed.</span></li>
<li><span>You can override the default prefetch size, if required, for the LOB locators to be fetched, by setting <code class="codeph">OCI_ATTR_LOBPREFETCH_SIZE</code> attribute for the define handle. This optional attribute provides control of the prefetch size for the locators fetched from a particular column.</span></li>
<li><span>Set the <code class="codeph">OCI_ATTR_LOBPREFETCH_LENGTH</code> attribute to the prefetch LOB length and chunk size. This is mandatory to be set to <code class="codeph">TRUE</code> for the attribute (<code class="codeph">OCI_ATTR_LOBPREFETCH_SIZE</code>) described in item 1 to work.</span></li>
<li><span>Execute the statement.</span></li>
<li><span>Call <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a> or <a href="oci17msc002.htm#GUID-47652C79-0635-4595-A34B-CD03B7F81A9F">OCILobArrayRead()</a> with individual LOB locators; OCI takes the data from the prefetch buffer, does the necessary character conversion, and copies the data into the LOB read buffer (no change in LOB semantic). If the data requested is bigger than the prefetch buffer, then it will require additional round-trips.</span></li>
<li><span>Call <a href="oci17msc002.htm#GUID-9BC0A78A-37CB-432F-AE2B-22C905608C4C">OCILobGetLength2()</a> and <a href="oci17msc002.htm#GUID-ABB71585-172E-4F3E-A0CF-F70D709F2072" title="Gets the chunk size of a LOB.">OCILobGetChunkSize()</a> to obtain the length and chunk size without making round-trips to the server.</span></li>
</ol>
<div class="example" id="GUID-3F7FEAFF-F4EF-42CC-8F95-598D227C5D83__BGBGCGCB">
<p class="titleinexample">Example 7-4 Prefetching of LOB Data, Length, and Chunk Size</p>
<pre dir="ltr">...
ub4 default_lobprefetch_size = 2000;                  /* Set default size to 2K */
... 
/* set LOB prefetch attribute to session */
OCIAttrSet (sesshp, (ub4) OCI_HTYPE_SESSION,
            (void *)&amp;default_lobprefetch_size,               /* attribute value */
            0,                      /* attribute size; not required to specify; */
            (ub4) OCI_ATTR_DEFAULT_LOBPREFETCH_SIZE,
            errhp);
...
/* select statement */
char *stmt = &#34;SELECT lob1 FROM lob_table&#34;;
...
/* declare and allocate LOB locator */
OCILobLocator * lob_locator;
lob_locator = OCIDescriptorAlloc(..., OCI_DTYPE_LOB, ...);
 
OCIDefineByPos(..., 1, (void *) &amp;lob_locator, ..., SQLT_CLOB, ...);
...
/* Override the default prefetch size to 4KB */
ub4 prefetch_size = 4000;
OCIAttrSet (defhp,  OCI_HTYPE_DEFINE,
            (void *) &amp;prefetch_size                             /* attr value */,
            0                  /* restricting prefetch size to be ub4 max val */,
            OCI_ATTR_LOBPREFETCH_SIZE                            /* attr type */,
            errhp);
...
/* Set prefetch length attribute */
boolean prefetch_length = TRUE;
OCIAttrSet( defhp,  OCI_HTYPE_DEFINE,
            (dvoid *) &amp;prefetch_length  /* attr value */,
            0,
            OCI_ATTR_LOBPREFETCH_LENGTH  /* attr type */,
            errhp );
...
/* execute the statement. 4KB of data for the LOB is read and
 * cached in descriptor cache buffer.
 */
OCIStmtExecute (svchp, stmthp, errhp,
                1,               /* iters */
                0,               /* row offset */
                NULL,            /* snapshot IN */
                NULL,            /* snapshot out */
                OCI_DEFAULT);    /* mode */
...
oraub8 char_amtp = 4000;
oraub8 lob_len;
ub4 chunk_size;
 
/* LOB chunk size, length, and data are read from cache. No round-trip. */
 
OCILobGetChunkSize (svchp, errhp, lob_locator, &amp;chunk_size);
 
OCILobGetLength2(svchp, errhp, lob_locator, &amp;lob_len );
 
OCILobRead2(svchp, errhp, lob_locator, NULL, &amp;char_amtp, ...);
...
</pre></div>
<!-- class="example" -->
<div class="section">
<p>Note that the prefetch size is in number of bytes for <code class="codeph">BLOB</code>s and <code class="codeph">BFILE</code>s and in number of characters for <code class="codeph">CLOB</code>s.</p>
<p><a href="oci07lob.htm#GUID-3F7FEAFF-F4EF-42CC-8F95-598D227C5D83__BGBGCGCB">Example 7-4</a> shows a code fragment illustrating these steps.</p>
<p><span class="bold">Prefetch cache allocation:</span> The prefetch cache buffer for a descriptor is allocated while fetching a LOB locator. The allocated buffer size is determined by the <code class="codeph">OCI_ATTR_LOBPREFETCH_SIZE</code> attribute for the define handle; the default value of this attribute is indicated by the <code class="codeph">OCI_ATTR_DEFAULT_LOBPREFETCH_SIZE</code> attribute value of the session handle. If the cache buffer is already allocated, then it is resized if required.</p>
<p>For the following two LOB APIs, if the source locator has cached data, then the destination locator cache is allocated or resized and cached data is copied from source to destination.</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-B052C110-D039-44A1-85C6-F5CC7348E2DC">OCILobAssign()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-F7887376-4B3C-430C-94A3-11FE96E26627">OCILobLocatorAssign()</a></p>
</li>
</ul>
<p>Once allocated, the cache buffer memory for a descriptor is released when the descriptor itself is freed.</p>
<p><span class="bold">Prefetch cache invalidation:</span> The cache for a descriptor gets invalidated when LOB data is updated using the locator. Meaning the cache is no longer used for reading data and the next <a href="oci17msc002.htm#GUID-6AC6E6DA-236B-4BF9-942F-9FCC4178FEDA" title="Reads a portion of a LOB or BFILE, as specified by the call, into a buffer. This function must be used for LOBs of size greater than 4 GB.">OCILobRead2()</a> call on the locator makes a round-trip.</p>
<p>The following LOB APIs invalidate the prefetch cache for the descriptor used:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="ociaedep003.htm#GUID-FD529B73-7D7B-4F93-BB01-4A4625503C36" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobErase()</a> (deprecated)</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-264797B2-B3EA-4F6D-9A0E-BF8A4DDA13FA">OCILobErase2()</a></p>
</li>
<li>
<p><a href="ociaedep003.htm#GUID-2D1D8F83-040B-4923-9F02-108D1F636B20" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobTrim()</a> (deprecated)</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-ABDB1543-1782-4216-AD80-55FA82CFF733">OCILobTrim2()</a></p>
</li>
<li>
<p><a href="ociaedep003.htm#GUID-CA0A90B9-0BB0-4017-AC53-996A102A7854" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobWrite()</a> (deprecated)</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-77F056CA-9EEE-4550-8A8E-0155DF994DBE" title="Writes a buffer into a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWrite2()</a></p>
</li>
<li>
<p><a href="ociaedep003.htm#GUID-BC03A84A-5747-414F-9A79-BAAF0EE71EF8" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobWriteAppend()</a> (deprecated)</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-87D3275A-B042-4991-B261-AB531BB83CA2" title="Writes data starting at the end of a LOB. This function must be used for LOBs of size greater than 4 GB.">OCILobWriteAppend2()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-10AB60C9-13FE-4CC9-9C62-CAD45DBB3B93">OCILobArrayWrite()</a></p>
</li>
</ul>
<p>The following LOB APIs invalidate the cache for the destination LOB locator:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci17msc002.htm#GUID-5B43FC88-A649-4764-8C1E-6D792F05F7CE">OCILobAppend()</a></p>
</li>
<li>
<p><a href="ociaedep003.htm#GUID-2E89A469-397B-45BD-871B-4A7E7A5815C1" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobCopy()</a> (deprecated)</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-404C8A50-516F-4DFD-939D-646A232AF7DF">OCILobCopy2()</a></p>
</li>
<li>
<p><a href="ociaedep003.htm#GUID-87C6AE88-5E71-4D89-A2B8-B391BFF73AC6" title="This function was deprecated in a release previous to Oracle Database 11g Release 2 (11.2).">OCILobLoadFromFile()</a> (deprecated)</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-DA1CD18B-7044-4E40-B1F4-4FCC1FCAB6C4">OCILobLoadFromFile2()</a></p>
</li>
</ul>
<p><span class="bold">Performance Tuning:</span> The prefetch buffer size must be decided upon based on average LOB size and client-side memory. If a large amount of data is prefetched, you must ensure the memory availability. Performance gain may not be significant for prefetching large LOBs, because the cost of fetching data is much higher compared to the cost of a round-trip to the server.</p>
<p>You must have a fair idea of the LOB data size to be able to make best use of this LOB prefetch feature. Because the parameters are part of application design, the application must be rebuilt if any parameter value must be modified.</p>
<p><span class="bold">Upgrading:</span> LOB prefetching cannot be used against a pre-11.1 release server or in a pre-11.1 client against an 11.1 or later server. When you use a pre-11.1 server with an 11.1 or later client, <a href="oci16rel002.htm#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a> returns an error or an error-with-information saying that &#34;server does not support this functionality.&#34;</p>
<div class="infoboxnotealso" id="GUID-3F7FEAFF-F4EF-42CC-8F95-598D227C5D83__GUID-9C92E1F6-7B26-4DC6-9D6F-AD82DBA53F57">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="ociaahan.htm#GUID-FB263210-118E-4DB3-A840-1769EF0CB977__BAJJDCII">OCI_ATTR_DEFAULT_LOBPREFETCH_SIZE</a></p>
</li>
<li>
<p><a href="ociaahan.htm#GUID-64F4D502-E9BE-4418-99A6-01899A4EBDAF__CHDECDDE">OCI_ATTR_LOBPREFETCH_LENGTH</a></p>
</li>
<li>
<p><a href="ociaahan.htm#GUID-64F4D502-E9BE-4418-99A6-01899A4EBDAF__CHDJEBCB">OCI_ATTR_LOBPREFETCH_SIZE</a></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="LNOCI16528"></a>
<div class="props_rev_3"><a id="GUID-5DEEF1FA-0024-48B4-B587-506386EA5240"></a>
<h2 id="LNOCI-GUID-5DEEF1FA-0024-48B4-B587-506386EA5240" class="sect2">Options of SecureFiles LOBs</h2>
<div>
<p>For <span>SecureFiles</span> (LOBs with the <code class="codeph">STORE AS SECUREFILE</code> option, which were introduced in Oracle Database 11<span class="italic">g</span> Release 1) you can specify the SQL parameter <code class="codeph">DEDUPLICATE</code> in <code class="codeph">CREATE</code> <code class="codeph">TABLE</code> and <code class="codeph">ALTER</code> <code class="codeph">TABLE</code> statements.</p>
<p>This parameter value enables you to specify that LOB data that is identical in two or more rows in a LOB column shares the same data blocks, thus saving disk space. <code class="codeph">KEEP_DUPLICATES</code> turns off this capability. The following options are also used with <code class="codeph">SECUREFILE</code>:</p>
<p>The parameter <code class="codeph">COMPRESS</code> turns on LOB compression. <code class="codeph">NOCOMPRESS</code> turns LOB compression off.</p>
<p>The parameter <code class="codeph">ENCRYPT</code> turns on LOB encryption and optionally selects an encryption algorithm. <code class="codeph">NOENCRYPT</code> turns off LOB encryption. Each LOB column can have its own encryption specification, independent of the encryption of other LOB or non-LOB columns. Valid algorithms are <code class="codeph">3DES168</code>, <code class="codeph">AES128</code>, <code class="codeph">AES192</code>, and <code class="codeph">AES256</code>.</p>
<p>The LOBs paradigm used before release 11.1 is the default. This default LOBs paradigm is also now explicitly set by the option <code class="codeph">STORE AS BASICFILE</code>.</p>
<p>The following OCI functions are used with the <code class="codeph">SECUREFILE</code> features:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">OCILobGetOptions()</code></p>
</li>
<li>
<p><code class="codeph">OCILobSetOptions()</code></p>
</li>
<li>
<p><code class="codeph">OCILobGetContentType()</code></p>
</li>
<li>
<p><code class="codeph">OCILobSetContentType()</code></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-5DEEF1FA-0024-48B4-B587-506386EA5240__GUID-B996D8C0-B14C-468F-BA74-769E149578F1">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADLOB4444" target="_blank" href="../ADLOB/adlob_smart.htm#ADLOB4444"><span><cite>Oracle Database SecureFiles and Large Objects Developer&#39;s Guide</cite></span></a> for complete details of relevant SQL functions and cross-references to PL/SQL packages and information about migrating to <span>SecureFile</span>s</p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-E989E74D-F00C-476A-A8A5-D8E84F83F2F5">OCILobGetOptions()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-A6CCDD69-980B-423A-B6B4-BF75B8DBCC26">OCILobSetOptions()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-D62200EF-FA60-4788-950F-0C0686D807FD">OCILobGetContentType()</a></p>
</li>
<li>
<p><a href="oci17msc002.htm#GUID-789C0971-76D5-4439-9379-E3DCE7885528">OCILobSetContentType()</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment6150">
<tr>
<td class="cellalignment6162">
<table class="cellalignment6155">
<tr>
<td class="cellalignment6154"><a href="oci06des.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment6154"><a href="oci08sca.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment6164">
<table class="cellalignment6153">
<tr>
<td class="cellalignment6154"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment6154"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment6154"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment6154"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment6154"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment6154"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>


</body></html>