<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-74006"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Object%20Advanced%20Topics%20in%20OCI"></a><title>Object Advanced Topics in OCI</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="This chapter introduces the OCI facility for working with objects in an Oracle Database."/>
<meta name="keywords" content="object cache, objects, memory management, client-side cache, coherency, consistency, of object cache, memory parameters, setting the size of, OCI_ATTR_CACHE_MAX_SIZE, OCI_ATTR_CACHE_OPT_SIZE, operations on, loading objects, removing objects, pinning, pinning objects, unpinning, unpinning objects, freeing, marking, marking objects, unmarking, unmarking objects, flushing, OCI_ATTR_CACHE_ARRAYFLUSH, refreshing, locking, OCI_LOCK_X_NOWAIT, parameter usage, optimistic locking, implementing, optimistic model, OCI_ATTR_OBJECT_DETECTCHANGE, environment handle attribute, commit, in object applications, rollback, object applications, duration, of objects, pin duration, allocation duration, example, memory layout of instance, top-level memory, secondary memory, of object, navigation, simple, OCI navigational functions, naming scheme, pin/unpin/free functions, flush functions, mark functions, meta-attribute accessor functions, miscellaneous functions, type evolution, TDO, in the object cache, XML support in OCI, Oracle XML DB OCI functions, XML DB functions"/>
<meta name="dcterms.created" content="2017-06-09T09:07:30Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Call Interface Programmer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49886-11"/>
<meta name="dcterms.isVersionOf" content="LNOCI"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="oci13obn.htm" title="Previous" type="text/html"/>
<link rel="Next" href="oci15ott.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49886-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-B2FBDC75-64BD-4E7E-A713-5095A827EA9C"></a> <span id="PAGE" style="display:none;">21/84</span> <!-- End Header -->
<a id="LNOCI130"></a>
<h1 id="LNOCI-GUID-B2FBDC75-64BD-4E7E-A713-5095A827EA9C" class="sect1"><span class="enumeration_chapter">14</span> Object Advanced Topics in OCI</h1>
<div>
<p>This chapter introduces the OCI facility for working with objects in an Oracle Database.</p>
<p>It also discusses the object navigational function calls, type evolution, and support for XML produced by OCI.</p>
<p>This chapter contains these topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-702B4236-3993-46E0-BCB6-1A2FC7E056C1" title="The object cache is a client-side memory buffer that provides lookup and memory management support for objects.">Object Cache and Memory Management</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-4BFF0155-C6FE-4592-89CF-F8FD99E1E2BC" title="This section discusses how OCI applications can navigate through graphs of objects in the object cache.">Object Navigation</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-AC858892-54CA-403F-AB4C-5DD14B2FCAD0" title="This section provides a brief summary of the available OCI navigational functions.">OCI Navigational Functions</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-35CBBA0E-CAC9-4BA3-99F7-77D613141661" title="When type information is requested based on the type name, OCI returns the type descriptor object (TDO) corresponding to the latest version of the type.">Type Evolution and the Object Cache</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-BADBDFFB-8110-491E-BB9E-BEFC68E892CE" title="Oracle XML DB provides support for storing and manipulating XML instances by using the XMLType data type. You can access these XML instances with OCI, in conjunction with the C DOM API for XML.">OCI Support for XML</a></p>
</li>
</ul>
</div>
<a id="LNOCI16984"></a><a id="LNOCI16983"></a>
<div class="props_rev_3"><a id="GUID-702B4236-3993-46E0-BCB6-1A2FC7E056C1"></a>
<h2 id="LNOCI-GUID-702B4236-3993-46E0-BCB6-1A2FC7E056C1" class="sect2">Object Cache and Memory Management</h2>
<div>
<p>The object cache is a client-side memory buffer that provides lookup and memory management support for objects.</p>
<p>It stores and tracks object instances that have been fetched by an OCI application. The object cache provides memory management.</p>
<p>When objects are fetched by the application through a SQL <code class="codeph">SELECT</code> statement, or through an OCI pin operation, a copy of the object is stored in the object cache. Objects that are fetched directly through a <code class="codeph">SELECT</code> statement are fetched <span class="italic">by value</span>, and they are nonreferenceable objects that cannot be pinned. Only referenceable objects can be pinned.</p>
<p>If an object is being pinned, and an appropriate version exists in the cache, it does not need to be fetched from the server.</p>
<p>Every client program that uses OCI to dereference <code class="codeph">REF</code>s to retrieve objects utilizes the object cache. A client-side object cache is allocated for every OCI environment handle initialized in object mode. Multiple threads of a process can share the same client-side cache by sharing the same OCI environment handle.</p>
<p>Exactly one copy of each referenceable object exists in the cache for each connection. The object cache is logically partitioned by the connection.</p>
<p>Dereferencing a <code class="codeph">REF</code> many times or dereferencing several equivalent <code class="codeph">REF</code>s in the same connection returns the same copy of the object.</p>
<p>If you modify a copy of an object in the cache, you must flush the changes to the server before they are visible to other processes. Objects that are no longer needed can be unpinned or freed; they can then be swapped out of the cache, freeing the memory space they occupied.</p>
<p>When database objects are loaded into the cache, they are transparently mapped into the C language structures. The object cache maintains the association between all object copies in the cache and their corresponding objects in the database. When the transaction is committed, changes made to the object copy in the cache are automatically propagated to the database.</p>
<p>The cache does not manage the contents of object copies; it does not automatically refresh object copies. The application must ensure the correctness and consistency of the contents of object copies. For example, if the application marks an object copy for insert, update, or delete, and then terminates the transaction, the cache simply unmarks the object copy but does not purge or invalidate the copy. The application must pin <span class="italic">recent</span> or <span class="italic">latest</span>, or refresh the object copy in the next transaction. If it pins <span class="italic">any</span>, it may get the same object copy with its uncommitted changes from the previous terminated transaction.</p>
<p>The object cache is created when the OCI environment is initialized using <code class="codeph">OCIEnvCreate()</code> with <code class="codeph">mode</code> set to <code class="codeph">OCI_OBJECT</code>.</p>
<p>The object cache maintains a fast lookup table for mapping <code class="codeph">REF</code>s to objects. When an application dereferences a <code class="codeph">REF</code> and the corresponding object is not yet cached in the object cache, the object cache automatically sends a request to the server to fetch the object from the database and load it into the object cache.</p>
<p>Subsequent dereferences of the same <code class="codeph">REF</code> are faster because they use local cache access and do not incur network round-trips. To notify the object cache that an application is accessing an object in the cache, the application pins the object; when it is done with the object, it should unpin it. The object cache maintains a pin count for each object in the cache; the count is incremented upon a pin call, and an unpin call decrements it. The pin count goes to zero when the object is no longer needed by the application.</p>
<p>The object cache uses a least recently used (LRU) algorithm to manage the size of the cache. The LRU algorithm frees candidate objects when the cache reaches the maximum size. The candidate objects are objects with a pin count of zero.</p>
<p>Each application process running against the same server has its own object cache, as shown in <a href="oci14oca.htm#GUID-702B4236-3993-46E0-BCB6-1A2FC7E056C1__I444407">Figure 14-1</a>.</p>
<div class="figure" id="GUID-702B4236-3993-46E0-BCB6-1A2FC7E056C1__I444407">
<p class="titleinfigure">Figure 14-1 Object Cache</p>
<img width="389" height="482" src="img/GUID-B478AB95-F3DE-4CD5-BEF8-9B013C3987B9-default.gif" alt="Description of Figure 14-1 follows" title="Description of Figure 14-1 follows"/><br/>
<a href="img_text/GUID-B478AB95-F3DE-4CD5-BEF8-9B013C3987B9-print.htm">Description of &#34;Figure 14-1 Object Cache&#34;</a></div>
<!-- class="figure" -->
<p>The object cache tracks the objects that are currently in memory, maintains references to the objects, manages automatic object swapping, and tracks object meta-attributes.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-2B545D37-821F-4410-B087-F00C5A8F35B2">Cache Consistency and Coherency</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-FE7E03F3-EE0D-438C-B92B-BF125DFAB897" title="The object cache has two important parameters associated with it, which are attributes of the environment handle.">Object Cache Parameters</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-ACA41D5E-CA18-4526-8723-66E4B7BAAEA1" title="This section describes the most important functions that the object cache provides to operate on object copies.">Object Cache Operations</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-C313BAF2-F0C5-4049-B23A-FE680803DB4B" title="Pin, unpin, and free functions are discussed in this section.">About Loading and Removing Object Copies</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-2AFFDE26-7ED6-4A4E-9B81-0CC5A1D5D837" title="Functions for marking and unmarking object copies are discussed in this section.">About Making Changes to Object Copies</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-55D30393-27ED-430B-BFCC-A25100D109F2" title="Cache and server synchronization operations (flushing, refreshing) are discussed in this section.">About Synchronizing Object Copies with the Server</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-EC3D1AE5-4D53-4C43-AA9C-E90F1D1AB33F" title="OCI functions related to object locking are discussed in this section.">Object Locking</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-B0236408-75F1-47C4-880B-FCA003A1C697">Commit and Rollback in Object Applications</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-639E852E-0AA3-414F-A5A3-598C8F2047E1" title="To maintain free space in memory, the object cache attempts to reuse objects&#39; memory whenever possible. The object cache reuses an object&#39;s memory when the object&#39;s lifetime (allocation duration) expires or when the object&#39;s pin duration expires.">Object Duration</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5">Memory Layout of an Instance</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-702B4236-3993-46E0-BCB6-1A2FC7E056C1__GUID-82C8CA51-9DEC-4DD4-BE66-731FB247F1D8">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-99819CA5-F2A7-4BFE-A9E4-5BD76C573CB2">About Pinning an Object Copy</a></p>
</li>
<li>
<p><a href="oci16rel001.htm#GUID-16BDA1F1-7DAF-41CA-9EE1-C9A4CB467244" title="Creates and initializes an environment handle for OCI functions to work under.">OCIEnvCreate()</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16985"></a>
<div class="props_rev_3"><a id="GUID-2B545D37-821F-4410-B087-F00C5A8F35B2"></a>
<h3 id="LNOCI-GUID-2B545D37-821F-4410-B087-F00C5A8F35B2" class="sect3">Cache Consistency and Coherency</h3>
<div>
<p>The object cache does not automatically maintain value coherency or consistency between object copies and their corresponding objects in the database. In other words, if an application makes changes to an object copy, the changes are not automatically applied to the corresponding object in the database, and vice versa. The cache provides operations such as flushing a modified object copy to the database and refreshing a stale object copy with the latest value from the database to enable the program to maintain some coherency.</p>
<div class="infobox-note" id="GUID-2B545D37-821F-4410-B087-F00C5A8F35B2__GUID-9739AE10-1FF2-455F-8825-2BF9A40D238B">
<p class="notep1">Note:</p>
<p>Oracle Database does not support automatic cache coherency with the server&#39;s buffer cache or database. Automatic cache coherency refers to the mechanism by which the object cache refreshes local object copies when the corresponding objects have been modified in the server&#39;s buffer cache. This mechanism occurs when the object cache flushes the changes made to local object copies to the buffer cache before any direct access of corresponding objects in the server. Direct access includes using SQL, triggers, or stored procedures to read or modify objects in the server.</p>
</div>
</div>
</div>
<a id="LNOCI16986"></a>
<div class="props_rev_3"><a id="GUID-FE7E03F3-EE0D-438C-B92B-BF125DFAB897"></a>
<h3 id="LNOCI-GUID-FE7E03F3-EE0D-438C-B92B-BF125DFAB897" class="sect3">Object Cache Parameters</h3>
<div>
<p>The object cache has two important parameters associated with it, which are attributes of the environment handle.</p>
<p>They include:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">OCI_ATTR_CACHE_MAX_SIZE</code> &ndash; The maximum cache size</p>
</li>
<li>
<p><code class="codeph">OCI_ATTR_CACHE_OPT_SIZE</code> &ndash; The optimal cache size</p>
</li>
</ul>
<p>These parameters refer to levels of cache memory usage, and they help determine when the cache automatically ages out eligible objects to free up memory.</p>
<p>If the memory occupied by the objects currently in the cache reaches or exceeds the maximum cache size, the cache automatically begins to free (or ages out) unmarked objects that have a pin count of zero. The cache continues freeing such objects until memory usage in the cache reaches the optimal size, or until it runs out of objects eligible for freeing. Note that the cache can grow beyond the specified maximum cache size.</p>
<p><code class="codeph">OCI_ATTR_CACHE_MAX_SIZE</code> is specified as a percentage of <code class="codeph">OCI_ATTR_CACHE_OPT_SIZE</code>. The maximum object cache size (in bytes) is computed by incrementing <code class="codeph">OCI_ATTR_CACHE_OPT_SIZE</code> by the <code class="codeph">OCI_ATTR_CACHE_MAX_SIZE</code> percentage, using the following algorithm:</p>
<pre dir="ltr">maximum_cache_size = optimal_size + optimal_size * max_size_percentage / 100
</pre>
<p>Next, represent the algorithm in terms of environment handle attributes.</p>
<pre dir="ltr">maximum_cache_size = OCI_ATTR_CACHE_OPT_SIZE + OCI_ATTR_CACHE_OPT_SIZE * 
                                            OCI_ATTR_CACHE_MAX_SIZE / 100
</pre>
<p>You can set the value of <code class="codeph">OCI_ATTR_CACHE_MAX_SIZE</code> at 10% (the default) of the <code class="codeph">OCI_ATTR_CACHE_OPT_SIZE</code>. The default value for <code class="codeph">OCI_ATTR_CACHE_OPT_SIZE</code> is 8 MB.</p>
<p>The cache size attributes of the environment handle can be set with the <code class="codeph">OCIAttrSet()</code> call and retrieved with the <code class="codeph">OCIAttrGet()</code> function.</p>
<div class="infoboxnotealso" id="GUID-FE7E03F3-EE0D-438C-B92B-BF125DFAB897__GUID-386F1089-E5A8-424C-89D5-8F4CB069B187">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="ociaahan.htm#GUID-9CA5026C-B6A0-4233-8B22-F1DD94ACE9F8" title="Lists and describes environment handle attributes.">Environment Handle Attributes</a> for more information</p>
</li>
<li>
<p><a href="oci16rel002.htm#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a></p>
</li>
<li>
<p><a href="oci16rel002.htm#GUID-FA199A99-4D7A-42C2-BB0A-C20047B95DF9" title="Gets the value of an attribute of a handle.">OCIAttrGet()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI16987"></a>
<div class="props_rev_3"><a id="GUID-ACA41D5E-CA18-4526-8723-66E4B7BAAEA1"></a>
<h3 id="LNOCI-GUID-ACA41D5E-CA18-4526-8723-66E4B7BAAEA1" class="sect3">Object Cache Operations</h3>
<div>
<p>This section describes the most important functions that the object cache provides to operate on object copies.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-1EDB789E-97FE-42CB-AC08-71C2AB185897">About Pinning and Unpinning</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-75659086-ECEE-4CD3-A419-E44EF30D09A2">About Freeing</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-C31A0A90-B272-4751-ADD1-C1125FAFF7B9">About Marking and Unmarking</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-198AE896-EE97-4DCD-AB12-E8B40C4F9E6A">About Flushing</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-3276320C-BBEF-45D0-8608-AB8A744AFDE0">About Refreshing</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-ACA41D5E-CA18-4526-8723-66E4B7BAAEA1__GUID-7107D3FA-2288-4EA5-8DC8-50C1DE0E1548">
<p class="notep1">See Also:</p>
<p><a href="oci14oca.htm#GUID-AC858892-54CA-403F-AB4C-5DD14B2FCAD0" title="This section provides a brief summary of the available OCI navigational functions.">OCI Navigational Functions</a> for a list of all the OCI navigational, cache, and object management functions</p>
</div>
</div>
<a id="LNOCI16988"></a>
<div class="props_rev_3"><a id="GUID-1EDB789E-97FE-42CB-AC08-71C2AB185897"></a>
<h4 id="LNOCI-GUID-1EDB789E-97FE-42CB-AC08-71C2AB185897" class="sect4">About Pinning and Unpinning</h4>
<div>
<p>Pinning an object copy enables the application to access it in the cache by dereferencing the <code class="codeph">REF</code> to it.</p>
<p>Unpinning an object indicates to the cache that the object currently is not being used. Objects should be unpinned when they are no longer needed to make them eligible for implicit freeing by the cache, thus freeing up memory.</p>
</div>
</div>
<a id="LNOCI16989"></a>
<div class="props_rev_3"><a id="GUID-75659086-ECEE-4CD3-A419-E44EF30D09A2"></a>
<h4 id="LNOCI-GUID-75659086-ECEE-4CD3-A419-E44EF30D09A2" class="sect4">About Freeing</h4>
<div>
<p>Freeing an object copy removes it from the cache and frees its memory.</p>
</div>
</div>
<a id="LNOCI16990"></a>
<div class="props_rev_3"><a id="GUID-C31A0A90-B272-4751-ADD1-C1125FAFF7B9"></a>
<h4 id="LNOCI-GUID-C31A0A90-B272-4751-ADD1-C1125FAFF7B9" class="sect4">About Marking and Unmarking</h4>
<div>
<p>Marking an object notifies the cache that an object copy has been updated in the cache and the corresponding object must be updated in the server when the object copy is flushed.</p>
<p>Unmarking an object removes the indication that the object has been updated.</p>
</div>
</div>
<a id="LNOCI16991"></a>
<div class="props_rev_3"><a id="GUID-198AE896-EE97-4DCD-AB12-E8B40C4F9E6A"></a>
<h4 id="LNOCI-GUID-198AE896-EE97-4DCD-AB12-E8B40C4F9E6A" class="sect4">About Flushing</h4>
<div>
<p>Flushing an object writes local changes made to marked object copies in the cache to the corresponding objects in the server. When this happens, the copies in the object cache are unmarked.</p>
</div>
</div>
<a id="LNOCI16992"></a>
<div class="props_rev_3"><a id="GUID-3276320C-BBEF-45D0-8608-AB8A744AFDE0"></a>
<h4 id="LNOCI-GUID-3276320C-BBEF-45D0-8608-AB8A744AFDE0" class="sect4">About Refreshing</h4>
<div>
<p>Refreshing an object copy in the cache replaces it with the latest value of the corresponding object in the server.</p>
<p>Note that pointers to top-level object memory are valid after a refresh. However, pointers to secondary-level memory (for example, string text pointers, collections, and so on) may become invalid after a refresh.</p>
<p>For example, if the object is of type <code class="codeph">person</code> with two attributes: <code class="codeph">salary (number)</code>, and <code class="codeph">name (varchar2(20)</code>). The type is:</p>
<pre dir="ltr">struct Person {
OCINumber salary;
OCIString *name;
}
</pre>
<p>If the client has a pointer <code class="codeph">scott_p</code> to <code class="codeph">Person</code> instance, and calls <a href="oci18nav001.htm#GUID-EFE5604B-AAEC-4C60-BB59-3D01E50DAB8C">OCIObjectRefresh()</a> on that instance, the pointer <code class="codeph">scott_p</code> is still the same after the refresh, but the pointers to second-level memory, such as <code class="codeph">scott_p-&gt;name</code>, can be different.</p>
</div>
</div>
</div>
<a id="LNOCI16993"></a>
<div class="props_rev_3"><a id="GUID-C313BAF2-F0C5-4049-B23A-FE680803DB4B"></a>
<h3 id="LNOCI-GUID-C313BAF2-F0C5-4049-B23A-FE680803DB4B" class="sect3">About Loading and Removing Object Copies</h3>
<div>
<p>Pin, unpin, and free functions are discussed in this section.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-99819CA5-F2A7-4BFE-A9E4-5BD76C573CB2">About Pinning an Object Copy</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-FFB44FF2-FB28-4473-9DEC-1BCEFA80D60E">About Unpinning an Object Copy</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-51E18790-5949-4D5B-9708-7749CA7B8E22" title="Freeing an object copy removes it from the object cache and frees up its memory.">About Freeing an Object Copy</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16994"></a>
<div class="props_rev_3"><a id="GUID-99819CA5-F2A7-4BFE-A9E4-5BD76C573CB2"></a>
<h4 id="LNOCI-GUID-99819CA5-F2A7-4BFE-A9E4-5BD76C573CB2" class="sect4">About Pinning an Object Copy</h4>
<div>
<p>When an application must dereference a <code class="codeph">REF</code> in the object cache, it calls <a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a>. This call dereferences the <code class="codeph">REF</code> and pins the object copy in the cache. As long as the object copy is pinned, it is guaranteed to be accessible by the application. <a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a> takes a pin option, <span class="italic">any</span>, <span class="italic">recent</span>, or <span class="italic">latest</span>. The data type of the pin option is <code class="codeph">OCIPinOpt</code>.<a id="d152659e2276" class="indexterm-anchor"></a></p>
<ul style="list-style-type: disc;">
<li>
<p>If the <span class="italic">any</span> (<a id="d152659e2287" class="indexterm-anchor"></a><code class="codeph">OCI_PIN_ANY</code>) option is specified, the object cache immediately returns the object copy that is in the cache, if one exists. If no copy is in the cache, the object cache loads the latest object copy from the database and then returns the object copy. The <span class="italic">any</span> option is appropriate for read-only, informational, fact, or meta objects, such as products, sales representatives, vendors, regions, parts, or offices. These objects usually do not change often, and even if they change, the change does not affect the application.</p>
<p>Note that the object cache looks for the object copy only within the logical partition of the cache for the specified connection. If there is no copy in the partition, the latest copy of the object is loaded from the server.</p>
</li>
<li>
<p>If the <span class="italic">latest</span> (<a id="d152659e2303" class="indexterm-anchor"></a><code class="codeph">OCI_PIN_LATEST</code>) option is specified, the object cache loads into the cache the latest object copy from the database. It returns that copy unless the object copy is locked in the cache, in which case the marked object copy is returned immediately. If the object is in the cache and not locked, the latest object copy is loaded and overwrites the existing one. The <span class="italic">latest</span> option is appropriate for operational objects, such as purchase orders, bugs, line items, bank accounts, or stock quotes. These objects usually change often, and it is important that the program access these objects at their latest possible state.</p>
</li>
<li>
<p>If the <span class="italic">recent</span> (<a id="d152659e2317" class="indexterm-anchor"></a><code class="codeph">OCI_PIN_RECENT</code>) option is specified, there are two possibilities:</p>
<ul style="list-style-type: disc;">
<li>
<p>If in the same transaction the object copy has been previously pinned using the <span class="italic">latest</span> or <span class="italic">recent</span> option, the <span class="italic">recent</span> option becomes equivalent to the <span class="italic">any</span> option.</p>
</li>
<li>
<p>If the previous condition does not apply, the <span class="italic">recent</span> option becomes equivalent to the <span class="italic">latest</span> option.</p>
</li>
</ul>
</li>
</ul>
<p>When the program pins an object, the program also specifies one of two possible values for the pin duration: <span class="italic">session</span> or <span class="italic">transaction</span>. The data type of the duration is <code class="codeph">OCIDuration</code>.<a id="d152659e2358" class="indexterm-anchor"></a></p>
<ul style="list-style-type: disc;">
<li>
<p>If the pin duration is <span class="italic">session</span> (<a id="d152659e2369" class="indexterm-anchor"></a><code class="codeph">OCI_DURATION_SESSION</code>), the object copy remains pinned until the end of session (that is, end of connection) or until it is unpinned explicitly by the program (by calling <code class="codeph">OCIObjectUnpin()</code>).</p>
</li>
<li>
<p>If the pin duration is <span class="italic">transaction</span> (<a id="d152659e2383" class="indexterm-anchor"></a><code class="codeph">OCI_DURATION_TRANS</code>), the object copy remains pinned until the end of transaction or until it is unpinned explicitly.</p>
</li>
</ul>
<p>When loading an object copy into the cache from the database, the cache effectively executes the following statement:</p>
<pre dir="ltr">SELECT VALUE(t) FROM t WHERE REF(t) = :r
</pre>
<p>In this statement, <code class="codeph">t</code> is the object table storing the object, <code class="codeph">r</code> is the <code class="codeph">REF</code>, and the fetched value becomes the value of the object copy in the cache.</p>
<p>Because the object cache effectively executes a separate <code class="codeph">SELECT</code> statement to load each object copy into the cache, in a read-committed transaction, object copies are not guaranteed to be read-consistent with each other.</p>
<p>In a serializable transaction, object copies pinned as <span class="italic">recent</span> or <span class="italic">latest</span> are read-consistent with each other because the <code class="codeph">SELECT</code> statements to load these object copies are executed based on the same database snapshot.</p>
<p>Read-committed and serialized transactions refer to different isolation levels that a database can support. There are other isolation levels also, such as read-uncommitted, repeatable read, and so on. Each isolation level permits more or less interference among concurrent transactions. Typically, when an isolation level permits more interference, simultaneous transactions have higher concurrency. In a read-committed transaction, when a query is executed multiple times, this type of transaction can produce inconsistent sets of data because it allows changes made by other committed transactions to be seen. This does not happen in serializable transactions.</p>
<p>The object cache model is orthogonal to or independent of the Oracle Database transaction model. The behavior of the object cache does not change based on the transaction model, even though the objects that are retrieved from the server through the object cache can be different when running the same program under different transaction models (for example, read-committed versus serializable).</p>
<div class="infobox-note" id="GUID-99819CA5-F2A7-4BFE-A9E4-5BD76C573CB2__GUID-8B93AF7C-2618-4BB2-9C48-90809AE09A93">
<p class="notep1">Note:</p>
<p>For <a href="oci18nav005.htm#GUID-2629C6C3-5299-4E92-BA58-804809CFF8B9">OCIObjectArrayPin()</a> the pin option has no effect, because objects are always retrieved from the database. If a <code class="codeph">REF</code> is to an object in the cache, <code class="codeph">OCIObjectArrayPin()</code> fails with:</p>
<pre dir="ltr">ORA-22881: dangling REF
</pre></div>
</div>
</div>
<a id="LNOCI16995"></a>
<div class="props_rev_3"><a id="GUID-FFB44FF2-FB28-4473-9DEC-1BCEFA80D60E"></a>
<h4 id="LNOCI-GUID-FFB44FF2-FB28-4473-9DEC-1BCEFA80D60E" class="sect4">About Unpinning an Object Copy</h4>
<div>
<p>An object copy can be unpinned when it is no longer used by the program. It then becomes available to be freed. An object copy must be both completely unpinned and unmarked to become eligible to be implicitly freed by the cache when the cache begins to run out of memory. To be completely unpinned, an object copy that has been pinned <span class="italic">n</span> times must be unpinned <span class="italic">n</span> times.</p>
<p>An unpinned but marked object copy is not eligible for implicit freeing until the object copy is flushed or explicitly unmarked by the user. However, the object cache implicitly frees object copies only when it begins to run out of memory, so an unpinned object copy need not necessarily be freed. If it has not been implicitly freed and is pinned again (with the any or recent options), the program gets the same object copy.</p>
<p>An application calls <a href="oci18nav005.htm#GUID-109DD260-8094-489C-A85C-AB27277E6D9B">OCIObjectUnpin()</a> or <a href="oci18nav005.htm#GUID-5D8C7FE3-8088-4A1C-8C36-19D0982FCAC3" title="Completely unpins an object, setting its pin count to zero.">OCIObjectPinCountReset()</a> to unpin an object copy. In addition, a program can call <a href="oci18nav005.htm#GUID-B7E9C0B8-7888-456E-A8F1-1151354C37BF" title="Unpins persistent objects.">OCICacheUnpin()</a> to completely unpin all object copies in the cache for a specific connection.</p>
</div>
</div>
<a id="LNOCI16996"></a>
<div class="props_rev_3"><a id="GUID-51E18790-5949-4D5B-9708-7749CA7B8E22"></a>
<h4 id="LNOCI-GUID-51E18790-5949-4D5B-9708-7749CA7B8E22" class="sect4">About Freeing an Object Copy</h4>
<div>
<p>Freeing an object copy removes it from the object cache and frees up its memory.</p>
<p>The cache supports two methods for freeing up memory:</p>
<ul style="list-style-type: disc;">
<li>
<p>Explicit freeing &ndash; A program explicitly frees or removes an object copy from the cache by calling <code class="codeph">OCIObjectFree()</code>, which takes an option to (forcefully) free either a marked or pinned object copy. The program can also call <code class="codeph">OCIObjectFree()</code> to free all object copies in the cache.</p>
</li>
<li>
<p>Implicit freeing &ndash; if the cache begins to run out of memory, it implicitly frees object copies that are both unpinned and unmarked. Unpinned objects that are marked are eligible for implicitly freeing only when the object copy is flushed or unmarked.</p>
</li>
</ul>
<p>For memory management reasons, it is important that applications unpin objects when they are no longer needed. This makes these objects available for aging out of the cache, and makes it easier for the cache to free memory when necessary.</p>
<p>OCI does not provide a function to free unreferenced objects in the client-side cache.</p>
<div class="infoboxnotealso" id="GUID-51E18790-5949-4D5B-9708-7749CA7B8E22__GUID-CA58646B-FD12-42B5-976F-42615CAA02A3">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-FE7E03F3-EE0D-438C-B92B-BF125DFAB897" title="The object cache has two important parameters associated with it, which are attributes of the environment handle.">Object Cache Parameters</a> for more information</p>
</li>
<li>
<p><a href="oci18nav005.htm#GUID-0814B033-C25C-4B4C-8968-4C0B86C2E744">OCIObjectFree()</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="LNOCI16997"></a>
<div class="props_rev_3"><a id="GUID-2AFFDE26-7ED6-4A4E-9B81-0CC5A1D5D837"></a>
<h3 id="LNOCI-GUID-2AFFDE26-7ED6-4A4E-9B81-0CC5A1D5D837" class="sect3">About Making Changes to Object Copies</h3>
<div>
<p>Functions for marking and unmarking object copies are discussed in this section.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-B946568A-E52D-424C-87EC-BCD7A177EFB0">About Marking an Object Copy</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-3D034011-F414-4E0F-88E9-8CB457696179">About Unmarking an Object Copy</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI16998"></a>
<div class="props_rev_3"><a id="GUID-B946568A-E52D-424C-87EC-BCD7A177EFB0"></a>
<h4 id="LNOCI-GUID-B946568A-E52D-424C-87EC-BCD7A177EFB0" class="sect4">About Marking an Object Copy</h4>
<div>
<p>An object copy can be created, updated, and deleted locally in the cache. If the object copy is created in the cache (by calling <a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a>), the object copy is marked for insert by the object cache, so that the object is inserted in the server when the object copy is flushed.</p>
<p>If the object copy is updated in the cache, the user must notify the object cache by marking the object copy for update (by calling <a href="oci18nav002.htm#GUID-6EEEC8CC-3041-4718-ADE7-20C6D8C661ED" title="Marks a persistent object as updated (dirty).">OCIObjectMarkUpdate()</a>). When the object copy is flushed, the corresponding object in the server is updated with the value in the object copy.</p>
<p>If the object copy is deleted, the object copy is marked for delete in the object cache (by calling <a href="oci18nav002.htm#GUID-46497858-8E6C-4920-857C-83FFC8B0F7C1">OCIObjectMarkDelete()</a>). When the object copy is flushed, the corresponding object in the server is deleted. The memory of the marked object copy is not freed until it is flushed and unpinned. When pinning an object marked for delete, the program receives an error, as if the program is dereferencing a dangling reference.</p>
<p>When a user makes multiple changes to an object copy, it is the final results of these changes that are applied to the object in the server when the copy is flushed. For example, if the user updates and deletes an object copy, the object in the server is deleted when the object copy is flushed. Similarly, if an attribute of an object copy is updated multiple times, it is the final value of this attribute that is updated in the server when the object copy is flushed.</p>
<p>The program can mark an object copy as updated or deleted only if the object copy has been loaded into the object cache.</p>
</div>
</div>
<a id="LNOCI16999"></a>
<div class="props_rev_3"><a id="GUID-3D034011-F414-4E0F-88E9-8CB457696179"></a>
<h4 id="LNOCI-GUID-3D034011-F414-4E0F-88E9-8CB457696179" class="sect4">About Unmarking an Object Copy</h4>
<div>
<p>A marked object copy can be unmarked in the object cache. By unmarking a marked object copy, the program ensures that the changes that are made to the object copy are not flushed to the server. The object cache does not undo the local changes that are made to the object copy.</p>
<p>A program calls <a href="oci18nav002.htm#GUID-41C686AE-4C80-4539-80AF-4150680A02A5">OCIObjectUnmark()</a> to unmark an object. In addition, a program can call <a href="oci18nav002.htm#GUID-BADD75E5-0C72-4364-911D-2DF59BF642C8">OCICacheUnmark()</a> to unmark all object copies in the cache for a specific connection.</p>
</div>
</div>
</div>
<a id="LNOCI17000"></a>
<div class="props_rev_3"><a id="GUID-55D30393-27ED-430B-BFCC-A25100D109F2"></a>
<h3 id="LNOCI-GUID-55D30393-27ED-430B-BFCC-A25100D109F2" class="sect3">About Synchronizing Object Copies with the Server</h3>
<div>
<p>Cache and server synchronization operations (flushing, refreshing) are discussed in this section.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-8E4590BA-6338-4FF6-A269-C2E4CF632EE9" title="When the program flushes the object copy, it writes the local changes made to a marked object copy in the cache to the server.">About Flushing Changes to the Server</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-4FC980A1-942B-4CE8-B3B7-BFD72C44FB42" title="When refreshed, an object copy is reloaded with the latest value of the corresponding object in the server.">About Refreshing an Object Copy</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI17001"></a>
<div class="props_rev_3"><a id="GUID-8E4590BA-6338-4FF6-A269-C2E4CF632EE9"></a>
<h4 id="LNOCI-GUID-8E4590BA-6338-4FF6-A269-C2E4CF632EE9" class="sect4">About Flushing Changes to the Server</h4>
<div>
<p>When the program flushes the object copy, it writes the local changes made to a marked object copy in the cache to the server.</p>
<p>The program can call <code class="codeph">OCIObjectFlush()</code> to flush a single object copy. The program can call <code class="codeph">OCICacheFlush()</code> to flush all marked object copies in the cache or a list of selected marked object copies. <code class="codeph">OCICacheFlush()</code> flushes objects associated with a specific service context. See <code class="codeph">OCICacheFlush()</code>.</p>
<p>After the object copy is flushed, it is unmarked. (Note that the object is locked in the server after it is flushed; the object copy is therefore marked as locked in the cache.)</p>
<div class="infobox-note" id="GUID-8E4590BA-6338-4FF6-A269-C2E4CF632EE9__GUID-46737B5D-8E39-409E-AFBD-8D72CA2A7CE6">
<p class="notep1">Note:</p>
<p>The <code class="codeph">OCIObjectFlush()</code> operation incurs only a single server round-trip even if multiple objects are being flushed.</p>
</div>
<p>The callback function (an optional argument to the <code class="codeph">OCIObjectFlush()</code> call) enables an application to flush only dirty objects of a certain type. The application can define a callback that returns only the desired objects. In this case, the operation still incurs only a single server round-trip for the flush.</p>
<p>In the default mode during <code class="codeph">OCIObjectFlush()</code>, the objects are flushed in the order that they are marked dirty. The performance of this flush operation can be considerably improved by setting the <code class="codeph">OCI_ATTR_CACHE_ARRAYFLUSH</code> attribute in the environment handle.</p>
<p>However, the <code class="codeph">OCI_ATTR_CACHE_ARRAYFLUSH</code> attribute should be used only if the order in which the objects are flushed is not important. While this attribute is in effect, the dirty objects are grouped together and sent to the server in a manner that enables the server to efficiently update its tables. When this attribute is enabled, it is not guaranteed that the order in which the objects are marked dirty is preserved.</p>
<div class="infoboxnotealso" id="GUID-8E4590BA-6338-4FF6-A269-C2E4CF632EE9__GUID-D1A9B75A-791C-4059-A0BD-3057F2AE93FE">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="ociaahan.htm#GUID-9CA5026C-B6A0-4233-8B22-F1DD94ACE9F8" title="Lists and describes environment handle attributes.">Environment Handle Attributes</a></p>
</li>
<li>
<p><a href="oci18nav001.htm#GUID-03A4BAE9-3484-4D04-8A11-5EC410FEB301" title="Flushes a modified persistent object to the server.">OCIObjectFlush()</a></p>
</li>
<li>
<p><a href="oci18nav001.htm#GUID-782180CB-D33E-42E0-AB4C-96ECDF651C1E">OCICacheFlush()</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="LNOCI17003"></a><a id="LNOCI17002"></a>
<div class="props_rev_3"><a id="GUID-4FC980A1-942B-4CE8-B3B7-BFD72C44FB42"></a>
<h4 id="LNOCI-GUID-4FC980A1-942B-4CE8-B3B7-BFD72C44FB42" class="sect4">About Refreshing an Object Copy</h4>
<div>
<p>When refreshed, an object copy is reloaded with the latest value of the corresponding object in the server.</p>
<p>The latest value may contain changes made by other committed transactions and changes made directly (not through the object cache) in the server by the transaction. The program can change objects directly in the server using SQL DML, triggers, or stored procedures.</p>
<p>To refresh a marked object copy, the program must first unmark the object copy. An unpinned object copy is freed when it is refreshed (that is, when the whole cache is refreshed).</p>
<p>The program can call <code class="codeph">OCIObjectRefresh()</code> to refresh a single object copy or <code class="codeph">OCICacheRefresh()</code> to refresh all object copies in the cache, all object copies that are loaded in a transaction (that is, object copies that are pinned recent or pinned latest), or a list of selected object copies.</p>
<p>When an object is flushed to the server, triggers can be fired to modify more objects in the server. The same objects (modified by the triggers) in the object cache become out-of-date, and must be refreshed before they can be locked or flushed.</p>
<p>The various meta-attribute flags and durations of an object are modified as described in <a href="oci14oca.htm#GUID-4FC980A1-942B-4CE8-B3B7-BFD72C44FB42__BGBEEIIA" title="This table has 2 columns. Column 1 is the object attribute and column 2 describes its status after a refresh operation.">Table 14-1</a> after being refreshed.</p>
<div class="tblformal" id="GUID-4FC980A1-942B-4CE8-B3B7-BFD72C44FB42__BGBEEIIA">
<p class="titleintable">Table 14-1 Object Attributes After a Refresh Operation</p>
<table class="cellalignment6175" title="Object Attributes After a Refresh Operation" summary="This table has 2 columns. Column 1 is the object attribute and column 2 describes its status after a refresh operation.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6192" id="d152659e3916">Object Attribute</th>
<th class="cellalignment6233" id="d152659e3919">Status After Refresh</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6193" id="d152659e3924" headers="d152659e3916">
<p>Existent</p>
</td>
<td class="cellalignment6234" headers="d152659e3924 d152659e3919">
<p>Set to appropriate value</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6193" id="d152659e3931" headers="d152659e3916">
<p>Pinned</p>
</td>
<td class="cellalignment6234" headers="d152659e3931 d152659e3919">
<p>Unchanged</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6193" id="d152659e3938" headers="d152659e3916">
<p>Flushed</p>
</td>
<td class="cellalignment6234" headers="d152659e3938 d152659e3919">
<p>Reset</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6193" id="d152659e3945" headers="d152659e3916">
<p>Allocation duration</p>
</td>
<td class="cellalignment6234" headers="d152659e3945 d152659e3919">
<p>Unchanged</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6193" id="d152659e3952" headers="d152659e3916">
<p>Pin duration</p>
</td>
<td class="cellalignment6234" headers="d152659e3952 d152659e3919">
<p>Unchanged</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>During the refresh operation, the object cache loads the new data into the top-level memory of an object copy, thus reusing the top-level memory. The top-level memory of an object copy contains the inline attributes of the object. However, the memory for the out-of-line attributes of an object copy can be freed and relocated, because the out-of-line attributes can vary in size.</p>
<div class="infoboxnotealso" id="GUID-4FC980A1-942B-4CE8-B3B7-BFD72C44FB42__GUID-FDAED564-8440-42FD-ABD3-A10447251839">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5">Memory Layout of an Instance</a> for more information about object memory</p>
</li>
<li>
<p><a href="oci18nav001.htm#GUID-EFE5604B-AAEC-4C60-BB59-3D01E50DAB8C">OCIObjectRefresh()</a></p>
</li>
<li>
<p><a href="oci18nav001.htm#GUID-2A901AE1-3211-4474-B673-8BB5C3B69D5F" title="Refreshes all pinned persistent objects in the cache.">OCICacheRefresh()</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="LNOCI17004"></a>
<div class="props_rev_3"><a id="GUID-EC3D1AE5-4D53-4C43-AA9C-E90F1D1AB33F"></a>
<h3 id="LNOCI-GUID-EC3D1AE5-4D53-4C43-AA9C-E90F1D1AB33F" class="sect3">Object Locking</h3>
<div>
<p>OCI functions related to object locking are discussed in this section.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-B12EE428-6EB9-4D79-BDC5-C24EE03293DE">Lock Options</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-16790CA7-71A9-4D8F-86DE-49E122AC156A">About Locking Objects for Update</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-05B2D3AC-0677-4C38-9350-875820048948">About Locking with the NOWAIT Option</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-EA3FC04C-FCF6-493F-9605-F532C547AD02">About Implementing Optimistic Locking</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI17005"></a>
<div class="props_rev_3"><a id="GUID-B12EE428-6EB9-4D79-BDC5-C24EE03293DE"></a>
<h4 id="LNOCI-GUID-B12EE428-6EB9-4D79-BDC5-C24EE03293DE" class="sect4">Lock Options</h4>
<div>
<p>When pinning an object, you can specify whether the object should be locked or not through lock options. When an object is locked, a server-side lock is acquired, which prevents any other user from modifying the object. The lock is released when the transaction commits or rolls back. The different lock options are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>The lock option <a id="d152659e4301" class="indexterm-anchor"></a><code class="codeph">OCI_LOCK_NONE</code> instructs the cache to pin the object without locking.</p>
</li>
<li>
<p>The lock option <a id="d152659e4309" class="indexterm-anchor"></a><code class="codeph">OCI_LOCK_X</code> instructs the cache to pin the object only after acquiring a lock. If the object is currently locked by another user, the pin call with this option waits until it can acquire the lock before returning to the caller. This is equivalent to executing a <code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code> statement.</p>
</li>
<li>
<p>The lock option <a id="d152659e4326" class="indexterm-anchor"></a><code class="codeph">OCI_LOCK_X_NOWAIT</code> instructs the cache to pin the object only after acquiring a lock. Unlike the <code class="codeph">OCI_LOCK_X</code> option, the pin call with the <code class="codeph">OCI_LOCK_X_NOWAIT</code> option does not wait if the object is currently locked by another user. This is equivalent to executing a <code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code> <code class="codeph">WITH</code> <code class="codeph">NOWAIT</code> statement.</p>
</li>
</ul>
</div>
</div>
<a id="LNOCI17006"></a>
<div class="props_rev_3"><a id="GUID-16790CA7-71A9-4D8F-86DE-49E122AC156A"></a>
<h4 id="LNOCI-GUID-16790CA7-71A9-4D8F-86DE-49E122AC156A" class="sect4">About Locking Objects for Update</h4>
<div>
<p>The program can optionally call <a href="oci18nav004.htm#GUID-FF85B1EA-695C-49A6-99AC-6E1A7F616FC0" title="Locks a persistent object at the server.">OCIObjectLock()</a> to lock an object for update. This call instructs the object cache to get a row lock on the object in the database. This is similar to executing the following statement:</p>
<pre dir="ltr">SELECT NULL FROM t WHERE REF(t) = :r FOR UPDATE
</pre>
<p>In this statement, <code class="codeph">t</code> is the object table storing the object to be locked, and <code class="codeph">r</code> is the <code class="codeph">REF</code> identifying the object. The object copy is marked locked in the object cache after <code class="codeph">OCIObjectLock()</code> is called.</p>
<p>To lock a graph or set of objects, several <a href="oci18nav004.htm#GUID-FF85B1EA-695C-49A6-99AC-6E1A7F616FC0" title="Locks a persistent object at the server.">OCIObjectLock()</a> calls are required (one for each object) or the array pin <a href="oci18nav005.htm#GUID-2629C6C3-5299-4E92-BA58-804809CFF8B9">OCIObjectArrayPin()</a> call can be used for better performance.</p>
<p>By locking an object, the application is guaranteed that the object in the cache is up-to-date. No other transaction can modify the object while the application has it locked.</p>
<p>At the end of a transaction, all locks are released automatically by the server. The locked indicator in the object copy is reset.</p>
</div>
</div>
<a id="LNOCI17007"></a>
<div class="props_rev_3"><a id="GUID-05B2D3AC-0677-4C38-9350-875820048948"></a>
<h4 id="LNOCI-GUID-05B2D3AC-0677-4C38-9350-875820048948" class="sect4">About Locking with the NOWAIT Option</h4>
<div>
<p>Occasionally, an application attempts to lock an object that is currently locked by another user. In this case, the application is blocked.</p>
<p>To avoid blocking when trying to lock an object, an application can use the <a href="oci18nav004.htm#GUID-F8C389C2-A5F0-4603-B260-BD932D4AC9C8" title="Locks a persistent object at the server but does not wait for the lock.">OCIObjectLockNoWait()</a> call instead of <a href="oci18nav004.htm#GUID-FF85B1EA-695C-49A6-99AC-6E1A7F616FC0" title="Locks a persistent object at the server.">OCIObjectLock()</a>. This function returns an error if it cannot lock an object immediately because it is locked by another user.</p>
<p>The <code class="codeph">NOWAIT</code> option is also available to pin calls by passing a value of <code class="codeph">OCI_LOCK_X_NOWAIT</code> as the lock option parameter.</p>
</div>
</div>
<a id="LNOCI17008"></a>
<div class="props_rev_3"><a id="GUID-EA3FC04C-FCF6-493F-9605-F532C547AD02"></a>
<h4 id="LNOCI-GUID-EA3FC04C-FCF6-493F-9605-F532C547AD02" class="sect4">About Implementing Optimistic Locking</h4>
<div>
<p>There are two options available for implementing optimistic locking in an OCI application. Optimistic locking makes the assumption that a transaction will modify objects in the cache, flush them, and commit the changes successfully.</p>
<dl>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74004"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-EA3FC04C-FCF6-493F-9605-F532C547AD02__GUID-04BB5474-9E3E-4A61-A763-3D53BA5E3D9C"><!-- --></a>Optimistic Locking Option 1</dt>
<dd>
<p>The first optimistic locking option is for OCI applications that run transactions at the serializable level.</p>
<p>OCI supports calls that allow you to dereference and pin objects in the object cache without locking them, modify them in the cache (again without locking them), and then flush them (the dirtied objects) to the database.</p>
<p>During the flush operation, if a dirty object has been modified by another committed transaction since the beginning of your transaction, a nonserializable transaction error is returned. If none of the dirty objects has been modified by any other transaction since the beginning of your transaction, then your transaction writes the changes to the database successfully.</p>
<div class="infobox-note" id="GUID-EA3FC04C-FCF6-493F-9605-F532C547AD02__GUID-9D54809B-DB76-4489-9554-53210B61E8F8">
<p class="notep1">Note:</p>
<p><a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a> flushes dirty objects into the database before committing a transaction.</p>
</div>
<p>The preceding mechanism effectively implements an optimistic locking model.</p>
</dd>
<dt class="dlterm"><a class="dashingAutolink" name="autolink-74005"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="GUID-EA3FC04C-FCF6-493F-9605-F532C547AD02__GUID-6E7F8773-97B7-4879-9845-7320FDFF65A8"><!-- --></a>Optimistic Locking Option 2</dt>
<dd>
<p>Alternately, an application can enable object change detection mode. To do this operation, set the <code class="codeph">OCI_ATTR_OBJECT_DETECTCHANGE</code> attribute of the environment handle to a value of <code class="codeph">TRUE</code>.</p>
<p>When this mode has been activated, the application receives an <code class="codeph">ORA-08179</code> error (&#34;concurrency check failed&#34;) when it attempts to flush an object that has been changed in the server by another committed transaction. The application can then handle this error in an appropriate manner.</p>
</dd>
</dl>
</div>
</div>
</div>
<a id="LNOCI17009"></a>
<div class="props_rev_3"><a id="GUID-B0236408-75F1-47C4-880B-FCA003A1C697"></a>
<h3 id="LNOCI-GUID-B0236408-75F1-47C4-880B-FCA003A1C697" class="sect3">Commit and Rollback in Object Applications</h3>
<div>
<p>When a transaction is committed (<a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a>), all marked objects are flushed to the server. If an object copy is pinned with a transaction duration, the object copy is unpinned.</p>
<p>When a transaction is rolled back, all marked objects are unmarked. If an object copy is pinned with a transaction duration, the object copy is unpinned.</p>
</div>
</div>
<a id="LNOCI17010"></a>
<div class="props_rev_3"><a id="GUID-639E852E-0AA3-414F-A5A3-598C8F2047E1"></a>
<h3 id="LNOCI-GUID-639E852E-0AA3-414F-A5A3-598C8F2047E1" class="sect3">Object Duration</h3>
<div>
<p>To maintain free space in memory, the object cache attempts to reuse objects&#39; memory whenever possible. The object cache reuses an object&#39;s memory when the object&#39;s lifetime (<span class="italic">allocation duration)</span> expires or when the object&#39;s <span class="italic">pin duration</span> expires.</p>
<p>The allocation duration is set when an object is created with <code class="codeph">OCIObjectNew()</code>, and the pin duration is set when an object is pinned with <code class="codeph">OCIObjectPin()</code>. The data type of the duration value is <code class="codeph">OCIDuration</code>.</p>
<div class="infobox-note" id="GUID-639E852E-0AA3-414F-A5A3-598C8F2047E1__GUID-9BAAA62E-AA03-4CE9-A9BA-08E68359CB83">
<p class="notep1">Note:</p>
<p>The pin duration for an object cannot be longer than the object&#39;s allocation duration.</p>
</div>
<p>When an object reaches the end of its allocation duration, it is automatically deleted and its memory can be reused. The pin duration indicates when an object&#39;s memory can be reused; memory is reused when the cache is full.</p>
<p>OCI supports two predefined durations:</p>
<ul style="list-style-type: disc;">
<li>
<p>Transaction (<code class="codeph">OCI_DURATION_TRANS</code>)</p>
</li>
<li>
<p>Session (<code class="codeph">OCI_DURATION_SESSION</code>)</p>
</li>
</ul>
<p>The <span class="italic">transaction duration</span> expires when the containing transaction ends (commits or terminates). The <span class="italic">session duration</span> expires when the containing session or connection ends.</p>
<p>The application can explicitly unpin an object using <code class="codeph">OCIObjectUnpin()</code>. To minimize explicit unpinning of individual objects, the application can unpin all objects currently pinned in the object cache using the function <code class="codeph">OCICacheUnpin()</code>. By default, all objects are unpinned at the end of the pin duration.</p>
<p>This section includes the following topic: <a href="oci14oca.htm#GUID-95AF1F97-1B4A-4A78-A059-2905BB1DD832">Durations Example</a>.</p>
<div class="infoboxnotealso" id="GUID-639E852E-0AA3-414F-A5A3-598C8F2047E1__GUID-F6722628-2CFB-4522-8E8D-8B5E198F463F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a></p>
</li>
<li>
<p><a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a></p>
</li>
<li>
<p><a href="oci18nav005.htm#GUID-109DD260-8094-489C-A85C-AB27277E6D9B">OCIObjectUnpin()</a></p>
</li>
<li>
<p><a href="oci18nav005.htm#GUID-B7E9C0B8-7888-456E-A8F1-1151354C37BF" title="Unpins persistent objects.">OCICacheUnpin()</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI17012"></a><a id="LNOCI17011"></a>
<div class="props_rev_3"><a id="GUID-95AF1F97-1B4A-4A78-A059-2905BB1DD832"></a>
<h4 id="LNOCI-GUID-95AF1F97-1B4A-4A78-A059-2905BB1DD832" class="sect4">Durations Example</h4>
<div>
<p><a href="oci14oca.htm#GUID-95AF1F97-1B4A-4A78-A059-2905BB1DD832__G453011" title="This table has 7 columns. Column 1 is the time value T1 to T19, column 2 is the application action, column 3 is the OCI function name, columns 4 through 7 are columns named object 1, object 2, object 3, and object 4.">Table 14-2</a> illustrates the use of the different durations in an application. Four objects are created or pinned in this application over the course of one connection and three transactions. The first column is the relative time indicator. The second column indicates the action performed by the database, and the third column indicates the function that performs the action. The remaining columns indicate the states of the various objects at each point in the application.</p>
<p>For example, Object 1 comes into existence at T2 when it is created with a connection duration, and it exists until T19 when the connection is terminated. Object 2 is pinned at T7 with a transaction duration, after being fetched at T6, and it remains pinned until T9 when the transaction is committed.</p>
<div class="tblformalwide" id="GUID-95AF1F97-1B4A-4A78-A059-2905BB1DD832__G453011">
<p class="titleintable">Table 14-2 Example of Allocation and Pin Durations</p>
<table class="cellalignment6157" title="Example of Allocation and Pin Durations " summary="This table has 7 columns. Column 1 is the time value T1 to T19, column 2 is the application action, column 3 is the OCI function name, columns 4 through 7 are columns named object 1, object 2, object 3, and object 4.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6300" id="d152659e5563">Time</th>
<th class="cellalignment6286" id="d152659e5566">Application Action</th>
<th class="cellalignment6273" id="d152659e5569">Function</th>
<th class="cellalignment6210" id="d152659e5572">Object 1</th>
<th class="cellalignment6302" id="d152659e5575">Object 2</th>
<th class="cellalignment6210" id="d152659e5578">Object 3</th>
<th class="cellalignment6302" id="d152659e5581">Object 4</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5586" headers="d152659e5563">
<p>T<sub>1</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5586 d152659e5566">
<p>Establish connection</p>
</td>
<td class="cellalignment6275" headers="d152659e5586 d152659e5569">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5586 d152659e5572">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5586 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5586 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5586 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5610" headers="d152659e5563">
<p>T<sub>2</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5610 d152659e5566">
<p>Create object 1 - allocation duration = connection</p>
</td>
<td class="cellalignment6275" headers="d152659e5610 d152659e5569">
<p><a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5610 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5610 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5610 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5610 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5639" headers="d152659e5563">
<p>T<sub>5</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5639 d152659e5566">
<p>Start Transaction1</p>
</td>
<td class="cellalignment6275" headers="d152659e5639 d152659e5569">
<p><a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5639 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5639 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5639 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5639 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5665" headers="d152659e5563">
<p>T<sub>6</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5665 d152659e5566">
<p>SQL - fetch <code class="codeph">REF</code> to object 2</p>
</td>
<td class="cellalignment6275" headers="d152659e5665 d152659e5569">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5665 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5665 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5665 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5665 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5692" headers="d152659e5563">
<p>T<sub>7</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5692 d152659e5566">
<p>Pin object 2 - pin duration = transaction</p>
</td>
<td class="cellalignment6275" headers="d152659e5692 d152659e5569">
<p><a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5692 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5692 d152659e5575">
<p>Pinned</p>
</td>
<td class="cellalignment6211" headers="d152659e5692 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5692 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5721" headers="d152659e5563">
<p>T<sub>8</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5721 d152659e5566">
<p>Process application data</p>
</td>
<td class="cellalignment6275" headers="d152659e5721 d152659e5569">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5721 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5721 d152659e5575">
<p>Pinned</p>
</td>
<td class="cellalignment6211" headers="d152659e5721 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5721 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5745" headers="d152659e5563">
<p>T<sub>9</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5745 d152659e5566">
<p>Commit Transaction1</p>
</td>
<td class="cellalignment6275" headers="d152659e5745 d152659e5569">
<p><a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5745 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5745 d152659e5575">
<p>Unpinned</p>
</td>
<td class="cellalignment6211" headers="d152659e5745 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5745 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5774" headers="d152659e5563">
<p>T<sub>10</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5774 d152659e5566">
<p>Start Transaction2</p>
</td>
<td class="cellalignment6275" headers="d152659e5774 d152659e5569">
<p><a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5774 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5774 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5774 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5774 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5800" headers="d152659e5563">
<p>T<sub>11</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5800 d152659e5566">
<p>Create object 3 - allocation duration = transaction</p>
</td>
<td class="cellalignment6275" headers="d152659e5800 d152659e5569">
<p><a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5800 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5800 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5800 d152659e5578">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5800 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5829" headers="d152659e5563">
<p>T<sub>12</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5829 d152659e5566">
<p>SQL - fetch <code class="codeph">REF</code> to object 4</p>
</td>
<td class="cellalignment6275" headers="d152659e5829 d152659e5569">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5829 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5829 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5829 d152659e5578">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5829 d152659e5581">
<p>-</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5856" headers="d152659e5563">
<p>T<sub>13</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5856 d152659e5566">
<p>Pin object 4 - pin duration = connection</p>
</td>
<td class="cellalignment6275" headers="d152659e5856 d152659e5569">
<p><a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5856 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5856 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5856 d152659e5578">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5856 d152659e5581">
<p>Pinned</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5886" headers="d152659e5563">
<p>T<sub>14</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5886 d152659e5566">
<p>Commit Transaction2</p>
</td>
<td class="cellalignment6275" headers="d152659e5886 d152659e5569">
<p><a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5886 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5886 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5886 d152659e5578">
<p>Deleted</p>
</td>
<td class="cellalignment6303" headers="d152659e5886 d152659e5581">
<p>Pinned</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5915" headers="d152659e5563">
<p>T<sub>15</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5915 d152659e5566">
<p>Terminate session1</p>
</td>
<td class="cellalignment6275" headers="d152659e5915 d152659e5569">
<p><a href="oci17msc002.htm#GUID-AABC3F29-C91B-45A7-AF1E-D486C12E4962" title="Terminates a user duration for a temporary LOB.">OCIDurationEnd()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5915 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5915 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5915 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5915 d152659e5581">
<p>Pinned</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5944" headers="d152659e5563">
<p>T<sub>16</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5944 d152659e5566">
<p>Start Transaction3</p>
</td>
<td class="cellalignment6275" headers="d152659e5944 d152659e5569">
<p><a href="oci17msc006.htm#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8">OCITransStart()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5944 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5944 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5944 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5944 d152659e5581">
<p>Pinned</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5970" headers="d152659e5563">
<p>T<sub>17</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5970 d152659e5566">
<p>Process application data</p>
</td>
<td class="cellalignment6275" headers="d152659e5970 d152659e5569">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5970 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5970 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5970 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5970 d152659e5581">
<p>Pinned</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e5994" headers="d152659e5563">
<p>T<sub>18</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e5994 d152659e5566">
<p>Commit Transaction3</p>
</td>
<td class="cellalignment6275" headers="d152659e5994 d152659e5569">
<p><a href="oci17msc006.htm#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></p>
</td>
<td class="cellalignment6211" headers="d152659e5994 d152659e5572">
<p>Exists</p>
</td>
<td class="cellalignment6303" headers="d152659e5994 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e5994 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e5994 d152659e5581">
<p>Pinned</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6301" id="d152659e6023" headers="d152659e5563">
<p>T<sub>19</sub></p>
</td>
<td class="cellalignment6288" headers="d152659e6023 d152659e5566">
<p>Terminate connection</p>
</td>
<td class="cellalignment6275" headers="d152659e6023 d152659e5569">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e6023 d152659e5572">
<p>Deleted</p>
</td>
<td class="cellalignment6303" headers="d152659e6023 d152659e5575">
<p>-</p>
</td>
<td class="cellalignment6211" headers="d152659e6023 d152659e5578">
<p>-</p>
</td>
<td class="cellalignment6303" headers="d152659e6023 d152659e5581">
<p>Unpinned</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-95AF1F97-1B4A-4A78-A059-2905BB1DD832__GUID-F4EDC1FA-CB8D-4B12-806F-44097071F832">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p>The descriptions of <a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a> and <a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a> in <a href="oci18nav.htm#GUID-9F30DB5F-33CB-4CE6-8EFE-732B29E26727" title="This chapter describes the OCI navigational functions that are used to navigate through objects retrieved from an Oracle database.">OCI Navigational and Type Functions</a> for specific information about parameter values that can be passed to these functions</p>
</li>
<li>
<p><span class="q">&#34;<a href="oci11obj.htm#GUID-86418D8C-FA67-4B14-A5BC-7A075C6B4206" title="An OCI application can create any object using OCIObjectNew().">About Creating Objects</a>&#34;</span> for information about freeing up an object&#39;s memory before its allocation duration has expired</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="LNOCI72770"></a><a id="LNOCI72771"></a><a id="LNOCI17013"></a>
<div class="props_rev_3"><a id="GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5"></a>
<h3 id="LNOCI-GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5" class="sect3">Memory Layout of an Instance</h3>
<div>
<p>An instance in memory is composed of a top-level memory chunk of the instance, a top-level memory of the null indicator structure and optionally, some secondary memory chunks. Consider the <code class="codeph">DEPARTMENT</code> row type defined in <a href="oci14oca.htm#GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5__BGBCACDA">Example 14-1</a>.</p>
<p>The C representation of the <code class="codeph">DEPARTMENT</code> is shown in <a href="oci14oca.htm#GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5__BGBEIHFD">Example 14-2</a>.</p>
<p>Each instance of <code class="codeph">DEPARTMENT</code> has a top-level memory chunk that contains the top-level attributes such as <code class="codeph">dep_name</code>, <code class="codeph">budget</code>, <code class="codeph">manager</code>, and <code class="codeph">employees</code>. The attributes <code class="codeph">dep_name</code> and <code class="codeph">employees</code> are pointers to the additional memory (the secondary memory chunks). The secondary memory is used to contain the data for the embedded instances (for example, <code class="codeph">employees</code> varray and <code class="codeph">dep_name</code> string).</p>
<p>The top-level memory of the null indicator structure contains the null statuses of the attributes in the top-level memory chunk of the instance. In <a href="oci14oca.htm#GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5__BGBEIHFD">Example 14-2</a>, the top-level memory of the null structure contains the null statuses of the attributes <code class="codeph">dep_name</code>, <code class="codeph">budget</code>, and <code class="codeph">manager</code>, and the atomic nullity of <code class="codeph">employees</code>.</p>
<div class="example" id="GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5__BGBCACDA">
<p class="titleinexample">Example 14-1 Object Type Representation of a Department Row</p>
<pre dir="ltr">CREATE TYPE department AS OBJECT
( dep_name      varchar2(20),
  budget        number,
  manager       person,            /* person is an object type */
  employees     person_array );   /* varray of person objects */
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5__BGBEIHFD">
<p class="titleinexample">Example 14-2 C Representation of a Department Row</p>
<pre dir="ltr">struct department
{
OCIString * dep_name;
OCINumber budget;
struct person manager;
OCIArray * employees;
);
typedef struct department department;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="LNOCI17014"></a>
<div class="props_rev_3"><a id="GUID-4BFF0155-C6FE-4592-89CF-F8FD99E1E2BC"></a>
<h2 id="LNOCI-GUID-4BFF0155-C6FE-4592-89CF-F8FD99E1E2BC" class="sect2">Object Navigation</h2>
<div>
<p>This section discusses how OCI applications can navigate through graphs of objects in the object cache.</p>
<p>This section includes the following topic: <a href="oci14oca.htm#GUID-2BF8105C-419E-4560-B241-BFCC1CCB719D">Simple Object Navigation</a>.</p>
</div>
<a id="LNOCI17016"></a><a id="LNOCI17015"></a>
<div class="props_rev_3"><a id="GUID-2BF8105C-419E-4560-B241-BFCC1CCB719D"></a>
<h3 id="LNOCI-GUID-2BF8105C-419E-4560-B241-BFCC1CCB719D" class="sect3">Simple Object Navigation</h3>
<div>
<p>In <a href="oci14oca.htm#GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5__BGBCACDA">Example 14-1</a> and <a href="oci14oca.htm#GUID-C4F12ECA-651F-4620-8761-C8EAA9F09BF5__BGBEIHFD">Example 14-2</a>, the object retrieved by the application was a simple object, whose attributes were all scalar values. If an application retrieves an object with an attribute that is a <code class="codeph">REF</code> to another object, the application can use OCI calls to traverse the <span class="italic">object graph</span> and access the referenced instance.</p>
<p>As an example, consider the following declaration for a new type in the database:</p>
<pre dir="ltr">CREATE TYPE person_t AS OBJECT
(  name          VARCHAR2(30),
  mother          REF person_t,
  father          REF person_t);
</pre>
<p>An object table of <code class="codeph">person_t</code> objects is created with the following statement:</p>
<pre dir="ltr">CREATE TABLE person_table OF person_t;
</pre>
<p>Instances of the <code class="codeph">person_t</code> type can now be stored in the typed table. Each instance of <code class="codeph">person_t</code> includes references to two other objects, which would also be stored in the table. A <code class="codeph">NULL</code> reference could represent a parent about whom information is not available.</p>
<p>An object graph is a graphical representation of the <code class="codeph">REF</code> links between object instances. For example, <a href="oci14oca.htm#GUID-2BF8105C-419E-4560-B241-BFCC1CCB719D__I440204">Figure 14-2</a> depicts an object graph of <code class="codeph">person_t</code> instances, showing the links from one object to another. The circles represent objects, and the arrows represent references to other objects. The M and F adjacent to the arrows indicate mother and father, respectively.</p>
<div class="figure" id="GUID-2BF8105C-419E-4560-B241-BFCC1CCB719D__I440204">
<p class="titleinfigure">Figure 14-2 Object Graph of person_t Instances</p>
<img width="503" height="868" src="img/GUID-5D14BED0-49B1-4D04-B164-FC0B7BDDE39E-default.gif" alt="Description of Figure 14-2 follows" title="Description of Figure 14-2 follows"/><br/>
<a href="img_text/GUID-5D14BED0-49B1-4D04-B164-FC0B7BDDE39E-print.htm">Description of &#34;Figure 14-2 Object Graph of person_t Instances&#34;</a></div>
<!-- class="figure" -->
<p>In this case, each object has links to two other instances (M and F) of the same object. This need not always be the case. Objects may have links to other object types. Other types of graphs are also possible. For example, if a set of objects is implemented as a linked list, the object graph could be viewed as a simple chain, where each object references either the previous or next objects or both in the linked list.</p>
<p>You can use the methods described earlier in this chapter to retrieve a reference to a <code class="codeph">person_t</code> instance and then pin that instance. OCI provides functionality that enables you to traverse the object graph by following a reference from one object to another.</p>
<p>As an example, assume that an application fetches the <code class="codeph">person1</code> instance in the preceding graph and pins it as <code class="codeph">pers_1</code>. Once that has been done, the application can access the mother instance of <code class="codeph">person1</code> and pin it into <code class="codeph">pers_2</code> through a second pin operation:</p>
<pre dir="ltr">OCIObjectPin(env, err, pers_1-&gt;mother, OCI_PIN_ANY, OCI_DURATION_TRANS,
             OCI_LOCK_X, (OCIComplexObject *) 0, &amp;pers_2);
</pre>
<p>In this case, an OCI fetch operation is not required to retrieve the second instance.</p>
<p>The application could then pin the father instance of <code class="codeph">person1</code>, or it could operate on the reference links of <code class="codeph">person2</code>.</p>
<div class="infobox-note" id="GUID-2BF8105C-419E-4560-B241-BFCC1CCB719D__GUID-8251D80D-ACCD-4BF1-AA20-4CF20949FE8D">
<p class="notep1">Note:</p>
<p>Attempting to pin a <code class="codeph">NULL</code> or dangling <code class="codeph">REF</code> results in an error on the <a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a> call.</p>
</div>
</div>
</div>
</div>
<a id="LNOCI17017"></a>
<div class="props_rev_3"><a id="GUID-AC858892-54CA-403F-AB4C-5DD14B2FCAD0"></a>
<h2 id="LNOCI-GUID-AC858892-54CA-403F-AB4C-5DD14B2FCAD0" class="sect2">OCI Navigational Functions</h2>
<div>
<p>This section provides a brief summary of the available OCI navigational functions.</p>
<p>The functions are grouped according to their general functionality.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-47D39623-BCE7-4A2F-8E9A-EC946B69B478">About Pin/Unpin/Free Functions</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-E8065CEE-6586-4991-BB0E-FE21A20A2749">About Flush and Refresh Functions</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-43512F5B-2C6E-4712-9B6E-170DF1FAA7BE">About Mark and Unmark Functions</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-9CC6E7F6-EA63-4A62-876F-89D115DB55D3" title="Lists and describes the meta-attribute accessor functions.">About Object Meta-Attribute Accessor Functions</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-D75B1421-C93D-44D5-8192-C23F1B7EB969">About Other Functions</a></p>
</li>
</ul>
</div>
<p>Earlier sections of this chapter describe the use of these functions.</p>
<p>The navigational functions follow a naming scheme that uses different prefixes for different types of functionality:</p>
<p><code class="codeph">OCICache*()</code> &ndash; These functions are cache operations.</p>
<p><code class="codeph">OCIObject*()</code> &ndash; These functions are individual object operations.</p>
<div class="infoboxnotealso" id="GUID-AC858892-54CA-403F-AB4C-5DD14B2FCAD0__GUID-2D2A688E-234E-475D-9B96-8EDC4F1B1BAD">
<p class="notep1">See Also:</p>
<p><a href="oci18nav.htm#GUID-9F30DB5F-33CB-4CE6-8EFE-732B29E26727" title="This chapter describes the OCI navigational functions that are used to navigate through objects retrieved from an Oracle database.">OCI Navigational and Type Functions</a> for more detailed descriptions of each of these functions</p>
</div>
</div>
<a id="LNOCI17019"></a><a id="LNOCI17018"></a>
<div class="props_rev_3"><a id="GUID-47D39623-BCE7-4A2F-8E9A-EC946B69B478"></a>
<h3 id="LNOCI-GUID-47D39623-BCE7-4A2F-8E9A-EC946B69B478" class="sect3">About Pin/Unpin/Free Functions</h3>
<div>
<p>The functions in <a href="oci14oca.htm#GUID-47D39623-BCE7-4A2F-8E9A-EC946B69B478__BGBDIFGI" title="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">Table 14-3</a> are available to pin, unpin, or free objects.</p>
<div class="tblformal" id="GUID-47D39623-BCE7-4A2F-8E9A-EC946B69B478__BGBDIFGI">
<p class="titleintable">Table 14-3 Pin, Free, and Unpin Functions</p>
<table class="cellalignment6175" title="Pin, Free, and Unpin Functions " summary="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6186" id="d152659e7123">Function</th>
<th class="cellalignment6247" id="d152659e7126">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7131" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-7CEF4ED9-E920-4F1F-9AFD-51C1EDB07EDB">OCICacheFree()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7131 d152659e7126">
<p>Free all instances in the cache</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7140" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-B7E9C0B8-7888-456E-A8F1-1151354C37BF" title="Unpins persistent objects.">OCICacheUnpin()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7140 d152659e7126">
<p>Unpin persistent objects in cache or connection</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7152" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-2629C6C3-5299-4E92-BA58-804809CFF8B9">OCIObjectArrayPin()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7152 d152659e7126">
<p>Pin an array of references</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7161" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-0814B033-C25C-4B4C-8968-4C0B86C2E744">OCIObjectFree()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7161 d152659e7126">
<p>Free and unpin a standalone instance</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7170" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-89F29585-2F16-4FA3-B1E0-BDD83707CA62" title="Pins a referenceable object.">OCIObjectPin()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7170 d152659e7126">
<p>Pin an object</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7182" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-5D8C7FE3-8088-4A1C-8C36-19D0982FCAC3" title="Completely unpins an object, setting its pin count to zero.">OCIObjectPinCountReset()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7182 d152659e7126">
<p>Unpin an object to zero pin count</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7194" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-B08E296D-7D4F-4D8C-A0CF-16786E9993E8">OCIObjectPinTable()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7194 d152659e7126">
<p>Pin a table object with a given duration</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7203" headers="d152659e7123">
<p><a href="oci18nav005.htm#GUID-109DD260-8094-489C-A85C-AB27277E6D9B">OCIObjectUnpin()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7203 d152659e7126">
<p>Unpin an object</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="LNOCI17021"></a><a id="LNOCI17020"></a>
<div class="props_rev_3"><a id="GUID-E8065CEE-6586-4991-BB0E-FE21A20A2749"></a>
<h3 id="LNOCI-GUID-E8065CEE-6586-4991-BB0E-FE21A20A2749" class="sect3">About Flush and Refresh Functions</h3>
<div>
<p>The functions in <a href="oci14oca.htm#GUID-E8065CEE-6586-4991-BB0E-FE21A20A2749__BGBDFADA" title="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">Table 14-4</a> are available to flush modified objects to the server.</p>
<div class="tblformal" id="GUID-E8065CEE-6586-4991-BB0E-FE21A20A2749__BGBDFADA">
<p class="titleintable">Table 14-4 Flush and Refresh Functions</p>
<table class="cellalignment6175" title="Flush and Refresh Functions " summary="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6220" id="d152659e7384">Function</th>
<th class="cellalignment6217" id="d152659e7387">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d152659e7392" headers="d152659e7384">
<p><a href="oci18nav001.htm#GUID-782180CB-D33E-42E0-AB4C-96ECDF651C1E">OCICacheFlush()</a></p>
</td>
<td class="cellalignment6219" headers="d152659e7392 d152659e7387">
<p>Flush modified persistent objects in cache to server</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d152659e7401" headers="d152659e7384">
<p><a href="oci18nav001.htm#GUID-03A4BAE9-3484-4D04-8A11-5EC410FEB301" title="Flushes a modified persistent object to the server.">OCIObjectFlush()</a></p>
</td>
<td class="cellalignment6219" headers="d152659e7401 d152659e7387">
<p>Flush a modified persistent object to the server</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d152659e7413" headers="d152659e7384">
<p><a href="oci18nav001.htm#GUID-2A901AE1-3211-4474-B673-8BB5C3B69D5F" title="Refreshes all pinned persistent objects in the cache.">OCICacheRefresh()</a></p>
</td>
<td class="cellalignment6219" headers="d152659e7413 d152659e7387">
<p>Refresh pinned persistent objects in the cache</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6221" id="d152659e7425" headers="d152659e7384">
<p><a href="oci18nav001.htm#GUID-EFE5604B-AAEC-4C60-BB59-3D01E50DAB8C">OCIObjectRefresh()</a></p>
</td>
<td class="cellalignment6219" headers="d152659e7425 d152659e7387">
<p>Refresh a single persistent object</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="LNOCI17023"></a><a id="LNOCI17022"></a>
<div class="props_rev_3"><a id="GUID-43512F5B-2C6E-4712-9B6E-170DF1FAA7BE"></a>
<h3 id="LNOCI-GUID-43512F5B-2C6E-4712-9B6E-170DF1FAA7BE" class="sect3">About Mark and Unmark Functions</h3>
<div>
<p>The functions in <a href="oci14oca.htm#GUID-43512F5B-2C6E-4712-9B6E-170DF1FAA7BE__BGBCDJDH" title="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">Table 14-5</a> allow an application to mark or unmark an object by modifying one of its meta-attributes.</p>
<div class="tblformal" id="GUID-43512F5B-2C6E-4712-9B6E-170DF1FAA7BE__BGBCDJDH">
<p class="titleintable">Table 14-5 Mark and Unmark Functions</p>
<table class="cellalignment6175" title="Mark and Unmark Functions " summary="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6186" id="d152659e7605">Function</th>
<th class="cellalignment6247" id="d152659e7608">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7613" headers="d152659e7605">
<p><a href="oci18nav002.htm#GUID-307366DB-B9B1-44E7-A52E-03216F2FF73E">OCIObjectMarkDeleteByRef()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7613 d152659e7608">
<p>Mark an object deleted when given a <code class="codeph">REF</code></p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7624" headers="d152659e7605">
<p><a href="oci18nav002.htm#GUID-6EEEC8CC-3041-4718-ADE7-20C6D8C661ED" title="Marks a persistent object as updated (dirty).">OCIObjectMarkUpdate()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7624 d152659e7608">
<p>Mark an object as updated (dirty)</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7636" headers="d152659e7605">
<p><a href="oci18nav002.htm#GUID-46497858-8E6C-4920-857C-83FFC8B0F7C1">OCIObjectMarkDelete()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7636 d152659e7608">
<p>Mark an object deleted or delete a value instance</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7645" headers="d152659e7605">
<p><a href="oci18nav002.htm#GUID-BADD75E5-0C72-4364-911D-2DF59BF642C8">OCICacheUnmark()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7645 d152659e7608">
<p>Unmark all objects in the cache</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7654" headers="d152659e7605">
<p><a href="oci18nav002.htm#GUID-41C686AE-4C80-4539-80AF-4150680A02A5">OCIObjectUnmark()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7654 d152659e7608">
<p>Mark a given object as updated</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6189" id="d152659e7663" headers="d152659e7605">
<p><a href="oci18nav002.htm#GUID-3FA9AEC7-AECE-4FD0-8C97-7C47E14231E8">OCIObjectUnmarkByRef()</a></p>
</td>
<td class="cellalignment6248" headers="d152659e7663 d152659e7608">
<p>Mark an object as updated, when given a <code class="codeph">REF</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="LNOCI17025"></a><a id="LNOCI17024"></a>
<div class="props_rev_3"><a id="GUID-9CC6E7F6-EA63-4A62-876F-89D115DB55D3"></a>
<h3 id="LNOCI-GUID-9CC6E7F6-EA63-4A62-876F-89D115DB55D3" class="sect3">About Object Meta-Attribute Accessor Functions</h3>
<div>
<p>Lists and describes the meta-attribute accessor functions.</p>
<p>The functions in <a href="oci14oca.htm#GUID-9CC6E7F6-EA63-4A62-876F-89D115DB55D3__BGBDBGJH" title="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">Table 14-6</a> allow an application to access the meta-attributes of an object.</p>
<div class="tblformal" id="GUID-9CC6E7F6-EA63-4A62-876F-89D115DB55D3__BGBDBGJH">
<p class="titleintable">Table 14-6 Object Meta-Attributes Functions</p>
<table class="cellalignment6175" title="Object Meta-Attributes Functions " summary="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6178" id="d152659e7847">Function</th>
<th class="cellalignment6213" id="d152659e7850">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e7855" headers="d152659e7847">
<p><a href="oci18nav003.htm#GUID-AF9CFD0F-14C4-4D24-94BF-5D68E9C41E01" title="Returns the existence meta-attribute of a standalone instance.">OCIObjectExists()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e7855 d152659e7850">
<p>Get existence status of an instance</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e7867" headers="d152659e7847">
<p><a href="oci18nav004.htm#GUID-22B229C0-369E-453E-A8D6-C7F7DBB1E80C" title="Retrieves the NULL indicator structure of a standalone instance.">OCIObjectGetInd()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e7867 d152659e7850">
<p>Get null structure of an instance</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e7882" headers="d152659e7847">
<p><a href="oci18nav003.htm#GUID-9B96A7DF-BE19-4131-8B95-11063C060012">OCIObjectIsDirty()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e7882 d152659e7850">
<p>Has an object been marked as updated?</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e7891" headers="d152659e7847">
<p><a href="oci18nav003.htm#GUID-AC738B41-AA00-40D4-9824-F63BADA321FB">OCIObjectIsLocked()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e7891 d152659e7850">
<p>Is an object locked?</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="LNOCI17027"></a><a id="LNOCI17026"></a>
<div class="props_rev_3"><a id="GUID-D75B1421-C93D-44D5-8192-C23F1B7EB969"></a>
<h3 id="LNOCI-GUID-D75B1421-C93D-44D5-8192-C23F1B7EB969" class="sect3">About Other Functions</h3>
<div>
<p>The functions in <a href="oci14oca.htm#GUID-D75B1421-C93D-44D5-8192-C23F1B7EB969__BGBDHJHB" title="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">Table 14-7</a> provide additional object functionality for OCI applications.</p>
<div class="tblformal" id="GUID-D75B1421-C93D-44D5-8192-C23F1B7EB969__BGBDHJHB">
<p class="titleintable">Table 14-7 Other Object Functions</p>
<table class="cellalignment6175" title="Other Object Functions " summary="This table has 2 columns. Column 1 is the function name and column 2 describes its purpose.">
<thead>
<tr class="cellalignment6151">
<th class="cellalignment6178" id="d152659e8072">Function</th>
<th class="cellalignment6213" id="d152659e8075">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e8080" headers="d152659e8072">
<p><a href="oci18nav004.htm#GUID-73C98F89-47E5-4B82-B869-731F30F011B0">OCIObjectCopy()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e8080 d152659e8075">
<p>Copy one instance to another</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e8089" headers="d152659e8072">
<p><a href="oci18nav004.htm#GUID-487BE97C-C3CE-49C6-9E8D-62BFCE7980F5" title="Returns a reference to a given persistent object.">OCIObjectGetObjectRef()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e8089 d152659e8075">
<p>Return a reference to a given object</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e8101" headers="d152659e8072">
<p><a href="oci18nav004.htm#GUID-9C83F766-C8A3-48A0-A7D5-2BF4037C2B32">OCIObjectGetTypeRef()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e8101 d152659e8075">
<p>Get a reference to a TDO of an instance</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e8110" headers="d152659e8072">
<p><a href="oci18nav004.htm#GUID-FF85B1EA-695C-49A6-99AC-6E1A7F616FC0" title="Locks a persistent object at the server.">OCIObjectLock()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e8110 d152659e8075">
<p>Lock a persistent object</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e8122" headers="d152659e8072">
<p><a href="oci18nav004.htm#GUID-F8C389C2-A5F0-4603-B260-BD932D4AC9C8" title="Locks a persistent object at the server but does not wait for the lock.">OCIObjectLockNoWait()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e8122 d152659e8075">
<p>Lock an object in NOWAIT mode</p>
</td>
</tr>
<tr class="cellalignment6151">
<td class="cellalignment6181" id="d152659e8134" headers="d152659e8072">
<p><a href="oci18nav004.htm#GUID-2EFD6F01-A02F-4C5B-B20F-1EF841249056" title="Creates a standalone instance.">OCIObjectNew()</a></p>
</td>
<td class="cellalignment6215" headers="d152659e8134 d152659e8075">
<p>Create a new instance</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
</div>
<a id="LNOCI17028"></a>
<div class="props_rev_3"><a id="GUID-35CBBA0E-CAC9-4BA3-99F7-77D613141661"></a>
<h2 id="LNOCI-GUID-35CBBA0E-CAC9-4BA3-99F7-77D613141661" class="sect2">Type Evolution and the Object Cache</h2>
<div>
<p>When type information is requested based on the type name, OCI returns the type descriptor object (TDO) corresponding to the latest version of the type.</p>
<p>Because there is no synchronization between the server and the object cache, the TDO in the object cache may not be current.</p>
<p>It is possible that the version of the image might differ from the TDO version during the pinning of an object. Then, an error is issued. It is up to you to stop the application or refresh the TDO and repin the object. Continuing with the application may cause the application to fail because even if the image and the TDO are at the same version, there is no guarantee that the object structure (that is, C struct) defined in the application is compatible with the new type version, especially when an attribute has been dropped from the type in the server.</p>
<p>Thus, when the structure of a type is altered, you must regenerate the header files of the changed type, modify their application, recompile, and relink before executing the program again.</p>
<div class="infoboxnotealso" id="GUID-35CBBA0E-CAC9-4BA3-99F7-77D613141661__GUID-5D0E2426-EC0B-4EEE-8FD2-830D96D0372D">
<p class="notep1">See Also:</p>
<p><a href="oci11obj.htm#GUID-34071CB4-805F-4DFE-B2F3-2E51A5B312F9" title="Adding, dropping, and modifying type attributes are supported. This concept is known as type evolution.">About Type Evolution</a></p>
</div>
</div>
</div>
<a id="LNOCI1390"></a>
<div class="props_rev_3"><a id="GUID-BADBDFFB-8110-491E-BB9E-BEFC68E892CE"></a>
<h2 id="LNOCI-GUID-BADBDFFB-8110-491E-BB9E-BEFC68E892CE" class="sect2">OCI Support for XML</h2>
<div>
<p>Oracle XML DB provides support for storing and manipulating XML instances by using the <code class="codeph">XMLType</code> data type. You can access these XML instances with OCI, in conjunction with the C DOM API for XML.</p>
<p>An application program must initialize the usual OCI handles, such as the server handle or the statement handle, and it must then initialize the XML context. The program can either operate on XML instances in the back end or create new instances on the client side. The initialized XML context can be used with all the C DOM functions.</p>
<p>XML data stored in Oracle XML DB can be accessed on the client side with the C DOM structure <code class="codeph">xmldocnode</code>. You can use this structure for binding, defining, and operating on XML values in OCI statements.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-F4E9FBE2-39AC-40FF-8FC0-03141CCEA11A">XML Context</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-C9205CED-77E6-4DF4-AE8B-DBDDCD5429A5">XML Data on the Server</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-97A697E2-EBDA-4A19-B88F-3C307B752B04">Using OCI XML DB Functions</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-E86849EB-B7FA-49A9-A992-74400E4BDED8" title="The middle tier and client tiers can produce, consume, and process XML in binary XML format.">OCI Client Access to Binary XML</a></p>
</li>
</ul>
</div>
<div class="infoboxnotealso" id="GUID-BADBDFFB-8110-491E-BB9E-BEFC68E892CE__GUID-CCAC6563-288C-48BB-8418-4E8710DCF828">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="oci23xml.htm#GUID-C104864B-8003-4F08-B5C6-DB1C13BC936D" title="This chapter describes the OCI XML DB functions.">OCI XML DB Functions</a> for information about the XML support in C</p>
</li>
<li>
<p><a class="olink ADXDB1400" target="_blank" href="../ADXDB/xdb12oci.htm#ADXDB1400"><span><cite>Oracle XML&nbsp;DB Developer&rsquo;s Guide</cite></span></a> for more information about using the C API for XML, including a binary XML example</p>
</li>
<li>
<p><a class="olink ADXDK1400" target="_blank" href="../ADXDK/adx_c_parser.htm#ADXDK1400"><span><cite>Oracle XML Developer&#39;s Kit Programmer&#39;s Guide</cite></span></a>for more information about the XML parser for C</p>
</li>
<li>
<p><a class="olink CAXML00300" target="_blank" href="../CAXML/dom.htm#CAXML00300"><span><cite>Oracle Database XML C API Reference</cite></span></a> for information about the DOM C APIs for XML</p>
</li>
</ul>
</div>
</div>
<a id="LNOCI17029"></a>
<div class="props_rev_3"><a id="GUID-F4E9FBE2-39AC-40FF-8FC0-03141CCEA11A"></a>
<h3 id="LNOCI-GUID-F4E9FBE2-39AC-40FF-8FC0-03141CCEA11A" class="sect3">XML Context</h3>
<div>
<p>An XML context is a required parameter in all the C DOM API functions. This opaque context encapsulates information pertaining to data encoding, error message language, and so on. The contents of this context are different for XDK and for Oracle XML DB applications.</p>
<p>For Oracle XML DB, there are two OCI functions provided to initialize and free an XML context:</p>
<pre dir="ltr">xmlctx *OCIXmlDbInitXmlCtx (OCIEnv *envhp, OCISvcCtx *svchp, OCIError *errhp,
       ocixmldbparam *params, ub4 num_params);

void OCIXmlDbFreeXmlCtx (xmlctx *xctx);
</pre></div>
</div>
<a id="LNOCI17030"></a>
<div class="props_rev_3"><a id="GUID-C9205CED-77E6-4DF4-AE8B-DBDDCD5429A5"></a>
<h3 id="LNOCI-GUID-C9205CED-77E6-4DF4-AE8B-DBDDCD5429A5" class="sect3">XML Data on the Server</h3>
<div>
<p>XML data on the server can be operated on with OCI statement calls. You can bind and define <code class="codeph">XMLType</code> values using <code class="codeph">xmldocnode</code>, as with other object instances. OCI statements are used to select XML data from the server. This data can be used in the C DOM functions directly. Similarly, the values can be bound back to SQL statements directly.</p>
</div>
</div>
<a id="LNOCI72772"></a><a id="LNOCI17031"></a>
<div class="props_rev_3"><a id="GUID-97A697E2-EBDA-4A19-B88F-3C307B752B04"></a>
<h3 id="LNOCI-GUID-97A697E2-EBDA-4A19-B88F-3C307B752B04" class="sect3">Using OCI XML DB Functions</h3>
<div>
<div class="section">
<p>To initialize and terminate the XML context, use the functions <a href="oci23xml001.htm#GUID-A99DABF3-145A-4FA5-BA70-A81CEA56C63B" title="Initializes an XML context.">OCIXmlDbInitXmlCtx()</a> and <a href="oci23xml001.htm#GUID-78C4352B-5BE6-4208-B6DB-B04964F2B692" title="Frees an XML context.">OCIXmlDbFreeXmlCtx()</a> respectively. The header file <a id="d152659e9023" class="indexterm-anchor"></a><code class="codeph">ocixmldb.h</code> is used with the unified C API.</p>
<p><a href="oci14oca.htm#GUID-97A697E2-EBDA-4A19-B88F-3C307B752B04__BGBDIEFE">Example 14-3</a> is a code fragment of a tested example that shows how to perform operations with the C API.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-97A697E2-EBDA-4A19-B88F-3C307B752B04__BGBDIEFE">
<p class="titleinexample">Example 14-3 Initializing and Terminating XML Context with a C API</p>
<pre dir="ltr">#ifndef S_ORACLE
#include &lt;s.h&gt;
#endif
#ifndef ORATYPES_ORACLE
#include &lt;oratypes.h&gt;
#endif
#ifndef XML_ORACLE
#include &lt;xml.h&gt;
#endif
#ifndef OCIXML_ORACLE
#include &lt;ocixmldb.h&gt;
#endif
#ifndef OCI_ORACLE
#include &lt;oci.h&gt;
#endif
#include &lt;string.h&gt;

typedef struct test_ctx {
        OCIEnv *envhp;
        OCIError *errhp;
        OCISvcCtx *svchp;
        OCIStmt *stmthp;
        OCIServer *srvhp;
        OCIDuration dur;
        OCISession *sesshp;
        oratext *username;
        oratext *password;
} test_ctx;

...
void main()
{
  test_ctx temp_ctx;
  test_ctx *ctx = &amp;temp_ctx;
  OCIType *xmltdo = (OCIType *) 0;
  xmldocnode *doc = (xmldocnode *)0;
  ocixmldbparam params[1];
  xmlnode *quux, *foo, *foo_data, *top;
  xmlerr err;
  sword status = 0;
  xmlctx *xctx;
 ...
  /* Initialize envhp, svchp, errhp, dur, stmthp */
  ...
 
  /* Get an xml context */
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;ctx-&gt;dur;
  xctx = OCIXmlDbInitXmlCtx(ctx-&gt;envhp, ctx-&gt;svchp, ctx-&gt;errhp, params, 1);

/* Do unified C API operations next */
...

/* Free the statement handle using OCIHandleFree() */
...
/* Free the allocations associated with the context */
OCIXmlDbFreeXmlCtx(xctx);
/* Free envhp, svchp, errhp, stmthp */
...
}
</pre></div>
<!-- class="example" --></div>
</div>
<a id="LNOCI17032"></a>
<div class="props_rev_3"><a id="GUID-E86849EB-B7FA-49A9-A992-74400E4BDED8"></a>
<h3 id="LNOCI-GUID-E86849EB-B7FA-49A9-A992-74400E4BDED8" class="sect3">OCI Client Access to Binary XML</h3>
<div>
<p>The middle tier and client tiers can produce, consume, and process XML in binary XML format.</p>
<p>The C application fetches data from the XML DB repository, performs updates on the XML using DOM, and stores it back in the database. Or an XML document is created or input on the client and XSLT, XQuery, and other utilities can be used on it. Then the output XML is saved in XML DB.</p>
<p>A client application requires a connection (called a metadata connection) to the metadata repository (typically a back-end database) to fetch token definitions, XML schemas, and DTDs while encoding or decoding a binary XML document.</p>
<p>A repository context is initialized using either a dedicated connection or a connection pool. The connection obtained from the repository context is used to fetch metadata such as token definitions and XML schemas. In contrast, the application also has data connections that are used for the regular transfer of data (including XML data) to and from the database. A repository context is explicitly associated with (one or more) data connections. When XML data is read or written from or to the database using the data connection, the appropriate repository context is accessed during the underlying encode or decode operations. As required, the metadata connection is used to fetch the metadata from the repository.</p>
<div class="p">This section includes the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="oci14oca.htm#GUID-63FC90A5-43CF-4F1C-8AAE-56070E3434FC">Accessing XML Data from an OCI Application</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-0264F856-8512-4B3A-B820-5A287F596FD5">Repository Context</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-86D5315D-9648-4F94-8E47-0FFF37028441">Create Repository Context from a Dedicated OCI Connection</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-301DD0C0-2927-4069-9B74-D8C95DA1CDFB">Create Repository Context from a Connection Pool</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-4E05FAF0-81FA-454A-8618-DD4E5DD89DB3">About Associating Repository Context with a Data Connection</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-FDA2DD34-0B7C-4DF0-84EC-EA7CA8A0F019">About Setting XMLType Encoding Format Preference</a></p>
</li>
<li>
<p><a href="oci14oca.htm#GUID-C09D2275-E10C-421E-90FA-449C428590BE" title="Creating a repository context from a connection pool and associating the repository context with a data connection is shown in this example in the XML DB documentation.">Example of Using a Connection Pool</a></p>
</li>
</ul>
</div>
</div>
<a id="LNOCI17033"></a>
<div class="props_rev_3"><a id="GUID-63FC90A5-43CF-4F1C-8AAE-56070E3434FC"></a>
<h4 id="LNOCI-GUID-63FC90A5-43CF-4F1C-8AAE-56070E3434FC" class="sect4">Accessing XML Data from an OCI Application</h4>
<div>
<div class="section">
<p>Your C application can use OCI to access persistent XML in the database and the Unified XML C API to operate on the fetched XML data.</p>
<p>The following steps are taken by a client application:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Create the usual OCI handles such as <code class="codeph">OCIEnv</code>, <code class="codeph">OCISvcCtx</code>, and <code class="codeph">OCIError</code>.</span></li>
<li><span>Create one or more repository contexts to fetch the binary XML metadata.</span></li>
<li><span>Associate the repository context with the data connection.</span></li>
<li><span>Bind or define (<code class="codeph">xmldocnode</code>) variables into the select, insert, and update statements.</span></li>
<li><span>Execute the select, insert, or update statement to fetch or store the XML document. At this point, the client OCI libraries interact with the database back end to fetch the needed XML Schemas, DTDs, token definitions, and so on.</span></li>
<li><span>Use the Unified C API to operate on the XML data (DOM).</span></li>
</ol>
</div>
</div>
<a id="LNOCI17034"></a>
<div class="props_rev_3"><a id="GUID-0264F856-8512-4B3A-B820-5A287F596FD5"></a>
<h4 id="LNOCI-GUID-0264F856-8512-4B3A-B820-5A287F596FD5" class="sect4">Repository Context</h4>
<div>
<p><code class="codeph">OCIBinXmlReposCtx</code> is the repository context data structure. The client application creates this context by providing the connection information to the metadata repository. An application can create multiple repository contexts to connect to multiple token repositories. A repository context is explicitly associated with a data connection (<code class="codeph">OCISvcCtx</code>). When the system must fetch metadata to encode or decode data to or from a data connection, it accesses the appropriate metadata.</p>
<p>It is recommended that applications create one repository context per <code class="codeph">OCIEnv</code>. This allows better concurrency for multithreaded applications.</p>
<p>The repository context can be created out of a dedicated OCI connection or an OCI connection pool.</p>
</div>
</div>
<a id="LNOCI17035"></a>
<div class="props_rev_3"><a id="GUID-86D5315D-9648-4F94-8E47-0FFF37028441"></a>
<h4 id="LNOCI-GUID-86D5315D-9648-4F94-8E47-0FFF37028441" class="sect4">Create Repository Context from a Dedicated OCI Connection</h4>
<div>
<p><a href="oci23xml001.htm#GUID-7B569A13-1E67-4FC4-A3AE-C3E90695C6D2">OCIBinXmlCreateReposCtxFromConn()</a> creates a repository context using the specified dedicated OCI connection. The OCI connection is only to be used for metadata access and should not be used in any other scenarios by the application. Also note that the access to this connection is serialized; that is, if multiple threads try to use the same connection, access is limited to one thread at a time. For scalability reasons, it is recommended that applications create a repository context using a connection pool, as described in the next section.</p>
<p>Note: You can also potentially pass in the same connection as the one being used for data. However, this might result in an error in certain cases where the client system attempts to contact the metadata repository while part of another operation (such as select or insert).</p>
</div>
</div>
<a id="LNOCI17036"></a>
<div class="props_rev_3"><a id="GUID-301DD0C0-2927-4069-9B74-D8C95DA1CDFB"></a>
<h4 id="LNOCI-GUID-301DD0C0-2927-4069-9B74-D8C95DA1CDFB" class="sect4">Create Repository Context from a Connection Pool</h4>
<div>
<p><a href="oci23xml001.htm#GUID-8E673583-3F28-4610-AD69-F513300E092B">OCIBinXmlCreateReposCtxFromCPool()</a> creates a repository context from a connection pool. When the application accesses the back-end repository, any available connection from the pool is used. Further, this connection is released back to the pool as soon as the metadata operation is complete. Connection pools are highly recommended for multithreaded application scenarios. Different threads can use different connections in the pool and release them as soon as they are done. This approach allows for higher scalability and concurrency with a smaller number of physical connections.</p>
</div>
</div>
<a id="LNOCI17037"></a>
<div class="props_rev_3"><a id="GUID-4E05FAF0-81FA-454A-8618-DD4E5DD89DB3"></a>
<h4 id="LNOCI-GUID-4E05FAF0-81FA-454A-8618-DD4E5DD89DB3" class="sect4">About Associating Repository Context with a Data Connection</h4>
<div>
<p><a href="oci23xml001.htm#GUID-7699EB5F-304A-4B34-AC25-D686BA117D3C">OCIBinXmlSetReposCtxForConn()</a> associates a repository context with a data connection described by <code class="codeph">OCISvcCtx</code> <code class="codeph">*</code>. Multiple data connections can share the same repository context, but access to the repository can be serialized (if it is based on a dedicated connection). When the system must fetch the metadata for encode or decode operations, it looks up the appropriate repository connection from the <code class="codeph">OCIEnv</code>, <code class="codeph">OCISvcCtx</code> pair and uses it to fetch the metadata required.</p>
</div>
</div>
<a id="LNOCI17038"></a>
<div class="props_rev_3"><a id="GUID-FDA2DD34-0B7C-4DF0-84EC-EA7CA8A0F019"></a>
<h4 id="LNOCI-GUID-FDA2DD34-0B7C-4DF0-84EC-EA7CA8A0F019" class="sect4">About Setting XMLType Encoding Format Preference</h4>
<div>
<p>By default, XML data sent to the database is encoded in one of these possible formats (text, object-relational, or binary XML) based on certain internal criteria such as the source format (if it was read from the DB). <a id="d152659e10193" class="indexterm-anchor"></a><a href="oci23xml001.htm#GUID-579B0507-91D3-4AD3-8AA9-B57454D38F3F">OCIBinXmlSetFormatPref()</a> provides an explicit mechanism to set the preference for encoding format. In the future, the default format can be binary XML, but this function could be used to override it if needed.</p>
</div>
</div>
<a id="LNOCI17039"></a>
<div class="props_rev_3"><a id="GUID-C09D2275-E10C-421E-90FA-449C428590BE"></a>
<h4 id="LNOCI-GUID-C09D2275-E10C-421E-90FA-449C428590BE" class="sect4">Example of Using a Connection Pool</h4>
<div>
<p>Creating a repository context from a connection pool and associating the repository context with a data connection is shown in this example in the XML DB documentation.</p>
<p>The database is local and the test is in single-threaded mode.</p>
<div class="infoboxnotealso" id="GUID-C09D2275-E10C-421E-90FA-449C428590BE__GUID-466E5990-0F55-47BE-805F-4D3E3832F5AB">
<p class="notep1">See Also:</p>
<p><a class="olink ADXDB1400" target="_blank" href="../ADXDB/xdb12oci.htm#ADXDB1400"><span><cite>Oracle XML&nbsp;DB Developer&rsquo;s Guide</cite></span></a> for more information about using OCI and the C API for XML with Oracle XML DB</p>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment6150">
<tr>
<td class="cellalignment6162">
<table class="cellalignment6155">
<tr>
<td class="cellalignment6154"><a href="oci13obn.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment6154"><a href="oci15ott.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment6164">
<table class="cellalignment6153">
<tr>
<td class="cellalignment6154"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment6154"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment6154"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment6154"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment6154"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment6154"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>