<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-105297"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Querying%20V%24LOGMNR_CONTENTS%20Based%20on%20XMLType%20Columns%20and%20Tables"></a><title>Querying V$LOGMNR_CONTENTS Based on XMLType Columns and Tables</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-07-10T17:06:49Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Utilities"/>
<meta name="dcterms.identifier" content="E41528-09"/>
<meta name="dcterms.isVersionOf" content="SUTIL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-87B0F6B0-9EAB-45AF-83B6-73C9340C6375.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-9797CFFF-033D-44F7-A3CD-0ADA0BA46C6B.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41528-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-4444BC3A-B32D-424F-89B5-E903C903FD11"></a> <span id="PAGE" style="display:none;">757/1019</span> <!-- End Header -->
<a id="SUTIL3616"></a><a id="SUTIL3617"></a><a id="SUTIL1570"></a>
<h1 id="SUTIL-GUID-4444BC3A-B32D-424F-89B5-E903C903FD11" class="sect1">Querying V$LOGMNR_CONTENTS Based on XMLType Columns and Tables</h1>
<div>
<p>LogMiner supports redo generated for <code class="codeph">XMLType</code> columns. <code class="codeph">XMLType</code> data stored as <code class="codeph">CLOB</code> is supported when redo is generated at a compatibility setting of 11.0.0.0 or higher. <code class="codeph">XMLType</code> data stored as object-relational and binary XML is supported for redo generated at a compatibility setting of 11.2.0.3 and higher.</p>
<p>LogMiner presents the <code class="codeph">SQL_REDO</code> in <code class="codeph">V$LOGMNR_CONTENTS</code> in different ways depending on the <code class="codeph">XMLType</code> storage. In all cases, the contents of the <code class="codeph">SQL_REDO</code> column, in combination with the <code class="codeph">STATUS</code> column, require careful scrutiny, and usually require reassembly before a SQL or PL/SQL statement can be generated to redo the change. There may be cases when it is not possible to use the <code class="codeph">SQL_REDO</code> data to construct such a change. The examples in the following subsections are based on <code class="codeph">XMLType</code> stored as <code class="codeph">CLOB</code> which is generally the simplest to use for reconstruction of the complete row change.</p>
<div class="infobox-note" id="GUID-4444BC3A-B32D-424F-89B5-E903C903FD11__GUID-113292B6-AEAF-4610-B1B8-15AF2828C0EC">
<p class="notep1">Note:</p>
<p><code class="codeph">XMLType</code> data stored as <code class="codeph">CLOB</code> is deprecated as of Oracle Database 12<span class="italic">c</span> Release 1 (12.1).</p>
</div>
<div class="section">
<p class="subhead1">Querying V$LOGMNR_CONTENTS For Changes to Tables With XMLType Columns</p>
</div>
<!-- class="section" -->
<div class="section">
<p>The example in this section is for a table named <code class="codeph">XML_CLOB_COL_TAB</code> that has the following columns:</p>
<ul style="list-style-type: disc;">
<li>
<p>f1 <code class="codeph">NUMBER</code></p>
</li>
<li>
<p>f2 <code class="codeph">VARCHAR2(100)</code></p>
</li>
<li>
<p>f3 <code class="codeph">XMLTYPE</code></p>
</li>
<li>
<p>f4 <code class="codeph">XMLTYPE</code></p>
</li>
<li>
<p>f5 <code class="codeph">VARCHAR2(10)</code></p>
</li>
</ul>
<p>Assume that a LogMiner session has been started with the logs and with the <code class="codeph">COMMITED_DATA_ONLY</code> option. The following query is executed against <code class="codeph">V$LOGMNR_CONTENTS</code> for changes to the <code class="codeph">XML_CLOB_COL_TAB</code> table.</p>
<pre dir="ltr">SELECT OPERATION, STATUS, SQL_REDO FROM V$LOGMNR_CONTENTS 
  WHERE SEG_OWNER = &#39;SCOTT&#39; AND TABLE_NAME = &#39;XML_CLOB_COL_TAB&#39;;
</pre>
<p>The query output looks similar to the following:</p>
<pre dir="ltr">OPERATION         STATUS  SQL_REDO

INSERT            0       insert into &#34;SCOTT&#34;.&#34;XML_CLOB_COL_TAB&#34;(&#34;F1&#34;,&#34;F2&#34;,&#34;F5&#34;) values
                             (&#39;5010&#39;,&#39;Aho40431&#39;,&#39;PETER&#39;)
         
XML DOC BEGIN     5       update &#34;SCOTT&#34;.&#34;XML_CLOB_COL_TAB&#34; a set a.&#34;F3&#34; = XMLType(:1)
                             where a.&#34;F1&#34; = &#39;5010&#39; and a.&#34;F2&#34; = &#39;Aho40431&#39; and a.&#34;F5&#34; = &#39;PETER&#39;

XML DOC WRITE     5       XML Data

XML DOC WRITE     5       XML Data

XML DOC WRITE     5       XML Data

XML DOC END       5
                                                                  
</pre>
<p>In the <code class="codeph">SQL_REDO</code> columns for the <code class="codeph">XML DOC WRITE</code> operations there will be actual data for the XML document. It will not be the string &#39;XML Data&#39;.</p>
<p>This output shows that the general model for an insert into a table with an <code class="codeph">XMLType</code> column is the following:</p>
<ol>
<li>
<p>An initial insert with all of the scalar columns.</p>
</li>
<li>
<p>An <code class="codeph">XML DOC BEGIN</code> operation with an update statement that sets the value for one <code class="codeph">XMLType</code> column using a bind variable.</p>
</li>
<li>
<p>One or more <code class="codeph">XML DOC WRITE</code> operations with the data for the XML document.</p>
</li>
<li>
<p>An <code class="codeph">XML DOC END</code> operation to indicate that all of the data for that XML document has been seen.</p>
</li>
<li>
<p>If there is more than one <code class="codeph">XMLType</code> column in the table, then steps 2 through 4 will be repeated for each <code class="codeph">XMLType</code> column that is modified by the original DML.</p>
</li>
</ol>
<p>If the XML document is not stored as an out-of-line column, then there will be no <code class="codeph">XML DOC BEGIN</code>, <code class="codeph">XML DOC WRITE</code>, or <code class="codeph">XML DOC END</code> operations for that column. The document will be included in an update statement similar to the following:</p>
<pre dir="ltr">OPERATION   STATUS         SQL_REDO

UPDATE      0              update &#34;SCOTT&#34;.&#34;XML_CLOB_COL_TAB&#34; a
                           set a.&#34;F3&#34; = XMLType(&#39;&lt;?xml version=&#34;1.0&#34;?&gt;
                           &lt;PO pono=&#34;1&#34;&gt;
                           &lt;PNAME&gt;Po_99&lt;/PNAME&gt; 
                           &lt;CUSTNAME&gt;Dave Davids&lt;/CUSTNAME&gt; 
                           &lt;/PO&gt;&#39;) 
                           where a.&#34;F1&#34; = &#39;5006&#39; and a.&#34;F2&#34; = &#39;Janosik&#39; and a.&#34;F5&#34; = &#39;MMM&#39; 
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Querying V$LOGMNR_CONTENTS For Changes to XMLType Tables</p>
</div>
<!-- class="section" -->
<div class="section">
<p>DMLs to <code class="codeph">XMLType</code> tables are slightly different from DMLs to <code class="codeph">XMLType</code> columns. The XML document represents the value for the row in the <code class="codeph">XMLType</code> table. Unlike the <code class="codeph">XMLType</code> column case, an initial insert cannot be done which is then followed by an update containing the XML document. Rather, the whole document must be assembled before anything can be inserted into the table.</p>
<p>Another difference for <code class="codeph">XMLType</code> tables is the presence of the <code class="codeph">OBJECT_ID</code> column. An object identifier is used to uniquely identify every object in an object table. For <code class="codeph">XMLType</code> tables, this value is generated by Oracle Database when the row is inserted into the table. The <code class="codeph">OBJECT_ID</code> value cannot be directly inserted into the table using SQL. Therefore, LogMiner cannot generate <code class="codeph">SQL_REDO</code> which is executable that includes this value.</p>
<p>The <code class="codeph">V$LOGMNR_CONTENTS</code> view has a new <code class="codeph">OBJECT_ID</code> column which is populated for changes to <code class="codeph">XMLType</code> tables. This value is the object identifier from the original table. However, even if this same XML document is inserted into the same <code class="codeph">XMLType</code> table, a new object identifier will be generated. The <code class="codeph">SQL_REDO</code> for subsequent DMLs, such as updates and deletes, on the <code class="codeph">XMLType</code> table will include the object identifier in the <code class="codeph">WHERE</code> clause to uniquely identify the row from the original table.</p>
</div>
<!-- class="section" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2015">
<tr>
<td class="cellalignment2022">
<table class="cellalignment2020">
<tr>
<td class="cellalignment2019"><a href="GUID-87B0F6B0-9EAB-45AF-83B6-73C9340C6375.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2019"><a href="GUID-9797CFFF-033D-44F7-A3CD-0ADA0BA46C6B.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2024">
<table class="cellalignment2018">
<tr>
<td class="cellalignment2019"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2019"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2019"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2019"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2019"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2019"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>