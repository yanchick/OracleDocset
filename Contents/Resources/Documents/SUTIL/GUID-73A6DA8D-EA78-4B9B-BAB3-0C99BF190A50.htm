<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-105488"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/PREPROCESSOR"></a><title>PREPROCESSOR</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="external tables, preprocessing data, preprocessing data for external tables, parallel loads, when using PREPROCESSOR clause, effects of parallel processing"/>
<meta name="dcterms.created" content="2017-07-10T17:06:49Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Utilities"/>
<meta name="dcterms.identifier" content="E41528-09"/>
<meta name="dcterms.isVersionOf" content="SUTIL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-0A09AA3E-7426-42DF-8BC3-30651429056B.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-C5E88733-03AC-4222-B558-3DDEC0E64550.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41528-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50"></a> <span id="PAGE" style="display:none;">564/1019</span> <!-- End Header -->
<a id="SUTIL3412"></a><a id="SUTIL3413"></a><a id="SUTIL3760"></a><a id="SUTIL3761"></a><a id="SUTIL1385"></a>
<h1 id="SUTIL-GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50" class="sect1">PREPROCESSOR</h1>
<div>
<div class="section">
<div class="infobox-note" id="GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50__GUID-36454C8C-DA13-406F-AF62-D0F90F99AA46">
<p class="notep1">Caution:</p>
<p>There are security implications to consider when using the <code class="codeph">PREPROCESSOR</code> clause. See <a class="olink DBSEG10007" target="_blank" href="../DBSEG/guidelines.htm#DBSEG10007"><span class="italic">Oracle Database Security Guide</span></a> for more information.</p>
</div>
<p>If the file you want to load contains data records that are not in a format supported by the <code class="codeph">ORACLE_LOADER</code> access driver, then use the <code class="codeph">PREPROCESSOR</code> clause to specify a user-supplied preprocessor program that will execute for every data file. Note that the program specification must be enclosed in a shell script if it uses arguments (see the description of <span class="q">&#34;<a href="GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50.htm#GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50__CIHDACJC">file_spec</a>&#34;</span>).</p>
<p>The preprocessor program converts the data to a record format supported by the access driver and then writes the converted record data to standard output (stdout), which the access driver reads as input. The syntax of the <code class="codeph">PREPROCESSOR</code> clause is as follows:</p>
<div class="figure" id="GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50__GUID-5A69C8CD-40A4-4CAD-9F37-589DC755E9C9"><img width="388" height="46" src="img/GUID-F52FA6F9-D87E-4404-8E64-4A531408E210-default.gif" alt="Description of GUID-F52FA6F9-D87E-4404-8E64-4A531408E210-print.eps follows" title="Description of GUID-F52FA6F9-D87E-4404-8E64-4A531408E210-print.eps follows"/><br/>
<a href="img_text/GUID-F52FA6F9-D87E-4404-8E64-4A531408E210-print.htm">Description of the illustration GUID-F52FA6F9-D87E-4404-8E64-4A531408E210-print.eps</a></div>
<!-- class="figure" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">directory_spec</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Specifies the directory object containing the name of the preprocessor program to execute for every data file. The user accessing the external table must have the <code class="codeph">EXECUTE</code> privilege for the directory object that is used. If <code class="codeph">directory_spec</code> is omitted, then the default directory specified for the external table is used.</p>
<div class="infobox-note" id="GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50__GUID-E251DE51-ECD0-4759-8217-7D57D2BAC5B2">
<p class="notep1">Caution:</p>
<p>For security reasons, Oracle strongly recommends that a separate directory, not the default directory, be used to store preprocessor programs. Do not store any other files in the directory in which preprocessor programs are stored.</p>
</div>
<p>The preprocessor program must reside in a directory object, so that access to it can be controlled for security reasons. The OS system manager must create a directory corresponding to the directory object and must verify that OS-user ORACLE has access to that directory. DBAs must ensure that only approved users are allowed access to the directory object associated with the directory path. Although multiple database users can have access to a directory object, only those with the <code class="codeph">EXECUTE</code> privilege can run a preprocessor in that directory. No existing database user with read-write privileges to a directory object will be able to use the preprocessing feature. DBAs can prevent preprocessors from ever being used by never granting the <code class="codeph">EXECUTE</code> privilege to anyone for a directory object.</p>
<div class="infoboxnotealso" id="GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50__GUID-A2B2E829-2735-4ED0-AD0A-C6DDD7FB1EF4">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF55038" target="_blank" href="../SQLRF/statements_9014.htm#SQLRF55038"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about granting the <code class="codeph">EXECUTE</code> privilege</p>
</div>
</div>
<!-- class="section" -->
<div class="section" id="GUID-73A6DA8D-EA78-4B9B-BAB3-0C99BF190A50__CIHDACJC">
<p class="subhead1">file_spec</p>
<p>The name of the preprocessor program. It is appended to the path name associated with the directory object that is being used (either the <code class="codeph">directory_spec</code> or the default directory for the external table). The <code class="codeph">file_spec</code> cannot contain an absolute or relative directory path.</p>
<p>If the preprocessor program requires any arguments (for example, <code class="codeph">gunzip -c</code>), then you must specify the program name and its arguments in an executable shell script (or on Windows operating systems, in a batch (.bat) file). Shell scripts and batch files have certain requirements, as discussed in the following sections.</p>
<p>It is important to verify that the correct version of the preprocessor program is in the operating system directory.</p>
<p>The following is an example of specifying the <code class="codeph">PREPROCESSOR</code> clause without using a shell or batch file:</p>
<pre dir="ltr">SQL&gt; CREATE TABLE xtab (recno varchar2(2000))
     2    ORGANIZATION EXTERNAL (
     3    TYPE ORACLE_LOADER
     4    DEFAULT DIRECTORY data_dir
     5    ACCESS PARAMETERS (
     6    RECORDS DELIMITED BY NEWLINE
     7    PREPROCESSOR execdir:&#39;zcat&#39;
     8    FIELDS (recno char(2000)))
     9    LOCATION (&#39;foo.dat.gz&#39;))
   10    REJECT LIMIT UNLIMITED;
Table created.
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Using Shell Scripts With the PREPROCESSOR Clause on Linux Operating Systems</p>
<ul style="list-style-type: disc;">
<li>
<p>The shell script must reside in <code class="codeph">directory_spec</code>.</p>
</li>
<li>
<p>The full path name must be specified for system commands such as <code class="codeph">gunzip</code>.</p>
</li>
<li>
<p>The preprocessor shell script must have EXECUTE permissions.</p>
</li>
<li>
<p>The data file listed in the external table <code class="codeph">LOCATION</code> clause should be referred to by <code class="codeph">$1</code>.</p>
</li>
</ul>
<p>The following example shows how to specify a shell script on the <code class="codeph">PREPROCESSOR</code> clause when creating an external table.</p>
<pre dir="ltr">SQL&gt; CREATE TABLE xtab (recno varchar2(2000))
     2    ORGANIZATION EXTERNAL (
     3    TYPE ORACLE_LOADER
     4    DEFAULT DIRECTORY data_dir
     5    ACCESS PARAMETERS (
     6    RECORDS DELIMITED BY NEWLINE
     7    PREPROCESSOR execdir:&#39;uncompress.sh&#39;
     8    FIELDS (recno char(2000)))
     9    LOCATION (&#39;foo.dat.gz&#39;))
   10    REJECT LIMIT UNLIMITED;
Table created.
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Using Batch Files With The PREPROCESSOR Clause on Windows Operating Systems</p>
<ul style="list-style-type: disc;">
<li>
<p>The batch file must reside in <code class="codeph">directory_spec</code>.</p>
</li>
<li>
<p>The full path name must be specified for system commands such as <code class="codeph">gunzip</code>.</p>
</li>
<li>
<p>The preprocessor batch file must have EXECUTE permissions.</p>
</li>
<li>
<p>The first line of the batch file should contain <code class="codeph">@echo off</code>. The reason for this requirement is that when the batch file is run, the default is to display the commands being executed, which has the unintended side-effect of the echoed commands being treated as input to the external table access driver.</p>
</li>
<li>
<p>To represent the input from the location clause, <code class="codeph">%1</code> should be used. (Note that this differs from Linux-style shell scripts where the location clause is referenced by <code class="codeph">$1</code>.)</p>
</li>
<li>
<p>A full path should be specified to any executables in the batch file (<code class="codeph">sed.exe</code> in the following example). Note also that the MKS Toolkit may not exist on all Windows installations so commands such as <code class="codeph">sed.exe</code> may not be available.</p>
<p>The batch file used on Windows must have either a <code class="codeph">.bat</code> or <code class="codeph">.cmd</code> extension. Failure to do so (e.g. trying to specify the preprocessor script as sed.sh) will result in the following error:</p>
<pre dir="ltr">SQL&gt; select * from foo ;
select * from foo
*
ERROR at line 1:

ORA-29913: error in executing ODCIEXTTABLEFETCH callout
ORA-29400: data cartridge error
KUP-04095: preprocessor command
C:/Temp\sed.sh encountered error
&#34;CreateProcess Failure for Preprocessor:
C:/Temp\sed.sh, errorcode: 193
</pre></li>
</ul>
<p>The following is a simple example of using a batch file with the external table <code class="codeph">PREPROCESSOR</code> option on Windows. In this example a batch file uses the stream editor (sed.exe) utility to perform a simple transformation of the input data.</p>
<pre dir="ltr">create table deptxt
(
   deptno char(2),
   dname char(14),
   loc char(13)
)
organization external
(
type ORACLE_LOADER
default directory def_dir1
access parameters
(
   records delimited by newline
   badfile &#39;deptxt.bad&#39;
   logfile &#39;deptxt.log&#39;
   preprocessor exec_dir:&#39;sed.bat&#39;
   fields terminated by &#39;,&#39;
   missing field values are null
)
   location (&#39;deptxt.dat&#39;)
)
reject limit unlimited ;

select * from deptxt ;

Where deptxt.dat contains:

10,ACCOUNTING,NEW YORK
20,RESEARCH,DALLAS
30,SALES,CHICAGO
40,OPERATIONS,BOSTON
</pre>
<p>The preprocessor program <code class="codeph">sed.bat</code> has the following content:</p>
<pre dir="ltr">@echo off
c:/mksnt/mksnt/sed.exe -e &#39;s/BOSTON/CALIFORNIA/&#39; %1
</pre>
<p>The <code class="codeph">PREPROCESSOR</code> option passes the input data (<code class="codeph">deptxt.dat</code>) to <code class="codeph">sed.bat</code>. If you then select from the <code class="codeph">deptxt</code> table, the results show that the <code class="codeph">LOC</code> column in the last row, which used to be <code class="codeph">BOSTON</code>, is now <code class="codeph">CALIFORNIA</code>.</p>
<pre dir="ltr">SQL&gt; select * from deptxt ;

DE DNAME          LOC
-- -------------- -------------
1a ACCOUNTING     NEW YORK
20 RESEARCH       DALLAS
30 SALES          CHICAGO
40 OPERATIONS     CALIFORNIA

4 rows selected.
</pre></div>
<!-- class="section" --></div>
<a id="SUTIL3770"></a>
<div class="props_rev_3"><a id="GUID-1E6D5C56-5AC5-4240-8ACF-A51BC4140FAD"></a>
<h2 id="SUTIL-GUID-1E6D5C56-5AC5-4240-8ACF-A51BC4140FAD" class="sect2">Using Parallel Processing with the PREPROCESSOR Clause</h2>
<div>
<p>External tables treats each data file specified on the <code class="codeph">LOCATION</code> clause as a single granule. To make the best use of parallel processing with the <code class="codeph">PREPROCESSOR</code> clause, the data to be loaded should be split into multiple files (granules). This is because external tables <span class="italic">limits</span> the degree of parallelism <span class="italic">to</span> the number of data files present. For example, if you specify a degree of parallelism of 16, but have only 10 data files, then in effect the degree of parallelism is 10 because 10 slave processes will be busy and 6 will be idle. It is best to not have any idle slave processes. So if you do specify a degree of parallelism, then ideally it should be <span class="italic">no larger</span> than the number of data files so that all slave processes are kept busy.</p>
<div class="infoboxnotealso" id="GUID-1E6D5C56-5AC5-4240-8ACF-A51BC4140FAD__GUID-F30CE27D-3105-4557-898D-45B557263B1E">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink VLDBG0105" target="_blank" href="../VLDBG/GUID-D28717E4-0F77-44F5-BB4E-234C31D4E4BA.htm#VLDBG0105"><span class="italic">Oracle Database VLDB and Partitioning Guide</span></a> for more information about granules of parallelism</p>
</li>
</ul>
</div>
</div>
</div>
<a id="SUTIL1387"></a>
<div class="props_rev_3"><a id="GUID-A991C29F-5B6E-49E1-9654-6618E941B4B8"></a>
<h2 id="SUTIL-GUID-A991C29F-5B6E-49E1-9654-6618E941B4B8" class="sect2">Restrictions When Using the PREPROCESSOR Clause</h2>
<div>
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">PREPROCESSOR</code> clause is not available on databases that use the Oracle Database Vault feature.</p>
</li>
<li>
<p>The <code class="codeph">PREPROCESSOR</code> clause does not work in conjunction with the <code class="codeph">COLUMN</code> <code class="codeph">TRANSFORMS</code> clause.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2015">
<tr>
<td class="cellalignment2022">
<table class="cellalignment2020">
<tr>
<td class="cellalignment2019"><a href="GUID-0A09AA3E-7426-42DF-8BC3-30651429056B.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2019"><a href="GUID-C5E88733-03AC-4222-B558-3DDEC0E64550.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2024">
<table class="cellalignment2018">
<tr>
<td class="cellalignment2019"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2019"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2019"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2019"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2019"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2019"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>