<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-105160"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20the%20DBMS_METADATA%20API%20to%20Re-Create%20a%20Retrieved%20Object"></a><title>Using the DBMS_METADATA API to Re-Create a Retrieved Object</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-07-10T17:06:49Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Utilities"/>
<meta name="dcterms.identifier" content="E41528-09"/>
<meta name="dcterms.isVersionOf" content="SUTIL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-BB45CA8D-2621-419B-906C-1E811499786A.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41528-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4"></a> <span id="PAGE" style="display:none;">818/1019</span> <!-- End Header -->
<a id="SUTIL3624"></a><a id="SUTIL1629"></a>
<h1 id="SUTIL-GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4" class="sect1">Using the DBMS_METADATA API to Re-Create a Retrieved Object</h1>
<div>
<div class="section">
<p>When you fetch metadata for an object, you may want to use it to re-create the object in a different database or schema.</p>
<p>You may not be ready to make remapping decisions when you fetch the metadata. You may want to defer these decisions until later. To accomplish this, you fetch the metadata as XML and store it in a file or table. Later you can use the submit interface to re-create the object.</p>
<p>The submit interface is similar in form to the retrieval interface. It has an <code class="codeph">OPENW</code> procedure in which you specify the object type of the object to be created. You can specify transforms, transform parameters, and parse items. You can call the <code class="codeph">CONVERT</code> function to convert the XML to DDL, or you can call the <code class="codeph">PUT</code> function to both convert XML to DDL and submit the DDL to create the object.</p>
<div class="infoboxnotealso" id="GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4__GUID-91F633DE-183B-4409-B759-1B41BE7D55C5">
<p class="notep1">See Also:</p>
<p><a href="GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD.htm#GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD__g1030301" title="DBMS_METADATA procedures used for submitting XML data">Table 21-3</a> for descriptions of <code class="codeph">DBMS_METADATA</code> procedures and functions used in the submit interface</p>
</div>
<p><a href="GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4.htm#GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4__i1014078">Example 21-7</a> fetches the XML for a table in one schema, and then uses the submit interface to re-create the table in another schema.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4__i1014078">
<p class="titleinexample">Example 21-7 Using the Submit Interface to Re-Create a Retrieved Object</p>
<ol>
<li>
<p>Connect as a privileged user:</p>
<pre dir="ltr">CONNECT system
Enter password: <span class="italic">password</span>
</pre></li>
<li>
<p>Create an invoker&#39;s rights package to hold the procedure because access to objects in another schema requires the <code class="codeph">SELECT_CATALOG_ROLE</code> role. In a definer&#39;s rights PL/SQL object (such as a procedure or function), roles are disabled.</p>
<pre dir="ltr">CREATE OR REPLACE PACKAGE example_pkg AUTHID current_user IS
  PROCEDURE move_table(
        table_name  in VARCHAR2,
        from_schema in VARCHAR2,
        to_schema   in VARCHAR2 );
END example_pkg;
/
CREATE OR REPLACE PACKAGE BODY example_pkg IS
PROCEDURE move_table(
        table_name  in VARCHAR2,
        from_schema in VARCHAR2,
        to_schema   in VARCHAR2 ) IS

-- Define local variables.
h1      NUMBER;         -- handle returned by OPEN
h2      NUMBER;         -- handle returned by OPENW
th1     NUMBER;         -- handle returned by ADD_TRANSFORM for MODIFY
th2     NUMBER;         -- handle returned by ADD_TRANSFORM for DDL
xml     CLOB;           -- XML document
errs    sys.ku$_SubmitResults := sys.ku$_SubmitResults();
err     sys.ku$_SubmitResult;
result  BOOLEAN;
BEGIN

-- Specify the object type.
h1 := DBMS_METADATA.OPEN(&#39;TABLE&#39;);

-- Use filters to specify the name and schema of the table.
DBMS_METADATA.SET_FILTER(h1,&#39;NAME&#39;,table_name);
DBMS_METADATA.SET_FILTER(h1,&#39;SCHEMA&#39;,from_schema);

-- Fetch the XML.
xml := DBMS_METADATA.FETCH_CLOB(h1);
IF xml IS NULL THEN
    DBMS_OUTPUT.PUT_LINE(&#39;Table &#39; || from_schema || &#39;.&#39; || table_name
|| &#39; not found&#39;);
    RETURN;
  END IF;

-- Release resources.
DBMS_METADATA.CLOSE(h1);

-- Use the submit interface to re-create the object in another schema.

-- Specify the object type using OPENW (instead of OPEN).
h2 := DBMS_METADATA.OPENW(&#39;TABLE&#39;);

-- First, add the MODIFY transform.
th1 := DBMS_METADATA.ADD_TRANSFORM(h2,&#39;MODIFY&#39;);

-- Specify the desired modification: remap the schema name.
DBMS_METADATA.SET_REMAP_PARAM(th1,&#39;REMAP_SCHEMA&#39;,from_schema,to_schema);

-- Now add the DDL transform so that the modified XML can be
--  transformed into creation DDL.
th2 := DBMS_METADATA.ADD_TRANSFORM(h2,&#39;DDL&#39;);

-- Call PUT to re-create the object.
result := DBMS_METADATA.PUT(h2,xml,0,errs);

DBMS_METADATA.CLOSE(h2);
  IF NOT result THEN
    -- Process the error information.
    FOR i IN errs.FIRST..errs.LAST LOOP
      err := errs(i);
      FOR j IN err.errorLines.FIRST..err.errorLines.LAST LOOP
        dbms_output.put_line(err.errorLines(j).errorText);
      END LOOP;
    END LOOP;
  END IF;
END;
END example_pkg;
/
</pre></li>
<li>
<p>Now create a table named <code class="codeph">my_example</code> in the schema <code class="codeph">SCOTT</code>:</p>
<pre dir="ltr">CONNECT scott
Enter password:
-- The password is tiger.

DROP TABLE my_example;
CREATE TABLE my_example (a NUMBER, b VARCHAR2(30));

CONNECT system
Enter password: <span class="italic">password</span>

SET LONG 9000000
SET PAGESIZE 0
SET SERVEROUTPUT ON SIZE 100000
</pre></li>
<li>
<p>Copy the <code class="codeph">my_example</code> table to the <code class="codeph">SYSTEM</code> schema:</p>
<pre dir="ltr">DROP TABLE my_example;
EXECUTE example_pkg.move_table(&#39;MY_EXAMPLE&#39;,&#39;SCOTT&#39;,&#39;SYSTEM&#39;);
</pre></li>
<li>
<p>Perform the following query to verify that it worked:</p>
<pre dir="ltr">SELECT DBMS_METADATA.GET_DDL(&#39;TABLE&#39;,&#39;MY_EXAMPLE&#39;) FROM dual;
</pre></li>
</ol>
</div>
<!-- class="example" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2015">
<tr>
<td class="cellalignment2022">
<table class="cellalignment2020">
<tr>
<td class="cellalignment2019"><a href="GUID-BB45CA8D-2621-419B-906C-1E811499786A.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2019"><a href="GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2024">
<table class="cellalignment2018">
<tr>
<td class="cellalignment2019"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2019"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2019"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2019"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2019"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2019"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>