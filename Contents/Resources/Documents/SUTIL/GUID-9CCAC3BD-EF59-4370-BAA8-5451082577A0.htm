<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-105644"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Example%202%3A%20Grouping%20DML%20Statements%20into%20Committed%20Transactions"></a><title>Example 2: Grouping DML Statements into Committed Transactions</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-07-10T17:06:49Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Utilities"/>
<meta name="dcterms.identifier" content="E41528-09"/>
<meta name="dcterms.isVersionOf" content="SUTIL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-E3820793-B482-48C4-9F44-C0D7A062E318.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-E42A8D99-F93F-40F4-9E86-787CA179692A.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41528-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-9CCAC3BD-EF59-4370-BAA8-5451082577A0"></a> <span id="PAGE" style="display:none;">792/1019</span> <!-- End Header -->
<a id="SUTIL4236"></a><a id="SUTIL4237"></a><a id="SUTIL4238"></a><a id="SUTIL4239"></a><a id="SUTIL4240"></a><a id="SUTIL1607"></a>
<h1 id="SUTIL-GUID-9CCAC3BD-EF59-4370-BAA8-5451082577A0" class="sect1">Example 2: Grouping DML Statements into Committed Transactions</h1>
<div>
<div class="section">
<p>As shown in the first example, <span class="q">&#34;<a href="GUID-E3820793-B482-48C4-9F44-C0D7A062E318.htm">Example 1: Finding All Modifications in the Last Archived Redo Log File</a>&#34;</span>, LogMiner displays all modifications it finds in the redo log files that it analyzes by default, regardless of whether the transaction has been committed or not. In addition, LogMiner shows modifications in the same order in which they were executed. Because DML statements that belong to the same transaction are not grouped together, visual inspection of the output can be difficult. Although you can use SQL to group transactions, LogMiner provides an easier way. In this example, the latest archived redo log file will again be analyzed, but it will return only committed transactions.</p>
<ol>
<li>
<p>Determine which redo log file was most recently archived by the database.</p>
<pre dir="ltr">SELECT NAME FROM V$ARCHIVED_LOG
   WHERE FIRST_TIME = (SELECT MAX(FIRST_TIME) FROM V$ARCHIVED_LOG);

NAME                            
-------------------------------------------
/usr/oracle/data/db1arch_1_16_482701534.dbf
</pre></li>
<li>
<p>Specify the redo log file that was returned by the query in Step 1. The list will consist of one redo log file.</p>
<pre dir="ltr">EXECUTE DBMS_LOGMNR.ADD_LOGFILE( -
   LOGFILENAME =&gt; &#39;/usr/oracle/data/db1arch_1_16_482701534.dbf&#39;, -
   OPTIONS =&gt; DBMS_LOGMNR.NEW);
</pre></li>
<li>
<p>Start LogMiner by specifying the dictionary to use and the <code class="codeph">COMMITTED_DATA_ONLY</code> option.</p>
<pre dir="ltr">EXECUTE DBMS_LOGMNR.ADD_LOGFILE( -
   LOGFILENAME =&gt; &#39;/usr/oracle/data/db1arch_1_16_482701534.dbf&#39;, -
   OPTIONS =&gt; DBMS_LOGMNR.NEW);
</pre></li>
<li>
<p>Query the <code class="codeph">V$LOGMNR_CONTENTS</code> view.</p>
<p>Although transaction 1.11.1476 was started before transaction 1.1.1484 (as revealed in <span class="q">&#34;<a href="GUID-E3820793-B482-48C4-9F44-C0D7A062E318.htm">Example 1: Finding All Modifications in the Last Archived Redo Log File</a>&#34;</span>), it committed after transaction 1.1.1484 committed. In this example, therefore, transaction 1.1.1484 is shown in its entirety before transaction 1.11.1476. The two transactions that did not commit within the redo log file being analyzed are not returned.</p>
<pre dir="ltr">SELECT username AS USR, (XIDUSN || &#39;.&#39; || XIDSLT || &#39;.&#39; ||  XIDSQN) AS XID, SQL_REDO, 
   SQL_UNDO FROM V$LOGMNR_CONTENTS WHERE username IN (&#39;HR&#39;, &#39;OE&#39;);
;
USR    XID          SQL_REDO                        SQL_UNDO
----   ---------    ------------------------------- ---------------------------------
     
OE     1.1.1484   set transaction read write;

OE     1.1.1484   update &#34;OE&#34;.&#34;PRODUCT_INFORMATION&#34;  update &#34;OE&#34;.&#34;PRODUCT_INFORMATION&#34; 
                  set &#34;WARRANTY_PERIOD&#34; =            set &#34;WARRANTY_PERIOD&#34; = 
                  TO_YMINTERVAL(&#39;+05-00&#39;) where      TO_YMINTERVAL(&#39;+01-00&#39;) where
                  &#34;PRODUCT_ID&#34; = &#39;1799&#39; and          &#34;PRODUCT_ID&#34; = &#39;1799&#39; and
                  &#34;WARRANTY_PERIOD&#34; =                &#34;WARRANTY_PERIOD&#34; = 
                  TO_YMINTERVAL(&#39;+01-00&#39;) and        TO_YMINTERVAL(&#39;+05-00&#39;) and
                  ROWID = &#39;AAAHTKAABAAAY9mAAB&#39;;      ROWID = &#39;AAAHTKAABAAAY9mAAB&#39;; 
                                                                                
OE     1.1.1484   update &#34;OE&#34;.&#34;PRODUCT_INFORMATION&#34;  update &#34;OE&#34;.&#34;PRODUCT_INFORMATION&#34;
                  set &#34;WARRANTY_PERIOD&#34; =            set &#34;WARRANTY_PERIOD&#34; =
                  TO_YMINTERVAL(&#39;+05-00&#39;) where      TO_YMINTERVAL(&#39;+01-00&#39;) where
                  &#34;PRODUCT_ID&#34; = &#39;1801&#39; and          &#34;PRODUCT_ID&#34; = &#39;1801&#39; and
                  &#34;WARRANTY_PERIOD&#34; =                &#34;WARRANTY_PERIOD&#34; = 
                  TO_YMINTERVAL(&#39;+01-00&#39;) and        TO_YMINTERVAL(&#39;+05-00&#39;) and
                  ROWID = &#39;AAAHTKAABAAAY9mAAC&#39;;      ROWID =&#39;AAAHTKAABAAAY9mAAC&#39;;

OE     1.1.1484   commit;
                            
HR     1.11.1476  set transaction read write;

HR     1.11.1476  insert into &#34;HR&#34;.&#34;EMPLOYEES&#34;(     delete from &#34;HR&#34;.&#34;EMPLOYEES&#34; 
                  &#34;EMPLOYEE_ID&#34;,&#34;FIRST_NAME&#34;,       where &#34;EMPLOYEE_ID&#34; = &#39;306&#39;
                  &#34;LAST_NAME&#34;,&#34;EMAIL&#34;,              and &#34;FIRST_NAME&#34; = &#39;Nandini&#39;
                  &#34;PHONE_NUMBER&#34;,&#34;HIRE_DATE&#34;,       and &#34;LAST_NAME&#34; = &#39;Shastry&#39;
                  &#34;JOB_ID&#34;,&#34;SALARY&#34;,                and &#34;EMAIL&#34; = &#39;NSHASTRY&#39;
                  &#34;COMMISSION_PCT&#34;,&#34;MANAGER_ID&#34;,    and &#34;PHONE_NUMBER&#34; = &#39;1234567890&#39;
                  &#34;DEPARTMENT_ID&#34;) values           and &#34;HIRE_DATE&#34; = TO_DATE(&#39;10-JAN-2012
                  (&#39;306&#39;,&#39;Nandini&#39;,&#39;Shastry&#39;,       13:34:43&#39;, &#39;dd-mon-yyyy hh24:mi:ss&#39;) 
                  &#39;NSHASTRY&#39;, &#39;1234567890&#39;,         and &#34;JOB_ID&#34; = &#39;HR_REP&#39; and 
                  TO_DATE(&#39;10-jan-2012 13:34:43&#39;,   &#34;SALARY&#34; = &#39;120000&#39; and 
                  &#39;dd-mon-yyy hh24:mi:ss&#39;),         &#34;COMMISSION_PCT&#34; = &#39;.05&#39; and
                  &#39;HR_REP&#39;,&#39;120000&#39;, &#39;.05&#39;,         &#34;DEPARTMENT_ID&#34; = &#39;10&#39; and
                  &#39;105&#39;,&#39;10&#39;);                      ROWID = &#39;AAAHSkAABAAAY6rAAO&#39;;

HR     1.11.1476  insert into &#34;HR&#34;.&#34;EMPLOYEES&#34;(     delete from &#34;HR&#34;.&#34;EMPLOYEES&#34;
                  &#34;EMPLOYEE_ID&#34;,&#34;FIRST_NAME&#34;,       &#34;EMPLOYEE_ID&#34; = &#39;307&#39; and 
                  &#34;LAST_NAME&#34;,&#34;EMAIL&#34;,              &#34;FIRST_NAME&#34; = &#39;John&#39; and
                  &#34;PHONE_NUMBER&#34;,&#34;HIRE_DATE&#34;,       &#34;LAST_NAME&#34; = &#39;Silver&#39; and
                  &#34;JOB_ID&#34;,&#34;SALARY&#34;,                &#34;EMAIL&#34; = &#39;JSILVER&#39; and 
                  &#34;COMMISSION_PCT&#34;,&#34;MANAGER_ID&#34;,    &#34;PHONE_NUMBER&#34; = &#39;5551112222&#39;
                  &#34;DEPARTMENT_ID&#34;) values           and &#34;HIRE_DATE&#34; = TO_DATE(&#39;10-jan-2012
                  (&#39;307&#39;,&#39;John&#39;,&#39;Silver&#39;,           13:41:03&#39;, &#39;dd-mon-yyyy hh24:mi:ss&#39;) 
                   &#39;JSILVER&#39;, &#39;5551112222&#39;,         and &#34;JOB_ID&#34; =&#39;105&#39; and &#34;DEPARTMENT_ID&#34; 
                  TO_DATE(&#39;10-jan-2012 13:41:03&#39;,   = &#39;50&#39; and ROWID = &#39;AAAHSkAABAAAY6rAAP&#39;; 
                  &#39;dd-mon-yyyy hh24:mi:ss&#39;),
                  &#39;SH_CLERK&#39;,&#39;110000&#39;, &#39;.05&#39;,
                  &#39;105&#39;,&#39;50&#39;);                

HR     1.11.1476  commit;
</pre></li>
<li>
<p>End the LogMiner session.</p>
<pre dir="ltr">EXECUTE DBMS_LOGMNR.END_LOGMNR();
</pre></li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2015">
<tr>
<td class="cellalignment2022">
<table class="cellalignment2020">
<tr>
<td class="cellalignment2019"><a href="GUID-E3820793-B482-48C4-9F44-C0D7A062E318.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2019"><a href="GUID-E42A8D99-F93F-40F4-9E86-787CA179692A.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2024">
<table class="cellalignment2018">
<tr>
<td class="cellalignment2019"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2019"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2019"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2019"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2019"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2019"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>