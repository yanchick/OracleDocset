<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-105756"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Database%20Insert%20Triggers"></a><title>Database Insert Triggers</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="triggers, database insert, replacing with integrity constraints, constraints, automatic integrity and SQL*Loader, update, SQL*Loader, stored procedures, direct path load"/>
<meta name="dcterms.created" content="2017-07-10T17:06:49Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Utilities"/>
<meta name="dcterms.identifier" content="E41528-09"/>
<meta name="dcterms.isVersionOf" content="SUTIL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-7E492DDC-BED3-4926-A3A1-20FC324CA100.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-CDCE5FE6-09FB-489C-B4F5-C2D45D0FFA6F.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41528-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-B5EA310B-FFB7-4CF0-8A2D-78E5E11EBC87"></a> <span id="PAGE" style="display:none;">508/1019</span> <!-- End Header -->
<a id="SUTIL1335"></a>
<h1 id="SUTIL-GUID-B5EA310B-FFB7-4CF0-8A2D-78E5E11EBC87" class="sect1">Database Insert Triggers</h1>
<div>
<p>Table insert triggers are also disabled when a direct path load begins. After the rows are loaded and indexes rebuilt, any triggers that were disabled are automatically reenabled. The log file lists all triggers that were disabled for the load. There should not be any errors reenabling triggers<a id="d101770e36" class="indexterm-anchor"></a><a id="d101770e42" class="indexterm-anchor"></a>.</p>
<p>Unlike integrity constraints, insert triggers are not reapplied to the whole table when they are enabled. As a result, insert triggers do <span class="italic">not</span> fire for any rows loaded on the direct path. When using the direct path, the application must ensure that any behavior associated with insert triggers is carried out for the new rows.</p>
</div>
<a id="SUTIL1336"></a>
<div class="props_rev_3"><a id="GUID-BC7676C1-E9DA-41B0-A993-A53E0D9C9A0D"></a>
<h2 id="SUTIL-GUID-BC7676C1-E9DA-41B0-A993-A53E0D9C9A0D" class="sect2">Replacing Insert Triggers with Integrity Constraints</h2>
<div>
<div class="section">
<p>Applications commonly use insert triggers to implement integrity constraints. Most of the triggers that these application insert are simple enough that they can be replaced with Oracle&#39;s automatic integrity constraints.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="SUTIL1337"></a>
<div class="props_rev_3"><a id="GUID-86536F29-ECAF-4E2A-B298-4047B7F99743"></a>
<h2 id="SUTIL-GUID-86536F29-ECAF-4E2A-B298-4047B7F99743" class="sect2">When Automatic Constraints Cannot Be Used</h2>
<div>
<p>Sometimes an insert trigger cannot be replaced with Oracle&#39;s automatic integrity constraints. For example, if an integrity check is implemented with a table lookup in an insert trigger, then automatic check constraints cannot be used, because the automatic constraints can only reference constants and columns in the current row. This section describes two methods for duplicating the effects of such a trigger.</p>
</div>
</div>
<a id="SUTIL1338"></a>
<div class="props_rev_3"><a id="GUID-554DE348-8135-4E16-B483-111323535BC7"></a>
<h2 id="SUTIL-GUID-554DE348-8135-4E16-B483-111323535BC7" class="sect2">Preparation</h2>
<div>
<div class="section">
<p>Before either method can be used, the table must be prepared. Use the following general guidelines to prepare the table:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Before the load, add a 1-byte or 1-character column to the table that marks rows as &#34;old data&#34; or &#34;new data.&#34;</span></li>
<li><span>Let the value of null for this column signify &#34;old data&#34; because null columns do not take up space.</span></li>
<li><span>When loading, flag all loaded rows as &#34;new data&#34; with SQL*Loader&#39;s <code class="codeph">CONSTANT</code> parameter.</span></li>
</ol>
<div class="section">
<p>After following this procedure, all newly loaded rows are identified, making it possible to operate on the new data without affecting the old rows.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="SUTIL1339"></a>
<div class="props_rev_3"><a id="GUID-A6733492-77CB-4C8E-93E8-5DA86AFE5612"></a>
<h2 id="SUTIL-GUID-A6733492-77CB-4C8E-93E8-5DA86AFE5612" class="sect2">Using an Update Trigger</h2>
<div>
<div class="section">
<p>Generally, you can use a database update trigger to duplicate the effects of an insert trigger. This method is the simplest. It can be used whenever the insert trigger does not raise any exceptions.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Create an update trigger that duplicates the effects of the insert trigger.</span>
<div>
<p>Copy the trigger. Change all occurrences of <code class="codeph">&#34;</code><span class="italic"><code class="codeph">new</code></span><code class="codeph">.column_name&#34;</code> to <code class="codeph">&#34;</code><span class="italic"><code class="codeph">old</code></span><code class="codeph">.column_name&#34;</code>.</p>
</div>
</li>
<li class="stepexpand"><span>Replace the current update trigger, if it exists, with the new one.</span></li>
<li class="stepexpand"><span>Update the table, changing the &#34;new data&#34; flag to null, thereby firing the update trigger.</span></li>
<li class="stepexpand"><span>Restore the original update trigger, if there was one.</span></li>
</ol>
<div class="section">
<p>Depending on the behavior of the trigger, it may be necessary to have exclusive update access to the table during this operation, so that other users do not inadvertently apply the trigger to rows they modify.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="SUTIL1340"></a>
<div class="props_rev_3"><a id="GUID-98C5B698-141D-449B-9938-CAA935D8B7EC"></a>
<h2 id="SUTIL-GUID-98C5B698-141D-449B-9938-CAA935D8B7EC" class="sect2">Duplicating the Effects of Exception Conditions</h2>
<div>
<p>If the insert trigger can raise an exception, then more work is required to duplicate its effects. Raising an exception would prevent the row from being inserted into the table. To duplicate that effect with an update trigger, it is necessary to mark the loaded row for deletion.</p>
<p>The &#34;new data&#34; column cannot be used as a delete flag, because an update trigger cannot modify the columns that caused it to fire. So another column must be added to the table. This column marks the row for deletion. A null value means the row is valid. Whenever the insert trigger would raise an exception, the update trigger can mark the row as invalid by setting a flag in the additional column.</p>
<p>In summary, when an insert trigger can raise an exception condition, its effects can be duplicated by an update trigger, provided:</p>
<ul style="list-style-type: disc;">
<li>
<p>Two columns (which are usually null) are added to the table</p>
</li>
<li>
<p>The table can be updated exclusively (if necessary)</p>
</li>
</ul>
</div>
</div>
<a id="SUTIL1341"></a>
<div class="props_rev_3"><a id="GUID-D9C8570B-CB5D-4566-A016-48256BE904CC"></a>
<h2 id="SUTIL-GUID-D9C8570B-CB5D-4566-A016-48256BE904CC" class="sect2">Using a Stored Procedure</h2>
<div>
<div class="section">
<p>The following procedure always works, but it is more complex to implement. It can be used when the insert trigger raises exceptions. It does not require a second additional column; and, because it does not replace the update trigger, it can be used without exclusive access to the table.</p>
<ol>
<li>
<p>Do the following to create a stored procedure that duplicates the effects of the insert trigger:</p>
<ol>
<li>
<p>Declare a cursor for the table, selecting all new rows.</p>
</li>
<li>
<p>Open the cursor and fetch rows, one at a time, in a processing loop.</p>
</li>
<li>
<p>Perform the operations contained in the insert trigger.</p>
</li>
<li>
<p>If the operations succeed, then change the &#34;new data&#34; flag to null.</p>
</li>
<li>
<p>If the operations fail, then change the &#34;new data&#34; flag to &#34;bad data.&#34;</p>
</li>
</ol>
</li>
<li>
<p>Execute the stored procedure using an administration tool such as SQL*Plus.</p>
</li>
<li>
<p>After running the procedure, check the table for any rows marked &#34;bad data.&#34;</p>
</li>
<li>
<p>Update or remove the bad rows.</p>
</li>
<li>
<p>Reenable the insert trigger.</p>
</li>
</ol>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2015">
<tr>
<td class="cellalignment2022">
<table class="cellalignment2020">
<tr>
<td class="cellalignment2019"><a href="GUID-7E492DDC-BED3-4926-A3A1-20FC324CA100.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2019"><a href="GUID-CDCE5FE6-09FB-489C-B4F5-C2D45D0FFA6F.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2024">
<table class="cellalignment2018">
<tr>
<td class="cellalignment2019"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2019"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2019"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2019"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2019"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2019"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>