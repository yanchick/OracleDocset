<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-105931"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Example%205%3A%20Tracking%20DDL%20Statements%20in%20the%20Internal%20Dictionary"></a><title>Example 5: Tracking DDL Statements in the Internal Dictionary</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-07-10T17:06:49Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Utilities"/>
<meta name="dcterms.identifier" content="E41528-09"/>
<meta name="dcterms.isVersionOf" content="SUTIL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-90944343-46BB-4BD5-A0C6-7A4B79D9BEF0.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-6BE36A8B-0078-4EB1-9D57-80E51A2DFB09.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41528-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-E0DDC97C-7364-4BED-AF2A-E0B486F0E22F"></a> <span id="PAGE" style="display:none;">795/1019</span> <!-- End Header -->
<a id="SUTIL4253"></a><a id="SUTIL4254"></a><a id="SUTIL4255"></a><a id="SUTIL4256"></a><a id="SUTIL4257"></a><a id="SUTIL4258"></a><a id="SUTIL4259"></a><a id="SUTIL1610"></a>
<h1 id="SUTIL-GUID-E0DDC97C-7364-4BED-AF2A-E0B486F0E22F" class="sect1">Example 5: Tracking DDL Statements in the Internal Dictionary</h1>
<div>
<div class="section">
<p>By using the <code class="codeph">DBMS_LOGMNR.DDL_DICT_TRACKING</code> option, this example ensures that the LogMiner internal dictionary is updated with the DDL statements encountered in the redo log files.</p>
<ol>
<li>
<p>Determine which redo log file was most recently archived by the database.</p>
<pre dir="ltr">SELECT NAME, SEQUENCE# FROM V$ARCHIVED_LOG 
   WHERE FIRST_TIME = (SELECT MAX(FIRST_TIME) FROM V$ARCHIVED_LOG);

NAME                                           SEQUENCE#
--------------------------------------------   --------------
/usr/oracle/data/db1arch_1_210_482701534.dbf   210
</pre></li>
<li>
<p>Because the dictionary may be contained in more than one redo log file, you need to determine which redo log files contain the start and end of the data dictionary. Query the <code class="codeph">V$ARCHIVED_LOG</code> view, as follows:</p>
<ol>
<li>
<p>Find a redo log that contains the end of the data dictionary extract. This redo log file must have been created before the redo log files that you want to analyze, but should be as recent as possible.</p>
<pre dir="ltr">SELECT NAME, SEQUENCE#, DICTIONARY_BEGIN d_beg, DICTIONARY_END d_end
   FROM V$ARCHIVED_LOG
   WHERE SEQUENCE# = (SELECT MAX (SEQUENCE#) FROM V$ARCHIVED_LOG
   WHERE DICTIONARY_END = &#39;YES&#39; and SEQUENCE# &lt; 210);


NAME                                           SEQUENCE#    D_BEG  D_END
--------------------------------------------   ----------   -----  ------
/usr/oracle/data/db1arch_1_208_482701534.dbf   208          NO     YES
</pre></li>
<li>
<p>Find the redo log file that contains the start of the data dictionary extract that matches the end of the dictionary found by the previous SQL statement:</p>
<pre dir="ltr">SELECT NAME, SEQUENCE#, DICTIONARY_BEGIN d_beg, DICTIONARY_END d_end
   FROM V$ARCHIVED_LOG
   WHERE SEQUENCE# = (SELECT MAX (SEQUENCE#) FROM V$ARCHIVED_LOG
   WHERE DICTIONARY_BEGIN = &#39;YES&#39; and SEQUENCE# &lt;= 208);

NAME                                           SEQUENCE#    D_BEG  D_END
--------------------------------------------   ----------   -----  ------
/usr/oracle/data/db1arch_1_208_482701534.dbf   207          YES     NO
</pre></li>
</ol>
</li>
<li>
<p>Ensure that you have a complete list of redo log files.</p>
<p>To successfully apply DDL statements encountered in the redo log files, ensure that all files are included in the list of redo log files to mine. The missing log file corresponding to sequence# 209 must be included in the list. Determine the names of the redo log files that you need to add to the list by issuing the following query:</p>
<pre dir="ltr">SELECT NAME FROM V$ARCHIVED_LOG
   WHERE SEQUENCE# &gt;= 207 AND SEQUENCE# &lt;= 210 
   ORDER BY SEQUENCE# ASC;

NAME                                           
--------------------------------------------   
/usr/oracle/data/db1arch_1_207_482701534.dbf  
/usr/oracle/data/db1arch_1_208_482701534.dbf  
/usr/oracle/data/db1arch_1_209_482701534.dbf  
/usr/oracle/data/db1arch_1_210_482701534.dbf  
</pre></li>
<li>
<p>Specify the list of the redo log files of interest.</p>
<p>Include the redo log files that contain the beginning and end of the dictionary, the redo log file that you want to mine, and any redo log files required to create a list without gaps. You can add the redo log files in any order.</p>
<pre dir="ltr">EXECUTE DBMS_LOGMNR.ADD_LOGFILE(-
   LOGFILENAME =&gt; &#39;/usr/oracle/data/db1arch_1_210_482701534.dbf&#39;, -
</pre>
<pre dir="ltr">       OPTIONS =&gt; DBMS_LOGMNR.NEW);
</pre>
<pre dir="ltr">EXECUTE DBMS_LOGMNR.ADD_LOGFILE(-
   LOGFILENAME =&gt; &#39;/usr/oracle/data/db1arch_1_209_482701534.dbf&#39;);
EXECUTE DBMS_LOGMNR.ADD_LOGFILE(-
   LOGFILENAME =&gt; &#39;/usr/oracle/data/db1arch_1_208_482701534.dbf&#39;);
EXECUTE DBMS_LOGMNR.ADD_LOGFILE(-
   LOGFILENAME =&gt; &#39;/usr/oracle/data/db1arch_1_207_482701534.dbf&#39;);
</pre></li>
<li>
<p>Start LogMiner by specifying the dictionary to use and the <code class="codeph">DDL_DICT_TRACKING</code>, <code class="codeph">COMMITTED_DATA_ONLY</code>, and <code class="codeph">PRINT_PRETTY_SQL</code> options.</p>
<pre dir="ltr">EXECUTE DBMS_LOGMNR.START_LOGMNR(-
   OPTIONS =&gt; DBMS_LOGMNR.DICT_FROM_REDO_LOGS + -
              DBMS_LOGMNR.DDL_DICT_TRACKING + -
              DBMS_LOGMNR.COMMITTED_DATA_ONLY + -
              DBMS_LOGMNR.PRINT_PRETTY_SQL);
</pre></li>
<li>
<p>Query the <code class="codeph">V$LOGMNR_CONTENTS</code> view.</p>
<p>To reduce the number of rows returned, exclude from the query all DML statements done in the <code class="codeph">SYS</code> or <code class="codeph">SYSTEM</code> schemas. (This query specifies a timestamp to exclude transactions that were involved in the dictionary extraction.)</p>
<p>The query returns all the reconstructed SQL statements correctly translated and the insert operations on the <code class="codeph">oe.product_tracking</code> table that occurred because of the trigger execution.</p>
<pre dir="ltr">SELECT USERNAME AS usr,(XIDUSN || &#39;.&#39; || XIDSLT || &#39;.&#39; || XIDSQN) as XID, SQL_REDO FROM  
   V$LOGMNR_CONTENTS 
   WHERE SEG_OWNER IS NULL OR SEG_OWNER NOT IN (&#39;SYS&#39;, &#39;SYSTEM&#39;) AND
   TIMESTAMP &gt; &#39;10-jan-2012 15:59:53&#39;;

USR             XID         SQL_REDO
-----------     --------    -----------------------------------
SYS             1.2.1594    set transaction read write;
SYS             1.2.1594    create table oe.product_tracking (product_id number not null,
                            modified_time date,
                            old_list_price number(8,2),
                            old_warranty_period interval year(2) to month);
SYS             1.2.1594    commit;

SYS             1.18.1602   set transaction read write;
SYS             1.18.1602   create or replace trigger oe.product_tracking_trigger
                            before update on oe.product_information
                            for each row
                            when (new.list_price &lt;&gt; old.list_price or
                                  new.warranty_period &lt;&gt; old.warranty_period)
                            declare
                            begin
                            insert into oe.product_tracking values 
                               (:old.product_id, sysdate,
                                :old.list_price, :old.warranty_period);
                            end;
SYS             1.18.1602   commit;

OE              1.9.1598    update &#34;OE&#34;.&#34;PRODUCT_INFORMATION&#34;
                              set
                                &#34;WARRANTY_PERIOD&#34; = TO_YMINTERVAL(&#39;+08-00&#39;),
                                &#34;LIST_PRICE&#34; = 100
                              where
                                &#34;PRODUCT_ID&#34; = 1729 and
                                &#34;WARRANTY_PERIOD&#34; = TO_YMINTERVAL(&#39;+05-00&#39;) and
                                &#34;LIST_PRICE&#34; = 80 and
                                ROWID = &#39;AAAHTKAABAAAY9yAAA&#39;;
OE              1.9.1598    insert into &#34;OE&#34;.&#34;PRODUCT_TRACKING&#34;
                              values
                                &#34;PRODUCT_ID&#34; = 1729,
                                &#34;MODIFIED_TIME&#34; = TO_DATE(&#39;13-jan-2012 16:07:03&#39;, 
                                &#39;dd-mon-yyyy hh24:mi:ss&#39;),
                                &#34;OLD_LIST_PRICE&#34; = 80,
                                &#34;OLD_WARRANTY_PERIOD&#34; = TO_YMINTERVAL(&#39;+05-00&#39;);

OE              1.9.1598    update &#34;OE&#34;.&#34;PRODUCT_INFORMATION&#34;
                              set
                                &#34;WARRANTY_PERIOD&#34; = TO_YMINTERVAL(&#39;+08-00&#39;),
                                &#34;LIST_PRICE&#34; = 92
                              where
                                &#34;PRODUCT_ID&#34; = 2340 and
                                &#34;WARRANTY_PERIOD&#34; = TO_YMINTERVAL(&#39;+05-00&#39;) and
                                &#34;LIST_PRICE&#34; = 72 and
                                ROWID = &#39;AAAHTKAABAAAY9zAAA&#39;;

OE              1.9.1598    insert into &#34;OE&#34;.&#34;PRODUCT_TRACKING&#34;
                              values
                                &#34;PRODUCT_ID&#34; = 2340,
                                &#34;MODIFIED_TIME&#34; = TO_DATE(&#39;13-jan-2012 16:07:07&#39;, 
                                &#39;dd-mon-yyyy hh24:mi:ss&#39;),
                                &#34;OLD_LIST_PRICE&#34; = 72,
                                &#34;OLD_WARRANTY_PERIOD&#34; = TO_YMINTERVAL(&#39;+05-00&#39;);

OE              1.9.1598     commit;
</pre></li>
<li>
<p>End the LogMiner session.</p>
<pre dir="ltr">EXECUTE DBMS_LOGMNR.END_LOGMNR();
</pre></li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2015">
<tr>
<td class="cellalignment2022">
<table class="cellalignment2020">
<tr>
<td class="cellalignment2019"><a href="GUID-90944343-46BB-4BD5-A0C6-7A4B79D9BEF0.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2019"><a href="GUID-6BE36A8B-0078-4EB1-9D57-80E51A2DFB09.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2024">
<table class="cellalignment2018">
<tr>
<td class="cellalignment2019"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2019"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2019"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2019"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2019"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2019"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>