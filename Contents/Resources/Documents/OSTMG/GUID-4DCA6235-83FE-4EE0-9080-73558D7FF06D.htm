<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-86740"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Preparing%20to%20Migrate%20the%20Database%20to%20Oracle%20ASM%20Using%20RMAN"></a><title>Preparing to Migrate the Database to Oracle ASM Using RMAN</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-07-10T10:06:05Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Automatic Storage Management Administrator&#39;s Guide"/>
<meta name="dcterms.identifier" content="E41058-12"/>
<meta name="dcterms.isVersionOf" content="OSTMG"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-B43E349F-9065-4422-8558-E22A0CE579C5.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-85FF9270-0C21-44C8-B5EC-C1096A488BA1.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41058-12.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-4DCA6235-83FE-4EE0-9080-73558D7FF06D"></a> <span id="PAGE" style="display:none;">239/612</span> <!-- End Header -->
<a id="OSTMG89995"></a>
<h1 id="OSTMG-GUID-4DCA6235-83FE-4EE0-9080-73558D7FF06D" class="sect1">Preparing to Migrate the Database to Oracle ASM Using RMAN</h1>
<div>
<p>This section explains how to prepare the database for migration. This section makes the following assumptions:</p>
<ul style="list-style-type: disc;">
<li>
<p>You want to migrate the database to two Oracle ASM disk groups: <code class="codeph">+DATA</code> for the database and <code class="codeph">+FRA</code> for the fast recovery area.</p>
</li>
<li>
<p>The database to be migrated to Oracle ASM storage is named <code class="codeph">mydb</code>.</p>
</li>
</ul>
<p>To prepare the database for Oracle ASM migration:</p>
<ol>
<li>
<p>If the <code class="codeph">COMPATIBLE</code> initialization parameter setting for the database is less than <code class="codeph">11.0.0</code>, then make any read-only transportable tablespaces read/write.</p>
<p>Read-only transportable tablespaces cannot be migrated because RMAN cannot back them up.</p>
</li>
<li>
<p>If the database is a physical standby database, and if managed recovery is started, then stop managed recovery.</p>
<p>A physical standby database is a copy of a production database that you can use for disaster protection.</p>
<p>For example, connect SQL*Plus to the database with <code class="codeph">SYSBACKUP</code> privileges (rather than <code class="codeph">SYSDBA</code> privileges) to enforce the separation of duty security model, and run the following statement to stop managed recovery:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE CANCEL;
</pre>
<p>Keep this terminal window open.</p>
</li>
<li>
<p>Copy the server parameter file or initialization parameter file to a temporary location.</p>
<p>The following example uses an operating system utility to copy the server parameter file:</p>
<pre dir="ltr">$ cp spfileMYDB.ora orig_spfileMYDB.ora
</pre></li>
<li>
<p>In a new terminal window, start RMAN session and connect as <code class="codeph">TARGET</code> to the database to be migrated. Optionally, connect to a recovery catalog. Connect with <code class="codeph">SYSBACKUP</code> privileges to enforce the separation of duty security model.</p>
</li>
<li id="GUID-4DCA6235-83FE-4EE0-9080-73558D7FF06D__BAJHEEDG">
<p>Back up the data files to the Oracle ASM disk group.</p>
<p>The following example uses a <code class="codeph">RUN</code> command to make a level 0 incremental backup and allocates four channels to increase the backup speed. A level 0 incremental backup is an RMAN incremental backup that backs up all data blocks in the data files being backed up. An incremental backup at level 0 is identical in content to a full backup, but unlike a full backup the level 0 backup is considered a part of the incremental backup strategy.</p>
<p>An incremental backup is a RMAN backup in which only modified blocks are backed up. Incremental backups are classified by <strong class="term">level</strong>. A level 0 incremental backup performs the same function as a full backup in that they both back up all blocks that have ever been used. The difference is that a full backup does not affect blocks backed up by subsequent incremental backups, whereas an incremental backup affects blocks backed up by subsequent incremental backups.</p>
<p>A full backup is a non-incremental RMAN backup. Full does not refer to how much of the database is backed up, but to the fact that the backup is not incremental. Consequently, you can make a full backup of one data file.</p>
<p>Increase or decrease this number accordingly. The format clause specifies <code class="codeph">+DATA</code>, which is the name of the Oracle ASM disk group to be used for storing the database.</p>
<pre dir="ltr">RUN
{
  ALLOCATE CHANNEL dev1 DEVICE TYPE DISK;
  ALLOCATE CHANNEL dev2 DEVICE TYPE DISK;
  ALLOCATE CHANNEL dev3 DEVICE TYPE DISK;
  ALLOCATE CHANNEL dev4 DEVICE TYPE DISK;
  BACKUP AS COPY
    INCREMENTAL LEVEL 0
    DATABASE
    FORMAT &#39;+DATA&#39;
    TAG &#39;ORA_ASM_MIGRATION&#39;;
}
</pre></li>
<li>
<p>If block change tracking is enabled for the database, then optionally make a level 1 incremental backup that you can use later to recover the database copy.</p>
<p>Block change tracking is a database option that causes Oracle to track data file blocks affected by each database update. The tracking information is stored in a block change tracking file. When block change tracking is enabled, RMAN uses the record of changed blocks from the change tracking file to improve incremental backup performance by only reading those blocks known to have changed, instead of reading data files in their entirety.</p>
<p>The following example makes an incremental level 1 copy of the level 0 backup created in the previous step:</p>
<pre dir="ltr">RUN
{
  ALLOCATE CHANNEL dev1 DEVICE TYPE DISK;
  ALLOCATE CHANNEL dev2 DEVICE TYPE DISK;
  ALLOCATE CHANNEL dev3 DEVICE TYPE DISK;
  ALLOCATE CHANNEL dev4 DEVICE TYPE DISK;
  BACKUP INCREMENTAL LEVEL 1 
    FOR RECOVER OF COPY WITH TAG &#39;ORA_ASM_MIGRATION&#39; 
    DATABASE;
}
</pre></li>
<li>
<p>If the database is in <code class="codeph">ARCHIVELOG</code> mode, and if the database is open, then archive the online logs.</p>
<p>The following example uses the <code class="codeph">SQL</code> command to archive the current redo logs:</p>
<pre dir="ltr">RMAN&gt; SQL &#34;ALTER SYSTEM ARCHIVE LOG CURRENT&#34;;
</pre></li>
<li>
<p>If the database instance is currently using a server parameter file, then back it up.</p>
<p>The following example backs up the server parameter file:</p>
<pre dir="ltr">RMAN&gt; BACKUP AS BACKUPSET SPFILE;
</pre></li>
<li>
<p>If block change tracking is enabled, then disable it.</p>
<p>The following command disables block change tracking:</p>
<pre dir="ltr">RMAN&gt; SQL &#34;ALTER DATABASE DISABLE BLOCK CHANGE TRACKING&#34;;
</pre></li>
<li>
<p>If Flashback Database is enabled, then disable it and drop any guaranteed restore points.</p>
<div class="infobox-note" id="GUID-4DCA6235-83FE-4EE0-9080-73558D7FF06D__GUID-A7E02510-D67B-4FA9-B8B4-537CADDB6F39">
<p class="notep1">Note:</p>
<p>If you are not migrating the fast recovery area, then skip this step.</p>
</div>
<p>Disabling Oracle Flashback Database is necessary because you cannot migrate flashback logs to Oracle ASM. The following command disables Flashback Database:</p>
<pre dir="ltr">RMAN&gt; SQL &#34;ALTER DATABASE FLASHBACK OFF&#34;;
</pre>
<p>The following command drops the guaranteed restore point named <code class="codeph">Q106</code>:</p>
<pre dir="ltr">RMAN&gt; SQL &#34;DROP RESTORE POINT Q106&#34;;
</pre></li>
<li>
<p>Shut down the database consistently.</p>
<p>The following command shuts down the database:</p>
<pre dir="ltr">RMAN&gt; SHUTDOWN IMMEDIATE;
</pre></li>
</ol>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1687">
<tr>
<td class="cellalignment1694">
<table class="cellalignment1692">
<tr>
<td class="cellalignment1691"><a href="GUID-B43E349F-9065-4422-8558-E22A0CE579C5.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1691"><a href="GUID-85FF9270-0C21-44C8-B5EC-C1096A488BA1.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1696">
<table class="cellalignment1690">
<tr>
<td class="cellalignment1691"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1691"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1691"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1691"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1691"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1691"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>