<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-106352"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Monitoring%20Database%20Usage%20of%20the%20Application"></a><title>Monitoring Database Usage of the Application</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 743"/>
<meta name="dcterms.created" content="2014-02-04T21:52:15Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database 2 Day + PHP Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E18554-05"/>
<meta name="dcterms.isVersionOf" content="TDPPH"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2010, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="ch_twelve_blobs.htm" title="Previous" type="text/html"/>
<link rel="Next" href="ch_fourteen_global.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E18554-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">16/18</span> <!-- End Header -->
<div id="TDPPH188" class="chapter"><a id="CHDFGBGC"></a>
<h1 class="chapter"><span class="secnum">13</span> Monitoring Database Usage of the Application</h1>
<p>This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#CHDEEHCJ">Overview of Metadata</a></p>
</li>
<li>
<p><a href="#CHDFEBCH">Viewing Metadata</a></p>
</li>
<li>
<p><a href="#CHDCGEBE">More Uses of Metadata</a></p>
</li>
<li>
<p><a href="#CHDEGBJJ">Metadata and Persistent Connections</a></p>
</li>
</ul>
<a id="CHDEEHCJ"></a>
<div id="TDPPH189" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of Metadata</h2>
<p>Throughout the implementation of the AnyCo application, metadata values were used for Oracle&#39;s end-to-end application tracing features. Values set were the:</p>
<ul>
<li>
<p>client identifier</p>
</li>
<li>
<p>client information</p>
</li>
<li>
<p>module</p>
</li>
<li>
<p>action</p>
</li>
</ul>
<p>The client identifier held a value uniquely associated with an end user. The other three values were effectively a descending hierarchy of data about the application&#39;s tasks.</p>
<p>The metadata values are semi-arbitrary text strings. Oracle records the metadata values and makes them available in certain database features, such as in the list of currently open connections. How your DBA uses those features and how your application is designed will determine what values an application should set.</p>
<p>In the AnyCo application the client identifier was set to <code>simon</code> or <code>admin</code>, depending on which web user was logged into the application. The client information was always set to &#39;AnyCo Corp.&#39; Refer to <code>CLIENT_INFO</code> in <code>ac_db.inc.php</code>. The module was set when each page created an instance of the <code>Db</code> class. By choice, the module name used was always <code>Equipment</code>, indicating that this set of files was related to manipulating employees&#39; equipment. The action varied with each SQL statement being run.</p>
</div>
<!-- class="sect1" -->
<a id="CHDFEBCH"></a>
<div id="TDPPH190" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Viewing Metadata</h2>
<p>To see where the metadata values are used, login to the AnyCo application and navigate through several pages.</p>
<p>On Windows, from the <span class="bold">Start</span> menu, select <span class="bold">Programs</span> (or <span class="bold">All Programs</span>), then <span class="bold">Oracle Database 12c</span> , and then <span class="bold">Go To Database Administration Page</span>.</p>
<p>On Linux, click the <span class="bold">Application</span> menu (on Gnome) or the <span class="bold">K</span> menu (on KDE), then point to <span class="bold">Oracle Database 12c</span>, and then <span class="bold">Go To Database Administration Page</span>. Navigate to the <span class="bold">Sessions</span> page and login as the <code>SYSTEM</code> user. This shows</p>
<img width="800" height="421" src="img/chap13_1_scaled.png" alt="Viewing Metadata"/><br/>
<p>You may see multiple entries. Apache will create several processes, any one of which might handle any of the HTTP requests. As you navigate through the application pages, different Apache processes handle the page requests.</p>
<p>Drill down by clicking the SID number for one of the AnyCo sessions:</p>
<img width="600" height="382" src="img/chap13_2.png" alt="data against SID number"/><br/>
<p>Client and Application information is also available on this page.</p>
<p>The Oracle Database administration tool shows the SQL statement and statistics about its execution. If you see any poorly tuned or heavily used statements the end-to-end tracing metadata will let you locate the source PHP files for easy review and re-design. For statements, the metadata in effect at first execution of each unique statement is the value recorded.</p>
<p>The accuracy of the metadata is reliant upon the consistency of use in the applications that connect to the database.</p>
<p>Detailed information on how the client identifier can be used is in the technical article:</p>
<p><code><a href="http://www.oracle.com/technetwork/articles/dsl/php-web-auditing-171451.html">http://www.oracle.com/technetwork/articles/dsl/php-web-auditing-171451.html</a></code></p>
</div>
<!-- class="sect1" -->
<a id="CHDCGEBE"></a>
<div id="TDPPH191" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">More Uses of Metadata</h2>
<p>The Oracle Database administration pane is a simplified view of all the information Oracle database records about connections and statement execution. Various standard database administration views such as <code>V$SESSION</code> and <code>V$SQLAREA</code> will also contain the tracing metadata. You can write your own queries or use other tools to present the information.</p>
<p>You can use the client identifier metadata to restrict data access. In Oracle Database you could manually augment each SQL statement to restrict access by testing the client identifier:</p>
<pre>select * from equipment
where sys_context(&#39;userenv&#39;, &#39;client_identifier&#39;) = &#39;admin&#39;;
</pre>
<p>If a web user with another client identifier was logged in, the <code>WHERE</code> condition would evaluate false and no rows would be returned. Only the <code>Administrator</code> would be able to see data.</p>
<p>In the Enterprise Edition of Oracle Database, the Virtual Private Database feature supports creation of policy rules which will automatically restrict access to data. This removes the need for every SQL statement to be modified. The client identifier is also recorded in the audit log when auditing is enabled.</p>
<p>When using the client identifier for enforcing security, is a very important to have application code integrity. Is it imperative to ensure that there is no omission or impersonation of the client identifier.</p>
</div>
<!-- class="sect1" -->
<a id="CHDEGBJJ"></a>
<div id="TDPPH192" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Metadata and Persistent Connections</h2>
<p>The AnyCo application uses PHP OCI8 persistent connections that are kept open even when the PHP processes are not processing scripts. The metadata values are not reset after a user script and they are visible in the Session screen when the PHP process and the database connection are idle. Also the current values will remain in effect if any subsequent <code>oci_pconnect()</code> handled by the PHP process does not explicitly set them again.</p>
<p>Using non-persistent connections, calls to <code>oci_connect()</code> or <code>oci_new_connect()</code> won&#39;t have this behavior, since those connections are always closed after each PHP script completes.</p>
<p>In a busy system with little idle time, the left-over metadata for persistent connections is generally not an issue. The problem areas for DBAs are busy connections, not idle ones. Not un-setting the metadata gives maximum performance because it avoids a round trip between PHP and the database. This would slow down the whole system so it is not recommended. However, you could forcefully clear the metadata by adding this to the <code>Db</code> destructor:</p>
<pre>        $this-&gt;stid = oci_parse($this-&gt;conn,
                      &#34;begin
                           dbms_session.clear_identifier;
                           dbms_application_info.set_client_info(&#39;&#39;);
                           dbms_application_info.set_module(&#39;&#39;, &#39;&#39;);
                       end;&#34;);
        oci_execute($this-&gt;stid);
</pre>
<p>If you try this, first restart the web server to close all existing PHP persistent database connections.</p>
<p>No solution is perfect. If the PHP process crashes it won&#39;t be able to clear the values or notify the database to close a non-persistent connection.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4949">
<tr>
<td class="cellalignment4956">
<table class="cellalignment4954">
<tr>
<td class="cellalignment4953"><a href="ch_twelve_blobs.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4953"><a href="ch_fourteen_global.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2010, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4958">
<table class="cellalignment4952">
<tr>
<td class="cellalignment4953"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4953"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4953"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4953"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4953"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4953"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>