<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104427"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Other%20Oracle%20Streams%20Management%20Tasks"></a><title>Other Oracle Streams Management Tasks</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:7Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="strms_change_table.htm" title="Previous" type="text/html"/>
<link rel="Next" href="pt_mon.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">30/57</span> <!-- End Header -->
<div id="STRMS013" class="chapter"><a id="g1013262"></a> <a id="BABEJCJG"></a>
<h1 class="chapter"><span class="secnum">21</span> Other Oracle Streams Management Tasks</h1>
<p>This chapter provides instructions for performing full database export/import in an Oracle Streams environment. This chapter also provides instructions for removing an Oracle Streams configuration.</p>
<p>The following topics describe Oracle Streams management tasks:</p>
<ul>
<li>
<p><a href="#i1007395">Performing Full Database Export/Import in an Oracle Streams Environment</a></p>
</li>
<li>
<p><a href="#i1009910">Removing an Oracle Streams Configuration</a></p>
</li>
</ul>
<p>Each task described in this chapter should be completed by an Oracle Streams administrator that has been granted the appropriate privileges, unless specified otherwise.</p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<a class="olink STREP200" href="../STREP/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about creating an Oracle Streams administrator</div>
<a id="i1007395"></a>
<div id="STRMS125" class="sect1">
<h2 class="sect1">Performing Full Database Export/Import in an Oracle Streams Environment<a id="sthref982"></a><a id="sthref983"></a><a id="sthref984"></a><a id="sthref985"></a></h2>
<p>This section describes how to perform a full database export/import on a database that is running one or more Oracle Streams <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es, <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s, or <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>es. These instructions pertain to a full database export/import where the import database and export database are running on different computers, and the import database replaces the export database. The global name of the import database and the global name of the export database must match. These instructions assume that both databases already exist.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you want to add a database to an existing Oracle Streams environment, then do not use the instructions in this section. Instead, see <a class="olink STREP007" href="../STREP/config_flex.htm#STREP007"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP012" href="../STREP/instant.htm#STREP012"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about export/import parameters that are relevant to Oracle Streams</p>
</li>
<li>
<p><a class="olink SUTIL" href="../SUTIL/toc.htm"><span class="italic">Oracle Database Utilities</span></a> for more information about performing a full database export/import</p>
</li>
</ul>
</div>
<p>Complete the following steps to perform a full database export/import on a database that is using Oracle Streams:</p>
<a id="i1007429"></a>
<ol>
<li id="BABHCBJA">
<p>If the export database contains any <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a>s for <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s from other databases, then stop each propagation that propagates <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s to the export database. You can stop a propagation using the <code dir="ltr">STOP_PROPAGATION</code> procedure in the <code dir="ltr">DBMS_PROPAGATION_ADM</code> package.</p>
</li>
<li>
<p>Make the necessary changes to your network configuration so that the database links used by the <a href="strms_glossary.htm#CHDHGEHC"><span class="xrefglossterm">propagation job</span></a>s you disabled in Step <a href="#BABHCBJA">1</a> point to the computer running the import database.</p>
<p>To complete this step, you might need to re-create the database links used by these propagation jobs or modify your Oracle networking files at the databases that contain the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a>s.</p>
</li>
<li id="i1007436">
<p>Notify all users to stop making data manipulation language (DML) and data definition language (DDL) changes to the export database, and wait until these changes have stopped.</p>
</li>
<li id="i1007438">
<p>Make a note of the current export database system change number (SCN). You can determine the current SCN using the <code dir="ltr">GET_SYSTEM_CHANGE_NUMBER</code> function in the <code dir="ltr">DBMS_FLASHBACK</code> package. For example:</p>
<pre dir="ltr">SET SERVEROUTPUT ON SIZE 1000000
DECLARE
  current_scn NUMBER;
BEGIN
  current_scn:= DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER;
      DBMS_OUTPUT.PUT_LINE(&#39;Current SCN: &#39; || current_scn);
END;
/
</pre>
<p>In this example, assume that current SCN returned is <code dir="ltr">7000000</code>.</p>
<p>After completing this step, do not stop any <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> running on the export database. A later step in this procedure instructs you to use the <code dir="ltr">V$STREAMS_CAPTURE</code> dynamic performance view to ensure that no DML or DDL changes were made to the database after Step <a href="#i1007436">3</a>. The information about a capture process in this view is reset if the capture process is stopped and restarted.</p>
<p>For the check in the later step to be valid, this information should not be reset for any capture process. To prevent a capture process from stopping automatically, you might need to set the <code dir="ltr">message_limit</code> and <code dir="ltr">time_limit</code> capture process parameters to <code dir="ltr">INFINITE</code> if these parameters are set to another value for any capture process.</p>
</li>
<li>
<p>If any <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a>es are capturing changes that originated at the export database, then ensure that the log file containing the SCN determined in Step <a href="#i1007438">4</a> has been transferred to the <a href="strms_glossary.htm#CHDBJECA"><span class="xrefglossterm">downstream database</span></a> and added to the capture process session. See <a href="strms_cpmon.htm#i1012129">&#34;Displaying the Registered Redo Log Files for Each Capture Process&#34;</a> for queries that can determine this information.</p>
</li>
<li id="i1007451">
<p>If the export database is not running any apply processes, and is not propagating messages, then start the full database export now. Ensure that the <code dir="ltr">FULL</code> export parameter is set to <code dir="ltr">y</code> so that the required Oracle Streams metadata is exported.</p>
<p>If the export database is running one or more apply processes or is propagating messages, then do not start the export and proceed to the next step.</p>
</li>
<li id="i1010758">
<p>If the export database is the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> for changes captured by any capture processes, then complete the following steps for each capture process:</p>
<ol>
<li>
<p>Wait until the capture process has scanned past the redo record that corresponds to the SCN determined in Step <a href="#i1007438">4</a>. You can view the SCN of the redo record last scanned by a capture process by querying the <code dir="ltr">CAPTURE_MESSAGE_NUMBER</code> column in the <code dir="ltr">V$STREAMS_CAPTURE</code> dynamic performance view. Ensure that the value of <code dir="ltr">CAPTURE_MESSAGE_NUMBER</code> is greater than or equal to the SCN determined in Step <a href="#i1007438">4</a> before you continue.</p>
</li>
<li>
<p>In SQL*Plus, connect to the database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Monitor the Oracle Streams environment until the apply process at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> has applied all of the changes from the capture database. For example, if the name of the capture process is <code dir="ltr">capture</code>, the name of the apply process is <code dir="ltr">apply</code>, the global name of the destination database is <code dir="ltr">dest.example.com</code>, and the SCN value returned in Step <a href="#i1007438">4</a> is <code dir="ltr">7000000</code>, then run the following query at the capture database:</p>
<pre dir="ltr">SELECT cap.ENQUEUE_MESSAGE_NUMBER
  FROM V$STREAMS_CAPTURE cap
  WHERE cap.CAPTURE_NAME = &#39;CAPTURE&#39; AND
        cap.ENQUEUE_MESSAGE_NUMBER IN (
          SELECT DEQUEUED_MESSAGE_NUMBER
          FROM V$STREAMS_APPLY_READER@dest.example.com reader,
               V$STREAMS_APPLY_COORDINATOR@dest.example.com coord
          WHERE reader.APPLY_NAME = &#39;APPLY&#39; AND
            reader.DEQUEUED_MESSAGE_NUMBER = reader.OLDEST_SCN_NUM AND
            coord.APPLY_NAME = &#39;APPLY&#39; AND
            coord.LWM_MESSAGE_NUMBER = coord.HWM_MESSAGE_NUMBER AND
            coord.APPLY# = reader.APPLY#) AND
          cap.CAPTURE_MESSAGE_NUMBER &gt;= 7000000;
</pre>
<p>When this query returns a row, all of the changes from the capture database have been applied at the destination database, and you can move on to the next step.</p>
<p>If this query returns no results for an inordinately long time, then ensure that the <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>s in the environment are enabled by querying the <code dir="ltr">STATUS</code> column in the <code dir="ltr">DBA_CAPTURE</code> view at the source database and the <code dir="ltr">DBA_APPLY</code> view at the destination database. You can check the status of the propagation by running the query in <a href="strms_qpmon.htm#i1007050">&#34;Displaying Information About the Schedules for Propagation Jobs&#34;</a>.</p>
<p>If an Oracle Streams client is disabled, then try restarting it. If an Oracle Streams client will not restart, then troubleshoot the environment using the information in <a href="strms_trouble.htm#g1021339">Chapter 30, &#34;Identifying Problems in an Oracle Streams Environment&#34;</a>.</p>
<p>The query in this step assumes that a database link accessible to the Oracle Streams administrator exists between the capture database and the destination database. If such a database link does not exist, then you can perform two separate queries at the capture database and destination database.</p>
</li>
<li id="i1010742">
<p>Verify that the enqueue message number of each capture process is less than or equal to the SCN determined in Step <a href="#i1007438">4</a>. You can view the enqueue message number for each capture process by querying the <code dir="ltr">ENQUEUE_MESSAGE_NUMBER</code> column in the <code dir="ltr">V$STREAMS_CAPTURE</code> dynamic performance view.</p>
<p>If the enqueue message number of each capture process is less than or equal to the SCN determined in Step <a href="#i1007438">4</a>, then proceed to Step <a href="#i1010658">9</a>.</p>
<p>However, if the enqueue message number of any capture process is higher than the SCN determined in Step <a href="#i1007438">4</a>, then one or more DML or DDL changes were made after the SCN determined in Step <a href="#i1007438">4</a>, and these changes were captured and enqueued by a capture process. In this case, perform all of the steps in this section again, starting with Step <a href="#BABHCBJA">1</a>.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
For this verification to be valid, each capture process must have been running uninterrupted since Step <a href="#i1007438">4</a>.</div>
</li>
<li id="i1010673">
<p>If any downstream capture processes captured changes that originated at the export database, then drop these downstream capture processes. You will re-create them in a step later in this procedure.</p>
</li>
<li id="i1010658">
<p>If the export database has any propagations that are propagating messages, then stop these propagations using the <code dir="ltr">STOP_PROPAGATION</code> procedure in the <code dir="ltr">DBMS_PROPAGATION</code> package.</p>
</li>
<li>
<p>If the export database is running one or more apply processes, or is propagating messages, then start the full database export now. Ensure that the <code dir="ltr">FULL</code> export parameter is set to <code dir="ltr">y</code> so that the required Oracle Streams metadata is exported. If you already started the export in Step <a href="#i1007451">6</a>, then proceed to Step <a href="#i1007468">11</a>.</p>
</li>
<li id="i1007468">
<p>When the export is complete, transfer the export dump file to the computer running the import database.</p>
</li>
<li id="i1007513">
<p>Perform the full database import. Ensure that the <code dir="ltr">STREAMS_CONFIGURATION</code> and <code dir="ltr">FULL</code> import parameters are both set to <code dir="ltr">y</code> so that the required Oracle Streams metadata is imported. The default setting is <code dir="ltr">y</code> for the <code dir="ltr">STREAMS_CONFIGURATION</code> import parameter. Also, ensure that no DML or DDL changes are made to the import database during the import.</p>
</li>
<li>
<p>If any downstream capture processes are capturing changes that originated at the database, then make the necessary changes so that log files are transferred from the import database to the downstream database. See <a class="olink STREP209" href="../STREP/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li id="i1011043">
<p>Re-create downstream capture processes:</p>
<a id="i1011045"></a>
<ol>
<li id="BABJIIFF">
<p>Re-create any downstream capture processes that you dropped in Step <a href="#i1010673">8</a>, if necessary. These dropped downstream capture processes were capturing changes that originated at the export database. Configure the re-created downstream capture processes to capture changes that originate at the import database.</p>
</li>
<li>
<p>Re-create in the import database any downstream capture processes that were running in the export database, if necessary. If the export database had any downstream capture processes, then those downstream capture processes were not exported.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STREP209" href="../STREP/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about configuring a capture process</div>
</li>
<li>
<p>If any local or downstream capture processes will capture changes that originate at the database, then, at the import database, prepare the database objects whose changes will be captured for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a>. See <a class="olink STREP114" href="../STREP/instant.htm#STREP114"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about preparing database objects for instantiation.</p>
</li>
<li>
<p>Let users access the import database, and shut down the export database.</p>
</li>
<li>
<p>Enable any propagation jobs you disabled in Steps <a href="#BABHCBJA">1</a> and <a href="#i1010658">9</a>.</p>
</li>
<li>
<p>If you reset the value of a <code dir="ltr">message_limit</code> or <code dir="ltr">time_limit</code> capture process parameter in Step <a href="#i1007438">4</a>, then, at the import database, reset these parameters to their original settings.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1009910"></a>
<div id="STRMS845" class="sect1">
<h2 class="sect1">Removing an Oracle Streams Configuration</h2>
<p>You run the <code dir="ltr">REMOVE_STREAMS_CONFIGURATION</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to remove an Oracle Streams configuration at the local database.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Running this procedure is dangerous. You should run this procedure only if you are sure you want to remove the entire Oracle Streams configuration at a database.</div>
<p>To remove the Oracle Streams configuration at the local database, run the following procedure while connected to the database as the Oracle Streams administrator:</p>
<pre dir="ltr">EXEC DBMS_STREAMS_ADM.REMOVE_STREAMS_CONFIGURATION();
</pre>
<p>After running this procedure, drop the Oracle Streams administrator at the database, if possible.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS508" href="../ARPLS/d_streams_adm.htm#ARPLS508"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information about the actions performed by the <code dir="ltr">REMOVE_STREAMS_CONFIGURATION</code> procedure</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="strms_change_table.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="pt_mon.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>