<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104442"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Advanced%20Queue%20Concepts"></a><title>Advanced Queue Concepts</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:6Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="strms_adcapture.htm" title="Previous" type="text/html"/>
<link rel="Next" href="strms_adprop.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">16/57</span> <!-- End Header -->
<div id="STRMS484" class="chapter"><a id="BABFJFDC"></a>
<h1 class="chapter"><span class="secnum">8</span> Advanced Queue Concepts</h1>
<p><a id="sthref421"></a>The following topics contain conceptual information about staging <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s in <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>s and propagating messages from one queue to another:</p>
<ul>
<li>
<p><a href="#i1006985">Secure Queues</a></p>
</li>
<li>
<p><a href="#i1007037">Transactional and Nontransactional Queues</a></p>
</li>
<li>
<p><a href="#CHDEIIEI">Commit-Time Queues</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_prop.htm#i1006210">&#34;Message Propagation Between Queues&#34;</a></p>
</li>
<li>
<p><a href="strms_mprop.htm#i1006123">&#34;Managing Queues&#34;</a></p>
</li>
<li>
<p><a href="ap_restrictions.htm#BABIEJDI">&#34;Queue Restrictions&#34;</a></p>
</li>
</ul>
</div>
<a id="i1006985"></a>
<div id="STRMS141" class="sect1">
<h2 class="sect1">Secure Queues<a id="sthref422"></a><a id="sthref423"></a><a id="sthref424"></a></h2>
<p><span class="bold">Secure queues</span> are <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>s for which Oracle Database Advanced Queuing (AQ) agents must be associated explicitly with one or more database users who can perform queue operations, such as enqueue and dequeue. The owner of a secure queue can perform all queue operations on the queue, but other users cannot perform queue operations on a secure queue, unless they are configured as <span class="bold">secure queue users</span>. In Oracle Streams, you can use secure queues to ensure that only the appropriate users and <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>s enqueue <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s and dequeue messages.</p>
<div id="STRMS485" class="sect2"><a id="sthref425"></a>
<h3 class="sect2">Secure Queues and the SET_UP_QUEUE Procedure</h3>
<p>All <code dir="ltr">ANYDATA</code> queues created using the <code dir="ltr">SET_UP_QUEUE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package are secure queues. When you use the <code dir="ltr">SET_UP_QUEUE</code> procedure to create a queue, any user specified by the <code dir="ltr">queue_user</code> parameter is configured as a secure queue user of the queue automatically, if possible. The queue user is also granted <code dir="ltr">ENQUEUE</code> and <code dir="ltr">DEQUEUE</code> privileges on the queue. To enqueue messages and dequeue messages, a queue user must also have <code dir="ltr">EXECUTE</code> privilege on the <code dir="ltr">DBMS_STREAMS_MESSAGING</code> package or the <code dir="ltr">DBMS_AQ</code> package. The <code dir="ltr">SET_UP_QUEUE</code> procedure does not grant either of these privileges. Also, a message cannot be enqueued unless a subscriber who can dequeue the message is configured.</p>
<p>To configure a queue user as a secure queue user, the <code dir="ltr">SET_UP_QUEUE</code> procedure creates an Oracle Streams AQ agent with the same name as the user name, if one does not already exist. The user must use this agent to perform queue operations on the queue. If an agent with this name already exists and is associated with the queue user only, then the existing agent is used. <code dir="ltr">SET_UP_QUEUE</code> then runs the <code dir="ltr">ENABLE_DB_ACCESS</code> procedure in the <code dir="ltr">DBMS_AQADM</code> package, specifying the agent and the user.</p>
<p>If you use the <code dir="ltr">SET_UP_QUEUE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create a secure queue, and you want a user who is not the queue owner and who was not specified by the <code dir="ltr">queue_user</code> parameter to perform operations on the queue, then you can configure the user as a secure queue user of the queue manually. Alternatively, you can run the <code dir="ltr">SET_UP_QUEUE</code> procedure again and specify a different <code dir="ltr">queue_user</code> for the queue. In this case, <code dir="ltr">SET_UP_QUEUE</code> skips queue creation, but it configures the user specified by <code dir="ltr">queue_user</code> as a secure queue user of the queue.</p>
<p>If you create an <code dir="ltr">ANYDATA</code> queue using the <code dir="ltr">DBMS_AQADM</code> package, then you use the <code dir="ltr">secure</code> parameter when you run the <code dir="ltr">CREATE_QUEUE_TABLE</code> procedure to specify whether the queue is secure or not. The queue is secure if you specify <code dir="ltr">TRUE</code> for the <code dir="ltr">secure</code> parameter when you run this procedure. When you use the <code dir="ltr">DBMS_AQADM</code> package to create a secure queue, and you want to allow users to perform queue operations on the secure queue, you must configure these secure queue users manually.</p>
</div>
<!-- class="sect2" -->
<div id="STRMS486" class="sect2"><a id="sthref426"></a>
<h3 class="sect2">Secure Queues and Oracle Streams Clients<a id="sthref427"></a><a id="sthref428"></a><a id="sthref429"></a><a id="sthref430"></a><a id="sthref431"></a></h3>
<p>When you create a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> or an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>, an Oracle Streams AQ agent of the secure queue associated with the Oracle Streams process is configured automatically, and the user who runs the Oracle Streams process is specified as a secure queue user for this queue automatically. Therefore, a capture process is configured to enqueue into its secure queue automatically, and an apply process is configured to dequeue from its secure queue automatically. In either case, the Oracle Streams AQ agent has the same name as the Oracle Streams client.</p>
<p>For a capture process, the user specified as the <code dir="ltr">capture_user</code> is the user who runs the capture process. For an apply process, the user specified as the <code dir="ltr">apply_user</code> is the user who runs the apply process. If no <code dir="ltr">capture_user</code> or <code dir="ltr">apply_user</code> is specified, then the user who invokes the procedure that creates the Oracle Streams process is the user who runs the Oracle Streams process.</p>
<p>When you create a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>, an Oracle Streams AQ agent of the secure queue with the same name as the synchronous capture is associated with the user specified as the <code dir="ltr">capture_user</code>. If no <code dir="ltr">capture_user</code> is specified, then the user who invokes the procedure that creates the synchronous capture is the <code dir="ltr">capture_user</code>. The <code dir="ltr">capture_user</code> is specified as a secure queue user for this queue automatically. Therefore, the synchronous capture can enqueue into its secure queue automatically.</p>
<p>If you change the <code dir="ltr">capture_user</code> for a capture process or synchronous capture or the <code dir="ltr">apply_user</code> for an apply process, then the specified <code dir="ltr">capture_user</code> or <code dir="ltr">apply_user</code> is configured as a secure queue user of the queue used by the Oracle Streams client. However, the old <a href="strms_glossary.htm#CBAEBCEE"><span class="xrefglossterm">capture user</span></a> or <a href="strms_glossary.htm#CHDGCCIF"><span class="xrefglossterm">apply user</span></a> remains configured as a secure queue user of the queue. To remove the old user, run the <code dir="ltr">DISABLE_DB_ACCESS</code> procedure in the <code dir="ltr">DBMS_AQADM</code> package, specifying the old user and the relevant Oracle Streams AQ agent. You might also want to drop the agent if it is no longer needed. You can view the Oracle Streams AQ agents and their associated users by querying the <code dir="ltr">DBA_AQ_AGENT_PRIVS</code> data dictionary view.</p>
<p>When you create a <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a>, an Oracle Streams AQ agent of the secure queue with the same name as the messaging client is associated with the user who runs the procedure that creates the messaging client. This messaging client user is specified as a secure queue user for this queue automatically. Therefore, this user can use the messaging client to dequeue messages from the queue.</p>
<p>A capture process, a synchronous capture, an apply process, or a messaging client can be associated with only one user. However, one user can be associated with multiple Oracle Streams clients, including multiple capture processes, synchronous captures, apply processes, and messaging clients. For example, an apply process cannot have both <code dir="ltr">hr</code> and <code dir="ltr">oe</code> as apply users, but <code dir="ltr">hr</code> can be the apply user for multiple apply processes.</p>
<p>If you drop a capture process, synchronous capture, apply process, or messaging client, then the users who were configured as secure queue users for these Oracle Streams clients remain secure queue users of the queue. To remove these users as secure queue users, run the <code dir="ltr">DISABLE_DB_ACCESS</code> procedure in the <code dir="ltr">DBMS_AQADM</code> package for each user. You might also want to drop the agent if it is no longer needed.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
No configuration is necessary for <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s and secure queues. Therefore, when a propagation is dropped, no additional steps are necessary to remove secure queue users from the propagation&#39;s queues.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_mprop.htm#i1006228">&#34;Enabling a User to Perform Operations on a Secure Queue&#34;</a></p>
</li>
<li>
<p><a href="strms_mprop.htm#i1006289">&#34;Disabling a User from Performing Operations on a Secure Queue&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS" href="../ARPLS/toc.htm"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about Oracle Streams AQ agents and using the <code dir="ltr">DBMS_AQADM</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1007037"></a>
<div id="STRMS149" class="sect1">
<h2 class="sect1">Transactional and Nontransactional Queues<a id="sthref432"></a><a id="sthref433"></a></h2>
<p>A <span class="bold">transactional queue</span> is a <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> in which <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s can be grouped into a set that are applied as one transaction. That is, an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> performs a <code dir="ltr">COMMIT</code> after it applies all the messages in a group. A <span class="bold">nontransactional queue</span> is one in which each message is its own transaction. That is, an apply process performs a <code dir="ltr">COMMIT</code> after each message it applies. In either case, the messages can be <a href="strms_glossary.htm#CHDJDFAD"><span class="xrefglossterm">LCR</span></a>s or <a href="strms_glossary.htm#CHDDIHEC"><span class="xrefglossterm">user message</span></a>s.</p>
<p>The <code dir="ltr">SET_UP_QUEUE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package always creates a transactional queue. The difference between transactional and nontransactional queues is important only for messages that were enqueued by an application, a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>, or an apply process. An apply process always applies <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s in transactions that preserve the transactions executed at the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>.</p>
<p><a href="#g1011905">Table 8-1</a> shows apply process behavior for each type of message and each type of queue.</p>
<div id="STRMS487" class="tblhruleformal">
<p class="titleintable"><a id="sthref434"></a><a id="g1011905"></a>Table 8-1 Apply Process Behavior for Transactional and Nontransactional Queues</p>
<table class="cellalignment5973" title="Apply Process Behavior for Transactional and Nontransactional Queues" summary="This table lists the behavior of transactional and nontransactional queues for different event types." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t5">Message Type</th>
<th class="cellalignment5974" id="r1c2-t5">Transactional Queue</th>
<th class="cellalignment5974" id="r1c3-t5">Nontransactional Queue</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t5" headers="r1c1-t5">
<p>Captured LCRs</p>
</td>
<td class="cellalignment5970" headers="r2c1-t5 r1c2-t5">
<p>Apply process preserves the original transaction.</p>
</td>
<td class="cellalignment5970" headers="r2c1-t5 r1c3-t5">
<p>Apply process preserves the original transaction.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t5" headers="r1c1-t5">
<p>Persistent LCRs or Persistent User Messages</p>
</td>
<td class="cellalignment5970" headers="r3c1-t5 r1c2-t5">
<p>Apply process applies a user-specified group of messages as one transaction.</p>
</td>
<td class="cellalignment5970" headers="r3c1-t5 r1c3-t5">
<p>Apply process applies each message in its own transaction.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformal" -->
<p>When it is important to preserve the transactions executed at the source database, use transactional queues to store the messages. Ensure that LCRs captured by synchronous captures are stored in transactional queues.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_mprop.htm#i1006123">&#34;Managing Queues&#34;</a></p>
</li>
<li>
<p><a class="olink ADQUE" href="../ADQUE/toc.htm"><span class="italic">Oracle Database Advanced Queuing User&#39;s Guide</span></a> for more information about message grouping</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDEIIEI"></a>
<div id="STRMS148" class="sect1">
<h2 class="sect1">Commit-Time Queues<a id="sthref435"></a></h2>
<p>You can control the order in which <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s in a <a href="strms_glossary.htm#CBAEIBGJ"><span class="xrefglossterm">persistent queue</span></a> are browsed or dequeued. Message ordering in a queue is determined by its <a href="strms_glossary.htm#CHDFFJJB"><span class="xrefglossterm">queue table</span></a>, and you can specify message ordering for a queue table during queue table creation. Specifically, the <code dir="ltr">sort_list</code> parameter in the <code dir="ltr">DBMS_AQADM.CREATE_QUEUE_TABLE</code> procedure determines how messages are ordered. Each message in a <span class="bold">commit-time queue</span> is ordered by an <a href="strms_glossary.htm#CBABBBHH"><span class="xrefglossterm">approximate commit system change number (approximate CSCN)</span></a>, which is obtained when the transaction that enqueued each message commits.</p>
<p>Commit-time ordering is specified for a queue table, and queues that use the queue table are called commit-time queues. When <code dir="ltr">commit_time</code> is specified for the <code dir="ltr">sort_list</code> parameter in the <code dir="ltr">DBMS_AQADM.CREATE_QUEUE_TABLE</code> procedure, the resulting queue table uses commit-time ordering.</p>
<p>For Oracle Database 10<span class="italic">g</span> Release&nbsp;2 and later, the default <code dir="ltr">sort_list</code> setting for queue tables created by the <code dir="ltr">SET_UP_QUEUE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package is <code dir="ltr">commit_time</code>. For releases before Oracle Database 10<span class="italic">g</span> Release&nbsp;2, the default is <code dir="ltr">enq_time</code>, which is described in the section that follows. When the <code dir="ltr">queue_table</code> parameter in the <code dir="ltr">SET_UP_QUEUE</code> procedure specifies an existing queue table, message ordering in the queue created by <code dir="ltr">SET_UP_QUEUE</code> is determined by the existing queue table.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
A <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> always enqueues into a commit-time queue to ensure that transactions are ordered properly.</div>
<div id="STRMS488" class="sect2"><a id="sthref436"></a>
<h3 class="sect2">When to Use Commit-Time Queues<a id="sthref437"></a><a id="sthref438"></a></h3>
<p>A user or application can share information by enqueuing messages into a <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> in an Oracle database. The enqueued messages can be shared within a single database or propagated to other databases, and the messages can be <a href="strms_glossary.htm#CHDJDFAD"><span class="xrefglossterm">LCR</span></a>s or <a href="strms_glossary.htm#CHDDIHEC"><span class="xrefglossterm">user message</span></a>s. For example, messages can be enqueued when an application-specific message occurs or when a trigger is fired for a database change. Also, in a heterogeneous environment, an application can enqueue at an Oracle database messages that originated at a non-Oracle database.</p>
<p>Other than <code dir="ltr">commit_time</code>, the settings for the <code dir="ltr">sort_list</code> parameter in the <code dir="ltr">CREATE_QUEUE_TABLE</code> procedure are <code dir="ltr">priority</code> and <code dir="ltr">enq&shy;_time</code>. The <code dir="ltr">priority</code> setting orders messages by the priority specified during enqueue, highest priority to lowest priority. The <code dir="ltr">enq_time</code> setting orders messages by the time when they were enqueued, oldest to newest.</p>
<p>Commit-time queues are useful when an environment must support either of the following requirements for concurrent enqueues of <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s:</p>
<ul>
<li>
<p><a href="#CHDFJAFF">Transactional Dependency Ordering During Dequeue</a></p>
</li>
<li>
<p><a href="#CHDIEGCG">Consistent Browse of Messages in a Queue</a></p>
</li>
</ul>
<p>Commit-time queues support these requirements. Neither priority nor enqueue time ordering supports these requirements because both allow transactional dependency violations and inconsistent browses. Both settings allow transactional dependency violations, because messages are dequeued independent of the original dependencies. Also, both settings allow inconsistent browses of the messages in a queue, because multiple browses performed without any dequeue operations between them can result in different sets of messages.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_prop.htm#i1006125">&#34;Introduction to Message Staging and Propagation&#34;</a></p>
</li>
<li>
<p><a href="strms_prop.htm#i1006210">&#34;Message Propagation Between Queues&#34;</a></p>
</li>
<li>
<p><a class="olink STREP006" href="../STREP/hetero.htm#STREP006"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about <a href="strms_glossary.htm#CBABDCHG"><span class="xrefglossterm">heterogeneous information sharing</span></a></p>
</li>
</ul>
</div>
<a id="CHDFJAFF"></a>
<div id="STRMS489" class="sect3">
<h4 class="sect3">Transactional Dependency Ordering During Dequeue</h4>
<p>A transactional dependency occurs when one database transaction requires that another database transaction commits before it can commit successfully. Messages that contain information about database transactions can be enqueued. For example, a database trigger can fire to enqueue messages. <a href="#CHDBBBIJ">Figure 8-1</a> shows how enqueue time ordering does not support transactional dependency ordering during dequeue of such messages.</p>
<div id="STRMS490" class="figure">
<p class="titleinfigure"><a id="CHDBBBIJ"></a>Figure 8-1 Transactional Dependency Violation During Dequeue</p>
<img width="606" height="558" src="img/strms048.gif" alt="Description of Figure 8-1 follows"/><br/>
<a id="sthref439" href="img_text/strms048.htm">Description of &#34;Figure 8-1 Transactional Dependency Violation During Dequeue&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#CHDBBBIJ">Figure 8-1</a> shows how transactional dependency ordering can be violated with enqueue time ordering. The transaction that enqueued message <code dir="ltr">e2</code> was committed before the transaction that enqueued messages <code dir="ltr">e1</code> and <code dir="ltr">e3</code> was committed, and the update in message <code dir="ltr">e3</code> depends on the insert in message <code dir="ltr">e2</code>. So, the correct dequeue order that supports transactional dependencies is <code dir="ltr">e2</code>, <code dir="ltr">e1</code>, <code dir="ltr">e3</code>. However, with enqueue time ordering, <code dir="ltr">e3</code> can be dequeued before <code dir="ltr">e2</code>. Therefore, when <code dir="ltr">e3</code> is dequeued, an error results when an application attempts to apply the change in <code dir="ltr">e3</code> to the <code dir="ltr">hr.employees</code> table. Also, after all three messages are dequeued, a row in the <code dir="ltr">hr.employees</code> table contains the wrong information because the change in <code dir="ltr">e3</code> was not executed.</p>
</div>
<!-- class="sect3" -->
<a id="CHDIEGCG"></a>
<div id="STRMS491" class="sect3">
<h4 class="sect3">Consistent Browse of Messages in a Queue<a id="sthref440"></a></h4>
<p><a href="#CHDBDHBB">Figure 8-2</a> shows how enqueue time ordering does not support consistent browse of messages in a queue.</p>
<div id="STRMS492" class="figure">
<p class="titleinfigure"><a id="CHDBDHBB"></a>Figure 8-2 Inconsistent Browse of Messages in a Queue</p>
<img width="609" height="485" src="img/strms049.gif" alt="Description of Figure 8-2 follows"/><br/>
<a id="sthref441" href="img_text/strms049.htm">Description of &#34;Figure 8-2 Inconsistent Browse of Messages in a Queue&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#CHDBDHBB">Figure 8-2</a> shows that a client browsing messages in a queue is not guaranteed a definite order with enqueue time ordering. Sessions 1 and 2 are concurrent sessions that are enqueuing messages. Session 3 shows two sets of client browses that return the three enqueued messages in different orders. If the client requires deterministic ordering of messages, then the client might fail. For example, the client might perform a browse to initiate a program state, and a subsequent dequeue might return messages in a different order than expected.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="STRMS493" class="sect2"><a id="sthref442"></a>
<h3 class="sect2">How Commit-Time Queues Work<a id="sthref443"></a><a id="sthref444"></a><a id="sthref445"></a><a id="sthref446"></a></h3>
<p>The commit system change number (CSCN) for a message that is enqueued into a <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> is not known until Oracle Database writes the redo record for the commit of the transaction that includes the message to the redo log. The CSCN cannot be recorded when the message is enqueued. Commit-time queues use the current SCN of the database when a transaction is committed as the approximate CSCN for all of the messages in the transaction. The order of messages in a commit-time queue is based on the approximate CSCN of the transaction that enqueued the messages.</p>
<p>In a commit-time queue, messages in a transaction are not visible to dequeue and browse operations until a deterministic order for the messages can be established using the approximate CSCN. When multiple transactions are enqueuing messages concurrently into the same commit-time queue, two or more transactions can commit at nearly the same time, and the commit intervals for these transactions can overlap. In this case, the messages in these transactions are not visible until all of the transactions have committed. At that time, the order of the messages can be determined using the approximate CSCN of each transaction. Dependencies are maintained by using the approximate CSCN for messages rather than the enqueue time. Read consistency for browses is maintained by ensuring that only messages with a fully determined order are visible.</p>
<p>A commit-time queue always maintains transactional dependency ordering for messages that are based on database transactions. However, applications and users can enqueue messages that are not based on database transactions. For these messages, if dependencies exist between transactions, then the application or user must ensure that transactions are committed in the correct order and that the commit intervals of the dependent transactions do not overlap.</p>
<p>The approximate CSCNs of transactions recorded by a commit-time queue might not reflect the actual commit order of these transactions. For example, transaction 1 and transaction 2 can commit at nearly the same time after enqueuing their messages. The approximate CSCN for transaction 1 can be lower than the approximate CSCN for transaction 2, but transaction 1 can take more time to complete the commit than transaction 2. In this case, the actual CSCN for transaction 2 is lower than the actual CSCN for transaction 1.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">sort_list</code> parameter in <code dir="ltr">CREATE_QUEUE_TABLE</code> can be set to the following:
<pre dir="ltr">priority, commit_time
</pre>
<p>In this case, ordering is done by priority first and commit time second. Therefore, this setting does not ensure transactional dependency ordering and browse read consistency for messages with different priorities. However, transactional dependency ordering and browse read consistency are ensured for messages with the same priority.</p>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STREP205" href="../STREP/cprop.htm#STREP205"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about creating a commit-time queue</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="strms_adcapture.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="strms_adprop.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>