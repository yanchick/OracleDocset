<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104459"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20Oracle%20Streams%20to%20Record%20Table%20Changes"></a><title>Using Oracle Streams to Record Table Changes</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:7Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="strms_mtransform.htm" title="Previous" type="text/html"/>
<link rel="Next" href="man_advanced.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">29/57</span> <!-- End Header -->
<div id="STRMS1519" class="chapter"><a id="CHDGHDHF"></a>
<h1 class="chapter"><span class="secnum">20</span> Using Oracle Streams to Record Table Changes</h1>
<p><a id="sthref953"></a><a id="sthref954"></a><a id="sthref955"></a>This chapter describes using Oracle Streams to record data manipulation language (DML) changes made to tables.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#CHDBFCCD">About Using Oracle Streams to Record Changes to Tables</a></p>
</li>
<li>
<p><a href="#CHDGBJHE">Preparing for an Oracle Streams Environment That Records Table Changes</a></p>
</li>
<li>
<p><a href="#CHDIEAJJ">Configuring an Oracle Streams Environment That Records Table Changes</a></p>
</li>
<li>
<p><a href="#CHDIEIIH">Managing an Oracle Streams Environment That Records Table Changes</a></p>
</li>
<li>
<p><a href="#CHDCEHBI">Monitoring an Oracle Streams Environment That Records Table Changes</a></p>
</li>
</ul>
<a id="CHDBFCCD"></a>
<div id="STRMS1520" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">About Using Oracle Streams to Record Changes to Tables<a id="sthref956"></a><a id="sthref957"></a></h2>
<p>Oracle Streams can record information about the changes made to database tables, including information about inserts, updates, and deletes. The table for which changes are recorded is called the <span class="bold">source table</span>, and the information about the recorded changes is stored in another table called the <span class="bold">change table</span>. Also, the database that contains the source table is called the <span class="bold">source database</span>, while the database that contains the change table is called the <span class="bold">destination database</span>. The destination database can be the same database as the source database, or it can be a different database.</p>
<p>The recorded information describes the data that was changed in each row because of a DML operation, and metadata about each change. Typically, data warehouse environments record information about table changes, but other types of environments might track table changes as well.</p>
<p>To record table changes in a change table, an Oracle Stream apply process uses a change handler. A <span class="bold">change handler</span> is a special type of <a href="strms_glossary.htm#CHDJIDCH"><span class="xrefglossterm">statement DML handler</span></a> that tracks table changes and was created by either the <code dir="ltr">DBMS_STREAMS_ADM.MAINTAIN_CHANGE_TABLE</code> procedure or the <code dir="ltr">DBMS_APPLY_ADM.SET_CHANGE_HANDLER</code> procedure. This chapter describes using these procedures to create and manage change handlers. Information about change handlers is stored in the <code dir="ltr">ALL_APPLY_CHANGE_HANDLERS</code> and <code dir="ltr">DBA_APPLY_CHANGE_HANDLERS</code> views.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
It is possible to create a statement DML handler that tracks table changes without using the change handler procedures. Such statement DML handlers are not technically considered change handlers, and information about them is not stored in the <code dir="ltr">ALL_APPLY_CHANGE_HANDLERS</code> and <code dir="ltr">DBA_APPLY_CHANGE_HANDLERS</code> views.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_apply.htm#BGBFBIAE">&#34;Statement DML Handlers&#34;</a></p>
</li>
<li>
<p><a href="strms_mapply.htm#BGBFBBBA">&#34;Managing a Statement DML Handler&#34;</a></p>
</li>
<li>
<p><a href="strms_apmon.htm#CACIJBDA">&#34;Displaying Information About Statement DML Handlers&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS72443" href="../ARPLS/d_streams_adm.htm#ARPLS72443"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDGBJHE"></a>
<div id="STRMS1521" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Preparing for an Oracle Streams Environment That Records Table Changes<a id="sthref958"></a><a id="sthref959"></a></h2>
<p>The <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package can configure an Oracle Streams environment that records changes to a source table. This procedure configures all of the required Oracle Streams components. This procedure also enables you to identify the metadata to record for each change. For example, you can choose to record the username of the user who made the change and the time when the change was made, as well as many other types of metadata.</p>
<p>Before you use the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure to configure an Oracle Stream environment that records the changes to a table, you have decisions to make and prerequisites to complete.</p>
<p>The following sections describe the decisions and prerequisites for the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<ul>
<li>
<p><a href="#CHDGIGAA">Decisions to Make Before Running the MAINTAIN_CHANGE_TABLE Procedure</a></p>
</li>
<li>
<p><a href="#CHDCHHBC">Prerequisites for the MAINTAIN_CHANGE _TABLE Procedure</a></p>
</li>
</ul>
<a id="CHDGIGAA"></a>
<div id="STRMS1522" class="sect2">
<h3 class="sect2">Decisions to Make Before Running the MAINTAIN_CHANGE_TABLE Procedure</h3>
<p>The following sections describe the decisions to make before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<ul>
<li>
<p><a href="#CHDJCEAE">Decide Which Type of Environment to Configure</a></p>
</li>
<li>
<p><a href="#CHDJGDEF">Decide Which Columns to Track</a></p>
</li>
<li>
<p><a href="#CHDIDFAC">Decide Which Metadata to Record</a></p>
</li>
<li>
<p><a href="#CHDBJHJA">Decide Which Values to Track for Update Operations</a></p>
</li>
<li>
<p><a href="#CHDGGJFC">Decide Whether to Configure a KEEP_COLUMNS Transformation</a></p>
</li>
<li>
<p><a href="#CHDCJFIB">Decide Whether to Specify CREATE TABLE Options for the Change Table</a></p>
</li>
<li>
<p><a href="#CHDHAJCC">Decide Whether to Perform the Configuration Actions Directly or with a Script</a></p>
</li>
<li>
<p><a href="#CHDJCEJB">Decide Whether to Replicate the Source Table</a></p>
</li>
</ul>
<a id="CHDJCEAE"></a>
<div id="STRMS1523" class="sect3">
<h4 class="sect3">Decide Which Type of Environment to Configure<a id="sthref960"></a></h4>
<p>An Oracle Streams environment that records table changes has the following components:</p>
<ol>
<li>
<p>A <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> captures information about changes to the source table from the redo log. The capture process encapsulates the information for each row change in a <a href="strms_glossary.htm#CHDIGGFF"><span class="xrefglossterm">row logical change record (row LCR)</span></a>. The database where the changes originated is called the source database. The database that contains the capture process is called the capture database.</p>
</li>
<li>
<p>If the source table and change table are on different databases, then a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> sends the captured row LCRs to the database that contains the change table. The propagation is not needed if the source table and change table are in the same database.</p>
</li>
<li>
<p>An <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> records the information in the change table. The apply process uses <a href="strms_glossary.htm#CHDJIDCH"><span class="xrefglossterm">statement DML handler</span></a>s to insert the information in the row LCRs into the change table.</p>
</li>
</ol>
<p>You can configure these components in the following ways:</p>
<ul>
<li>
<p><span class="bold">Local capture and apply on one database:</span> The source table, capture process, apply process, and change table are all in the same database. This option is the easiest to configure and maintain because all of the components are contained in one database.</p>
</li>
<li>
<p><span class="bold">Local capture and remote apply:</span> The source table and capture process are in one database, and the apply process and change table are in another database. A propagation sends row LCRs from the source database to the destination database. This option is best when you want easy configuration and maintenance and when the source table and change table must reside in different databases.</p>
</li>
<li>
<p><span class="bold">Downstream capture and local apply:</span> The source table is in one database, and the capture process, apply process, and change table are in another database. This option is best when you want to optimize the performance of the database with the source table and want to offload change capture to another database. With this option, most of the components run on the database with the change table.</p>
</li>
<li>
<p><span class="bold">Downstream capture and remote apply:</span> The source table is in one database, the apply process and change table are in another database, and the capture process is in a third database. This option is best when you want to optimize the performance of both the database with the source table and the database with the change table. With this option, the capture process runs on a third database, and a propagation sends row LCRs from the capture database to the destination database.</p>
</li>
</ul>
<p>The capture database is always the database on which the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure is run. <a href="#CHDEEFBD">Table 20-1</a> describes where to run the procedure to configure each type of environment.</p>
<div id="STRMS1524" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref961"></a><a id="CHDEEFBD"></a>Table 20-1 Configuration Options for MAINTAIN_CHANGE_TABLE</p>
<table class="cellalignment5973" title="Configuration Options for MAINTAIN_CHANGE_TABLE" summary="This table describes each type of environment that records table changes and where to run the MAINTAIN_CHANGE_TABLE procedure to configure the environment." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t4">Type of Environment</th>
<th class="cellalignment5974" id="r1c2-t4">Where to Run MAINTAIN_CHANGE_TABLE</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t4" headers="r1c1-t4">
<p>Local capture and apply on one database</p>
</td>
<td class="cellalignment5970" headers="r2c1-t4 r1c2-t4">
<p>On the source database that contains the source table</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t4" headers="r1c1-t4">
<p>Local capture and remote apply</p>
</td>
<td class="cellalignment5970" headers="r3c1-t4 r1c2-t4">
<p>On the source database that contains the source table</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t4" headers="r1c1-t4">
<p>Downstream capture and local apply</p>
</td>
<td class="cellalignment5970" headers="r4c1-t4 r1c2-t4">
<p>On the destination database that does not contain the source table but will contain the change table</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t4" headers="r1c1-t4">
<p>Downstream capture and remote apply</p>
</td>
<td class="cellalignment5970" headers="r5c1-t4 r1c2-t4">
<p>On a third database that does not contain the source table and will not contain the change table</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformalwide" -->
<p>Additional requirements must be met to configure downstream capture. See <a href="strms_capture.htm#CIHDGDEG">&#34;Operational Requirements for Downstream Capture&#34;</a> for information.</p>
<p>If you decide to configure a downstream capture process, then you must decide which type of downstream capture process you want to configure. The following types are available:</p>
<ul>
<li>
<p>A <span class="bold">real-time downstream capture process</span> configuration means that redo transport services at the source database sends redo data to the downstream database, and a remote file server process (RFS) at the downstream database receives the redo data over the network and stores the redo data in the standby redo log.</p>
</li>
<li>
<p>An <span class="bold">archived-log downstream capture process</span> configuration means that archived redo log files from the source database are copied to the downstream database, and the capture process captures changes in these archived redo log files. These log files can be transferred automatically using redo transport services, or they can be transferred manually using a method such as FTP.</p>
</li>
</ul>
<p>The advantage of real-time downstream capture over archived-log downstream capture is that real-time downstream capture reduces the amount of time required to capture changes made at the source database. The time is reduced because the real-time downstream capture process does not need to wait for the redo log file to be archived before it can capture changes from it. You can configure more than one real-time downstream capture process that captures changes from the same source database, but you cannot configure real-time downstream capture for multiple source databases at one downstream database.</p>
<p>The advantage of archived-log downstream capture over real-time downstream capture is that archived-log downstream capture allows downstream capture processes for multiple source databases at a downstream database. You can copy redo log files from multiple source databases to a single downstream database and configure multiple archived-log downstream capture processes to capture changes in these redo log files.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#CACGECDI">&#34;Implicit Capture with an Oracle Streams Capture Process&#34;</a></p>
</li>
<li>
<p><a href="strms_prop.htm#g1016256">Chapter 3, &#34;Oracle Streams Staging and Propagation&#34;</a></p>
</li>
<li>
<p><a href="strms_apply.htm#BABFBJDG">&#34;Implicit Consumption with an Apply Process&#34;</a></p>
</li>
<li>
<p><a href="strms_apply.htm#BGBFBIAE">&#34;Statement DML Handlers&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDJGDEF"></a>
<div id="STRMS1525" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Decide Which Columns to Track</h4>
<p>The <code dir="ltr">column_type_list</code> parameter in the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure enables you to specify which columns to track in the change table. The Oracle Streams environment records changes for the listed columns only. To track all of the columns in the table, list all of the columns in this parameter. To track a subset of columns, list the columns to track. In the <code dir="ltr">column_type_list</code> parameter, you can specify the data type of the column and any valid column properties, such as inline constraint specifications.</p>
<p>You might choose to omit columns from the list for various reasons. For example, some columns might contain sensitive information, such as salary data, that you do not want to populate in the change table. Or, the table might contain hundreds of columns, and you might be interested in tracking only a small number of them.</p>
</div>
<!-- class="sect3" -->
<a id="CHDIDFAC"></a>
<div id="STRMS1526" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Decide Which Metadata to Record</h4>
<p>The <code dir="ltr">extra_column_list</code> parameter in the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure enables you to specify which metadata to record in the change table. The following types of metadata can be listed in this parameter:</p>
<ul>
<li>
<p><code dir="ltr">value_type</code></p>
</li>
<li>
<p><code dir="ltr">source_database_name</code></p>
</li>
<li>
<p><code dir="ltr">command_type</code></p>
</li>
<li>
<p><code dir="ltr">object_owner</code></p>
</li>
<li>
<p><code dir="ltr">object_name</code></p>
</li>
<li>
<p><code dir="ltr">tag</code></p>
</li>
<li>
<p><code dir="ltr">transaction_id</code></p>
</li>
<li>
<p><code dir="ltr">scn</code></p>
</li>
<li>
<p><code dir="ltr">commit_scn</code></p>
</li>
<li>
<p><code dir="ltr">commit_time</code></p>
</li>
<li>
<p><code dir="ltr">position</code></p>
</li>
<li>
<p><code dir="ltr">compatible</code></p>
</li>
<li>
<p><code dir="ltr">instance_number</code></p>
</li>
<li>
<p><code dir="ltr">message_number</code></p>
</li>
<li>
<p><code dir="ltr">row_text</code></p>
</li>
<li>
<p><code dir="ltr">row_id</code></p>
</li>
<li>
<p><code dir="ltr">serial#</code></p>
</li>
<li>
<p><code dir="ltr">session#</code></p>
</li>
<li>
<p><code dir="ltr">source_time</code></p>
</li>
<li>
<p><code dir="ltr">thread#</code></p>
</li>
<li>
<p><code dir="ltr">tx_name</code></p>
</li>
<li>
<p><code dir="ltr">username</code></p>
</li>
</ul>
<p>In the change table, a dollar sign ($) is appended to the column name for each metadata attribute. For example, the metadata for the <code dir="ltr">command_type</code> attribute is stored in the <code dir="ltr">command_type$</code> column in the change table.</p>
<p>All of these metadata attributes, except for <code dir="ltr">value_type</code> and <code dir="ltr">message_number</code>, are row LCR attributes that can be stored in row LCRs.</p>
<p>The <code dir="ltr">value_type$</code> column in the change table contains either <code dir="ltr">OLD</code> or <code dir="ltr">NEW</code>, depending on whether the column value is the original column value or the new column value, respectively.</p>
<p>The <code dir="ltr">message_number$</code> column in the change table contains the identification number of each row LCR within a transaction. The message number increases incrementally for each row LCR within a transaction and shows the order of the row LCRs within a transaction.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
LCR position is commonly used in XStream configurations.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006190">&#34;Row LCRs&#34;</a></p>
</li>
<li>
<p><a href="strms_capture.htm#CACHIIJF">&#34;Extra Information in LCRs&#34;</a></p>
</li>
<li>
<p><a class="olink XSTRM1101" href="../XSTRM/xstrm_gen_cncpt.htm#XSTRM1101"><span class="italic">Oracle Database XStream Guide</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDBJHJA"></a>
<div id="STRMS1527" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Decide Which Values to Track for Update Operations</h4>
<p>The <code dir="ltr">capture_values</code> parameter in the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure enables you to specify the values to record in the change table for update operations on the source table. When an update operation is performed on a row, the old value for each column is the value before the update operation and the new value is the value after the update operation. You can choose to record old values, new values, or both old and new values.</p>
</div>
<!-- class="sect3" -->
<a id="CHDGGJFC"></a>
<div id="STRMS1528" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Decide Whether to Configure a KEEP_COLUMNS Transformation<a id="sthref962"></a></h4>
<p>The <code dir="ltr">keep_change_columns_only</code> parameter in the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure enables you to specify whether to configure a <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation. The <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation keeps the list of columns specified in the <code dir="ltr">column_type_list</code> parameter in a row LCR. The transformation removes columns that are not in the list from the row LCR.</p>
<p>For example, suppose a table has ten columns, but only three of these columns need to be tracked in a change table. In this case, it is usually more efficient to configure one <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation that keeps the three columns that must be tracked than to configure seven <code dir="ltr">DELETE_COLUMN</code> declarative rule-based transformations that remove the seven columns that should not be tracked.</p>
<p>The <code dir="ltr">keep_change_columns_only</code> parameter is relevant only if you specify a subset of the table columns in the <code dir="ltr">column_type_list</code> parameter. In this case, you might choose to configure the transformation to reduce the amount of information sent over the network or to eliminate sensitive information from row LCRs.</p>
<p>Set the <code dir="ltr">keep_change_columns_only</code> parameter to <code dir="ltr">FALSE</code> when information about columns that are not included in the <code dir="ltr">column_type_list</code> parameter is needed at the destination database. For example, if the <code dir="ltr">execute_lcr</code> parameter is set to <code dir="ltr">TRUE</code> and the configuration will replicate all of the columns in a source table, but the <code dir="ltr">column_type_list</code> parameter includes a subset of these columns, then set the <code dir="ltr">keep_change_columns_only</code> parameter to <code dir="ltr">FALSE</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_transform.htm#CJADBDFH">&#34;Declarative Rule-Based Transformations&#34;</a></p>
</li>
<li>
<p><a href="#CHDJGDEF">&#34;Decide Which Columns to Track&#34;</a></p>
</li>
<li>
<p><a href="#CHDJCEJB">&#34;Decide Whether to Replicate the Source Table&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDCJFIB"></a>
<div id="STRMS1529" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Decide Whether to Specify CREATE TABLE Options for the Change Table</h4>
<p>The <code dir="ltr">options_string</code> parameter in the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure enables you to append a string of options to the <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> statement that creates the change table. The string is appended to the generated <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> statement after the closing parenthesis that defines the columns of the table. The string must be syntactically correct. For example, you can specify a <code dir="ltr">TABLESPACE</code> clause to store the table in a specific tablespace. You can also partition the change table. The advantage of partitioning a change table is that you can truncate a partition using the <code dir="ltr">TRUNCATE</code> <code dir="ltr">PARTITION</code> clause of an <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement instead of deleting rows with a <code dir="ltr">DELETE</code> statement.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SQLRF01402" href="../SQLRF/statements_7002.htm#SQLRF01402"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options</div>
</div>
<!-- class="sect3" -->
<a id="CHDHAJCC"></a>
<div id="STRMS1530" class="sect3">
<h4 class="sect3">Decide Whether to Perform the Configuration Actions Directly or with a Script</h4>
<p>The <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure can configure the Oracle Streams environment directly, or it can generate a script that configures the environment. Using the procedure to configure directly is simpler than running a script, and the environment is configured immediately. However, you might choose to generate a script for the following reasons:</p>
<ul>
<li>
<p>You want to review the actions performed by the procedure before configuring the environment.</p>
</li>
<li>
<p>You want to modify the script to customize the configuration.</p>
</li>
</ul>
<p>For example, you might want an apply process to use apply handlers for customized processing of the changes before applying these changes. In this case, you can use the procedure to generate a script and modify the script to add the apply handlers.</p>
<p>The <code dir="ltr">perform_actions</code> parameter controls whether the procedure configures the environment directly:</p>
<ul>
<li>
<p>To configure the environment directly when you run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure, set the <code dir="ltr">perform_actions</code> parameter to <code dir="ltr">TRUE</code>. The default value for this parameter is <code dir="ltr">TRUE</code>.</p>
</li>
<li>
<p>To generate a configuration script when you run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure, set the <code dir="ltr">perform_actions</code> parameter to <code dir="ltr">FALSE</code>, and use the <code dir="ltr">script_name</code> and <code dir="ltr">script_directory_object</code> parameters to specify the name and location of the configuration script.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="CHDJCEJB"></a>
<div id="STRMS1531" class="sect3">
<h4 class="sect3">Decide Whether to Replicate the Source Table<a id="sthref963"></a></h4>
<p>In addition to a change table, some environments require that the source table is replicated at the destination database. In this case, the source table is on a different database than the change table, and an additional replica of the source table is in the same database as the change table.</p>
<p>For example, consider an Oracle Streams environment that records the changes made the <code dir="ltr">hr.employees</code> table. Assume that the change table is named <code dir="ltr">hr.emp_change_table</code> and that the source table and the change table are on different databases. In this case, the following tables are involved in an Oracle Streams environment that records changes to the <code dir="ltr">hr.employees</code> table.</p>
<ul>
<li>
<p><code dir="ltr">hr.employees</code> table in database 1</p>
</li>
<li>
<p><code dir="ltr">hr.emp_change_table</code> in database 2</p>
</li>
</ul>
<p>The apply process at the destination database has a separate change handler that records changes for each type of operation (insert, update, and delete).</p>
<p>If the Oracle Streams environment also replicates the <code dir="ltr">hr.employees</code> table at database 2, then the following tables are involved:</p>
<ul>
<li>
<p><code dir="ltr">hr.employees</code> table in database 1</p>
</li>
<li>
<p><code dir="ltr">hr.employees</code> table (replica) in database 2</p>
</li>
<li>
<p><code dir="ltr">hr.emp_change_table</code> in database 2</p>
</li>
</ul>
<p>In an environment that replicates the table in addition to recording its changes, an additional change handler is added to the apply process at the destination database for each type of operation (insert, update, and delete). These change handlers execute the row LCRs to apply their changes to the replicated table.</p>
<p>The <code dir="ltr">execute_lcr</code> parameter controls whether the procedure configures replication of the source table:</p>
<ul>
<li>
<p>To configure an Oracle Streams environment that replicates the source table, set the <code dir="ltr">execute_lcr</code> parameter to <code dir="ltr">TRUE</code>.</p>
</li>
<li>
<p>To configure an Oracle Streams environment that does not replicate the source table, set the <code dir="ltr">execute_lcr</code> parameter to <code dir="ltr">FALSE</code>. The default value for this parameter is <code dir="ltr">FALSE</code>.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
When the <code dir="ltr">keep_change_columns_only</code> parameter is set to <code dir="ltr">TRUE</code> and the <code dir="ltr">column_list</code> parameter includes a subset of the columns in the source table, the <code dir="ltr">execute_lcr</code> parameter must be set to <code dir="ltr">FALSE</code>. Apply errors will result if the row LCRs do not contain the column values required to replicate changes.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDGGJFC">&#34;Decide Whether to Configure a KEEP_COLUMNS Transformation&#34;</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDCHHBC"></a>
<div id="STRMS1532" class="sect2">
<h3 class="sect2">Prerequisites for the MAINTAIN_CHANGE _TABLE Procedure<a id="sthref964"></a><a id="sthref965"></a></h3>
<p>The <code dir="ltr">DBMS_STREAMS_ADM</code> package includes procedures that configure replication environments, such as <code dir="ltr">MAINTAIN_GLOBAL</code>, <code dir="ltr">MAINTAIN_SCHEMAS</code>, and <code dir="ltr">MAINTAIN_TABLES</code>. Using the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure is similar to using these other procedures, and many of the prerequisites are the same.</p>
<p>The following sections describe the prerequisites to complete before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<ul>
<li>
<p><a href="#CHDEGGED">Configure an Oracle Streams Administrator on All Databases</a></p>
</li>
<li>
<p><a href="#CHDFJDBA">Configure Network Connectivity and Database Links</a></p>
</li>
<li>
<p><a href="#CHDEFBHD">Ensure That the Source Database Is in ARCHIVELOG Mode</a></p>
</li>
<li>
<p><a href="#CHDGBHCC">Set Initialization Parameters That Are Relevant to Oracle Streams</a></p>
</li>
<li>
<p><a href="#CHDFBJAG">Configure the Oracle Streams Pool</a></p>
</li>
<li>
<p><a href="#CHDCJCJE">Configure Log File Transfer to a Downstream Capture Database</a></p>
</li>
<li>
<p><a href="#CHDHIECD">Configure Standby Redo Logs for Real-Time Downstream Capture</a></p>
</li>
<li>
<p><a href="#CHDJIGCA">Configure the Required Directory Object If You Are Using a Script</a></p>
</li>
<li>
<p><a href="#CHDFGGAJ">Instantiate the Source Table at the Destination Database</a></p>
</li>
</ul>
<p>Many of these prerequisites are described in detail in <a class="olink STREP232" href="../STREP/prep_rep.htm#STREP232"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a>.</p>
<a id="CHDEGGED"></a>
<div id="STRMS1533" class="sect3">
<h4 class="sect3">Configure an Oracle Streams Administrator on All Databases</h4>
<p>Each database in the environment must have an Oracle Streams administrator to configure and manage the Oracle Streams components. See <a class="olink STREP200" href="../STREP/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</div>
<!-- class="sect3" -->
<a id="CHDFJDBA"></a>
<div id="STRMS1534" class="sect3">
<h4 class="sect3">Configure Network Connectivity and Database Links</h4>
<p>Depending on the type of Oracle Streams environment you plan to configure, network connectivity and one or more database links might be required. If the environment will include more than one database, then network connectivity between the databases in the environment is required.</p>
<p>The following database links are required for each type of Oracle Streams environment:</p>
<ul>
<li>
<p><span class="bold">Local capture and apply on one database:</span> No database links are required.</p>
</li>
<li>
<p><span class="bold">Local capture and remote apply:</span> A database link from the source database to the destination database is required.</p>
</li>
<li>
<p><span class="bold">Downstream capture and local apply:</span> The following database links are required:</p>
<ul>
<li>
<p>A database link from the source database to the destination database</p>
</li>
<li>
<p>A database link from the destination database to the source database</p>
</li>
</ul>
</li>
<li>
<p><span class="bold">Downstream capture and remote apply:</span> The following database links are required:</p>
<ul>
<li>
<p>A database link from the source database to the destination database</p>
</li>
<li>
<p>A database link from the source database to the capture database</p>
</li>
<li>
<p>A database link from the capture database to the source database</p>
</li>
<li>
<p>A database link from the capture database to the destination database</p>
</li>
</ul>
</li>
</ul>
<p>See <a class="olink STREP203" href="../STREP/prep_rep.htm#STREP203"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</div>
<!-- class="sect3" -->
<a id="CHDEFBHD"></a>
<div id="STRMS1535" class="sect3">
<h4 class="sect3">Ensure That the Source Database Is in ARCHIVELOG Mode</h4>
<p>The source database that contains the source table must be in <code dir="ltr">ARCHIVELOG</code> mode because an Oracle Streams capture process scans the redo log to capture changes. If you plan to configure a downstream capture process, then the capture database also must be in <code dir="ltr">ARCHIVELOG</code> mode. See <a class="olink ADMIN008" href="../ADMIN/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for more information.</p>
</div>
<!-- class="sect3" -->
<a id="CHDGBHCC"></a>
<div id="STRMS1536" class="sect3">
<h4 class="sect3">Set Initialization Parameters That Are Relevant to Oracle Streams</h4>
<p>Some initialization parameters are important for the configuration, operation, reliability, and performance of an Oracle Streams environment. Set these parameters appropriately for your Oracle Streams environment. See <a class="olink STREP201" href="../STREP/prep_rep.htm#STREP201"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</div>
<!-- class="sect3" -->
<a id="CHDFBJAG"></a>
<div id="STRMS1537" class="sect3">
<h4 class="sect3">Configure the Oracle Streams Pool</h4>
<p>The Oracle Streams pool is a portion of memory in the System Global Area (SGA) that is used by Oracle Streams. Configure your database memory so that there is enough space available in the Oracle Streams pool. See <a class="olink STREP202" href="../STREP/prep_rep.htm#STREP202"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</div>
<!-- class="sect3" -->
<a id="CHDCJCJE"></a>
<div id="STRMS1538" class="sect3">
<h4 class="sect3">Configure Log File Transfer to a Downstream Capture Database</h4>
<p>If you decided to use a local capture process at the source database, then log file transfer is not required. However, if you decided to use downstream capture that uses redo transport services to transfer archived redo log files to the downstream database automatically, then configure log file transfer from the source database to the capture database before configuring the Oracle Streams environment. See <a class="olink STREP211" href="../STREP/prep_rep.htm#STREP211"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDJCEAE">&#34;Decide Which Type of Environment to Configure&#34;</a></div>
</div>
<!-- class="sect3" -->
<a id="CHDHIECD"></a>
<div id="STRMS1539" class="sect3">
<h4 class="sect3">Configure Standby Redo Logs for Real-Time Downstream Capture</h4>
<p>If you decided to use a real-time downstream capture process, then you must configure standby redo logs at the capture database. See <a class="olink STREP251" href="../STREP/prep_rep.htm#STREP251"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDJCEAE">&#34;Decide Which Type of Environment to Configure&#34;</a></div>
</div>
<!-- class="sect3" -->
<a id="CHDJIGCA"></a>
<div id="STRMS1540" class="sect3">
<h4 class="sect3">Configure the Required Directory Object If You Are Using a Script</h4>
<p>If you decided to generate a script with the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure and configure the Oracle Streams environment with the script, then create the directory object that will store the script in the capture database. The capture database is the database on which you will run the procedure. This directory object is not required if you are not generating a script.</p>
<p>A directory object is similar to an alias for a directory on a file system. Each directory object must be created using the SQL statement <code dir="ltr">CREATE</code> <code dir="ltr">DIRECTORY</code>, and the user who invokes the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure must have <code dir="ltr">READ</code> and <code dir="ltr">WRITE</code> privilege on the directory object.</p>
<p>For example, the following statement creates a directory object named <code dir="ltr">db_files_directory</code> that corresponds to the <code dir="ltr">/usr/db_files</code> directory:</p>
<pre dir="ltr">CREATE DIRECTORY db_files_directory AS &#39;/usr/db_files&#39;;
</pre>
<p>The user who creates the directory object automatically has <code dir="ltr">READ</code> and <code dir="ltr">WRITE</code> privilege on the directory object. When you are configuring an Oracle Streams replication environment, typically the Oracle Streams administrator creates the directory object.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CHDHAJCC">&#34;Decide Whether to Perform the Configuration Actions Directly or with a Script&#34;</a></p>
</li>
<li>
<p><a href="#CHDEGGED">&#34;Configure an Oracle Streams Administrator on All Databases&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CHDFGGAJ"></a>
<div id="STRMS1541" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Instantiate the Source Table at the Destination Database</h4>
<p>If you decided to replicate the source table, then instantiate the source table at the destination database. Instantiation is not required if you decided not to replicate the source table.</p>
<p>If instantiation is required because you decided to replicate the source table, then complete the following steps before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<ol>
<li>
<p>Prepare the source table for instantiation.</p>
</li>
<li>
<p>Ensure that the source table and the replica table are consistent.</p>
</li>
<li>
<p>Set the instantiation SCN for the replica table at the destination database.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP012" href="../STREP/instant.htm#STREP012"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for instantiation instructions</p>
</li>
<li>
<p><a href="#CHDJCEJB">&#34;Decide Whether to Replicate the Source Table&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIEAJJ"></a>
<div id="STRMS1542" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Configuring an Oracle Streams Environment That Records Table Changes<a id="sthref966"></a><a id="sthref967"></a></h2>
<p>This section uses examples to illustrate how to configure an Oracle Streams environment that records table changes. Specifically, this section illustrates the four types of Oracle Streams environments that record table changes.</p>
<p>This section includes the following examples:</p>
<ul>
<li>
<p><a href="#CHDBACFG">Recording Table Changes Using Local Capture and Apply on One Database</a></p>
</li>
<li>
<p><a href="#CHDBEFHI">Recording Table Changes Using Local Capture and Remote Apply with Replication</a></p>
</li>
<li>
<p><a href="#CHDHDFED">Recording Table Changes Using Downstream Capture and Local Apply</a></p>
</li>
<li>
<p><a href="#CHDHHHEI">Recording Table Changes Using Downstream Capture and Remote Apply</a></p>
</li>
</ul>
<a id="CHDBACFG"></a>
<div id="STRMS1543" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Recording Table Changes Using Local Capture and Apply on One Database</h3>
<p>This example illustrates how to record the changes to a table using local capture and apply on one database. Specifically, this example records the changes made to the <code dir="ltr">hr.jobs</code> table.</p>
<p>The following table lists the decisions that were made about the Oracle Streams environment configured in this example.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" summary="This table lists the decisions made about the example in this section." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t16">Decision</th>
<th class="cellalignment5974" id="r1c2-t16">Assumption for This Example</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t16" headers="r1c1-t16"><a href="#CHDJCEAE">Decide Which Type of Environment to Configure</a></td>
<td class="cellalignment5970" headers="r2c1-t16 r1c2-t16">This example configures local capture and apply on one database.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t16" headers="r1c1-t16"><a href="#CHDJGDEF">Decide Which Columns to Track</a></td>
<td class="cellalignment5970" headers="r3c1-t16 r1c2-t16">This example tracks all of the columns in the <code dir="ltr">hr.jobs</code> table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t16" headers="r1c1-t16"><a href="#CHDIDFAC">Decide Which Metadata to Record</a></td>
<td class="cellalignment5970" headers="r4c1-t16 r1c2-t16">This example records the <code dir="ltr">command_type</code>, <code dir="ltr">value_type</code> (<code dir="ltr">OLD</code> or <code dir="ltr">NEW</code>), and <code dir="ltr">commit_scn</code> metadata.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t16" headers="r1c1-t16"><a href="#CHDBJHJA">Decide Which Values to Track for Update Operations</a></td>
<td class="cellalignment5970" headers="r5c1-t16 r1c2-t16">This example tracks both the old and new column values when an update is performed on the source table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t16" headers="r1c1-t16"><a href="#CHDGGJFC">Decide Whether to Configure a KEEP_COLUMNS Transformation</a></td>
<td class="cellalignment5970" headers="r6c1-t16 r1c2-t16">This example does not configure a <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t16" headers="r1c1-t16"><a href="#CHDCJFIB">Decide Whether to Specify CREATE TABLE Options for the Change Table</a></td>
<td class="cellalignment5970" headers="r7c1-t16 r1c2-t16">This example does not specify any <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options. The change table is created with the default <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t16" headers="r1c1-t16"><a href="#CHDHAJCC">Decide Whether to Perform the Configuration Actions Directly or with a Script</a></td>
<td class="cellalignment5970" headers="r8c1-t16 r1c2-t16">This example performs the configuration actions directly. It does not use a script.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r9c1-t16" headers="r1c1-t16"><a href="#CHDJCEJB">Decide Whether to Replicate the Source Table</a></td>
<td class="cellalignment5970" headers="r9c1-t16 r1c2-t16">This example does not replicate the source table.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p><a href="#CHDFAHCI">Figure 20-1</a> provides an overview of the Oracle Stream environment created in this example.</p>
<div id="STRMS1627" class="figure">
<p class="titleinfigure"><a id="CHDFAHCI"></a>Figure 20-1 Recording Changes Using Local Capture and Apply on One Database</p>
<img width="468" height="530" src="img/strms065.gif" alt="Description of Figure 20-1 follows"/><br/>
<a id="sthref968" href="img_text/strms065.htm">Description of &#34;Figure 20-1 Recording Changes Using Local Capture and Apply on One Database&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Complete the following steps to configure an Oracle Streams environment that records the changes to a table using local capture and apply on one database:</p>
<ol>
<li>
<p>Complete the required prerequisites before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure. See <a href="#CHDCHHBC">&#34;Prerequisites for the MAINTAIN_CHANGE _TABLE Procedure&#34;</a> for more information.</p>
<p>For this configuration, the following tasks must be completed:</p>
<ul>
<li>
<p>Configure an Oracle Streams administrator on the database. See <a href="#CHDEGGED">&#34;Configure an Oracle Streams Administrator on All Databases&#34;</a>.</p>
</li>
<li>
<p>Ensure that the database is in <code dir="ltr">ARCHIVELOG</code> mode. See <a href="#CHDEFBHD">&#34;Ensure That the Source Database Is in ARCHIVELOG Mode&#34;</a>.</p>
</li>
<li>
<p>Ensure that the initialization parameters are set properly at the database. See <a href="#CHDGBHCC">&#34;Set Initialization Parameters That Are Relevant to Oracle Streams&#34;</a>.</p>
</li>
<li>
<p>Configure the Oracle Streams pool properly at the database. See <a href="#CHDFBJAG">&#34;Configure the Oracle Streams Pool&#34;</a>.</p>
</li>
</ul>
</li>
<li>
<p>Connect to the database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.MAINTAIN_CHANGE_TABLE(
    change_table_name       =&gt; &#39;hr.jobs_change_table&#39;,
    source_table_name       =&gt; &#39;hr.jobs&#39;,
    column_type_list        =&gt; &#39;job_id VARCHAR2(10),
                                job_title VARCHAR2(35),
                                min_salary NUMBER(6),
                                max_salary NUMBER(6)&#39;,
    extra_column_list        =&gt; &#39;command_type,value_type,commit_scn&#39;,
    capture_values           =&gt; &#39;*&#39;,
    keep_change_columns_only =&gt; FALSE);
END;
/
</pre>
<p>This procedure uses the default value for each parameter that is not specified. The <code dir="ltr">keep_change_columns_only</code> parameter is set to <code dir="ltr">FALSE</code> because all of the columns in the <code dir="ltr">hr.jobs</code> table are listed in the <code dir="ltr">column_type_list</code> parameter.</p>
<p>When this procedure completes, the Oracle Streams environment is configured.</p>
<p>If this procedure encounters an error and stops, then see <a class="olink STREP149" href="../STREP/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about either recovering from the error or rolling back the configuration operation by using the <code dir="ltr">DBMS_STREAMS_ADM.RECOVER_OPERATION</code> procedure.</p>
</li>
</ol>
<p>The resulting Oracle Streams environment has the following characteristics:</p>
<ul>
<li>
<p>An unconditional supplemental log group includes all of the columns in the <code dir="ltr">hr.jobs</code> table.</p>
</li>
<li>
<p>The database has an <code dir="ltr">hr.jobs_change_table</code>. This change table has the following definition:</p>
<pre dir="ltr"> Name                                      Null?    Type
 ----------------------------------------- -------- ---------------------------
 COMMAND_TYPE$                                      VARCHAR2(10)
 VALUE_TYPE$                                        VARCHAR2(3)
 COMMIT_SCN$                                        NUMBER
 JOB_ID                                             VARCHAR2(10)
 JOB_TITLE                                          VARCHAR2(35)
 MIN_SALARY                                         NUMBER(6)
 MAX_SALARY                                         NUMBER(6)
</pre></li>
<li>
<p>The database has a queue with a system-generated name. This queue is used by the capture process and apply process.</p>
</li>
<li>
<p>A capture process with a system-generated name captures data manipulation language (DML) changes made to the <code dir="ltr">hr.jobs</code> table.</p>
</li>
<li>
<p>An apply process with a system-generated name. The apply process uses change handlers with system-generated names to process the captured row LCRs for inserts, updates, and deletes on the <code dir="ltr">hr.jobs</code> table. The change handlers use the information in the row LCRs to populate the <code dir="ltr">hr.jobs_change_table</code>.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDBHDHI">&#34;Monitoring a Change Table&#34;</a> for an example that makes changes to the <code dir="ltr">hr.jobs</code> table and then queries the <code dir="ltr">hr.jobs_change_table</code> to verify change tracking</div>
</div>
<!-- class="sect2" -->
<a id="CHDBEFHI"></a>
<div id="STRMS1595" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Recording Table Changes Using Local Capture and Remote Apply with Replication</h3>
<p>This example illustrates how to record the changes to a table using local capture and remote apply. In addition to recording table changes, the Oracle Stream environment configured by this example also replicates the changes made to the table.</p>
<p>Specifically, this example records the changes made to a subset of columns in the <code dir="ltr">hr.departments</code> table. This example also replicates data manipulation language (DML) changes made to all of the columns in the <code dir="ltr">hr.departments</code> table. The Oracle Steams environment configured in this example captures the changes on the source database <code dir="ltr">ct1.example.com</code> and sends the changes to the destination database <code dir="ltr">ct2.example.com</code>. An apply process on <code dir="ltr">ct2.example.com</code> records the changes in a change table and applies the changes to the replica <code dir="ltr">hr.departments</code> table.</p>
<p>The following table lists the decisions that were made about the Oracle Streams environment configured in this example.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" summary="This table lists the decisions made about the example in this section." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t18">Decision</th>
<th class="cellalignment5974" id="r1c2-t18">Assumption for This Example</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t18" headers="r1c1-t18"><a href="#CHDJCEAE">Decide Which Type of Environment to Configure</a></td>
<td class="cellalignment5970" headers="r2c1-t18 r1c2-t18">This example configures local capture and remote apply using two databases: the source database is <code dir="ltr">ct1.example.com</code> and the destination database is <code dir="ltr">ct2.example.com</code>. The capture process will be a local capture process on <code dir="ltr">ct1.example.com</code>.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t18" headers="r1c1-t18"><a href="#CHDJGDEF">Decide Which Columns to Track</a></td>
<td class="cellalignment5970" headers="r3c1-t18 r1c2-t18">This example tracks the <code dir="ltr">department_id</code> and <code dir="ltr">manager_id</code> columns in the <code dir="ltr">hr.departments</code> table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t18" headers="r1c1-t18"><a href="#CHDIDFAC">Decide Which Metadata to Record</a></td>
<td class="cellalignment5970" headers="r4c1-t18 r1c2-t18">This example records the <code dir="ltr">command_type</code> and <code dir="ltr">value_type</code> (<code dir="ltr">OLD</code> or <code dir="ltr">NEW</code>) metadata. This metadata is recorded by default when the <code dir="ltr">extra_column_list</code> parameter is not specified in <code dir="ltr">MAINTAIN_CHANGE_TABLE</code>.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t18" headers="r1c1-t18"><a href="#CHDBJHJA">Decide Which Values to Track for Update Operations</a></td>
<td class="cellalignment5970" headers="r5c1-t18 r1c2-t18">This example tracks both the old and new column values when an update is performed on the source table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t18" headers="r1c1-t18"><a href="#CHDGGJFC">Decide Whether to Configure a KEEP_COLUMNS Transformation</a></td>
<td class="cellalignment5970" headers="r6c1-t18 r1c2-t18">This example does not configure a <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation because all of the table columns are replicated.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t18" headers="r1c1-t18"><a href="#CHDCJFIB">Decide Whether to Specify CREATE TABLE Options for the Change Table</a></td>
<td class="cellalignment5970" headers="r7c1-t18 r1c2-t18">This example does not specify any <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options. The change table is created with the default <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t18" headers="r1c1-t18"><a href="#CHDHAJCC">Decide Whether to Perform the Configuration Actions Directly or with a Script</a></td>
<td class="cellalignment5970" headers="r8c1-t18 r1c2-t18">This example performs the configuration actions directly. It does not use a script.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r9c1-t18" headers="r1c1-t18"><a href="#CHDJCEJB">Decide Whether to Replicate the Source Table</a></td>
<td class="cellalignment5970" headers="r9c1-t18 r1c2-t18">This example replicates the source table at the destination database. Therefore, the <code dir="ltr">hr.departments</code> table exists on both the source database and the destination database, and the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure configures a one-way replication environment for this table from the source database to the destination database.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p><a href="#CHDGIJHF">Figure 20-2</a> provides an overview of the Oracle Stream environment created in this example.</p>
<div id="STRMS1628" class="figure">
<p class="titleinfigure"><a id="CHDGIJHF"></a>Figure 20-2 Recording Changes Using Local Capture and Remote Apply with Replication</p>
<img width="657" height="485" src="img/strms066.gif" alt="Description of Figure 20-2 follows"/><br/>
<a id="sthref969" href="img_text/strms066.htm">Description of &#34;Figure 20-2 Recording Changes Using Local Capture and Remote Apply with Replication&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Complete the following steps to configure an Oracle Streams environment that records and replicates the changes to a table local capture and remote apply:</p>
<ol>
<li>
<p>Complete the required prerequisites before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure. See <a href="#CHDCHHBC">&#34;Prerequisites for the MAINTAIN_CHANGE _TABLE Procedure&#34;</a> for more information.</p>
<p>For this configuration, the following tasks must be completed:</p>
<ul>
<li>
<p>Configure an Oracle Streams administrator on both databases. See <a href="#CHDEGGED">&#34;Configure an Oracle Streams Administrator on All Databases&#34;</a>.</p>
</li>
<li>
<p>Configure network connectivity and database links:</p>
<ul>
<li>
<p>Configure network connectivity between the source database <code dir="ltr">ct1.example.com</code> and the destination database <code dir="ltr">ct2.example.com</code>.</p>
</li>
<li>
<p>Create a database link from the source database <code dir="ltr">ct1.example.com</code> to the destination database <code dir="ltr">ct2.example.com</code>.</p>
</li>
</ul>
<p>See <a class="olink STREP203" href="../STREP/prep_rep.htm#STREP203"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>Ensure that the source database is in <code dir="ltr">ARCHIVELOG</code> mode. In this example, the source database is <code dir="ltr">ct1.example.com</code>. See <a href="#CHDEFBHD">&#34;Ensure That the Source Database Is in ARCHIVELOG Mode&#34;</a>.</p>
</li>
<li>
<p>Ensure that the initialization parameters are set properly at all databases. See <a href="#CHDGBHCC">&#34;Set Initialization Parameters That Are Relevant to Oracle Streams&#34;</a>.</p>
</li>
<li>
<p>Configure the Oracle Streams pool properly at all databases. See <a href="#CHDFBJAG">&#34;Configure the Oracle Streams Pool&#34;</a>.</p>
</li>
<li>
<p>Because this example replicates the source table <code dir="ltr">hr.departments</code>, instantiate the source table at the destination database. See <a href="#CHDFGGAJ">&#34;Instantiate the Source Table at the Destination Database&#34;</a>.</p>
</li>
</ul>
</li>
<li>
<p>Connect to the source database <code dir="ltr">ct1.example.com</code> as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.MAINTAIN_CHANGE_TABLE(
    change_table_name       =&gt; &#39;hr.dep_change_table&#39;,
    source_table_name       =&gt; &#39;hr.departments&#39;,
    column_type_list        =&gt; &#39;department_id NUMBER(4),
                                manager_id NUMBER(6)&#39;,
    capture_values           =&gt; &#39;*&#39;,
    source_database          =&gt; &#39;ct1.example.com&#39;,
    destination_database     =&gt; &#39;ct2.example.com&#39;,
    keep_change_columns_only =&gt; FALSE,
    execute_lcr              =&gt; TRUE);
END;
/
</pre>
<p>This procedure uses the default value for each parameter that is not specified. The <code dir="ltr">keep_change_columns_only</code> parameter is set to <code dir="ltr">FALSE</code> because the <code dir="ltr">execute_lcr</code> parameter is set to <code dir="ltr">TRUE</code>. The row logical change records (LCRs) must contain information about changes to all of the columns in the table because all of the columns are replicated at the destination database. When the <code dir="ltr">execute_lcr</code> parameter is set to <code dir="ltr">TRUE</code>, the <code dir="ltr">keep_change_columns_only</code> parameter can be set to <code dir="ltr">TRUE</code> only if the <code dir="ltr">column_type_list</code> parameter includes all of the columns that are replicated, which is not the case in this example.</p>
<p>When this procedure completes, the Oracle Streams environment is configured.</p>
<p>If this procedure encounters an error and stops, then see <a class="olink STREP149" href="../STREP/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about either recovering from the error or rolling back the configuration operation by using the <code dir="ltr">DBMS_STREAMS_ADM.RECOVER_OPERATION</code> procedure.</p>
</li>
</ol>
<p>The resulting Oracle Streams environment has the following characteristics:</p>
<ul>
<li>
<p>An unconditional supplemental log group includes the columns in the <code dir="ltr">hr.departments</code> table for which changes are recorded at the source database <code dir="ltr">ct1.example.com</code>. These columns are the ones specified in the <code dir="ltr">column_type_list</code> parameter of the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has an <code dir="ltr">hr.dep_change_table</code>. This change table has the following definition:</p>
<pre dir="ltr"> Name                                      Null?    Type
 ----------------------------------------- -------- ---------------------------
 COMMAND_TYPE$                                      VARCHAR2(10)
 VALUE_TYPE$                                        VARCHAR2(3)
 DEPARTMENT_ID                                      NUMBER(4)
 MANAGER_ID                                         NUMBER(6)
</pre></li>
<li>
<p>The source database <code dir="ltr">ct1.example.com</code> has a queue with a system-generated name. This queue is used by the capture process.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has a queue with a system-generated name. This queue is used by the apply process.</p>
</li>
<li>
<p>The source database <code dir="ltr">ct1.example.com</code> has a local capture process with a system-generated name that captures data manipulation language (DML) changes made to the <code dir="ltr">hr.departments</code> table.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has an apply process with a system-generated name. The apply process uses change handlers with system-generated names to process the captured row LCRs for inserts, updates, and deletes on the <code dir="ltr">hr.departments</code> table. The change handlers use the information in the row LCRs to populate the <code dir="ltr">hr.dep_change_table</code>.</p>
<p>The apply process also includes change handlers with system-generated names to execute row LCRs for each type of operation (insert, update, and delete). The row LCRs are executed so that the changes made to the source table are applied to the replica <code dir="ltr">hr.departments</code> table at the destination database.</p>
</li>
<li>
<p>A propagation running on the <code dir="ltr">ct1.example.com</code> database with a system-generated name sends the captured changes from the <code dir="ltr">ct1.example.com</code> database to the <code dir="ltr">ct2.example.com</code> database.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDHDFED"></a>
<div id="STRMS1596" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Recording Table Changes Using Downstream Capture and Local Apply</h3>
<p>This example illustrates how to record the changes to a table using downstream capture and local apply. Specifically, this example records the changes made to the <code dir="ltr">hr.locations</code> table using a source database and a destination database. The destination database is also the capture database for the downstream capture process.</p>
<p>The following table lists the decisions that were made about the Oracle Streams environment configured in this example.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" summary="This table lists the decisions made about the example in this section." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t19">Decision</th>
<th class="cellalignment5974" id="r1c2-t19">Assumption for This Example</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t19" headers="r1c1-t19"><a href="#CHDJCEAE">Decide Which Type of Environment to Configure</a></td>
<td class="cellalignment5970" headers="r2c1-t19 r1c2-t19">This example configures downstream capture and local apply using the source database <code dir="ltr">ct1.example.com</code> and the destination database <code dir="ltr">ct2.example.com</code>. The capture process will be a real-time downstream capture process running on <code dir="ltr">ct2.example.com</code>.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t19" headers="r1c1-t19"><a href="#CHDJGDEF">Decide Which Columns to Track</a></td>
<td class="cellalignment5970" headers="r3c1-t19 r1c2-t19">This example tracks all of the columns in the <code dir="ltr">hr.locations</code> table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t19" headers="r1c1-t19"><a href="#CHDIDFAC">Decide Which Metadata to Record</a></td>
<td class="cellalignment5970" headers="r4c1-t19 r1c2-t19">This example records the following metadata: <code dir="ltr">command_type</code>, <code dir="ltr">value_type</code> (<code dir="ltr">OLD</code> or <code dir="ltr">NEW</code>), <code dir="ltr">object_owner</code>, <code dir="ltr">object_name</code>, and <code dir="ltr">username</code>.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t19" headers="r1c1-t19"><a href="#CHDBJHJA">Decide Which Values to Track for Update Operations</a></td>
<td class="cellalignment5970" headers="r5c1-t19 r1c2-t19">This example tracks both the old and new column values when an update is performed on the source table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t19" headers="r1c1-t19"><a href="#CHDGGJFC">Decide Whether to Configure a KEEP_COLUMNS Transformation</a></td>
<td class="cellalignment5970" headers="r6c1-t19 r1c2-t19">This example does not configure a <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t19" headers="r1c1-t19"><a href="#CHDCJFIB">Decide Whether to Specify CREATE TABLE Options for the Change Table</a></td>
<td class="cellalignment5970" headers="r7c1-t19 r1c2-t19">This example does not specify any <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options. The change table is created with the default <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t19" headers="r1c1-t19"><a href="#CHDHAJCC">Decide Whether to Perform the Configuration Actions Directly or with a Script</a></td>
<td class="cellalignment5970" headers="r8c1-t19 r1c2-t19">This example performs the configuration actions directly. It does not use a script.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r9c1-t19" headers="r1c1-t19"><a href="#CHDJCEJB">Decide Whether to Replicate the Source Table</a></td>
<td class="cellalignment5970" headers="r9c1-t19 r1c2-t19">This example does not replicate the source table.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p><a href="#CHDBAAGH">Figure 20-3</a> provides an overview of the Oracle Stream environment created in this example.</p>
<div id="STRMS1629" class="figure">
<p class="titleinfigure"><a id="CHDBAAGH"></a>Figure 20-3 Recording Changes Using Downstream Capture and Local Apply</p>
<img width="659" height="686" src="img/strms067.png" alt="Description of Figure 20-3 follows"/><br/>
<a id="sthref970" href="img_text/strms067.htm">Description of &#34;Figure 20-3 Recording Changes Using Downstream Capture and Local Apply&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Complete the following steps to configure an Oracle Streams environment that records the changes to a table using downstream capture and remote apply:</p>
<ol>
<li>
<p>Complete the required prerequisites before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure. See <a href="#CHDCHHBC">&#34;Prerequisites for the MAINTAIN_CHANGE _TABLE Procedure&#34;</a> for more information.</p>
<p>For this configuration, the following tasks must be completed:</p>
<ul>
<li>
<p>Configure an Oracle Streams administrator on both databases. See <a href="#CHDEGGED">&#34;Configure an Oracle Streams Administrator on All Databases&#34;</a>.</p>
</li>
<li>
<p>Configure network connectivity and database links:</p>
<ul>
<li>
<p>Configure network connectivity between the source database <code dir="ltr">ct1.example.com</code> and the destination database <code dir="ltr">ct2.example.com</code>.</p>
</li>
<li>
<p>Because downstream capture will be configured at the destination database, create a database link from the source database <code dir="ltr">ct1.example.com</code> to the destination database <code dir="ltr">ct2.example.com</code>. The database link is used to send redo log data from <code dir="ltr">ct1.example.com</code> to <code dir="ltr">ct2.example.com</code>.</p>
</li>
<li>
<p>Because downstream capture will be configured at the destination database, create a database link from the destination database <code dir="ltr">ct2.example.com</code> to the source database <code dir="ltr">ct1.example.com</code>. The database link is used to complete management tasks related to downstream capture on the source database.</p>
</li>
</ul>
<p>See <a class="olink STREP203" href="../STREP/prep_rep.htm#STREP203"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>Ensure that the source database and the destination database are in <code dir="ltr">ARCHIVELOG</code> mode. In this example, the source database is <code dir="ltr">ct1.example.com</code> and the destination database is <code dir="ltr">ct2.example.com</code>. See <a href="#CHDEFBHD">&#34;Ensure That the Source Database Is in ARCHIVELOG Mode&#34;</a>.</p>
</li>
<li>
<p>Ensure that the initialization parameters are set properly at both databases. See <a href="#CHDGBHCC">&#34;Set Initialization Parameters That Are Relevant to Oracle Streams&#34;</a>.</p>
</li>
<li>
<p>Configure the Oracle Streams pool properly at both databases. See <a href="#CHDFBJAG">&#34;Configure the Oracle Streams Pool&#34;</a>.</p>
</li>
<li>
<p>Because a destination database will be the capture database for changes made to the source database, configure log file copying from the source database <code dir="ltr">ct1.example.com</code> to the capture database <code dir="ltr">ct2.example.com</code>. See <a href="#CHDCJCJE">&#34;Configure Log File Transfer to a Downstream Capture Database&#34;</a>.</p>
</li>
<li>
<p>Because this example configures a real-time downstream capture process, add standby redo logs at the capture database, and configure standby redo logs at the capture database <code dir="ltr">ct2.example.com</code>. See <a href="#CHDHIECD">&#34;Configure Standby Redo Logs for Real-Time Downstream Capture&#34;</a>.</p>
</li>
</ul>
</li>
<li>
<p>Connect to the destination database <code dir="ltr">ct2.example.com</code> as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.MAINTAIN_CHANGE_TABLE(
    change_table_name       =&gt; &#39;hr.loc_change_table&#39;,
    source_table_name       =&gt; &#39;hr.locations&#39;,
    column_type_list        =&gt; &#39;location_id NUMBER(4),
                                street_address VARCHAR2(40),
                                postal_code VARCHAR2(12),
                                city VARCHAR2(30),
                                state_province VARCHAR2(25),
                                country_id CHAR(2)&#39;,
    extra_column_list       =&gt; &#39;command_type,value_type,object_owner,
                                object_name,username&#39;,
    capture_values          =&gt; &#39;*&#39;,
    source_database          =&gt; &#39;ct1.example.com&#39;,
    destination_database     =&gt; &#39;ct2.example.com&#39;,
    keep_change_columns_only =&gt; FALSE);
END;
/
</pre>
<p>This procedure uses the default value for each parameter that is not specified. The <code dir="ltr">keep_change_columns_only</code> parameter is set to <code dir="ltr">FALSE</code> because all of the columns in the <code dir="ltr">hr.locations</code> table are listed in the <code dir="ltr">column_type_list</code> parameter.</p>
<p>When this procedure completes, the Oracle Streams environment is configured.</p>
<p>If this procedure encounters an error and stops, then see <a class="olink STREP149" href="../STREP/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about either recovering from the error or rolling back the configuration operation by using the <code dir="ltr">DBMS_STREAMS_ADM.RECOVER_OPERATION</code> procedure.</p>
</li>
<li>
<p>Set the <code dir="ltr">downstream_real_time_mine</code> capture process parameter to <code dir="ltr">Y</code>.</p>
<ol>
<li>
<p>Query the <code dir="ltr">CAPTURE_NAME</code> column in the <code dir="ltr">DBA_CAPTURE</code> view to determine the name of the capture process.</p>
</li>
<li>
<p>Run the <code dir="ltr">SET_PARAMETER</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package to set the <code dir="ltr">downstream_real_time_mine</code> capture process parameter to&nbsp;<code dir="ltr">Y</code>.</p>
<p>For example, if the capture process name is <code dir="ltr">cap$chg5</code>, then run the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.SET_PARAMETER(
    capture_name =&gt; &#39;cap$chg5&#39;,
    parameter    =&gt; &#39;downstream_real_time_mine&#39;,
    value        =&gt; &#39;Y&#39;);
END;
/
</pre></li>
</ol>
</li>
<li>
<p>Connect to the source database <code dir="ltr">ct1.example.com</code> as an administrative user with the necessary privileges to switch log files.</p>
</li>
<li>
<p>Archive the current log file at the source database:</p>
<pre dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre>
<p>Archiving the current log file at the source database starts real time mining of the source database redo log.</p>
</li>
</ol>
<p>The resulting Oracle Streams environment has the following characteristics:</p>
<ul>
<li>
<p>An unconditional supplemental log group at the source database <code dir="ltr">ct1.example.com</code> includes all o the columns in the <code dir="ltr">hr.locations</code> table.</p>
</li>
<li>
<p>Because <code dir="ltr">username</code> is specified in the <code dir="ltr">extra_column_list</code> parameter, the source database is configured to place additional information about the username of the user who makes a change in the redo log. The capture process captures this information, and it is recorded in the change table. The other values specified in the <code dir="ltr">extra_column_list</code> parameter (<code dir="ltr">command_type</code>, <code dir="ltr">value_type</code>, <code dir="ltr">object_owner</code>, and <code dir="ltr">object_name</code>) are always tracked in the redo log. Therefore, no additional configuration is necessary to capture this information.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has an <code dir="ltr">hr.loc_change_table</code>. This change table has the following definition:</p>
<pre dir="ltr"> Name                                      Null?    Type
 ----------------------------------------- -------- ---------------------------
 COMMAND_TYPE$                                      VARCHAR2(10)
 VALUE_TYPE$                                        VARCHAR2(3)
 OBJECT_OWNER$                                      VARCHAR2(30)
 OBJECT_NAME$                                       VARCHAR2(30)
 USERNAME$                                          VARCHAR2(30)
 LOCATION_ID                                        NUMBER(4)
 STREET_ADDRESS                                     VARCHAR2(40)
 POSTAL_CODE                                        VARCHAR2(12)
 CITY                                               VARCHAR2(30)
 STATE_PROVINCE                                     VARCHAR2(25)
 COUNTRY_ID                                         CHAR(2)
</pre></li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has a queue with a system-generated name. This queue is used by the downstream capture process and the apply process.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has a real-time downstream capture process with a system-generated name that captures data manipulation language (DML) changes made to the <code dir="ltr">hr.locations</code> table.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has an apply process with a system-generated name. The apply process uses change handlers with system-generated names to process the captured row LCRs for inserts, updates, and deletes on the <code dir="ltr">hr.locations</code> table. The change handlers use the information in the row LCRs to populate the <code dir="ltr">hr.loc_change_table</code>.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_mcap.htm#i1006402">&#34;Setting a Capture Process Parameter&#34;</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDHHHEI"></a>
<div id="STRMS1544" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Recording Table Changes Using Downstream Capture and Remote Apply</h3>
<p>This example illustrates how to record the changes to a table using downstream capture and remote apply. Specifically, this example records the changes made to the <code dir="ltr">hr.employees</code> table using three databases: the source database, the destination database, and the capture database.</p>
<p>The following table lists the decisions that were made about the Oracle Streams environment configured in this example.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" summary="This table lists the decisions made about the example in this section." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t21">Decision</th>
<th class="cellalignment5974" id="r1c2-t21">Assumption for This Example</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t21" headers="r1c1-t21"><a href="#CHDJCEAE">Decide Which Type of Environment to Configure</a></td>
<td class="cellalignment5970" headers="r2c1-t21 r1c2-t21">This example configures downstream capture and remote apply using three databases: the source database is <code dir="ltr">ct1.example.com</code>, the destination database is <code dir="ltr">ct2.example.com</code>, and the capture database is <code dir="ltr">ct3.example.com</code>. The capture process will be a real-time downstream capture process.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t21" headers="r1c1-t21"><a href="#CHDJGDEF">Decide Which Columns to Track</a></td>
<td class="cellalignment5970" headers="r3c1-t21 r1c2-t21">This example tracks the columns in the <code dir="ltr">hr.employees</code> table, except for the <code dir="ltr">salary</code> and <code dir="ltr">commission_pct</code> columns.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t21" headers="r1c1-t21"><a href="#CHDIDFAC">Decide Which Metadata to Record</a></td>
<td class="cellalignment5970" headers="r4c1-t21 r1c2-t21">This example records the following metadata: <code dir="ltr">command_type</code>, <code dir="ltr">value_type</code> (<code dir="ltr">OLD</code> or <code dir="ltr">NEW</code>), <code dir="ltr">object_owner</code>, <code dir="ltr">object_name</code>, and <code dir="ltr">username</code>.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t21" headers="r1c1-t21"><a href="#CHDBJHJA">Decide Which Values to Track for Update Operations</a></td>
<td class="cellalignment5970" headers="r5c1-t21 r1c2-t21">This example tracks both the old and new column values when an update is performed on the source table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t21" headers="r1c1-t21"><a href="#CHDGGJFC">Decide Whether to Configure a KEEP_COLUMNS Transformation</a></td>
<td class="cellalignment5970" headers="r6c1-t21 r1c2-t21">This example configures a <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation so that row LCRs do not contain salary and commission percentage information for employees.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t21" headers="r1c1-t21"><a href="#CHDCJFIB">Decide Whether to Specify CREATE TABLE Options for the Change Table</a></td>
<td class="cellalignment5970" headers="r7c1-t21 r1c2-t21">This example specifies a <code dir="ltr">STORAGE</code> clause in the <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t21" headers="r1c1-t21"><a href="#CHDHAJCC">Decide Whether to Perform the Configuration Actions Directly or with a Script</a></td>
<td class="cellalignment5970" headers="r8c1-t21 r1c2-t21">This example performs the configuration actions directly. It does not use a script.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r9c1-t21" headers="r1c1-t21"><a href="#CHDJCEJB">Decide Whether to Replicate the Source Table</a></td>
<td class="cellalignment5970" headers="r9c1-t21 r1c2-t21">This example does not replicate the source table.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p><a href="#CHDCCAEE">Figure 20-4</a> provides an overview of the Oracle Stream environment created in this example.</p>
<div id="STRMS1630" class="figure">
<p class="titleinfigure"><a id="CHDCCAEE"></a>Figure 20-4 Recording Changes Using Downstream Capture and Remote Apply</p>
<img width="659" height="795" src="img/strms068.png" alt="Description of Figure 20-4 follows"/><br/>
<a id="sthref971" href="img_text/strms068.htm">Description of &#34;Figure 20-4 Recording Changes Using Downstream Capture and Remote Apply&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Complete the following steps to configure an Oracle Streams environment that records the changes to a table using downstream capture and remote apply:</p>
<ol>
<li>
<p>Complete the required prerequisites before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure. See <a href="#CHDCHHBC">&#34;Prerequisites for the MAINTAIN_CHANGE _TABLE Procedure&#34;</a> for more information.</p>
<p>For this configuration, the following tasks must be completed:</p>
<ul>
<li>
<p>Configure an Oracle Streams administrator on all of three databases. See <a href="#CHDEGGED">&#34;Configure an Oracle Streams Administrator on All Databases&#34;</a>.</p>
</li>
<li>
<p>Configure network connectivity and database links:</p>
<ul>
<li>
<p>Configure network connectivity between the source database <code dir="ltr">ct1.example.com</code> and the destination database <code dir="ltr">ct2.example.com</code>.</p>
</li>
<li>
<p>Configure network connectivity between the source database <code dir="ltr">ct1.example.com</code> and the third database <code dir="ltr">ct3.example.com</code>.</p>
</li>
<li>
<p>Configure network connectivity between the destination database <code dir="ltr">ct2.example.com</code> and the third database <code dir="ltr">ct3.example.com</code>.</p>
</li>
<li>
<p>Create a database link from the source database <code dir="ltr">ct1.example.com</code> to the destination database <code dir="ltr">ct2.example.com</code>.</p>
</li>
<li>
<p>Because downstream capture will be configured at the third database, create a database link from the source database <code dir="ltr">ct1.example.com</code> to the third database <code dir="ltr">ct3.example.com</code>.</p>
</li>
<li>
<p>Because downstream capture will be configured at the third database, create a database link from the third database <code dir="ltr">ct3.example.com</code> to the source database <code dir="ltr">ct1.example.com</code>.</p>
</li>
<li>
<p>Because downstream capture will be configured at the third database, create a database link from the third database <code dir="ltr">ct3.example.com</code> to the destination database <code dir="ltr">ct2.example.com</code>.</p>
</li>
</ul>
<p>See <a class="olink STREP203" href="../STREP/prep_rep.htm#STREP203"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>Ensure that the source database and the capture database are in <code dir="ltr">ARCHIVELOG</code> mode. In this example, the source database is <code dir="ltr">ct1.example.com</code> and the capture database is <code dir="ltr">ct3.example.com</code>. See <a href="#CHDEFBHD">&#34;Ensure That the Source Database Is in ARCHIVELOG Mode&#34;</a>.</p>
</li>
<li>
<p>Ensure that the initialization parameters are set properly at all databases. See <a href="#CHDGBHCC">&#34;Set Initialization Parameters That Are Relevant to Oracle Streams&#34;</a>.</p>
</li>
<li>
<p>Configure the Oracle Streams pool properly at all databases. See <a href="#CHDFBJAG">&#34;Configure the Oracle Streams Pool&#34;</a>.</p>
</li>
<li>
<p>Because a third database (<code dir="ltr">ct3.example.com</code>) will be the capture database for changes made to the source database, configure log file copying from the source database <code dir="ltr">ct1.example.com</code> to the capture database <code dir="ltr">ct3.example.com</code>. See <a href="#CHDCJCJE">&#34;Configure Log File Transfer to a Downstream Capture Database&#34;</a>.</p>
</li>
<li>
<p>Because this example configures a real-time downstream capture process, add standby redo logs at the capture database, and configure standby redo logs at the capture database <code dir="ltr">ct3.example.com</code>. See <a href="#CHDHIECD">&#34;Configure Standby Redo Logs for Real-Time Downstream Capture&#34;</a>.</p>
</li>
</ul>
</li>
<li>
<p>Connect to the capture database <code dir="ltr">ct3.example.com</code> as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.MAINTAIN_CHANGE_TABLE(
    change_table_name       =&gt; &#39;hr.emp_change_table&#39;,
    source_table_name       =&gt; &#39;hr.employees&#39;,
    column_type_list        =&gt; &#39;employee_id VARCHAR2(6),
                                first_name VARCHAR2(20),
                                last_name VARCHAR2(25),
                                email VARCHAR2(25),
                                phone_number VARCHAR2(20),
                                hire_date DATE,
                                job_id VARCHAR2(10),
                                manager_id NUMBER(6),
                                department_id NUMBER(4)&#39;,
    capture_values          =&gt; &#39;*&#39;,
    options_string          =&gt; &#39;STORAGE (INITIAL     6144  
                                         NEXT        6144 
                                         MINEXTENTS     1  
                                         MAXEXTENTS     5)&#39;,
    source_database          =&gt; &#39;ct1.example.com&#39;,
    destination_database     =&gt; &#39;ct2.example.com&#39;,
    keep_change_columns_only =&gt; TRUE);
END;
/
</pre>
<p>This procedure uses the default value for each parameter that is not specified. The <code dir="ltr">options_string</code> parameter specifies a storage clause for the change table. The <code dir="ltr">keep_change_columns_only</code> parameter is set to <code dir="ltr">TRUE</code> to create a keep columns declarative rule-based transformation that excludes the <code dir="ltr">salary</code> and <code dir="ltr">commission_pct</code> columns from captured row logical change records (LCRs). The <code dir="ltr">salary</code> and <code dir="ltr">commission_pct</code> columns are excluded because they are not in the <code dir="ltr">column_type_list</code> parameter.</p>
<p>When this procedure completes, the Oracle Streams environment is configured.</p>
<p>If this procedure encounters an error and stops, then see <a class="olink STREP149" href="../STREP/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about either recovering from the error or rolling back the configuration operation by using the <code dir="ltr">DBMS_STREAMS_ADM.RECOVER_OPERATION</code> procedure.</p>
</li>
<li>
<p>Set the <code dir="ltr">downstream_real_time_mine</code> capture process parameter to <code dir="ltr">Y</code>.</p>
<ol>
<li>
<p>Query the <code dir="ltr">CAPTURE_NAME</code> column in the <code dir="ltr">DBA_CAPTURE</code> view to determine the name of the capture process.</p>
</li>
<li>
<p>Run the <code dir="ltr">SET_PARAMETER</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package to set the <code dir="ltr">downstream_real_time_mine</code> capture process parameter to&nbsp;<code dir="ltr">Y</code>.</p>
<p>For example, if the capture process name is <code dir="ltr">cap$chg5</code>, then run the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.SET_PARAMETER(
    capture_name =&gt; &#39;cap$chg5&#39;,
    parameter    =&gt; &#39;downstream_real_time_mine&#39;,
    value        =&gt; &#39;Y&#39;);
END;
/
</pre></li>
</ol>
</li>
<li>
<p>Connect to the source database <code dir="ltr">ct1.example.com</code> as an administrative user with the necessary privileges to switch log files.</p>
</li>
<li>
<p>Archive the current log file at the source database:</p>
<pre dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre>
<p>Archiving the current log file at the source database starts real time mining of the source database redo log.</p>
</li>
</ol>
<p>The resulting Oracle Streams environment has the following characteristics:</p>
<ul>
<li>
<p>An unconditional supplemental log group includes the columns in the <code dir="ltr">hr.employees</code> table for which changes are recorded at the source database <code dir="ltr">ct1.example.com</code>. These columns are the ones specified in the <code dir="ltr">column_type_list</code> parameter of the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has an <code dir="ltr">hr.emp_change_table</code>. This change table has the following definition:</p>
<pre dir="ltr"> Name                                      Null?    Type
 ----------------------------------------- -------- ---------------------------
 COMMAND_TYPE$                                      VARCHAR2(10)
 VALUE_TYPE$                                        VARCHAR2(3)
 EMPLOYEE_ID                               NOT NULL NUMBER(6)
 FIRST_NAME                                         VARCHAR2(20)
 LAST_NAME                                 NOT NULL VARCHAR2(25)
 EMAIL                                     NOT NULL VARCHAR2(25)
 PHONE_NUMBER                                       VARCHAR2(20)
 HIRE_DATE                                 NOT NULL DATE
 JOB_ID                                    NOT NULL VARCHAR2(10)
 MANAGER_ID                                         NUMBER(6)
 DEPARTMENT_ID                                      NUMBER(4)
</pre></li>
<li>
<p>The capture database <code dir="ltr">ct3.example.com</code> has a queue with a system-generated name. This queue is used by the downstream capture process.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has a queue with a system-generated name. This queue is used by the apply process.</p>
</li>
<li>
<p>The capture database <code dir="ltr">ct3.example.com</code> has a real-time downstream capture process with a system-generated name that captures data manipulation language (DML) changes made to the <code dir="ltr">hr.employees</code> table.</p>
</li>
<li>
<p>The capture database <code dir="ltr">ct3.example.com</code> has a <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation that keeps all of the columns in the row LCRs for the <code dir="ltr">hr.employees</code> table, except for the <code dir="ltr">salary</code> and <code dir="ltr">commission_pct</code> columns.</p>
</li>
<li>
<p>A propagation running on the <code dir="ltr">ct3.example.com</code> database with a system-generated name sends the captured changes from the <code dir="ltr">ct3.example.com</code> database to the <code dir="ltr">ct2.example.com</code> database.</p>
</li>
<li>
<p>The destination database <code dir="ltr">ct2.example.com</code> has an apply process with a system-generated name. The apply process uses change handlers with system-generated names to process the captured row LCRs for inserts, updates, and deletes on the <code dir="ltr">hr.employees</code> table. The change handlers use the information in the row LCRs to populate the <code dir="ltr">hr.emp_change_table</code>.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_mcap.htm#i1006402">&#34;Setting a Capture Process Parameter&#34;</a></div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDIEIIH"></a>
<div id="STRMS1597" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Managing an Oracle Streams Environment That Records Table Changes<a id="sthref972"></a></h2>
<p>This section describes setting and unsetting change handlers.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#CHDBBBHC">Unsetting and Setting a Change Handler</a></p>
</li>
<li>
<p><a href="#CHDJJIHF">Recording Changes to a Table Using Existing Oracle Streams Components</a></p>
</li>
<li>
<p><a href="#CHDFEBCB">Maintaining Change Tables</a></p>
</li>
<li>
<p><a href="#CHDGHEIG">Managing the Oracle Streams Environment</a></p>
</li>
</ul>
<a id="CHDBBBHC"></a>
<div id="STRMS1598" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Unsetting and Setting a Change Handler<a id="sthref973"></a><a id="sthref974"></a><a id="sthref975"></a></h3>
<p>The <code dir="ltr">SET_CHANGE_HANDLER</code> procedure in the <code dir="ltr">DBMS_APPLY_ADM</code> package can unset and set a change handler for a specified operation on a specified table for a single apply process. This procedure assumes that the Oracle Streams components are configured to capture changes to the specified table and send the changes to the specified apply process.</p>
<p>For the example in this section, assume that you want to unset the change handler for update operations that was created in <a href="#CHDBEFHI">&#34;Recording Table Changes Using Local Capture and Remote Apply with Replication&#34;</a>. Next, you want to reset this change handler.</p>
<p>Complete the following steps to set a change handler:</p>
<ol>
<li>
<p>Connect to the database that contains the apply process as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDFFDDA">
<p><a id="sthref976"></a>Identify the change handler to modify.</p>
<p>This example unsets the change handler for <code dir="ltr">UPDATE</code> operations on the <code dir="ltr">hr.departments</code> table. Assume that these changes are applied by the <code dir="ltr">app$chg38</code> apply process. Run the following query to determine the owner of the change table, the name of the change table, the capture values tracked in the change table, and the name of the change handler:</p>
<pre dir="ltr">COLUMN CHANGE_TABLE_OWNER HEADING &#39;Change Table Owner&#39; FORMAT A20
COLUMN CHANGE_TABLE_NAME HEADING &#39;Change Table Name&#39; FORMAT A20
COLUMN CAPTURE_VALUES HEADING &#39;Capture|Values&#39; FORMAT A7
COLUMN HANDLER_NAME HEADING &#39;Change Handler Name&#39; FORMAT A25
 
SELECT CHANGE_TABLE_OWNER, 
       CHANGE_TABLE_NAME, 
       CAPTURE_VALUES, 
       HANDLER_NAME 
  FROM DBA_APPLY_CHANGE_HANDLERS
  WHERE SOURCE_TABLE_OWNER = &#39;HR&#39; AND
        SOURCE_TABLE_NAME  = &#39;DEPARTMENTS&#39; AND
        APPLY_NAME         = &#39;APP$CHG38&#39; AND
        OPERATION_NAME     = &#39;UPDATE&#39;;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                                          Capture
Change Table Owner   Change Table Name    Values  Change Handler Name
-------------------- -------------------- ------- -------------------------
HR                   DEP_CHANGE_TABLE     *       HR_DEPARTMENTS_CHG$10
</pre>
<p>Make a note of the values returned by this query, and use these values in the subsequent steps in this example.</p>
</li>
<li>
<p>Unset the change handler.</p>
<p>To unset a change handler, specify <code dir="ltr">NULL</code> in the <code dir="ltr">change_handler_name</code> parameter in the <code dir="ltr">SET_CHANGE_HANDLER</code> procedure, and specify the change table owner, change table name, capture values, operation, source table, and apply process using the other procedure parameters. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_CHANGE_HANDLER(
    change_table_name    =&gt;  &#39;hr.dep_change_table&#39;,
    source_table_name    =&gt;  &#39;hr.departments&#39;,
    capture_values       =&gt;  &#39;*&#39;,
    apply_name           =&gt;  &#39;app$chg38&#39;,
    operation_name       =&gt;  &#39;UPDATE&#39;,
    change_handler_name  =&gt;  NULL);
END;
/
</pre>
<p>When this change handler is unset, it no longer records update changes.</p>
</li>
<li>
<p>Set the change handler.</p>
<p>To set the change handler, specify the change handler in the <code dir="ltr">change_handler_name</code> parameter in the <code dir="ltr">SET_CHANGE_HANDLER</code> procedure, and specify the change table owner, change table name, capture values, operation, source table, and apply process using the other procedure parameters. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_CHANGE_HANDLER(
    change_table_name    =&gt;  &#39;hr.dep_change_table&#39;,
    source_table_name    =&gt;  &#39;hr.departments&#39;,
    capture_values       =&gt;  &#39;*&#39;,
    apply_name           =&gt;  &#39;app$chg38&#39;,
    operation_name       =&gt;  &#39;UPDATE&#39;,
    change_handler_name  =&gt;  &#39;hr_departments_chg$10&#39;);
END;
/
</pre>
<p>When this change handler is reset, it records update changes.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDJJIHF"></a>
<div id="STRMS1631" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Recording Changes to a Table Using Existing Oracle Streams Components<a id="sthref977"></a></h3>
<p>You can configure existing Oracle Streams components to record changes to a table. These existing components include capture processes, propagations, and apply processes. To use existing components, specify the component names when you run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package.</p>
<p>The example in this section builds on the Oracle Streams environment created in <a href="#CHDBACFG">&#34;Recording Table Changes Using Local Capture and Apply on One Database&#34;</a>. That example configured an Oracle Streams environment that records changes to the <code dir="ltr">hr.jobs</code> table. The example in this section configures the existing capture process and apply process to record changes to the <code dir="ltr">hr.employees</code> table as well.</p>
<p>The following table lists the decisions that were made about the changes that will be recorded for the <code dir="ltr">hr.employees</code> table.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" summary="This table lists the decisions made about the example in this section." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t23">Decision</th>
<th class="cellalignment5974" id="r1c2-t23">Assumption for This Example</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t23" headers="r1c1-t23"><a href="#CHDJCEAE">Decide Which Type of Environment to Configure</a></td>
<td class="cellalignment5970" headers="r2c1-t23 r1c2-t23">This example uses existing Oracle Streams components that perform local capture and apply on one database.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t23" headers="r1c1-t23"><a href="#CHDJGDEF">Decide Which Columns to Track</a></td>
<td class="cellalignment5970" headers="r3c1-t23 r1c2-t23">This example tracks all of the columns in the <code dir="ltr">hr.employees</code> table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t23" headers="r1c1-t23"><a href="#CHDIDFAC">Decide Which Metadata to Record</a></td>
<td class="cellalignment5970" headers="r4c1-t23 r1c2-t23">This example records the <code dir="ltr">command_type</code>, <code dir="ltr">value_type</code> (<code dir="ltr">OLD</code> or <code dir="ltr">NEW</code>), and <code dir="ltr">commit_scn</code> metadata.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t23" headers="r1c1-t23"><a href="#CHDBJHJA">Decide Which Values to Track for Update Operations</a></td>
<td class="cellalignment5970" headers="r5c1-t23 r1c2-t23">This example tracks both the old and new column values when an update is performed on the source table.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t23" headers="r1c1-t23"><a href="#CHDGGJFC">Decide Whether to Configure a KEEP_COLUMNS Transformation</a></td>
<td class="cellalignment5970" headers="r6c1-t23 r1c2-t23">This example does not configure a <code dir="ltr">KEEP_COLUMNS</code> declarative rule-based transformation.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t23" headers="r1c1-t23"><a href="#CHDCJFIB">Decide Whether to Specify CREATE TABLE Options for the Change Table</a></td>
<td class="cellalignment5970" headers="r7c1-t23 r1c2-t23">This example does not specify any <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options. The change table is created with the default <code dir="ltr">CREATE</code> <code dir="ltr">TABLE</code> options.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t23" headers="r1c1-t23"><a href="#CHDHAJCC">Decide Whether to Perform the Configuration Actions Directly or with a Script</a></td>
<td class="cellalignment5970" headers="r8c1-t23 r1c2-t23">This example performs the configuration actions directly. It does not use a script.</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r9c1-t23" headers="r1c1-t23"><a href="#CHDJCEJB">Decide Whether to Replicate the Source Table</a></td>
<td class="cellalignment5970" headers="r9c1-t23 r1c2-t23">This example does not replicate the source table.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p>Complete the following steps to record changes to a table using existing Oracle Streams components:</p>
<ol>
<li>
<p>Ensure that the required prerequisites are met before running the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure. See <a href="#CHDCHHBC">&#34;Prerequisites for the MAINTAIN_CHANGE _TABLE Procedure&#34;</a> for more information.</p>
<p>For this configuration, the following tasks must be completed:</p>
<ul>
<li>
<p>Configure an Oracle Streams administrator on the database. See <a href="#CHDEGGED">&#34;Configure an Oracle Streams Administrator on All Databases&#34;</a>.</p>
</li>
<li>
<p>Ensure that the database is in <code dir="ltr">ARCHIVELOG</code> mode. See <a href="#CHDEFBHD">&#34;Ensure That the Source Database Is in ARCHIVELOG Mode&#34;</a>.</p>
</li>
<li>
<p>Ensure that the initialization parameters are set properly at the database. See <a href="#CHDGBHCC">&#34;Set Initialization Parameters That Are Relevant to Oracle Streams&#34;</a>.</p>
</li>
<li>
<p>Configure the Oracle Streams pool properly at the database. See <a href="#CHDFBJAG">&#34;Configure the Oracle Streams Pool&#34;</a>.</p>
</li>
</ul>
<p>In this example, these requirements should already be met because an existing Oracle Streams environment is recording changes to the <code dir="ltr">hr.jobs</code> table.</p>
</li>
<li>
<p>Determine the names of the existing Oracle Streams components.</p>
<p>In SQL*Plus, connect to the database that contains a component and query the appropriate data dictionary view:</p>
<ul>
<li>
<p>Query the <code dir="ltr">CAPTURE_NAME</code> column in the <code dir="ltr">DBA_CAPTURE</code> view to determine the names of the capture processes in a database.</p>
</li>
<li>
<p>Query the <code dir="ltr">PROPAGATION_NAME</code> column in the <code dir="ltr">DBA_PROPAGATION</code> view to determine the names of the propagations in a database.</p>
</li>
<li>
<p>Query the <code dir="ltr">APPLY_NAME</code> column in the <code dir="ltr">DBA_APPLY</code> view to determine the names of the apply processes in a database.</p>
</li>
</ul>
<p>This example records changes using a capture process and apply process in a single database. Therefore, it does not use a propagation.</p>
<p>Assume that the name of the capture process is <code dir="ltr">cap$chg3</code> and that the name of the apply process is <code dir="ltr">app$chg4</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Connect to the database that contains the existing capture process as the Oracle Streams administrator.</p>
</li>
<li>
<p>Run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.MAINTAIN_CHANGE_TABLE(
    change_table_name       =&gt; &#39;hr.employees_change_table&#39;,
    source_table_name       =&gt; &#39;hr.employees&#39;,
    column_type_list        =&gt; &#39;employee_id VARCHAR2(6),
                                first_name VARCHAR2(20),
                                last_name VARCHAR2(25),
                                email VARCHAR2(25),
                                phone_number VARCHAR2(20),
                                hire_date DATE,
                                job_id VARCHAR2(10),
                                salary NUMBER(8,2),
                                commission_pct NUMBER(2,2),
                                manager_id NUMBER(6),
                                department_id NUMBER(4)&#39;,
    extra_column_list        =&gt; &#39;command_type,value_type,commit_scn&#39;,
    capture_values           =&gt; &#39;*&#39;,
    capture_name             =&gt; &#39;cap$chg3&#39;,
    apply_name               =&gt; &#39;app$chg4&#39;,
    keep_change_columns_only =&gt; FALSE);
END;
/
</pre>
<p>This procedure uses the default value for each parameter that is not specified. The <code dir="ltr">keep_change_columns_only</code> parameter is set to <code dir="ltr">FALSE</code> because all of the columns in the <code dir="ltr">hr.jobs</code> table are listed in the <code dir="ltr">column_type_list</code> parameter.</p>
<p>When this procedure completes, the Oracle Streams environment is configured.</p>
<p>If this procedure encounters an error and stops, then see <a class="olink STREP149" href="../STREP/man_gen_rep.htm#STREP149"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about either recovering from the error or rolling back the configuration operation by using the <code dir="ltr">DBMS_STREAMS_ADM.RECOVER_OPERATION</code> procedure.</p>
</li>
</ol>
<p>The resulting Oracle Streams environment has the following characteristics:</p>
<ul>
<li>
<p>The characteristics previously described in <a href="#CHDBACFG">&#34;Recording Table Changes Using Local Capture and Apply on One Database&#34;</a>.</p>
</li>
<li>
<p>An unconditional supplemental log group includes all of the columns in the <code dir="ltr">hr.employees</code> table.</p>
</li>
<li>
<p>The database has an <code dir="ltr">hr.employees_change_table</code>. This change table has the following definition:</p>
<pre dir="ltr"> Name                                      Null?    Type
 ----------------------------------------- -------- ---------------------------
 COMMAND_TYPE$                                      VARCHAR2(10)
 VALUE_TYPE$                                        VARCHAR2(3)
 COMMIT_SCN$                                        NUMBER
 EMPLOYEE_ID                                        VARCHAR2(6)
 FIRST_NAME                                         VARCHAR2(20)
 LAST_NAME                                          VARCHAR2(25)
 EMAIL                                              VARCHAR2(25)
 PHONE_NUMBER                                       VARCHAR2(20)
 HIRE_DATE                                          DATE
 JOB_ID                                             VARCHAR2(10)
 SALARY                                             NUMBER(8,2)
 COMMISSION_PCT                                     NUMBER(2,2)
 MANAGER_ID                                         NUMBER(6)
 DEPARTMENT_ID                                      NUMBER(4)
</pre></li>
<li>
<p>The capture process <code dir="ltr">cap$chg3</code> captures data manipulation language (DML) changes made to the <code dir="ltr">hr.employees</code> table.</p>
</li>
<li>
<p>An apply process <code dir="ltr">app$chg4</code> uses change handlers with system-generated names to process the captured row LCRs for inserts, updates, and deletes on the <code dir="ltr">hr.employees</code> table. The change handlers use the information in the row LCRs to populate the <code dir="ltr">hr.employees_change_table</code>.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDFEBCB"></a>
<div id="STRMS1637" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Maintaining Change Tables<a id="sthref978"></a></h3>
<p>Change tables can grow large over time. You can query one or more change tables to obtain a transactionally consistent set of change data. When the change data is no longer needed, you can remove it from the change tables. To perform these operations, configure the change table to track commit SCN metadata by including <code dir="ltr">commit_scn</code> in the <code dir="ltr">extra_column_list</code> parameter when you run the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure. You can use the commit SCN to obtain consistent data and to specify which data to remove when it is no longer needed.</p>
<p>The example in this section maintains the change tables created in the following sections:</p>
<ul>
<li>
<p>The <code dir="ltr">hr.jobs_change_table</code> is created in the example in <a href="#CHDBACFG">&#34;Recording Table Changes Using Local Capture and Apply on One Database&#34;</a></p>
</li>
<li>
<p>The <code dir="ltr">hr.employees_change_table</code> is created in the example in <a href="#CHDJJIHF">&#34;Recording Changes to a Table Using Existing Oracle Streams Components&#34;</a></p>
</li>
</ul>
<p>The example in this section queries the change tables to obtain a transactionally consistent set of change data and then removes the change data that has been viewed.</p>
<p>Complete the following steps to maintain change tables:</p>
<ol>
<li id="CHDDIAID">
<p>Determine the current low-watermark of the apply process that applies changes to the change table. Changes that were committed at a system change number (SCN) less than or equal to the low-watermark have definitely been applied.</p>
<p>For example, if the name of the apply process is <code dir="ltr">app$chg4</code>, then run the following query to determine its low-watermark:</p>
<pre dir="ltr">SELECT APPLIED_MESSAGE_NUMBER 
  FROM DBA_APPLY_PROGRESS 
  WHERE APPLY_NAME=&#39;APP$CHG4&#39;;
</pre>
<p>Make a note of the returned low-watermark SCN. For this example, assume that the low-watermark SCN is <code dir="ltr">663090</code>.</p>
</li>
<li id="CHDEEGDE">
<p>Query the change tables for changes that are less than or equal to the low-watermark returned in Step <a href="#CHDDIAID">1</a>.</p>
<p>For example, run the following query on the <code dir="ltr">hr.jobs_change_table</code>:</p>
<pre dir="ltr">SELECT * FROM hr.jobs_change_table WHERE commit_scn$ &lt;= 663090;
</pre>
<p>For example, run the following query on the <code dir="ltr">hr.employees_change_table</code>:</p>
<pre dir="ltr">SELECT * FROM hr.employees_change_table WHERE commit_scn$ &lt;= 663090;
</pre>
<p>These queries specify the low-watermark SCN returned in Step <a href="#CHDDIAID">1</a>. The changes returned are transactionally consistent up to the specified SCN.</p>
</li>
<li>
<p>When the changes viewed in Step <a href="#CHDEEGDE">2</a> are no longer needed, run the following statements to remove the changes:</p>
<pre dir="ltr">DELETE FROM hr.jobs_change_table WHERE commit_scn$ &lt;= 663090;

DELETE FROM hr.employees_change_table WHERE commit_scn$ &lt;= 663090;

COMMIT;
</pre>
<p>These queries specify the same low-watermark SCN returned in Step <a href="#CHDDIAID">1</a> and used in the queries in Step <a href="#CHDEEGDE">2</a>.</p>
</li>
</ol>
<p>There are other ways to maintain change tables. For example, you can query them using a range of changes between two SCN values. You can also create a view to show a consistent set of data in two or more change tables.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_adapply.htm#i1009376">&#34;Low-Watermark and High-Watermark for an Apply Process&#34;</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDGHEIG"></a>
<div id="STRMS1599" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Managing the Oracle Streams Environment</h3>
<p>After the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure has configured the Oracle Streams environment, you can manage the Oracle Streams environment by referring to the sections in the following table.</p>
<div class="inftblhruleinformal">
<table class="cellalignment5973" summary="This table includes cross references to instructions for managing various parts of an Oracle Streams environment." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t25">To Manage</th>
<th class="cellalignment5974" id="r1c2-t25">See</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t25" headers="r1c1-t25">Supplemental logging</td>
<td class="cellalignment5970" headers="r2c1-t25 r1c2-t25"><a class="olink STREP107" href="../STREP/prep_rep.htm#STREP107"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t25" headers="r1c1-t25">Capture processes</td>
<td class="cellalignment5970" headers="r3c1-t25 r1c2-t25"><a href="strms_mcap.htm#BEHJFCDD">&#34;Managing a Capture Process&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t25" headers="r1c1-t25">Apply processes</td>
<td class="cellalignment5970" headers="r4c1-t25 r1c2-t25"><a href="strms_mapply.htm#g1026098">Chapter 17, &#34;Managing Oracle Streams Information Consumption&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t25" headers="r1c1-t25">Statement DML handlers</td>
<td class="cellalignment5970" headers="r5c1-t25 r1c2-t25"><a href="strms_mapply.htm#BGBFBBBA">&#34;Managing a Statement DML Handler&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t25" headers="r1c1-t25">Queues</td>
<td class="cellalignment5970" headers="r6c1-t25 r1c2-t25"><a href="strms_mprop.htm#i1006123">&#34;Managing Queues&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t25" headers="r1c1-t25">Propagations</td>
<td class="cellalignment5970" headers="r7c1-t25 r1c2-t25"><a href="strms_mprop.htm#i1011128">&#34;Managing Oracle Streams Propagations and Propagation Jobs&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t25" headers="r1c1-t25">Rules</td>
<td class="cellalignment5970" headers="r8c1-t25 r1c2-t25"><a href="strms_mrules.htm#BABBHHIA">Chapter 18, &#34;Managing Rules&#34;</a></td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDCEHBI"></a>
<div id="STRMS1545" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Monitoring an Oracle Streams Environment That Records Table Changes<a id="sthref979"></a></h2>
<p>This section describes monitoring the Oracle Streams components in a configuration that tracks table changes.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#CHDBHDHI">Monitoring a Change Table</a></p>
</li>
<li>
<p><a href="#CHDGACIF">Monitoring Change Handlers</a></p>
</li>
<li>
<p><a href="#CHDJJBJB">Monitoring the Oracle Streams Environment</a></p>
</li>
</ul>
<a id="CHDBHDHI"></a>
<div id="STRMS1547" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Monitoring a Change Table<a id="sthref980"></a></h3>
<p>You can monitor a change table using <code dir="ltr">SELECT</code> statement the same way you monitor other database tables. The columns in the change table depend on the <code dir="ltr">column_type_list</code> parameter in the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure. The change table can include a tracking column for each column in the source table, or it can include a subset of the columns in the source table. In addition, the change table can include several additional columns that contain metadata about each change.</p>
<p>For example, the Oracle Streams environment configured in <a href="#CHDBACFG">&#34;Recording Table Changes Using Local Capture and Apply on One Database&#34;</a> records changes to the <code dir="ltr">hr.jobs</code> table. Each column in the <code dir="ltr">hr.jobs</code> table is tracked in the change table <code dir="ltr">hr.jobs_change_table</code>, and the default metadata columns (<code dir="ltr">command_type$</code>, <code dir="ltr">value_type$</code>, and <code dir="ltr">commit_scn$</code>) are included in the change table.</p>
<p>To monitor this sample change table, complete the following steps:</p>
<ol>
<li>
<p>Connect to the database as <code dir="ltr">hr</code> user.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDFJCFF">
<p>Make changes to the source table so that the change table is populated:</p>
<pre dir="ltr">INSERT INTO hr.jobs VALUES(&#39;BN_CNTR&#39;,&#39;Bean Counter&#39;,6000,8000);
COMMIT;

UPDATE hr.jobs SET min_salary=7000 WHERE job_id=&#39;BN_CNTR&#39;;
COMMIT;

DELETE FROM hr.jobs WHERE job_id=&#39;BN_CNTR&#39;;
COMMIT;
</pre></li>
<li>
<p>Query the change table:</p>
<pre dir="ltr">COLUMN COMMAND_TYPE$ HEADING &#39;Command Type&#39; FORMAT A12
COLUMN VALUE_TYPE$ HEADING &#39;Value|Type&#39; FORMAT A5
COLUMN COMMIT_SCN$ HEADING &#39;Commit SCN&#39; FORMAT 9999999
COLUMN JOB_ID HEADING &#39;Job ID&#39; FORMAT A10
COLUMN JOB_TITLE HEADING &#39;Job Title&#39; FORMAT A12
COLUMN MIN_SALARY HEADING &#39;Minimum|Salary&#39; FORMAT 9999999
COLUMN MAX_SALARY HEADING &#39;Maximum|Salary&#39; FORMAT 9999999

SELECT * FROM hr.jobs_change_table;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">             Value                                     Minimum  Maximum
Command Type Type  Commit SCN Job ID     Job Title      Salary   Salary
------------ ----- ---------- ---------- ------------ -------- --------
INSERT       NEW       663075 BN_CNTR    Bean Counter     6000     8000
UPDATE       OLD       663082 BN_CNTR    Bean Counter     6000     8000
UPDATE       NEW       663082 BN_CNTR    Bean Counter     7000     8000
DELETE       OLD       663090 BN_CNTR    Bean Counter     7000     8000
</pre>
<p>This output shows the changes made in Step <a href="#CHDFJCFF">2</a>.</p>
</li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDGACIF"></a>
<div id="STRMS1600" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Monitoring Change Handlers<a id="sthref981"></a></h3>
<p>This section describes monitoring change handlers.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#CHDFAGBJ">Displaying General Information About Change Handlers</a></p>
</li>
<li>
<p><a href="#CHDDHAJI">Displaying the Change Table and Source Table for Change Handlers</a></p>
</li>
</ul>
<a id="CHDFAGBJ"></a>
<div id="STRMS1601" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Displaying General Information About Change Handlers</h4>
<p>You can query the <code dir="ltr">DBA_APPLY_CHANGE_HANDLERS</code> view to display the following information about each change handler in a database:</p>
<ul>
<li>
<p>The name of the change handler</p>
</li>
<li>
<p>The captured values tracked by the change handler for update operations, either <code dir="ltr">NEW</code> for new column values, <code dir="ltr">OLD</code> for old column values, or <code dir="ltr">*</code> for both new and old column values</p>
</li>
<li>
<p>The name of the apply process that uses the change handler</p>
</li>
<li>
<p>The operation for which the change handler is invoked, either <code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, or <code dir="ltr">DELETE</code></p>
</li>
</ul>
<p>Run the following query to display this information:</p>
<pre dir="ltr">COLUMN HANDLER_NAME HEADING &#39;Change Handler Name&#39; FORMAT A30
COLUMN CAPTURE_VALUES HEADING &#39;Capture|Values&#39; FORMAT A7
COLUMN APPLY_NAME HEADING &#39;Apply|Process&#39; FORMAT A10
COLUMN OPERATION_NAME HEADING &#39;Operation&#39; FORMAT A10
 
SELECT HANDLER_NAME, 
       CAPTURE_VALUES,
       APPLY_NAME,
       OPERATION_NAME
  FROM DBA_APPLY_CHANGE_HANDLERS
  ORDER BY HANDLER_NAME;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                               Capture Apply 
Change Handler Name            Values  Process    Operation
------------------------------ ------- ---------- ----------
HR_DEPARTMENTS_CHG$40                  APP$CHG38  INSERT
HR_DEPARTMENTS_CHG$41                  APP$CHG38  DELETE
HR_DEPARTMENTS_CHG$42          *       APP$CHG38  UPDATE
HR_JOBS_CHG$80                         APP$CHG79  INSERT
HR_JOBS_CHG$81                         APP$CHG79  DELETE
HR_JOBS_CHG$82                 *       APP$CHG79  UPDATE
</pre>
<p>Notice that the &#34;Capture Values&#34; column is <code dir="ltr">NULL</code> for <code dir="ltr">INSERT</code> and <code dir="ltr">DELETE</code> operations. The <code dir="ltr">DBA_APPLY_CHANGE_HANDLERS</code> view only displays captured values for change handlers that track <code dir="ltr">UPDATE</code> operations. Only new column values are possible for inserts, and only old column values are possible for deletes.</p>
</div>
<!-- class="sect3" -->
<a id="CHDDHAJI"></a>
<div id="STRMS1602" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Displaying the Change Table and Source Table for Change Handlers</h4>
<p>You can query the <code dir="ltr">DBA_APPLY_CHANGE_HANDLERS</code> view to display the following information about each change handler in a database:</p>
<ul>
<li>
<p>The name of the change handler</p>
</li>
<li>
<p>The owner of the change table that tracks changes to the source table</p>
</li>
<li>
<p>The name of the change table that tracks changes to the source table</p>
</li>
<li>
<p>The owner of the source table</p>
</li>
<li>
<p>The name of the source table</p>
</li>
</ul>
<p>Run the following query to display this information:</p>
<pre dir="ltr">COLUMN HANDLER_NAME HEADING &#39;Change Handler Name&#39; FORMAT A25
COLUMN CHANGE_TABLE_OWNER HEADING &#39;Change|Table|Owner&#39; FORMAT A8
COLUMN CHANGE_TABLE_NAME HEADING &#39;Change|Table|Name&#39; FORMAT A17
COLUMN SOURCE_TABLE_OWNER HEADING &#39;Source|Table|Owner&#39; FORMAT A8
COLUMN SOURCE_TABLE_NAME HEADING &#39;Source|Table|Name&#39; FORMAT A17
 
SELECT HANDLER_NAME,
       CHANGE_TABLE_OWNER, 
       CHANGE_TABLE_NAME, 
       SOURCE_TABLE_OWNER, 
       SOURCE_TABLE_NAME 
  FROM DBA_APPLY_CHANGE_HANDLERS
  ORDER BY HANDLER_NAME;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                          Change   Change            Source   Source
                          Table    Table             Table    Table
Change Handler Name       Owner    Name              Owner    Name
------------------------- -------- ----------------- -------- -----------------
HR_DEPARTMENTS_CHG$40     HR       DEP_CHANGE_TABLE  HR       DEPARTMENTS
HR_DEPARTMENTS_CHG$41     HR       DEP_CHANGE_TABLE  HR       DEPARTMENTS
HR_DEPARTMENTS_CHG$42     HR       DEP_CHANGE_TABLE  HR       DEPARTMENTS
HR_JOBS_CHG$80            HR       JOBS_CHANGE_TABLE HR       JOBS
HR_JOBS_CHG$81            HR       JOBS_CHANGE_TABLE HR       JOBS
HR_JOBS_CHG$82            HR       JOBS_CHANGE_TABLE HR       JOBS
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDJJBJB"></a>
<div id="STRMS1546" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Monitoring the Oracle Streams Environment</h3>
<p>After the <code dir="ltr">MAINTAIN_CHANGE_TABLE</code> procedure has configured the Oracle Streams environment, you can monitor the Oracle Streams environment by referring to the sections in the following table.</p>
<div class="inftblhruleinformal">
<table class="cellalignment5973" summary="This table includes cross references to instructions for monitoring various parts of an Oracle Streams environment." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t26">To Monitor</th>
<th class="cellalignment5974" id="r1c2-t26">See</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t26" headers="r1c1-t26">Supplemental logging</td>
<td class="cellalignment5970" headers="r2c1-t26 r1c2-t26"><a href="strms_cpmon.htm#CACCIFAE">&#34;Monitoring Supplemental Logging&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t26" headers="r1c1-t26">Capture processes</td>
<td class="cellalignment5970" headers="r3c1-t26 r1c2-t26"><a href="strms_cpmon.htm#CFFBEDGE">&#34;Monitoring a Capture Process&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t26" headers="r1c1-t26">Apply processes</td>
<td class="cellalignment5970" headers="r4c1-t26 r1c2-t26"><a href="strms_apmon.htm#CFFGFJBB">Chapter 26, &#34;Monitoring Oracle Streams Apply Processes&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t26" headers="r1c1-t26">Statement DML handlers</td>
<td class="cellalignment5970" headers="r5c1-t26 r1c2-t26"><a href="strms_apmon.htm#CACIJBDA">&#34;Displaying Information About Statement DML Handlers&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t26" headers="r1c1-t26">Queues</td>
<td class="cellalignment5970" headers="r6c1-t26 r1c2-t26"><a href="strms_qpmon.htm#i1013925">&#34;Monitoring Buffered Queues&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t26" headers="r1c1-t26">Propagations</td>
<td class="cellalignment5970" headers="r7c1-t26 r1c2-t26"><a href="strms_qpmon.htm#i1006969">&#34;Monitoring Oracle Streams Propagations and Propagation Jobs&#34;</a></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t26" headers="r1c1-t26">Rules</td>
<td class="cellalignment5970" headers="r8c1-t26 r1c2-t26"><a href="strms_rumon.htm#CFFJECBJ">Chapter 27, &#34;Monitoring Rules&#34;</a></td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="strms_mtransform.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="man_advanced.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>