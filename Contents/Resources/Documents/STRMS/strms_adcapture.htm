<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104438"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Advanced%20Capture%20Process%20Concepts"></a><title>Advanced Capture Process Concepts</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:6Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="pt_adconcepts.htm" title="Previous" type="text/html"/>
<link rel="Next" href="strms_adqueue.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">15/57</span> <!-- End Header -->
<div id="STRMS469" class="chapter"><a id="CACIFFHF"></a>
<h1 class="chapter"><span class="secnum">7</span> Advanced Capture Process Concepts</h1>
<p>Capturing information with Oracle Streams means creating a <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> that contains the information and enqueuing the message into a <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>. The captured information can describe a database change, or it can be any other type of information.</p>
<p><a id="sthref372"></a><a id="sthref373"></a>The following topics contain conceptual information about capturing information with Oracle Streams:</p>
<ul>
<li>
<p><a href="#i1012015">Multiple Capture Processes in a Single Database</a></p>
</li>
<li>
<p><a href="#i1010653">Capture Process Checkpoints</a></p>
</li>
<li>
<p><a href="#i1014885">A New First SCN Value and Purged LogMiner Data Dictionary Information</a></p>
</li>
<li>
<p><a href="#i1007010">ARCHIVELOG Mode and a Capture Process</a></p>
</li>
<li>
<p><a href="#i1006795">Capture Process Creation</a></p>
</li>
<li>
<p><a href="#i1010145">The Oracle Streams Data Dictionary</a></p>
</li>
<li>
<p><a href="#i1010527">Capture Process Rule Evaluation</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#CACGECDI">&#34;Implicit Capture with an Oracle Streams Capture Process&#34;</a></p>
</li>
<li>
<p><a href="strms_mcap.htm#BEHJFCDD">&#34;Managing a Capture Process&#34;</a></p>
</li>
<li>
<p><a href="strms_cpmon.htm#CFFBEDGE">&#34;Monitoring a Capture Process&#34;</a></p>
</li>
<li>
<p><a href="strms_trcapture.htm#CACCGFEH">&#34;Troubleshooting Implicit Capture&#34;</a></p>
</li>
</ul>
</div>
<a id="i1012015"></a>
<div id="STRMS470" class="sect1">
<h2 class="sect1">Multiple Capture Processes in a Single Database<a id="sthref374"></a><a id="sthref375"></a><a id="sthref376"></a><a id="sthref377"></a><a id="sthref378"></a><a id="sthref379"></a></h2>
<p>If you run multiple <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es in a single database, increase the size of the System Global Area (SGA) for each instance. Use the <code dir="ltr">SGA_MAX_SIZE</code> initialization parameter to increase the SGA size. Also, if the size of the <a href="strms_glossary.htm#CHDHGDCA"><span class="xrefglossterm">Oracle Streams pool</span></a> is not managed automatically in the database, then increase the size of the Oracle Streams pool by 10 MB for each capture process parallelism. For example, if you have two capture processes running in a database, and the parallelism parameter is set to 4 for one of them and 1 for the other, then increase the Oracle Streams pool by 50 MB (4 + 1 = 5 parallelism).</p>
<p>Also, Oracle recommends that each <code dir="ltr">ANYDATA</code> queue used by a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>, <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>, or <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> store <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s from at most one capture process from a particular <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>. Therefore, use a separate <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> for each capture process that captures changes originating at a particular source database, and make sure each queue has its own queue table. Also, do not propagate messages from two or more capture processes with the same source database to the same queue.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The size of the Oracle Streams pool is managed automatically if the <code dir="ltr">MEMORY_TARGET</code>, <code dir="ltr">MEMORY_MAX_TARGET</code>, or <code dir="ltr">SGA_TARGET</code> initialization parameter is set to a nonzero value.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP202" href="../STREP/prep_rep.htm#STREP202"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about configuring the Oracle Streams pool</p>
</li>
<li>
<p><a class="olink STREP201" href="../STREP/prep_rep.htm#STREP201"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about the <code dir="ltr">STREAMS_POOL_SIZE</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i1010653"></a>
<div id="STRMS152" class="sect1">
<h2 class="sect1">Capture Process Checkpoints<a id="sthref380"></a><a id="sthref381"></a></h2>
<p>A <span class="bold">checkpoint</span> is information about the current state of a capture process that is stored persistently in the data dictionary of the database running the capture process. A capture process tries to record a checkpoint at regular intervals called <span class="bold">checkpoint intervals</span>.</p>
<a id="BABFFBHF"></a>
<div id="STRMS471" class="sect2">
<h3 class="sect2">Required Checkpoint SCN<a id="sthref382"></a><a id="sthref383"></a><a id="sthref384"></a></h3>
<p>The system change number (SCN) that corresponds to the lowest checkpoint for which a capture process requires redo data is the <span class="bold">required checkpoint SCN</span>. The redo log file that contains the required checkpoint SCN, and all subsequent redo log files, must be available to the capture process. If a capture process is stopped and restarted, then it starts scanning the redo log from the SCN that corresponds to its required checkpoint SCN. The required checkpoint SCN is important for recovery if a database stops unexpectedly. Also, if the <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> is reset for a capture process, then it must be set to a value that is less than or equal to the required checkpoint SCN for the captured process. You can determine the required checkpoint SCN for a capture process by querying the <code dir="ltr">REQUIRED_CHECKPOINT_SCN</code> column in the <code dir="ltr">DBA_CAPTURE</code> data dictionary view.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_cpmon.htm#CHDBBJCF">&#34;Displaying the Redo Log Files That Are Required by Each Capture Process&#34;</a></div>
</div>
<!-- class="sect2" -->
<div id="STRMS472" class="sect2"><a id="sthref385"></a>
<h3 class="sect2">Maximum Checkpoint SCN<a id="sthref386"></a><a id="sthref387"></a><a id="sthref388"></a></h3>
<p>The SCN that corresponds to the last checkpoint recorded by a capture process is the <span class="bold">maximum checkpoint SCN</span>. If you create a capture process that captures changes from a <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>, and other capture processes already exist which capture changes from the same source database, then the maximum checkpoint SCNs of the existing capture processes can help you to decide whether the new capture process should create a <a href="strms_glossary.htm#CBACJIJH"><span class="xrefglossterm">LogMiner data dictionary</span></a> or share one of the existing LogMiner data dictionaries. You can determine the maximum checkpoint SCN for a capture process by querying the <code dir="ltr">MAX_CHECKPOINT_SCN</code> column in the <code dir="ltr">DBA_CAPTURE</code> data dictionary view.</p>
</div>
<!-- class="sect2" -->
<div id="STRMS473" class="sect2"><a id="sthref389"></a>
<h3 class="sect2">Checkpoint Retention Time<a id="sthref390"></a><a id="sthref391"></a></h3>
<p>The <span class="bold">checkpoint retention time</span> is the amount of time, in number of days, that a capture process retains checkpoints before purging them automatically. A capture process periodically computes the age of a checkpoint by subtracting the <code dir="ltr">NEXT_TIME</code> of the archived redo log file that corresponds to the checkpoint from <code dir="ltr">FIRST_TIME</code> of the archived redo log file containing the required checkpoint SCN for the capture process. If the resulting value is greater than the checkpoint retention time, then the capture process automatically purges the checkpoint by advancing its <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> value. Otherwise, the checkpoint is retained. The <code dir="ltr">DBA_REGISTERED_ARCHIVED_LOG</code> view displays the <code dir="ltr">FIRST_TIME</code> and <code dir="ltr">NEXT_TIME</code> for archived redo log files, and the <code dir="ltr">REQUIRED_CHECKPOINT_SCN</code> column in the <code dir="ltr">DBA_CAPTURE</code> view displays the required checkpoint SCN for a capture process.</p>
<p><a href="#BABJIEGH">Figure 7-1</a> shows an example of a checkpoint being purged when the checkpoint retention time is set to 20 days.</p>
<div id="STRMS474" class="figure">
<p class="titleinfigure"><a id="BABJIEGH"></a>Figure 7-1 Checkpoint Retention Time Set to 20 Days</p>
<img width="510" height="212" src="img/strms051.gif" alt="Description of Figure 7-1 follows"/><br/>
<a id="sthref392" href="img_text/strms051.htm">Description of &#34;Figure 7-1 Checkpoint Retention Time Set to 20 Days&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>In <a href="#BABJIEGH">Figure 7-1</a>, with the checkpoint retention time set to 20 days, the checkpoint at SCN 435250 is purged because it is 21 days old, while the checkpoint at SCN 479315 is retained because it is 8 days old.</p>
<p>Whenever the first SCN is reset for a capture process, the capture process purges information about archived redo log files before the new first SCN from its LogMiner data dictionary. After this information is purged, the archived redo log files remain on the hard disk, but the files are not needed by the capture process. The <code dir="ltr">PURGEABLE</code> column in the <code dir="ltr">DBA_REGISTERED_ARCHIVED_LOG</code> view displays <code dir="ltr">YES</code> for the archived redo log files that are no longer needed. These files can be removed from disk or moved to another location without affecting the capture process.</p>
<p>If you create a capture process using the <code dir="ltr">CREATE_CAPTURE</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package, then you can specify the checkpoint retention time, in days, using the <code dir="ltr">checkpoint_retention_time</code> parameter. The default checkpoint retention time is 60 days if the <code dir="ltr">checkpoint_retention_time</code> parameter is not specified in the <code dir="ltr">CREATE_CAPTURE</code> procedure, or if you use the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create the capture process. The <code dir="ltr">CHECKPOINT_RETENTION_TIME</code> column in the <code dir="ltr">DBA_CAPTURE</code> view displays the current checkpoint retention time for a capture process.</p>
<p>You can change the checkpoint retention time for a capture process by specifying a new time period in the <code dir="ltr">ALTER_CAPTURE</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package. If you do not want checkpoints for a capture process to be purged automatically, then specify <code dir="ltr">DBMS_CAPTURE_ADM.INFINITE</code> for the <code dir="ltr">checkpoint_retention_time</code> parameter in <code dir="ltr">CREATE_CAPTURE</code> or <code dir="ltr">ALTER_CAPTURE</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
To specify a checkpoint retention time for a capture process, the compatibility level of the database running the capture process must be <code dir="ltr">10.2.0</code> or higher. If the compatibility level is lower than <code dir="ltr">10.2.0</code> for a database, then the checkpoint retention time for all capture processes running on the database is infinite.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#i1010542">&#34;The LogMiner Data Dictionary for a Capture Process&#34;</a></p>
</li>
<li>
<p><a href="#i1014885">&#34;A New First SCN Value and Purged LogMiner Data Dictionary Information&#34;</a></p>
</li>
<li>
<p><a href="strms_mcap.htm#BEHGFEIB">&#34;Managing the Checkpoint Retention Time for a Capture Process&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS302" href="../ARPLS/d_cap_a.htm#ARPLS302"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">CREATE_CAPTURE</code> and <code dir="ltr">ALTER_CAPTURE</code> procedures</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1014885"></a>
<div id="STRMS475" class="sect1">
<h2 class="sect1">A New First SCN Value and Purged LogMiner Data Dictionary Information</h2>
<p>If you reset the <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> value for an existing capture process, or if the first SCN is reset automatically when checkpoints are purged, then Oracle automatically purges <a href="strms_glossary.htm#CBACJIJH"><span class="xrefglossterm">LogMiner data dictionary</span></a> information before the new first SCN setting. If the <a href="strms_glossary.htm#CHDIJJCD"><span class="xrefglossterm">start SCN</span></a> for a capture process corresponds to redo information that has been purged, then Oracle Database automatically resets the start SCN to the same value as the first SCN. However, if the start SCN is higher than the new first SCN setting, then the start SCN remains unchanged.</p>
<p><a href="#i1011622">Figure 7-2</a> shows how Oracle automatically purges LogMiner data dictionary information prior to a new first SCN setting, and how the start SCN is not changed if it is higher than the new first SCN setting.</p>
<div id="STRMS476" class="figure">
<p class="titleinfigure"><a id="i1011622"></a>Figure 7-2 Start SCN Higher than Reset First SCN</p>
<img width="600" height="192" src="img/strms038.gif" alt="Description of Figure 7-2 follows"/><br/>
<a id="sthref393" href="img_text/strms038.htm">Description of &#34;Figure 7-2 Start SCN Higher than Reset First SCN&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Given this example, if the first SCN is reset again to a value higher than the start SCN value for a capture process, then the start SCN no longer corresponds to existing information in the LogMiner data dictionary. <a href="#i1011800">Figure 7-3</a> shows how Oracle Database resets the start SCN automatically if it is lower than a new first SCN setting.</p>
<div id="STRMS477" class="figure">
<p class="titleinfigure"><a id="i1011800"></a>Figure 7-3 Start SCN Lower than Reset First SCN</p>
<img width="600" height="168" src="img/strms039.gif" alt="Description of Figure 7-3 follows"/><br/>
<a id="sthref394" href="img_text/strms039.htm">Description of &#34;Figure 7-3 Start SCN Lower than Reset First SCN&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>As you can see, the first SCN and start SCN for a capture process can continually increase over time, and, as the first SCN moves forward, it might no longer correspond to an SCN established by the <code dir="ltr">DBMS_CAPTURE_ADM.BUILD</code> procedure.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1009464">&#34;First SCN and Start SCN&#34;</a></p>
</li>
<li>
<p><a href="strms_mcap.htm#i1006494">&#34;Setting the Start SCN for an Existing Capture Process&#34;</a></p>
</li>
<li>
<p>The <code dir="ltr">DBMS_CAPTURE_ADM.ALTER_CAPTURE</code> procedure in the <a class="olink ARPLS312" href="../ARPLS/d_cap_a.htm#ARPLS312"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about altering a capture process</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i1007010"></a>
<div id="STRMS210" class="sect1">
<h2 class="sect1">ARCHIVELOG Mode and a Capture Process<a id="sthref395"></a><a id="sthref396"></a><a id="sthref397"></a><a id="sthref398"></a><a id="sthref399"></a></h2>
<p>The following list describes how different types of capture processes read the redo data:</p>
<ul>
<li>
<p>A <a href="strms_glossary.htm#CHDDGCGH"><span class="xrefglossterm">local capture process</span></a> reads from the redo log buffer whenever possible. If it cannot read from the log buffer, then it reads from the online redo logs. If it cannot read from the log buffer or the online redo logs, then it reads from the archived redo log files. Therefore, the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> must be running in <code dir="ltr">ARCHIVELOG</code> mode when a local capture process is configured to capture changes.</p>
</li>
<li>
<p>A <a href="strms_glossary.htm#CBAJHHEI"><span class="xrefglossterm">real-time downstream capture process</span></a> reads online redo data from its source database whenever possible and archived redo log files that contain redo data from the source database otherwise. In this case, the redo data from the source database is stored in the standby redo log at the <a href="strms_glossary.htm#CHDBJECA"><span class="xrefglossterm">downstream database</span></a>, and the archiver at the downstream database archives the redo data in the standby redo log. Therefore, both the source database and the downstream database must be running in <code dir="ltr">ARCHIVELOG</code> mode when a real-time downstream capture process is configured to capture changes.</p>
</li>
<li>
<p>An <a href="strms_glossary.htm#CBAFGBGE"><span class="xrefglossterm">archived-log downstream capture process</span></a> always reads archived redo log files from its source database. Therefore, the source database must be running in <code dir="ltr">ARCHIVELOG</code> mode when an archived-log downstream capture process is configured to capture changes.</p>
</li>
</ul>
<p>You can query the <code dir="ltr">REQUIRED_CHECKPOINT_SCN</code> column in the <code dir="ltr">DBA_CAPTURE</code> data dictionary view to determine the <a href="strms_glossary.htm#CHDJHFCB"><span class="xrefglossterm">required checkpoint SCN</span></a> for a capture process. When the capture process is restarted, it scans the redo log from the required checkpoint SCN forward. Therefore, the redo log file that includes the required checkpoint SCN, and all subsequent redo log files, must be available to the capture process.</p>
<p>You must keep an archived redo log file available until you are certain that no capture process will need that file. The <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> for a capture process can be reset to a higher value, but it cannot be reset to a lower value. Therefore, a capture process will never need the redo log files that contain information before its first SCN. Query the <code dir="ltr">DBA_LOGMNR_PURGED_LOG</code> data dictionary view to determine which archived redo log files will never be needed by any capture process.</p>
<p>When a local capture process falls behind, there is a seamless transition from reading an online redo log to reading an archived redo log, and, when a local capture process catches up, there is a seamless transition from reading an archived redo log to reading an online redo log. Similarly, when a real-time downstream capture process falls behind, there is a seamless transition from reading the standby redo log to reading an archived redo log, and, when a real-time downstream capture process catches up, there is a seamless transition from reading an archived redo log to reading the standby redo log.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
At a downstream database in a downstream capture configuration, log files from a remote source database should be kept separate from local database log files. In addition, if the downstream database contains log files from multiple source databases, then the log files from each source database should be kept separate from each other.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADMIN008" href="../ADMIN/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about running a database in <code dir="ltr">ARCHIVELOG</code> mode</p>
</li>
<li>
<p><a href="strms_cpmon.htm#i1021143">&#34;Displaying SCN Values for Each Redo Log File Used by Each Capture Process&#34;</a> for a query that determines which redo log files are no longer needed</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i1006795"></a>
<div id="STRMS211" class="sect1">
<h2 class="sect1">Capture Process Creation<a id="sthref400"></a><a id="sthref401"></a><a id="sthref402"></a></h2>
<p>You can create a capture process using a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package or the <code dir="ltr">DBMS_CAPTURE_ADM</code> package. Using a procedure the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create a capture process is simpler because the procedure automatically uses defaults for some configuration options. In addition, when you use a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package, a <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> is created for the capture process, and <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s can be added to the rule set automatically. The rule set is a <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> if the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code> (the default) in the procedure, or it is a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> if the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">FALSE</code> in the procedure.</p>
<p>Alternatively, using the <code dir="ltr">CREATE_CAPTURE</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package to create a capture process is more flexible, and you create one or more rule sets and rules for the capture process either before or after it is created. You can use the procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package or the <code dir="ltr">DBMS_RULE_ADM</code> package to add rules to a rule set for the capture process. To create a capture process at a <a href="strms_glossary.htm#CHDBJECA"><span class="xrefglossterm">downstream database</span></a>, you must use the <code dir="ltr">DBMS_CAPTURE_ADM</code> package.</p>
<p>When you create a capture process using a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package and generate one or more rules in the positive rule set for the capture process, the objects for which changes are captured are prepared for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> automatically, unless it is a <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a> and there is no database link from the downstream database to the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>.</p>
<p>When you create a capture process using the <code dir="ltr">CREATE_CAPTURE</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package, you should prepare for instantiation any objects for which you plan to capture changes. Prepare these objects for instantiations as soon as possible after capture process creation. You can prepare objects for instantiation using one of the following procedures in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package:</p>
<ul>
<li>
<p><code dir="ltr">PREPARE_TABLE_INSTANTIATION</code> prepares a single table for instantiation.</p>
</li>
<li>
<p><code dir="ltr">PREPARE_SCHEMA_INSTANTIATION</code> prepares for instantiation all of the objects in a schema and all objects added to the schema in the future.</p>
</li>
<li>
<p><code dir="ltr">PREPARE_GLOBAL_INSTANTIATION</code> prepares for instantiation all of the objects in a database and all objects added to the database in the future.</p>
</li>
</ul>
<p>These procedures can also enable <a href="strms_glossary.htm#CHDIHHGA"><span class="xrefglossterm">supplemental logging</span></a> for the key columns or for all columns in the table or tables prepared for instantiation.</p>
<div class="infobox-note">
<p class="notep1"><a id="sthref403"></a><a id="sthref404"></a><a id="sthref405"></a><a id="sthref406"></a>Note:</p>
After creating a capture process, avoid changing the <code dir="ltr">DBID</code> or global name of the source database for the capture process. If you change either the <code dir="ltr">DBID</code> or global name of the source database, then the capture process must be dropped and re-created.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP209" href="../STREP/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> and <a class="olink ARPLS" href="../ARPLS/toc.htm"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the procedures that can create a capture process</p>
</li>
<li>
<p><a class="olink STREP" href="../STREP/toc.htm"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about <a class="olink STREP115" href="../STREP/instant.htm#STREP115">capture process rules and preparation for instantiation,</a> and for more information about <a class="olink STREP135" href="../STREP/man_gen_rep.htm#STREP135">changing the DBID or global name of a source database</a></p>
</li>
</ul>
</div>
<a id="i1010542"></a>
<div id="STRMS478" class="sect2">
<h3 class="sect2">The LogMiner Data Dictionary for a Capture Process<a id="sthref407"></a><a id="sthref408"></a><a id="sthref409"></a></h3>
<p>A capture process requires a data dictionary that is separate from the primary data dictionary for the source database. This separate data dictionary is called a <span class="bold">LogMiner data dictionary</span>. There can be more than one LogMiner data dictionary for a particular source database. If there are multiple capture processes capturing changes from the source database, then two or more capture processes can share a LogMiner data dictionary, or each capture process can have its own LogMiner data dictionary. If the LogMiner data dictionary that is needed by a capture process does not exist, then the capture process populates it using information in the redo log when the capture process is started for the first time.</p>
<p>The <code dir="ltr">DBMS_CAPTURE_ADM.BUILD</code> procedure extracts data dictionary information to the redo log, and this procedure must be run at least once on the source database before any capture process configured to capture changes originating at the source database is started. The extracted data dictionary information in the redo log is consistent with the primary data dictionary at the time when the <code dir="ltr">DBMS_CAPTURE_ADM.BUILD</code> procedure is run. This procedure also identifies a valid <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> value that you can use to create a capture process.</p>
<p>You can perform a build of data dictionary information in the redo log multiple times, and a particular build might or might not be used by a capture process to create a LogMiner data dictionary. The amount of information extracted to a redo log when you run the <code dir="ltr">BUILD</code> procedure depends on the number of database objects in the database. Typically, the <code dir="ltr">BUILD</code> procedure generates a large amount of redo data that a capture process must scan subsequently. Therefore, you should run the <code dir="ltr">BUILD</code> procedure only when necessary.</p>
<p>In most cases, if a build is required when a capture process is created using a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> or <code dir="ltr">DBMS_CAPTURE_ADM</code> package, then the procedure runs the <code dir="ltr">BUILD</code> procedure automatically. However, the <code dir="ltr">BUILD</code> procedure is not run automatically during capture process creation in the following cases:</p>
<ul>
<li>
<p>You use <code dir="ltr">CREATE_CAPTURE</code> and specify a non-<code dir="ltr">NULL</code> value for the <code dir="ltr">first_scn</code> parameter. In this case, the specified first SCN must correspond to a previous build.</p>
</li>
<li>
<p>You create a downstream capture process that does not use a database link. In this case, the command at the downstream database cannot communicate with the source database to run the <code dir="ltr">BUILD</code> procedure automatically. Therefore, you must run it manually on the source database and specify the first SCN that corresponds to the build during capture process creation.</p>
</li>
</ul>
<p>A capture process requires a LogMiner data dictionary because the information in the primary data dictionary might not apply to the changes being captured from the redo log. These changes might have occurred minutes, hours, or even days before they are captured by a capture process. For example, consider the following scenario:</p>
<ol>
<li>
<p>A capture process is configured to capture changes to tables.</p>
</li>
<li>
<p>A database administrator stops the capture process. When the capture process is stopped, it records the SCN of the change it was currently capturing.</p>
</li>
<li>
<p>User applications continue to make changes to the tables while the capture process is stopped.</p>
</li>
<li>
<p>The capture process is restarted three hours after it was stopped.</p>
</li>
</ol>
<p>In this case, to ensure data consistency, the capture process must begin capturing changes in the redo log at the time when it was stopped. The capture process starts capturing changes at the SCN that it recorded when it was stopped.</p>
<p>The redo log contains raw data. It does not contain database object names and column names in tables. Instead, it uses object numbers and internal column numbers for database objects and columns, respectively. Therefore, when a change is captured, a capture process must reference a data dictionary to determine the details of the change.</p>
<p>Because a LogMiner data dictionary might be populated when a capture process is started for the first time, it might take some time to start capturing changes. The amount of time required depends on the number of database objects in the database. You can query the <code dir="ltr">STATE</code> column in the <code dir="ltr">V$STREAMS_CAPTURE</code> dynamic performance view to monitor the progress while a capture process is processing a data dictionary build.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#i1010527">&#34;Capture Process Rule Evaluation&#34;</a></p>
</li>
<li>
<p><a href="strms_capture.htm#i1009464">&#34;First SCN and Start SCN&#34;</a></p>
</li>
<li>
<p><a href="strms_capture.htm#i1014290">&#34;Capture Process States&#34;</a></p>
</li>
<li>
<p><a class="olink STREP114" href="../STREP/instant.htm#STREP114"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about preparing database objects for instantiation</p>
</li>
</ul>
</div>
<div id="STRMS479" class="sect3"><a id="sthref410"></a>
<h4 class="sect3">Scenario Illustrating Why a Capture Process Needs a LogMiner Data Dictionary</h4>
<p>Consider a scenario in which a capture process has been configured to capture changes to table <code dir="ltr">t1</code>, which has columns <code dir="ltr">a</code> and <code dir="ltr">b</code>, and the following changes are made to this table at three different points in time:</p>
<p><span class="bold">Time 1:</span> Insert values <code dir="ltr">a=7</code> and <code dir="ltr">b=15</code>.</p>
<p><span class="bold">Time 2:</span> Add column <code dir="ltr">c</code>.</p>
<p><span class="bold">Time 3:</span> Drop column <code dir="ltr">b</code>.</p>
<p>If for some reason the capture process is capturing changes from an earlier time, then the primary data dictionary and the relevant version in the LogMiner data dictionary contain different information. <a href="#g1023093">Table 7-1</a> illustrates how the information in the LogMiner data dictionary is used when the current time is different than the change capturing time.</p>
<div id="STRMS480" class="tblformalwide">
<p class="titleintable"><a id="sthref411"></a><a id="g1023093"></a>Table 7-1 Information About Table t1 in the Primary and LogMiner Data Dictionaries</p>
<table class="cellalignment5973" title="Information About Table t1 in the Primary and LogMiner Data Dictionaries" summary="This table lists the state of table t1 at different points in time. For each point in time, the table lists change capturing time, the state of table t1 in the primary data dictionary, and the state of table t1 in the LogMiner data dictionary." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t14">Current Time</th>
<th class="cellalignment5974" id="r1c2-t14">Change Capturing Time</th>
<th class="cellalignment5974" id="r1c3-t14">Primary Data Dictionary</th>
<th class="cellalignment5974" id="r1c4-t14">LogMiner Data Dictionary</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t14" headers="r1c1-t14">
<p>1</p>
</td>
<td class="cellalignment5970" headers="r2c1-t14 r1c2-t14">
<p>1</p>
</td>
<td class="cellalignment5970" headers="r2c1-t14 r1c3-t14">
<p>Table <code dir="ltr">t1</code> has columns <code dir="ltr">a</code> and <code dir="ltr">b</code>.</p>
</td>
<td class="cellalignment5970" headers="r2c1-t14 r1c4-t14">
<p>Table <code dir="ltr">t1</code> has columns <code dir="ltr">a</code> and <code dir="ltr">b</code> at time 1.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t14" headers="r1c1-t14">
<p>2</p>
</td>
<td class="cellalignment5970" headers="r3c1-t14 r1c2-t14">
<p>1</p>
</td>
<td class="cellalignment5970" headers="r3c1-t14 r1c3-t14">
<p>Table <code dir="ltr">t1</code> has columns <code dir="ltr">a</code>, <code dir="ltr">b</code>, and <code dir="ltr">c</code> at time 2.</p>
</td>
<td class="cellalignment5970" headers="r3c1-t14 r1c4-t14">
<p>Table <code dir="ltr">t1</code> has columns <code dir="ltr">a</code> and <code dir="ltr">b</code> at time 1.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t14" headers="r1c1-t14">
<p>3</p>
</td>
<td class="cellalignment5970" headers="r4c1-t14 r1c2-t14">
<p>1</p>
</td>
<td class="cellalignment5970" headers="r4c1-t14 r1c3-t14">
<p>Table <code dir="ltr">t1</code> has columns <code dir="ltr">a</code> and <code dir="ltr">c</code> at time 3.</p>
</td>
<td class="cellalignment5970" headers="r4c1-t14 r1c4-t14">
<p>Table <code dir="ltr">t1</code> has columns <code dir="ltr">a</code> and <code dir="ltr">b</code> at time 1.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformalwide" -->
<p>Assume that the capture process captures the change resulting from the insert at time&nbsp;1 when the actual time is time 3. If the capture process used the primary data dictionary, then it might assume that a value of <code dir="ltr">7</code> was inserted into column <code dir="ltr">a</code> and a value of <code dir="ltr">15</code> was inserted into column <code dir="ltr">c</code>, because those are the two columns for table <code dir="ltr">t1</code> at time&nbsp;3 in the primary data dictionary. However, a value of <code dir="ltr">15</code> actually was inserted into column <code dir="ltr">b</code>, not column <code dir="ltr">c</code>.</p>
<p>Because the capture process uses the LogMiner data dictionary, the error is avoided. The LogMiner data dictionary is synchronized with the capture process and continues to record that table <code dir="ltr">t1</code> has columns <code dir="ltr">a</code> and <code dir="ltr">b</code> at time 1. So, the captured change specifies that a value of <code dir="ltr">15</code> was inserted into column <code dir="ltr">b</code>.</p>
</div>
<!-- class="sect3" -->
<div id="STRMS481" class="sect3"><a id="sthref412"></a>
<h4 class="sect3">Multiple Capture Processes for the Same Source Database</h4>
<p>If one or more capture processes are capturing changes made to a source database, and you want to create a capture process that captures changes to the same source database, then the new capture process can either create a LogMiner data dictionary or share one of the existing LogMiner data dictionaries with one or more other capture processes.</p>
<p>Whether a new LogMiner data dictionary is created for a new capture process depends on the setting for the <code dir="ltr">first_scn</code> parameter when you run <code dir="ltr">CREATE_CAPTURE</code> to create a capture process.</p>
<p><a id="sthref413"></a><a id="sthref414"></a>If multiple LogMiner data dictionaries exist, and you specify <code dir="ltr">NULL</code> for the <code dir="ltr">first_scn</code> parameter during capture process creation, then the new capture process automatically attempts to share the LogMiner data dictionary of one of the existing capture processes that has taken at least one <a href="strms_glossary.htm#CHDBFBJI"><span class="xrefglossterm">checkpoint</span></a>. You can view the <a href="strms_glossary.htm#CHDEJIHG"><span class="xrefglossterm">maximum checkpoint SCN</span></a> for all existing capture processes by querying the <code dir="ltr">MAX_CHECKPOINT_SCN</code> column in the <code dir="ltr">DBA_CAPTURE</code> data dictionary view. During capture process creation, if the <code dir="ltr">first_scn</code> parameter is <code dir="ltr">NULL</code> and the <code dir="ltr">start_scn</code> parameter is non-<code dir="ltr">NULL</code>, then an error is raised if the <code dir="ltr">start_scn</code> parameter setting is lower than all of the first SCN values for all existing capture processes.</p>
<p>If multiple LogMiner data dictionaries exist, and you specify a non-<code dir="ltr">NULL</code> value for the <code dir="ltr">first_scn</code> parameter during capture process creation, then the new capture process creates a new LogMiner data dictionary the first time it is started. In this case, before you create the new capture process, you must run the <code dir="ltr">BUILD</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package on the source database. The <code dir="ltr">BUILD</code> procedure generates a corresponding valid first SCN value that you can specify when you create the new capture process.</p>
<p>You can find a first SCN generated by the <code dir="ltr">BUILD</code> procedure by running the following query:</p>
<pre dir="ltr">COLUMN FIRST_CHANGE# HEADING &#39;First SCN&#39; FORMAT 999999999
COLUMN NAME HEADING &#39;Log File Name&#39; FORMAT A50

SELECT DISTINCT FIRST_CHANGE#, NAME FROM V$ARCHIVED_LOG
  WHERE DICTIONARY_BEGIN = &#39;YES&#39;;
</pre>
<p>This query can return more than one row if the <code dir="ltr">BUILD</code> procedure was run more than once.</p>
<p>The most important factor to consider when deciding whether a new capture process should share an existing LogMiner data dictionary or create one is the difference between the maximum checkpoint SCN values of the existing capture processes and the <a href="strms_glossary.htm#CHDIJJCD"><span class="xrefglossterm">start SCN</span></a> of the new capture process. If the new capture process shares a LogMiner data dictionary, then it must scan the redo log from the point of the maximum checkpoint SCN of the shared LogMiner data dictionary onward, even though the new capture process cannot capture changes before its first SCN. If the start SCN of the new capture process is much higher than the maximum checkpoint SCN of the existing capture process, then the new capture process must scan a large amount of redo data before it reaches its start SCN.</p>
<p>A capture process creates a new LogMiner data dictionary when the <code dir="ltr">first_scn</code> parameter is non-<code dir="ltr">NULL</code> during capture process creation. Follow these guidelines when you decide whether a new capture process should share an existing LogMiner data dictionary or create one:</p>
<ul>
<li>
<p>If one or more maximum checkpoint SCN values is greater than the start SCN you want to specify, and if this start SCN is greater than the first SCN of one or more existing capture processes, then it might be better to share the LogMiner data dictionary of an existing capture process. In this case, you can assume there is a checkpoint SCN that is less than the start SCN and that the difference between this checkpoint SCN and the start SCN is small. The new capture process will begin scanning the redo log from this checkpoint SCN and will catch up to the start SCN quickly.</p>
</li>
<li>
<p>If no maximum checkpoint SCN is greater than the start SCN, and if the difference between the maximum checkpoint SCN and the start SCN is small, then it might be better to share the LogMiner data dictionary of an existing capture process. The new capture process will begin scanning the redo log from the maximum checkpoint SCN, but it will catch up to the start SCN quickly.</p>
</li>
<li>
<p>If no maximum checkpoint SCN is greater than the start SCN, and if the difference between the highest maximum checkpoint SCN and the start SCN is large, then it might take a long time for the capture process to catch up to the start SCN. In this case, it might be better for the new capture process to create a LogMiner data dictionary. It will take some time to create the new LogMiner data dictionary when the new capture process is first started, but the capture process can specify the same value for its first SCN and start SCN, and thereby avoid scanning a large amount of redo data unnecessarily.</p>
</li>
</ul>
<p><a href="#i1011860">Figure 7-4</a> illustrates these guidelines.</p>
<div id="STRMS482" class="figure">
<p class="titleinfigure"><a id="i1011860"></a>Figure 7-4 Deciding Whether to Share a LogMiner Data Dictionary</p>
<img width="600" height="336" src="img/strms042.gif" alt="Description of Figure 7-4 follows"/><br/>
<a id="sthref415" href="img_text/strms042.htm">Description of &#34;Figure 7-4 Deciding Whether to Share a LogMiner Data Dictionary&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>If you create a capture process using one of the procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package, then it is the same as specifying <code dir="ltr">NULL</code> for the <code dir="ltr">first_scn</code> and <code dir="ltr">start_scn</code> parameters in the <code dir="ltr">CREATE_CAPTURE</code> procedure.</p>
</li>
<li>
<p>You must prepare database objects for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> if a new capture process will capture changes made to these database objects. This requirement holds even if the new capture process shares a LogMiner data dictionary with one or more other capture processes for which these database objects have been prepared for instantiation.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1009464">&#34;First SCN and Start SCN&#34;</a></p>
</li>
<li>
<p><a href="#i1010653">&#34;Capture Process Checkpoints&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS311" href="../ARPLS/d_cap_a.htm#ARPLS311"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about setting the <code dir="ltr">first_scn</code> and <code dir="ltr">start_scn</code> parameters in the <code dir="ltr">CREATE_CAPTURE</code> procedure</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1010145"></a>
<div id="STRMS138" class="sect1">
<h2 class="sect1">The Oracle Streams Data Dictionary<a id="sthref416"></a><a id="sthref417"></a></h2>
<p>Propagations and <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>es use an <span class="bold">Oracle Streams data dictionary</span> to keep track of the database objects from a particular <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>. An Oracle Streams data dictionary is populated whenever one or more database objects are prepared for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> at a source database. Specifically, when a database object is prepared for instantiation, it is recorded in the redo log. When a capture process scans the redo log, it uses this information to populate the local Oracle Streams data dictionary for the source database. For local capture, this Oracle Streams data dictionary is at the source database. For downstream capture, this Oracle Streams data dictionary is at the <a href="strms_glossary.htm#CHDBJECA"><span class="xrefglossterm">downstream database</span></a>.</p>
<p>When you prepare a database object for instantiation, you are informing Oracle Streams that information about the database object is needed by <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s that propagate changes to the database object and apply processes that apply changes to the database object. Any database that propagates or applies these changes requires an Oracle Streams data dictionary for the source database where the changes originated.</p>
<p>After an object has been prepared for instantiation, the local Oracle Streams data dictionary is updated when a DDL statement on the object is processed by a capture process. In addition, an internal <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> containing information about this DDL statement is captured and placed in the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> for the capture process. Propagations can then propagate these internal messages to <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a>s at databases.</p>
<p>An Oracle Streams data dictionary is multiversioned. If a database has multiple propagations and apply processes, then all of them use the same Oracle Streams data dictionary for a particular source database. A database can contain only one Oracle Streams data dictionary for a particular source database, but it can contain multiple Oracle Streams data dictionaries if it propagates or applies changes from multiple source databases.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP113" href="../STREP/instant.htm#STREP113"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about instantiation</p>
</li>
<li>
<p><a href="strms_adprop.htm#i1007091">&#34;Oracle Streams Data Dictionary for Propagations&#34;</a></p>
</li>
<li>
<p><a href="strms_adapply.htm#i1007130">&#34;Oracle Streams Data Dictionary for an Apply Process&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i1010527"></a>
<div id="STRMS157" class="sect1">
<h2 class="sect1">Capture Process Rule Evaluation<a id="sthref418"></a><a id="sthref419"></a></h2>
<p>A capture process evaluates changes it finds in the redo log against its positive and <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>s. The capture process evaluates a change against the negative rule set first. If one or more <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s in the negative rule set evaluate to <code dir="ltr">TRUE</code> for the change, then the change is discarded, but if no rule in the negative rule set evaluates to <code dir="ltr">TRUE</code> for the change, then the change satisfies the negative rule set. When a change satisfies the negative rule set for a capture process, the capture process evaluates the change against its <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>. If one or more rules in the positive rule set evaluate to <code dir="ltr">TRUE</code> for the change, then the change satisfies the positive rule set, but if no rule in the positive rule set evaluates to <code dir="ltr">TRUE</code> for the change, then the change is discarded. If a capture process only has one rule set, then it evaluates changes against this one rule set only.</p>
<p>A running capture process completes the following series of actions to capture changes:</p>
<ol>
<li>
<p>Finds changes in the redo log.</p>
</li>
<li>
<p>Performs prefiltering of the changes in the redo log. During this step, a capture process evaluates rules in its rule sets at a basic level to place changes found in the redo log into two categories: changes that should be converted into LCRs and changes that should not be converted into LCRs. Prefiltering is done in two phases. In the first phase, information that can be evaluated during prefiltering includes schema name, object name, and command type. If more information is needed to determine whether a change should be converted into an LCR, then information that can be evaluated during the second phase of prefiltering includes <a href="strms_glossary.htm#CHDBJJHH"><span class="xrefglossterm">tag</span></a> values and column values when appropriate.</p>
<p>Prefiltering is a safe optimization done with incomplete information. This step identifies relevant changes to be processed subsequently, such that:</p>
<ul>
<li>
<p>A capture process converts a change into an LCR if the change satisfies the capture process rule sets. In this case, proceed to Step <a href="#CACDJJGH">3</a>.</p>
</li>
<li>
<p>A capture process does not convert a change into an LCR if the change does not satisfy the capture process rule sets.</p>
</li>
<li>
<p>Regarding <code dir="ltr">MAYBE</code> evaluations, the rule evaluation proceeds as follows:</p>
<ul>
<li>
<p>If a change evaluates to <code dir="ltr">MAYBE</code> against both the positive and negative rule set for a capture process, then the capture process might not have enough information to determine whether the change will definitely satisfy both of its rule sets. In this case, further evaluation is necessary. Proceed to Step&nbsp;<a href="#CACDJJGH">3</a>.</p>
</li>
<li>
<p>If the change evaluates to <code dir="ltr">FALSE</code> against the negative rule set and <code dir="ltr">MAYBE</code> against the positive rule set for the capture process, then the capture process might not have enough information to determine whether the change will definitely satisfy both of its rule sets. In this case, further evaluation is necessary. Proceed to Step <a href="#CACDJJGH">3</a>.</p>
</li>
<li>
<p>If the change evaluates to <code dir="ltr">MAYBE</code> against the negative rule set and <code dir="ltr">TRUE</code> against the positive rule set for the capture process, then the capture process might not have enough information to determine whether the change will definitely satisfy both of its rule sets. In this case, further evaluation is necessary. Proceed to Step <a href="#CACDJJGH">3</a>.</p>
</li>
<li>
<p>If the change evaluates to <code dir="ltr">TRUE</code> against the negative rule set and <code dir="ltr">MAYBE</code> against the positive rule set for the capture process, then the capture process discards the change.</p>
</li>
<li>
<p>If the change evaluates to <code dir="ltr">MAYBE</code> against the negative rule set and <code dir="ltr">FALSE</code> against the positive rule set for the capture process, then the capture process discards the change.</p>
</li>
</ul>
</li>
</ul>
</li>
<li id="CACDJJGH">
<p>Converts changes that satisfy, or might satisfy, the capture process rule sets into LCRs based on prefiltering.</p>
</li>
<li>
<p>Performs LCR filtering. During this step, a capture process evaluates rules regarding information in each LCR to separate the LCRs into two categories: LCRs that should be enqueued and LCRs that should be discarded.</p>
</li>
<li>
<p>Discards the LCRs that should not be enqueued because they did not satisfy the capture process rule sets.</p>
</li>
<li>
<p>Enqueues the remaining <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s into the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> associated with the capture process.</p>
</li>
</ol>
<p>For example, suppose the following rule is defined in the positive rule set for a capture process: Capture changes to the <code dir="ltr">hr.employees</code> table where the <code dir="ltr">department_id</code> is&nbsp;<code dir="ltr">50</code>. No other rules are defined for the capture process, and the <code dir="ltr">parallelism</code> parameter for the capture process is set to <code dir="ltr">1</code>.</p>
<p>Given this rule, suppose an <code dir="ltr">UPDATE</code> statement on the <code dir="ltr">hr.employees</code> table changes 50 rows in the table. The capture process performs the following series of actions for each row change:</p>
<ol>
<li>
<p>Finds the next change resulting from the <code dir="ltr">UPDATE</code> statement in the redo log.</p>
</li>
<li>
<p>Determines that the change resulted from an <code dir="ltr">UPDATE</code> statement to the <code dir="ltr">hr.employees</code> table and must be captured. If the change was made to a different table, then the capture process ignores the change.</p>
</li>
<li>
<p>Captures the change and converts it into an LCR.</p>
</li>
<li>
<p>Filters the LCR to determine whether it involves a row where the <code dir="ltr">department_id</code> is <code dir="ltr">50.</code></p>
</li>
<li>
<p>Either enqueues the LCR into the queue associated with the capture process if it involves a row where the <code dir="ltr">department_id</code> is <code dir="ltr">50</code>, or discards the LCR if it involves a row where the <code dir="ltr">department_id</code> is not <code dir="ltr">50</code> or is missing.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006718">&#34;Capture Process Subcomponents&#34;</a></p>
</li>
<li>
<p><a href="strms_rules.htm#g1049257">Chapter 5, &#34;How Rules Are Used in Oracle Streams&#34;</a> for more information about rule sets for <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>s and for information about how messages satisfy rule sets</p>
</li>
</ul>
</div>
</li>
</ol>
<p><a href="#i1007098">Figure 7-5</a> illustrates capture process rule evaluation in a flowchart.</p>
<div id="STRMS483" class="figure">
<p class="titleinfigure"><a id="i1007098"></a>Figure 7-5 Flowchart Showing Capture Process Rule Evaluation</p>
<img width="416" height="521" src="img/strms026.gif" alt="Description of Figure 7-5 follows"/><br/>
<a id="sthref420" href="img_text/strms026.htm">Description of &#34;Figure 7-5 Flowchart Showing Capture Process Rule Evaluation&#34;</a><br/>
<br/></div>
<!-- class="figure" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="pt_adconcepts.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="strms_adqueue.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>