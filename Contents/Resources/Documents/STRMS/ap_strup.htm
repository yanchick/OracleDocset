<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104375"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Online%20Upgrade%20of%20an%20Earlier%20Database%20with%20Oracle%20Streams"></a><title>Online Upgrade of an Earlier Database with Oracle Streams</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:8Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="ap_strmnt.htm" title="Previous" type="text/html"/>
<link rel="Next" href="strms_glossary.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">55/57</span> <!-- End Header -->
<div id="STRMS140" class="appendix"><a id="g654383"></a> <a id="i642623"></a>
<h1 class="appendix"><span class="secnum">E</span> Online Upgrade of an Earlier Database with Oracle Streams</h1>
<p><a id="sthref1623"></a><a id="sthref1624"></a>This appendix describes how to perform a database upgrade from one of the following Oracle Database releases with Oracle Streams:</p>
<ul>
<li>
<p>Oracle Database 10<span class="italic">g</span> Release 1 (10.1)</p>
</li>
<li>
<p>Oracle9<span class="italic">i</span> Release 2 (9.2)</p>
</li>
</ul>
<p>The database upgrade operation described in this appendix uses the features of Oracle Streams to achieve little or no database down time.</p>
<p>The following topics describe performing an online database upgrade with Oracle Streams:</p>
<ul>
<li>
<p><a href="#i635228">Overview of Using Oracle Streams in the Database Upgrade Process</a></p>
</li>
<li>
<p><a href="#CHDBHEDG">Preparing for a Database Upgrade Using Oracle Streams</a></p>
</li>
<li>
<p><a href="#i635237">Performing a Database Upgrade Using Oracle Streams</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="ap_strmnt.htm#CIHEHEEA">Appendix D, &#34;Online Database Upgrade and Maintenance with Oracle Streams&#34;</a> for information about upgrading from Oracle Database 10<span class="italic">g</span> Release 2 (10.2) or later and for information about performing other database maintenance operations with Oracle Streams</div>
<a id="i635228"></a>
<div id="STRMS1230" class="sect1">
<h2 class="sect1">Overview of Using Oracle Streams in the Database Upgrade Process</h2>
<p>An Oracle database upgrade is the process of transforming an existing, prior release of an Oracle database into the current release. A database upgrade typically requires substantial database down time, but you can perform a database upgrade with little or no down time by using the features of Oracle Streams. To do so, you use Oracle Streams to configure a <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment with the following databases:</p>
<ul>
<li>
<p><span class="bold">Source Database:</span> The original database that is being upgraded.</p>
</li>
<li>
<p><span class="bold">Capture Database:</span> The database where a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> captures changes made to the source database during the upgrade.</p>
</li>
<li>
<p><span class="bold">Destination Database:</span> The copy of the source database where an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> applies changes made to the source database during the upgrade process.</p>
</li>
</ul>
<p>Specifically, you can use the following general steps to perform a database upgrade while the database is online:</p>
<ol>
<li>
<p>Create an empty <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>.</p>
</li>
<li>
<p>Configure an Oracle Streams replication environment where the original database is the source database and a copy of the database is the destination database for the changes made at the source.</p>
</li>
<li>
<p>Perform the database upgrade on the destination database. During this time the original source database is available online.</p>
</li>
<li>
<p>Use Oracle Streams to apply the changes made at the source database to the destination database.</p>
</li>
<li>
<p>When the destination database has caught up with the changes made at the source database, take the source database offline and make the destination database available for applications and users.</p>
</li>
</ol>
<p><a href="#CHDHHEBB">Figure E-1</a> provides an overview of this process.</p>
<div id="STRMS1231" class="figure">
<p class="titleinfigure"><a id="CHDHHEBB"></a>Figure E-1 Online Database Upgrade with Oracle Streams</p>
<img width="521" height="656" src="img/strms052.gif" alt="Description of Figure E-1 follows"/><br/>
<a id="sthref1625" href="img_text/strms052.htm">Description of &#34;Figure E-1 Online Database Upgrade with Oracle Streams&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<a id="CHDBGIAB"></a>
<div id="STRMS1232" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">The Capture Database During the Upgrade Process<a id="sthref1626"></a></h3>
<p>During the upgrade process, the capture database is the database where the <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> is created. Downstream capture was introduced in Oracle Database 10<span class="italic">g</span> Release 1 (10.1). If you are upgrading a database from Oracle Database 10<span class="italic">g</span> Release 1, then you have the following options:</p>
<ul>
<li>
<p>A <a href="strms_glossary.htm#CHDDGCGH"><span class="xrefglossterm">local capture process</span></a> can be created at the source database during the upgrade process.</p>
</li>
<li>
<p>A <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a> can be created at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>. If the destination database is the capture database, then a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> from the capture database to the destination database is not needed.</p>
</li>
<li>
<p>A third database can be the capture database. In this case, the third database can be an Oracle Database 10<span class="italic">g</span> Release 1 or later database.</p>
</li>
</ul>
<p>However, if you are upgrading a database from Oracle9<span class="italic">i</span> Release 2 (9.2) to Oracle Database 11<span class="italic">g</span> Release 2 or later, then downstream capture is not supported, and a local capture process must be created at the source database.</p>
<p>A downstream capture process reduces the resources required at the source database during the upgrade process, but a local capture process is easier to configure. <a href="#CHDEJAAC">Table E-1</a> describes which database can be the capture database during the upgrade process.</p>
<div id="STRMS1233" class="tblhruleformal">
<p class="titleintable"><a id="sthref1627"></a><a id="CHDEJAAC"></a>Table E-1 Supported Capture Database During Upgrade</p>
<table class="cellalignment5973" title="Supported Capture Database During Upgrade" summary="This table describes whether the source database, destination database, or a third database can be the capture database based on the release being upgraded." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t3">Existing Database Release</th>
<th class="cellalignment5974" id="r1c2-t3">Capture Database Can Be Source Database?</th>
<th class="cellalignment5974" id="r1c3-t3">Capture Database Can Be Destination Database?</th>
<th class="cellalignment5974" id="r1c4-t3">Capture Database Can Be Third Database?</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t3" headers="r1c1-t3">
<p>9.2</p>
</td>
<td class="cellalignment5970" headers="r2c1-t3 r1c2-t3">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r2c1-t3 r1c3-t3">
<p>No</p>
</td>
<td class="cellalignment5970" headers="r2c1-t3 r1c4-t3">
<p>No</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t3" headers="r1c1-t3">
<p>10.1</p>
</td>
<td class="cellalignment5970" headers="r3c1-t3 r1c2-t3">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r3c1-t3 r1c3-t3">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r3c1-t3 r1c4-t3">
<p>Yes</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformal" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are upgrading from Oracle Database 10<span class="italic">g</span> Release 1 (10.1), then, before you begin the upgrade, decide which database will be the capture database.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_capture.htm#i1013269">&#34;Local Capture and Downstream Capture&#34;</a></div>
</div>
<!-- class="sect2" -->
<a id="CHDHHBEA"></a>
<div id="STRMS1234" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Assumptions for the Database Being Upgraded<a id="sthref1628"></a></h3>
<p>The instructions in this appendix assume that all of the following statements are true for the database being upgraded:</p>
<ul>
<li>
<p>The database is not part of an existing Oracle Streams environment.</p>
</li>
<li>
<p>The database is not part of an existing logical standby environment.</p>
</li>
<li>
<p>The database is not part of an existing Advanced Replication environment.</p>
</li>
<li>
<p>No tables at the database are master tables for materialized views in other databases.</p>
</li>
<li>
<p>No messages are enqueued into user-created <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>s during the upgrade process.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CHDHECCI"></a>
<div id="STRMS1235" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Considerations for Job Queue Processes and PL/SQL Package Subprograms<a id="sthref1629"></a><a id="sthref1630"></a></h3>
<p>If possible, ensure that no job queue processes are created, modified, or deleted during the upgrade process, and that no Oracle-supplied PL/SQL package subprograms are invoked during the upgrade process that modify both user data and dictionary metadata at the same time. The following packages contain subprograms that modify both user data and dictionary metadata at the same time: <code dir="ltr">DBMS_RLS</code>, <code dir="ltr">DBMS_STATS</code>, and <code dir="ltr">DBMS_JOB</code>.</p>
<p>It might be possible to perform such actions on the database if you ensure that the same actions are performed on the source database and <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> in Steps <a href="#CHDJIFEA">13</a> and <a href="#CHDBDBDC">14</a> in <a href="#CHDHEIIJ">&#34;Task 5: Finishing the Upgrade and Removing Oracle Streams&#34;</a>. For example, if a PL/SQL procedure gathers statistics on the source database during the upgrade process, then the same PL/SQL procedure should be invoked at the destination database in Step&nbsp;<a href="#CHDBDBDC">14</a>.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDBHEDG"></a>
<div id="STRMS1236" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Preparing for a Database Upgrade Using Oracle Streams</h2>
<p>The following sections describe tasks to complete before starting the database upgrade with Oracle Streams:</p>
<ul>
<li>
<p><a href="#CHDBBIFD">Preparing to Upgrade a Database with User-Defined Types</a></p>
</li>
<li>
<p><a href="#CHDEAGDG">Deciding Which Utility to Use for Instantiation</a></p>
</li>
</ul>
<a id="CHDBBIFD"></a>
<div id="STRMS1237" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Preparing to Upgrade a Database with User-Defined Types<a id="sthref1631"></a></h3>
<p>User-defined types include object types, <code dir="ltr">REF</code> values, varrays, and nested tables. Currently, Oracle Streams <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es and <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>es do not support user-defined types. This section discusses using Oracle Streams to perform a database upgrade on a database that has user-defined types.</p>
<p>One option is to ensure that no data manipulation language (DML) or data definition language (DDL) changes are made to the tables that contain user-defined types during the database upgrade. In this case, these tables are instantiated at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>, and no changes are made to these tables during the entire operation. After the upgrade is complete, make the tables that contain user-defined types read/write at the destination database.</p>
<p>If tables that contain user-defined types must remain open during the upgrade, then use the following general steps to retain changes to these tables during the upgrade:</p>
<ol>
<li id="CHDGFJAA">
<p>Before you begin the upgrade process described in <a href="#i635237">&#34;Performing a Database Upgrade Using Oracle Streams&#34;</a>, create one or more logging tables to store row changes to tables at the source database that include user-defined types. Each column in the logging table must use a data type that is supported by Oracle Streams in the source database release.</p>
</li>
<li>
<p>Before you begin the upgrade process described in <a href="#i635237">&#34;Performing a Database Upgrade Using Oracle Streams&#34;</a>, create a DML trigger at the source database that fires on the tables that contain the user-defined data types. The trigger converts each row change into relational equivalents and logs the modified row in a logging table created in Step <a href="#CHDGFJAA">1</a>.</p>
</li>
<li>
<p>When the instructions in <a href="#i635237">&#34;Performing a Database Upgrade Using Oracle Streams&#34;</a> say to configure a capture process and <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>, configure the capture process and propagation to capture changes to the logging table and propagate these changes to the destination database. Changes to tables that contain user-defined types must not be captured or propagated.</p>
</li>
<li>
<p>When the instructions in <a href="#i635237">&#34;Performing a Database Upgrade Using Oracle Streams&#34;</a> say to configure a an apply process on the destination database, configure the apply process to use a <a href="strms_glossary.htm#CHDEAFJH"><span class="xrefglossterm">procedure DML handler</span></a> that processes the changes to the logging tables. The procedure DML handler reconstructs the user-defined types from the relational equivalents and applies the modified changes to the tables that contain user-defined types.</p>
</li>
</ol>
<p>For instructions, go to the My Oracle Support (formerly Oracle<span class="italic">MetaLink</span>) Web site using a Web browser:</p>
<pre dir="ltr"><a href="http://support.oracle.com/">http://support.oracle.com/</a>
</pre>
<p>Database bulletin 556742.1 describes additional data type support for Oracle Streams.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink LNPLS020" href="../LNPLS/overview.htm#LNPLS020"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information about creating triggers</p>
</li>
<li>
<p><a href="strms_mapply.htm#BGBJHGHG">&#34;Managing a DML Handler&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CHDEAGDG"></a>
<div id="STRMS1238" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Deciding Which Utility to Use for Instantiation<a id="sthref1632"></a><a id="sthref1633"></a><a id="sthref1634"></a><a id="sthref1635"></a><a id="sthref1636"></a><a id="sthref1637"></a></h3>
<p>Before you begin the database upgrade, decide whether you want to use the Export/Import utilities (Data Pump or original) or the Recovery Manager (RMAN) utility to instantiate the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> during the operation. The destination database will replace the existing database that is being upgraded.</p>
<p>Consider the following factors when you make this decision:</p>
<ul>
<li>
<p>If you use original Export/Import or Data Pump Export/Import, then you can make the destination database an Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later database at the beginning of the operation. Therefore, you do not need to upgrade the destination database after the <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a>.</p>
<p>If you use Export/Import for instantiation, and Data Pump is supported, then Oracle recommends using Data Pump. Data Pump can perform the instantiation faster than original Export/Import.</p>
</li>
<li>
<p>If you use the RMAN <code dir="ltr">DUPLICATE</code> command, then the instantiation might be faster than with Export/Import, especially if the database is large, but the database release must be the same for RMAN instantiation. Therefore, the following conditions must be met:</p>
<ul>
<li>
<p>If the database is an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then the destination database is an Oracle9<span class="italic">i</span> Database Release 2 database when it is instantiated.</p>
</li>
<li>
<p>If the database is an Oracle Database 10<span class="italic">g</span> Release&nbsp;1 (10.1) database, then the destination database is an Oracle Database 10<span class="italic">g</span> Release 1 database when it is instantiated.</p>
</li>
</ul>
<p>After the instantiation, you must upgrade the destination database.</p>
<p>Also, Oracle recommends that you do not use RMAN for instantiation in an environment where distributed transactions are possible. Doing so might cause in-doubt transactions that must be corrected manually.</p>
</li>
</ul>
<p><a href="#CHDGHFDH">Table E-2</a> describes whether each instantiation method is supported based on the release being upgraded, whether the platform at the source and destination databases are different, and whether the character set at the source and destination databases are different. Each instantiation method is supported when the platform and character set are the same at the source and destination databases.</p>
<div id="STRMS1239" class="tblhruleformal">
<p class="titleintable"><a id="sthref1638"></a><a id="CHDGHFDH"></a>Table E-2 Instantiation Methods for Database Upgrade with Oracle Streams</p>
<table class="cellalignment5973" title="Instantiation Methods for Database Upgrade with Oracle Streams" summary="This table describes when each instantiation method is supported based on the release being upgraded, whether the platform at the source and destination are the same or different, and whether the character set at the source and destination are the same or different." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t7">Instantiation Method</th>
<th class="cellalignment5974" id="r1c2-t7">Supported When Upgrading From</th>
<th class="cellalignment5974" id="r1c3-t7">Different Platforms Supported?</th>
<th class="cellalignment5974" id="r1c4-t7">Different Character Sets Supported?</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t7" headers="r1c1-t7">
<p>Original Export/Import</p>
</td>
<td class="cellalignment5970" headers="r2c1-t7 r1c2-t7">
<p>9.2 or 10.1</p>
</td>
<td class="cellalignment5970" headers="r2c1-t7 r1c3-t7">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r2c1-t7 r1c4-t7">
<p>Yes</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t7" headers="r1c1-t7">
<p>Data Pump Export/Import</p>
</td>
<td class="cellalignment5970" headers="r3c1-t7 r1c2-t7">
<p>10.1</p>
</td>
<td class="cellalignment5970" headers="r3c1-t7 r1c3-t7">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r3c1-t7 r1c4-t7">
<p>Yes</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t7" headers="r1c1-t7">
<p>RMAN <code dir="ltr">DUPLICATE</code></p>
</td>
<td class="cellalignment5970" headers="r4c1-t7 r1c2-t7">
<p>9.2 or 10.1</p>
</td>
<td class="cellalignment5970" headers="r4c1-t7 r1c3-t7">
<p>No</p>
</td>
<td class="cellalignment5970" headers="r4c1-t7 r1c4-t7">
<p>No</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformal" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i635237"></a>
<div id="STRMS1240" class="sect1">
<h2 class="sect1">Performing a Database Upgrade Using Oracle Streams</h2>
<p>This section contains instructions for performing a database upgrade using Oracle Streams. These instructions describe using Oracle Streams to upgrade one of the following Oracle Database releases: Oracle9<span class="italic">i</span> Release 2 (9.2) or Oracle Database 10<span class="italic">g</span> Release 1 (10.1).</p>
<p>Complete the following tasks to upgrade a database using Oracle Streams:</p>
<ul>
<li>
<p><a href="#CHDIACCF">Task 1: Beginning the Upgrade</a></p>
</li>
<li>
<p><a href="#CHDJDEBA">Task 2: Setting Up Oracle Streams Before Instantiation</a></p>
</li>
<li>
<p><a href="#CHDDAAAA">Task 3: Instantiating the Database</a></p>
</li>
<li>
<p><a href="#CHDDCDDG">Task 4: Setting Up Oracle Streams After Instantiation</a></p>
</li>
<li>
<p><a href="#CHDHEIIJ">Task 5: Finishing the Upgrade and Removing Oracle Streams</a></p>
</li>
</ul>
<a id="CHDIACCF"></a>
<div id="STRMS1241" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 1: Beginning the Upgrade</h3>
<p>Complete the following steps to begin the upgrade using Oracle Streams:</p>
<ol>
<li>
<p>Create an empty <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>. Ensure that this database has a different global name than the source database. This example assumes that the global name of the source database is <code dir="ltr">orcl.example.com</code> and the global name of the destination database during the upgrade is <code dir="ltr">updb.example.com</code>. The global name of the destination database is changed when the destination database replaces the source database at the end of the upgrade process.</p>
<p>The release of the empty database you create depends on the <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> method you decided to use in <a href="#CHDEAGDG">&#34;Deciding Which Utility to Use for Instantiation&#34;</a>:</p>
<ul>
<li>
<p>If you decided to use export/import for instantiation, then create an empty Oracle Database 11<span class="italic">g</span> Release 2 or later database. This database will be the destination database during the upgrade process.</p>
<p>See the Oracle Database installation guide for your operating system if you must install Oracle Database, and see the <a class="olink ADMIN002" href="../ADMIN/create.htm#ADMIN002"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about creating a database.</p>
</li>
<li>
<p>If you decided to use RMAN for instantiation, then create an empty Oracle database that is the same release as the database you are upgrading.</p>
<p>Specifically, if you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then create an Oracle9<span class="italic">i</span> Release 2 database. Alternatively, if you are upgrading an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database, then create an Oracle Database 10<span class="italic">g</span> Release 1 database.</p>
<p>This database will be the destination database during the upgrade process. Both the source database that is being upgraded and the destination database must be the same release of Oracle when you start the upgrade process.</p>
<p>See the Oracle installation guide for your operating system if you must install Oracle, and see the Oracle <span class="italic">Database Administrator&#39;s Guide</span> for the release for information about creating a database.</p>
</li>
</ul>
</li>
<li>
<p>Ensure that the source database is running in <code dir="ltr">ARCHIVELOG</code> mode. See the Oracle <span class="italic">Database Administrator&#39;s Guide</span> for the source database release for information about running a database in <code dir="ltr">ARCHIVELOG</code> mode.</p>
</li>
<li>
<p>Ensure that the initialization parameters are set properly at each database to support an Oracle Streams environment. For the source database, see the Oracle Streams documentation for the source database release. For the destination database, see <a class="olink STREP201" href="../STREP/prep_rep.htm#STREP201"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about setting initialization parameters that are relevant to Oracle Streams. If the capture database is a third database, then see the Oracle Streams documentation for the capture database release.</p>
</li>
<li>
<p>At the source database, ensure that no changes are made during the upgrade process to any database objects that were not supported by Oracle Streams in the release you are upgrading:</p>
<ul>
<li>
<p>If you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then tables with columns of the following data types are not supported: <code dir="ltr">NCLOB</code>, <code dir="ltr">LONG</code>, <code dir="ltr">LONG</code> <code dir="ltr">RAW</code>, <code dir="ltr">BFILE</code>, <code dir="ltr">ROWID</code>, and <code dir="ltr">UROWID</code>, and user-defined types (including object types, REFs, varrays, and nested tables). In addition, the following types of tables are not supported: temporary tables, index-organized tables, and object tables. See <span class="italic">Oracle9i Streams</span> for complete information about unsupported database objects.</p>
</li>
<li>
<p>If you are upgrading an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database, then query the <code dir="ltr">DBA_STREAMS_UNSUPPORTED</code> data dictionary view to list the database objects that are not supported by Oracle Streams. Ensure that no changes are made to these database objects during the upgrade process.</p>
</li>
</ul>
<p><a href="#CHDBBIFD">&#34;Preparing to Upgrade a Database with User-Defined Types&#34;</a> discusses a method for retaining changes to tables that contain user-defined types during the upgrade. If you are using this method, then tables that contain user-defined types can remain open during the upgrade.</p>
</li>
<li>
<p>At the source database, configure an Oracle Streams administrator:</p>
<ul>
<li>
<p>If you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then see <span class="italic">Oracle9i Streams</span> for more information.</p>
</li>
<li>
<p>If you are upgrading an Oracle Database 10<span class="italic">g</span> Release 1 database, then see <span class="italic">Oracle Streams Concepts and Administration</span> for that release for more information.</p>
</li>
</ul>
<p>These instructions assume that the name of the Oracle Streams administrator at the source database is <code dir="ltr">strmadmin</code>. This Oracle Streams administrator will be copied automatically to the destination database during instantiation.</p>
</li>
<li>
<p>In SQL*Plus, connect to the source database <code dir="ltr">orcl.example.com</code> as an administrative user.</p>
<p>See the Oracle <span class="italic">Database Administrator&#39;s Guide</span> for the source database release for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Specify <a href="strms_glossary.htm#CBAGJGIJ"><span class="xrefglossterm">database supplemental logging</span></a> of primary keys, unique keys, and foreign keys for all updates. For example:</p>
<pre dir="ltr">ALTER DATABASE ADD SUPPLEMENTAL LOG DATA 
   (PRIMARY KEY, UNIQUE, FOREIGN KEY) COLUMNS; 
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CHDJDEBA"></a>
<div id="STRMS1242" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 2: Setting Up Oracle Streams Before Instantiation</h3>
<p>The specific instructions for setting up Oracle Streams before <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> depend on which database is the capture database. Follow the instructions in the appropriate section:</p>
<ul>
<li>
<p><a href="#CHDECJEI">The Source Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CHDJDAEA">The Destination Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CHDCHGEF">A Third Database Is the Capture Database</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i635228">&#34;Overview of Using Oracle Streams in the Database Upgrade Process&#34;</a> for information about the capture database</div>
<a id="CHDECJEI"></a>
<div id="STRMS1243" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">The Source Database Is the Capture Database</h4>
<p>Complete the following steps to set up Oracle Streams before instantiation when the source database is the capture database:</p>
<ol>
<li>
<p>Configure your network and Oracle Net so that the source database can communicate with the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>In SQL*Plus, connect to the source database <code dir="ltr">orcl.example.com</code> as the Oracle Streams administrator.</p>
<p>Seethe Oracle <span class="italic">Database Administrator&#39;s Guide</span> for the source database release for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDCHAEC">
<p>Create an <code dir="ltr">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.capture_queue_table&#39;,
    queue_name  =&gt; &#39;strmadmin.capture_queue&#39;);
END;
/
</pre></li>
<li>
<p>Configure a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="#CHDCHAEC">3</a>. Do not start the capture process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; &#39;capture&#39;,
    streams_name       =&gt; &#39;capture_upgrade&#39;,
    queue_name         =&gt; &#39;strmadmin.capture_queue&#39;,
    include_dml        =&gt; TRUE,
    include_ddl        =&gt; TRUE,
    include_tagged_lcr =&gt; FALSE,
    source_database    =&gt; &#39;orcl.example.com&#39;,
    inclusion_rule     =&gt; TRUE);
END;
/
</pre>
<p><a href="#CHDBBIFD">&#34;Preparing to Upgrade a Database with User-Defined Types&#34;</a> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database release for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s.</p>
</li>
<li>
<p>Proceed to <a href="#CHDDAAAA">&#34;Task 3: Instantiating the Database&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDJDAEA"></a>
<div id="STRMS1244" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">The Destination Database Is the Capture Database</h4>
<p>The database being upgraded must be an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database to use this option. Complete the following steps to set up Oracle Streams before instantiation when the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> is the capture database:</p>
<ol>
<li>
<p>Configure your network and Oracle Net so that the source database and destination database can communicate with each other. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li id="CHDFEIDH">
<p>Follow the instructions in the appropriate section based on the method you are using for instantiation:</p>
<ul>
<li>
<p><a href="#CHDHGCGD"><span class="bold">Export/Import</span></a></p>
</li>
<li>
<p><a href="#CHDEABJA"><span class="bold">RMAN</span></a></p>
</li>
</ul>
<p><a id="CHDHGCGD"></a><span class="bold">Export/Import</span></p>
<p>Complete the following steps if you are using export/import for instantiation:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the destination database <code dir="ltr">updb.example.com</code> as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDGGGAB">
<p>Create an <code dir="ltr">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.destination_queue_table&#39;,
    queue_name  =&gt; &#39;strmadmin.destination_queue&#39;);
END;
/
</pre></li>
<li>
<p>Configure a downstream <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="#CHDGGGAB">b</a>. Ensure that the capture process uses a database link to the source database. The capture process can be a <a href="strms_glossary.htm#CBAJHHEI"><span class="xrefglossterm">real-time downstream capture process</span></a> or an <a href="strms_glossary.htm#CBAFGBGE"><span class="xrefglossterm">archived-log downstream capture process</span></a>. See <a class="olink STREP209" href="../STREP/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information. Do not start the capture process.</p>
<p><a href="#CHDBBIFD">&#34;Preparing to Upgrade a Database with User-Defined Types&#34;</a> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s.</p>
</li>
</ol>
<p><a id="CHDEABJA"></a><span class="bold">RMAN</span></p>
<p>Complete the following steps if you are using RMAN for instantiation:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the source database <code dir="ltr">orcl.example.com</code> as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDIFHCC">
<p>Perform a build of the data dictionary in the redo log:</p>
<pre dir="ltr">SET SERVEROUTPUT ON
DECLARE
  scn  NUMBER;
BEGIN
  DBMS_CAPTURE_ADM.BUILD(
    first_scn =&gt; scn);
  DBMS_OUTPUT.PUT_LINE(&#39;First SCN Value = &#39; || scn);
END;
/
First SCN Value = 1122610
</pre>
<p>This procedure displays the valid <a href="strms_glossary.htm#CHDCJHGI"><span class="xrefglossterm">first SCN</span></a> value for the capture process that will be created at the destination database. Make a note of the SCN value returned because you will use it when you create the capture process at the destination database.</p>
</li>
<li>
<p>Prepare the source database for instantiation:</p>
<pre dir="ltr">exec DBMS_CAPTURE_ADM.PREPARE_GLOBAL_INSTANTIATION();
</pre></li>
</ol>
</li>
<li>
<p>Proceed to <a href="#CHDDAAAA">&#34;Task 3: Instantiating the Database&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDCHGEF"></a>
<div id="STRMS1245" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">A Third Database Is the Capture Database</h4>
<p>To use this option, meet the following requirements:</p>
<ul>
<li>
<p>The database being upgraded must be an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database.</p>
</li>
<li>
<p>The third database must be an Oracle Database 10<span class="italic">g</span> Release 1 or later database.</p>
</li>
</ul>
<p>This example assumes that the global name of the third database is <code dir="ltr">thrd.example.com</code>. Complete the following steps to set up Oracle Streams before instantiation when a third database is the capture database:</p>
<ol>
<li>
<p>Configure your network and Oracle Net so that the source database, <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>, and third database can communicate with each other. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>In SQL*Plus, connect to the third database <code dir="ltr">thrd.example.com</code> as an administrative user.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create an Oracle Streams administrator:</p>
<ul>
<li>
<p>If the third database is an Oracle Database 10<span class="italic">g</span> database or an Oracle Database 11<span class="italic">g</span> Release 1 database, then see the <span class="italic">Oracle Streams Concepts and Administration</span> book for that release for more information.</p>
</li>
<li>
<p>If the third database is an Oracle Database 11<span class="italic">g</span> Release 2 or later database, then see <a class="olink STREP200" href="../STREP/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
</li>
</ul>
<p>These instructions assume that the name of the Oracle Streams administrator at the third database is <code dir="ltr">strmadmin</code>.</p>
</li>
<li id="CHDEDJJH">
<p>While still connected to the third database as the Oracle Streams administrator, create an <code dir="ltr">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.capture_queue_table&#39;,
    queue_name  =&gt; &#39;strmadmin.capture_queue&#39;);
END;
/
</pre></li>
<li>
<p>Configure a downstream <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="#CHDEDJJH">4</a>. Ensure that the capture process uses a database link to the source database. Do not start the capture process.</p>
<p>See the following documentation for more information:</p>
<ul>
<li>
<p>If the capture database is an Oracle Database 10<span class="italic">g</span> database or an Oracle Database 11<span class="italic">g</span> Release 1 database, then see the <span class="italic">Oracle Streams Concepts and Administration</span> book for that release for more information.</p>
</li>
<li>
<p>If the capture database is an Oracle Database 11<span class="italic">g</span> Release 2 or later database, then see <a class="olink STREP209" href="../STREP/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a>.</p>
</li>
</ul>
<p>The capture process can be a <a href="strms_glossary.htm#CBAJHHEI"><span class="xrefglossterm">real-time downstream capture process</span></a> or an <a href="strms_glossary.htm#CBAFGBGE"><span class="xrefglossterm">archived-log downstream capture process</span></a>.</p>
<p><a href="#CHDBBIFD">&#34;Preparing to Upgrade a Database with User-Defined Types&#34;</a> discusses a method for retaining changes to tables that contain user-defined types during the upgrade operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s.</p>
</li>
<li>
<p>Proceed to <a href="#CHDDAAAA">&#34;Task 3: Instantiating the Database&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDDAAAA"></a>
<div id="STRMS1246" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 3: Instantiating the Database</h3>
<p><a href="#CHDEAGDG">&#34;Deciding Which Utility to Use for Instantiation&#34;</a> discusses different options for instantiating an entire database. Complete the steps in the appropriate section based on the <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> option you are using:</p>
<ul>
<li>
<p><a href="#CHDIDADD">Instantiating the Database Using Export/Import</a></p>
</li>
<li>
<p><a href="#CHDJADGC">Instantiating the Database Using RMAN</a></p>
</li>
</ul>
<a id="CHDIDADD"></a>
<div id="STRMS1247" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Instantiating the Database Using Export/Import</h4>
<p>Complete the following steps to instantiate the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> using export/import:</p>
<ol>
<li>
<p>Instantiate the destination database using Export/Import. See <a class="olink STREP342" href="../STREP/instant.htm#STREP342"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about performing instantiations, and see <a class="olink SUTIL" href="../SUTIL/toc.htm"><span class="italic">Oracle Database Utilities</span></a> for information about performing an export/import using the Export and Import utilities.</p>
<p>If you use Oracle Data Pump or original Export/Import to instantiate the destination database, then ensure that the following parameters are set to the appropriate values:</p>
<ul>
<li>
<p>Set the <code dir="ltr">STREAMS_CONFIGURATION</code> import parameter to <code dir="ltr">n</code>.</p>
</li>
<li>
<p>If you use original Export/Import, then set the <code dir="ltr">CONSISTENT</code> export parameter to <code dir="ltr">y</code>. This parameter does not apply to Data Pump exports.</p>
</li>
<li>
<p>If you use original Export/Import, then set the <code dir="ltr">STREAMS_INSTANTIATION</code> import parameter to <code dir="ltr">y</code>. This parameter does not apply to Data Pump imports.</p>
</li>
</ul>
<p>If you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then you must use original Export/Import.</p>
</li>
<li>
<p>At the destination database, disable any imported jobs that modify data that will be replicated from the source database. Query the <code dir="ltr">DBA_JOBS</code> data dictionary view to list the jobs.</p>
</li>
<li>
<p>Proceed to <a href="#CHDDCDDG">&#34;Task 4: Setting Up Oracle Streams After Instantiation&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDJADGC"></a>
<div id="STRMS1248" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Instantiating the Database Using RMAN<a id="sthref1639"></a><a id="sthref1640"></a></h4>
<p>Complete the following steps to instantiate the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> using the RMAN <code dir="ltr">DUPLICATE</code> command:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
These steps provide a general outline for using RMAN to duplicate a database. If you are upgrading an Oracle9<span class="italic">i</span> Release 2 database, then see the <span class="italic">Oracle9i Recovery Manager User&#39;s Guide</span> for detailed information about using RMAN in that release. If you upgrading an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database, then see the <span class="italic">Oracle Database Backup and Recovery Advanced User&#39;s Guide</span> for that release.</div>
<ol>
<li>
<p>Create a backup of the source database if one does not exist. RMAN requires a valid backup for duplication. In this example, create a backup of <code dir="ltr">orcl.example.com</code> if one does not exist.</p>
</li>
<li>
<p>In SQL*Plus, connect to the source database <code dir="ltr">orcl.example.com</code> as an administrative user.</p>
<p>Seethe Oracle <span class="italic">Database Administrator&#39;s Guide</span> for the source database release for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="i637292">
<p>Determine the until SCN for the RMAN <code dir="ltr">DUPLICATE</code> command. For example:</p>
<pre dir="ltr">SET SERVEROUTPUT ON SIZE 1000000
DECLARE
  until_scn NUMBER;
BEGIN
  until_scn:= DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER;
      DBMS_OUTPUT.PUT_LINE(&#39;Until SCN: &#39; || until_scn);
END;
/
</pre>
<p>Make a note of the until SCN value. This example assumes that the until SCN value is <code dir="ltr">439882</code>. You will set the <code dir="ltr">UNTIL</code> <code dir="ltr">SCN</code> option to this value when you use RMAN to duplicate the database in Step <a href="#i637379">7</a>.</p>
</li>
<li id="i640742">
<p>While still connected as an administrative user in SQL*Plus to the source database, archive the current online redo log. For example:</p>
<pre dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
<li>
<p>Prepare your environment for database duplication, which includes preparing the destination database as an auxiliary instance for duplication. See the documentation for the release from which you are upgrading for more information. Specifically, see the &#34;Duplicating a Database with Recovery Manager&#34; chapter in the <span class="italic">Oracle9i Recovery Manager User&#39;s Guide</span> or <span class="italic">Oracle Database Backup and Recovery Advanced User&#39;s Guide</span> (10<span class="italic">g</span>) for more information.</p>
</li>
<li>
<p>Start the RMAN client, and connect to the database <code dir="ltr">orcl.example.com</code> as <code dir="ltr">TARGET</code> and to the <code dir="ltr">updb.example.com</code> database as <code dir="ltr">AUXILIARY</code>. Connect to each database as an administrative user.</p>
<p>See the RMAN documentation for your Oracle Database release for more information about the RMAN <code dir="ltr">CONNECT</code> command.</p>
</li>
<li id="i637379">
<p>Use the RMAN <code dir="ltr">DUPLICATE</code> command with the <code dir="ltr">OPEN</code> <code dir="ltr">RESTRICTED</code> option to instantiate the source database at the destination database. The <code dir="ltr">OPEN</code> <code dir="ltr">RESTRICTED</code> option is required. This option enables a restricted session in the duplicate database by issuing the following SQL statement: <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">ENABLE</code> <code dir="ltr">RESTRICTED</code> <code dir="ltr">SESSION</code>. RMAN issues this statement immediately before the duplicate database is opened.</p>
<p>You can use the <code dir="ltr">UNTIL</code> <code dir="ltr">SCN</code> clause to specify an SCN for the duplication. Use the until SCN determined in Step <a href="#i637292">3</a> for this clause. Archived redo logs must be available for the until SCN specified and for higher SCN values. Therefore, Step <a href="#i640742">4</a> archived the redo log containing the until SCN.</p>
<p>Ensure that you use <code dir="ltr">TO</code> <code dir="ltr"><span class="codeinlineitalic">database_name</span></code> in the <code dir="ltr">DUPLICATE</code> command to specify the database name of the duplicate database. In this example, the database name of the duplicate database is <code dir="ltr">updb</code>. Therefore, the <code dir="ltr">DUPLICATE</code> command for this example includes <code dir="ltr">TO</code> <code dir="ltr">updb</code>.</p>
<p>The following is an example of an RMAN <code dir="ltr">DUPLICATE</code> command:</p>
<pre dir="ltr">RMAN&gt; RUN
      { 
        SET UNTIL SCN 439882;
        ALLOCATE AUXILIARY CHANNEL updb DEVICE TYPE sbt; 
        DUPLICATE TARGET DATABASE TO updb 
        NOFILENAMECHECK
        OPEN RESTRICTED;
      }
</pre></li>
<li>
<p>In SQL*Plus, connect to the destination database as an administrative user.</p>
</li>
<li>
<p>Use the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> statement to disable the <code dir="ltr">RESTRICTED</code> <code dir="ltr">SESSION</code>:</p>
<pre dir="ltr">ALTER SYSTEM DISABLE RESTRICTED SESSION;
</pre></li>
<li>
<p>While still connected as an administrative user in SQL*Plus to the destination database, rename the database global name. After the RMAN <code dir="ltr">DUPLICATE</code> command, the destination database has the same global name as the source database, but the destination database must have its original name until the end of the upgrade. For example:</p>
<pre dir="ltr">ALTER DATABASE RENAME GLOBAL_NAME TO updb.example.com;
</pre></li>
<li id="i639975">
<p>At the destination database, disable any jobs that modify data that will be replicated from the source database. Query the <code dir="ltr">DBA_JOBS</code> data dictionary view to list the jobs.</p>
</li>
<li>
<p>Upgrade the destination database to Oracle Database 11<span class="italic">g</span> Release 2 or later. See the <a class="olink UPGRD" href="../UPGRD/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a> for more information.</p>
</li>
<li>
<p>If you have not done so already, configure your network and Oracle Net so that the source database and destination database can communicate with each other. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>Connect to the destination database as the Oracle Streams administrator in SQL*Plus. In this example, the destination database is <code dir="ltr">updb.example.com</code>.</p>
</li>
<li>
<p>Create a database link to the source database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK orcl.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;orcl.example.com&#39;;
</pre></li>
<li id="i637029">
<p>Set the <a href="strms_glossary.htm#CHDHBBHE"><span class="xrefglossterm">instantiation SCN</span></a> for the entire database and all of the database objects. The RMAN <code dir="ltr">DUPLICATE</code> command duplicates the database up to one less than the SCN value specified in the <code dir="ltr">UNTIL</code> <code dir="ltr">SCN</code> clause. Therefore, you should subtract one from the until SCN value that you specified when you ran the <code dir="ltr">DUPLICATE</code> command in Step <a href="#i637379">7</a>. In this example, the until SCN was set to <code dir="ltr">439882</code>. Therefore, the instantiation SCN should be set to <code dir="ltr">439882</code> <code dir="ltr">-</code> <code dir="ltr">1</code>, or&nbsp;<code dir="ltr">439881</code>.</p>
<pre dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_GLOBAL_INSTANTIATION_SCN(
    source_database_name =&gt; &#39;orcl.example.com&#39;,
    instantiation_scn    =&gt; 439881,
    recursive            =&gt; TRUE);
END;
/
</pre></li>
<li>
<p>Proceed to <a href="#CHDDCDDG">&#34;Task 4: Setting Up Oracle Streams After Instantiation&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDDCDDG"></a>
<div id="STRMS1249" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 4: Setting Up Oracle Streams After Instantiation</h3>
<p>The specific instructions for setting up Oracle Streams after <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> depend on which database is the capture database. Follow the instructions in the appropriate section:</p>
<ul>
<li>
<p><a href="#CHDGGFEA">The Source Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CHDHEBEF">The Destination Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CHDEDCDF">A Third Database Is the Capture Database</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i635228">&#34;Overview of Using Oracle Streams in the Database Upgrade Process&#34;</a> for information about the capture database</div>
<a id="CHDGGFEA"></a>
<div id="STRMS1250" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">The Source Database Is the Capture Database</h4>
<p>Complete the following steps to set up Oracle Streams after instantiation when the source database is the capture database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">updb.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Remove the Oracle Streams components that were cloned from the source database during instantiation:</p>
<ul>
<li>
<p>If export/import was used for instantiation, then remove the <code dir="ltr">ANYDATA</code> queue that was cloned from the source database.</p>
</li>
<li>
<p>If RMAN was used for instantiation, then remove the <code dir="ltr">ANYDATA</code> queue and the capture process that were cloned from the source database.</p>
</li>
</ul>
<p>To remove the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> that was cloned from the source database, run the <code dir="ltr">REMOVE_QUEUE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.REMOVE_QUEUE(
    queue_name              =&gt; &#39;strmadmin.capture_queue&#39;,
    cascade                 =&gt; FALSE,
    drop_unused_queue_table =&gt; TRUE);
END;
/
</pre>
<p>To remove the capture process that was cloned from the source database, run the <code dir="ltr">DROP_CAPTURE</code> procedure in the <code dir="ltr">DBMS_CAPTURE_ADM</code> package. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.DROP_CAPTURE(
    capture_name          =&gt; &#39;capture_upgrade&#39;,
    drop_unused_rule_sets =&gt; TRUE);
END;
/
</pre></li>
<li id="CHDGABFH">
<p>Create an <code dir="ltr">ANYDATA</code> queue. This queue will stage changes propagated from the source database. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.destination_queue_table&#39;,
    queue_name  =&gt; &#39;strmadmin.destination_queue&#39;);
END;
/
</pre></li>
<li>
<p>Connect to the source database as the Oracle Streams administrator. In this example, the source database is <code dir="ltr">orcl.example.com</code>.</p>
</li>
<li>
<p>Create a database link to the destination database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK updb.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;updb.example.com&#39;;
</pre></li>
<li>
<p>Create a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> that propagates all changes from the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> to the destination database created in Step <a href="#CHDGABFH">3</a>. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_PROPAGATION_RULES(
    streams_name            =&gt; &#39;to_updb&#39;,
    source_queue_name       =&gt; &#39;strmadmin.capture_queue&#39;,
    destination_queue_name  =&gt; &#39;strmadmin.destination_queue@updb.example.com&#39;, 
    include_dml             =&gt; TRUE,
    include_ddl             =&gt; TRUE,
    include_tagged_lcr      =&gt; TRUE,
    source_database         =&gt; &#39;orcl.example.com&#39;);
END;
/
</pre></li>
<li>
<p>Connect to the destination database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Create an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> that applies all changes in the queue created in Step&nbsp;<a href="#CHDGABFH">3</a>. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; &#39;apply&#39;,
    streams_name       =&gt; &#39;apply_upgrade&#39;,
    queue_name         =&gt; &#39;strmadmin.destination_queue&#39;,
    include_dml        =&gt; TRUE,
    include_ddl        =&gt; TRUE,
    include_tagged_lcr =&gt; TRUE,
    source_database    =&gt; &#39;orcl.example.com&#39;);
END;
/
</pre></li>
<li>
<p>Proceed to <a href="#CHDHEIIJ">&#34;Task 5: Finishing the Upgrade and Removing Oracle Streams&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDHEBEF"></a>
<div id="STRMS1251" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">The Destination Database Is the Capture Database</h4>
<p>Complete the following steps to set up Oracle Streams after instantiation when the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> is the capture database:</p>
<ol>
<li>
<p>Complete the following steps if you used RMAN for instantiation. If you used export/import for instantiation, then proceed to Step <a href="#CHDDHECB">2</a>.</p>
<ol>
<li>
<p>In SQL*Plus, connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">updb.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDBAAII">
<p>Create an <code dir="ltr">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.destination_queue_table&#39;,
    queue_name  =&gt; &#39;strmadmin.destination_queue&#39;);
END;
/
</pre></li>
<li>
<p>Configure a <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="#CHDBAAII">b</a>.</p>
<p>Ensure that you set the <code dir="ltr">first_scn</code> parameter in the <code dir="ltr">CREATE_CAPTURE</code> procedure to the value obtained for the data dictionary build in Step <a href="#CHDFEIDH">2</a><a href="#CHDIFHCC">b</a> in <a href="#CHDJDAEA">&#34;The Destination Database Is the Capture Database&#34;</a>. In this example, the <code dir="ltr">first_scn</code> parameter should be set to <code dir="ltr">1122610</code>.</p>
<p>The capture process can be a <a href="strms_glossary.htm#CBAJHHEI"><span class="xrefglossterm">real-time downstream capture process</span></a> or an <a href="strms_glossary.htm#CBAFGBGE"><span class="xrefglossterm">archived-log downstream capture process</span></a>. See <a class="olink STREP209" href="../STREP/ccap.htm#STREP209"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information. Do not start the capture process.</p>
<p><a href="#CHDBBIFD">&#34;Preparing to Upgrade a Database with User-Defined Types&#34;</a> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s.</p>
</li>
</ol>
</li>
<li id="CHDDHECB">
<p>Create an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> that applies all changes in the queue used by the downstream capture process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; &#39;apply&#39;,
    streams_name       =&gt; &#39;apply_upgrade&#39;,
    queue_name         =&gt; &#39;strmadmin.destination_queue&#39;,
    include_dml        =&gt; TRUE,
    include_ddl        =&gt; TRUE,
    include_tagged_lcr =&gt; TRUE,
    source_database    =&gt; &#39;orcl.example.com&#39;);
END;
/
</pre></li>
<li>
<p>Proceed to <a href="#CHDHEIIJ">&#34;Task 5: Finishing the Upgrade and Removing Oracle Streams&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CHDEDCDF"></a>
<div id="STRMS1252" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">A Third Database Is the Capture Database</h4>
<p>This example assumes that the global name of the third database is <code dir="ltr">thrd.example.com</code>. Complete the following steps to set up Oracle Streams after instantiation when a third database is the capture database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">updb.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDFIJDA">
<p>Create an <code dir="ltr">ANYDATA</code> queue. This <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> will stage changes propagated from the capture database. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; &#39;strmadmin.destination_queue_table&#39;,
    queue_name  =&gt; &#39;strmadmin.destination_queue&#39;);
END;
/
</pre></li>
<li>
<p>Connect to the capture database as the Oracle Streams administrator. In this example, the capture database is <code dir="ltr">thrd.example.com</code>.</p>
</li>
<li id="CHDCIJHE">
<p>Create a database link to the destination database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK updb.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;updb.example.com&#39;;
</pre></li>
<li>
<p>Create a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> that propagates all changes from the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> at the capture database to the <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a> created in Step <a href="#CHDFIJDA">2</a>. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_PROPAGATION_RULES(
    streams_name            =&gt; &#39;to_updb&#39;,
    source_queue_name       =&gt; &#39;strmadmin.capture_queue&#39;,
    destination_queue_name  =&gt; &#39;strmadmin.destination_queue@updb.example.com&#39;, 
    include_dml             =&gt; TRUE,
    include_ddl             =&gt; TRUE,
    include_tagged_lcr      =&gt; TRUE,
    source_database         =&gt; &#39;orcl.example.com&#39;);
END;
/
</pre></li>
<li>
<p>Connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">updb.example.com</code>.</p>
</li>
<li>
<p>Create an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> that applies all changes in the queue created in Step&nbsp;<a href="#CHDFIJDA">2</a>. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; &#39;apply&#39;,
    streams_name       =&gt; &#39;apply_upgrade&#39;,
    queue_name         =&gt; &#39;strmadmin.destination_queue&#39;,
    include_dml        =&gt; TRUE,
    include_ddl        =&gt; TRUE,
    include_tagged_lcr =&gt; TRUE,
    source_database    =&gt; &#39;orcl.example.com&#39;);
END;
/
</pre></li>
<li>
<p>Complete the steps in <a href="#CHDHEIIJ">&#34;Task 5: Finishing the Upgrade and Removing Oracle Streams&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CHDHEIIJ"></a>
<div id="STRMS1253" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 5: Finishing the Upgrade and Removing Oracle Streams</h3>
<p>Complete the following steps to finish the upgrade operation using Oracle Streams and remove Oracle Streams components:</p>
<ol>
<li>
<p>Connect to the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">updb.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Start the apply process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; &#39;apply_upgrade&#39;);
END;
/
</pre></li>
<li>
<p>Connect to the capture database as the Oracle Streams administrator.</p>
</li>
<li id="CHDJADFI">
<p>Start the capture process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name  =&gt; &#39;capture_upgrade&#39;);
END;
/
</pre>
<p>This step begins the process of replicating changes that were made to the source database during instantiation of the destination database.</p>
</li>
<li id="i640253">
<p>While still connected as the Oracle Streams administrator in SQL*Plus to the capture database, monitor the Oracle Streams environment until the apply process at the destination database has applied most of the changes from the source database.</p>
<p>To determine whether the apply process at the destination database has applied most of the changes from the source database, complete the following steps:</p>
<ol>
<li id="BABBJHFE">
<p>Query the enqueue message number of the capture process and the message number with the oldest system change number (SCN) for the apply process to see if they are nearly equal.</p>
<p>For example, if the name of the capture process is <code dir="ltr">capture_upgrade</code>, and the name of the apply process is <code dir="ltr">apply_upgrade</code>, then run the following query at the capture database:</p>
<pre dir="ltr">COLUMN ENQUEUE_MESSAGE_NUMBER HEADING &#39;Captured SCN&#39; FORMAT 99999999999
COLUMN OLDEST_SCN_NUM HEADING &#39;Oldest Applied SCN&#39; FORMAT 99999999999

SELECT c.ENQUEUE_MESSAGE_NUMBER, a.OLDEST_SCN_NUM
  FROM V$STREAMS_CAPTURE c, V$STREAMS_APPLY_READER@updb.example.com a
  WHERE c.CAPTURE_NAME = &#39;CAPTURE_UPGRADE&#39;
    AND a.APPLY_NAME   = &#39;APPLY_UPGRADE&#39;;
</pre>
<p>When the two values returned by this query are nearly equal, most of the changes from the source database have been applied at the destination database, and you can proceed to the next step. At this point in the process, the values returned by this query might never be equal because the source database still allows changes.</p>
<p>If this query returns no results, then ensure that the <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>s in the environment are enabled by querying the <code dir="ltr">STATUS</code> column in the <code dir="ltr">DBA_CAPTURE</code> view at the capture database and the <code dir="ltr">DBA_APPLY</code> view at the destination database. If a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> is used, you can check the status of the propagation by running the query in <a href="strms_qpmon.htm#i1007050">&#34;Displaying Information About the Schedules for Propagation Jobs&#34;</a>.</p>
<p>If an Oracle Streams client is disabled, then try restarting it. If an Oracle Streams client will not restart, then troubleshoot the environment using the information in <a href="strms_trouble.htm#g1021339">Chapter 30, &#34;Identifying Problems in an Oracle Streams Environment&#34;</a>.</p>
</li>
<li>
<p>Query the state of the apply process apply servers at the destination database to determine whether they have finished applying changes.</p>
<p>For example, if the name of the apply process is <code dir="ltr">apply_upgrade</code>, then run the following query at the capture database:</p>
<pre dir="ltr">COLUMN STATE HEADING &#39;Apply Server State&#39; FORMAT A20
 
SELECT STATE
  FROM V$STREAMS_APPLY_SERVER@updb.example.com
  WHERE APPLY_NAME = &#39;APPLY_UPGRADE&#39;;
</pre>
<p>When the state for all apply servers is <code dir="ltr">IDLE</code>, you can proceed to the next step.</p>
</li>
</ol>
</li>
<li>
<p>Connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">updb.example.com</code>.</p>
</li>
<li id="i640262">
<p>Ensure that there are no apply errors by running the following query:</p>
<pre dir="ltr">SELECT COUNT(*) FROM DBA_APPLY_ERROR;
</pre>
<p>If this query returns zero, then proceed to the next step. If this query shows errors in the error queue, then resolve these errors before continuing. See <a href="strms_mapply.htm#i1010782">&#34;Managing Apply Errors&#34;</a> for more information.</p>
</li>
<li>
<p>Disconnect all applications and users from the source database.</p>
</li>
<li>
<p>Connect as an administrative user to the source database. In this example, the source database is <code dir="ltr">orcl.example.com</code>.</p>
</li>
<li>
<p>Restrict access to the database. For example:</p>
<pre dir="ltr">ALTER SYSTEM ENABLE RESTRICTED SESSION;
</pre></li>
<li id="i642538">
<p>Connect as an administrative user in SQL*Plus to the capture database, and repeat the query you ran in Step <a href="#i640253">5</a><a href="#BABBJHFE">a</a>. When the two values returned by the query are equal, all of the changes from the source database have been applied at the destination database, and you can proceed to the next step.</p>
</li>
<li>
<p>Connect as the Oracle Streams administrator in SQL*Plus to the destination database, and repeat the query you ran in Step <a href="#i640262">7</a>. If this query returns zero, then move on to the next step. If this query shows errors in the error queue, then resolve these errors before continuing. See <a href="strms_mapply.htm#i1010782">&#34;Managing Apply Errors&#34;</a> for more information.</p>
</li>
<li id="CHDJIFEA">
<p>If you performed any actions that created, modified, or deleted job queue processes at the source database during the upgrade process, then perform the same actions at the destination database. See <a href="#CHDHECCI">&#34;Considerations for Job Queue Processes and PL/SQL Package Subprograms&#34;</a> for more information.</p>
</li>
<li id="CHDBDBDC">
<p>If you invoked any Oracle-supplied PL/SQL package subprograms at the source database during the upgrade process that modified both user data and dictionary metadata at the same time, then invoke the same subprograms at the destination database. See <a href="#CHDHECCI">&#34;Considerations for Job Queue Processes and PL/SQL Package Subprograms&#34;</a> for more information.</p>
</li>
<li>
<p>Shut down the source database. This database should not be opened again.</p>
</li>
<li>
<p>Connect to the destination database as an administrative user.</p>
</li>
<li>
<p>Change the global name of the database to match the source database. For example:</p>
<pre dir="ltr">ALTER DATABASE RENAME GLOBAL_NAME TO orcl.example.com;
</pre></li>
<li>
<p>At the destination database, enable any jobs that you disabled earlier.</p>
</li>
<li>
<p>Make the destination database available for applications and users. Redirect any applications and users that were connecting to the source database to the destination database. If necessary, reconfigure your network and Oracle Net so that systems that communicated with the source database now communicate with the destination database. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>At the destination database, remove the Oracle Streams components that are no longer needed. Connect as an administrative user to the destination database, and run the following procedure:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Running this procedure is dangerous. It removes the local Oracle Streams configuration. Ensure that you are ready to remove the Oracle Streams configuration at the destination database before running this procedure.</div>
<pre dir="ltr">EXEC DBMS_STREAMS_ADM.REMOVE_STREAMS_CONFIGURATION();
</pre>
<p>If you no longer need <a href="strms_glossary.htm#CBAGJGIJ"><span class="xrefglossterm">database supplemental logging</span></a> at the destination database, then run the following statement to drop it:</p>
<pre dir="ltr">ALTER DATABASE DROP SUPPLEMENTAL LOG DATA 
  (PRIMARY KEY, UNIQUE, FOREIGN KEY) COLUMNS;
</pre>
<p>If you no longer need the Oracle Streams administrator at the destination database, then run the following statement:</p>
<pre dir="ltr">DROP USER strmadmin CASCADE;
</pre></li>
<li>
<p>If the capture database was a third database, then, at the third database, remove the Oracle Streams components that are no longer needed. Connect as an administrative user to the third database, and run the following procedure:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Running this procedure is dangerous. It removes the local Oracle Streams configuration. Ensure that you are ready to remove the Oracle Streams configuration at the third database before running this procedure.</div>
<pre dir="ltr">EXEC DBMS_STREAMS_ADM.REMOVE_STREAMS_CONFIGURATION();
</pre>
<p>If you no longer need database <a href="strms_glossary.htm#CHDIHHGA"><span class="xrefglossterm">supplemental logging</span></a> at the third database, then run the following statement to drop it:</p>
<pre dir="ltr">ALTER DATABASE DROP SUPPLEMENTAL LOG DATA 
  (PRIMARY KEY, UNIQUE, FOREIGN KEY) COLUMNS;
</pre>
<p>If you no longer need the Oracle Streams administrator at the destination database, then run the following statement:</p>
<pre dir="ltr">DROP USER strmadmin CASCADE;
</pre></li>
</ol>
<p>The database upgrade is complete.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="ap_strmnt.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="strms_glossary.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>