<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104476"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/How%20Rules%20Are%20Used%20in%20Oracle%20Streams"></a><title>How Rules Are Used in Oracle Streams</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:6Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="strms_apply.htm" title="Previous" type="text/html"/>
<link rel="Next" href="strms_transform.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">12/57</span> <!-- End Header -->
<div id="STRMS006" class="chapter"><a id="g1049257"></a> <a id="CJAGGFBC"></a>
<h1 class="chapter"><span class="secnum">5</span> How Rules Are Used in Oracle Streams</h1>
<p><a id="sthref268"></a><a id="sthref269"></a>The following topics contain information about how <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s are used in Oracle Streams:</p>
<ul>
<li>
<p><a href="#i1006137">Overview of How Rules Are Used in Oracle Streams</a></p>
</li>
<li>
<p><a href="#i1010575">Rule Sets and Rule Evaluation of Messages</a></p>
</li>
<li>
<p><a href="#i1006169">System-Created Rules</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_adrules.htm#BABEBHGC">Chapter 11, &#34;Advanced Rule Concepts&#34;</a></p>
</li>
<li>
<p><a href="strms_mrules.htm#BABBBAIA">Chapter 18, &#34;Managing Rules&#34;</a></p>
</li>
<li>
<p><a href="strms_rumon.htm#CFFJECBJ">Chapter 27, &#34;Monitoring Rules&#34;</a></p>
</li>
<li>
<p><a href="strms_trrules.htm#BABEHCCE">Chapter 34, &#34;Troubleshooting Rules and Rule-Based Transformations&#34;</a></p>
</li>
</ul>
</div>
<a id="i1006137"></a>
<div id="STRMS399" class="sect1">
<h2 class="sect1">Overview of How Rules Are Used in Oracle Streams<a id="sthref270"></a><a id="sthref271"></a><a id="sthref272"></a><a id="sthref273"></a><a id="sthref274"></a><a id="sthref275"></a></h2>
<p>In Oracle Streams, each of the following mechanisms is called an <span class="bold">Oracle Streams client</span> because each one is a client of a <a href="strms_glossary.htm#CHDIIIDH"><span class="xrefglossterm">rules engine</span></a> (when the mechanism is associated with one or more <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s):</p>
<ul>
<li>
<p>Capture process</p>
</li>
<li>
<p>Synchronous capture</p>
</li>
<li>
<p>Propagation</p>
</li>
<li>
<p>Apply process</p>
</li>
<li>
<p>Messaging client</p>
</li>
</ul>
<p>Except for <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>, each of these clients can be associated with at most two rule sets: a <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> and a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>. A synchronous capture can be associated with at most one positive rule set. A synchronous capture cannot be associated with a negative rule set.</p>
<p>A single rule set can be used by multiple <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es, synchronous captures, <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s, <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>es, and <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a>s within the same database. Also, a single rule set can be a positive rule set for one Oracle Streams client and a negative rule set for another Oracle Streams client.</p>
<p><a href="#i1006154">Figure 5-1</a> illustrates how multiple clients of a rules engine can use one rule set.</p>
<div id="STRMS400" class="figure">
<p class="titleinfigure"><a id="i1006154"></a>Figure 5-1 One Rule Set Can Be Used by Multiple Clients of a Rules Engine</p>
<img width="489" height="113" src="img/strms016.gif" alt="Description of Figure 5-1 follows"/><br/>
<a id="sthref276" href="img_text/strms016.htm">Description of &#34;Figure 5-1 One Rule Set Can Be Used by Multiple Clients of a Rules Engine&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>An Oracle Streams client performs a task if a <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> satisfies its rule sets. In general, a message satisfies the rule sets for an Oracle Streams client if <span class="italic">no rules</span> in the negative rule set evaluate to <code dir="ltr">TRUE</code> for the message, and <span class="italic">at least one rule</span> in the positive rule set evaluates to <code dir="ltr">TRUE</code> for the message.</p>
<p><a href="#i1010575">&#34;Rule Sets and Rule Evaluation of Messages&#34;</a> contains more detailed information about how a message satisfies the rule sets for an Oracle Streams client, including information about Oracle Streams client behavior when one or more rule sets are not specified.</p>
<p>You use rule sets in Oracle Streams in the following ways:</p>
<ul>
<li>
<p>Specify the changes that a capture process captures from the redo log or discards. That is, if a change found in the redo log satisfies the rule sets for a capture process, then the capture process captures the change. If a change found in the redo log causes does not satisfy the rule sets for a capture process, then the capture process discards the change.</p>
</li>
<li>
<p>Specify the changes that a synchronous capture captures. That is, if DML change satisfies the rule set for a synchronous capture, then the synchronous capture captures the change immediately after the change is committed. If a DML change made to a table does not satisfy the rule set for a synchronous capture, then the synchronous capture does not capture the change.</p>
</li>
<li>
<p>Specify the messages that a propagation propagates from one <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> to another or discards. That is, if a message in a queue satisfies the rule sets for a propagation, then the propagation propagates the message. If a message in a queue does not satisfy the rule sets for a propagation, then the propagation discards the message.</p>
</li>
<li>
<p>Specify the messages that an apply process dequeues or discards. That is, if a message in a queue satisfies the rule sets for an apply process, then the message is dequeued and processed by the apply process. If a message in a queue does not satisfy the rule sets for an apply process, then the apply process discards the message.</p>
</li>
<li>
<p>Specify the <a href="strms_glossary.htm#CBAGDEIH"><span class="xrefglossterm">persistent LCR</span></a>s or <a href="strms_glossary.htm#CBAGGIDA"><span class="xrefglossterm">persistent user message</span></a>s that a <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a> dequeues or discards. That is, if a message in a <a href="strms_glossary.htm#CBAEIBGJ"><span class="xrefglossterm">persistent queue</span></a> satisfies the rule sets for a messaging client, then the user or application that is using the messaging client dequeues the message. If a message in a persistent queue does not satisfy the rule sets for a messaging client, then the user or application that is using the messaging client discards the message.</p>
</li>
</ul>
<p>For a propagation, the messages evaluated against the rule sets can be any type of message, including <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s, <a href="strms_glossary.htm#CBAGDEIH"><span class="xrefglossterm">persistent LCR</span></a>s, <a href="strms_glossary.htm#CBABHDGA"><span class="xrefglossterm">buffered LCR</span></a>s, <a href="strms_glossary.htm#CBAGGIDA"><span class="xrefglossterm">persistent user message</span></a>s or <a href="strms_glossary.htm#CBAGGFJH"><span class="xrefglossterm">buffered user message</span></a>s.</p>
<p>For an apply process, the messages evaluated against the rule sets can be <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s, <a href="strms_glossary.htm#CBAGDEIH"><span class="xrefglossterm">persistent LCR</span></a>s, or <a href="strms_glossary.htm#CBAGGIDA"><span class="xrefglossterm">persistent user message</span></a>s.</p>
<p>If there are conflicting <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s in the positive rule set associated with a client, then the client performs the task if either rule evaluates to <code dir="ltr">TRUE</code>. For example, if a rule in the positive rule set for a capture process contains one rule that instructs the capture process to capture the results of data manipulation language (DML) changes to the <code dir="ltr">hr.employees</code> table, but another rule in the rule set instructs the capture process not to capture the results of DML changes to the <code dir="ltr">hr.employees</code> table, then the capture process captures these changes.</p>
<p>Similarly, if there are conflicting rules in the negative rule set associated with a client, then the client discards a message if either rule evaluates to <code dir="ltr">TRUE</code> for the message. For example, if a rule in the negative rule set for a capture process contains one rule that instructs the capture process to discard the results of DML changes to the <code dir="ltr">hr.departments</code> table, but another rule in the rule set instructs the capture process not to discard the results of DML changes to the <code dir="ltr">hr.departments</code> table, then the capture process discards these changes.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1006083">Chapter 2, &#34;Oracle Streams Information Capture&#34;</a></p>
</li>
<li>
<p><a href="strms_prop.htm#i1006210">&#34;Message Propagation Between Queues&#34;</a></p>
</li>
<li>
<p><a href="strms_apply.htm#g1018604">Chapter 4, &#34;Oracle Streams Information Consumption&#34;</a></p>
</li>
<li>
<p><a href="strms_apply.htm#i1008622">&#34;Explicit Consumption with a Messaging Client&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i1010575"></a>
<div id="STRMS401" class="sect1">
<h2 class="sect1">Rule Sets and Rule Evaluation of Messages<a id="sthref277"></a><a id="sthref278"></a></h2>
<p><a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>s perform the following tasks based on <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s:</p>
<ul>
<li>
<p>A <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> captures changes in the redo log, converts the changes into logical change records (LCRs), and enqueues <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s containing these LCRs into the capture process <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>.</p>
</li>
<li>
<p>A <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> captures the results of DML changes made to tables, converts the changes into row logical change records (row LCRs), and enqueues <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s containing these row LCRs into the synchronous capture <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>.</p>
</li>
<li>
<p>A <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> propagates any type of message from a <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> to a <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a>.</p>
</li>
<li>
<p>An <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> dequeues either <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s, <a href="strms_glossary.htm#CBAGDEIH"><span class="xrefglossterm">persistent LCR</span></a>s, or <a href="strms_glossary.htm#CBAGGIDA"><span class="xrefglossterm">persistent user message</span></a>s from its queue and applies these messages directly or sends the messages to an <a href="strms_glossary.htm#CHDCJAED"><span class="xrefglossterm">apply handler</span></a>.</p>
</li>
<li>
<p>A <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a> dequeues <a href="strms_glossary.htm#CBAGDEIH"><span class="xrefglossterm">persistent LCR</span></a>s or <a href="strms_glossary.htm#CBAGGIDA"><span class="xrefglossterm">persistent user message</span></a>s from its queue.</p>
</li>
</ul>
<p>These Oracle Streams clients are all clients of the <a href="strms_glossary.htm#CHDIIIDH"><span class="xrefglossterm">rules engine</span></a>. An Oracle Streams client performs its task for a message when the message satisfies the <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s used by the Oracle Streams client. An Oracle Streams client can have no rule set, only a <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>, only a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>, or both a positive and a negative rule set.</p>
<p>The following sections explain how rule evaluation works in each of these cases:</p>
<ul>
<li>
<p><a href="#i1010960">Oracle Streams Client with No Rule Set</a></p>
</li>
<li>
<p><a href="#i1010992">Oracle Streams Client with a Positive Rule Set Only</a></p>
</li>
<li>
<p><a href="#i1010993">Oracle Streams Client with a Negative Rule Set Only</a></p>
</li>
<li>
<p><a href="#i1010994">Oracle Streams Client with Both a Positive and a Negative Rule Set</a></p>
</li>
<li>
<p><a href="#i1016002">Oracle Streams Client with One or More Empty Rule Sets</a></p>
</li>
<li>
<p><a href="#i1015667">Summary of Rule Sets and Oracle Streams Client Behavior</a></p>
</li>
</ul>
<a id="i1010960"></a>
<div id="STRMS402" class="sect2">
<h3 class="sect2">Oracle Streams Client with No Rule Set</h3>
<p>An <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> with no <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a> performs its task for all of the <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s it encounters. An empty rule set is not the same as no rule set at all.</p>
<p>A capture process should always have at least one rule set because it must not try to capture changes to unsupported database objects. If a propagation should always propagate all messages in its source queue, or if an apply process should always dequeue all messages in its queue, then removing all rule sets from the propagation or apply process might improve performance. A synchronous capture must have a positive rule set. A synchronous capture cannot be configured without a rule set.</p>
</div>
<!-- class="sect2" -->
<a id="i1010992"></a>
<div id="STRMS403" class="sect2">
<h3 class="sect2">Oracle Streams Client with a Positive Rule Set Only</h3>
<p>An <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> with a <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>, but no <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>, performs its task for a <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> if any <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> in the positive rule set evaluates to <code dir="ltr">TRUE</code> for the message. However, if all of the rules in a positive rule set evaluate to <code dir="ltr">FALSE</code> for the message, then the Oracle Streams client discards the message.</p>
</div>
<!-- class="sect2" -->
<a id="i1010993"></a>
<div id="STRMS404" class="sect2">
<h3 class="sect2">Oracle Streams Client with a Negative Rule Set Only</h3>
<p>An <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> with a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>, but no <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>, discards a <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> if any <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> in the negative rule set evaluates to <code dir="ltr">TRUE</code> for the message. However, if all of the rules in a negative rule set evaluate to <code dir="ltr">FALSE</code> for the message, then the Oracle Streams client performs its task for the message. A synchronous capture cannot have a negative rule set.</p>
</div>
<!-- class="sect2" -->
<a id="i1010994"></a>
<div id="STRMS405" class="sect2">
<h3 class="sect2">Oracle Streams Client with Both a Positive and a Negative Rule Set</h3>
<p>If an <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> has both a positive and a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>, then the negative rule set is evaluated first for a <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>. If any <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> in the negative rule set evaluates to <code dir="ltr">TRUE</code> for the message, then the message is discarded, and the message is never evaluated against the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>.</p>
<p>However, if all of the rules in the negative rule set evaluate to <code dir="ltr">FALSE</code> for the message, then the message is evaluated against the positive rule set. At this point, the behavior is the same as when the Oracle Streams client only has a positive rule set. That is, the Oracle Streams client performs its task for a message if any rule in the positive rule set evaluates to <code dir="ltr">TRUE</code> for the message. If all of the rules in a positive rule set evaluate to <code dir="ltr">FALSE</code> for the message, then the Oracle Streams client discards the message.</p>
<p>A synchronous capture cannot have a negative rule set.</p>
</div>
<!-- class="sect2" -->
<a id="i1016002"></a>
<div id="STRMS406" class="sect2">
<h3 class="sect2">Oracle Streams Client with One or More Empty Rule Sets</h3>
<p>An <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> can have one or more empty <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s. An Oracle Streams client behaves in the following ways if it has one or more empty rule sets:</p>
<ul>
<li>
<p>If an Oracle Streams client has no <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>, and its <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> is empty, then the Oracle Streams client performs its task for all <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s.</p>
</li>
<li>
<p>If an Oracle Streams client has both a positive and a negative rule set, and the negative rule set is empty but its positive rule set contains <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s, then the Oracle Streams client performs its task based on the rules in the positive rule set.</p>
</li>
<li>
<p>If an Oracle Streams client has a positive rule set that is empty, then the Oracle Streams client discards all messages, regardless of the state of its negative rule set.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i1015667"></a>
<div id="STRMS407" class="sect2">
<h3 class="sect2">Summary of Rule Sets and Oracle Streams Client Behavior</h3>
<p><a href="#g1031156">Table 5-1</a> summarizes the <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> behavior described in the previous sections.</p>
<div id="STRMS408" class="tblhruleformal">
<p class="titleintable"><a id="sthref279"></a><a id="g1031156"></a>Table 5-1 Rule Sets and Oracle Streams Client Behavior</p>
<table class="cellalignment5973" title="Rule Sets and Oracle Streams Client Behavior" summary="This table lists Streams client behavior for different combinations of negative and positive rule sets." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t4">Negative Rule Set</th>
<th class="cellalignment5974" id="r1c2-t4">Positive Rule Set</th>
<th class="cellalignment5974" id="r1c3-t4">Oracle Streams Client Behavior</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t4" headers="r1c1-t4">
<p>None</p>
</td>
<td class="cellalignment5970" headers="r2c1-t4 r1c2-t4">
<p>None</p>
</td>
<td class="cellalignment5970" headers="r2c1-t4 r1c3-t4">
<p>Performs its task for all <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t4" headers="r1c1-t4">
<p>None</p>
</td>
<td class="cellalignment5970" headers="r3c1-t4 r1c2-t4">
<p>Exists with rules</p>
</td>
<td class="cellalignment5970" headers="r3c1-t4 r1c3-t4">
<p>Performs its task for messages that evaluate to <code dir="ltr">TRUE</code> against the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t4" headers="r1c1-t4">
<p>Exists with rules</p>
</td>
<td class="cellalignment5970" headers="r4c1-t4 r1c2-t4">
<p>None</p>
</td>
<td class="cellalignment5970" headers="r4c1-t4 r1c3-t4">
<p>Discards messages that evaluate to <code dir="ltr">TRUE</code> against the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>, and performs its task for all other messages</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t4" headers="r1c1-t4">
<p>Exists with rules</p>
</td>
<td class="cellalignment5970" headers="r5c1-t4 r1c2-t4">
<p>Exists with rules</p>
</td>
<td class="cellalignment5970" headers="r5c1-t4 r1c3-t4">
<p>Discards messages that evaluate to <code dir="ltr">TRUE</code> against the negative rule set, and performs its task for remaining messages that evaluate to <code dir="ltr">TRUE</code> against the positive rule set. The negative rule set is evaluated first.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t4" headers="r1c1-t4">
<p>Exists but is empty</p>
</td>
<td class="cellalignment5970" headers="r6c1-t4 r1c2-t4">
<p>None</p>
</td>
<td class="cellalignment5970" headers="r6c1-t4 r1c3-t4">
<p>Performs its task for all messages</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t4" headers="r1c1-t4">
<p>Exists but is empty</p>
</td>
<td class="cellalignment5970" headers="r7c1-t4 r1c2-t4">
<p>Exists with rules</p>
</td>
<td class="cellalignment5970" headers="r7c1-t4 r1c3-t4">
<p>Performs its task for messages that evaluate to <code dir="ltr">TRUE</code> against the positive rule set</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t4" headers="r1c1-t4">
<p>None</p>
</td>
<td class="cellalignment5970" headers="r8c1-t4 r1c2-t4">
<p>Exists but is empty</p>
</td>
<td class="cellalignment5970" headers="r8c1-t4 r1c3-t4">
<p>Discards all messages</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r9c1-t4" headers="r1c1-t4">
<p>Exists but is empty</p>
</td>
<td class="cellalignment5970" headers="r9c1-t4 r1c2-t4">
<p>Exists but is empty</p>
</td>
<td class="cellalignment5970" headers="r9c1-t4 r1c3-t4">
<p>Discards all messages</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r10c1-t4" headers="r1c1-t4">
<p>Exists with rules</p>
</td>
<td class="cellalignment5970" headers="r10c1-t4 r1c2-t4">
<p>Exists but is empty</p>
</td>
<td class="cellalignment5970" headers="r10c1-t4 r1c3-t4">
<p>Discards all messages</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformal" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006169"></a>
<div id="STRMS409" class="sect1">
<h2 class="sect1">System-Created Rules<a id="sthref280"></a><a id="sthref281"></a><a id="sthref282"></a></h2>
<p>An <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> performs its task for a <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> if the message satisfies its <a href="strms_glossary.htm#CHDCHGGB"><span class="xrefglossterm">rule set</span></a>s. A <span class="bold">system-created rule</span> is created by the <code dir="ltr">DBMS_STREAMS_ADM</code> package and can specify one of the following levels of granularity: table, schema, or global. This section describes each of these levels. You can specify more than one level for a particular task. For example, you can instruct a single <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> to perform table-level apply for specific tables in the <code dir="ltr">oe</code> schema and schema-level apply for the entire <code dir="ltr">hr</code> schema. In addition, a single <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> pertains to either the results of data manipulation language (DML) changes or data definition language (DDL) changes. So, for example, you must use at least two system-created rules to include all of the changes to a particular table: one rule for the results of DML changes and another rule for DDL changes. The results of a DML change are the row changes that result from the DML change, or the row <a href="strms_glossary.htm#CHDJDFAD"><span class="xrefglossterm">LCR</span></a>s in a <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> that encapsulate each row change.</p>
<p><a href="#g1030907">Table 5-2</a> shows what each level of rule means for each Oracle Streams task. Remember that a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> is evaluated before a <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a>.</p>
<div id="STRMS410" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref283"></a><a id="g1030907"></a>Table 5-2 Types of Tasks and Rule Levels</p>
<table class="cellalignment5973" title="Types of Tasks and Rule Levels " summary="This table describes each rule level (table, schema, and global) for different types of Streams tasks." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t5">Task</th>
<th class="cellalignment5974" id="r1c2-t5">Table Rule</th>
<th class="cellalignment5974" id="r1c3-t5">Schema Rule</th>
<th class="cellalignment5974" id="r1c4-t5">Global Rule</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t5" headers="r1c1-t5">
<p>Capture with a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a></p>
</td>
<td class="cellalignment5970" headers="r2c1-t5 r1c2-t5">
<p>If the <a href="strms_glossary.htm#CHDEGGGH"><span class="xrefglossterm">table rule</span></a> is in a negative rule set, then discard the changes in the redo log for the specified table.</p>
<p>If the table rule is in a positive rule set, then capture all or a subset of the changes in the redo log for the specified table, convert them into logical change records (LCRs), and enqueue them.</p>
</td>
<td class="cellalignment5970" headers="r2c1-t5 r1c3-t5">
<p>If the <a href="strms_glossary.htm#CHDFAGCF"><span class="xrefglossterm">schema rule</span></a> is in a negative rule set, then discard the changes in the redo log for the schema itself and for the database objects in the specified schema.</p>
<p>If the schema rule is in a positive rule set, then capture the changes in the redo log for the schema itself and for the database objects in the specified schema, convert them into LCRs, and enqueue them.</p>
</td>
<td class="cellalignment5970" headers="r2c1-t5 r1c4-t5">
<p>If the <a href="strms_glossary.htm#CHDEJCHD"><span class="xrefglossterm">global rule</span></a> is in a negative rule set, then discard the changes to all of the database objects in the database.</p>
<p>If the global rule is in a positive rule set, then capture the changes to all of the database objects in the database, convert them into LCRs, and enqueue them.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t5" headers="r1c1-t5">
<p>Capture with a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a></p>
</td>
<td class="cellalignment5970" headers="r3c1-t5 r1c2-t5">
<p>If the table rule is in a positive rule set, then capture all or a subset of the changes made to the specified table, convert them into logical change records (LCRs), and enqueue them.</p>
<p>A synchronous capture cannot have a negative rule set.</p>
</td>
<td class="cellalignment5970" headers="r3c1-t5 r1c3-t5">
<p>A synchronous capture cannot use schema rules.</p>
</td>
<td class="cellalignment5970" headers="r3c1-t5 r1c4-t5">
<p>A synchronous capture cannot use global rules.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t5" headers="r1c1-t5">
<p>Propagate with a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a></p>
</td>
<td class="cellalignment5970" headers="r4c1-t5 r1c2-t5">
<p>If the table rule is in a negative rule set, then discard the LCRs relating to the specified table in the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a>.</p>
<p>If the table rule is in a positive rule set, then propagate all or a subset of the LCRs relating to the specified table in the source queue to the <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a>.</p>
</td>
<td class="cellalignment5970" headers="r4c1-t5 r1c3-t5">
<p>If the schema rule is in a negative rule set, then discard the LCRs related to the specified schema itself and the LCRs related to database objects in the schema in the source queue.</p>
<p>If the schema rule is in a positive rule set, then propagate the LCRs related to the specified schema itself and the LCRs related to database objects in the schema in the source queue to the destination queue.</p>
</td>
<td class="cellalignment5970" headers="r4c1-t5 r1c4-t5">
<p>If the global rule is in a negative rule set, then discard all of the LCRs in the source queue.</p>
<p>If the global rule is in a positive rule set, then propagate all of the LCRs in the source queue to the destination queue.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t5" headers="r1c1-t5">
<p>Apply with an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a></p>
</td>
<td class="cellalignment5970" headers="r5c1-t5 r1c2-t5">
<p>If the table rule is in a negative rule set, then discard the LCRs in the queue relating to the specified table.</p>
<p>If the table rule is in a positive rule set, then apply all or a subset of the LCRs in the queue relating to the specified table.</p>
</td>
<td class="cellalignment5970" headers="r5c1-t5 r1c3-t5">
<p>If the schema rule is in a negative rule set, then discard the LCRs in the queue relating to the specified schema itself and the database objects in the schema.</p>
<p>If the schema rule is in a positive rule set, then apply the LCRs in the queue relating to the specified schema itself and the database objects in the schema.</p>
</td>
<td class="cellalignment5970" headers="r5c1-t5 r1c4-t5">
<p>If the global rule is in a negative rule set, then discard all of the LCRs in the queue.</p>
<p>If the global rule is in a positive rule set, then apply all of the LCRs in the queue.</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t5" headers="r1c1-t5">
<p>Dequeue with a <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a></p>
</td>
<td class="cellalignment5970" headers="r6c1-t5 r1c2-t5">
<p>If the table rule is in a negative rule set, then, when the messaging client is invoked, discard the persistent LCRs relating to the specified table in the queue.</p>
<p>If the table rule is in a positive rule set, then, when the messaging client is invoked, dequeue all or a subset of the persistent LCRs relating to the specified table in the queue.</p>
</td>
<td class="cellalignment5970" headers="r6c1-t5 r1c3-t5">
<p>If the schema rule is in a negative rule set, then, when the messaging client is invoked, discard the persistent LCRs relating to the specified schema itself and the database objects in the schema in the queue.</p>
<p>If the schema rule is in a positive rule set, then, when the messaging client is invoked, dequeue the persistent LCRs relating to the specified schema itself and the database objects in the schema in the queue.</p>
</td>
<td class="cellalignment5970" headers="r6c1-t5 r1c4-t5">
<p>If the global rule is in a negative rule set, then, when the messaging client is invoked, discard all of the persistent LCRs in the queue.</p>
<p>If the global rule is in a positive rule set, then, when the messaging client is invoked, dequeue all of the persistent LCRs in the queue.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformalwide" -->
<p>You can use procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to create rules at each of these levels. A system-created rule can include conditions that modify the Oracle Streams client behavior beyond the descriptions in <a href="#g1030907">Table 5-2</a>. For example, some rules can specify a particular <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> for LCRs, and, in this case, the rule evaluates to <code dir="ltr">TRUE</code> only if an LCR originated at the specified source database. <a href="#g1030936">Table 5-3</a> lists the types of system-created <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a>s that can be specified in the rules created by the <code dir="ltr">DBMS_STREAMS_ADM</code> package.</p>
<div id="STRMS411" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref284"></a><a id="g1030936"></a>Table 5-3 System-Created Rule Conditions Generated by DBMS_STREAMS_ADM Package</p>
<table class="cellalignment5973" title="System-Created Rule Conditions Generated by DBMS_STREAMS_ADM Package " summary="This table lists the types of changes that evaluate to true for different types of rule conditions. For each type of rule condition, the table lists the Streams client and the procedure used to create the rule condition." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t6">Rule Condition Evaluates to TRUE for</th>
<th class="cellalignment5974" id="r1c2-t6">Oracle Streams Client</th>
<th class="cellalignment5974" id="r1c3-t6">Create Using Procedure</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t6" headers="r1c1-t6">
<p>All row changes recorded in the redo log because of DML changes to any of the tables in a particular database</p>
</td>
<td class="cellalignment5970" headers="r2c1-t6 r1c2-t6">
<p>Capture Process</p>
</td>
<td class="cellalignment5970" headers="r2c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t6" headers="r1c1-t6">
<p>All DDL changes recorded in the redo log to any of the database objects in a particular database</p>
</td>
<td class="cellalignment5970" headers="r3c1-t6 r1c2-t6">
<p>Capture Process</p>
</td>
<td class="cellalignment5970" headers="r3c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t6" headers="r1c1-t6">
<p>All row changes recorded in the redo log because of DML changes to any of the tables in a particular schema</p>
</td>
<td class="cellalignment5970" headers="r4c1-t6 r1c2-t6">
<p>Capture Process</p>
</td>
<td class="cellalignment5970" headers="r4c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t6" headers="r1c1-t6">
<p>All DDL changes recorded in the redo log to a particular schema and any of the database objects in the schema</p>
</td>
<td class="cellalignment5970" headers="r5c1-t6 r1c2-t6">
<p>Capture Process</p>
</td>
<td class="cellalignment5970" headers="r5c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r6c1-t6" headers="r1c1-t6">
<p>All row changes recorded in the redo log because of DML changes to a particular table</p>
</td>
<td class="cellalignment5970" headers="r6c1-t6 r1c2-t6">
<p>Capture Process</p>
</td>
<td class="cellalignment5970" headers="r6c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r7c1-t6" headers="r1c1-t6">
<p>All DDL changes recorded in the redo log to a particular table</p>
</td>
<td class="cellalignment5970" headers="r7c1-t6 r1c2-t6">
<p>Capture Process</p>
</td>
<td class="cellalignment5970" headers="r7c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r8c1-t6" headers="r1c1-t6">
<p>All row changes recorded in the redo log because of DML changes to a subset of rows in a particular table</p>
</td>
<td class="cellalignment5970" headers="r8c1-t6 r1c2-t6">
<p>Capture Process</p>
</td>
<td class="cellalignment5970" headers="r8c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SUBSET_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r9c1-t6" headers="r1c1-t6">
<p>All row changes made to a particular table resulting from DML statements</p>
</td>
<td class="cellalignment5970" headers="r9c1-t6 r1c2-t6">
<p>Synchronous Capture</p>
</td>
<td class="cellalignment5970" headers="r9c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r10c1-t6" headers="r1c1-t6">
<p>All row changes made to a subset of rows in a particular table resulting from DML statements</p>
</td>
<td class="cellalignment5970" headers="r10c1-t6 r1c2-t6">
<p>Synchronous Capture</p>
</td>
<td class="cellalignment5970" headers="r10c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SUBSET_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r11c1-t6" headers="r1c1-t6">
<p>All row LCRs in the source queue</p>
</td>
<td class="cellalignment5970" headers="r11c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r11c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_PROPAGATION_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r12c1-t6" headers="r1c1-t6">
<p>All DDL LCRs in the source queue</p>
</td>
<td class="cellalignment5970" headers="r12c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r12c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_PROPAGATION_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r13c1-t6" headers="r1c1-t6">
<p>All row LCRs in the source queue relating to the tables in a particular schema</p>
</td>
<td class="cellalignment5970" headers="r13c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r13c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_PROPAGATION_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r14c1-t6" headers="r1c1-t6">
<p>All DDL LCRs in the source queue relating to a particular schema and any of the database objects in the schema</p>
</td>
<td class="cellalignment5970" headers="r14c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r14c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_PROPAGATION_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r15c1-t6" headers="r1c1-t6">
<p>All row LCRs in the source queue relating to a particular table</p>
</td>
<td class="cellalignment5970" headers="r15c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r15c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_PROPAGATION_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r16c1-t6" headers="r1c1-t6">
<p>All DDL LCRs in the source queue relating to a particular table</p>
</td>
<td class="cellalignment5970" headers="r16c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r16c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_PROPAGATION_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r17c1-t6" headers="r1c1-t6">
<p>All row LCRs in the source queue relating to a subset of rows in a particular table</p>
</td>
<td class="cellalignment5970" headers="r17c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r17c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SUBSET_PROPAGATION_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r18c1-t6" headers="r1c1-t6">
<p>All user messages in the source queue of the specified type that satisfy the user-specified rule condition</p>
</td>
<td class="cellalignment5970" headers="r18c1-t6 r1c2-t6">
<p>Propagation</p>
</td>
<td class="cellalignment5970" headers="r18c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_MESSAGE_PROPAGATION_RULE</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r19c1-t6" headers="r1c1-t6">
<p>All row LCRs in the queue used by the apply process</p>
</td>
<td class="cellalignment5970" headers="r19c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r19c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r20c1-t6" headers="r1c1-t6">
<p>All DDL LCRs in the queue used by the apply process</p>
</td>
<td class="cellalignment5970" headers="r20c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r20c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r21c1-t6" headers="r1c1-t6">
<p>All row LCRs in the queue used by the apply process relating to the tables in a particular schema</p>
</td>
<td class="cellalignment5970" headers="r21c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r21c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r22c1-t6" headers="r1c1-t6">
<p>All DDL LCRs in the queue used by the apply process relating to a particular schema and any of the database objects in the schema</p>
</td>
<td class="cellalignment5970" headers="r22c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r22c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r23c1-t6" headers="r1c1-t6">
<p>All row LCRs in the queue used by the apply process relating to a particular table</p>
</td>
<td class="cellalignment5970" headers="r23c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r23c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r24c1-t6" headers="r1c1-t6">
<p>All DDL LCRs in the queue used by the apply process relating to a particular table</p>
</td>
<td class="cellalignment5970" headers="r24c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r24c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r25c1-t6" headers="r1c1-t6">
<p>All row LCRs in the queue used by the apply process relating to a subset of rows in a particular table</p>
</td>
<td class="cellalignment5970" headers="r25c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r25c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SUBSET_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r26c1-t6" headers="r1c1-t6">
<p>All persistent user messages in the queue used by the apply process of the specified type that satisfy the user-specified rule condition</p>
</td>
<td class="cellalignment5970" headers="r26c1-t6 r1c2-t6">
<p>Apply Process</p>
</td>
<td class="cellalignment5970" headers="r26c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_MESSAGE_RULE</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r27c1-t6" headers="r1c1-t6">
<p>All persistent row LCRs in the queue used by the messaging client</p>
</td>
<td class="cellalignment5970" headers="r27c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r27c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r28c1-t6" headers="r1c1-t6">
<p>All persistent DDL LCRs in the queue used by the messaging client</p>
</td>
<td class="cellalignment5970" headers="r28c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r28c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_GLOBAL_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r29c1-t6" headers="r1c1-t6">
<p>All persistent row LCRs in the queue used by the messaging client relating to the tables in a particular schema</p>
</td>
<td class="cellalignment5970" headers="r29c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r29c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r30c1-t6" headers="r1c1-t6">
<p>All persistent DDL LCRs in the queue used by the messaging client relating to a particular schema and any of the database objects in the schema</p>
</td>
<td class="cellalignment5970" headers="r30c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r30c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SCHEMA_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r31c1-t6" headers="r1c1-t6">
<p>All persistent row LCRs in the queue for the messaging client relating to a particular table</p>
</td>
<td class="cellalignment5970" headers="r31c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r31c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r32c1-t6" headers="r1c1-t6">
<p>All persistent DDL LCRs in the queue used by the messaging client relating to a particular table</p>
</td>
<td class="cellalignment5970" headers="r32c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r32c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_TABLE_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r33c1-t6" headers="r1c1-t6">
<p>All persistent row LCRs in the queue used by the messaging client relating to a subset of rows in a particular table</p>
</td>
<td class="cellalignment5970" headers="r33c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r33c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_SUBSET_RULES</code></p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r34c1-t6" headers="r1c1-t6">
<p>All persistent messages in the queue used by the messaging client of the specified type that satisfy the user-specified rule condition</p>
</td>
<td class="cellalignment5970" headers="r34c1-t6 r1c2-t6">
<p>Messaging Client</p>
</td>
<td class="cellalignment5970" headers="r34c1-t6 r1c3-t6">
<p><code dir="ltr">ADD_MESSAGE_RULE</code></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformalwide" -->
<p><a id="sthref285"></a><a id="sthref286"></a><a id="sthref287"></a><a id="sthref288"></a>Each procedure listed in <a href="#g1030936">Table 5-3</a> does the following:</p>
<ul>
<li>
<p>Creates a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>, <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>, <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>, <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>, or <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a> if it does not already exist.</p>
</li>
<li>
<p>Creates a rule set for the specified capture process, synchronous capture, propagation, apply process, or messaging client if a rule set does not already exist for it. For a capture process, propagation, apply process, or messaging client, the rule set can be a positive rule set or a negative rule set. You can create each type of rule set by running the procedure at least twice. For a synchronous capture, the rule set must be a positive rule set.</p>
</li>
<li>
<p>Creates zero or more rules and adds the rules to the rule set for the specified capture process, synchronous capture, propagation, apply process, or messaging client. Based on your specifications when you run one of these procedures, the procedure adds the rules either to the positive rule set or to the negative rule set.</p>
</li>
</ul>
<p>Except for the <code dir="ltr">ADD_MESSAGE_RULE</code> and <code dir="ltr">ADD_MESSAGE_PROPAGATION_RULE</code> procedures, these procedures create rule sets that use the <code dir="ltr">SYS.STREAMS$_EVALUATION_CONTEXT</code> <a href="strms_glossary.htm#CHDDECEH"><span class="xrefglossterm">evaluation context</span></a>, which is an Oracle-supplied evaluation context for Oracle Streams environments.</p>
<p>Global, schema, table, and subset rules use the <code dir="ltr">SYS.STREAMS$_EVALUATION_CONTEXT</code> evaluation context. However, when you create a rule using either the <code dir="ltr">ADD_MESSAGE_RULE</code> or the <code dir="ltr">ADD_MESSAGE_PROPAGATION_RULE</code> procedure, the rule uses a system-generated evaluation context that is customized specifically for each message type. Rule sets created by the <code dir="ltr">ADD_MESSAGE_RULE</code> or the <code dir="ltr">ADD_MESSAGE_PROPAGATION_RULE</code> procedure do not have an evaluation context.</p>
<p><a id="sthref289"></a><a id="sthref290"></a><a id="sthref291"></a><a id="sthref292"></a>Except for <code dir="ltr">ADD_SUBSET_RULES</code>, <code dir="ltr">ADD_SUBSET_PROPAGATION_RULES</code>, <code dir="ltr">ADD_MESSAGE_RULE</code>, and <code dir="ltr">ADD_MESSAGE_PROPAGATION_RULE</code>, these procedures create either zero, one, or two rules. If you want to perform the Oracle Streams task for only the row changes resulting from DML changes or only for only DDL changes, then only one rule is created. If, however, you want to perform the Oracle Streams task for both the results of DML changes and DDL changes, then a rule is created for each. If you create a DML rule for a table now, then you can create a DDL rule for the same table in the future without modifying the DML rule created earlier. The same applies if you create a DDL rule for a table first and a DML rule for the same table in the future.</p>
<p>The <code dir="ltr">ADD_SUBSET_RULES</code> and <code dir="ltr">ADD_SUBSET_PROPAGATION_RULES</code> procedures always create three rules for three different types of DML operations on a table: <code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, and <code dir="ltr">DELETE</code>. These procedures do not create rules for DDL changes to a table. You can use the <code dir="ltr">ADD_TABLE_RULES</code> or <code dir="ltr">ADD_TABLE_PROPAGATION_RULES</code> procedure to create a DDL rule for a table. In addition, you can add subset rules to positive rule sets only, not to negative rule sets.</p>
<p>The <code dir="ltr">ADD_MESSAGE_RULE</code> and <code dir="ltr">ADD_MESSAGE_PROPAGATION_RULE</code> procedures always create one rule with a user-specified rule condition. These procedures create rules for user messages. They do not create rules for the results of DML changes or DDL changes to a table.</p>
<p>When you create propagation rules for <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s, Oracle recommends that you specify a source database for the changes. An apply process uses transaction control messages to assemble captured LCRs into committed transactions. These transaction control messages, such as <code dir="ltr">COMMIT</code> and <code dir="ltr">ROLLBACK</code>, contain the name of the source database where the message occurred. To avoid unintended cycling of these messages, propagation rules should contain a condition specifying the source database, and you accomplish this by specifying the source database when you create the propagation rules.</p>
<p>The following sections describe system-created rules in more detail:</p>
<ul>
<li>
<p><a href="#i1009423">Global Rules</a></p>
</li>
<li>
<p><a href="#i1009451">Schema Rules</a></p>
</li>
<li>
<p><a href="#i1008651">Table Rules</a></p>
</li>
<li>
<p><a href="#i1009452">Subset Rules</a></p>
</li>
<li>
<p><a href="#i1013864">Message Rules</a></p>
</li>
<li>
<p><a href="#i1011897">System-Created Rules and Negative Rule Sets</a></p>
</li>
<li>
<p><a href="#i1019153">System-Created Rules with Added User-Defined Conditions</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>To create rules with more complex rule conditions, such as rules that use the <code dir="ltr">NOT</code> or <code dir="ltr">OR</code> logical conditions, either use the <code dir="ltr">and_condition</code> parameter, which is available with some of the procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package, or use the <code dir="ltr">DBMS_RULE_ADM</code> package.</p>
</li>
<li>
<p>Each example in the sections that follow should be completed by an Oracle Streams administrator that has been granted the appropriate privileges, unless specified otherwise.</p>
</li>
<li>
<p>Some of the examples in this section have additional prerequisites. For example, a queue specified by a procedure parameter must exist.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_mrules.htm#BABJJABI">&#34;Managing Rules&#34;</a></p>
</li>
<li>
<p><a href="#i1010575">&#34;Rule Sets and Rule Evaluation of Messages&#34;</a> for information about how messages satisfy the rule sets for an Oracle Streams client</p>
</li>
<li>
<p><a class="olink ARPLS" href="../ARPLS/toc.htm"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">DBMS_STREAMS_ADM</code> package and the <code dir="ltr">DBMS_RULE_ADM</code> package</p>
</li>
<li>
<p><a href="strms_adrules.htm#i1006719">&#34;Evaluation Contexts Used in Oracle Streams&#34;</a></p>
</li>
<li>
<p><a href="strms_capture.htm#i1006153">&#34;Logical Change Records (LCRs)&#34;</a></p>
</li>
<li>
<p><a href="strms_adrules.htm#i1017158">&#34;Complex Rule Conditions&#34;</a></p>
</li>
</ul>
</div>
<a id="i1009423"></a>
<div id="STRMS412" class="sect2">
<h3 class="sect2">Global Rules<a id="sthref293"></a><a id="sthref294"></a></h3>
<p>When you use a <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> to specify an Oracle Streams task that is relevant either to an entire database or to an entire <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>, you are specifying a <span class="bold">global rule</span>. You can specify a global rule for DML changes, a global rule for DDL changes, or a global rule for each type of change (two rules total).</p>
<p>A single global rule in the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> for a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> means that the capture process captures the results of either all DML changes or all DDL changes to the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>. A single global rule in the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for a capture process means that the capture process discards the results of either all DML changes or all DDL changes to the source database.</p>
<p>A single global rule in the positive rule set for a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> means that the propagation propagates either all row LCRs or all DDL LCRs in the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> to the <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a>. A single global rule in the negative rule set for a propagation means that the propagation discards either all row LCRs or all DDL LCRs in the source queue.</p>
<p>A single global rule in the positive rule set for an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> means that the apply process applies either all row LCRs or all DDL LCRs in its queue for a specified source database. A single global rule in the negative rule set for an apply process means that the apply process discards either all row LCRs or all DDL LCRs in its queue for a specified source database.</p>
<p>If you want to use global rules, but you are concerned about changes to database objects that are not supported by Oracle Streams, then you can create rules using the <code dir="ltr">DBMS_RULE_ADM</code> package to discard unsupported changes.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_adrules.htm#i1016342">&#34;Rule Conditions that Instruct Oracle Streams Clients to Discard Unsupported LCRs&#34;</a></p>
</li>
</ul>
</div>
<a id="i1016311"></a>
<div id="STRMS413" class="sect3">
<h4 class="sect3">Global Rules Example</h4>
<p>Suppose you use the <code dir="ltr">ADD_GLOBAL_RULES</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to instruct an Oracle Streams capture process to capture all DML changes and DDL changes in a database.</p>
<p>Run the <code dir="ltr">ADD_GLOBAL_RULES</code> procedure to create the rules:</p>
<pre dir="ltr">BEGIN 
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type        =&gt;  &#39;capture&#39;,
    streams_name        =&gt;  &#39;capture&#39;,
    queue_name          =&gt;  &#39;streams_queue&#39;,
    include_dml         =&gt;  TRUE,
    include_ddl         =&gt;  TRUE,
    include_tagged_lcr  =&gt;  FALSE,
    source_database     =&gt;  NULL,
    inclusion_rule      =&gt;  TRUE);
END;
/
</pre>
<p>Notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that the <a href="strms_glossary.htm#CHDIJACJ"><span class="xrefglossterm">system-created rule</span></a>s are added to the positive rule set for the capture process.</p>
<p><code dir="ltr">NULL</code> can be specified for the <code dir="ltr">source_database</code> parameter because rules are being created for a <a href="strms_glossary.htm#CHDDGCGH"><span class="xrefglossterm">local capture process</span></a>. You can also specify the global name of the local database. When creating rules for a <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a> or apply process using <code dir="ltr">ADD_GLOBAL_RULES</code>, specify a source database name.</p>
<p>The <code dir="ltr">ADD_GLOBAL_RULES</code> procedure creates two rules: one for row LCRs (which contain the results of DML changes) and one for DDL LCRs.</p>
<p>Here is the <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a> used by the row LCR rule:</p>
<pre dir="ltr">(:dml.is_null_tag() = &#39;Y&#39; )
</pre>
<p><a id="sthref295"></a><a id="sthref296"></a><a id="sthref297"></a>Notice that the condition in the DML rule begins with the variable <code dir="ltr">:dml</code>. The value is determined by a call to the specified member function for the row LCR being evaluated. So, <code dir="ltr">:dml.is_null_tag()</code> is a call to the <code dir="ltr">IS_NULL_TAG</code> member function for the row LCR being evaluated.</p>
<p>Here is the rule condition used by the DDL LCR rule:</p>
<pre dir="ltr">(:ddl.is_null_tag() = &#39;Y&#39; )
</pre>
<p>Notice that the condition in the DDL rule begins with the variable <code dir="ltr">:ddl</code>. The value is determined by a call to the specified member function for the DDL LCR being evaluated. So, <code dir="ltr">:ddl.is_null_tag()</code> is a call to the <code dir="ltr">IS_NULL_TAG</code> member function for the DDL LCR being evaluated.</p>
<p>For a capture process, these conditions indicate that the <a href="strms_glossary.htm#CHDBJJHH"><span class="xrefglossterm">tag</span></a> must be <code dir="ltr">NULL</code> in a redo record for the capture process to capture a change. For a propagation, these conditions indicate that the tag must be <code dir="ltr">NULL</code> in an LCR for the propagation to propagate the LCR. For an apply process, these conditions indicate that the tag must be <code dir="ltr">NULL</code> in an LCR for the apply process to apply the LCR.</p>
<p>Given the rules created by this example in the positive rule set for the capture process, the capture process captures all supported DML and DDL changes made to the database.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
If you add global rules to the positive rule set for a capture process, then ensure that you add rules to the negative capture process rule set to exclude database objects that are not support by capture processes. Query the <code dir="ltr">DBA_STREAMS_UNSUPPORTED</code> data dictionary view to determine which database objects are not supported by capture processes. If unsupported database objects are not excluded, then capture errors will result.
<p>If you add global rules to the positive rule set for an apply process, then ensure that the apply process does not attempt to apply changes to unsupported columns. To do so, you can add rules to the negative apply process rule set to exclude the table that contains the column, or you can exclude the column with a rule-based transformation or DML handler. Query the <code dir="ltr">DBA_STREAMS_COLUMNS</code> data dictionary view to determine which columns are not supported by apply processes. If unsupported columns are not excluded, then apply errors will result.</p>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_otmon.htm#i1014352">&#34;Listing the Database Objects That Are Not Compatible with Capture Processes&#34;</a></p>
</li>
<li>
<p><a href="strms_otmon.htm#CFFGFIJD">&#34;Listing Database Objects and Columns Not Compatible with Apply Processes&#34;</a></p>
</li>
<li>
<p><a href="strms_transform.htm#CACIIJHJ">Chapter 6, &#34;Rule-Based Transformations&#34;</a></p>
</li>
<li>
<p><a href="strms_apply.htm#BABGBDGD">&#34;DML Handlers&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<div id="STRMS414" class="sect3"><a id="sthref298"></a>
<h4 class="sect3">System-Created Global Rules Avoid Empty Rule Conditions Automatically</h4>
<p>You can omit the <code dir="ltr">is_null_tag</code> condition in system-created rules by specifying <code dir="ltr">TRUE</code> for the <code dir="ltr">include_tagged_lcr</code> parameter when you run a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package. For example, the following <code dir="ltr">ADD_GLOBAL_RULES</code> procedure creates rules without the <code dir="ltr">is_null_tag</code> condition:</p>
<pre dir="ltr">BEGIN DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
   streams_type        =&gt;  &#39;capture&#39;,
   streams_name        =&gt;  &#39;capture_002&#39;,
   queue_name          =&gt;  &#39;streams_queue&#39;,
   include_dml         =&gt;  TRUE,
   include_ddl         =&gt;  TRUE,
   include_tagged_lcr  =&gt;  TRUE,
   source_database     =&gt;  NULL,
   inclusion_rule      =&gt;  TRUE);
END;
/
</pre>
<p>When you set the <code dir="ltr">include_tagged_lcr</code> parameter to <code dir="ltr">TRUE</code> for a global rule, and the <code dir="ltr">source_database_name</code> parameter is set to <code dir="ltr">NULL</code>, the rule condition used by the row LCR rule is the following:</p>
<pre dir="ltr">(( :dml.get_source_database_name()&gt;=&#39; &#39; OR 
:dml.get_source_database_name()&lt;=&#39; &#39;) )
</pre>
<p>Here is the rule condition used by the DDL LCR rule:</p>
<pre dir="ltr">(( :ddl.get_source_database_name()&gt;=&#39; &#39; OR 
:ddl.get_source_database_name()&lt;=&#39; &#39;) )
</pre>
<p>The system-created global rules contain these conditions to enable all row and DDL LCRs to evaluate to <code dir="ltr">TRUE</code>.</p>
<p>These rule conditions are specified to avoid <code dir="ltr">NULL</code> rule conditions for these rules. <code dir="ltr">NULL</code> rule conditions are not supported. In this case, if you want to capture all DML and DDL changes to a database, and you do not want to use any <a href="strms_glossary.htm#CHDGHJDE"><span class="xrefglossterm">rule-based transformation</span></a>s for these changes upon capture, then you can choose to run the capture process without a positive rule set instead of specifying global rules.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>When you create a capture process using a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package and generate one or more rules for the capture process, the objects for which changes are captured are prepared for <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> automatically, unless it is a downstream capture process and there is no database link from the <a href="strms_glossary.htm#CHDBJECA"><span class="xrefglossterm">downstream database</span></a> to the source database.</p>
</li>
<li>
<p>The capture process does not capture some types of DML and DDL changes, and it does not capture changes made in the <code dir="ltr">SYS</code>, <code dir="ltr">SYSTEM</code>, or <code dir="ltr">CTXSYS</code> schemas.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP115" href="../STREP/instant.htm#STREP115"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about capture process rules and preparation for instantiation</p>
</li>
<li>
<p><a href="strms_capture.htm#i1006083">Chapter 2, &#34;Oracle Streams Information Capture&#34;</a> for more information about the capture process and for detailed information about which DML and DDL statements are captured by a capture process</p>
</li>
<li>
<p><a href="strms_adrules.htm#BABEBHGC">Chapter 11, &#34;Advanced Rule Concepts&#34;</a> for more information about variables in conditions</p>
</li>
<li>
<p><a class="olink STREP008" href="../STREP/rep_tags.htm#STREP008"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about Oracle Streams tags</p>
</li>
<li>
<p><a href="#i1010575">&#34;Rule Sets and Rule Evaluation of Messages&#34;</a> for more information about running a capture process with no positive rule set</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1009451"></a>
<div id="STRMS415" class="sect2">
<h3 class="sect2">Schema Rules<a id="sthref299"></a><a id="sthref300"></a></h3>
<p>When you use a <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> to specify an Oracle Streams task that is relevant to a schema, you are specifying a <span class="bold">schema rule</span>. You can specify a schema rule for DML changes, a schema rule for DDL changes, or a schema rule for each type of change to the schema (two rules total).</p>
<p>A single schema rule in the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> for a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> means that the capture process captures either the DML changes or the DDL changes to the schema. A single schema rule in the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for a capture process means that the capture process discards either the DML changes or the DDL changes to the schema.</p>
<p>A single schema rule in the positive rule set for a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> means that the propagation propagates either the row LCRs or the DDL LCRs in the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> that contain changes to the schema. A single schema rule in the negative rule set for a propagation means that the propagation discards either the row LCRs or the DDL LCRs in the source queue that contain changes to the schema.</p>
<p>A single schema rule in the positive rule set for an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> means that the apply process applies either the row LCRs or the DDL LCRs in its <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> that contain changes to the schema. A single schema rule in the negative rule set for an apply process means that the apply process discards either the row LCRs or the DDL LCRs in its queue that contain changes to the schema.</p>
<p>If you want to use schema rules, but you are concerned about changes to database objects in a schema that are not supported by Oracle Streams, then you can create rules using the <code dir="ltr">DBMS_RULE_ADM</code> package to discard unsupported changes.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_adrules.htm#i1016342">&#34;Rule Conditions that Instruct Oracle Streams Clients to Discard Unsupported LCRs&#34;</a></p>
</li>
</ul>
</div>
<a id="i1016333"></a>
<div id="STRMS416" class="sect3">
<h4 class="sect3">Schema Rule Example</h4>
<p>Suppose you use the <code dir="ltr">ADD_SCHEMA_PROPAGATION_RULES</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to instruct an Oracle Streams propagation to propagate row LCRs and DDL LCRs relating to the <code dir="ltr">hr</code> schema from a queue at the <code dir="ltr">dbs1.example.com</code> database to a queue at the <code dir="ltr">dbs2.example.com</code> database.</p>
<p>Run the <code dir="ltr">ADD_SCHEMA_PROPAGATION_RULES</code> procedure at <code dir="ltr">dbs1.example.com</code> to create the rules:</p>
<pre dir="ltr">BEGIN 
  DBMS_STREAMS_ADM.ADD_SCHEMA_PROPAGATION_RULES(
    schema_name              =&gt;  &#39;hr&#39;,
    streams_name             =&gt;  &#39;dbs1_to_dbs2&#39;,
    source_queue_name        =&gt;  &#39;streams_queue&#39;,
    destination_queue_name   =&gt;  &#39;streams_queue@dbs2.example.com&#39;,
    include_dml              =&gt;  TRUE,
    include_ddl              =&gt;  TRUE,
    include_tagged_lcr       =&gt;  FALSE,
    source_database          =&gt;  &#39;dbs1.example.com&#39;,
    inclusion_rule           =&gt;  TRUE);
END;
/
</pre>
<p>Notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that the <a href="strms_glossary.htm#CHDIJACJ"><span class="xrefglossterm">system-created rule</span></a>s are added to the positive rule set for the propagation.</p>
<p>The <code dir="ltr">ADD_SCHEMA_PROPAGATION_RULES</code> procedure creates two rules: one for row LCRs (which contain the results of DML changes) and one for DDL LCRs.</p>
<p>Here is the <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a> used by the row LCR rule:</p>
<pre dir="ltr">((:dml.get_object_owner() = &#39;HR&#39;) and :dml.is_null_tag() = &#39;Y&#39; 
and :dml.get_source_database_name() = &#39;DBS1.EXAMPLE.COM&#39; )
</pre>
<p>Here is the rule condition used by the DDL LCR rule:</p>
<pre dir="ltr">((:ddl.get_object_owner() = &#39;HR&#39; or :ddl.get_base_table_owner() = &#39;HR&#39;) 
and :ddl.is_null_tag() = &#39;Y&#39; and :ddl.get_source_database_name() = 
&#39;DBS1.EXAMPLE.COM&#39; )
</pre>
<p>The <code dir="ltr">GET_BASE_TABLE_OWNER</code> member function is used in the DDL LCR rule because the <code dir="ltr">GET_OBJECT_OWNER</code> function can return <code dir="ltr">NULL</code> if a user who does not own an object performs a DDL change on the object.</p>
<p>Given these rules in the positive rule set for the propagation, the following list provides examples of changes propagated by the propagation:</p>
<ul>
<li>
<p>A row is inserted into the <code dir="ltr">hr.countries</code> table.</p>
</li>
<li>
<p>The <code dir="ltr">hr.loc_city_ix</code> index is altered.</p>
</li>
<li>
<p>The <code dir="ltr">hr.employees</code> table is truncated.</p>
</li>
<li>
<p>A column is added to the <code dir="ltr">hr.countries</code> table.</p>
</li>
<li>
<p>The <code dir="ltr">hr.update_job_history</code> trigger is altered.</p>
</li>
<li>
<p>A new table named <code dir="ltr">candidates</code> is created in the <code dir="ltr">hr</code> schema.</p>
</li>
<li>
<p>Twenty rows are inserted into the <code dir="ltr">hr.candidates</code> table.</p>
</li>
</ul>
<p>The propagation propagates the LCRs that contain all of the changes previously listed from the source queue to the <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a>.</p>
<p>Now, given the same rules, suppose a row is inserted into the <code dir="ltr">oe.inventories</code> table. This change is ignored because the <code dir="ltr">oe</code> schema was not specified in a schema rule, and the <code dir="ltr">oe.inventories</code> table was not specified in a table rule.</p>
<div class="infobox-note">
<p class="notep1">Caution:</p>
If you add schema rules to the positive rule set for a capture process, then ensure that you add rules to the negative capture process rule set to exclude database objects in the schema that are not support by capture processes. Query the <code dir="ltr">DBA_STREAMS_UNSUPPORTED</code> data dictionary view to determine which database objects are not supported by capture processes. If unsupported database objects are not excluded, then capture errors will result.
<p>If you add schema rules to the positive rule set for an apply process, then ensure that the apply process does not attempt to apply changes to unsupported columns. To do so, you can add rules to the negative apply process rule set to exclude the table that contains the column, or you can exclude the column with a rule-based transformation or DML handler. Query the <code dir="ltr">DBA_STREAMS_COLUMNS</code> data dictionary view to determine which columns are not supported by apply processes. If unsupported columns are not excluded, then apply errors will result.</p>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_otmon.htm#i1014352">&#34;Listing the Database Objects That Are Not Compatible with Capture Processes&#34;</a></p>
</li>
<li>
<p><a href="strms_otmon.htm#CFFGFIJD">&#34;Listing Database Objects and Columns Not Compatible with Apply Processes&#34;</a></p>
</li>
<li>
<p><a href="strms_transform.htm#CACIIJHJ">Chapter 6, &#34;Rule-Based Transformations&#34;</a></p>
</li>
<li>
<p><a href="strms_apply.htm#BABGBDGD">&#34;DML Handlers&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1008651"></a>
<div id="STRMS108" class="sect2">
<h3 class="sect2">Table Rules<a id="sthref301"></a><a id="sthref302"></a><a id="sthref303"></a></h3>
<p>When you use a <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> to specify an Oracle Streams task that is relevant only for an individual table, you are specifying a <span class="bold">table rule</span>. You can specify a table rule for DML changes, a table rule for DDL changes, or a table rule for each type of change to a specific table (two rules total).</p>
<p>A single table rule in the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> for a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> means that the capture process captures the results of either the DML changes or the DDL changes to the table. A single table rule in the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for a capture process means that the capture process discards the results of either the DML changes or the DDL changes to the table.</p>
<p>A single table rule in the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> for a <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> means that the synchronous capture captures the results of either the DML changes to the table. A synchronous capture cannot have a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>.</p>
<p>A single table rule in the positive rule set for a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> means that the propagation propagates either the row LCRs or the DDL LCRs in the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> that contain changes to the table. A single table rule in the negative rule set for a propagation means that the propagation discards either the row LCRs or the DDL LCRs in the source queue that contain changes to the table.</p>
<p>A single table rule in the positive rule set for an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> means that the apply process applies either the row LCRs or the DDL LCRs in its <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> that contain changes to the table. A single table rule in the negative rule set for an apply process means that the apply process discards either the row LCRs or the DDL LCRs in its queue that contain changes to the table.</p>
<a id="i1008680"></a>
<div id="STRMS417" class="sect3">
<h4 class="sect3">Table Rules Example</h4>
<p>Suppose you use the <code dir="ltr">ADD_TABLE_RULES</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to instruct an Oracle Streams apply process to behave in the following ways:</p>
<ul>
<li>
<p><a href="#i1008698">Apply All Row LCRs Related to the hr.locations Table</a></p>
</li>
<li>
<p><a href="#i1009171">Apply All DDL LCRs Related to the hr.countries Table</a></p>
</li>
</ul>
<a id="i1008698"></a>
<div id="STRMS418" class="sect4">
<h5 class="sect4">Apply All Row LCRs Related to the hr.locations Table</h5>
<p>The changes in these row LCRs originated at the <code dir="ltr">dbs1.example.com</code> <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>.</p>
<p>Run the <code dir="ltr">ADD_TABLE_RULES</code> procedure to create this rule:</p>
<pre dir="ltr">BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name          =&gt;  &#39;hr.locations&#39;,
    streams_type        =&gt;  &#39;apply&#39;,
    streams_name        =&gt;  &#39;apply&#39;,
    queue_name          =&gt;  &#39;streams_queue&#39;,
    include_dml         =&gt;  TRUE,
    include_ddl         =&gt;  FALSE,
    include_tagged_lcr  =&gt;  FALSE,
    source_database     =&gt;  &#39;dbs1.example.com&#39;,
    inclusion_rule      =&gt;  TRUE);
END;
/
</pre>
<p>Notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that the <a href="strms_glossary.htm#CHDIJACJ"><span class="xrefglossterm">system-created rule</span></a> is added to the positive rule set for the apply process.</p>
<p>The <code dir="ltr">ADD_TABLE_RULES</code> procedure creates a rule with a <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a> similar to the following:</p>
<pre dir="ltr">(((:dml.get_object_owner() = &#39;HR&#39; and :dml.get_object_name() = &#39;LOCATIONS&#39;)) 
and :dml.is_null_tag() = &#39;Y&#39; and :dml.get_source_database_name() = 
&#39;DBS1.EXAMPLE.COM&#39; )
</pre></div>
<!-- class="sect4" -->
<a id="i1009171"></a>
<div id="STRMS419" class="sect4">
<h5 class="sect4">Apply All DDL LCRs Related to the hr.countries Table</h5>
<p>The changes in these DDL LCRs originated at the <code dir="ltr">dbs1.example.com</code> source database.</p>
<p>Run the <code dir="ltr">ADD_TABLE_RULES</code> procedure to create this rule:</p>
<pre dir="ltr">BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name          =&gt;  &#39;hr.countries&#39;,
    streams_type        =&gt;  &#39;apply&#39;,
    streams_name        =&gt;  &#39;apply&#39;,
    queue_name          =&gt;  &#39;streams_queue&#39;,
    include_dml         =&gt;  FALSE,
    include_ddl         =&gt;  TRUE,
    include_tagged_lcr  =&gt;  FALSE,
    source_database     =&gt;  &#39;dbs1.example.com&#39;,
    inclusion_rule      =&gt;  TRUE);
END;
/
</pre>
<p>Notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that the system-created rule is added to the positive rule set for the apply process.</p>
<p><a id="sthref304"></a><a id="sthref305"></a>The <code dir="ltr">ADD_TABLE_RULES</code> procedure creates a rule with a rule condition similar to the following:</p>
<pre dir="ltr">(((:ddl.get_object_owner() = &#39;HR&#39; and :ddl.get_object_name() = &#39;COUNTRIES&#39;)
or (:ddl.get_base_table_owner() = &#39;HR&#39; 
and :ddl.get_base_table_name() = &#39;COUNTRIES&#39;)) and :ddl.is_null_tag() = &#39;Y&#39; 
and :ddl.get_source_database_name() = &#39;DBS1.EXAMPLE.COM&#39; )
</pre>
<p>The <code dir="ltr">GET_BASE_TABLE_OWNER</code> and <code dir="ltr">GET_BASE_TABLE_NAME</code> member functions are used in the DDL LCR rule because the <code dir="ltr">GET_OBJECT_OWNER</code> and <code dir="ltr">GET_OBJECT_NAME</code> functions can return <code dir="ltr">NULL</code> if a user who does not own an object performs a DDL change on the object.</p>
<p>The generated DDL table rule evaluates to <code dir="ltr">TRUE</code> for any DDL change that operates on the table or on an object that is part of the table, such as an index or trigger on the table. The rule evaluates to <code dir="ltr">FALSE</code> for any DDL change that either does not refer to the table or refers to the table in a subordinate way. For example, the rule evaluates to <code dir="ltr">FALSE</code> for changes that create synonyms or views based on the table. The rule also evaluates to <code dir="ltr">FALSE</code> for a change to a PL/SQL subprogram that refers to the table.</p>
</div>
<!-- class="sect4" -->
<div id="STRMS420" class="sect4"><a id="sthref306"></a>
<h5 class="sect4">Summary of Rules</h5>
<p>In this example, the following table rules were defined:</p>
<ul>
<li>
<p>A table rule that evaluates to <code dir="ltr">TRUE</code> if a row LCR contains a row change that results from a DML operation on the <code dir="ltr">hr.locations</code> table.</p>
</li>
<li>
<p>A table rule that evaluates to <code dir="ltr">TRUE</code> if a DDL LCR contains a DDL change performed on the <code dir="ltr">hr.countries</code> table.</p>
</li>
</ul>
<p>Given these rules, the following list provides examples of changes applied by an apply process:</p>
<ul>
<li>
<p>A row is inserted into the <code dir="ltr">hr.locations</code> table.</p>
</li>
<li>
<p>Five rows are deleted from the <code dir="ltr">hr.locations</code> table.</p>
</li>
<li>
<p>A column is added to the <code dir="ltr">hr.countries</code> table.</p>
</li>
</ul>
<p>The apply process dequeues the LCRs containing these changes from its associated queue and applies them to the database objects at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>.</p>
<p>Given these rules, the following list provides examples of changes that are ignored by the apply process:</p>
<ul>
<li>
<p>A row is inserted into the <code dir="ltr">hr.employees</code> table. This change is not applied because a change to the <code dir="ltr">hr.employees</code> table does not satisfy any of the rules.</p>
</li>
<li>
<p>A row is updated in the <code dir="ltr">hr.countries</code> table. This change is a DML change, not a DDL change. This change is not applied because the rule on the <code dir="ltr">hr.countries</code> table is for DDL changes only.</p>
</li>
<li>
<p>A column is added to the <code dir="ltr">hr.locations</code> table. This change is a DDL change, not a DML change. This change is not applied because the rule on the <code dir="ltr">hr.locations</code> table is for DML changes only.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Do not add table rules to the positive rule set of a capture process for tables that are not supported by capture processes. Query the <code dir="ltr">DBA_STREAMS_UNSUPPORTED</code> data dictionary view to determine which tables are not supported by capture processes. If unsupported table are not excluded, then capture errors will result.
<p>If you add table rules to the positive rule set for a synchronous capture or an apply process, then ensure that these Oracle Streams clients do not attempt to process changes to unsupported columns. If a table includes an unsupported column, then you can exclude the column with a rule-based transformation or, for an apply process, with a DML handler. Query the <code dir="ltr">DBA_STREAMS_COLUMNS</code> data dictionary view to determine which columns are not supported by synchronous captures and apply processes. If unsupported columns are not excluded, then errors will result.</p>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_otmon.htm#i1014352">&#34;Listing the Database Objects That Are Not Compatible with Capture Processes&#34;</a></p>
</li>
<li>
<p><a href="strms_otmon.htm#CFFHHBAB">&#34;Listing Database Objects and Columns Not Compatible with Synchronous Captures&#34;</a></p>
</li>
<li>
<p><a href="strms_otmon.htm#CFFGFIJD">&#34;Listing Database Objects and Columns Not Compatible with Apply Processes&#34;</a></p>
</li>
<li>
<p><a href="strms_transform.htm#CACIIJHJ">Chapter 6, &#34;Rule-Based Transformations&#34;</a></p>
</li>
<li>
<p><a href="strms_apply.htm#BABGBDGD">&#34;DML Handlers&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1009452"></a>
<div id="STRMS124" class="sect2">
<h3 class="sect2">Subset Rules<a id="sthref307"></a><a id="sthref308"></a><a id="sthref309"></a><a id="sthref310"></a><a id="sthref311"></a></h3>
<p>A <span class="bold">subset rule</span> is a special type of <a href="strms_glossary.htm#CHDEGGGH"><span class="xrefglossterm">table rule</span></a> for DML changes that is relevant only to a subset of the rows in a table. You can create subset rules for <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es, <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>s, <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>es, and <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a>s using the <code dir="ltr">ADD_SUBSET_RULES</code> procedure. You can create subset rules for <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s using the <code dir="ltr">ADD_SUBSET_PROPAGATION_RULES</code> procedure. These procedures enable you to use a condition similar to a <code dir="ltr">WHERE</code> clause in a <code dir="ltr">SELECT</code> statement to specify the following:</p>
<ul>
<li>
<p>That a capture process only captures a subset of the row changes resulting from DML changes to a particular table</p>
</li>
<li>
<p>That a synchronous capture only captures a subset of the row changes resulting from DML changes to a particular table</p>
</li>
<li>
<p>That a propagation only propagates a subset of the row LCRs relating to a particular table</p>
</li>
<li>
<p>That an apply process only applies a subset of the row LCRs relating to a particular table</p>
</li>
<li>
<p>That a messaging client only dequeues a subset of the row LCRs relating to a particular table</p>
</li>
</ul>
<p>The <code dir="ltr">ADD_SUBSET_RULES</code> procedure and the <code dir="ltr">ADD_SUBSET_PROPAGATION_RULES</code> procedure can add subset rules to the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> only of an <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>. You cannot add subset rules to the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for an Oracle Streams client using these procedures.</p>
<p>The following sections describe subset rules in more detail:</p>
<ul>
<li>
<p><a href="#i1009455">Subset Rules Example</a></p>
</li>
<li>
<p><a href="#i1007704">Row Migration and Subset Rules</a></p>
</li>
<li>
<p><a href="#i1009605">Subset Rules and Supplemental Logging</a></p>
</li>
<li>
<p><a href="#i1009475">Guidelines for Using Subset Rules</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="ap_restrictions.htm#i1012965">&#34;Restrictions for Subset Rules&#34;</a></p>
</li>
</ul>
</div>
<a id="i1009455"></a>
<div id="STRMS421" class="sect3">
<h4 class="sect3">Subset Rules Example</h4>
<p>This example instructs an Oracle Streams apply process to apply a subset of row LCRs relating to the <code dir="ltr">hr.regions</code> table where the <code dir="ltr">region_id</code> is <code dir="ltr">2</code>. These changes originated at the <code dir="ltr">dbs1.example.com</code> <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>.</p>
<p>Run the <code dir="ltr">ADD_SUBSET_RULES</code> procedure to create three rules:</p>
<pre dir="ltr">BEGIN 
  DBMS_STREAMS_ADM.ADD_SUBSET_RULES(
    table_name               =&gt;  &#39;hr.regions&#39;,
    dml_condition            =&gt;  &#39;region_id=2&#39;,
    streams_type             =&gt;  &#39;apply&#39;,
    streams_name             =&gt;  &#39;apply&#39;,
    queue_name               =&gt;  &#39;streams_queue&#39;,
    include_tagged_lcr       =&gt;  FALSE,
    source_database          =&gt;  &#39;dbs1.example.com&#39;);
END;
/
</pre>
<p>The <code dir="ltr">ADD_SUBSET_RULES</code> procedure creates three rules: one for <code dir="ltr">INSERT</code> operations, one for <code dir="ltr">UPDATE</code> operations, and one for <code dir="ltr">DELETE</code> operations.</p>
<p>Here is the <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a> used by the insert rule:</p>
<pre dir="ltr">:dml.get_object_owner()=&#39;HR&#39; AND :dml.get_object_name()=&#39;REGIONS&#39; 
AND :dml.is_null_tag()=&#39;Y&#39; AND :dml.get_source_database_name()=&#39;DBS1.EXAMPLE.COM&#39;
AND :dml.get_command_type() IN (&#39;UPDATE&#39;,&#39;INSERT&#39;) 
AND (:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;) IS NOT NULL) 
AND (:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2) 
AND (:dml.get_command_type()=&#39;INSERT&#39; 
OR ((:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;) IS NOT NULL) 
AND (((:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber() IS NOT NULL) 
AND NOT (:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2)) 
OR ((:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber() IS NULL) 
AND NOT EXISTS (SELECT 1 FROM SYS.DUAL 
WHERE (:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2))))))
</pre>
<p>Based on this rule condition, row LCRs are evaluated in the following ways:</p>
<ul>
<li>
<p>For an insert, if the new value in the row LCR for <code dir="ltr">region_id</code> is <code dir="ltr">2</code>, then the insert is applied.</p>
</li>
<li>
<p>For an insert, if the new value in the row LCR for <code dir="ltr">region_id</code> is not <code dir="ltr">2</code> or is <code dir="ltr">NULL</code>, then the insert is filtered out.</p>
</li>
<li>
<p>For an update, if the old value in the row LCR for <code dir="ltr">region_id</code> is not <code dir="ltr">2</code> or is <code dir="ltr">NULL</code> and the new value in the row LCR for <code dir="ltr">region_id</code> is <code dir="ltr">2</code>, then the update is converted into an insert and applied. This automatic conversion is called <a href="strms_glossary.htm#CHDJICJC"><span class="xrefglossterm">row migration</span></a>. See <a href="#i1007704">&#34;Row Migration and Subset Rules&#34;</a> for more information.</p>
</li>
</ul>
<p>Here is the rule condition used by the update rule:</p>
<pre dir="ltr">:dml.get_object_owner()=&#39;HR&#39; AND :dml.get_object_name()=&#39;REGIONS&#39; 
AND :dml.is_null_tag()=&#39;Y&#39; AND :dml.get_source_database_name()=&#39;DBS1.EXAMPLE.COM&#39;
AND :dml.get_command_type()=&#39;UPDATE&#39; 
AND (:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;) IS NOT NULL) 
AND (:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;) IS NOT NULL) 
AND (:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2) 
AND (:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2)
</pre>
<p>Based on this rule condition, row LCRs are evaluated in the following ways:</p>
<ul>
<li>
<p>For an update, if both the old value and the new value in the row LCR for <code dir="ltr">region_id</code> are <code dir="ltr">2</code>, then the update is applied as an update.</p>
</li>
<li>
<p>For an update, if either the old value or the new value in the row LCR for <code dir="ltr">region_id</code> is not&nbsp;<code dir="ltr">2</code> or is <code dir="ltr">NULL</code>, then the update does not satisfy the update rule. The LCR can satisfy the insert rule, the delete rule, or neither rule.</p>
</li>
</ul>
<p>Here is the rule condition used by the delete rule:</p>
<pre dir="ltr">:dml.get_object_owner()=&#39;HR&#39; AND :dml.get_object_name()=&#39;REGIONS&#39; 
AND :dml.is_null_tag()=&#39;Y&#39; AND :dml.get_source_database_name()=&#39;DBS1.EXAMPLE.COM&#39;
AND :dml.get_command_type() IN (&#39;UPDATE&#39;,&#39;DELETE&#39;) 
AND (:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;) IS NOT NULL) 
AND (:dml.get_value(&#39;OLD&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2) 
AND (:dml.get_command_type()=&#39;DELETE&#39; 
OR ((:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;) IS NOT NULL) 
AND (((:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber() IS NOT NULL) 
AND NOT (:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2)) 
OR ((:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber() IS NULL) 
AND NOT EXISTS (SELECT 1 FROM SYS.DUAL 
WHERE (:dml.get_value(&#39;NEW&#39;,&#39;&#34;REGION_ID&#34;&#39;).AccessNumber()=2))))))
</pre>
<p>Based on this rule condition, row LCRs are evaluated in the following ways:</p>
<ul>
<li>
<p>For a delete, if the old value in the row LCR for <code dir="ltr">region_id</code> is <code dir="ltr">2</code>, then the delete is applied.</p>
</li>
<li>
<p>For a delete, if the old value in the row LCR for <code dir="ltr">region_id</code> is not <code dir="ltr">2</code> or is <code dir="ltr">NULL</code>, then the delete is filtered out.</p>
</li>
<li>
<p>For an update, if the old value in the row LCR for <code dir="ltr">region_id</code> is <code dir="ltr">2</code> and the new value in the row LCR for <code dir="ltr">region_id</code> is not <code dir="ltr">2</code> or is <code dir="ltr">NULL</code>, then the update is converted into a delete and applied. This automatic conversion is called row migration. See <a href="#i1007704">&#34;Row Migration and Subset Rules&#34;</a> for more information.</p>
</li>
</ul>
<p>Given these subset rules, the following list provides examples of changes applied by an apply process:</p>
<ul>
<li>
<p>A row is updated in the <code dir="ltr">hr.regions</code> table where the old <code dir="ltr">region_id</code> is <code dir="ltr">4</code> and the new value of <code dir="ltr">region_id</code> is <code dir="ltr">2</code>. This update is transformed into an insert.</p>
</li>
<li>
<p>A row is updated in the <code dir="ltr">hr.regions</code> table where the old <code dir="ltr">region_id</code> is <code dir="ltr">2</code> and the new value of <code dir="ltr">region_id</code> is <code dir="ltr">1</code>. This update is transformed into a delete.</p>
</li>
</ul>
<p>The apply process dequeues row LCRs containing these changes from its associated <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> and applies them to the <code dir="ltr">hr.regions</code> table at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>.</p>
<p>Given these subset rules, the following list provides examples of changes that are ignored by the apply process:</p>
<ul>
<li>
<p>A row is inserted into the <code dir="ltr">hr.employees</code> table. This change is not applied because a change to the <code dir="ltr">hr.employees</code> table does not satisfy the subset rules.</p>
</li>
<li>
<p>A row is updated in the <code dir="ltr">hr.regions</code> table where the <code dir="ltr">region_id</code> was <code dir="ltr">1</code> before the update and remains <code dir="ltr">1</code> after the update. This change is not applied because the subset rules for the <code dir="ltr">hr.regions</code> table evaluate to <code dir="ltr">TRUE</code> only when the new or old (or both) values for <code dir="ltr">region_id</code> is <code dir="ltr">2</code>.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Do not add subset rules to the positive rule set of a capture process for tables that are not supported by capture processes. Query the <code dir="ltr">DBA_STREAMS_UNSUPPORTED</code> data dictionary view to determine which tables are not supported by capture processes. If unsupported table are not excluded, then capture errors will result.
<p>If you add subset rules to the positive rule set for a synchronous capture or an apply process, then ensure that these Oracle Streams clients do not attempt to process changes to unsupported columns. If a table includes an unsupported column, then you can exclude the column with a rule-based transformation or, for an apply process, with a DML handler. Query the <code dir="ltr">DBA_STREAMS_COLUMNS</code> data dictionary view to determine which columns are not supported by synchronous captures and apply processes. If unsupported columns are not excluded, then errors will result.</p>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_otmon.htm#i1014352">&#34;Listing the Database Objects That Are Not Compatible with Capture Processes&#34;</a></p>
</li>
<li>
<p><a href="strms_otmon.htm#CFFHHBAB">&#34;Listing Database Objects and Columns Not Compatible with Synchronous Captures&#34;</a></p>
</li>
<li>
<p><a href="strms_otmon.htm#CFFGFIJD">&#34;Listing Database Objects and Columns Not Compatible with Apply Processes&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="i1007704"></a>
<div id="STRMS114" class="sect3">
<h4 class="sect3">Row Migration and Subset Rules<a id="sthref312"></a><a id="sthref313"></a><a id="sthref314"></a><a id="sthref315"></a><a id="sthref316"></a></h4>
<p>When you use subset rules, an update operation can be converted into an insert or delete operation when it is captured, propagated, applied, or dequeued. This automatic conversion is called <span class="bold">row migration</span> and is performed by an internal transformation specified automatically in the <a href="strms_glossary.htm#CBACHAJI"><span class="xrefglossterm">action context</span></a> for a subset rule. The following sections describe row migration during capture, propagation, apply, and dequeue.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#BABJAHIE">Row Migration During Capture</a></p>
</li>
<li>
<p><a href="#BABBAABC">Row Migration During Propagation</a></p>
</li>
<li>
<p><a href="#BABHCIDD">Row Migration During Apply</a></p>
</li>
<li>
<p><a href="#BABBEJBE">Row Migration During Dequeue by a Messaging Client</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Caution:</p>
Subset rules should reside only in positive rule sets. Do not add subset rules to negative rule sets. Doing so can have unpredictable results, because row migration would not be performed on LCRs that are not discarded by the negative rule set. Also, row migration is not performed on LCRs discarded because they evaluate to <code dir="ltr">TRUE</code> against a negative rule set.</div>
<a id="BABJAHIE"></a>
<div id="STRMS422" class="sect4">
<h5 class="sect4">Row Migration During Capture</h5>
<p>When a subset rule is in the rule set for a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> or <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a>, an update that satisfies the subset rule can be converted into an insert or delete when it is captured.</p>
<p>For example, suppose you use a subset rule to specify that a capture process or a synchronous capture captures changes to the <code dir="ltr">hr.employees</code> table where the employee&#39;s <code dir="ltr">department_id</code> is <code dir="ltr">50</code> using the following subset condition: <code dir="ltr">department_id</code>&nbsp;<code dir="ltr">=</code>&nbsp;<code dir="ltr">50</code>. Assume that the table at the source database contains records for employees from all departments. If a DML operation changes an employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">80</code> to <code dir="ltr">50</code>, then the subset rule converts the update operation into an insert operation and captures the change. Therefore, a row LCR that contains an <code dir="ltr">INSERT</code> is enqueued into the queue. <a href="#i1010090">Figure 5-2</a> illustrates this example with a subset rule for a capture process.</p>
<div id="STRMS423" class="figure">
<p class="titleinfigure"><a id="i1010090"></a>Figure 5-2 Row Migration During Capture by a Capture Process</p>
<img width="600" height="400" src="img/strms041.gif" alt="Description of Figure 5-2 follows"/><br/>
<a id="sthref317" href="img_text/strms041.htm">Description of &#34;Figure 5-2 Row Migration During Capture by a Capture Process&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Similarly, if a captured update changes an employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">50</code> to <code dir="ltr">20</code>, then a capture process or synchronous capture with this subset rule converts the update operation into a <code dir="ltr">DELETE</code> operation.</p>
</div>
<!-- class="sect4" -->
<a id="BABBAABC"></a>
<div id="STRMS424" class="sect4">
<h5 class="sect4">Row Migration During Propagation</h5>
<p>When a subset rule is in the rule set for a propagation, an update operation can be converted into an insert or delete operation when a row LCR is propagated.</p>
<p>For example, suppose you use a subset rule to specify that a propagation propagates changes to the <code dir="ltr">hr.employees</code> table where the employee&#39;s <code dir="ltr">department_id</code> is <code dir="ltr">50</code> using the following subset condition: <code dir="ltr">department_id</code>&nbsp;<code dir="ltr">=</code>&nbsp;<code dir="ltr">50</code>. If the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> for the propagation contains a row LCR with an update operation on the <code dir="ltr">hr.employees</code> table that changes an employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">50</code> to <code dir="ltr">80</code>, then the propagation with the subset rule converts the update operation into a delete operation and propagates the row LCR to the <a href="strms_glossary.htm#CHDHJHJD"><span class="xrefglossterm">destination queue</span></a>. Therefore, a row LCR that contains a <code dir="ltr">DELETE</code> is enqueued into the destination queue. <a href="#i1010082">Figure 5-3</a> illustrates this example.</p>
<div id="STRMS425" class="figure">
<p class="titleinfigure"><a id="i1010082"></a>Figure 5-3 Row Migration During Propagation</p>
<img width="600" height="432" src="img/strms040.gif" alt="Description of Figure 5-3 follows"/><br/>
<a id="sthref318" href="img_text/strms040.htm">Description of &#34;Figure 5-3 Row Migration During Propagation&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Similarly, if a captured update changes an employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">80</code> to <code dir="ltr">50</code>, then a propagation with this subset rule converts the update operation into an <code dir="ltr">INSERT</code> operation.</p>
</div>
<!-- class="sect4" -->
<a id="BABHCIDD"></a>
<div id="STRMS426" class="sect4">
<h5 class="sect4">Row Migration During Apply</h5>
<p>When a subset rule is in the rule set for an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>, an update operation can be converted into an insert or delete operation when a row LCR is applied.</p>
<p>For example, suppose you use a subset rule to specify that an apply process applies changes to the <code dir="ltr">hr.employees</code> table where the employee&#39;s <code dir="ltr">department_id</code> is <code dir="ltr">50</code> using the following subset condition: <code dir="ltr">department_id</code> <code dir="ltr">=</code> <code dir="ltr">50</code>. Assume that the table at the destination database is a subset table that only contains records for employees whose <code dir="ltr">department_id</code> is <code dir="ltr">50</code>. If a source database captures a change to an employee that changes the employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">80</code> to <code dir="ltr">50</code>, then the apply process with the subset rule at a destination database applies this change by converting the update operation into an insert operation. This conversion is needed because the employee&#39;s row does not exist in the destination table. <a href="#i1010067">Figure 5-4</a> illustrates this example.</p>
<div id="STRMS427" class="figure">
<p class="titleinfigure"><a id="i1010067"></a>Figure 5-4 Row Migration During Apply</p>
<img width="600" height="400" src="img/strms034.gif" alt="Description of Figure 5-4 follows"/><br/>
<a id="sthref319" href="img_text/strms034.htm">Description of &#34;Figure 5-4 Row Migration During Apply&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Similarly, if a captured update changes an employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">50</code> to <code dir="ltr">20</code>, then an apply process with this subset rule converts the update operation into a <code dir="ltr">DELETE</code> operation.</p>
</div>
<!-- class="sect4" -->
<a id="BABBEJBE"></a>
<div id="STRMS428" class="sect4">
<h5 class="sect4">Row Migration During Dequeue by a Messaging Client</h5>
<p>When a subset rule is in the rule set for a messaging client, an update operation can be converted into an insert or delete operation when a row LCR is dequeued.</p>
<p>For example, suppose you use a subset rule to specify that a messaging client dequeues changes to the <code dir="ltr">hr.employees</code> table when the employee&#39;s <code dir="ltr">department_id</code> is <code dir="ltr">50</code> using the following subset condition: <code dir="ltr">department_id</code>&nbsp;<code dir="ltr">=</code>&nbsp;<code dir="ltr">50</code>. If the queue for a messaging client contains a persistent row LCR with an update operation on the <code dir="ltr">hr.employees</code> table that changes an employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">50</code> to <code dir="ltr">90</code>, then when a user or application invokes a messaging client with this subset rule, the messaging client converts the update operation into a delete operation and dequeues the row LCR. Therefore, a row LCR that contains a <code dir="ltr">DELETE</code> is dequeued. The messaging client can process this row LCR in any customized way. For example, it can send the row LCR to a custom application. <a href="#i1018112">Figure 5-5</a> illustrates this example.</p>
<div id="STRMS429" class="figure">
<p class="titleinfigure"><a id="i1018112"></a>Figure 5-5 Row Migration During Dequeue by a Messaging Client</p>
<img width="600" height="352" src="img/strms046.gif" alt="Description of Figure 5-5 follows"/><br/>
<a id="sthref320" href="img_text/strms046.htm">Description of &#34;Figure 5-5 Row Migration During Dequeue by a Messaging Client&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Similarly, if a persistent row LCR contains an update that changes an employee&#39;s <code dir="ltr">department_id</code> from <code dir="ltr">90</code> to <code dir="ltr">50</code>, then a messaging client with this subset rule converts the <code dir="ltr">UPDATE</code> operation into an <code dir="ltr">INSERT</code> operation during dequeue.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="i1009605"></a>
<div id="STRMS430" class="sect3">
<h4 class="sect3">Subset Rules and Supplemental Logging</h4>
<p>Supplemental logging is required when you specify the following types of subset rules:</p>
<ul>
<li>
<p>Subset rules for a capture process</p>
</li>
<li>
<p>Subset rules for a propagation that will propagate LCRs captured by a capture process</p>
</li>
<li>
<p>Subset rules for an apply process that will apply LCRs captured by a capture process</p>
</li>
</ul>
<p>In any of these cases, an unconditional <a href="strms_glossary.htm#CHDJHFHF"><span class="xrefglossterm">supplemental log group</span></a> must be specified at the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> for all the columns in the subset condition and all of the columns in the table(s) at the destination database(s) that will apply these changes. In some cases, when a subset rule is specified, an update can be converted to an insert, and, in these cases, supplemental information might be needed for some or all of the columns.</p>
<p>For example, if you specify a subset rule for an apply process that will apply <a href="strms_glossary.htm#CHDCHEJI"><span class="xrefglossterm">captured LCR</span></a>s at database <code dir="ltr">dbs2.example.com</code> on the <code dir="ltr">postal_code</code> column in the <code dir="ltr">hr.locations</code> table, and the source database for changes to this table is <code dir="ltr">dbs1.example.com</code>, then specify <a href="strms_glossary.htm#CHDIHHGA"><span class="xrefglossterm">supplemental logging</span></a> at <code dir="ltr">dbs1.example.com</code> for all of the columns that exist in the <code dir="ltr">hr.locations</code> table at <code dir="ltr">dbs2.example.com</code>, and for the <code dir="ltr">postal_code</code> column, even if this column does not exist in the table at the destination database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Supplemental logging is not required when subset rules are used by a synchronous capture. Also, supplemental logging is not required propagations or apply processes process LCRs captured by synchronous capture.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP107" href="../STREP/prep_rep.htm#STREP107"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for detailed information about supplemental logging</p>
</li>
<li>
<p><a href="strms_capture.htm#i1007293">&#34;Supplemental Logging in an Oracle Streams Environment&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="i1009475"></a>
<div id="STRMS431" class="sect3">
<h4 class="sect3">Guidelines for Using Subset Rules</h4>
<p>The following sections provide guidelines for using subset rules:</p>
<ul>
<li>
<p><a href="#i1009830">Use Capture Subset Rules When All Destinations Need Only a Subset of Changes</a></p>
</li>
<li>
<p><a href="#i1009866">Use Propagation or Apply Subset Rules When Some Destinations Need Subsets</a></p>
</li>
<li>
<p><a href="#i1009868">Ensure That the Table Where Subset Row LCRs Are Applied Is a Subset Table</a></p>
</li>
</ul>
<a id="i1009830"></a>
<div id="STRMS432" class="sect4">
<h5 class="sect4">Use Capture Subset Rules When All Destinations Need Only a Subset of Changes</h5>
<p>Use subset rules with a capture process or a synchronous capture when all destination databases of the captured changes need only row changes that satisfy the subset condition for the table. In this case, a capture process or a synchronous capture captures a subset of the DML changes to the table, and one or more propagations propagate these changes in the form of row LCRs to one or more destination databases. At each destination database, an apply process applies these row LCRs to a subset table in which all of the rows satisfy the subset condition in the subset rules for the capture process. None of the destination databases need all of the DML changes made to the table. When you use subset rules for a <a href="strms_glossary.htm#CHDDGCGH"><span class="xrefglossterm">local capture process</span></a> or a synchronous capture, some additional overhead is incurred to perform row migrations at the site running the source database.</p>
</div>
<!-- class="sect4" -->
<a id="i1009866"></a>
<div id="STRMS433" class="sect4">
<h5 class="sect4">Use Propagation or Apply Subset Rules When Some Destinations Need Subsets</h5>
<p>Use subset rules with a propagation or an apply process when some destinations in an environment need only a subset of captured DML changes. The following are examples of such an environment:</p>
<ul>
<li>
<p>Most of the destination databases for captured DML changes to a table need a different subset of these changes.</p>
</li>
<li>
<p>Most of the destination databases need all of the captured DML changes to a table, but some destination databases need only a subset of these changes.</p>
</li>
</ul>
<p>In these types of environments, the capture process or synchronous capture must capture all of the changes to the table, but you can use subset rules with propagations and apply processes to ensure that subset tables at destination databases only apply the correct subset of captured DML changes.</p>
<p>Consider these factors when you decide to use subset rules with a propagation in this type of environment:</p>
<ul>
<li>
<p>You can reduce network traffic because fewer row LCRs are propagated over the network.</p>
</li>
<li>
<p>The site that contains the source queue for the propagation incurs some additional overhead to perform row migrations.</p>
</li>
</ul>
<p>Consider these factors when you decide to use subset rules with an apply process in this type of environment:</p>
<ul>
<li>
<p>The queue used by the apply process can contain all row LCRs for the subset table. In a <a href="strms_glossary.htm#CHDECDHJ"><span class="xrefglossterm">directed network</span></a>s environment, propagations can propagate any of the row LCRs for the table to destination queues as appropriate, whether the apply process applies these row LCRs.</p>
</li>
<li>
<p>The site that is running the apply process incurs some additional overhead to perform row migrations.</p>
</li>
</ul>
</div>
<!-- class="sect4" -->
<a id="i1009868"></a>
<div id="STRMS434" class="sect4">
<h5 class="sect4">Ensure That the Table Where Subset Row LCRs Are Applied Is a Subset Table</h5>
<p>If an apply process might apply row LCRs that have been transformed by a row migration, then Oracle recommends that the table at the destination database be a subset table where each row matches the condition in the subset rule. If the table is not such a subset table, then apply errors might result.</p>
<p>For example, consider a scenario in which a subset rule for a capture process has the condition <code dir="ltr">department_id</code> <code dir="ltr">=</code> <code dir="ltr">50</code> for DML changes to the <code dir="ltr">hr.employees</code> table. If the <code dir="ltr">hr.employees</code> table at a destination database of this capture process contains rows for employees in all departments, not just in department <code dir="ltr">50</code>, then a constraint violation might result during apply:</p>
<ol>
<li>
<p>At the source database, a DML change updates the <code dir="ltr">hr.employees</code> table and changes the <code dir="ltr">department_id</code> for the employee with an <code dir="ltr">employee_id</code> of <code dir="ltr">100</code> from <code dir="ltr">90</code> to <code dir="ltr">50</code>.</p>
</li>
<li>
<p>A capture process using the subset rule captures the change and converts the update into an insert and enqueues the change into the capture process&#39;s queue as a row&nbsp;LCR.</p>
</li>
<li>
<p>A propagation propagates the row LCR to the destination database without modifying it.</p>
</li>
<li>
<p>An apply process attempts to apply the row LCR as an insert at the destination database, but an employee with an <code dir="ltr">employee_id</code> of <code dir="ltr">100</code> already exists in the <code dir="ltr">hr.employees</code> table, and an apply error results.</p>
</li>
</ol>
<p>In this case, if the table at the destination database were a subset of the <code dir="ltr">hr.employees</code> table and only contained rows of employees whose <code dir="ltr">department_id</code> was <code dir="ltr">50</code>, then the insert would have been applied successfully.</p>
<p>Similarly, if an apply process might apply row LCRs that have been transformed by a row migration to a table, and you allow users or applications to perform DML operations on the table, then Oracle recommends that all DML changes satisfy the subset condition. If you allow local changes to the table, then the apply process cannot ensure that all rows in the table meet the subset condition. For example, suppose the condition is <code dir="ltr">department_id</code> <code dir="ltr">=</code> <code dir="ltr">50</code> for the <code dir="ltr">hr.employees</code> table. If a user or an application inserts a row for an employee whose <code dir="ltr">department_id</code> is <code dir="ltr">30</code>, then this row remains in the table and is not removed by the apply process. Similarly, if a user or an application updates a row locally and changes the <code dir="ltr">department_id</code> to <code dir="ltr">30</code>, then this row also remains in the table.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1013864"></a>
<div id="STRMS218" class="sect2">
<h3 class="sect2">Message Rules</h3>
<p>When you use a <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> to specify an Oracle Streams task that is relevant only for a <a href="strms_glossary.htm#CHDDIHEC"><span class="xrefglossterm">user message</span></a> of a specific, non-LCR <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> type, you are specifying a <span class="bold">message rule</span>. You can specify message rules for <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a>s, <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>es, and <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a>s.</p>
<p>A single message rule in the <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> for a propagation means that the propagation propagates the user messages of the message type in the <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> that satisfy the <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a>. A single message rule in the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> for a propagation means that the propagation discards the user messages of the message type in the source queue that satisfy the rule condition.</p>
<p>A single message rule in the positive rule set for an apply process means that the apply process dequeues user messages of the message type that satisfy the rule condition. The apply process then sends these user messages to its <a href="strms_glossary.htm#CHDDHDEH"><span class="xrefglossterm">message handler</span></a>. A single message rule in the negative rule set for an apply process means that the apply process discards user messages of the message type in its <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> that satisfy the rule condition.</p>
<p>A single message rule in the positive rule set for a messaging client means that a user or an application can use the messaging client to dequeue user messages of the message type that satisfy the rule condition. A single message rule in the negative rule set for a messaging client means that the messaging client discards user messages of the message type in its queue that satisfy the rule condition. Unlike propagations and apply processes, which propagate or apply messages automatically when they are running, a messaging client does not automatically dequeue or discard messages. Instead, a messaging client must be invoked by a user or application to dequeue or discard messages.</p>
<a id="i1016439"></a>
<div id="STRMS435" class="sect3">
<h4 class="sect3">Message Rule Example</h4>
<p>Suppose you use the <code dir="ltr">ADD_MESSAGE_RULE</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to instruct an <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> to behave in the following ways:</p>
<ul>
<li>
<p><a href="#i1014237">Dequeue User Messages If region Is EUROPE and priority Is 1</a></p>
</li>
<li>
<p><a href="#i1017568">Send User Messages to a Message Handler If region Is AMERICAS and priority Is 2</a></p>
</li>
</ul>
<p>The first instruction in the previous list pertains to a messaging client, while the second instruction pertains to an apply process.</p>
<p>The rules created in these examples are for messages of the following type:</p>
<pre dir="ltr">CREATE TYPE strmadmin.region_pri_msg AS OBJECT(
  region         VARCHAR2(100),
  priority       NUMBER,
  message        VARCHAR2(3000))
/
</pre>
<a id="i1014237"></a>
<div id="STRMS436" class="sect4">
<h5 class="sect4">Dequeue User Messages If region Is EUROPE and priority Is 1</h5>
<p>Run the <code dir="ltr">ADD_MESSAGE_RULE</code> procedure to create a rule for messages of <code dir="ltr">region_pri_msg</code> type:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_MESSAGE_RULE (
    message_type    =&gt;  &#39;strmadmin.region_pri_msg&#39;,
    rule_condition  =&gt;  &#39;:msg.region = &#39;&#39;EUROPE&#39;&#39; AND  &#39; ||
                        &#39;:msg.priority = &#39;&#39;1&#39;&#39; &#39;,
    streams_type    =&gt;  &#39;dequeue&#39;,
    streams_name    =&gt;  &#39;msg_client&#39;,
    queue_name      =&gt;  &#39;streams_queue&#39;,
    inclusion_rule  =&gt;  TRUE);
END;
/
</pre>
<p>Notice that <code dir="ltr">dequeue</code> is specified for the <code dir="ltr">streams_type</code> parameter. Therefore, this procedure creates a messaging client named <code dir="ltr">msg_client</code> if it does not already exist. If this messaging client already exists, then this procedure adds the message rule to its rule set. Also, notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that the <a href="strms_glossary.htm#CHDIJACJ"><span class="xrefglossterm">system-created rule</span></a> is added to the positive rule set for the messaging client. The user who runs this procedure is granted the privileges to dequeue from the queue using the messaging client.</p>
<p>The <code dir="ltr">ADD_MESSAGE_RULE</code> procedure creates a rule with a rule condition similar to the following:</p>
<pre dir="ltr">:&#34;VAR$_52&#34;.region = &#39;EUROPE&#39; AND  :&#34;VAR$_52&#34;.priority = &#39;1&#39;
</pre>
<p>The variables in the rule condition that begin with <code dir="ltr">VAR$</code> are variables that are specified in the system-generated <a href="strms_glossary.htm#CHDDECEH"><span class="xrefglossterm">evaluation context</span></a> for the rule.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_adrules.htm#i1006719">&#34;Evaluation Contexts Used in Oracle Streams&#34;</a></div>
</div>
<!-- class="sect4" -->
<a id="i1017568"></a>
<div id="STRMS437" class="sect4">
<h5 class="sect4">Send User Messages to a Message Handler If region Is AMERICAS and priority Is 2</h5>
<p>Run the <code dir="ltr">ADD_MESSAGE_RULE</code> procedure to create a rule for messages of <code dir="ltr">region_pri_msg</code> type:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_MESSAGE_RULE (
    message_type    =&gt;  &#39;strmadmin.region_pri_msg&#39;,
    rule_condition  =&gt;  &#39;:msg.region = &#39;&#39;AMERICAS&#39;&#39; AND  &#39; ||
                        &#39;:msg.priority = &#39;&#39;2&#39;&#39; &#39;,
    streams_type    =&gt;  &#39;apply&#39;,
    streams_name    =&gt;  &#39;apply_msg&#39;,
    queue_name      =&gt;  &#39;streams_queue&#39;,
    inclusion_rule  =&gt;  TRUE);
END;
/
</pre>
<p>Notice that <code dir="ltr">apply</code> is specified for the <code dir="ltr">streams_type</code> parameter. Therefore, this procedure creates an apply process named <code dir="ltr">apply_msg</code> if it does not already exist. If this apply process already exists, then this procedure adds the message rule to its rule set. Also, notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that the system-created rule is added to the positive rule set for the messaging client.</p>
<p>The <code dir="ltr">ADD_MESSAGE_RULE</code> procedure creates a rule with a rule condition similar to the following:</p>
<pre dir="ltr">:&#34;VAR$_56&#34;.region = &#39;AMERICAS&#39; AND  :&#34;VAR$_56&#34;.priority = &#39;2&#39;
</pre>
<p>The variables in the rule condition that begin with <code dir="ltr">VAR$</code> are variables that are specified in the system-generated evaluation context for the rule.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_adrules.htm#i1006719">&#34;Evaluation Contexts Used in Oracle Streams&#34;</a></div>
</div>
<!-- class="sect4" -->
<div id="STRMS438" class="sect4"><a id="sthref321"></a>
<h5 class="sect4">Summary of Rules</h5>
<p>In this example, the following message rules were defined:</p>
<ul>
<li>
<p>A message rule for a messaging client named <code dir="ltr">msg_client</code> that evaluates to <code dir="ltr">TRUE</code> if a message has <code dir="ltr">EUROPE</code> for its region and <code dir="ltr">1</code> for its priority. Given this rule, a user or application can use the messaging client to dequeue messages of <code dir="ltr">region_pri_msg</code> type that satisfy the rule condition.</p>
</li>
<li>
<p>A message rule for an apply process named <code dir="ltr">apply_msg</code> that evaluates to <code dir="ltr">TRUE</code> if a message has <code dir="ltr">AMERICAS</code> for its region and <code dir="ltr">2</code> for its priority. Given this rule, the apply process dequeues messages of <code dir="ltr">region_pri_msg</code> type that satisfy the rule condition and sends these messages to its message handler or reenqueues the messages into a specified queue.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_apply.htm#i1007980">&#34;Message Handlers&#34;</a></p>
</li>
<li>
<p><a href="strms_adrules.htm#i1010177">&#34;Enqueue Destinations for Messages During Apply&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1011897"></a>
<div id="STRMS439" class="sect2">
<h3 class="sect2">System-Created Rules and Negative Rule Sets</h3>
<p>You add system-created <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s to a <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a> to specify that you do not want an <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a> to perform its task for changes that satisfy these rules. Specifically, a <a href="strms_glossary.htm#CHDIJACJ"><span class="xrefglossterm">system-created rule</span></a> in a negative rule set means the following for each type of Oracle Streams client:</p>
<ul>
<li>
<p>A <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> discards changes that satisfy the rule.</p>
</li>
<li>
<p>A <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> discards <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a>s in its <a href="strms_glossary.htm#CHDCGACA"><span class="xrefglossterm">source queue</span></a> that satisfy the rule.</p>
</li>
<li>
<p>An <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> discards messages in its <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> that satisfy the rule.</p>
</li>
<li>
<p>A <a href="strms_glossary.htm#CHDDGHHB"><span class="xrefglossterm">messaging client</span></a> discards messages in its queue that satisfy the rule.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
A <a href="strms_glossary.htm#CBACHEDJ"><span class="xrefglossterm">synchronous capture</span></a> cannot have a negative rule set.</div>
<p>If an Oracle Streams client does not have a negative rule set, then you can create a negative rule set and add rules to it by running one of the following procedures and setting the <code dir="ltr">inclusion_rule</code> parameter to <code dir="ltr">FALSE</code>:</p>
<ul>
<li>
<p><a class="olink ARPLS308" href="../ARPLS/d_streams_adm.htm#ARPLS308"><code dir="ltr">DBMS_STREAMS_ADM.ADD_TABLE_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS309" href="../ARPLS/d_streams_adm.htm#ARPLS309"><code dir="ltr">DBMS_STREAMS_ADM.ADD_SCHEMA_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS310" href="../ARPLS/d_streams_adm.htm#ARPLS310"><code dir="ltr">DBMS_STREAMS_ADM.ADD_GLOBAL_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS521" href="../ARPLS/d_streams_adm.htm#ARPLS521"><code dir="ltr">DBMS_STREAMS_ADM.ADD_MESSAGE_RULE</code></a></p>
</li>
<li>
<p><a class="olink ARPLS316" href="../ARPLS/d_streams_adm.htm#ARPLS316"><code dir="ltr">DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS317" href="../ARPLS/d_streams_adm.htm#ARPLS317"><code dir="ltr">DBMS_STREAMS_ADM.ADD_SCHEMA_PROPAGATION_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS318" href="../ARPLS/d_streams_adm.htm#ARPLS318"><code dir="ltr">DBMS_STREAMS_ADM.ADD_GLOBAL_PROPAGATION_RULES</code></a></p>
</li>
<li>
<p><a class="olink ARPLS520" href="../ARPLS/d_streams_adm.htm#ARPLS520"><code dir="ltr">DBMS_STREAMS_ADM.ADD_MESSAGE_PROPAGATION_RULE</code></a></p>
</li>
</ul>
<p>If a negative rule set already exists for the Oracle Streams client when you run one of these procedures, then the procedure adds the system-created rules to the existing negative rule set.</p>
<p>Alternatively, you can create a negative rule set when you create an Oracle Streams client by running one of the following procedures and specifying a non-<code dir="ltr">NULL</code> value for the <code dir="ltr">negative_rule_set_name</code> parameter:</p>
<ul>
<li>
<p><a class="olink ARPLS311" href="../ARPLS/d_cap_a.htm#ARPLS311"><code dir="ltr">DBMS_CAPTURE_ADM.CREATE_CAPTURE</code></a></p>
</li>
<li>
<p><a class="olink ARPLS333" href="../ARPLS/d_prop_a.htm#ARPLS333"><code dir="ltr">DBMS_PROPAGATION_ADM.CREATE_PROPAGATION</code></a></p>
</li>
<li>
<p><a class="olink ARPLS313" href="../ARPLS/d_apply.htm#ARPLS313"><code dir="ltr">DBMS_APPLY_ADM.CREATE_APPLY</code></a></p>
</li>
</ul>
<p>Also, you can specify a negative rule set for an existing Oracle Streams client by altering the client. For example, to specify a negative rule set for an existing capture process, use the <code dir="ltr">DBMS_CAPTURE_ADM.ALTER_CAPTURE</code> procedure. After an Oracle Streams client has a negative rule set, you can use the procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package listed previously to add system-created rules to it.</p>
<p>Instead of adding rules to a negative rule set, you can also exclude changes to certain tables or schemas in the following ways:</p>
<ul>
<li>
<p>Do not add system-created rules for the table or schema to a <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> for an Oracle Streams client. For example, to capture DML changes to all of the tables in a particular schema except for one table, add a DML <a href="strms_glossary.htm#CHDEGGGH"><span class="xrefglossterm">table rule</span></a> for each table in the schema, except for the excluded table, to the positive rule set for the capture process. The disadvantages of this approach are that there can be many tables in a schema and each one requires a separate DML rule, and, if a new table is added to the schema, and you want to capture changes to this new table, then a new DML rule must be added for this table to the positive rule set for the capture process.</p>
</li>
<li>
<p>Use the <code dir="ltr">NOT</code> logical condition in the <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a> of a complex rule in the positive rule set for an Oracle Streams client. For example, to capture DML changes to all of the tables in a particular schema except for one table, use the <code dir="ltr">DBMS_STREAMS_ADM.ADD_SCHEMA_RULES</code> procedure to add a system-created DML <a href="strms_glossary.htm#CHDFAGCF"><span class="xrefglossterm">schema rule</span></a> to the positive rule set for the capture process that instructs the capture process to capture changes to the schema, and use the <code dir="ltr">and_condition</code> parameter to exclude the table with the <code dir="ltr">NOT</code> logical condition. The disadvantages to this approach are that it involves manually specifying parts of rule conditions, which can be error prone, and rule evaluation is not as efficient for complex rules as it is for unmodified system-created rules.</p>
</li>
</ul>
<p>Given the goal of capturing DML changes to all of the tables in a particular schema except for one table, you can add a DML schema rule to the positive rule set for the capture process and a DML table rule for the excluded table to the negative rule set for the capture process.</p>
<p>This approach has the following advantages over the alternatives described previously:</p>
<ul>
<li>
<p>You add only two rules to achieve the goal.</p>
</li>
<li>
<p>If a new table is added to the schema, and you want to capture DML changes to the table, then the capture process captures these changes without requiring modifications to existing rules or additions of new rules.</p>
</li>
<li>
<p>You do not need to specify or edit rule conditions manually.</p>
</li>
<li>
<p>Rule evaluation is more efficient because you avoid using complex rules.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_adrules.htm#i1017158">&#34;Complex Rule Conditions&#34;</a></p>
</li>
<li>
<p><a href="#i1019153">&#34;System-Created Rules with Added User-Defined Conditions&#34;</a></p>
</li>
</ul>
</div>
<div id="STRMS440" class="sect3"><a id="sthref322"></a>
<h4 class="sect3">Negative Rule Set Example</h4>
<p>Suppose you want to apply row LCRs that contain the results of DML changes to all of the tables in <code dir="ltr">hr</code> schema except for the <code dir="ltr">job_history</code> table. To do so, you can use the <code dir="ltr">ADD_SCHEMA_RULES</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to instruct an Oracle Streams apply process to apply row LCRs that contain the results of DML changes to the tables in the <code dir="ltr">hr</code> schema. In this case, the procedure creates a schema rule and adds the rule to the positive rule set for the apply process.</p>
<p>You can use the <code dir="ltr">ADD_TABLE_RULES</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to instruct the Oracle Streams apply process to discard row LCRs that contain the results of DML changes to the tables in the <code dir="ltr">hr.job_history</code> table. In this case, the procedure creates a table rule and adds the rule to the negative rule set for the apply process.</p>
<p>The following sections explain how to run these procedures:</p>
<ul>
<li>
<p><a href="#i1012256">Apply All DML Changes to the Tables in the hr Schema</a></p>
</li>
<li>
<p><a href="#i1012101">Discard Row LCRs Containing DML Changes to the hr.job_history Table</a></p>
</li>
</ul>
<a id="i1012256"></a>
<div id="STRMS441" class="sect4">
<h5 class="sect4">Apply All DML Changes to the Tables in the hr Schema</h5>
<p>These changes originated at the <code dir="ltr">dbs1.example.com</code> <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a>.</p>
<p>Run the <code dir="ltr">ADD_SCHEMA_RULES</code> procedure to create this rule:</p>
<pre dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_SCHEMA_RULES(
    schema_name         =&gt;  &#39;hr&#39;,   
    streams_type        =&gt;  &#39;apply&#39;,
    streams_name        =&gt;  &#39;apply&#39;,
    queue_name          =&gt;  &#39;streams_queue&#39;,
    include_dml         =&gt;  TRUE,
    include_ddl         =&gt;  FALSE,
    include_tagged_lcr  =&gt;  FALSE,
    source_database     =&gt;  &#39;dbs1.example.com&#39;,
    inclusion_rule      =&gt;  TRUE);
END;
/
</pre>
<p>Notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that the system-created rule is added to the positive rule set for the apply process.</p>
<p>The <code dir="ltr">ADD_SCHEMA_RULES</code> procedure creates a rule with a rule condition similar to the following:</p>
<pre dir="ltr">((:dml.get_object_owner() = &#39;HR&#39;) and :dml.is_null_tag() = &#39;Y&#39; 
and :dml.get_source_database_name() = &#39;DBS1.EXAMPLE.COM&#39; )
</pre></div>
<!-- class="sect4" -->
<a id="i1012101"></a>
<div id="STRMS442" class="sect4">
<h5 class="sect4">Discard Row LCRs Containing DML Changes to the hr.job_history Table</h5>
<p>These changes originated at the <code dir="ltr">dbs1.example.com</code> source database.</p>
<p>Run the <code dir="ltr">ADD_TABLE_RULES</code> procedure to create this rule:</p>
<pre dir="ltr">BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name          =&gt;  &#39;hr.job_history&#39;,
    streams_type        =&gt;  &#39;apply&#39;,
    streams_name        =&gt;  &#39;apply&#39;,
    queue_name          =&gt;  &#39;streams_queue&#39;,
    include_dml         =&gt;  TRUE,
    include_ddl         =&gt;  FALSE,
    include_tagged_lcr  =&gt;  TRUE,
    source_database     =&gt;  &#39;dbs1.example.com&#39;,
    inclusion_rule      =&gt;  FALSE);
END;
/
</pre>
<p>Notice that the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">FALSE</code>. This setting means that the system-created rule is added to the negative rule set for the apply process.</p>
<p>Also notice that the <code dir="ltr">include_tagged_lcr</code> parameter is set to <code dir="ltr">TRUE</code>. This setting means that all changes for the table, including tagged LCRs that satisfy all of the other rule conditions, will be discarded. In most cases, specify <code dir="ltr">TRUE</code> for the <code dir="ltr">include_tagged_lcr</code> parameter if the <code dir="ltr">inclusion_rule</code> parameter is set to <code dir="ltr">FALSE</code>.</p>
<p><a id="sthref323"></a><a id="sthref324"></a>The <code dir="ltr">ADD_TABLE_RULES</code> procedure creates a rule with a rule condition similar to the following:</p>
<pre dir="ltr">(((:dml.get_object_owner() = &#39;HR&#39; and :dml.get_object_name() = &#39;JOB_HISTORY&#39;)) 
and :dml.get_source_database_name() = &#39;DBS1.EXAMPLE.COM&#39; )
</pre></div>
<!-- class="sect4" -->
<div id="STRMS443" class="sect4"><a id="sthref325"></a>
<h5 class="sect4">Summary of Rules</h5>
<p>In this example, the following rules were defined:</p>
<ul>
<li>
<p>A schema rule that evaluates to <code dir="ltr">TRUE</code> if a DML operation is performed on the tables in the <code dir="ltr">hr</code> schema. This rule is in the positive rule set for the apply process.</p>
</li>
<li>
<p>A table rule that evaluates to <code dir="ltr">TRUE</code> if a DML operation is performed on the <code dir="ltr">hr.job_history</code> table. This rule is in the negative rule set for the apply process.</p>
</li>
</ul>
<p>Given these rules, the following list provides examples of changes applied by the apply process:</p>
<ul>
<li>
<p>A row is inserted into the <code dir="ltr">hr.departments</code> table.</p>
</li>
<li>
<p>Five rows are updated in the <code dir="ltr">hr.employees</code> table.</p>
</li>
<li>
<p>A row is deleted from the <code dir="ltr">hr.countries</code> table.</p>
</li>
</ul>
<p>The apply process dequeues these changes from its associated queue and applies them to the database objects at the destination database.</p>
<p>Given these rules, the following list provides examples of changes that are ignored by the apply process:</p>
<ul>
<li>
<p>A row is inserted into the <code dir="ltr">hr.job_history</code> table.</p>
</li>
<li>
<p>A row is updated in the <code dir="ltr">hr.job_history</code> table.</p>
</li>
<li>
<p>A row is deleted from the <code dir="ltr">hr.job_history</code> table.</p>
</li>
</ul>
<p>These changes are not applied because they satisfy a rule in the negative rule set for the apply process.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i1010575">&#34;Rule Sets and Rule Evaluation of Messages&#34;</a></div>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1019153"></a>
<div id="STRMS139" class="sect2">
<h3 class="sect2">System-Created Rules with Added User-Defined Conditions<a id="sthref326"></a></h3>
<p>Some of the procedures that create <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a>s in the <code dir="ltr">DBMS_STREAMS_ADM</code> package include an <code dir="ltr">and_condition</code> parameter. This parameter enables you to add conditions to <a href="strms_glossary.htm#CHDIJACJ"><span class="xrefglossterm">system-created rule</span></a>s. The condition specified by the <code dir="ltr">and_condition</code> parameter is appended to the system-created <a href="strms_glossary.htm#CHDGDCFJ"><span class="xrefglossterm">rule condition</span></a> using an <code dir="ltr">AND</code> clause in the following way:</p>
<pre dir="ltr">(<span class="italic">system_condition</span>) AND (<span class="italic">and_condition</span>)
</pre>
<p>The variable in the specified condition must be <code dir="ltr">:lcr</code>. For example, to specify that the <a href="strms_glossary.htm#CHDEGGGH"><span class="xrefglossterm">table rule</span></a>s generated by the <code dir="ltr">ADD_TABLE_RULES</code> procedure evaluate to <code dir="ltr">TRUE</code> only if the table is <code dir="ltr">hr.departments</code>, the <a href="strms_glossary.htm#CHDHFBJG"><span class="xrefglossterm">source database</span></a> is <code dir="ltr">dbs1.example.com</code>, and the Oracle Streams <a href="strms_glossary.htm#CHDBJJHH"><span class="xrefglossterm">tag</span></a> is the hexadecimal equivalent of <code dir="ltr">&#39;02&#39;</code>, run the following procedure:</p>
<pre dir="ltr">BEGIN 
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name          =&gt;  &#39;hr.departments&#39;,
    streams_type        =&gt;  &#39;apply&#39;,
    streams_name        =&gt;  &#39;apply_02&#39;,
    queue_name          =&gt;  &#39;streams_queue&#39;,
    include_dml         =&gt;  TRUE,
    include_ddl         =&gt;  TRUE,
    include_tagged_lcr  =&gt;  TRUE,
    source_database     =&gt;  &#39;dbs1.example.com&#39;,
    inclusion_rule      =&gt;  TRUE,
    and_condition       =&gt;  &#39;:lcr.get_tag() = HEXTORAW(&#39;&#39;02&#39;&#39;)&#39;);
END;
/
</pre>
<p>The <code dir="ltr">ADD_TABLE_RULES</code> procedure creates a DML rule with the following condition:</p>
<pre dir="ltr">(((((:dml.get_object_owner() = &#39;HR&#39; and :dml.get_object_name() = &#39;DEPARTMENTS&#39;))
 and :dml.get_source_database_name() = &#39;DBS1.EXAMPLE.COM&#39; )) 
and (:dml.get_tag() = HEXTORAW(&#39;02&#39;)))
</pre>
<p>It creates a DDL rule with the following condition:</p>
<pre dir="ltr">(((((:ddl.get_object_owner() = &#39;HR&#39; and :ddl.get_object_name() = &#39;DEPARTMENTS&#39;)
or (:ddl.get_base_table_owner() = &#39;HR&#39; 
and :ddl.get_base_table_name() = &#39;DEPARTMENTS&#39;)) 
and :ddl.get_source_database_name() = &#39;DBS1.EXAMPLE.COM&#39; )) 
and (:ddl.get_tag() = HEXTORAW(&#39;02&#39;)))
</pre>
<p>Notice that the <code dir="ltr">:lcr</code> in the specified condition is converted to <code dir="ltr">:dml</code> or <code dir="ltr">:ddl</code>, depending on the rule that is being generated. If you are specifying an LCR member subprogram that is dependent on the LCR type (row or DDL), then ensure that this procedure only generates the appropriate rule. Specifically, if you specify an LCR member subprogram that is valid only for row LCRs, then specify <code dir="ltr">TRUE</code> for the <code dir="ltr">include_dml</code> parameter and <code dir="ltr">FALSE</code> for the <code dir="ltr">include_ddl</code> parameter. If you specify an LCR member subprogram that is valid only for DDL LCRs, then specify <code dir="ltr">FALSE</code> for the <code dir="ltr">include_dml</code> parameter and <code dir="ltr">TRUE</code> for the <code dir="ltr">include_ddl</code> parameter.</p>
<p>For example, the <code dir="ltr">GET_OBJECT_TYPE</code> member function only applies to DDL LCRs. Therefore, if you use this member function in an <code dir="ltr">and_condition</code>, then specify <code dir="ltr">FALSE</code> for the <code dir="ltr">include_dml</code> parameter and <code dir="ltr">TRUE</code> for the <code dir="ltr">include_ddl</code> parameter.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ARPLS307" href="../ARPLS/t_lcr.htm#ARPLS307"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about LCR member subprograms</p>
</li>
<li>
<p><a class="olink STREP008" href="../STREP/rep_tags.htm#STREP008"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about Oracle Streams tags</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="strms_apply.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="strms_transform.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>