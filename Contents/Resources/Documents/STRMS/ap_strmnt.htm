<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104374"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Online%20Database%20Upgrade%20and%20Maintenance%20with%20Oracle%20Streams"></a><title>Online Database Upgrade and Maintenance with Oracle Streams</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:8Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="ap_xmlschema.htm" title="Previous" type="text/html"/>
<link rel="Next" href="ap_strup.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">54/57</span> <!-- End Header -->
<div id="STRMS165" class="appendix"><a id="CIHEHEEA"></a> <a id="CIHJBIAA"></a>
<h1 class="appendix"><span class="secnum">D</span> Online Database Upgrade and Maintenance with Oracle Streams</h1>
<p><a id="sthref1587"></a><a id="sthref1588"></a>This appendix describes how to use Oracle Streams to perform a database upgrade to the current release of Oracle Database from one of the following releases:</p>
<ul>
<li>
<p>Oracle Database 10<span class="italic">g</span> Release 2 (10.2)</p>
</li>
<li>
<p>Oracle Database 11<span class="italic">g</span> Release 1 (11.1)</p>
</li>
</ul>
<p><a id="sthref1589"></a><a id="sthref1590"></a>This appendix also describes how to perform some maintenance operations with Oracle Streams on an Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later database. These maintenance operations include migrating an Oracle database to a different platform or character set, upgrading user-created applications, and applying Oracle Database patches or patch sets.</p>
<p>The upgrade and maintenance operations described in this appendix use the features of Oracle Streams to achieve little or no database down time.</p>
<p>The following topics describe performing online database maintenance with Oracle Streams:</p>
<ul>
<li>
<p><a href="#CIHJDHJC">Overview of Using Oracle Streams for Upgrade and Maintenance Operations</a></p>
</li>
<li>
<p><a href="#CIHIDHBI">Preparing for a Database Upgrade or Maintenance Operation</a></p>
</li>
<li>
<p><a href="#i637663">Performing a Database Upgrade or Maintenance Operation Using Oracle Streams</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="ap_strup.htm#g654383">Appendix E, &#34;Online Upgrade of an Earlier Database with Oracle Streams&#34;</a> for instructions on performing an upgrade of a release before Oracle Database 10<span class="italic">g</span> Release 2 (10.2)</div>
<a id="CIHJDHJC"></a>
<div id="STRMS1254" class="sect1">
<h2 class="sect1">Overview of Using Oracle Streams for Upgrade and Maintenance Operations</h2>
<p>Database upgrades can require substantial database down time. The following maintenance operations also typically require substantial database down time:</p>
<ul>
<li>
<p>Migrating a database to a different platform</p>
</li>
<li>
<p>Migrating a database to a different character set</p>
</li>
<li>
<p>Modifying database schema objects to support upgrades to user-created applications</p>
</li>
<li>
<p>Applying an Oracle Database software patch or patch set</p>
</li>
</ul>
<p>You can achieve these upgrade and maintenance operations with little or no down time by using the features of Oracle Streams. To do so, you use Oracle Streams to configure a <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment with the following databases:</p>
<ul>
<li>
<p><span class="bold">Source Database:</span> The original database that is being maintained.</p>
</li>
<li>
<p><span class="bold">Capture Database:</span> The database where a <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> captures changes made to the source database during the maintenance operation.</p>
</li>
<li>
<p><span class="bold">Destination Database:</span> The copy of the source database where an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> applies changes made to the source database during the maintenance operation.</p>
</li>
</ul>
<p>Specifically, you can use the following general steps to perform the upgrade or maintenance operation while the database is online:</p>
<ol>
<li>
<p>Create an empty <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>.</p>
</li>
<li>
<p>Configure an Oracle Streams replication environment where the original database is the source database and a copy of the database is the destination database. The <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> and <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package configure the Oracle Streams replication environment.</p>
</li>
<li>
<p>Perform the upgrade or maintenance operation on the destination database. During this time the original source database is available online, and changes to the original source database are being captured by a capture process.</p>
</li>
<li>
<p>Use Oracle Streams to apply the changes made to the source database at the destination database.</p>
</li>
<li>
<p>When the destination database has caught up with the changes made at the source database, take the source database offline and make the destination database available for applications and users.</p>
</li>
</ol>
<p><a href="#CIHGJCAB">Figure D-1</a> provides an overview of this process.</p>
<div id="STRMS1255" class="figure">
<p class="titleinfigure"><a id="CIHGJCAB"></a>Figure D-1 Online Database Upgrade and Maintenance with Oracle Streams</p>
<img width="521" height="656" src="img/strms052.gif" alt="Description of Figure D-1 follows"/><br/>
<a id="sthref1591" href="img_text/strms052.htm">Description of &#34;Figure D-1 Online Database Upgrade and Maintenance with Oracle Streams&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<a id="DAFBFBDF"></a>
<div id="STRMS1256" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">The Capture Database During the Upgrade or Maintenance Operation<a id="sthref1592"></a></h3>
<p>During the upgrade or maintenance operation, the capture database is the database where the <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> is created. A <a href="strms_glossary.htm#CHDDGCGH"><span class="xrefglossterm">local capture process</span></a> can be created at the source database during the maintenance operation, or a <a href="strms_glossary.htm#CHDHEBHD"><span class="xrefglossterm">downstream capture process</span></a> can be created at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> or at a third database. If the destination database is the capture database, then a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> from the capture database to the destination database is not needed. A downstream capture process reduces the resources required at the source database during the maintenance operation.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>Before you begin the database upgrade or maintenance operation with Oracle Streams, decide which database will be the capture database.</p>
</li>
<li>
<p>If the RMAN <code dir="ltr">DUPLICATE</code> or <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command is used for database <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a>, then the destination database cannot be the capture database.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_capture.htm#i1013269">&#34;Local Capture and Downstream Capture&#34;</a></p>
</li>
<li>
<p><a href="#CIHCBADI">&#34;Deciding Which Utility to Use for Instantiation&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<div id="STRMS1257" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1593"></a>
<h3 class="sect2">Assumptions for the Database Being Upgraded or Maintained<a id="sthref1594"></a></h3>
<p>The instructions in this appendix assume that all of the following statements are true for the database being upgraded or maintained:</p>
<ul>
<li>
<p>The database is not part of an existing Oracle Streams environment.</p>
</li>
<li>
<p>The database is not part of an existing logical standby environment.</p>
</li>
<li>
<p>The database is not part of an existing Advanced Replication environment.</p>
</li>
<li>
<p>No tables at the database are master tables for materialized views in other databases.</p>
</li>
<li>
<p>No messages are enqueued into user-created <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a>s during the upgrade or maintenance operation.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CIHDAGED"></a>
<div id="STRMS1258" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Considerations for Job Slaves and PL/SQL Package Subprograms<a id="sthref1595"></a><a id="sthref1596"></a></h3>
<p>If possible, ensure that no job slaves are created, modified, or deleted during the upgrade or maintenance operation, and that no Oracle-supplied PL/SQL package subprograms are invoked during the operation that modify both user data and data dictionary metadata at the same time. The following packages contain subprograms that modify both user data and data dictionary metadata at the same time: <code dir="ltr">DBMS_RLS</code>, <code dir="ltr">DBMS_STATS</code>, and <code dir="ltr">DBMS_JOB</code>.</p>
<p>It might be possible to perform such actions on the database if you ensure that the same actions are performed on the source database and <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> in Steps <a href="#CIHDIHDD">19</a> and <a href="#CIHFJJJJ">20</a> in <a href="#i637663">&#34;Performing a Database Upgrade or Maintenance Operation Using Oracle Streams&#34;</a>. For example, if a PL/SQL procedure gathers statistics on the source database during the maintenance operation, then the same PL/SQL procedure should be invoked at the destination database in Step <a href="#CIHFJJJJ">20</a>.</p>
</div>
<!-- class="sect2" -->
<div id="STRMS1259" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref1597"></a>
<h3 class="sect2">Unsupported Database Objects Are Excluded</h3>
<p>The <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> and <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package include the following parameters:</p>
<ul>
<li>
<p><code dir="ltr">exclude_schemas</code></p>
</li>
<li>
<p><code dir="ltr">exclude_flags</code></p>
</li>
</ul>
<p>These parameters specify which database objects to exclude from the Oracle Streams configuration. The examples in this appendix set these parameters to the following values:</p>
<pre dir="ltr">exclude_schemas =&gt; &#39;*&#39;,
exclude_flags   =&gt; DBMS_STREAMS_ADM.EXCLUDE_FLAGS_UNSUPPORTED + 
                   DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DML + 
                   DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DDL);
</pre>
<p>These values exclude any database objects that are not supported by Oracle Streams. The asterisk (<code dir="ltr">*</code>) specified for <code dir="ltr">exclude_schemas</code> indicates that some database objects in every schema in the database might be excluded from the <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment. The value specified for the <code dir="ltr">exclude_flags</code> parameter indicates that DML and DDL changes for all unsupported database objects are excluded from the replication environment. Rules are placed in the <a href="strms_glossary.htm#CHDBHJHI"><span class="xrefglossterm">negative rule set</span></a>s for the <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es to exclude these database objects.</p>
<p>To list unsupported database objects, query the <code dir="ltr">DBA_STREAMS_UNSUPPORTED</code> data dictionary view at the source database. If you use these parameter settings, then changes to the database objects listed in this view are not maintained by Oracle Streams during the maintenance operation. Therefore, Step <a href="#CIHFIJHG">7</a> in <a href="#i638439">&#34;Task 1: Beginning the Operation&#34;</a> instructs you to ensure that no changes are made to these database objects during the database upgrade or maintenance operation.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<a href="#CIHJDACF">&#34;Preparing for Upgrade or Maintenance of a Database with User-Defined Types&#34;</a> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then tables that contain user-defined types can remain open during the maintenance operation.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">exclude_schemas</code> and <code dir="ltr">exclude_flags</code> parameters</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIHIDHBI"></a>
<div id="STRMS1260" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Preparing for a Database Upgrade or Maintenance Operation</h2>
<p>The following sections describe tasks to complete before starting the database upgrade or maintenance operation with Oracle Streams:</p>
<ul>
<li>
<p><a href="#CIHBBHID">Preparing for Downstream Capture</a></p>
</li>
<li>
<p><a href="#CIHJDACF">Preparing for Upgrade or Maintenance of a Database with User-Defined Types</a></p>
</li>
<li>
<p><a href="#CIHCIDAJ">Preparing for Upgrades to User-Created Applications</a></p>
</li>
<li>
<p><a href="#CIHGICAA">Deciding Whether to Configure Oracle Streams Directly or Generate a Script</a></p>
</li>
<li>
<p><a href="#CIHCBADI">Deciding Which Utility to Use for Instantiation</a></p>
</li>
</ul>
<a id="CIHBBHID"></a>
<div id="STRMS1261" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Preparing for Downstream Capture</h3>
<p>If you decided that the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> or a third database will be the capture database, then you must prepare for downstream capture by configuring log file copying from the source database to the capture database. If you decided that the source database will be the capture database, then log file copying is not required. See <a href="#DAFBFBDF">&#34;The Capture Database During the Upgrade or Maintenance Operation&#34;</a> for information about the decision.</p>
<p>Complete the following steps to prepare the source database to copy its redo log files to the capture database, and to prepare the capture database to accept these redo log files:</p>
<ol>
<li>
<p>Configure Oracle Net so that the source database can communicate with the capture database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a></div>
</li>
<li>
<p>Configure authentication at both databases to support the transfer of redo data.</p>
<p>Redo transport sessions are authenticated using either the Secure Sockets Layer (SSL) protocol or a remote login password file. If the source database has a remote login password file, then copy it to the appropriate directory on the downstream capture database system. The password file must be the same at the source database and the downstream capture database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB00424" href="../SBYDB/create_ps.htm#SBYDB00424"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for detailed information about authentication requirements for redo transport</div>
</li>
<li id="CIHEEABD">
<p>At the source database, set the following initialization parameters to configure redo transport services to transmit redo data from the source database to the downstream database:</p>
<ul>
<li>
<p><code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> - Configure at least one <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> initialization parameter to transmit redo data to the downstream database. To do this, set the following attributes of this parameter:</p>
<ul>
<li>
<p><code dir="ltr">SERVICE</code> - Specify the network service name of the downstream database.</p>
</li>
<li>
<p><code dir="ltr">ASYNC</code> or <code dir="ltr">SYNC</code> - Specify a redo transport mode.</p>
<p>The advantage of specifying <code dir="ltr">ASYNC</code> is that it results in little or no effect on the performance of the source database. <code dir="ltr">ASYNC</code> is recommended to avoid affecting source database performance if the downstream database or network is performing poorly.</p>
<p>The advantage of specifying <code dir="ltr">SYNC</code> is that redo data is sent to the downstream database faster then when <code dir="ltr">ASYNC</code> is specified. Also, specifying <code dir="ltr">SYNC</code> <code dir="ltr">AFFIRM</code> results in behavior that is similar to <code dir="ltr">MAXIMUM</code> <code dir="ltr">AVAILABILITY</code> standby protection mode. Note that specifying an <code dir="ltr">ALTER</code> <code dir="ltr">DATABASE</code> <code dir="ltr">STANDBY</code> <code dir="ltr">DATABASE</code> <code dir="ltr">TO</code> <code dir="ltr">MAXIMIZE</code> <code dir="ltr">AVAILABILITY</code> SQL statement has no effect on an Oracle Streams capture process.</p>
</li>
<li>
<p><code dir="ltr">NOREGISTER</code> - Specify this attribute so that the location of the archived redo log files is not recorded in the downstream database control file.</p>
</li>
<li>
<p><code dir="ltr">VALID_FOR</code> - Specify either <code dir="ltr">(ONLINE_LOGFILE,PRIMARY_ROLE)</code> or <code dir="ltr">(ONLINE_LOGFILE,ALL_ROLES)</code>.</p>
</li>
<li>
<p><code dir="ltr">TEMPLATE</code> - Specify a directory and format template for archived redo logs at the downstream database. The <code dir="ltr">TEMPLATE</code> attribute overrides the <code dir="ltr">LOG_ARCHIVE_FORMAT</code> initialization parameter settings at the downstream database. The <code dir="ltr">TEMPLATE</code> attribute is valid only with remote destinations. Ensure that the format uses all of the following variables at each source database: <code dir="ltr">%t</code>, <code dir="ltr">%s</code>, and <code dir="ltr">%r</code>.</p>
</li>
<li>
<p><code dir="ltr">DB_UNIQUE_NAME</code> - The unique name of the downstream database. Use the name specified for the <code dir="ltr">DB_UNIQUE_NAME</code> initialization parameter at the downstream database.</p>
</li>
</ul>
<p>The following example is a <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> setting that specifies a capture database (<code dir="ltr">DBS2.EXAMPLE.COM</code>):</p>
<pre dir="ltr">LOG_ARCHIVE_DEST_2=&#39;SERVICE=DBS2.EXAMPLE.COM ASYNC NOREGISTER
   VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE)
   TEMPLATE=/usr/oracle/log_for_dbs1/dbs1_arch_%t_%s_%r.log
   DB_UNIQUE_NAME=dbs2&#39;
</pre>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
Specify a value for the <code dir="ltr">TEMPLATE</code> attribute that keeps log files from a remote source database separate from local database log files. In addition, if the downstream database contains log files from multiple source databases, then the log files from each source database should be kept separate from each other.</div>
</li>
<li>
<p><code dir="ltr">LOG_ARCHIVE_DEST_STATE_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> - Set this initialization parameter that corresponds with the <code dir="ltr">LOG_ARCHIVE_DEST_</code><code dir="ltr"><span class="codeinlineitalic">n</span></code> parameter for the downstream database to <code dir="ltr">ENABLE</code>.</p>
<p>For example, if the <code dir="ltr">LOG_ARCHIVE_DEST_2</code> initialization parameter is set for the downstream database, then set the <code dir="ltr">LOG_ARCHIVE_DEST_STATE_2</code> parameter in the following way:</p>
<pre dir="ltr">LOG_ARCHIVE_DEST_STATE_2=ENABLE 
</pre></li>
<li>
<p><code dir="ltr">LOG_ARCHIVE_CONFIG</code> - Set the <code dir="ltr">DB_CONFIG</code> attribute in this initialization parameter to include the <code dir="ltr">DB_UNIQUE_NAME</code> of the source database and the downstream database.</p>
<p>For example, if the <code dir="ltr">DB_UNIQUE_NAME</code> of the source database is <code dir="ltr">dbs1</code>, and the <code dir="ltr">DB_UNIQUE_NAME</code> of the downstream database is <code dir="ltr">dbs2</code>, then specify the following parameter:</p>
<pre dir="ltr">LOG_ARCHIVE_CONFIG=&#39;DG_CONFIG=(dbs1,dbs2)&#39;
</pre>
<p>By default, the <code dir="ltr">LOG_ARCHIVE_CONFIG</code> parameter enables a database to both send and receive redo.</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REFRN" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> and <a class="olink SBYDB01100" href="../SBYDB/log_arch_dest_param.htm#SBYDB01100"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information about these initialization parameters</div>
</li>
<li id="CIHDCDBA">
<p>At the downstream database, set the <code dir="ltr">DB_CONFIG</code> attribute in the <code dir="ltr">LOG_ARCHIVE_CONFIG</code> initialization parameter to include the <code dir="ltr">DB_UNIQUE_NAME</code> of the source database and the downstream database.</p>
<p>For example, if the <code dir="ltr">DB_UNIQUE_NAME</code> of the source database is <code dir="ltr">dbs1</code>, and the <code dir="ltr">DB_UNIQUE_NAME</code> of the downstream database is <code dir="ltr">dbs2</code>, then specify the following parameter:</p>
<pre dir="ltr">LOG_ARCHIVE_CONFIG=&#39;DG_CONFIG=(dbs1,dbs2)&#39;
</pre>
<p>By default, the <code dir="ltr">LOG_ARCHIVE_CONFIG</code> parameter enables a database to both send and receive redo.</p>
</li>
<li>
<p>If you reset any initialization parameters while the instance is running at a database in Step <a href="#CIHEEABD">3</a> or Step <a href="#CIHDCDBA">4</a>, then you might want to reset them in the initialization parameter file as well, so that the new values are retained when the database is restarted.</p>
<p>If you did not reset the initialization parameters while the instance was running, but instead reset them in the initialization parameter file in Step <a href="#CIHEEABD">3</a> or Step <a href="#CIHDCDBA">4</a>, then restart the database. The source database must be open when it sends redo log files to the capture database because the global name of the source database is sent to the capture database only if the source database is open.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CIHJDHJC">&#34;Overview of Using Oracle Streams for Upgrade and Maintenance Operations&#34;</a> for more information about the capture database</div>
</div>
<!-- class="sect2" -->
<a id="CIHJDACF"></a>
<div id="STRMS1262" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Preparing for Upgrade or Maintenance of a Database with User-Defined Types<a id="sthref1598"></a></h3>
<p>User-defined types include object types, <code dir="ltr">REF</code> values, varrays, and nested tables. Currently, Oracle Streams <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a>es and <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>es do not support user-defined types. This section discusses using Oracle Streams to perform an upgrade or maintenance operation on a database that has user-defined types.</p>
<p>One option is to ensure that no data manipulation language (DML) or data definition language (DDL) changes are made to the tables that contain user-defined types during the operation. In this case, these tables are instantiated at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>, and no changes are made to these tables during the entire operation. After the operation is complete, make the tables that contain user-defined types read/write at the destination database.</p>
<p>However, if tables that contain user-defined types must remain open during the operation, then use the following general steps to retain changes to these types during the operation:</p>
<ol>
<li id="CIHHCBAF">
<p>At the source database, create one or more logging tables to store row changes to tables that include user-defined types. Each column in the logging table must use a data type that is supported by Oracle Streams.</p>
</li>
<li>
<p>At the source database, create a DML trigger that fires on the tables that contain the user-defined data types. The trigger converts each row change into relational equivalents and logs the modified row in a logging table created in Step <a href="#CIHHCBAF">1</a>.</p>
</li>
<li>
<p>Ensure that the capture process and <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> are configured to capture and, if necessary, propagate changes made to the logging table to the destination database. Changes to tables that contain user-defined types should not be captured or propagated. Therefore, ensure that the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> and <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedures include the logging tables and exclude the tables that contain user-defined types.</p>
</li>
<li>
<p>At the destination database, configure the apply process to use a <a href="strms_glossary.htm#CHDEIDID"><span class="xrefglossterm">DML handler</span></a> that processes the changes to the logging tables. The DML handler reconstructs the user-defined types from the relational equivalents and applies the modified changes to the tables that contain user-defined types.</p>
</li>
</ol>
<p>For instructions, go to the My Oracle Support (formerly Oracle<span class="italic">MetaLink</span>) Web site using a Web browser:</p>
<pre dir="ltr"><a href="http://support.oracle.com/">http://support.oracle.com/</a>
</pre>
<p>Database bulletin 556742.1 describes additional data type support for Oracle Streams.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink LNPLS020" href="../LNPLS/overview.htm#LNPLS020"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information about creating triggers</p>
</li>
<li>
<p><a href="strms_mapply.htm#BGBJHGHG">&#34;Managing a DML Handler&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CIHCIDAJ"></a>
<div id="STRMS1263" class="sect2">
<h3 class="sect2">Preparing for Upgrades to User-Created Applications<a id="sthref1599"></a></h3>
<p>This section is relevant only if the operation entails upgrading user-created applications. During an upgrade of user-created applications, schema objects can be modified, and there might be logical dependencies that cannot be detected by the database alone. The following sections describe handling these issues during an application upgrade:</p>
<ul>
<li>
<p><a href="#CHDIAIJH">Handling Modifications to Schema Objects</a></p>
</li>
<li>
<p><a href="#CHDIFCIF">Handling Logical Dependencies</a></p>
</li>
</ul>
<a id="CHDIAIJH"></a>
<div id="STRMS1264" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Handling Modifications to Schema Objects</h4>
<p>If you are upgrading user-created applications, then, typically, schema objects in the database change to support the upgraded applications. In Oracle Streams, row logical change records (LCRs) contain information about row changes that result from DML statements. A <a href="strms_glossary.htm#CHDBDEJG"><span class="xrefglossterm">declarative rule-based transformation</span></a> or <a href="strms_glossary.htm#CHDEIDID"><span class="xrefglossterm">DML handler</span></a> can modify row LCRs captured from the source database redo log so that the row LCRs can be applied to the altered tables at the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>.</p>
<p>A <a href="strms_glossary.htm#CHDGHJDE"><span class="xrefglossterm">rule-based transformation</span></a> is any modification to a <a href="strms_glossary.htm#CHDFHHGJ"><span class="xrefglossterm">message</span></a> that results when a <a href="strms_glossary.htm#CHDIFFCF"><span class="xrefglossterm">rule</span></a> in a <a href="strms_glossary.htm#CHDEEDIJ"><span class="xrefglossterm">positive rule set</span></a> evaluates to <code dir="ltr">TRUE</code>. Declarative rule-based transformations cover a common set of transformation scenarios for row LCRs. Declarative rule-based transformations are run internally without using PL/SQL. You specify such a transformation using a procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package. A declarative rule-based transformation can modify row LCRs during capture, propagation, or apply.</p>
<p>A DML handler is either a collection of SQL statements or a user procedure that processes row LCRs resulting from DML statements at a source database. An Oracle Streams <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> at a destination database can pass row LCRs to a DML handler, and the DML handler can modify the row LCRs.</p>
<p>The process for upgrading user-created applications using Oracle Streams can involve modifying and creating the schema objects at the destination database after <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a>. You can use one or more declarative rule-based transformations and DML handlers at the destination database to process changes from the source database so that they apply to the modified schema objects correctly. Declarative rule-based transformations and DML handlers can be used during application upgrade to account for differences between the source database and destination database.</p>
<p>In general, declarative rule-based transformations are easier to use than DML handlers. Therefore, when modifications to row LCRs are required, try to configure a declarative rule-based transformation first. If a declarative rule-based transformation is not sufficient, then use a DML handler. If row LCRs for tables that contain one or more LOB columns must be modified, then you should use a procedure DML handler and <a href="strms_glossary.htm#CBAEBDDB"><span class="xrefglossterm">LOB assembly</span></a>.</p>
<p>Before you begin the database upgrade or maintenance operation, you should complete the following tasks to prepare your declarative rule-based transformations or DML handlers:</p>
<ul>
<li>
<p>Learn about declarative rule-based transformations. See <a href="strms_transform.htm#CJADBDFH">&#34;Declarative Rule-Based Transformations&#34;</a>.</p>
</li>
<li>
<p>Learn about DML handlers. See <a href="strms_apply.htm#i1006214">&#34;Message Processing Options for an Apply Process&#34;</a>.</p>
</li>
<li>
<p>Determine the declarative rule-based transformations and DML handlers you will need at your destination database. Your determination depends on the modifications to the schema objects required by your upgraded applications.</p>
</li>
<li>
<p>Create the SQL statements or the PL/SQL procedures that you will use for any DML handlers during the database maintenance operation. See <a href="strms_mapply.htm#BGBJHGHG">&#34;Managing a DML Handler&#34;</a> for information about creating the PL/SQL procedures.</p>
</li>
<li>
<p>If row LCRs for tables that contain one or more LOB columns must be modified, then learn about using LOB assembly. See <a class="olink STREP137" href="../STREP/man_lcrs.htm#STREP137"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a>.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Custom rule-based transformation can also be used to modify row LCRs during application upgrade. However, these modifications can be accomplished using DML handlers, and DML handlers are more efficient than <a href="strms_glossary.htm#CHDDGIFE"><span class="xrefglossterm">custom rule-based transformation</span></a>s.</div>
</div>
<!-- class="sect3" -->
<a id="CHDIFCIF"></a>
<div id="STRMS1265" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Handling Logical Dependencies<a id="sthref1600"></a></h4>
<p>In some cases, an <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> requires additional information to detect dependencies in row LCRs that are being applied in parallel. During application upgrades, an apply process might require additional information to detect dependencies in the following situations:</p>
<ul>
<li>
<p>The application, rather than the database, enforces logical dependencies.</p>
</li>
<li>
<p>Schema objects have been modified to support the application upgrade, and a <a href="strms_glossary.htm#CHDEIDID"><span class="xrefglossterm">DML handler</span></a> will modify row LCRs to account for differences between the source database and destination database.</p>
</li>
</ul>
<p>A <a href="strms_glossary.htm#CHDFHEEG"><span class="xrefglossterm">virtual dependency definition</span></a> is a description of a dependency that is used by an apply process to detect dependencies between transactions at a destination database. A virtual dependency definition is not described as a constraint in the destination database data dictionary. Instead, it is specified using procedures in the <code dir="ltr">DBMS_APPLY_ADM</code> package. Virtual dependency definitions enable an apply process to detect dependencies that it would not be able to detect by using only the constraint information in the data dictionary. After dependencies are detected, an apply process schedules LCRs and transactions in the correct order for apply.</p>
<p>If virtual dependency definitions are required for your application upgrade, then learn about virtual dependency definitions and plan to configure them during the application upgrade.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_adapply.htm#BABDFDBI">&#34;Apply Processes and Dependencies&#34;</a> for more information about virtual dependency definitions</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CIHGICAA"></a>
<div id="STRMS1266" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Deciding Whether to Configure Oracle Streams Directly or Generate a Script</h3>
<p>The <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> and <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedures in the <code dir="ltr">DBMS_STREAMS_ADM</code> package configure the Oracle Streams <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment during the upgrade or maintenance operation. These procedures can configure the Oracle Streams replication environment directly, or they can generate a script that configures the environment.</p>
<p>Using a procedure to configure replication directly is simpler than running a script, and the environment is configured immediately. However, you might choose to generate a script for the following reasons:</p>
<ul>
<li>
<p>You want to review the actions performed by the procedure before configuring the environment.</p>
</li>
<li>
<p>You want to modify the script to customize the configuration.</p>
</li>
</ul>
<p>To configure Oracle Streams directly when you run one of these procedures, set the <code dir="ltr">perform_actions</code> parameter to <code dir="ltr">TRUE</code>. The examples in this appendix assume that the procedures will configure Oracle Streams directly.</p>
<p>To generate a configuration script when you run one of these procedures, complete the following steps when you are instructed to run a procedure in this appendix:</p>
<ol>
<li>
<p>In SQL*Plus, connect as the Oracle Streams administrator to database where you will run the procedure.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CIHFDBCA">
<p>Create a directory object to store the script that will be generated by the procedure. For example:</p>
<pre dir="ltr">CREATE DIRECTORY scripts_dir AS &#39;/usr/scripts&#39;;
</pre></li>
<li>
<p>Run the procedure. Ensure that the following parameters are set to generate a script:</p>
<ul>
<li>
<p>Set the <code dir="ltr">perform_actions</code> parameter to <code dir="ltr">FALSE</code>.</p>
</li>
<li>
<p>Set the <code dir="ltr">script_name</code> parameter to the name of the script you want to generate.</p>
</li>
<li>
<p>Set the <code dir="ltr">script_directory_object</code> parameter to the directory object into which you want to place the script. This directory object was created in Step <a href="#CIHFDBCA">2</a>.</p>
</li>
</ul>
</li>
<li>
<p>Review or modify the script, if necessary.</p>
</li>
<li>
<p>In SQL*Plus, connect as the Oracle Streams administrator to database where you will run the procedure.</p>
</li>
<li id="CIHDFEFA">
<p>Run the generated script. For example:</p>
<pre dir="ltr">@/usr/scripts/pre_instantiation.sql;
</pre></li>
</ol>
</div>
<!-- class="sect2" -->
<a id="CIHCBADI"></a>
<div id="STRMS1267" class="sect2">
<h3 class="sect2">Deciding Which Utility to Use for Instantiation<a id="sthref1601"></a><a id="sthref1602"></a><a id="sthref1603"></a><a id="sthref1604"></a><a id="sthref1605"></a><a id="sthref1606"></a><a id="sthref1607"></a><a id="sthref1608"></a></h3>
<p>Before you begin the database upgrade or maintenance operation, decide whether you want to use Export/Import utilities (Data Pump or original) or the Recovery Manager (RMAN) utility to instantiate the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> during the operation. Consider the following factors when you make this decision:</p>
<ul>
<li>
<p>If you are migrating the database to a different platform, then you can use either Export/Import or the RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command. The RMAN <code dir="ltr">DUPLICATE</code> command does not support migrating a database to a different platform.</p>
</li>
<li>
<p>If you are migrating the database to a different character set, then you must use Export/Import, and the new character set must be a superset of the old character set. The RMAN <code dir="ltr">DUPLICATE</code> and <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> commands do not support migrating a database to a different character set.</p>
</li>
<li>
<p>If you are upgrading from a prior release of Oracle Database to Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later, then consider these additional factors:</p>
</li>
<li>
<p>If RMAN is supported for the operation, then using RMAN for the <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> might be faster than using Export/Import, especially if the database is large.</p>
</li>
<li>
<p>Oracle recommends that you do not use RMAN for instantiation in an environment where distributed transactions are possible. Doing so might cause in-doubt transactions that must be corrected manually.</p>
</li>
<li>
<p>If the RMAN <code dir="ltr">DUPLICATE</code> or <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command is used for database instantiation, then the destination database cannot be the capture database.</p>
</li>
<li>
<p>If you are upgrading from a prior release of Oracle Database to Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later, then consider these additional factors:</p>
<ul>
<li>
<p>If you use Export/Import, then you can make the destination database an Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later database at the beginning of the operation. Therefore, you do not need to upgrade the destination database after the <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a>.</p>
</li>
<li>
<p>If you use the RMAN <code dir="ltr">DUPLICATE</code>, then the database release of the destination database must be the same as the source database.</p>
</li>
<li>
<p>If you use the RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code>, then the database release of the destination database must be the equal to or later than the source database.</p>
</li>
</ul>
</li>
</ul>
<p><a href="#CIHFFCHI">Table D-1</a> describes when each instantiation method is supported based on whether the platform at the source and destination databases are the same or different, and whether the character set at the source and destination databases are the same or different.</p>
<div id="STRMS1268" class="tblhruleformalwide">
<p class="titleintable"><a id="sthref1609"></a><a id="CIHFFCHI"></a>Table D-1 Instantiation Methods for Database Maintenance with Oracle Streams</p>
<table class="cellalignment5973" title="Instantiation Methods for Database Maintenance with Oracle Streams" summary="This table describes when each instantiation method is supported for the maintenance operation based on whether the platform at the source and destination are the same or different, and whether the character set at the source and destination are the same or different." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t15">Instantiation Method</th>
<th class="cellalignment5974" id="r1c2-t15">Same Platform Supported?</th>
<th class="cellalignment5974" id="r1c3-t15">Different Platforms Supported?</th>
<th class="cellalignment5974" id="r1c4-t15">Same Character Set Supported?</th>
<th class="cellalignment5974" id="r1c5-t15">Different Character Sets Supported?</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t15" headers="r1c1-t15">
<p>Data Pump Export/Import</p>
</td>
<td class="cellalignment5970" headers="r2c1-t15 r1c2-t15">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r2c1-t15 r1c3-t15">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r2c1-t15 r1c4-t15">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r2c1-t15 r1c5-t15">
<p>Yes</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t15" headers="r1c1-t15">
<p>RMAN <code dir="ltr">DUPLICATE</code></p>
</td>
<td class="cellalignment5970" headers="r3c1-t15 r1c2-t15">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r3c1-t15 r1c3-t15">
<p>No</p>
</td>
<td class="cellalignment5970" headers="r3c1-t15 r1c4-t15">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r3c1-t15 r1c5-t15">
<p>No</p>
</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t15" headers="r1c1-t15">
<p>RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code></p>
</td>
<td class="cellalignment5970" headers="r4c1-t15 r1c2-t15">
<p>No</p>
</td>
<td class="cellalignment5970" headers="r4c1-t15 r1c3-t15">
<p>Maybe</p>
</td>
<td class="cellalignment5970" headers="r4c1-t15 r1c4-t15">
<p>Yes</p>
</td>
<td class="cellalignment5970" headers="r4c1-t15 r1c5-t15">
<p>No</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblhruleformalwide" -->
<p>Only some platform combinations are supported by the RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command. You can use the <code dir="ltr">DBMS_TDB</code> package to determine whether a platform combination is supported.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink STREP012" href="../STREP/instant.htm#STREP012"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about Oracle Streams instantiations</p>
</li>
<li>
<p><a class="olink BRADV010" href="../BRADV/rcmdupdb.htm#BRADV010"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for instructions on using the RMAN <code dir="ltr">DUPLICATE</code> and <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> commands</p>
</li>
<li>
<p><a class="olink RCMRF" href="../RCMRF/toc.htm"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more information about the RMAN <code dir="ltr">DUPLICATE</code> and <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> commands</p>
</li>
<li>
<p><a class="olink ARPLS650" href="../ARPLS/d_tdb.htm#ARPLS650"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">DBMS_TDB</code> package</p>
</li>
<li>
<p><a class="olink NLSPG464" href="../NLSPG/ch11charsetmig.htm#NLSPG464"><span class="italic">Oracle Database Globalization Support Guide</span></a> for more information about character set conversion and Export/Import</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i637663"></a>
<div id="STRMS1269" class="sect1">
<h2 class="sect1">Performing a Database Upgrade or Maintenance Operation Using Oracle Streams<a id="sthref1610"></a><a id="sthref1611"></a><a id="sthref1612"></a><a id="sthref1613"></a><a id="sthref1614"></a><a id="sthref1615"></a></h2>
<p>This section describes performing one of the following operations on an Oracle database:</p>
<ul>
<li>
<p>Upgrading to the current release of Oracle Database from Oracle Database 10<span class="italic">g</span> Release 2 (10.2) or Oracle Database 11<span class="italic">g</span> Release 1 (11.1)</p>
</li>
<li>
<p>Migrating the database to a different platform</p>
</li>
<li>
<p>Migrating the database to a different character set</p>
</li>
<li>
<p>Modifying database schema objects to support upgrades to user-created applications</p>
</li>
<li>
<p>Applying an Oracle Database software patch or patch set</p>
</li>
</ul>
<p>You can use Oracle Streams to achieve little or no downtime during these operations. During the operation, the source database is the existing database on which you are performing the database operation. The capture database is the database on which the Oracle Streams <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> runs. The <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> is the database that will replace the source database at the end of the operation.</p>
<p>Complete the following tasks to perform a database maintenance operation using Oracle Streams:</p>
<ul>
<li>
<p><a href="#i638439">Task 1: Beginning the Operation</a></p>
</li>
<li>
<p><a href="#CIHBBHAA">Task 2: Setting Up Oracle Streams Before Instantiation</a></p>
</li>
<li>
<p><a href="#CIHBEEJJ">Task 3: Instantiating the Database</a></p>
</li>
<li>
<p><a href="#CIHHHEGH">Task 4: Setting Up Oracle Streams After Instantiation</a></p>
</li>
<li>
<p><a href="#CIHDAJJI">Task 5: Finishing the Upgrade or Maintenance Operation and Removing Oracle Streams</a></p>
</li>
</ul>
<a id="i638439"></a>
<div id="STRMS1270" class="sect2">
<h3 class="sect2">Task 1: Beginning the Operation</h3>
<p>Complete the following steps to begin the upgrade or maintenance operation using Oracle Streams:</p>
<ol>
<li>
<p>Create an empty <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>. If you are migrating the database to a different platform, then create the database on a computer system that uses the new platform. If you are migrating the database to a different character set, then create a database that uses the new character set.</p>
<p>Ensure that the destination database has a different global name than the source database. This example assumes that the global name of the source database is <code dir="ltr">orcl.example.com</code> and the global name of the destination database during the database maintenance operation is <code dir="ltr">stms.example.com</code>. The global name of the destination database is changed when the destination database replaces the source database at the end of the maintenance operation.</p>
<p>If you are not upgrading from a prior release of Oracle Database, then create an Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later database. See the Oracle installation guide for your operating system if you must install Oracle, and see the <a class="olink ADMIN002" href="../ADMIN/create.htm#ADMIN002"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about creating a database.</p>
<p>If you are upgrading from a prior release of Oracle Database, then the release of the empty database you create depends on the <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> method you decided to use in <a href="#CIHCBADI">&#34;Deciding Which Utility to Use for Instantiation&#34;</a>:</p>
<ul>
<li>
<p>If you decided to use export/import for instantiation, then create an empty Oracle Database 11<span class="italic">g</span> Release 2 or later database. This database will be the destination database during the upgrade process.</p>
<p>See the Oracle Database installation guide for your operating system if you must install Oracle Database, and see the <a class="olink ADMIN002" href="../ADMIN/create.htm#ADMIN002"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about creating a database.</p>
</li>
<li>
<p>If you decided to use RMAN <code dir="ltr">DUPLICATE</code> for instantiation, then create an empty Oracle database that is the same release as the database you are upgrading.</p>
<p>Specifically, if you are upgrading an Oracle Database 10<span class="italic">g</span> Release 2 (10.2) database, then create an Oracle Database 10<span class="italic">g</span> Release 2 database. Alternatively, if you are upgrading an Oracle Database 11<span class="italic">g</span> Release 1 (11.1) database, then create an Oracle Database 11<span class="italic">g</span> Release 1 database.</p>
<p>This database will be the destination database during the upgrade process. Both the source database that is being upgraded and the destination database must be the same release of Oracle when you start the upgrade process.</p>
<p>See the Oracle installation guide for your operating system if you must install Oracle, and see the Oracle <span class="italic">Database Administrator&#39;s Guide</span> for the release for information about creating a database.</p>
</li>
<li>
<p>If you decided to use RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> for instantiation, then create an empty Oracle database that is a release equal to or later than the database you are upgrading.</p>
<p>Specifically, if you are upgrading an Oracle Database 10<span class="italic">g</span> Release 2 (10.2) database, then create an Oracle Database 10<span class="italic">g</span> Release 2 database, an Oracle Database 11<span class="italic">g</span> Release 1 database, or an Oracle Database 11<span class="italic">g</span> Release 2 or later database. Alternatively, if you are upgrading an Oracle Database 11<span class="italic">g</span> Release 1 (11.1) database, then create an Oracle Database 11<span class="italic">g</span> Release 1 database or an Oracle Database 11<span class="italic">g</span> Release 2 or later database.</p>
<p>This database will be the destination database during the upgrade process.</p>
<p>See the Oracle installation guide for your operating system if you must install Oracle, and see the Oracle <span class="italic">Database Administrator&#39;s Guide</span> for the release for information about creating a database.</p>
</li>
</ul>
</li>
<li>
<p>Ensure that the source database is running in <code dir="ltr">ARCHIVELOG</code> mode. See <a class="olink ADMIN008" href="../ADMIN/archredo.htm#ADMIN008"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about running a database in <code dir="ltr">ARCHIVELOG</code> mode.</p>
</li>
<li>
<p>Create an undo tablespace at the capture database if one does not exist. For example, run the following statement while logged into the capture database as an administrative user:</p>
<pre dir="ltr">CREATE UNDO TABLESPACE undotbs_02
  DATAFILE &#39;/u01/oracle/rbdb1/undo0201.dbf&#39; SIZE 2M REUSE AUTOEXTEND ON;
</pre>
<p>The capture process at the capture database uses the undo tablespace.</p>
<p>See <a href="#DAFBFBDF">&#34;The Capture Database During the Upgrade or Maintenance Operation&#34;</a> for more information about the capture database.</p>
<p>See <a class="olink ADMIN11473" href="../ADMIN/undo.htm#ADMIN11473"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for more information about creating an undo tablespace.</p>
</li>
<li>
<p>Ensure that the initialization parameters are set properly at both databases to support an Oracle Streams environment.</p>
<p>For Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later databases, see <a class="olink STREP201" href="../STREP/prep_rep.htm#STREP201"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about setting initialization parameters that are relevant to Oracle Streams.</p>
<p>If you are upgrading from a prior release of Oracle Database, then for the source database, see the Oracle Streams documentation for the source database release.</p>
</li>
<li>
<p>Configure an Oracle Streams administrator at each database, including the source database, destination database, and capture database (if the capture database is a third database). This example assumes that the name of the Oracle Streams administrator is <code dir="ltr">strmadmin</code> at each database.</p>
<p>For Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later databases, see <a class="olink STREP200" href="../STREP/prep_rep.htm#STREP200"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information.</p>
<p>If you are upgrading from a prior release of Oracle Database, then for the source database, see the Oracle Streams documentation for the source database release.</p>
</li>
<li>
<p>If you are upgrading user-created applications, then supplementally log any columns at the source database that will be involved in a <a href="strms_glossary.htm#CHDGHJDE"><span class="xrefglossterm">rule-based transformation</span></a>, <a href="strms_glossary.htm#CHDEAFJH"><span class="xrefglossterm">procedure DML handler</span></a>, or <a href="strms_glossary.htm#CBAIBACD"><span class="xrefglossterm">value dependency</span></a>. These columns must be unconditionally logged at the source database. See <a class="olink STREP107" href="../STREP/prep_rep.htm#STREP107"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for information about specifying unconditional <a href="strms_glossary.htm#CHDJHFHF"><span class="xrefglossterm">supplemental log group</span></a>s for these columns.</p>
</li>
<li id="CIHFIJHG">
<p>At the source database, ensure that no changes are made to the database objects that are not supported by Oracle Streams during the upgrade or maintenance operation. To list unsupported database objects, query the <code dir="ltr">DBA_STREAMS_UNSUPPORTED</code> data dictionary view.</p>
<p><a href="#CIHJDACF">&#34;Preparing for Upgrade or Maintenance of a Database with User-Defined Types&#34;</a> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then tables that contain user-defined types can remain open during the operation.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">Tip:</p>
In Oracle Database 11<span class="italic">g</span> Release 1 (11.1) and later databases, you can use the <code dir="ltr">ALTER</code> <code dir="ltr">TABLE</code> statement with the <code dir="ltr">READ</code> <code dir="ltr">ONLY</code> clause to make a table read-only.</div>
</div>
<!-- class="sect2" -->
<a id="CIHBBHAA"></a>
<div id="STRMS1271" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 2: Setting Up Oracle Streams Before Instantiation</h3>
<p>The specific instructions for setting up Oracle Streams before <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> depend on which database is the capture database. The <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> procedure always configures the capture process on the database where it is run. Therefore, this procedure must be run at the capture database.</p>
<p>When you run this procedure, you can specify that the procedure performs the configuration directly, or that the procedure generates a script that contains the configuration actions. See <a href="#CIHGICAA">&#34;Deciding Whether to Configure Oracle Streams Directly or Generate a Script&#34;</a>. The examples in this section specify that the procedure performs the configuration directly.</p>
<p>Follow the instructions in the appropriate section:</p>
<ul>
<li>
<p><a href="#CIHFFBAH">The Source Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CIHHCDIF">The Destination Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CIHJICGF">A Third Database Is the Capture Database</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
When the <code dir="ltr">PRE_INSTANTIATION_SETUP</code> procedure is running with the <code dir="ltr">perform_actions</code> parameter set to <code dir="ltr">TRUE</code>, metadata about its configuration actions is recorded in the following data dictionary views: <code dir="ltr">DBA_RECOVERABLE_SCRIPT</code>, <code dir="ltr">DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code dir="ltr">DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code dir="ltr">DBA_RECOVERABLE_SCRIPT_ERRORS</code>. If the procedure stops because it encounters an error, then you can use the <code dir="ltr">RECOVER_OPERATION</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to complete the configuration after you correct the conditions that caused the error. These views are not populated if a script is used to configure the <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHJDHJC">&#34;Overview of Using Oracle Streams for Upgrade and Maintenance Operations&#34;</a> for information about the capture database</p>
</li>
<li>
<p><a class="olink ARPLS865" href="../ARPLS/d_streams_adm.htm#ARPLS865"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">RECOVER_OPERATION</code> procedure</p>
</li>
</ul>
</div>
<a id="CIHFFBAH"></a>
<div id="STRMS1272" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">The Source Database Is the Capture Database</h4>
<p>Complete the following steps to set up Oracle Streams before instantiation when the source database is the capture database:</p>
<ol>
<li>
<p>Configure your network and Oracle Net so that the source database can communicate with the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>In SQL*Plus, connect to the source database as the Oracle Streams administrator. In this example, the source database is <code dir="ltr">orcl.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create a database link to the destination database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK stms.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;stms.example.com&#39;;
</pre></li>
<li id="CIHEAHCA">
<p>Run the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.PRE_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.capture_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.capture_q&#39;,
    propagation_name        =&gt; &#39;prop_maint&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.apply_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.apply_q_table&#39;,
    bi_directional          =&gt; FALSE,
    include_ddl             =&gt; TRUE,
    start_processes         =&gt; FALSE,
    exclude_schemas         =&gt; &#39;*&#39;,
    exclude_flags           =&gt; DBMS_STREAMS_ADM.EXCLUDE_FLAGS_UNSUPPORTED + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DML + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DDL);
END;
/
</pre></li>
<li>
<p>Proceed to <a href="#CIHBEEJJ">&#34;Task 3: Instantiating the Database&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHHCDIF"></a>
<div id="STRMS1273" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">The Destination Database Is the Capture Database</h4>
<p>Complete the following steps to set up Oracle Streams before instantiation when the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> is the capture database:</p>
<ol>
<li>
<p>Configure your network and Oracle Net so that the source database and destination database can communicate with each other. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>Ensure that log file shipping from the source database to the destination database is configured. See <a href="#CIHBBHID">&#34;Preparing for Downstream Capture&#34;</a> for more information.</p>
</li>
<li>
<p>In SQL*Plus, connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">stms.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create a database link to the source database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK orcl.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;orcl.example.com&#39;;
</pre></li>
<li>
<p>Run the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.PRE_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.streams_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.streams_q&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.streams_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.streams_q_table&#39;,
    bi_directional          =&gt; FALSE,
    include_ddl             =&gt; TRUE,
    start_processes         =&gt; FALSE,
    exclude_schemas         =&gt; &#39;*&#39;,
    exclude_flags           =&gt; DBMS_STREAMS_ADM.EXCLUDE_FLAGS_UNSUPPORTED + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DML + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DDL);
END;
/
</pre>
<p>Notice that the <code dir="ltr">propagation_name</code> parameter is omitted because a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> is not necessary when the destination database is the capture database and the downstream <a href="strms_glossary.htm#CHDBHECD"><span class="xrefglossterm">capture process</span></a> and <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a> use the same <a href="strms_glossary.htm#CHDIDCDI"><span class="xrefglossterm">queue</span></a> at the destination database.</p>
<p>Also, notice that the capture process and apply process will share a queue named <code dir="ltr">streams_q</code> at the destination database.</p>
</li>
<li>
<p>Proceed to <a href="#CIHBEEJJ">&#34;Task 3: Instantiating the Database&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHJICGF"></a>
<div id="STRMS1274" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">A Third Database Is the Capture Database</h4>
<p>This example assumes that the global name of the third database is <code dir="ltr">thrd.example.com</code>. Complete the following steps to set up Oracle Streams before instantiation when a third database is the capture database:</p>
<ol>
<li>
<p>Configure your network and Oracle Net so that the source database, <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>, and third database can communicate with each other. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>Ensure that log file shipping from the source database to the third database is configured. See <a href="#CIHBBHID">&#34;Preparing for Downstream Capture&#34;</a> for more information.</p>
</li>
<li>
<p>In SQL*Plus, connect to the third database as the Oracle Streams administrator. In this example, the third database is <code dir="ltr">thrd.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create a database link to the source database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK orcl.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;orcl.example.com&#39;;
</pre></li>
<li>
<p>Create a database link to the destination database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK stms.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;stms.example.com&#39;;
</pre></li>
<li>
<p>Run the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.PRE_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.capture_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.capture_q&#39;,
    propagation_name        =&gt; &#39;prop_maint&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.apply_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.apply_q_table&#39;,
    bi_directional          =&gt; FALSE,
    include_ddl             =&gt; TRUE,
    start_processes         =&gt; FALSE,
    exclude_schemas         =&gt; &#39;*&#39;,
    exclude_flags           =&gt; DBMS_STREAMS_ADM.EXCLUDE_FLAGS_UNSUPPORTED + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DML + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DDL);
END;
/
</pre></li>
<li>
<p>Proceed to <a href="#CIHBEEJJ">&#34;Task 3: Instantiating the Database&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CIHBEEJJ"></a>
<div id="STRMS1275" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 3: Instantiating the Database</h3>
<p><a href="#CIHCBADI">&#34;Deciding Which Utility to Use for Instantiation&#34;</a> discusses different options for instantiating an entire database. Complete the steps in the appropriate section based on the <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> option you are using:</p>
<ul>
<li>
<p><a href="#CIHCGAIH">Instantiating the Database Using Export/Import</a></p>
</li>
<li>
<p><a href="#CIHIJEGF">Instantiating the Database Using the RMAN DUPLICATE Command</a></p>
</li>
<li>
<p><a href="#CIHGGBAJ">Instantiating the Database Using the RMAN CONVERT DATABASE Command</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STREP012" href="../STREP/instant.htm#STREP012"><span class="italic">Oracle Streams Replication Administrator&#39;s Guide</span></a> for more information about performing instantiations</div>
<a id="CIHCGAIH"></a>
<div id="STRMS1276" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Instantiating the Database Using Export/Import</h4>
<p>Complete the following steps to instantiate an entire database with Data Pump:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the source database as the Oracle Streams administrator.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CIHCJIEA">
<p>Create a directory object to hold the export dump file and export log file. For example:</p>
<pre dir="ltr">CREATE DIRECTORY dpump_dir AS &#39;/usr/dpump_dir&#39;;
</pre></li>
<li>
<p>While connected to the source database as the Oracle Streams administrator, determine the current system change number (SCN) of the source database:</p>
<pre dir="ltr">SET SERVEROUTPUT ON SIZE 1000000
DECLARE
  current_scn NUMBER;
BEGIN
  current_scn:= DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER;
      DBMS_OUTPUT.PUT_LINE(&#39;Current SCN: &#39; || current_scn);
END;
/
</pre>
<p>The returned SCN value is specified for the <code dir="ltr">FLASHBACK_SCN</code> Data Pump export parameter in Step <a href="#CIHDFJBB">4</a>. Specifying the <code dir="ltr">FLASHBACK_SCN</code> export parameter, or a similar export parameter, ensures that the export is consistent to a single SCN. In this example, assume that the query returned <code dir="ltr">876606</code>.</p>
<p>After you perform this query, ensure that no DDL changes are made to the objects being exported until after the export is complete.</p>
</li>
<li id="CIHDFJBB">
<p>On a command line, use Data Pump to export the source database.</p>
<p>Perform the export by connecting as an administrative user who is granted <code dir="ltr">EXP_FULL_DATABASE</code> role. This user also must have <code dir="ltr">READ</code> and <code dir="ltr">WRITE</code> privilege on the directory object created in Step <a href="#CIHCJIEA">2</a>. This example connects as the Oracle Streams administrator <code dir="ltr">strmadmin</code>.</p>
<p>The following example is a Data Pump export command:</p>
<pre dir="ltr">expdp strmadmin FULL DIRECTORY=DPUMP_DIR DUMPFILE=orc1.dmp FLASHBACK_SCN=876606
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SUTIL200" href="../SUTIL/GUID-5F7380CE-A619-4042-8D13-1F7DDE429991.htm#SUTIL200"><span class="italic">Oracle Database Utilities</span></a> for information about performing a Data Pump export</div>
</li>
<li>
<p>In SQL*Plus, connect to the destination database as the Oracle Streams administrator.</p>
</li>
<li id="CIHIDCCE">
<p>Create a directory object to hold the import dump file and import log file. For example:</p>
<pre dir="ltr">CREATE DIRECTORY dpump_dir AS &#39;/usr/dpump_dir&#39;;
</pre></li>
<li>
<p>Transfer the Data Pump export dump file <code dir="ltr">orc1.dmp</code> to the destination database. You can use the <code dir="ltr">DBMS_FILE_TRANSFER</code> package, binary FTP, or some other method to transfer the file to the destination database. After the file transfer, the export dump file should reside in the directory that corresponds to the directory object created in Step <a href="#CIHIDCCE">6</a>.</p>
</li>
<li>
<p>On a command line at the destination database, use Data Pump to import the export dump file <code dir="ltr">orc1.dmp</code>. Ensure that no changes are made to the database tables until the import is complete. Performing the import automatically sets the <a href="strms_glossary.htm#CHDHBBHE"><span class="xrefglossterm">instantiation SCN</span></a> for the destination database and all of its objects.</p>
<p>Perform the import by connecting as an administrative user who is granted <code dir="ltr">IMP_FULL_DATABASE</code> role. This user also must have <code dir="ltr">READ</code> and <code dir="ltr">WRITE</code> privilege on the directory object created in Step <a href="#CIHIDCCE">6</a>. This example connects as the Oracle Streams administrator <code dir="ltr">strmadmin</code>.</p>
<p>Ensure that you set the <code dir="ltr">STREAMS_CONFIGURATION</code> import parameter to <code dir="ltr">n</code>.</p>
<p>The following example is an import command:</p>
<pre dir="ltr">impdp strmadmin FULL DIRECTORY=DPUMP_DIR DUMPFILE=orc1.dmp STREAMS_CONFIGURATION=n
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SUTIL300" href="../SUTIL/GUID-D11E340E-14C6-43B8-AB09-6335F0C1F71B.htm#SUTIL300"><span class="italic">Oracle Database Utilities</span></a> for information about performing a Data Pump import</div>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CIHIJEGF"></a>
<div id="STRMS1277" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Instantiating the Database Using the RMAN DUPLICATE Command<a id="sthref1616"></a><a id="sthref1617"></a></h4>
<p>If you use the RMAN <code dir="ltr">DUPLICATE</code> command for instantiation on the same platform, then complete the following steps:</p>
<ol>
<li>
<p>Create a backup of the source database if one does not exist. RMAN requires a valid backup for duplication. In this example, create a backup of <code dir="ltr">orcl.example.com</code> if one does not exist.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
A backup of the source database is not necessary if you use the <code dir="ltr">FROM</code> <code dir="ltr">ACTIVE</code> <code dir="ltr">DATABASE</code> option when you run the RMAN <code dir="ltr">DUPLICATE</code> command. For large databases, the <code dir="ltr">FROM</code> <code dir="ltr">ACTIVE</code> <code dir="ltr">DATABASE</code> option requires significant network resources. This example does not use this option.</div>
</li>
<li>
<p>In SQL*Plus, connect as an administrative user to the source database. In this example, the source database is <code dir="ltr">orcl.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDJDGFE">
<p>Determine the until SCN for the RMAN <code dir="ltr">DUPLICATE</code> command. For example:</p>
<pre dir="ltr">SET SERVEROUTPUT ON SIZE 1000000
DECLARE
  until_scn NUMBER;
BEGIN
  until_scn:= DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER;
      DBMS_OUTPUT.PUT_LINE(&#39;Until SCN: &#39; || until_scn);
END;
/
</pre>
<p>Make a note of the until SCN value. This example assumes that the until SCN value is <code dir="ltr">748045</code>. You will set the <code dir="ltr">UNTIL</code> <code dir="ltr">SCN</code> option to this value when you use RMAN to duplicate the database in Step <a href="#CHDHCGGJ">7</a> and as the <a href="strms_glossary.htm#CHDHBBHE"><span class="xrefglossterm">instantiation SCN</span></a> in <a href="#CIHHHEGH">&#34;Task 4: Setting Up Oracle Streams After Instantiation&#34;</a>.</p>
</li>
<li id="CHDGAACC">
<p>Archive the current online redo log. For example:</p>
<pre dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
<li>
<p>Prepare your environment for database duplication, which includes preparing the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> as an auxiliary instance for duplication. See the <a class="olink BRADV010" href="../BRADV/rcmdupdb.htm#BRADV010"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>Start the RMAN client, and connect to the database <code dir="ltr">orcl.example.com</code> as <code dir="ltr">TARGET</code> and to the <code dir="ltr">stms.example.com</code> database as <code dir="ltr">AUXILIARY</code>. Connect to each database as an administrative user.</p>
<p>See <a class="olink RCMRF114" href="../RCMRF/rcmsynta010.htm#RCMRF114"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more information about the RMAN <code dir="ltr">CONNECT</code> command.</p>
</li>
<li id="CHDHCGGJ">
<p>Use the RMAN <code dir="ltr">DUPLICATE</code> command with the <code dir="ltr">OPEN</code> <code dir="ltr">RESTRICTED</code> option to instantiate the source database at the destination database. The <code dir="ltr">OPEN</code> <code dir="ltr">RESTRICTED</code> option is required. This option enables a restricted session in the duplicate database by issuing the following SQL statement: <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> <code dir="ltr">ENABLE</code> <code dir="ltr">RESTRICTED</code> <code dir="ltr">SESSION</code>. RMAN issues this statement immediately before the duplicate database is opened.</p>
<p>You can use the <code dir="ltr">UNTIL</code> <code dir="ltr">SCN</code> clause to specify an SCN for the duplication. Use the until SCN determined in Step <a href="#CHDJDGFE">3</a> for this clause. Archived redo logs must be available for the until SCN specified and for higher SCN values. Therefore, Step <a href="#CHDGAACC">4</a> archived the redo log containing the until SCN.</p>
<p>Ensure that you use <code dir="ltr">TO</code> <code dir="ltr"><span class="codeinlineitalic">database_name</span></code> in the <code dir="ltr">DUPLICATE</code> command to specify the database name of the duplicate database. In this example, the database name of the duplicate database is <code dir="ltr">stms</code>. Therefore, the <code dir="ltr">DUPLICATE</code> command for this example includes <code dir="ltr">TO</code> <code dir="ltr">stms</code>.</p>
<p>The following example is an RMAN <code dir="ltr">DUPLICATE</code> command:</p>
<pre dir="ltr">RMAN&gt; RUN
      { 
        SET UNTIL SCN 748045;
        ALLOCATE AUXILIARY CHANNEL stms DEVICE TYPE sbt; 
        DUPLICATE TARGET DATABASE TO stms 
        NOFILENAMECHECK
        OPEN RESTRICTED;
      }
</pre></li>
<li>
<p>In SQL*Plus, connect to the destination database as a system administrator. In this example, the destination database is <code dir="ltr">stms.example.com</code>.</p>
</li>
<li>
<p>Rename the global name. After an RMAN database instantiation, the destination database has the same global name as the source database, but the destination database must have its original name until the end of the operation. Rename the global name of the destination database back to its original name with the following statement:</p>
<pre dir="ltr">ALTER DATABASE RENAME GLOBAL_NAME TO stms.example.com;
</pre></li>
<li>
<p>If you are upgrading the database from a prior release to Oracle Database 11<span class="italic">g</span> Release 2 or later, then upgrade the destination database. See the <a class="olink UPGRD" href="../UPGRD/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a> for more information. If you are not upgrading the database, then skip this step and proceed to the next step.</p>
</li>
<li>
<p>In SQL*Plus, connect to the destination database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Create a database link to the source database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK orcl.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;orcl.example.com&#39;;
</pre>
<p>This database link is required because the <code dir="ltr">POST_INSTANTIATION_SETUP</code> procedure runs the <code dir="ltr">SET_GLOBAL_INSTANTIATION_SCN</code> procedure in the <code dir="ltr">DBMS_APPLY_ADM</code> package at the destination database, and the <code dir="ltr">SET_GLOBAL_INSTANTIATION_SCN</code> procedure requires the database link.</p>
</li>
<li>
<p>If the source database and the capture database are the same database, then while still connected as the Oracle Streams administrator in SQL*Plus to the destination database, drop the database link from the source database to the destination database that was cloned from the source database:</p>
<pre dir="ltr">DROP DATABASE LINK stms.example.com;
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RCMRF126" href="../RCMRF/rcmsynta020.htm#RCMRF126"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more information about the RMAN <code dir="ltr">DUPLICATE</code> command</div>
</div>
<!-- class="sect3" -->
<a id="CIHGGBAJ"></a>
<div id="STRMS1278" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3">Instantiating the Database Using the RMAN CONVERT DATABASE Command<a id="sthref1618"></a><a id="sthref1619"></a></h4>
<p>If you use the RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command for instantiation to migrate the database to a different platform, then complete the following steps:</p>
<ol>
<li>
<p>Create a backup of the source database if one does not exist. RMAN requires a valid backup. In this example, create a backup of <code dir="ltr">orcl.example.com</code> if one does not exist.</p>
</li>
<li>
<p>In SQL*Plus, connect to the source database as an administrative user.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Archive the current online redo log. For example:</p>
<pre dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></li>
<li>
<p>Prepare your environment for database conversion, which includes opening the source database in read-only mode. Complete the following steps:</p>
<ol>
<li>
<p>If the source database is open, then shut it down and start it in read-only mode.</p>
</li>
<li>
<p>Run the <code dir="ltr">CHECK_DB</code> and <code dir="ltr">CHECK_EXTERNAL</code> functions in the <code dir="ltr">DBMS_TDB</code> package. Check the results to ensure that the conversion is supported by the RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink BRADV05432" href="../BRADV/rcmxplat.htm#BRADV05432"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for more information about these steps</div>
</li>
<li id="CIHIBJAD">
<p>Determine the current SCN of the source database:</p>
<pre dir="ltr">SET SERVEROUTPUT ON SIZE 1000000
DECLARE
  current_scn NUMBER;
BEGIN
  current_scn:= DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER;
      DBMS_OUTPUT.PUT_LINE(&#39;Current SCN: &#39; || current_scn);
END;
/
</pre>
<p>Make a note of the SCN value returned. You will use this number for the <a href="strms_glossary.htm#CHDHBBHE"><span class="xrefglossterm">instantiation SCN</span></a> in <a href="#CIHHHEGH">&#34;Task 4: Setting Up Oracle Streams After Instantiation&#34;</a>. For this example, assume that the returned value is&nbsp;<code dir="ltr">748044</code>.</p>
</li>
<li>
<p>Start the RMAN client, and connect to the source database <code dir="ltr">orcl.example.com</code> as <code dir="ltr">TARGET</code> as an administrative user.</p>
<p>See <a class="olink RCMRF114" href="../RCMRF/rcmsynta010.htm#RCMRF114"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more information about the RMAN <code dir="ltr">CONNECT</code> command.</p>
</li>
<li>
<p>Run the <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command.</p>
<p>Ensure that you use <code dir="ltr">NEW</code> <code dir="ltr">DATABASE</code> <code dir="ltr"><span class="codeinlineitalic">database_name</span></code> in the <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command to specify the database name of the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>. In this example, the database name of the destination database is <code dir="ltr">stms</code>. Therefore, the <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command for this example includes <code dir="ltr">NEW</code> <code dir="ltr">DATABASE</code> <code dir="ltr">stms</code>.</p>
<p>The following example is an RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command for a destination database that is running on the <code dir="ltr">Linux</code> <code dir="ltr">IA</code> <code dir="ltr">(64-bit)</code> platform:</p>
<pre dir="ltr">CONVERT DATABASE NEW DATABASE &#39;stms&#39;
          TRANSPORT SCRIPT &#39;/tmp/convertdb/transportscript.sql&#39;     
          TO PLATFORM &#39;Linux IA (64-bit)&#39;
          DB_FILE_NAME_CONVERT = (&#39;/home/oracle/dbs&#39;,&#39;/tmp/convertdb&#39;);
</pre></li>
<li>
<p>Transfer the data files, PFILE, and SQL script produced by the RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command to the computer system that is running the destination database.</p>
</li>
<li>
<p>On the computer system that is running the destination database, modify the SQL script so that the destination database always opens with restricted session enabled.</p>
<p>An example script follows with the necessary modifications in bold font:</p>
<pre dir="ltr">-- The following commands will create a control file and use it
-- to open the database.
-- Data used by Recovery Manager will be lost.
-- The contents of online logs will be lost and all backups will
-- be invalidated. Use this only if online logs are damaged.
 
-- After mounting the created controlfile, the following SQL
-- statement will place the database in the appropriate
-- protection mode:
--  ALTER DATABASE SET STANDBY DATABASE TO MAXIMIZE PERFORMANCE
 
STARTUP NOMOUNT PFILE=&#39;init_00gd2lak_1_0.ora&#39;
CREATE CONTROLFILE REUSE SET DATABASE &#34;STMS&#34; RESETLOGS  NOARCHIVELOG
    MAXLOGFILES 32
    MAXLOGMEMBERS 2
    MAXDATAFILES 32
    MAXINSTANCES 1
    MAXLOGHISTORY 226
LOGFILE
  GROUP 1 &#39;/tmp/convertdb/archlog1&#39;  SIZE 25M,
  GROUP 2 &#39;/tmp/convertdb/archlog2&#39;  SIZE 25M
DATAFILE
  &#39;/tmp/convertdb/systemdf&#39;,
  &#39;/tmp/convertdb/sysauxdf&#39;,
  &#39;/tmp/convertdb/datafile1&#39;,
  &#39;/tmp/convertdb/datafile2&#39;,
  &#39;/tmp/convertdb/datafile3&#39;
CHARACTER SET WE8DEC
;
 
<span class="bold">-- NOTE: This ALTER SYSTEM statement is added to enable restricted session.</span>

<span class="bold">ALTER SYSTEM ENABLE RESTRICTED SESSION;</span>

-- Database can now be opened zeroing the online logs.
ALTER DATABASE OPEN RESETLOGS;
 
-- No tempfile entries found to add.
--
 
set echo off
prompt ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
prompt * Your database has been created successfully!
prompt * There are many things to think about for the new database. Here
prompt * is a checklist to help you stay on track:
prompt * 1. You may want to redefine the location of the directory objects.
prompt * 2. You may want to change the internal database identifier (DBID) 
prompt *    or the global database name for this database. Use the 
prompt *    NEWDBID Utility (nid).
prompt ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
SHUTDOWN IMMEDIATE 
<span class="bold">-- NOTE: This startup has the UPGRADE parameter.</span>
<span class="bold">-- The startup already has restricted session enabled, so no change is needed.</span>
STARTUP UPGRADE PFILE=&#39;init_00gd2lak_1_0.ora&#39;
@@ ?/rdbms/admin/utlirp.sql 
SHUTDOWN IMMEDIATE 
<span class="bold">-- NOTE: The startup below is generated without the RESTRICT clause.</span>
<span class="bold">-- Add the RESTRICT clause.</span>
STARTUP <span class="bold">RESTRICT</span> PFILE=&#39;init_00gd2lak_1_0.ora&#39;
-- The following step will recompile all PL/SQL modules.
-- It may take serveral hours to complete.
@@ ?/rdbms/admin/utlrp.sql 
set feedback 6;
</pre>
<p>Other changes to the script might be necessary. For example, the data file locations and PFILE location might need to be changed to point to the correct locations on the destination database computer system.</p>
</li>
<li>
<p>In SQL*Plus, connect to the destination database as a system administrator.</p>
</li>
<li>
<p>Rename the global name. After an RMAN database instantiation, the destination database has the same global name as the source database, but the destination database must have its original name until the end of the maintenance operation. Rename the global name of the destination database back to its original name with the following statement:</p>
<pre dir="ltr">ALTER DATABASE RENAME GLOBAL_NAME TO stms.example.com;
</pre></li>
<li>
<p>If you are upgrading the database from a prior release to Oracle Database 11<span class="italic">g</span> Release 2 or later, then upgrade the destination database. See the <a class="olink UPGRD" href="../UPGRD/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a> for more information. If you are not upgrading the database, then skip this step and proceed to the next step.</p>
</li>
<li>
<p>Connect to the destination database as the Oracle Streams administrator using the new global name.</p>
</li>
<li>
<p>Create a database link to the source database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK orcl.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;orcl.example.com&#39;;
</pre>
<p>This database link is required because the <code dir="ltr">POST_INSTANTIATION_SETUP</code> procedure runs the <code dir="ltr">SET_GLOBAL_INSTANTIATION_SCN</code> procedure in the <code dir="ltr">DBMS_APPLY_ADM</code> package at the destination database, and the <code dir="ltr">SET_GLOBAL_INSTANTIATION_SCN</code> procedure requires the database link.</p>
</li>
<li>
<p>If the source database and the capture database are the same database, then while still connected as the Oracle Streams administrator in SQL*Plus to the destination database, drop the database link from the source database to the destination database that was cloned from the source database:</p>
<pre dir="ltr">DROP DATABASE LINK stms.example.com;
</pre></li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CIHHHEGH"></a>
<div id="STRMS1279" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 4: Setting Up Oracle Streams After Instantiation</h3>
<p>To set up Oracle Streams after <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a>, run the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedure. The <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedure must be run at the database where the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> procedure was run in <a href="#CIHBBHAA">&#34;Task 2: Setting Up Oracle Streams Before Instantiation&#34;</a>.</p>
<p>When you run the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedure, you can specify that the procedure performs the configuration directly, or that the procedure generates a script that contains the configuration actions. See <a href="#CIHGICAA">&#34;Deciding Whether to Configure Oracle Streams Directly or Generate a Script&#34;</a>. The examples in this section specify that the procedure performs the configuration directly.</p>
<p>The parameter values specified in the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">PRE_INSTANTIATION_SETUP</code></a> and <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedures must match, except for the values of the following parameters: <code dir="ltr">perform_actions</code>, <code dir="ltr">script_name</code>, <code dir="ltr">script_directory_object</code>, and <code dir="ltr">start_processes</code>. In this example, all of the parameter values match in the two procedures.</p>
<p>It is important to set the <code dir="ltr">instantiation_scn</code> parameter in the <a class="olink ARPLS831" href="../ARPLS/d_streams_adm.htm#ARPLS831"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedure correctly. Follow these instructions when you set this parameter:</p>
<ul>
<li>
<p>If RMAN was used for instantiation, then set the <code dir="ltr">instantiation_scn</code> parameter to the value determined during instantiation. This value was determined when you completed the instantiation in <a href="#CIHIJEGF">&#34;Instantiating the Database Using the RMAN DUPLICATE Command&#34;</a> or <a href="#CIHGGBAJ">&#34;Instantiating the Database Using the RMAN CONVERT DATABASE Command&#34;</a>.</p>
<p>The source database and third database examples in this section set the <code dir="ltr">instantiation_scn</code> parameter to <code dir="ltr">748044</code> for the following reasons:</p>
<ul>
<li>
<p>If the RMAN <code dir="ltr">DUPLICATE</code> command was used for instantiation, then the command duplicates the database up to one less than the SCN value specified in the <code dir="ltr">UNTIL</code> <code dir="ltr">SCN</code> clause. Therefore, you should subtract one from the until SCN value that you specified when you ran the <code dir="ltr">DUPLICATE</code> command in Step <a href="#CHDHCGGJ">7</a> in <a href="#CIHIJEGF">&#34;Instantiating the Database Using the RMAN DUPLICATE Command&#34;</a>. In this example, the until SCN was set to <code dir="ltr">748045</code>. Therefore, the <code dir="ltr">instantiation_scn</code> parameter should be set to 748045 - 1, or <code dir="ltr">748044</code>.</p>
</li>
<li>
<p>If the RMAN <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command was used for instantiation, then the <code dir="ltr">instantiation_scn</code> parameter should be set to the SCN value determined immediately before running the <code dir="ltr">CONVERT</code> <code dir="ltr">DATABASE</code> command. This value was determined in Step <a href="#CIHIBJAD">5</a> in <a href="#CIHGGBAJ">&#34;Instantiating the Database Using the RMAN CONVERT DATABASE Command&#34;</a>.</p>
</li>
</ul>
</li>
<li>
<p>If Export/Import was used for instantiation, then the <a href="strms_glossary.htm#CHDHBBHE"><span class="xrefglossterm">instantiation SCN</span></a> was set during import, and the <code dir="ltr">instantiation_scn</code> parameter must be set to <code dir="ltr">NULL</code>. The <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> example in this section sets the <code dir="ltr">instantiation_scn</code> to <code dir="ltr">NULL</code> because RMAN cannot be used for database instantiation when the destination database is the capture database.</p>
</li>
</ul>
<p>The specific instructions for setting up Oracle Streams after instantiation depend on which database is the capture database. Follow the instructions in the appropriate section:</p>
<ul>
<li>
<p><a href="#CIHFFBAH">The Source Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CIHHCDIF">The Destination Database Is the Capture Database</a></p>
</li>
<li>
<p><a href="#CIHJICGF">A Third Database Is the Capture Database</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
When the <code dir="ltr">POST_INSTANTIATION_SETUP</code> procedure is running with the <code dir="ltr">perform_actions</code> parameter set to <code dir="ltr">TRUE</code>, metadata about its configuration actions is recorded in the following data dictionary views: <code dir="ltr">DBA_RECOVERABLE_SCRIPT</code>, <code dir="ltr">DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code dir="ltr">DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code dir="ltr">DBA_RECOVERABLE_SCRIPT_ERRORS</code>. If the procedure stops because it encounters an error, then you can use the <code dir="ltr">RECOVER_OPERATION</code> procedure in the <code dir="ltr">DBMS_STREAMS_ADM</code> package to complete the configuration after you correct the conditions that caused the error. These views are not populated if a script is used to configure the <a href="strms_glossary.htm#CHDCDAHE"><span class="xrefglossterm">replication</span></a> environment.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="#CIHJDHJC">&#34;Overview of Using Oracle Streams for Upgrade and Maintenance Operations&#34;</a> for information about the capture database</p>
</li>
<li>
<p><a class="olink ARPLS865" href="../ARPLS/d_streams_adm.htm#ARPLS865"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">RECOVER_OPERATION</code> procedure</p>
</li>
</ul>
</div>
<div id="STRMS1280" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1620"></a>
<h4 class="sect3">The Source Database Is the Capture Database</h4>
<p>Complete the following steps to set up Oracle Streams after instantiation when the source database is the capture database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the source database as the Oracle Streams administrator. In this example, the source database is <code dir="ltr">orcl.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.POST_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.capture_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.capture_q&#39;,
    propagation_name        =&gt; &#39;prop_maint&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.apply_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.apply_q_table&#39;,
    bi_directional          =&gt; FALSE,
    include_ddl             =&gt; TRUE,
    start_processes         =&gt; FALSE,
    instantiation_scn       =&gt; 748044, -- NULL if Export/Import instantiation
    exclude_schemas         =&gt; &#39;*&#39;,
    exclude_flags           =&gt; DBMS_STREAMS_ADM.EXCLUDE_FLAGS_UNSUPPORTED + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DML + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DDL);
END;
/
</pre>
<p>Ensure that the <code dir="ltr">instantiation_scn</code> parameter is set to <code dir="ltr">NULL</code> if export/import was used for instantiation instead of RMAN.</p>
</li>
<li>
<p>Proceed to <a href="#CIHDAJJI">&#34;Task 5: Finishing the Upgrade or Maintenance Operation and Removing Oracle Streams&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<div id="STRMS1281" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1621"></a>
<h4 class="sect3">The Destination Database Is the Capture Database</h4>
<p>Complete the following steps to set up Oracle Streams after instantiation when the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a> is the capture database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code dir="ltr">stms.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.POST_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.streams_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.streams_q&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.streams_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.streams_q_table&#39;,
    bi_directional          =&gt; FALSE,
    include_ddl             =&gt; TRUE,
    start_processes         =&gt; FALSE,
    instantiation_scn       =&gt; NULL,
    exclude_schemas         =&gt; &#39;*&#39;,
    exclude_flags           =&gt; DBMS_STREAMS_ADM.EXCLUDE_FLAGS_UNSUPPORTED + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DML + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DDL);
END;
/
</pre>
<p>Notice that the <code dir="ltr">propagation_name</code> parameter is omitted because a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> is not necessary when the destination database is the capture database.</p>
</li>
<li>
<p>Proceed to <a href="#CIHDAJJI">&#34;Task 5: Finishing the Upgrade or Maintenance Operation and Removing Oracle Streams&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<div id="STRMS1282" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref1622"></a>
<h4 class="sect3">A Third Database Is the Capture Database</h4>
<p>This example assumes that the global name of the third database is <code dir="ltr">thrd.example.com</code>. Complete the following steps to set up Oracle Streams after instantiation when a third database is the capture database:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the third database as the Oracle Streams administrator. In this example, the third database is <code dir="ltr">thrd.example.com</code>.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Run the <a class="olink ARPLS830" href="../ARPLS/d_streams_adm.htm#ARPLS830"><code dir="ltr">POST_INSTANTIATION_SETUP</code></a> procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.POST_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.capture_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.capture_q&#39;,
    propagation_name        =&gt; &#39;prop_maint&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.apply_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.apply_q_table&#39;,
    bi_directional          =&gt; FALSE,
    include_ddl             =&gt; TRUE,
    start_processes         =&gt; FALSE,
    instantiation_scn       =&gt; 748044, -- NULL if Export/Import instantiation
    exclude_schemas         =&gt; &#39;*&#39;,
    exclude_flags           =&gt; DBMS_STREAMS_ADM.EXCLUDE_FLAGS_UNSUPPORTED + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DML + 
                            DBMS_STREAMS_ADM.EXCLUDE_FLAGS_DDL);
END;
/
</pre>
<p>Ensure that the <code dir="ltr">instantiation_scn</code> parameter is set to <code dir="ltr">NULL</code> if export/import was used for instantiation instead of RMAN.</p>
</li>
<li>
<p>Proceed to <a href="#CIHDAJJI">&#34;Task 5: Finishing the Upgrade or Maintenance Operation and Removing Oracle Streams&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CIHDAJJI"></a>
<div id="STRMS1283" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Task 5: Finishing the Upgrade or Maintenance Operation and Removing Oracle Streams</h3>
<p>Complete the following steps to finish the upgrade or maintenance operation and remove Oracle Streams components:</p>
<ol>
<li id="i638338">
<p>At the <a href="strms_glossary.htm#CHDGCAJA"><span class="xrefglossterm">destination database</span></a>, disable any imported jobs that modify data that will be replicated from the source database. Query the <code dir="ltr">DBA_JOBS</code> data dictionary view to list the jobs.</p>
</li>
<li>
<p>If you are applying a patch or patch set, then apply the patch or patch set to the destination database. Follow the instructions included with the patch or patch set. If you are not applying a patch or patch set, then skip this step and proceed to the next step.</p>
</li>
<li>
<p>If you are upgrading user-created applications, then, at the destination database, you might need to complete the following steps:</p>
<ol>
<li>
<p>Modify the schema objects in the database to support the upgraded user-created applications.</p>
</li>
<li>
<p>Configure one or more <a href="strms_glossary.htm#CHDBDEJG"><span class="xrefglossterm">declarative rule-based transformation</span></a>s and <a href="strms_glossary.htm#CHDEAFJH"><span class="xrefglossterm">procedure DML handler</span></a>s that modify row LCRs from the source database so that the apply process applies these row LCRs to the modified schema objects correctly. For example, if a column name was changed to support the upgraded user-created applications, then a declarative rule-based transformation should rename the column in a row LCR that involves the column.</p>
<p>See <a href="#CHDIAIJH">&#34;Handling Modifications to Schema Objects&#34;</a>.</p>
</li>
<li>
<p>Configure one or more <a href="strms_glossary.htm#CHDFHEEG"><span class="xrefglossterm">virtual dependency definition</span></a>s if row LCRs might contain logical dependencies that cannot be detected by the apply process alone.</p>
<p>See <a href="#CHDIFCIF">&#34;Handling Logical Dependencies&#34;</a>.</p>
</li>
</ol>
</li>
<li>
<p>In SQL*Plus, connect to the destination database as an administrative user.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Use the <code dir="ltr">ALTER</code> <code dir="ltr">SYSTEM</code> statement to disable the <code dir="ltr">RESTRICTED</code> <code dir="ltr">SESSION</code>:</p>
<pre dir="ltr">ALTER SYSTEM DISABLE RESTRICTED SESSION;
</pre></li>
<li>
<p>In SQL*Plus, connect to the destination database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Start the <a href="strms_glossary.htm#CHDJBHJC"><span class="xrefglossterm">apply process</span></a>. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; &#39;apply_maint&#39;);
END;
/
</pre></li>
<li>
<p>In SQL*Plus, connect to the capture database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Start the capture process. For example:</p>
<pre dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name  =&gt; &#39;capture_maint&#39;);
END;
/
</pre>
<p>This step begins the process of replicating changes that were made to the source database during <a href="strms_glossary.htm#CHDCCEJE"><span class="xrefglossterm">instantiation</span></a> of the destination database.</p>
</li>
<li id="CIHDGDDG">
<p>Monitor the Oracle Streams environment until the apply process at the destination database has applied most of the changes from the source database.</p>
<p>To determine whether the apply process at the destination database has applied most of the changes from the source database, complete the following steps:</p>
<ol>
<li id="DAFFABIF">
<p>Query the enqueue message number of the capture process and the message with the oldest system change number (SCN) for the apply process to see if they are nearly equal.</p>
<p>For example, if the name of the capture process is <code dir="ltr">capture_maint</code>, and the name of the apply process is <code dir="ltr">apply_maint</code>, then run the following query at the capture database:</p>
<pre dir="ltr">COLUMN ENQUEUE_MESSAGE_NUMBER HEADING &#39;Captured SCN&#39; FORMAT 99999999999
COLUMN OLDEST_SCN_NUM HEADING &#39;Oldest Applied SCN&#39; FORMAT 99999999999

SELECT c.ENQUEUE_MESSAGE_NUMBER, a.OLDEST_SCN_NUM
  FROM V$STREAMS_CAPTURE c, V$STREAMS_APPLY_READER@stms.example.com a
  WHERE c.CAPTURE_NAME = &#39;CAPTURE_MAINT&#39;
    AND a.APPLY_NAME   = &#39;APPLY_MAINT&#39;;
</pre>
<p>When the two values returned by this query are nearly equal, most of the changes from the source database have been applied at the destination database, and you can proceed to the next step. At this point in the process, the values returned by this query might never be equal because the source database still allows changes.</p>
<p>If this query returns no results, then ensure that the <a href="strms_glossary.htm#CHDDDJGJ"><span class="xrefglossterm">Oracle Streams client</span></a>s in the environment are enabled by querying the <code dir="ltr">STATUS</code> column in the <code dir="ltr">DBA_CAPTURE</code> view at the capture database and the <code dir="ltr">DBA_APPLY</code> view at the destination database. If a <a href="strms_glossary.htm#CHDEICIC"><span class="xrefglossterm">propagation</span></a> is used, you can check the status of the propagation by running the query in <a href="strms_qpmon.htm#i1007050">&#34;Displaying Information About the Schedules for Propagation Jobs&#34;</a>.</p>
<p>If an Oracle Streams client is disabled, then try restarting it. If an Oracle Streams client will not restart, then troubleshoot the environment using the information in <a href="strms_trouble.htm#g1021339">Chapter 30, &#34;Identifying Problems in an Oracle Streams Environment&#34;</a>.</p>
</li>
<li>
<p>Query the state of the apply process apply servers at the destination database to determine whether they have finished applying changes.</p>
<p>For example, if the name of the apply process is <code dir="ltr">apply_maint</code>, then run the following query at the source database:</p>
<pre dir="ltr">COLUMN STATE HEADING &#39;Apply Server State&#39; FORMAT A20
 
SELECT STATE
  FROM V$STREAMS_APPLY_SERVER@stms.example.com
  WHERE APPLY_NAME = &#39;APPLY_MAINT&#39;;
</pre>
<p>When the state for all apply servers is <code dir="ltr">IDLE</code>, you can proceed to the next step.</p>
</li>
</ol>
</li>
<li>
<p>Connect to the destination database as the Oracle Streams administrator.</p>
</li>
<li id="CIHGFBEE">
<p>Ensure that there are no apply errors by running the following query:</p>
<pre dir="ltr">SELECT COUNT(*) FROM DBA_APPLY_ERROR;
</pre>
<p>If this query returns zero, then move on to the next step. If this query shows errors in the error queue, then resolve these errors before continuing. See <a href="strms_mapply.htm#i1010782">&#34;Managing Apply Errors&#34;</a> for more information.</p>
</li>
<li>
<p>Disconnect all applications and users from the source database.</p>
</li>
<li>
<p>Connect to the source database as an administrative user.</p>
</li>
<li>
<p>Restrict access to the database. For example:</p>
<pre dir="ltr">ALTER SYSTEM ENABLE RESTRICTED SESSION;
</pre></li>
<li>
<p>While connected as an administrative user in SQL*Plus to the source database, repeat the query you ran in Step <a href="#CIHDGDDG">10</a><a href="#DAFFABIF">a</a>. When the two values returned by the query are equal, all of the changes from the source database have been applied at the destination database, and you can move on to the next step.</p>
</li>
<li>
<p>Connect to the destination database as the Oracle Streams administrator.</p>
</li>
<li>
<p>Repeat the query you ran in Step <a href="#CIHGFBEE">12</a>. If this query returns zero, then move on to the next step. If this query shows errors in the error queue, then resolve these errors before continuing. See <a href="strms_mapply.htm#i1010782">&#34;Managing Apply Errors&#34;</a> for more information.</p>
</li>
<li id="CIHDIHDD">
<p>If you performed any actions that created, modified, or deleted job slaves at the source database during the upgrade or maintenance operation, then perform the same actions at the destination database. See <a href="#CIHDAGED">&#34;Considerations for Job Slaves and PL/SQL Package Subprograms&#34;</a> for more information.</p>
</li>
<li id="CIHFJJJJ">
<p>If you invoked any Oracle-supplied PL/SQL package subprograms at the source database during the upgrade or maintenance operation that modified both user data and dictionary metadata at the same time, then invoke the same subprograms at the destination database. See <a href="#CIHDAGED">&#34;Considerations for Job Slaves and PL/SQL Package Subprograms&#34;</a> for more information.</p>
</li>
<li>
<p>Remove the Oracle Streams components that are no longer needed from both databases, including the <code dir="ltr">ANYDATA</code> queues, <a href="strms_glossary.htm#CHDIHHGA"><span class="xrefglossterm">supplemental logging</span></a> specifications, the capture process, the propagation if one exists, and the apply process. Connect as the Oracle Streams administrator in SQL*Plus to the capture database, and run the <a class="olink ARPLS829" href="../ARPLS/d_streams_adm.htm#ARPLS829"><code dir="ltr">CLEANUP_INSTANTIATION_SETUP</code></a> procedure to remove the Oracle Streams components at both databases.</p>
<p>If the capture database is the source database or a third database, then run the following procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.CLEANUP_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.capture_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.capture_q&#39;,
    propagation_name        =&gt; &#39;prop_maint&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.apply_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.apply_q_table&#39;,
    bi_directional          =&gt; FALSE,
    change_global_name      =&gt; TRUE);
END;
/
</pre>
<p>If the capture database is the destination database, then run the following procedure:</p>
<pre dir="ltr">DECLARE
  empty_tbs  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET; 
BEGIN
  DBMS_STREAMS_ADM.CLEANUP_INSTANTIATION_SETUP(
    maintain_mode           =&gt; &#39;GLOBAL&#39;,
    tablespace_names        =&gt; empty_tbs,
    source_database         =&gt; &#39;orcl.example.com&#39;,
    destination_database    =&gt; &#39;stms.example.com&#39;,
    perform_actions         =&gt; TRUE,
    script_name             =&gt; NULL,
    script_directory_object =&gt; NULL,
    capture_name            =&gt; &#39;capture_maint&#39;,
    capture_queue_table     =&gt; &#39;strmadmin.streams_q_table&#39;,
    capture_queue_name      =&gt; &#39;strmadmin.streams_q&#39;,
    apply_name              =&gt; &#39;apply_maint&#39;,
    apply_queue_table       =&gt; &#39;strmadmin.streams_q&#39;,
    apply_queue_name        =&gt; &#39;strmadmin.streams_q_table&#39;,
    bi_directional          =&gt; FALSE,
    change_global_name      =&gt; TRUE);
END;
/
</pre>
<p>Notice that the <code dir="ltr">propagation_name</code> parameter is omitted because a propagation is not necessary when the destination database is the capture database.</p>
<p>Both sample procedures in this step rename the global name of the destination database to <code dir="ltr">orc1.example.com</code> because the <code dir="ltr">change_global_name</code> parameter is set to <code dir="ltr">TRUE</code>.</p>
</li>
<li>
<p>Shut down the source database. This database should not be opened again.</p>
</li>
<li>
<p>At the destination database, enable any jobs that you disabled earlier.</p>
</li>
<li>
<p>Make the destination database available for applications and users. Redirect any applications and users that were connecting to the source database to the destination database. If necessary, reconfigure your network and Oracle Net so that systems that communicated with the source database now communicate with the destination database. See <a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information.</p>
</li>
<li>
<p>If you no longer need the Oracle Streams administrator at the destination database, then connect as an administrative user in SQL*Plus to the destination database, and run the following statement:</p>
<pre dir="ltr">DROP USER strmadmin CASCADE;
</pre></li>
</ol>
<p>The upgrade or maintenance operation is complete.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="appendix" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="ap_xmlschema.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="ap_strup.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>