<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-104467"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20Information%20Provisioning"></a><title>Using Information Provisioning</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1032"/>
<meta name="dcterms.created" content="2014-12-23T13:28:8Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Streams Concepts and Administration"/>
<meta name="dcterms.identifier" content="E53116-02"/>
<meta name="dcterms.isVersionOf" content="STRMS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="strms_glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="strms_ipro.htm" title="Previous" type="text/html"/>
<link rel="Next" href="strms_fgmon.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E53116-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">48/57</span> <!-- End Header -->
<div id="STRMS018" class="chapter"><a id="CHDFDDEF"></a> <a id="CHDIDCDH"></a>
<h1 class="chapter"><span class="secnum">36</span> Using Information Provisioning</h1>
<p><a id="sthref1464"></a>This chapter describes how to use information provisioning. This chapter includes an example that creates a <a href="strms_glossary.htm#CBADBFFB"><span class="xrefglossterm">tablespace repository</span></a>, examples that transfer tablespaces between databases, and an example that uses a <a href="strms_glossary.htm#CBAHHJAD"><span class="xrefglossterm">file group repository</span></a> to store different versions of files.</p>
<p>The following topics describe using information provisioning:</p>
<ul>
<li>
<p><a href="#CHDBCDFD">Using a Tablespace Repository</a></p>
</li>
<li>
<p><a href="#CHDGJIFE">Using a File Group Repository</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="strms_ipro.htm#BHCIEBGD">Chapter 35, &#34;Information Provisioning Concepts&#34;</a></div>
<a id="CHDBCDFD"></a>
<div id="STRMS161" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using a Tablespace Repository<a id="sthref1465"></a><a id="sthref1466"></a><a id="sthref1467"></a><a id="sthref1468"></a><a id="sthref1469"></a></h2>
<p>The following procedures in the <code dir="ltr">DBMS_STREAMS_TABLESPACE_ADM</code> package can create a <a href="strms_glossary.htm#CBADBFFB"><span class="xrefglossterm">tablespace repository</span></a>, add versioned tablespace sets to a tablespace repository, and copy versioned tablespace sets from a tablespace repository:</p>
<ul>
<li>
<p><code dir="ltr">ATTACH_TABLESPACES</code>: This procedure copies a <a href="strms_glossary.htm#CBAEDFHC"><span class="xrefglossterm">version</span></a> of a tablespace set from a tablespace repository and attaches the tablespaces to a database.</p>
</li>
<li>
<p><code dir="ltr">CLONE_TABLESPACES</code>: This procedure adds a new version of a tablespace set to a tablespace repository by copying the tablespace set from a database. The tablespaces in the tablespace set remain part of the database from which they were copied.</p>
</li>
<li>
<p><code dir="ltr">DETACH_TABLESPACES</code>: This procedure adds a new version of a tablespace set to a tablespace repository by moving the tablespace set from a database to the repository. The tablespaces in the tablespace set are dropped from the database from which they were copied.</p>
</li>
</ul>
<p>This section illustrates how to use a tablespace repository with an example scenario. In the scenario, the goal is to run quarterly reports on the sales tablespaces (<code dir="ltr">sales_tbs1</code> and <code dir="ltr">sales_tbs2</code>). Sales are recorded in these tablespaces in the <code dir="ltr">inst1.example.com</code> database. The example clones the tablespaces quarterly and stores a new version of the tablespaces in the tablespace repository. The tablespace repository also resides in the <code dir="ltr">inst1.example.com</code> database. When a specific version of the tablespace set is required to run reports at a reporting database, it is copied from the tablespace repository and attached to the reporting database.</p>
<p>In this example scenario, the following databases are the reporting databases:</p>
<ul>
<li>
<p>The reporting database <code dir="ltr">inst2.example.com</code> shares a file system with the <code dir="ltr">inst1.example.com</code> database. Also, the reports that are run on <code dir="ltr">inst2.example.com</code> might make changes to the tablespace. Therefore, the tablespaces are made read/write at <code dir="ltr">inst2.example.com</code>, and, when the reports are complete, a new version of the tablespace files is stored in a separate directory from the original version of the tablespace files.</p>
</li>
<li>
<p>The reporting system <code dir="ltr">inst3.example.com</code> does not share a file system with the <code dir="ltr">inst1.example.com</code> database. The reports that are run on <code dir="ltr">inst3.example.com</code> do not make any changes to the tablespace. Therefore, the tablespaces remain read-only at <code dir="ltr">inst3.example.com</code>, and, when the reports are complete, the original version of the tablespace files remains in a single directory.</p>
</li>
</ul>
<p>The following sections describe how to create and populate the tablespace repository and how to use the tablespace repository to run reports at the other databases:</p>
<ul>
<li>
<p><a href="#CHDDFHDI">Creating and Populating a Tablespace Repository</a></p>
</li>
<li>
<p><a href="#CHDBJBBA">Using a Tablespace Repository for Remote Reporting with a Shared File System</a></p>
</li>
<li>
<p><a href="#CHDHIBAH">Using a Tablespace Repository for Remote Reporting without a Shared File System</a></p>
</li>
</ul>
<p>These examples must be run by an administrative user with the necessary privileges to run the procedures listed previously.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ARPLS551" href="../ARPLS/d_streams_tbl.htm#ARPLS551"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about these procedures and the privileges required to run them</div>
<a id="CHDDFHDI"></a>
<div id="STRMS1132" class="sect2">
<h3 class="sect2">Creating and Populating a Tablespace Repository<a id="sthref1470"></a></h3>
<p>This example creates a tablespaces repository and adds a new <a href="strms_glossary.htm#CBAEDFHC"><span class="xrefglossterm">version</span></a> of a tablespace set to the repository after each quarter. The tablespace set consists of the sales tablespaces for a business: <code dir="ltr">sales_tbs1</code> and <code dir="ltr">sales_tbs2</code>.</p>
<p><a href="#CHDBEDFG">Figure 36-1</a> provides an overview of the <a href="strms_glossary.htm#CBADBFFB"><span class="xrefglossterm">tablespace repository</span></a> created in this example:</p>
<div id="STRMS1133" class="figure">
<p class="titleinfigure"><a id="CHDBEDFG"></a>Figure 36-1 Example Tablespace Repository</p>
<img width="381" height="387" src="img/strms053.gif" alt="Description of Figure 36-1 follows"/><br/>
<a id="sthref1471" href="img_text/strms053.htm">Description of &#34;Figure 36-1 Example Tablespace Repository&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>The following table shows the tablespace set versions created in this example, their directory objects, and the corresponding file system directory for each directory object.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" title="Versions in the Tablespace Repository" summary="This table lists each version in the tablespace repository and shows the directory object and corresponding file system directory for each version." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t4">Version</th>
<th class="cellalignment5974" id="r1c2-t4">Directory Object</th>
<th class="cellalignment5974" id="r1c3-t4">Corresponding File System Directory</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t4" headers="r1c1-t4"><code dir="ltr">v_q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t4 r1c2-t4"><code dir="ltr">q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t4 r1c3-t4"><code dir="ltr">/home/sales/q1fy2005</code></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t4" headers="r1c1-t4"><code dir="ltr">v_q2fy2005</code></td>
<td class="cellalignment5970" headers="r3c1-t4 r1c2-t4"><code dir="ltr">q2fy2005</code></td>
<td class="cellalignment5970" headers="r3c1-t4 r1c3-t4"><code dir="ltr">/home/sales/q2fy2005</code></td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p>This example makes the following assumptions:</p>
<ul>
<li>
<p>The <code dir="ltr">inst1.example.com</code> database exists.</p>
</li>
<li>
<p>The <code dir="ltr">sales_tbs1</code> and <code dir="ltr">sales_tbs2</code> tablespaces exist in the <code dir="ltr">inst1.example.com</code> database.</p>
</li>
</ul>
<p>The following steps create and populate a tablespace repository:</p>
<ol>
<li>
<p>Connect as an administrative user to the database where the sales tablespaces are modified with new sales data. In this example, connect to the <code dir="ltr">inst1.example.com</code> database.</p>
<p>The administrative user must have the necessary privileges to run the procedures in the <code dir="ltr">DBMS_STREAMS_TABLESPACE_ADM</code> package and must have the necessary privileges to create directory objects.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDFDEDI">
<p>Create a directory object for the first quarter in fiscal year 2005 on <code dir="ltr">inst1.example.com</code>:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q1fy2005 AS &#39;/home/sales/q1fy2005&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li>
<p>Create a directory object that corresponds to the directory that contains the data files for the tablespaces in the <code dir="ltr">inst1.example.com</code> database. For example, if the data files for the tablespaces are in the <code dir="ltr">/orc/inst1/dbs</code> directory, then create a directory object that corresponds to this directory:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY dbfiles_inst1 AS &#39;/orc/inst1/dbs&#39;;
</pre></li>
<li id="CHDGABDC">
<p>Clone the tablespace set and add the first version of the tablespace set to the tablespace repository:</p>
<pre dir="ltr">DECLARE
  tbs_set DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  tbs_set(1) := &#39;sales_tbs1&#39;;
  tbs_set(2) := &#39;sales_tbs2&#39;;
  DBMS_STREAMS_TABLESPACE_ADM.CLONE_TABLESPACES(
    tablespace_names            =&gt; tbs_set,
    tablespace_directory_object =&gt; &#39;q1fy2005&#39;,
    file_group_name             =&gt; &#39;strmadmin.sales&#39;,
    version_name                =&gt; &#39;v_q1fy2005&#39;);
END;
/
</pre>
<p>The <code dir="ltr">sales</code> <a href="strms_glossary.htm#CBACCAEC"><span class="xrefglossterm">file group</span></a> is created automatically if it does not exist.</p>
</li>
<li id="CHDEIBEC">
<p>When the second quarter in fiscal year 2005 is complete, create a directory object for the second quarter in fiscal year 2005:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q2fy2005 AS &#39;/home/sales/q2fy2005&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li id="CHDECEBF">
<p>Clone the tablespace set and add the next version of the tablespace set to the tablespace repository at the <code dir="ltr">inst1.example.com</code> database:</p>
<pre dir="ltr">DECLARE
  tbs_set DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  tbs_set(1) := &#39;sales_tbs1&#39;;
  tbs_set(2) := &#39;sales_tbs2&#39;;
  DBMS_STREAMS_TABLESPACE_ADM.CLONE_TABLESPACES(
    tablespace_names            =&gt; tbs_set,
    tablespace_directory_object =&gt; &#39;q2fy2005&#39;,
    file_group_name             =&gt; &#39;strmadmin.sales&#39;,
    version_name                =&gt; &#39;v_q2fy2005&#39;);
END;
/
</pre></li>
</ol>
<p>Steps <a href="#CHDEIBEC">5</a> and <a href="#CHDECEBF">6</a> can be repeated whenever a quarter ends to store a version of the tablespace set for each quarter. Each time, create a directory object to store the tablespace files for the quarter, and specify a unique version name for the quarter.</p>
</div>
<!-- class="sect2" -->
<a id="CHDBJBBA"></a>
<div id="STRMS1134" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Using a Tablespace Repository for Remote Reporting with a Shared File System<a id="sthref1472"></a></h3>
<p>This example runs reports at <code dir="ltr">inst2.example.com</code> on specific versions of the sales tablespaces stored in a <a href="strms_glossary.htm#CBADBFFB"><span class="xrefglossterm">tablespace repository</span></a> at <code dir="ltr">inst1.example.com</code>. These two databases share a file system, and the reports that are run on <code dir="ltr">inst2.example.com</code> might make changes to the tablespace. Therefore, the tablespaces are made read/write at <code dir="ltr">inst2.example.com</code>. When the reports are complete, a new <a href="strms_glossary.htm#CBAEDFHC"><span class="xrefglossterm">version</span></a> of the tablespace files is stored in a separate directory from the original version of the tablespace files.</p>
<p><a href="#CHDEJJIH">Figure 36-2</a> provides an overview of how tablespaces in a tablespace repository are attached to a different database in this example:</p>
<div id="STRMS1135" class="figure">
<p class="titleinfigure"><a id="CHDEJJIH"></a>Figure 36-2 Attaching Tablespaces with a Shared File System</p>
<img width="443" height="495" src="img/strms054.gif" alt="Description of Figure 36-2 follows"/><br/>
<a id="sthref1473" href="img_text/strms054.htm">Description of &#34;Figure 36-2 Attaching Tablespaces with a Shared File System&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#CHDBGGIA">Figure 36-3</a> provides an overview of how tablespaces are detached and placed in a tablespace repository in this example:</p>
<div id="STRMS1136" class="figure">
<p class="titleinfigure"><a id="CHDBGGIA"></a>Figure 36-3 Detaching Tablespaces with a Shared File System</p>
<img width="381" height="537" src="img/strms055.gif" alt="Description of Figure 36-3 follows"/><br/>
<a id="sthref1474" href="img_text/strms055.htm">Description of &#34;Figure 36-3 Detaching Tablespaces with a Shared File System&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>The following table shows the tablespace set versions in the tablespace repository when this example is complete. It shows the directory object for each version and the corresponding file system directory for each directory object. The versions that are new are created in this example. The versions that existed before this example were created in <a href="#CHDDFHDI">&#34;Creating and Populating a Tablespace Repository&#34;</a>.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" title="Versions in the Tablespace Repository After inst2.net Reporting" summary="This table lists each version in the tablespace repository and shows the directory object and corresponding file system directory for each version." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t5">Version</th>
<th class="cellalignment5974" id="r1c2-t5">Directory Object</th>
<th class="cellalignment5974" id="r1c3-t5">Corresponding File System Directory</th>
<th class="cellalignment5974" id="r1c4-t5">New?</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t5" headers="r1c1-t5"><code dir="ltr">v_q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t5 r1c2-t5"><code dir="ltr">q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t5 r1c3-t5"><code dir="ltr">/home/sales/q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t5 r1c4-t5">No</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t5" headers="r1c1-t5"><code dir="ltr">v_q1fy2005_r</code></td>
<td class="cellalignment5970" headers="r3c1-t5 r1c2-t5"><code dir="ltr">q1fy2005_r</code></td>
<td class="cellalignment5970" headers="r3c1-t5 r1c3-t5"><code dir="ltr">/home/sales/q1fy2005_r</code></td>
<td class="cellalignment5970" headers="r3c1-t5 r1c4-t5">Yes</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t5" headers="r1c1-t5"><code dir="ltr">v_q2fy2005</code></td>
<td class="cellalignment5970" headers="r4c1-t5 r1c2-t5"><code dir="ltr">q2fy2005</code></td>
<td class="cellalignment5970" headers="r4c1-t5 r1c3-t5"><code dir="ltr">/home/sales/q2fy2005</code></td>
<td class="cellalignment5970" headers="r4c1-t5 r1c4-t5">No</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t5" headers="r1c1-t5"><code dir="ltr">v_q2fy2005_r</code></td>
<td class="cellalignment5970" headers="r5c1-t5 r1c2-t5"><code dir="ltr">q2fy2005_r</code></td>
<td class="cellalignment5970" headers="r5c1-t5 r1c3-t5"><code dir="ltr">/home/sales/q2fy2005_r</code></td>
<td class="cellalignment5970" headers="r5c1-t5 r1c4-t5">Yes</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p>This example makes the following assumptions:</p>
<ul>
<li>
<p>The <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst2.example.com</code> databases exist.</p>
</li>
<li>
<p>The <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst2.example.com</code> databases can access a shared file system.</p>
</li>
<li>
<p>Networking is configured between the databases so that these databases can communicate with each other.</p>
</li>
<li>
<p>A tablespace repository that contains a version of the sales tablespaces (<code dir="ltr">sales_tbs1</code> and <code dir="ltr">sales_tbs2</code>) for various quarters exists in the <code dir="ltr">inst1.example.com</code> database. This tablespace repository was created and populated in the example <a href="#CHDDFHDI">&#34;Creating and Populating a Tablespace Repository&#34;</a>.</p>
</li>
</ul>
<p>Complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to <code dir="ltr">inst1.example.com</code> as an administrative user.</p>
<p>The administrative user must have the necessary privileges to create directory objects.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create a directory object that will store the tablespace files for the first quarter in fiscal year 2005 on <code dir="ltr">inst1.example.com</code> after the <code dir="ltr">inst2.example.com</code> database has completed reporting on this quarter:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q1fy2005_r AS &#39;/home/sales/q1fy2005_r&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory objects.</p>
</li>
<li>
<p>Connect to the <code dir="ltr">inst2.example.com</code> database as an administrative user.</p>
<p>The administrative user must have the necessary privileges to run the procedures in the <code dir="ltr">DBMS_STREAMS_TABLESPACE_ADM</code> package, create directory objects, and create database links.</p>
</li>
<li>
<p>Create two directory objects for the first quarter in fiscal year 2005 on <code dir="ltr">inst2.example.com</code>. These directory objects must have the same names and correspond to the same directories on the shared file system as the directory objects used by the tablespace repository in the <code dir="ltr">inst1.example.com</code> database for the first quarter:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q1fy2005 AS &#39;/home/sales/q1fy2005&#39;;

CREATE OR REPLACE DIRECTORY q1fy2005_r AS &#39;/home/sales/q1fy2005_r&#39;;
</pre></li>
<li>
<p>Create a database link from <code dir="ltr">inst2.example.com</code> to the <code dir="ltr">inst1.example.com</code> database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK inst1.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;inst1.example.com&#39;;
</pre></li>
<li>
<p>Attach the tablespace set to the <code dir="ltr">inst2.example.com</code> database from the <code dir="ltr">strmadmin.sales</code> <a href="strms_glossary.htm#CBACCAEC"><span class="xrefglossterm">file group</span></a> in the <code dir="ltr">inst1.example.com</code> database:</p>
<pre dir="ltr">DECLARE
  tbs_set DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  DBMS_STREAMS_TABLESPACE_ADM.ATTACH_TABLESPACES(
    file_group_name            =&gt; &#39;strmadmin.sales&#39;,
    version_name               =&gt; &#39;v_q1fy2005&#39;,
    datafiles_directory_object =&gt; &#39;q1fy2005_r&#39;,
    repository_db_link         =&gt; &#39;inst1.example.com&#39;,
    tablespace_names           =&gt; tbs_set);
END;
/
</pre>
<p>Notice that <code dir="ltr">q1fy2005_r</code> is specified for the <code dir="ltr">datafiles_directory_object</code> parameter. Therefore, the data files for the tablespaces and the export dump file are copied from the <code dir="ltr">/home/sales/q1fy2005</code> location to the <code dir="ltr">/home/sales/q1fy2005_r</code> location by the procedure. The attached tablespaces in the <code dir="ltr">inst2.example.com</code> database use the data files in the <code dir="ltr">/home/sales/q1fy2005_r</code> location. The Data Pump import log file also is placed in this directory.</p>
<p>The attached tablespaces use the data files in the <code dir="ltr">/home/sales/q1fy2005_r</code> location. However, the <code dir="ltr">v_q1fy2005</code> version of the tablespaces in the tablespace repository consists of the files in the original <code dir="ltr">/home/sales/q1fy2005</code> location.</p>
</li>
<li>
<p>Make the tablespaces read/write at <code dir="ltr">inst2.example.com</code>:</p>
<pre dir="ltr">ALTER TABLESPACE sales_tbs1 READ WRITE;

ALTER TABLESPACE sales_tbs2 READ WRITE;
</pre></li>
<li>
<p>Run the reports on the data in the sales tablespaces at the <code dir="ltr">inst2.example.com</code> database. The reports make changes to the tablespaces.</p>
</li>
<li>
<p>Detach the version of the tablespace set for the first quarter of 2005 from the <code dir="ltr">inst2.example.com</code> database:</p>
<pre dir="ltr">DECLARE
  tbs_set  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  tbs_set(1) := &#39;sales_tbs1&#39;;
  tbs_set(2) := &#39;sales_tbs2&#39;;
  DBMS_STREAMS_TABLESPACE_ADM.DETACH_TABLESPACES(
    tablespace_names        =&gt; tbs_set,
    export_directory_object =&gt; &#39;q1fy2005_r&#39;,
    file_group_name         =&gt; &#39;strmadmin.sales&#39;,
    version_name            =&gt; &#39;v_q1fy2005_r&#39;,
    repository_db_link      =&gt; &#39;inst1.example.com&#39;);
END;
/
</pre>
<p>Only one version of a tablespace set can be attached to a database at a time. Therefore, the version of the sales tablespaces for the first quarter of 2005 must be detached from <code dir="ltr">inst2.example.com</code> before the version of this tablespace set for the second quarter of 2005 can be attached.</p>
<p>Also, notice that the specified <code dir="ltr">export_directory_object</code> is <code dir="ltr">q1fy2005_r</code>, and that the <code dir="ltr">version_name</code> is <code dir="ltr">v_q1fy2005_r</code>. After the detach operation, there are two versions of the tablespace files for the first quarter of 2005 stored in the tablespace repository on <code dir="ltr">inst1.example.com</code>: one version of the tablespace before reporting and one version after reporting. These two versions have different version names and are stored in different directory objects.</p>
</li>
<li>
<p>Connect to the <code dir="ltr">inst1.example.com</code> database as an administrative user.</p>
</li>
<li id="CHDHDCAI">
<p>Create a directory object that will store the tablespace files for the second quarter in fiscal year 2005 on <code dir="ltr">inst1.example.com</code> after the <code dir="ltr">inst2.example.com</code> database has completed reporting on this quarter:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q2fy2005_r AS &#39;/home/sales/q2fy2005_r&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li>
<p>Connect to the <code dir="ltr">inst2.example.com</code> database as an administrative user.</p>
</li>
<li>
<p>Create two directory objects for the second quarter in fiscal year 2005 at <code dir="ltr">inst2.example.com</code>. These directory objects must have the same names and correspond to the same directories on the shared file system as the directory objects used by the tablespace repository in the <code dir="ltr">inst1.example.com</code> database for the second quarter:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q2fy2005 AS &#39;/home/sales/q2fy2005&#39;;

CREATE OR REPLACE DIRECTORY q2fy2005_r AS &#39;/home/sales/q2fy2005_r&#39;;
</pre></li>
<li>
<p>Attach the tablespace set for the second quarter of 2005 to the <code dir="ltr">inst2.example.com</code> database from the <code dir="ltr">sales</code> file group in the <code dir="ltr">inst1.example.com</code> database:</p>
<pre dir="ltr">DECLARE
  tbs_set DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  DBMS_STREAMS_TABLESPACE_ADM.ATTACH_TABLESPACES(
    file_group_name            =&gt; &#39;strmadmin.sales&#39;,
    version_name               =&gt; &#39;v_q2fy2005&#39;,
    datafiles_directory_object =&gt; &#39;q2fy2005_r&#39;,
    repository_db_link         =&gt; &#39;inst1.example.com&#39;,
    tablespace_names           =&gt; tbs_set);
END;
/
</pre></li>
<li>
<p>Make the tablespaces read/write at <code dir="ltr">inst2.example.com</code>:</p>
<pre dir="ltr">ALTER TABLESPACE sales_tbs1 READ WRITE;

ALTER TABLESPACE sales_tbs2 READ WRITE;
</pre></li>
<li>
<p>Run the reports on the data in the sales tablespaces at the <code dir="ltr">inst2.example.com</code> database. The reports make changes to the tablespace.</p>
</li>
<li id="CHDFHCAB">
<p>Detach the version of the tablespace set for the second quarter of 2005 from <code dir="ltr">inst2.example.com</code>:</p>
<pre dir="ltr">DECLARE
  tbs_set  DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  tbs_set(1) := &#39;sales_tbs1&#39;;
  tbs_set(2) := &#39;sales_tbs2&#39;;
  DBMS_STREAMS_TABLESPACE_ADM.DETACH_TABLESPACES(
    tablespace_names        =&gt; tbs_set,
    export_directory_object =&gt; &#39;q2fy2005_r&#39;,
    file_group_name         =&gt; &#39;strmadmin.sales&#39;,
    version_name            =&gt; &#39;v_q2fy2005_r&#39;,
    repository_db_link      =&gt; &#39;inst1.example.com&#39;);
END;
/
</pre></li>
</ol>
<p>Steps <a href="#CHDHDCAI">11</a>-<a href="#CHDFHCAB">17</a> can be repeated whenever a quarter ends to run reports on each quarter.</p>
</div>
<!-- class="sect2" -->
<a id="CHDHIBAH"></a>
<div id="STRMS1137" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Using a Tablespace Repository for Remote Reporting without a Shared File System<a id="sthref1475"></a></h3>
<p>This example runs reports at <code dir="ltr">inst3.example.com</code> on specific versions of the sales tablespaces stored in a <a href="strms_glossary.htm#CBADBFFB"><span class="xrefglossterm">tablespace repository</span></a> at <code dir="ltr">inst1.example.com</code>. These two databases do not share a file system, and the reports that are run on <code dir="ltr">inst3.example.com</code> do not make any changes to the tablespace. Therefore, the tablespaces remain read-only at <code dir="ltr">inst3.example.com</code>, and, when the reports are complete, there is no need for a new <a href="strms_glossary.htm#CBAEDFHC"><span class="xrefglossterm">version</span></a> of the tablespace files in the tablespace repository on <code dir="ltr">inst1.example.com</code>.</p>
<p><a href="#CHDJEJDJ">Figure 36-4</a> provides an overview of how tablespaces in a tablespace repository are attached to a different database in this example:</p>
<div id="STRMS1138" class="figure">
<p class="titleinfigure"><a id="CHDJEJDJ"></a>Figure 36-4 Attaching Tablespaces without a Shared File System</p>
<img width="525" height="504" src="img/strms056.gif" alt="Description of Figure 36-4 follows"/><br/>
<a id="sthref1476" href="img_text/strms056.htm">Description of &#34;Figure 36-4 Attaching Tablespaces without a Shared File System&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>The following table shows the directory objects used in this example. It shows the existing directory objects that are associated with tablespace repository versions on the <code dir="ltr">inst1.example.com</code> database, and it shows the new directory objects created on the <code dir="ltr">inst3.example.com</code> database in this example. The directory objects that existed before this example were created in <a href="#CHDDFHDI">&#34;Creating and Populating a Tablespace Repository&#34;</a>.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" title="Directory Objects Used in Example" summary="This table lists each directory object used in this example. The table shows which directory objects are associated with a tablespace repository version and corresponding file system directory for each directory object. It also shows whether the directory object is created in the example (new) or existing." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t6">Directory Object</th>
<th class="cellalignment5974" id="r1c2-t6">Database</th>
<th class="cellalignment5974" id="r1c3-t6">Version</th>
<th class="cellalignment5974" id="r1c4-t6">Corresponding File System Directory</th>
<th class="cellalignment5974" id="r1c5-t6">New?</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t6" headers="r1c1-t6"><code dir="ltr">q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t6 r1c2-t6"><code dir="ltr">inst1.example.com</code></td>
<td class="cellalignment5970" headers="r2c1-t6 r1c3-t6"><code dir="ltr">v_q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t6 r1c4-t6"><code dir="ltr">/home/sales/q1fy2005</code></td>
<td class="cellalignment5970" headers="r2c1-t6 r1c5-t6">No</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t6" headers="r1c1-t6"><code dir="ltr">q2fy2005</code></td>
<td class="cellalignment5970" headers="r3c1-t6 r1c2-t6"><code dir="ltr">inst1.example.com</code></td>
<td class="cellalignment5970" headers="r3c1-t6 r1c3-t6"><code dir="ltr">v_q2fy2005</code></td>
<td class="cellalignment5970" headers="r3c1-t6 r1c4-t6"><code dir="ltr">/home/sales/q2fy2005</code></td>
<td class="cellalignment5970" headers="r3c1-t6 r1c5-t6">No</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t6" headers="r1c1-t6"><code dir="ltr">q1fy2005</code></td>
<td class="cellalignment5970" headers="r4c1-t6 r1c2-t6"><code dir="ltr">inst3.example.com</code></td>
<td class="cellalignment5970" headers="r4c1-t6 r1c3-t6">Not associated with a tablespace repository version</td>
<td class="cellalignment5970" headers="r4c1-t6 r1c4-t6"><code dir="ltr">/usr/sales_data/fy2005q1</code></td>
<td class="cellalignment5970" headers="r4c1-t6 r1c5-t6">Yes</td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r5c1-t6" headers="r1c1-t6"><code dir="ltr">q2fy2005</code></td>
<td class="cellalignment5970" headers="r5c1-t6 r1c2-t6"><code dir="ltr">inst3.example.com</code></td>
<td class="cellalignment5970" headers="r5c1-t6 r1c3-t6">Not associated with a tablespace repository version</td>
<td class="cellalignment5970" headers="r5c1-t6 r1c4-t6"><code dir="ltr">/usr/sales_data/fy2005q2</code></td>
<td class="cellalignment5970" headers="r5c1-t6 r1c5-t6">Yes</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p>This example makes the following assumptions:</p>
<ul>
<li>
<p>The <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst3.example.com</code> databases exist.</p>
</li>
<li>
<p>The <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst3.example.com</code> databases do not share a file system.</p>
</li>
<li>
<p>Networking is configured between the databases so that they can communicate with each other.</p>
</li>
<li>
<p>The sales tablespaces (<code dir="ltr">sales_tbs1</code> and <code dir="ltr">sales_tbs2</code>) exist in the <code dir="ltr">inst1.example.com</code> database.</p>
</li>
</ul>
<p>Complete the following steps:</p>
<ol>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">inst3.example.com</code> database as an administrative user.</p>
<p>The administrative user must have the necessary privileges to run the procedures in the <code dir="ltr">DBMS_STREAMS_TABLESPACE_ADM</code> package, create directory objects, and create database links.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li>
<p>Create a database link from <code dir="ltr">inst3.example.com</code> to the <code dir="ltr">inst1.example.com</code> database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK inst1.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;inst1.example.com&#39;;
</pre></li>
<li>
<p>Create a directory object for the first quarter in fiscal year 2005 on <code dir="ltr">inst3.example.com</code>. Although <code dir="ltr">inst3.example.com</code> is a remote database that does not share a file system with <code dir="ltr">inst1.example.com</code>, the directory object must have the same name as the directory object used by the tablespace repository in the <code dir="ltr">inst1.example.com</code> database for the first quarter. However, the directory paths of the directory objects on <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst3.example.com</code> do not need to match.</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q1fy2005 AS &#39;/usr/sales_data/fy2005q1&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li>
<p>Connect to the <code dir="ltr">inst1.example.com</code> database as an administrative user.</p>
<p>The administrative user must have the necessary privileges to run the procedures in the <code dir="ltr">DBMS_FILE_TRANSFER</code> package and create database links. This example uses the <code dir="ltr">DBMS_FILE_TRANSFER</code> package to copy the tablespace files from <code dir="ltr">inst1.example.com</code> to <code dir="ltr">inst3.example.com</code>. If some other method is used to transfer the files, then the privileges to run the procedures in the <code dir="ltr">DBMS_FILE_TRANSFER</code> package are not required.</p>
</li>
<li>
<p>Create a database link from <code dir="ltr">inst1.example.com</code> to the <code dir="ltr">inst3.example.com</code> database. For example:</p>
<pre dir="ltr">CREATE DATABASE LINK inst3.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;inst3.example.com&#39;;
</pre>
<p>This database link will be used to transfer files to the <code dir="ltr">inst3.example.com</code> database in Step&nbsp;<a href="#CHDIHBEB">6</a>.</p>
</li>
<li id="CHDIHBEB">
<p>Copy the data file for each tablespace and the export dump file for the first quarter to the <code dir="ltr">inst3.example.com</code> database:</p>
<pre dir="ltr">BEGIN
  DBMS_FILE_TRANSFER.PUT_FILE(
    source_directory_object      =&gt; &#39;q1fy2005&#39;,
    source_file_name             =&gt; &#39;sales_tbs1.dbf&#39;,
    destination_directory_object =&gt; &#39;q1fy2005&#39;,
    destination_file_name        =&gt; &#39;sales_tbs1.dbf&#39;,
    destination_database         =&gt; &#39;inst3.example.com&#39;);
  DBMS_FILE_TRANSFER.PUT_FILE(
    source_directory_object      =&gt; &#39;q1fy2005&#39;,
    source_file_name             =&gt; &#39;sales_tbs2.dbf&#39;,
    destination_directory_object =&gt; &#39;q1fy2005&#39;,
    destination_file_name        =&gt; &#39;sales_tbs2.dbf&#39;,
    destination_database         =&gt; &#39;inst3.example.com&#39;);
  DBMS_FILE_TRANSFER.PUT_FILE(
    source_directory_object      =&gt; &#39;q1fy2005&#39;,
    source_file_name             =&gt; &#39;expdat16.dmp&#39;,
    destination_directory_object =&gt; &#39;q1fy2005&#39;,
    destination_file_name        =&gt; &#39;expdat16.dmp&#39;,
    destination_database         =&gt; &#39;inst3.example.com&#39;);
END;
/
</pre>
<p>Before you run the <code dir="ltr">PUT_FILE</code> procedure for the export dump file, you can query the <code dir="ltr">DBA_FILE_GROUP_FILES</code> data dictionary view to determine the name and directory object of the export dump file. For example, run the following query to list this information for the export dump file in the <code dir="ltr">v_q1fy2005</code> version:</p>
<pre dir="ltr">COLUMN FILE_NAME HEADING &#39;Export Dump|File Name&#39; FORMAT A35
COLUMN FILE_DIRECTORY HEADING &#39;Directory Object&#39; FORMAT A35

SELECT FILE_NAME, FILE_DIRECTORY FROM DBA_FILE_GROUP_FILES
  where FILE_GROUP_NAME = &#39;SALES&#39; AND
        VERSION_NAME    = &#39;V_Q1FY2005&#39;;
</pre></li>
<li>
<p>Connect to the <code dir="ltr">inst3.example.com</code> database as an administrative user.</p>
</li>
<li>
<p>Attach the tablespace set for the first quarter of 2005 to the <code dir="ltr">inst3.example.com</code> database from the <code dir="ltr">sales</code> file group in the <code dir="ltr">inst1.example.com</code> database:</p>
<pre dir="ltr">DECLARE
  tbs_set DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  DBMS_STREAMS_TABLESPACE_ADM.ATTACH_TABLESPACES(
    file_group_name            =&gt; &#39;strmadmin.sales&#39;,
    version_name               =&gt; &#39;v_q1fy2005&#39;,
    datafiles_directory_object =&gt; &#39;q1fy2005&#39;,
    repository_db_link         =&gt; &#39;inst1.example.com&#39;,
    tablespace_names           =&gt; tbs_set);
END;
/
</pre>
<p>The tablespaces are read-only when they are attached. Because the reports on <code dir="ltr">inst3.example.com</code> do not change the tablespaces, the tablespaces can remain read-only.</p>
</li>
<li>
<p>Run the reports on the data in the sales tablespaces at the <code dir="ltr">inst3.example.com</code> database.</p>
</li>
<li>
<p>Drop the tablespaces and their contents at <code dir="ltr">inst3.example.com</code>:</p>
<pre dir="ltr">DROP TABLESPACE sales_tbs1 INCLUDING CONTENTS;

DROP TABLESPACE sales_tbs2 INCLUDING CONTENTS;
</pre>
<p>The tablespaces are dropped from the <code dir="ltr">inst3.example.com</code> database, but the tablespace files remain in the directory object.</p>
</li>
<li id="CHDDAIBF">
<p>Create a directory object for the second quarter in fiscal year 2005 on <code dir="ltr">inst3.example.com</code>. The directory object must have the same name as the directory object used by the tablespace repository in the <code dir="ltr">inst1.example.com</code> database for the second quarter. However, the directory paths of the directory objects on <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst3.example.com</code> do not need to match.</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY q2fy2005 AS &#39;/usr/sales_data/fy2005q2&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li>
<p>Connect to the <code dir="ltr">inst1.example.com</code> database as an administrative user.</p>
</li>
<li>
<p>Copy the data file and the export dump file for the second quarter to the <code dir="ltr">inst3.example.com</code> database:</p>
<pre dir="ltr">BEGIN
  DBMS_FILE_TRANSFER.PUT_FILE(
    source_directory_object      =&gt; &#39;q2fy2005&#39;,
    source_file_name             =&gt; &#39;sales_tbs1.dbf&#39;,
    destination_directory_object =&gt; &#39;q2fy2005&#39;,
    destination_file_name        =&gt; &#39;sales_tbs1.dbf&#39;,
    destination_database         =&gt; &#39;inst3.example.com&#39;);
  DBMS_FILE_TRANSFER.PUT_FILE(
    source_directory_object      =&gt; &#39;q2fy2005&#39;,
    source_file_name             =&gt; &#39;sales_tbs2.dbf&#39;,
    destination_directory_object =&gt; &#39;q2fy2005&#39;,
    destination_file_name        =&gt; &#39;sales_tbs2.dbf&#39;,
    destination_database         =&gt; &#39;inst3.example.com&#39;);
  DBMS_FILE_TRANSFER.PUT_FILE(
    source_directory_object      =&gt; &#39;q2fy2005&#39;,
    source_file_name             =&gt; &#39;expdat18.dmp&#39;,
    destination_directory_object =&gt; &#39;q2fy2005&#39;,
    destination_file_name        =&gt; &#39;expdat18.dmp&#39;,
    destination_database         =&gt; &#39;inst3.example.com&#39;);
END;
/
</pre>
<p>Before you run the <code dir="ltr">PUT_FILE</code> procedure for the export dump file, you can query the <code dir="ltr">DBA_FILE_GROUP_FILES</code> data dictionary view to determine the name and directory object of the export dump file. For example, run the following query to list this information for the export dump file in the <code dir="ltr">v_q2fy2005</code> version:</p>
<pre dir="ltr">COLUMN FILE_NAME HEADING &#39;Export Dump|File Name&#39; FORMAT A35
COLUMN FILE_DIRECTORY HEADING &#39;Directory Object&#39; FORMAT A35

SELECT FILE_NAME, FILE_DIRECTORY FROM DBA_FILE_GROUP_FILES
  where FILE_GROUP_NAME = &#39;SALES&#39; AND
        VERSION_NAME    = &#39;V_Q2FY2005&#39;;
</pre></li>
<li>
<p>Connect to the <code dir="ltr">inst3.example.com</code> database as an administrative user.</p>
</li>
<li>
<p>Attach the tablespace set for the second quarter of 2005 to the <code dir="ltr">inst3.example.com</code> database from the <code dir="ltr">sales</code> <a href="strms_glossary.htm#CBACCAEC"><span class="xrefglossterm">file group</span></a> in the <code dir="ltr">inst1.example.com</code> database:</p>
<pre dir="ltr">DECLARE
  tbs_set DBMS_STREAMS_TABLESPACE_ADM.TABLESPACE_SET;
BEGIN
  DBMS_STREAMS_TABLESPACE_ADM.ATTACH_TABLESPACES(
    file_group_name            =&gt; &#39;strmadmin.sales&#39;,
    version_name               =&gt; &#39;v_q2fy2005&#39;,
    datafiles_directory_object =&gt; &#39;q2fy2005&#39;,
    repository_db_link         =&gt; &#39;inst1.example.com&#39;,
    tablespace_names           =&gt; tbs_set);
END;
/
</pre>
<p>The tablespaces are read-only when they are attached. Because the reports on <code dir="ltr">inst3.example.com</code> do not change the tablespace, the tablespaces can remain read-only.</p>
</li>
<li>
<p>Run the reports on the data in the sales tablespaces at the <code dir="ltr">inst3.example.com</code> database.</p>
</li>
<li id="CHDBDDJB">
<p>Drop the tablespaces and their contents:</p>
<pre dir="ltr">DROP TABLESPACE sales_tbs1 INCLUDING CONTENTS;

DROP TABLESPACE sales_tbs2 INCLUDING CONTENTS;
</pre>
<p>The tablespaces are dropped from the <code dir="ltr">inst3.example.com</code> database, but the tablespace files remain in the directory object.</p>
</li>
</ol>
<p>Steps <a href="#CHDDAIBF">11</a>-<a href="#CHDBDDJB">17</a> can be repeated whenever a quarter ends to run reports on each quarter.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGJIFE"></a>
<div id="STRMS162" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using a File Group Repository<a id="sthref1477"></a></h2>
<p>The <code dir="ltr">DBMS_FILE_GROUP</code> package can create a <a href="strms_glossary.htm#CBAHHJAD"><span class="xrefglossterm">file group repository</span></a>, add versioned <a href="strms_glossary.htm#CBACCAEC"><span class="xrefglossterm">file group</span></a>s to the repository, and copy versioned file groups from the repository. This section illustrates how to use a file group repository with a scenario that stores reports in the repository.</p>
<p>In this scenario, a business sells books and music over the internet. The business runs weekly reports on the sales data in the <code dir="ltr">inst1.example.com</code> database and stores these reports in two HTML files on a computer file system. The <code dir="ltr">book_sales.htm</code> file contains the report for book sales, and the <code dir="ltr">music_sales.htm</code> file contains the report for music sales. The business wants to store these weekly reports in a file group repository at the <code dir="ltr">inst2.example.com</code> remote database. Every week, the two reports are generated on the <code dir="ltr">inst1.example.com</code> database, transferred to the computer system running the <code dir="ltr">inst2.example.com</code> database, and added to the repository as a file group <a href="strms_glossary.htm#CBAEDFHC"><span class="xrefglossterm">version</span></a>. The file group repository stores all of the file group versions that contain the reports for each week.</p>
<p><a href="#CHDBIHFG">Figure 36-5</a> provides an overview of the file group repository created in this example:</p>
<div id="STRMS1139" class="figure">
<p class="titleinfigure"><a id="CHDBIHFG"></a>Figure 36-5 Example File Group Repository</p>
<img width="381" height="515" src="img/strms057.gif" alt="Description of Figure 36-5 follows"/><br/>
<a id="sthref1478" href="img_text/strms057.htm">Description of &#34;Figure 36-5 Example File Group Repository&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>The benefits of the file group repository are that it stores metadata about each file group version in the data dictionary and provides a standard interface for managing the file group versions. For example, when the business must view a specific sales report, it can query the data dictionary in the <code dir="ltr">inst2.example.com</code> database to determine the location of the report on the computer file system.</p>
<p>The following table shows the directory objects created in this example. It shows the directory object created on the <code dir="ltr">inst1.example.com</code> database to store new reports, and it shows the directory objects that are associated with file group repository versions on the <code dir="ltr">inst2.example.com</code> database.</p>
<div class="inftblhruleinformalwide">
<table class="cellalignment5973" title="Directory Objects Created in Example" summary="This table lists each directory object created in this example. The table shows which directory objects are associated with a file group repository version and corresponding file system directory for each directory object." dir="ltr">
<thead>
<tr class="cellalignment5964">
<th class="cellalignment5974" id="r1c1-t7">Directory Object</th>
<th class="cellalignment5974" id="r1c2-t7">Database</th>
<th class="cellalignment5974" id="r1c3-t7">Version</th>
<th class="cellalignment5974" id="r1c4-t7">Corresponding File System Directory</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r2c1-t7" headers="r1c1-t7"><code dir="ltr">sales_reports</code></td>
<td class="cellalignment5970" headers="r2c1-t7 r1c2-t7"><code dir="ltr">inst1.example.com</code></td>
<td class="cellalignment5970" headers="r2c1-t7 r1c3-t7">Not associated with a file group repository version</td>
<td class="cellalignment5970" headers="r2c1-t7 r1c4-t7"><code dir="ltr">/home/sales_reports</code></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r3c1-t7" headers="r1c1-t7"><code dir="ltr">sales_reports1</code></td>
<td class="cellalignment5970" headers="r3c1-t7 r1c2-t7"><code dir="ltr">inst2.example.com</code></td>
<td class="cellalignment5970" headers="r3c1-t7 r1c3-t7"><code dir="ltr">sales_reports_v1</code></td>
<td class="cellalignment5970" headers="r3c1-t7 r1c4-t7"><code dir="ltr">/home/sales_reports/fg1</code></td>
</tr>
<tr class="cellalignment5964">
<td class="cellalignment5970" id="r4c1-t7" headers="r1c1-t7"><code dir="ltr">sales_reports2</code></td>
<td class="cellalignment5970" headers="r4c1-t7 r1c2-t7"><code dir="ltr">inst2.example.com</code></td>
<td class="cellalignment5970" headers="r4c1-t7 r1c3-t7"><code dir="ltr">sales_reports_v1</code></td>
<td class="cellalignment5970" headers="r4c1-t7 r1c4-t7"><code dir="ltr">/home/sales_reports/fg2</code></td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblhruleinformalwide" -->
<p>This example makes the following assumptions:</p>
<ul>
<li>
<p>The <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst2.example.com</code> databases exist.</p>
</li>
<li>
<p>The <code dir="ltr">inst1.example.com</code> and <code dir="ltr">inst2.example.com</code> databases do not share a file system.</p>
</li>
<li>
<p>Networking is configured between the databases so that they can communicate with each other.</p>
</li>
<li>
<p>The <code dir="ltr">inst1.example.com</code> database runs reports on the books and music sales data in the database and stores the reports as HTML files on the computer file system.</p>
</li>
</ul>
<p>The following steps configure and populate a file group repository at a remote database:</p>
<ol>
<li>
<p>Connect as an administrative user to the remote database that will contain the file group repository. In this example, connect to the <code dir="ltr">inst2.example.com</code> database.</p>
<p>The administrative user must have the necessary privileges to create directory objects and run the procedures in the <code dir="ltr">DBMS_FILE_GROUP</code> package.</p>
<p>See <a class="olink ADMIN00102" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about connecting to a database in SQL*Plus.</p>
</li>
<li id="CHDDFEEH">
<p>Create a directory object to hold the first version of the file group:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY sales_reports1 AS &#39;/home/sales_reports/fg1&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li>
<p>Connect as an administrative user to the database that runs the reports. In this example, connect to the <code dir="ltr">inst1.example.com</code> database.</p>
<p>The administrative user must have the necessary privileges to create directory objects.</p>
</li>
<li id="CHDIFDDF">
<p>Create a directory object to hold the latest reports:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY sales_reports AS &#39;/home/sales_reports&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li>
<p>Create a database link to the <code dir="ltr">inst2.example.com</code> database:</p>
<pre dir="ltr">CREATE DATABASE LINK inst2.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING &#39;inst2.example.com&#39;;
</pre></li>
<li>
<p>Run the reports on the <code dir="ltr">inst1.example.com</code> database. Running the reports should place the <code dir="ltr">book_sales.htm</code> and <code dir="ltr">music_sales.htm</code> files in the directory specified in Step&nbsp;<a href="#CHDIFDDF">4</a>.</p>
</li>
<li>
<p>Transfer the report files from the computer system running the <code dir="ltr">inst1.example.com</code> database to the computer system running the <code dir="ltr">inst2.example.com</code> database using file transfer protocol (FTP) or some other method. Ensure that the files are copied to the directory that corresponds to the directory object created in Step <a href="#CHDDFEEH">2</a>.</p>
</li>
<li>
<p>Connect as an administrative user to the remote database that will contain the file group repository. In this example, connect to the <code dir="ltr">inst2.example.com</code> database.</p>
</li>
<li>
<p>Create the file group repository that will contain the reports:</p>
<pre dir="ltr">BEGIN
  DBMS_FILE_GROUP.CREATE_FILE_GROUP(
    file_group_name =&gt; &#39;strmadmin.reports&#39;);
END;
/
</pre>
<p>The <code dir="ltr">reports</code> file group repository is created with the following default properties:</p>
<ul>
<li>
<p>The minimum number of versions in the repository is 2. When the file group is purged, the number of versions cannot drop below 2.</p>
</li>
<li>
<p>The maximum number of versions is infinite. A file group version is not purged because of the number of versions in the file group in the repository.</p>
</li>
<li>
<p>The retention days is infinite. A file group version is not purged because of the amount of time it has been in the repository.</p>
</li>
</ul>
</li>
<li>
<p>Create the first version of the file group:</p>
<pre dir="ltr">BEGIN
  DBMS_FILE_GROUP.CREATE_VERSION(
    file_group_name =&gt; &#39;strmadmin.reports&#39;,
    version_name    =&gt; &#39;sales_reports_v1&#39;,
    comments        =&gt; &#39;Sales reports for week of 06-FEB-2005&#39;);
END;
/
</pre></li>
<li>
<p>Add the report files to the file group version:</p>
<pre dir="ltr">BEGIN
 DBMS_FILE_GROUP.ADD_FILE(
    file_group_name  =&gt; &#39;strmadmin.reports&#39;,
    file_name        =&gt; &#39;book_sales.htm&#39;,
    file_type        =&gt; &#39;HTML&#39;,
    file_directory   =&gt; &#39;sales_reports1&#39;,
    version_name     =&gt; &#39;sales_reports_v1&#39;);
 DBMS_FILE_GROUP.ADD_FILE(
    file_group_name  =&gt; &#39;strmadmin.reports&#39;,
    file_name        =&gt; &#39;music_sales.htm&#39;,
    file_type        =&gt; &#39;HTML&#39;,
    file_directory   =&gt; &#39;sales_reports1&#39;,
    version_name     =&gt; &#39;sales_reports_v1&#39;);
END;
/
</pre></li>
<li id="CHDGGIGF">
<p>Create a directory object on <code dir="ltr">inst2.example.com</code> to hold the next version of the file group:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY sales_reports2 AS &#39;/home/sales_reports/fg2&#39;;
</pre>
<p>The specified file system directory must exist when you create the directory object.</p>
</li>
<li>
<p>At the end of the next week, run the reports on the <code dir="ltr">inst1.example.com</code> database. Running the reports should place new <code dir="ltr">book_sales.htm</code> and <code dir="ltr">music_sales.htm</code> files in the directory specified in Step <a href="#CHDIFDDF">4</a>. If necessary, remove the old files from this directory before running the reports.</p>
</li>
<li>
<p>Transfer the report files from the computer system running the <code dir="ltr">inst1.example.com</code> database to the computer system running the <code dir="ltr">inst2.example.com</code> database using file transfer protocol (FTP) or some other method. Ensure that the files are copied to the directory that corresponds to the directory object created in Step <a href="#CHDGGIGF">12</a>.</p>
</li>
<li>
<p>In SQL*Plus, connect to the <code dir="ltr">inst2.example.com</code> database as an administrative user.</p>
</li>
<li>
<p>Create the next version of the file group:</p>
<pre dir="ltr">BEGIN
  DBMS_FILE_GROUP.CREATE_VERSION(
    file_group_name =&gt; &#39;strmadmin.reports&#39;,
    version_name    =&gt; &#39;sales_reports_v2&#39;,
    comments        =&gt; &#39;Sales reports for week of 13-FEB-2005&#39;);
END;
/
</pre></li>
<li id="CHDBECFE">
<p>Add the report files to the file group version:</p>
<pre dir="ltr">BEGIN
 DBMS_FILE_GROUP.ADD_FILE(
    file_group_name  =&gt; &#39;strmadmin.reports&#39;,
    file_name        =&gt; &#39;book_sales.htm&#39;,
    file_type        =&gt; &#39;HTML&#39;,
    file_directory   =&gt; &#39;sales_reports2&#39;,
    version_name     =&gt; &#39;sales_reports_v2&#39;);
 DBMS_FILE_GROUP.ADD_FILE(
    file_group_name  =&gt; &#39;strmadmin.reports&#39;,
    file_name        =&gt; &#39;music_sales.htm&#39;,
    file_type        =&gt; &#39;HTML&#39;,
    file_directory   =&gt; &#39;sales_reports2&#39;,
    version_name     =&gt; &#39;sales_reports_v2&#39;);
END;
/
</pre></li>
</ol>
<p>The file group repository now contains two versions of the file group that contains the sales report files. Repeat steps <a href="#CHDGGIGF">12</a>-<a href="#CHDBECFE">17</a> to add new versions of the file group to the repository.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="strms_ipro.htm#BHCGGGEE">&#34;File Group Repository&#34;</a></p>
</li>
<li>
<p><a class="olink ARPLS828" href="../ARPLS/d_filgrp.htm#ARPLS828"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code dir="ltr">DBMS_FILE_GROUP</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5963">
<tr>
<td class="cellalignment5970">
<table class="cellalignment5968">
<tr>
<td class="cellalignment5967"><a href="strms_ipro.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5967"><a href="strms_fgmon.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5972">
<table class="cellalignment5966">
<tr>
<td class="cellalignment5967"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5967"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5967"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5967"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5967"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5967"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>