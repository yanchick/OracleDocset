<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-4711"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Agents%20in%20Oracle%20Clusterware"></a><title>Agents in Oracle Clusterware</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-07-14T14:47:18Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Clusterware Administration and Deployment Guide"/>
<meta name="dcterms.identifier" content="E48819-11"/>
<meta name="dcterms.isVersionOf" content="CWADD"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2007, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-30DC08E5-72CE-4E93-B6D6-E209DEADF83E.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-10286938-B9BA-4C98-80C7-1EE98F3463D7.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E48819-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C"></a> <span id="PAGE" style="display:none;">190/713</span> <!-- End Header -->
<a id="CWADD92083"></a><a id="CWADD92082"></a>
<h1 id="CWADD-GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C" class="sect1">Agents in Oracle Clusterware</h1>
<div>
<div class="section">
<p>Oracle Clusterware manages applications when they are registered as resources with Oracle Clusterware. Oracle Clusterware has access to application-specific primitives that have the ability to start, stop, and monitor a specific resource. Oracle Clusterware runs all resource-specific commands through an entity called an <a id="d45366e101" class="indexterm-anchor"></a><span class="italic">agent</span>.</p>
<p>An agent is a process that contains the agent framework and user code to manage resources. The <a id="d45366e110" class="indexterm-anchor"></a><span class="italic">agent framework</span> is a library that enables you to plug in your application-specific code to manage customized applications. You program all of the actual application management functions, such as starting, stopping and checking the health of an application, into the agent. These functions are referred to as <a id="d45366e117" class="indexterm-anchor"></a><span class="italic">entry points</span>.</p>
<p>The agent framework is responsible for invoking these entry point functions on behalf of Oracle Clusterware. Agent developers can use these entry points to plug in the required functionality for a specific resource regarding how to start, stop, and monitor a resource. Agents are capable of managing multiple resources.</p>
<p>Agent developers can set the following entry points as callbacks to their code:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="bold">ABORT</span>: If <a id="d45366e134" class="indexterm-anchor"></a>any of the other entry points hang, the agent framework calls the ABORT entry point to stop the ongoing action. If the agent developer does not supply a stop function, then the agent framework exits the agent program.</p>
</li>
<li>
<p><span class="bold">ACTION</span>: The <a id="d45366e144" class="indexterm-anchor"></a>ACTION entry point is Invoked when a custom action is invoked using the <code class="codeph"><a href="GUID-80DDB316-39C6-4319-819E-45D6E82AAF96.htm#GUID-80DDB316-39C6-4319-819E-45D6E82AAF96">clscrs_request_action</a></code> API of the <code class="codeph">crsctl request action</code> command.</p>
</li>
<li>
<p><span class="bold">CHECK</span>: The <a id="d45366e162" class="indexterm-anchor"></a><a id="d45366e166" class="indexterm-anchor"></a>CHECK (monitor) entry point acts to monitor the health of a resource. The agent framework periodically calls this entry point. If it notices any state change during this action, then the agent framework notifies Oracle Clusterware about the change in the state of the specific resource.</p>
</li>
<li>
<p><span class="bold">CLEAN</span>: The <a id="d45366e176" class="indexterm-anchor"></a>CLEAN entry point acts whenever there is a need to clean up a resource. It is a non-graceful operation that is invoked when users must forcefully terminate a resource. This command cleans up the resource-specific environment so that the resource can be restarted.</p>
</li>
<li>
<p><span class="bold">DELETE</span>: The <a id="d45366e186" class="indexterm-anchor"></a>DELETE entry point is invoked on every node where a resource can run when the resource is unregistered.</p>
</li>
<li>
<p><span class="bold">MODIFY</span>: The <a id="d45366e196" class="indexterm-anchor"></a>MODIFY entry point is invoked on every node where a resource can run when the resource profile is modified.</p>
</li>
<li>
<p><span class="bold">START</span>: The START <a id="d45366e206" class="indexterm-anchor"></a>entry point acts to bring a resource online. The agent framework calls this entry point whenever it receives the start command from Oracle Clusterware.</p>
</li>
<li>
<p><span class="bold">STOP</span>: The <a id="d45366e216" class="indexterm-anchor"></a>STOP entry points acts to gracefully bring down a resource. The agent framework calls this entry point whenever it receives the stop command from Oracle Clusterware.</p>
</li>
</ul>
<p>START, STOP, CHECK, and CLEAN are mandatory entry points and the agent developer must provide these entry points when building an agent. Agent developers have several options to implement these entry points, including using C, C++, or scripts. It is also possible to develop agents that use both C or C++ and script-type entry points. When initializing the agent framework, if any of the mandatory entry points are not provided, then the agent framework invokes a script pointed to by the <code class="codeph">ACTION_SCRIPT</code> resource attribute.</p>
<div class="infoboxnotealso" id="GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C__GUID-0A249B97-D71E-4746-82A9-494BF1EF2965">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="GUID-018BCDB1-862F-4F03-9D8A-E6F2522BE73D.htm">ACTION_SCRIPT</a>&#34;</span> for information about this resource attribute</p>
</div>
<p>At any given time, the agent framework invokes only one entry point per application. If that entry point hangs, then the agent framework calls the ABORT entry point to end the current operation. The agent framework periodically invokes the CHECK entry point to determine the state of the resource. This entry point must return one of the following states as the resource state:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">CLSAGFW_ONLINE</code>: The CHECK <a id="d45366e241" class="indexterm-anchor"></a>entry point returns ONLINE if the resource was brought up successfully and is currently in a functioning state. The agent framework continues to monitor the resource when it is in this state. This state has a numeric value of 0 for the <code class="codeph">scriptagent</code>.</p>
</li>
<li>
<p><code class="codeph">CLSAGFW_UNPLANNED_OFFLINE</code> and <code class="codeph">CLSAGFW_PLANNED_OFFLINE</code>: The <a id="d45366e259" class="indexterm-anchor"></a><a id="d45366e265" class="indexterm-anchor"></a>OFFLINE state indicates that the resource is not currently running. These two states have numeric values of 1 and 2, respectively, for the <code class="codeph">scriptagent</code>.</p>
<p>Two distinct categories exist to describe an resource&#39;s offline state: <span class="italic">planned</span> and <span class="italic">unplanned</span>.</p>
<p>When the state of the resource transitions to OFFLINE through Oracle Clusterware, then it is assumed that the <span class="italic">intent</span> for this resource is to be offline (<code class="codeph">TARGET=OFFLINE</code>), regardless of which value is returned from the CHECK entry point. However, when an agent detects that the state of a resource has changed independent of Oracle Clusterware (such as somebody stopping the resource through a non-Oracle interface), then the intent must be carried over from the agent to the Cluster Ready Services daemon (CRSD). The intent then becomes the determining factor for the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Whether to keep or to change the value of the resource&#39;s <code class="codeph">TARGET</code> resource attribute. <code class="codeph">PLANNED_OFFLINE</code> indicates that the <code class="codeph">TARGET</code> resource attribute must be changed to OFFLINE <span class="italic">only if</span> the resource was running before. If the resource was not running (<code class="codeph">STATE=OFFLINE</code>, <code class="codeph">TARGET=OFFLINE</code>) and a request comes in to start it, then the value of the <code class="codeph">TARGET</code> resource attribute changes to ONLINE. The start request then goes to the agent and the agent reports back to Oracle Clusterware a <code class="codeph">PLANNED_OFFLINE</code> resource state, and the value of the <code class="codeph">TARGET</code> resource attribute remains ONLINE. <code class="codeph">UNPLANNED_OFFLINE</code> does not change the <code class="codeph">TARGET</code> attribute.</p>
</li>
<li>
<p>Whether to leave the resource&#39;s state as <code class="codeph">UNPLANNED_OFFLINE</code> or attempt to recover the resource by restarting it locally or failing it over to a another server in the cluster. The <code class="codeph">PLANNED_OFFLINE</code> state makes CRSD leave the resource as is, whereas the <code class="codeph">UNPLANNED_OFFLINE</code> state prompts resource recovery.</p>
</li>
</ul>
</li>
<li>
<p><code class="codeph">CLSAGFW_UNKNOWN</code>: The CHECK entry point returns <a id="d45366e346" class="indexterm-anchor"></a>UNKNOWN if the current state of the resource cannot be determined. In response to this state, Oracle Clusterware does not attempt to failover or to restart the resource. The agent framework continues to monitor the resource if the previous state of the resource was either ONLINE or PARTIAL. This state has a numeric value of 3 for the <code class="codeph">scriptagent</code>.</p>
</li>
<li>
<p><code class="codeph">CLSAGFW_PARTIAL</code>: The CHECK entry point returns <a id="d45366e361" class="indexterm-anchor"></a>PARTIAL when it knows that a resource is partially ONLINE and some of its services are available. Oracle Clusterware considers this state as partially ONLINE and does not attempt to failover or to restart the resource. The agent framework continues to monitor the resource in this state. This state has a numeric value of 4 for the <code class="codeph">scriptagent</code>.</p>
</li>
<li>
<p><code class="codeph">CLSAGFW_FAILED</code>: The CHECK entry point returns <a id="d45366e376" class="indexterm-anchor"></a>FAILED whenever it detects that a resource is not in a functioning state and some of its components have failed and some clean up is required to restart the resource. In response to this state, Oracle Clusterware calls the CLEAN action to clean up the resource. After the CLEAN action finishes, the state of the resource is expected to be OFFLINE. Next, depending on the policy of the resource, Oracle Clusterware may attempt to failover or restart the resource. Under no circumstances does the agent framework monitor failed resources. This state has a numeric value of 5 for the <code class="codeph">scriptagent</code>.</p>
</li>
</ul>
<p>The agent framework implicitly monitors resources in the states listed in <a href="GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C.htm#GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C__CHDEJIEE" title="This table lists the characteristics with which the agent framework monitors resources in certain states.">Table 9-1</a> at regular intervals, as specified by the <code class="codeph">CHECK_INTERVAL</code> or <code class="codeph">OFFLINE_CHECK_INTERVAL</code> resource attributes.</p>
<div class="infoboxnotealso" id="GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C__GUID-DE955E87-223B-4CBE-ACD5-13785AE40910">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="GUID-B747D1B8-D747-4D95-B4A7-6D1DC230C02D.htm">CHECK_INTERVAL</a>&#34;</span> and <span class="q">&#34;<a href="GUID-441C06D9-18E9-4CA6-9D23-17FD54602171.htm">OFFLINE_CHECK_INTERVAL</a>&#34;</span> for more information about these resource attributes</p>
</div>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C__CHDEJIEE">
<p class="titleintable">Table 9-1 Agent Framework Monitoring Characteristics</p>
<table class="cellalignment5567" title="Agent Framework Monitoring Characteristics" summary="This table lists the characteristics with which the agent framework monitors resources in certain states.">
<thead>
<tr class="cellalignment5561">
<th class="cellalignment5588" id="d45366e422">State</th>
<th class="cellalignment5678" id="d45366e425">Condition</th>
<th class="cellalignment5614" id="d45366e428">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5561">
<td class="cellalignment5590" id="d45366e433" headers="d45366e422">
<p>ONLINE</p>
</td>
<td class="cellalignment5679" headers="d45366e433 d45366e425">
<p>Always</p>
</td>
<td class="cellalignment5616" headers="d45366e433 d45366e428">
<p><code class="codeph">CHECK_INTERVAL</code></p>
</td>
</tr>
<tr class="cellalignment5561">
<td class="cellalignment5590" id="d45366e444" headers="d45366e422">
<p>PARTIAL</p>
</td>
<td class="cellalignment5679" headers="d45366e444 d45366e425">
<p>Always</p>
</td>
<td class="cellalignment5616" headers="d45366e444 d45366e428">
<p><code class="codeph">CHECK_INTERVAL</code></p>
</td>
</tr>
<tr class="cellalignment5561">
<td class="cellalignment5590" id="d45366e455" headers="d45366e422">
<p>OFFLINE</p>
</td>
<td class="cellalignment5679" headers="d45366e455 d45366e425">
<p>Only if the value of the <code class="codeph">OFFLINE_CHECK_INTERVAL</code> resource attribute is greater than 0.</p>
</td>
<td class="cellalignment5616" headers="d45366e455 d45366e428">
<p><code class="codeph">OFFLINE_CHECK_INTERVAL</code></p>
</td>
</tr>
<tr class="cellalignment5561">
<td class="cellalignment5590" id="d45366e469" headers="d45366e422">
<p>UNKNOWN</p>
</td>
<td class="cellalignment5679" headers="d45366e469 d45366e425">
<p>Only monitored if the resource was previously being monitored because of any one of the previously mentioned conditions.</p>
</td>
<td class="cellalignment5616" headers="d45366e469 d45366e428">
<p>If the state becomes UNKNOWN after being ONLINE, then the value of <code class="codeph">CHECK_INTERVAL</code> is used. Otherwise, there is no monitoring.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<p>Whenever an agent starts, the state of all the resources it monitors is set to UNKNOWN. After receiving an initial probe request from Oracle Clusterware, the agent framework executes the CHECK entry point for all of the resources to determine their current states.</p>
<p>Once the CHECK action successfully completes for a resource, the state of the resource transitions to one of the previously mentioned states. The agent framework then starts resources based on commands issued from Oracle Clusterware. After the completion of every action, the agent framework invokes the CHECK action to determine the current resource state. If the resource is in one of the monitored states listed in <a href="GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C.htm#GUID-CD3442A5-D6A8-4370-ABDA-CB686A736D3C__CHDEJIEE" title="This table lists the characteristics with which the agent framework monitors resources in certain states.">Table 9-1</a>, then the agent framework periodically executes the CHECK entry point to check for changes in resource state.</p>
<p>By default, the agent framework does not monitor resources that are offline. However, if the value of the <code class="codeph">OFFLINE_CHECK_INTERVAL</code> attribute is greater than 0, then the agent framework monitors offline resources.</p>
</div>
<!-- class="section" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5560">
<tr>
<td class="cellalignment5574">
<table class="cellalignment5565">
<tr>
<td class="cellalignment5564"><a href="GUID-30DC08E5-72CE-4E93-B6D6-E209DEADF83E.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5564"><a href="GUID-10286938-B9BA-4C98-80C7-1EE98F3463D7.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2007, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5576">
<table class="cellalignment5563">
<tr>
<td class="cellalignment5564"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5564"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5564"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5564"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5564"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5564"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>