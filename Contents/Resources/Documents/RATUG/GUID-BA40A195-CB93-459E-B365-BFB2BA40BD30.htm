<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-88095"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Analyzing%20SQL%20Performance%20Using%20APIs"></a><title>Analyzing SQL Performance Using APIs</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-01-24T11:32:44Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Testing Guide"/>
<meta name="dcterms.identifier" content="E55028-05"/>
<meta name="dcterms.isVersionOf" content="RATUG"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-36FDBD56-32CD-4A47-B7FB-5A20CDD1EF82.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-1B56ACA0-7C76-4963-B645-E90FB1968840.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E55028-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30"></a> <span id="PAGE" style="display:none;">49/309</span> <!-- End Header -->
<a id="RATUG197"></a>
<h1 id="RATUG-GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30" class="sect1"><span class="enumeration_section">6.2.1</span> Analyzing SQL Performance Using APIs</h1>
<div>
<div class="section">
<p>After the post-change SQL performance data is built, you can <a id="d11182e77" class="indexterm-anchor"></a>compare the pre-change version of performance data to the post-change version. Run a comparison analysis using the <code>DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code> procedure or function.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">To compare the pre-change and post-change SQL performance data:</p>
<ol>
<li>
<p>Call the <a id="d11182e92" class="indexterm-anchor"></a><code>EXECUTE_ANALYSIS_TASK</code> procedure or function using the following parameters:</p>
<ul style="list-style-type: disc;">
<li>
<p>Set the <code>task_name</code> parameter to the name of the SQL Performance Analyzer task.</p>
</li>
<li>
<p>Set the <code>execution_type</code> parameter to <code>COMPARE PERFORMANCE</code>. This setting will analyze and compare two versions of SQL performance data.</p>
</li>
<li>
<p>Specify a name to identify the execution using the <code>execution_name</code> parameter. If not specified, it will be generated by SQL Performance Analyzer and returned by the function.</p>
</li>
<li>
<p>Specify two versions of SQL performance data using the <code>execution_params</code> parameters. The <code>execution_params</code> parameters are specified as (<span class="italic">name</span>, <span class="italic">value</span>) pairs for the specified execution. Set the execution parameters that are related to comparing and analyzing SQL performance data as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>Set the <code>execution_name1</code> parameter to the name of the first execution (before the system change was made). This value should correspond to the value of the <code>execution_name</code> parameter specified in <span class="q">&#34;<a href="GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D.htm">Creating a Pre-Change SQL Trial Using APIs</a>&#34;</span>.</p>
</li>
<li>
<p>Set the <code>execution_name2</code> parameter to the name of the second execution (after the system change was made). This value should correspond to the value of the <code>execution_name</code> parameter specified in <span class="q">&#34;<a href="GUID-0C96536D-8129-4794-8527-1AA9FD240E2C.htm">Creating a Post-Change SQL Trial Using APIs</a>&#34;</span> when you executed the SQL workload after the system change. If the caller does not specify the executions, then by default SQL Performance Analyzer will always compare the last two task executions.</p>
</li>
<li>
<p>Set the <code>comparison_metric</code> parameter to specify an expression of execution statistics to use in the performance impact analysis. Possible values include the following metrics or any combination of them: <code>elapsed_time</code> (default), <code>cpu_time</code>, <code>buffer_gets</code>, <code>disk_reads</code>, <code>direct_writes</code>, <code>optimizer_cost</code>, and <code>io_interconnect_bytes</code>.</p>
</li>
</ul>
<p>For other possible parameters that you can set for comparison, see the description of the <code>DBMS_SQLPA</code> package in <a class="olink ARPLS229" target="_blank" href="../ARPLS/d_sqlpa.htm#ARPLS229"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a>.</p>
</li>
</ul>
<p>The following example illustrates a function call:</p>
<pre dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK(task_name =&gt; &#39;my_spa_task&#39;, - 
       execution_type =&gt; &#39;COMPARE PERFORMANCE&#39;, -
       execution_name =&gt; &#39;my_exec_compare&#39;, -
       execution_params =&gt; dbms_advisor.arglist(-
                             &#39;comparison_metric&#39;, &#39;buffer_gets&#39;));
</pre></li>
<li>
<p>Call the <a id="d11182e210" class="indexterm-anchor"></a><code>REPORT_ANALYSIS_TASK</code> function using the following parameters:</p>
<ul style="list-style-type: disc;">
<li>
<p>Set the <code>task_name</code> parameter to the name of the SQL Performance Analyzer task.</p>
</li>
<li>
<p>Set the <code>execution_name</code> parameter to the name of the execution to use. This value should match the <code>execution_name</code> parameter of the execution for which you want to generate a report.</p>
<p>To generate a report to display the results of:</p>
<ul style="list-style-type: disc;">
<li>
<p>Execution plans generated for the SQL workload, set this value to match the <code>execution_name</code> parameter of the desired <code>EXPLAIN PLAN</code> execution.</p>
</li>
<li>
<p>Execution plans and execution statistics generated for the SQL workload, set this parameter to match the value of the <code>execution_name</code> parameter used in the desired <code>TEST EXECUTE</code> execution.</p>
</li>
<li>
<p>A comparison analysis, set this value to match the <code>execution_name</code> parameter of the desired <code>ANALYZE PERFORMANCE</code> execution.</p>
</li>
</ul>
<p>If unspecified, SQL Performance Analyzer generates a report for the last execution.</p>
</li>
<li>
<p>Set the <code>type</code> parameter to specify the type of report to generate. Possible values include <code>TEXT</code> (default), <code>HTML</code>, <code>XML</code>, and <code>ACTIVE</code>.</p>
<p>Active reports provides in-depth reporting using an interactive user interface that enables you to perform detailed analysis even when disconnected from the database or Oracle Enterprise Manager. It is recommended that you use active reports instead of HTML or text reports when possible.</p>
<p>For information about active reports, see <span class="q">&#34;<a href="GUID-9C252273-EF17-4342-A7B4-D44C03F9D697.htm#GUID-9C252273-EF17-4342-A7B4-D44C03F9D697">About SQL Performance Analyzer Active Reports</a>&#34;</span>.</p>
</li>
<li>
<p>Set the <code>level</code> parameter to specify the format of the recommendations. Possible values include <code>TYPICAL</code> (default), <code>ALL</code>, <code>BASIC</code>, <code>CHANGED</code>, <code>CHANGED_PLANS</code>, <code>ERRORS</code>, <code>IMPROVED</code>, <code>REGRESSED</code>, <code>TIMEOUT</code>, <code>UNCHANGED</code>, <code>UNCHANGED_PLANS</code>, and <code>UNSUPPORTED</code>.</p>
</li>
<li>
<p>Set the <code>section</code> parameter to specify a particular section to generate in the report. Possible values include <code>SUMMARY</code> (default) and <code>ALL</code>.</p>
</li>
<li>
<p>Set the <code>top_sql</code> parameter to specify the number of SQL statements in a SQL tuning set to generate in the report. By default, the report shows the top 100 SQL statements impacted by the system change.</p>
</li>
</ul>
<p>To generate an active report, run the following script:</p>
<pre dir="ltr">set trimspool on
set trim on
set pages 0
set linesize 1000
set long 1000000
set longchunksize 1000000
spool spa_active.html
SELECT DBMS_SQLPA.REPORT_ANALYSIS_TASK(task_name =&gt; &#39;my_spa_task&#39;,
          type =&gt; &#39;active&#39;, section =&gt; &#39;all&#39;) FROM dual;
spool off
</pre>
<p>The following example illustrates a portion of a SQL script that you could use to create and display a comparison summary report in text format:</p>
<pre dir="ltr">VAR rep   CLOB;
EXEC :rep := DBMS_SQLPA.REPORT_ANALYSIS_TASK(&#39;my_spa_task&#39;, -
                &#39;text&#39;, &#39;typical&#39;, &#39;summary&#39;);
SET LONG 100000 LONGCHUNKSIZE 100000 LINESIZE 130
PRINT :rep
</pre></li>
<li>
<p>Review the SQL Performance Analyzer report, as described in <span class="q">&#34;<a href="GUID-1B56ACA0-7C76-4963-B645-E90FB1968840.htm">Reviewing the SQL Performance Analyzer Report in Command-Line</a>&#34;</span>.</p>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30__GUID-C9D67AB8-0174-47F0-96BD-DFC898FF697C">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS229" target="_blank" href="../ARPLS/d_sqlpa.htm#ARPLS229"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code> and <code>DBMS_SQLPA.REPORT_ANALYSIS_TASK</code> functions</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2747">
<tr>
<td class="cellalignment2754">
<table class="cellalignment2752">
<tr>
<td class="cellalignment2751"><a href="GUID-36FDBD56-32CD-4A47-B7FB-5A20CDD1EF82.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2751"><a href="GUID-1B56ACA0-7C76-4963-B645-E90FB1968840.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2756">
<table class="cellalignment2750">
<tr>
<td class="cellalignment2751"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2751"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2751"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2751"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2751"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2751"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>