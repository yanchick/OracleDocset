<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-88139"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Building%20a%20SQL%20Tuning%20Set"></a><title>Building a SQL Tuning Set</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="SQL tuning set, building"/>
<meta name="dcterms.created" content="2017-01-24T11:32:44Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Testing Guide"/>
<meta name="dcterms.identifier" content="E55028-05"/>
<meta name="dcterms.isVersionOf" content="RATUG"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-5B437942-8CF6-4F6C-864B-996BB61B4C26.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E55028-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA"></a> <span id="PAGE" style="display:none;">70/309</span> <!-- End Header -->
<a id="RATUG250"></a><a id="RATUG214"></a>
<h1 id="RATUG-GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA" class="sect1"><span class="enumeration_section">8.1.3</span> Building a SQL Tuning Set</h1>
<div>
<div class="section">
<p>Once the SQL trace files and mapping table are moved to the SQL Performance Analyzer system, you can build a SQL tuning set using the <code>DBMS_SQLTUNE</code> package.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">To build a SQL tuning set:</p>
<ol>
<li>
<p>Copy the SQL trace files to a directory on the SQL Performance Analyzer system.</p>
</li>
<li>
<p>Create a directory object for this directory.</p>
</li>
<li>
<p>Use the <code>DBMS_SQLTUNE</code>.<a id="d15464e103" class="indexterm-anchor"></a><code>SELECT_SQL_TRACE</code> function to read the SQL statements from the SQL trace files.</p>
<p>For each SQL statement, only information for a single execution is collected. The execution frequency of each SQL statement is not captured. Therefore, when performing a comparison analysis for a production system running Oracle Database 10<span class="italic">g</span> Release 1 and older releases, you should ignore the workload-level statistics in the SQL Performance Analyzer report and only evaluate performance changes on an execution level.</p>
<p>The following example reads the contents of SQL trace files stored in the <code>sql_trace_prod</code> directory object and loads them into a SQL tuning set.</p>
<pre dir="ltr">DECLARE
  cur sys_refcursor;
BEGIN
  DBMS_SQLTUNE.CREATE_SQLSET(&#39;my_sts_9i&#39;);
  OPEN cur FOR
    SELECT VALUE (P) 
    FROM table(DBMS_SQLTUNE.SELECT_SQL_TRACE(&#39;sql_trace_prod&#39;, &#39;%ora%&#39;)) P;
  DBMS_SQLTUNE.LOAD_SQLSET(&#39;my_sts_9i&#39;, cur);
  CLOSE cur;
END;
/
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p>The syntax for the <code>SELECT_SQL_TRACE</code> function is as follows:</p>
<pre dir="ltr">  DBMS_SQLTUNE.SELECT_SQL_TRACE ( 
    directory              IN VARCHAR2,
    file_name              IN VARCHAR2 := NULL,
    mapping_table_name     IN VARCHAR2 := NULL,
    mapping_table_owner    IN VARCHAR2 := NULL,
    select_mode            IN POSITIVE := SINGLE_EXECUTION,
    options                IN BINARY_INTEGER := LIMITED_COMMAND_TYPE,
    pattern_start          IN VARCHAR2 := NULL,
    parttern_end           IN VARCHAR2 := NULL,
    result_limit           IN POSITIVE := NULL)
  RETURN sys.sqlset PIPELINED;
</pre>
<p><a href="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA.htm#GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA__CIAHBDDF" title="This table lists the parameters and descriptions of each parameter for the DBMS_SQLTUNE.SELECT_SQL_TRACE function">Table 8-1</a> describes the available parameters for the <code>SELECT_SQL_TRACE</code> function.</p>
<div class="tblformal" id="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA__CIAHBDDF">
<p class="titleintable">Table 8-1 DBMS_SQLTUNE.SELECT_SQL_TRACE Function Parameters</p>
<table class="cellalignment2757" title="DBMS_SQLTUNE.SELECT_SQL_TRACE Function Parameters" summary="This table lists the parameters and descriptions of each parameter for the DBMS_SQLTUNE.SELECT_SQL_TRACE function">
<thead>
<tr class="cellalignment2748">
<th class="cellalignment2775" id="d15464e149">Parameter</th>
<th class="cellalignment2780" id="d15464e152">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e157" headers="d15464e149">
<p><code>directory</code></p>
</td>
<td class="cellalignment2781" headers="d15464e157 d15464e152">
<p>Specifies the directory object pointing to the directory where the SQL trace files are stored.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e165" headers="d15464e149">
<p><code>file_name</code></p>
</td>
<td class="cellalignment2781" headers="d15464e165 d15464e152">
<p>Specifies all or part of the name of the SQL trace files to process. If unspecified, the current or most recent trace file in the specified directory will be used. % wildcards are supported for matching trace file names.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e173" headers="d15464e149">
<p><code>mapping_table_name</code></p>
</td>
<td class="cellalignment2781" headers="d15464e173 d15464e152">
<p>Specifies the name of the mapping table. If set to the default value of <code>NULL</code>, mappings from the current database will be used. Note that the mapping table name is not case-sensitive.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e184" headers="d15464e149">
<p><code>mapping_table_owner</code></p>
</td>
<td class="cellalignment2781" headers="d15464e184 d15464e152">
<p>Specifies the schema where the mapping table resides. If set to <code>NULL</code>, the current schema will be used.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e195" headers="d15464e149">
<p><code>select_mode</code></p>
</td>
<td class="cellalignment2781" headers="d15464e195 d15464e152">
<p>Specifies the mode for selecting SQL statements from the trace files. The default value is <code>SINGLE_EXECUTION</code>. In this mode, only statistics for a single execution per SQL statement will be loaded into the SQL tuning set. The statistics are not cumulative, as is the case with other SQL tuning set data source table functions.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e206" headers="d15464e149">
<p><code>options</code></p>
</td>
<td class="cellalignment2781" headers="d15464e206 d15464e152">
<p>Specifies the options for the operation. The default value is <code>LIMITED_COMMAND_TYPE</code>, only SQL types that are meaningful to SQL Performance Analyzer (such as <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code>) are returned from the SQL trace files.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e229" headers="d15464e149">
<p><code>pattern_start</code></p>
</td>
<td class="cellalignment2781" headers="d15464e229 d15464e152">
<p>Specifies the opening delimiting pattern of the trace file sections to consider. This parameter is currently not used.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e237" headers="d15464e149">
<p><code>pattern_end</code></p>
</td>
<td class="cellalignment2781" headers="d15464e237 d15464e152">
<p>Specifies the closing delimiting pattern of the trace file sections to process. This parameter is currently not used.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2779" id="d15464e245" headers="d15464e149">
<p><code>result_limit</code></p>
</td>
<td class="cellalignment2781" headers="d15464e245 d15464e152">
<p>Specifies the top SQL from the (filtered) source. The default value is 2<sup>31</sup>, which represents unlimited.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA__GUID-159E47A0-CA66-4876-815D-E3734504CC0C">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS220" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS220"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_SQLTUNE</code> package</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2747">
<tr>
<td class="cellalignment2754">
<table class="cellalignment2752">
<tr>
<td class="cellalignment2751"><a href="GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2751"><a href="GUID-5B437942-8CF6-4F6C-864B-996BB61B4C26.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2756">
<table class="cellalignment2750">
<tr>
<td class="cellalignment2751"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2751"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2751"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2751"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2751"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2751"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>