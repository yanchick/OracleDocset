<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-88078"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20Time%20Shifting"></a><title>Using Time Shifting</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-01-24T11:32:44Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Testing Guide"/>
<meta name="dcterms.identifier" content="E55028-05"/>
<meta name="dcterms.isVersionOf" content="RATUG"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E55028-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49"></a> <span id="PAGE" style="display:none;">240/309</span> <!-- End Header -->
<a id="RATUG4203"></a>
<h1 id="RATUG-GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49" class="sect1"><span class="enumeration_section">16.2</span> Using Time Shifting</h1>
<div>
<div class="section">
<p>This section describes how to use time shifting with Consolidated Database Replay, and assumes a scenario where you want to use time shifting to align the peaks of workloads captured from three applications and replay them simultaneously. The scenario demonstrates how to use time shifting for stress testing. For more information about time shifting, see <span class="q">&#34;<a href="GUID-DADDFA47-C013-43A9-8036-23C2410890AB.htm">About Time Shifting</a>&#34;</span>.</p>
<p>This scenario uses the following assumptions:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The first workload is captured from the Sales application.</p>
</li>
<li>
<p>The second workload is captured from the CRM application and its peak time occurs 1 hour before that of the Sales workload.</p>
</li>
<li>
<p>The third workload is captured from the DW application and its peak time occurs 30 minutes before that of the Sales workload.</p>
</li>
<li>
<p>To align the peaks of these workloads, time shifting is performed by adding a delay of one hour to the CRM workload and a delay of 30 minutes to the DW workload during replay.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">To perform time shifting in this scenario:</p>
<ol>
<li>
<p>On the replay system which will undergo stress testing, create a directory object for the root directory where the captured workloads are stored:</p>
<pre dir="ltr">CREATE [OR REPLACE] DIRECTORY cons_dir AS &#39;/u01/test/cons_dir&#39;;
</pre></li>
<li>
<p>Preprocess the individual workload captures into separate directories:</p>
<ul style="list-style-type: disc;">
<li>
<p>For the Sales workload:</p>
<ol>
<li>
<p>Create a directory object:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY sales AS &#39;/u01/test/cons_dir/cap_sales&#39;;
</pre></li>
<li>
<p>Ensure that the captured workload from the Sales application is stored in this directory.</p>
</li>
<li>
<p>Preprocess the workload:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE (&#39;SALES&#39;);
</pre></li>
</ol>
</li>
<li>
<p>For the CRM workload:</p>
<ol>
<li>
<p>Create a directory object:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY crm AS &#39;/u01/test/cons_dir/cap_crm&#39;;
</pre></li>
<li>
<p>Ensure that the captured workload from the CRM application is stored in this directory.</p>
</li>
<li>
<p>Preprocess the workload:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE (&#39;CRM&#39;);
</pre></li>
</ol>
</li>
<li>
<p>For the DW workload:</p>
<ol>
<li>
<p>Create a directory object:</p>
<pre dir="ltr">CREATE OR REPLACE DIRECTORY DW AS &#39;/u01/test/cons_dir/cap_dw&#39;;
</pre></li>
<li>
<p>Ensure that the captured workload from the DW application is stored in this directory.</p>
</li>
<li>
<p>Preprocess the workload:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE (&#39;DW&#39;);
</pre></li>
</ol>
</li>
</ul>
</li>
<li>
<p>Set the replay directory to the root directory:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY (&#39;CONS_DIR&#39;);
</pre></li>
<li>
<p>Create a replay schedule and add the workload captures:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE (&#39;align_peaks_schedule&#39;);
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE (&#39;SALES&#39;) FROM dual;
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE (&#39;CRM&#39;, 3600) FROM dual;
SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE (&#39;DW&#39;, 1800) FROM dual;
EXEC DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;
</pre>
<p>Note that a delay of 3,600 seconds (or 1 hour) is added to the CRM workload, and a delay of 1,800 seconds (or 30 minutes) is added to the DW workload.</p>
</li>
<li>
<p>Initialize the consolidated replay:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY (&#39;align_peaks_replay&#39;,
                          &#39;align_peaks_schedule&#39;);
</pre></li>
<li>
<p>Remap connections:</p>
<ol>
<li>
<p>Query the <code>DBA_WORKLOAD_CONNECTION_MAP</code> view for the connection mapping information:</p>
<pre dir="ltr">SELECT schedule_cap_id, conn_id, capture_conn, replay_conn
  FROM dba_workload_connection_map;
</pre></li>
<li>
<p>Remap the connections:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 1,
     conn_id =&gt; 1, replay_connection =&gt; &#39;inst1&#39;);
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 1,
     conn_id =&gt; 2, replay_connection =&gt; &#39;inst1&#39;);
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 2,
     conn_id =&gt; 1, replay_connection =&gt; &#39;inst2&#39;);
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 2,
     conn_id =&gt; 2, replay_connection =&gt; &#39;inst2&#39;);
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 3,
     conn_id =&gt; 1, replay_connection =&gt; &#39;inst3&#39;);
EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION (schedule_cap_id =&gt; 3,
     conn_id =&gt; 2, replay_connection =&gt; &#39;inst3&#39;);
</pre>
<p>The <code>replay_connection</code> parameter represents the services that are defined on the test system.</p>
</li>
<li>
<p>Verify the connection remappings:</p>
<pre dir="ltr">SELECT schedule_cap_id, conn_id, capture_conn, replay_conn
  FROM dba_workload_connection_map;
</pre></li>
</ol>
</li>
<li>
<p>Prepare the consolidated replay:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY;
</pre></li>
<li>
<p>Start replay clients:</p>
<ol>
<li>
<p>Estimate the number of replay clients that are required:</p>
<pre dir="ltr">wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_sales
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_crm
wrc mode=calibrate replaydir=/u01/test/cons_dir/cap_dw
</pre></li>
<li>
<p>Add the output to determine the number of replay clients required.</p>
<p>You will need to start at least one replay client per workload capture contained in the consolidated workload.</p>
</li>
<li>
<p>Start the required number of replay clients by repeating this command:</p>
<pre dir="ltr">wrc <span class="italic">username</span>/<span class="italic">password</span> mode=replay replaydir=/u01/test/cons_dir
</pre>
<p>The <code>replaydir</code> parameter is set to the root directory in which the workload captures are stored.</p>
</li>
</ol>
</li>
<li>
<p>Start the consolidated replay:</p>
<pre dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;
</pre></li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2747">
<tr>
<td class="cellalignment2754">
<table class="cellalignment2752">
<tr>
<td class="cellalignment2751"><a href="GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2751"><a href="GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2756">
<table class="cellalignment2750">
<tr>
<td class="cellalignment2751"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2751"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2751"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2751"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2751"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2751"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>