<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-88090"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Tuning%20Regressed%20SQL%20Statements%20Using%20APIs"></a><title>Tuning Regressed SQL Statements Using APIs</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-01-24T11:32:44Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Testing Guide"/>
<meta name="dcterms.identifier" content="E55028-05"/>
<meta name="dcterms.isVersionOf" content="RATUG"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47.htm" title="Previous" type="text/html"/>
<link rel="Next" href="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E55028-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8"></a> <span id="PAGE" style="display:none;">55/309</span> <!-- End Header -->
<a id="RATUG295"></a><a id="RATUG208"></a>
<h1 id="RATUG-GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8" class="sect1"><span class="enumeration_section">6.2.4</span> Tuning Regressed SQL Statements Using APIs</h1>
<div>
<p>After reviewing the SQL Performance Analyzer report, you should tune any <a id="d12732e77" class="indexterm-anchor"></a>regressed SQL statements that are identified after comparing the SQL performance. If there are large numbers of SQL statements that appear to have regressed, you should try to identify the root cause and make system-level changes to rectify the problem. In cases when only a few SQL statements have regressed, consider using the SQL Tuning Advisor to implement a point solution for them, or creating SQL plan baselines to instruct the optimizer to select the original execution plan in the future.</p>
<div class="section">
<p class="subhead1">To tune regressed SQL statements using APIs:</p>
<ul style="list-style-type: disc;">
<li>
<p>Create a SQL tuning task for the SQL Performance Analyzer execution by using the <a id="d12732e89" class="indexterm-anchor"></a><code>CREATE_TUNING_TASK</code> function in the <code>DBMS_SQLTUNE</code> package:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.CREATE_TUNING_TASK(
    spa_task_name =&gt; &#39;my_spa_task&#39;,
    spa_task_owner =&gt; &#39;immchan&#39;,
    spa_compare_exec =&gt; &#39;my_exec_compare&#39;);
  DBMS_SQLTUNE.EXECUTE_TUNING_TASK(spa_task_name =&gt; &#39;my_spa_task&#39;);
END;
/
</pre>
<p>This example creates and executes a SQL tuning task to tune the SQL statements that regressed in the compare performance execution named <code>my_exec_compare</code> of the SQL Performance Analyzer task named <code>my_spa_task</code>. In this case, it is important to use this version of the <code>CREATE_TUNING_TASK</code> function call. Otherwise, SQL statements may be tuned in the environment from the production system where they were captured, which will not reflect the system change.</p>
<div class="infobox-note" id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__GUID-3AB8946D-6A28-45A4-9452-2F93DDBA7B56">
<p class="notep1">Note:</p>
<p>If you chose to execute the SQL workload remotely on a separate database, you should not use this version of the <code>CREATE_TUNING_TASK</code> function call to tune regressed SQL statements. Instead, you should tune any regressions identified by the SQL trials on the remote database, because the application schema is not on the database running SQL Performance Analyzer. Therefore, you need to run SQL Tuning Advisor on the database where the schema resides and where the change was made. For more information, see <span class="q">&#34;<a href="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102.htm">Tuning Regressed SQL Statements From a Remote SQL Trial Using APIs</a>&#34;</span>.</p>
</div>
</li>
</ul>
</div>
<!-- class="section" -->
<p><a href="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8.htm#GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__CHDCFJAH" title="This table lists the SQL Performance Analyzer parameters for the DBMS_SQLTUNE.CREATE_TUNING_TASK function and their descriptions">Table 6-1</a> lists the SQL Performance Analyzer parameters that can be used with the <code>DBMS_SQLTUNE</code>.<code>CREATE_TUNING_TASK</code> function.</p>
<div class="tblformal" id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__CHDCFJAH">
<p class="titleintable">Table 6-1 CREATE_TUNING_TASK Function SQL Performance Analyzer Parameters</p>
<table class="cellalignment2757" title="CREATE_TUNING_TASK Function SQL Performance Analyzer Parameters" summary="This table lists the SQL Performance Analyzer parameters for the DBMS_SQLTUNE.CREATE_TUNING_TASK function and their descriptions">
<thead>
<tr class="cellalignment2748">
<th class="cellalignment2768" id="d12732e144">Parameter</th>
<th class="cellalignment2769" id="d12732e147">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2748">
<td class="cellalignment2770" id="d12732e152" headers="d12732e144">
<p><code>SPA_TASK_NAME</code></p>
</td>
<td class="cellalignment2771" headers="d12732e152 d12732e147">
<p>Name of the SQL Performance Analyzer task.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2770" id="d12732e160" headers="d12732e144">
<p><code>SPA_TASK_OWNER</code></p>
</td>
<td class="cellalignment2771" headers="d12732e160 d12732e147">
<p>Owner of the specified SQL Performance Analyzer task. If unspecified, this parameter will default to the current user.</p>
</td>
</tr>
<tr class="cellalignment2748">
<td class="cellalignment2770" id="d12732e168" headers="d12732e144">
<p><code>SPA_COMPARE_EXEC</code></p>
</td>
<td class="cellalignment2771" headers="d12732e168 d12732e147">
<p>Execution name of the compare performance trial for the specified SQL Performance Analyzer task. If unspecified, this parameter defaults to the most recent execution of the <code>COMPARE PERFORMANCE</code> type for the given SQL Performance Analyzer task.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>After tuning the regressed SQL statements, you should test these changes using SQL Performance Analyzer. Run a new SQL trial on the test system, followed by a second comparison (between this new SQL trial and the first SQL trial) to validate your results. Once SQL Performance Analyzer shows that performance has stabilized, implement the fixes from this step to your production system.</p>
<p>Starting with Oracle Database 11<span class="italic">g</span> Release 2, SQL Tuning Advisor performs an alternative plan analysis when tuning a SQL statement. SQL Tuning Advisor reviews the execution history of the SQL statement, including any historical plans stored in the Automatic Workload Repository. If SQL Tuning Advisor finds alternate plans, it allows you to choose a specific plan and create a plan baseline to ensure that the desired execution plan is used for that SQL statement.</p>
<div class="infoboxnotealso" id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__GUID-A1262CFF-9F34-4E86-84FB-DDBE6926085F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink TGSQL540" target="_blank" href="../TGSQL/tgsql_sqltune.htm#TGSQL540"><span class="italic">Oracle Database SQL Tuning Guide</span></a> for information about using the SQL Tuning Advisor</p>
</li>
<li>
<p><a class="olink TGSQL558" target="_blank" href="../TGSQL/tgsql_sqltune.htm#TGSQL558"><span class="italic">Oracle Database SQL Tuning Guide</span></a> for information about alternative plan analysis</p>
</li>
<li>
<p><a class="olink ARPLS220" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS220"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code>DBMS_SQLTUNE</code> package</p>
</li>
</ul>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2747">
<tr>
<td class="cellalignment2754">
<table class="cellalignment2752">
<tr>
<td class="cellalignment2751"><a href="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2751"><a href="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2008, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2756">
<table class="cellalignment2750">
<tr>
<td class="cellalignment2751"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2751"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2751"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2751"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2751"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2751"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>