<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-88440"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/REPAIR%20FAILURE"></a><title>REPAIR FAILURE</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="repair clause, parameter description, REPAIR FAILURE command"/>
<meta name="dcterms.created" content="2017-06-08T22:24:36Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery Reference"/>
<meta name="dcterms.identifier" content="E50791-08"/>
<meta name="dcterms.isVersionOf" content="RCMRF"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="rcmsynta2003.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rcmsynta2005.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50791-08.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98"></a> <span id="PAGE" style="display:none;">40/152</span> <!-- End Header -->
<a id="RCMRF90266"></a><a id="RCMRF90267"></a><a id="RCMRF90268"></a><a id="RCMRF90269"></a><a id="RCMRF90270"></a><a id="RCMRF199"></a>
<h1 class="sect1">REPAIR FAILURE</h1>
<div>
<div class="section">
<p class="subhead1">Purpose</p>
<p><a id="d71839e94" class="indexterm-anchor"></a><a id="d71839e96" class="indexterm-anchor"></a><a id="d71839e98" class="indexterm-anchor"></a>Use the <code class="codeph">REPAIR FAILURE</code> command to repair database failures identified by the Data Recovery Advisor.</p>
<p>The recommended workflow is to run <code class="codeph"><a href="rcmsynta027.htm#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E">LIST</a></code> <code class="codeph">FAILURE</code> to display failures, <code class="codeph"><a href="rcmsynta003.htm#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code> to display repair options, and <code class="codeph">REPAIR FAILURE</code> to fix the failures.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Prerequisites</p>
<p>The target database instance must be started. The database must be a single-instance database and must not be a physical standby database.</p>
<p>Ensure that only one RMAN session is running the <code class="codeph">REPAIR FAILURE</code> command. The only exception is <code class="codeph">REPAIR FAILURE ... PREVIEW</code>, which is permitted in concurrent RMAN sessions.</p>
<p>To perform an <a id="d71839e137" class="indexterm-anchor"></a>automated repair, the Data Recovery Advisor may require specific backups and archived redo log files. If the files needed for recovery are not available, then recovery is not possible.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Usage Notes</p>
<p>Repairs are consolidated whenever possible so that a single repair can fix multiple failures. Be advised that <code class="codeph">REPAIR FAILURE</code> requires you to explicitly run <code class="codeph">ADVISE FAILURE</code> in the current session to successfully repair each of the identified failures. You typically iterate through a <code class="codeph">REPAIR</code> session with the following commands:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">REPAIR FAILURE;</code></p>
</li>
<li>
<p><code class="codeph">LIST FAILURE;</code></p>
</li>
<li>
<p><code class="codeph">ADVISE FAILURE;</code></p>
</li>
<li>
<p><code class="codeph">REPAIR FAILURE;</code></p>
</li>
</ul>
<p>RMAN always verifies that failures are still relevant and automatically closes fixed failures. RMAN does not attempt to repair a failure that is fixed, nor does it repair a failure that is obsolete because new failures were introduced after <code class="codeph">ADVISE FAILURE</code> ran.</p>
<p>By default, <code class="codeph">REPAIR FAILURE</code> prompts for confirmation before it begins executing. After executing a repair, RMAN reevaluates all existing failures on the chance that they may also have been fixed.</p>
<div class="infoboxnotealso" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-DE438092-3E7E-4A8D-9FB1-FB44CDEFC5F2">
<p class="notep1">See Also:</p>
<p><a href="rcmsynta2004.htm#GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__BGBBBCGC">Example 3-14</a> for a complete example on using the Data Recovery Advisor to diagnose and repair failures</p>
</div>
<p><span class="bold">Oracle RAC and Data Recovery Advisor</span></p>
<p>If a data failure brings down all instances of an <a id="d71839e190" class="indexterm-anchor"></a>Oracle RAC database, then you can mount the database in single-instance mode and use Data Recovery Advisor to detect and repair control file, <code class="codeph">SYSTEM</code> data file, and dictionary failures. You can also initiate health checks to test other database components for data failures. This approach does not detect data failures that are local to other cluster instances, for example, an inaccessible data file.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Syntax</p>
<p><a id="d71839e202" class="indexterm-anchor"></a><a id="d71839e206" class="indexterm-anchor"></a><span class="bold"><span class="italic">repair</span>::=</span></p>
<div class="figure" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-B01277FA-B1E2-49C0-9118-A680A3B6E261"><img width="501" height="72" src="img/GUID-FB11561C-24E9-4A59-9252-8083DACAD731-default.gif" alt="Description of GUID-FB11561C-24E9-4A59-9252-8083DACAD731-print.eps follows" title="Description of GUID-FB11561C-24E9-4A59-9252-8083DACAD731-print.eps follows"/><br/>
<a href="img_text/GUID-FB11561C-24E9-4A59-9252-8083DACAD731-print.htm">Description of the illustration GUID-FB11561C-24E9-4A59-9252-8083DACAD731-print.eps</a></div>
<!-- class="figure" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Semantics</p>
<p id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__CHDCBEBJ"><span class="bold"><span class="italic">repair</span></span></p>
<div class="tblformalwide" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-8E4F5A18-5861-42DA-BEBA-342E9D09CB4D">
<table class="cellalignment1044" summary="Describes REPAIR FAILURE command parameters">
<thead>
<tr class="cellalignment1038">
<th class="cellalignment1045" id="d71839e232">Syntax Element</th>
<th class="cellalignment1052" id="d71839e235">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1038">
<td class="cellalignment1047" id="d71839e240" headers="d71839e232">
<p><code class="codeph">REPAIR&nbsp;FAILURE</code></p>
</td>
<td class="cellalignment1053" headers="d71839e240 d71839e235">
<p>Repairs failures recorded in the Automated Diagnostic Repository.</p>
<p>If you execute <code class="codeph">REPAIR FAILURE</code> with no other command options, then RMAN uses the first repair option of the most recent <code class="codeph"><a href="rcmsynta003.htm#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code> command in the current session.</p>
</td>
</tr>
<tr class="cellalignment1038">
<td class="cellalignment1047" id="d71839e258" headers="d71839e232"><code class="codeph">&nbsp;&nbsp;&nbsp;USING&nbsp;ADVISE&nbsp;OPTION</code> <span class="italic"><code class="codeph">integer</code></span></td>
<td class="cellalignment1053" headers="d71839e258 d71839e235">
<p>Specifies a repair option by its option number (<span class="italic">not</span> its failure number). You can obtain repair option numbers from the <code class="codeph"><a href="rcmsynta003.htm#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code> command.</p>
</td>
</tr>
<tr class="cellalignment1038">
<td class="cellalignment1047" id="d71839e277" headers="d71839e232">
<p><code class="codeph">&nbsp;&nbsp;&nbsp;NOPROMPT</code></p>
</td>
<td class="cellalignment1053" headers="d71839e277 d71839e235">
<p>Suppresses the confirmation prompt.</p>
<p>This is the default option if you run <code class="codeph">REPAIR FAILURE</code> in a command file.</p>
</td>
</tr>
<tr class="cellalignment1038">
<td class="cellalignment1047" id="d71839e290" headers="d71839e232">
<p><code class="codeph">&nbsp;&nbsp;&nbsp;PREVIEW</code></p>
</td>
<td class="cellalignment1053" headers="d71839e290 d71839e235">
<p>Does not make any repairs and generates a script with all repair actions and comments. By default the script is displayed to standard output. You can use the <code class="codeph"><a href="rcmsynta2017.htm#GUID-5B739051-429E-4C72-B96F-4A7E5A7C2A49">SPOOL</a></code> command to write the script to an editable file (see <a href="rcmsynta2004.htm#GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__CHDJJCJC">Example 3-15</a>).</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead1">Examples</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__BGBBBCGC">
<p class="titleinexample">Example 3-14 Repairing Failures</p>
<p>This example repairs all failures known to the Data Recovery Advisor. The example repairs two failures: missing data files and a data file with corrupt blocks. After the recovery, RMAN asks whether it should open the database (user-entered text is in bold).</p>
<pre dir="ltr">RMAN&gt; <span class="bold">LIST FAILURE;</span>
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
142        HIGH     OPEN      23-APR-13     One or more non-system datafiles are missing
101        HIGH     OPEN      23-APR-13     Datafile 1: &#39;/disk1/oradata/prod/system01.dbf&#39; 
                                            contains one or more corrupt blocks
 
RMAN&gt; <span class="bold">ADVISE FAILURE;</span>
 
List of Database Failures
=========================
 
Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
142        HIGH     OPEN      23-APR-13     One or more non-system datafiles 
                                            are missing
101        HIGH     OPEN      23-APR-13     Datafile 1: &#39;/disk1/oradata/prod/system01.dbf&#39; 
                                            contains one or more corrupt blocks
 
analyzing automatic repair options; this may take some time
using channel ORA_DISK_1
analyzing automatic repair options complete
 
Mandatory Manual Actions
========================
no manual actions available
 
Optional Manual Actions
=======================
1. If file /disk1/oradata/prod/users01.dbf was unintentionally renamed or moved, restore it
 
Automated Repair Options
========================
Option Repair Description
------ ------------------
1      Restore and recover datafile 28; Perform block media recovery of 
       block 56416 in file 1
  Strategy: The repair includes complete media recovery with no data loss
  Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_660500184.hm

RMAN&gt; <span class="bold">REPAIR FAILURE;</span>
 
Strategy: The repair includes complete media recovery with no data loss
Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_475549922.hm
contents of repair script:
   # restore and recover datafile
   alter database datafile 28 offline;
   restore datafile 28;
   recover datafile 28;
   alter database datafile 28 online;
   # block media recovery
   recover datafile 1 block 56416;
 
Do you really want to execute the above repair (enter YES or NO)? <span class="bold">YES</span>
executing repair script
 
sql statement: alter database datafile 28 offline
 
Starting restore at 23-APR-13
using channel ORA_DISK_1
 
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00028 to /disk1/oradata/prod/users01.dbf
channel ORA_DISK_1: reading from backup piece /disk2/PROD/backupset/2013_04_18/o1_mf_nnndf_TAG20130418T182042_32fjzd3z_.bkp
channel ORA_DISK_1: piece handle=/disk2/PROD/backupset/2013_04_18/o1_mf_nnndf_TAG20130418T182042_32fjzd3z_.bkp tag=TAG20130418T182042
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:03
Finished restore at 23-APR-13
 
Starting recover at 23-APR-13
using channel ORA_DISK_1
 
starting media recovery
media recovery complete, elapsed time: 00:00:01
 
Finished recover at 23-APR-13
 
sql statement: alter database datafile 28 online
 
Starting recover at 23-APR-13
using channel ORA_DISK_1
searching flashback logs for block images until SCN 429690
finished flashback log search, restored 1 blocks
 
starting media recovery
media recovery complete, elapsed time: 00:00:03
 
Finished recover at 23-APR-13
repair failure complete
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__CHDJJCJC">
<p class="titleinexample">Example 3-15 Previewing a Repair</p>
<p>The following example previews a repair of the first repair option of the most recent <code class="codeph"><a href="rcmsynta003.htm#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code> command in the current session. The sample output for the <code class="codeph">LIST FAILURE</code> and <code class="codeph">ADVISE FAILURE</code> commands is not shown in the example.</p>
<pre dir="ltr">RMAN&gt; LIST FAILURE;
.
.
.
RMAN&gt; ADVISE FAILURE;
.
.
.
RMAN&gt; REPAIR FAILURE PREVIEW;

Strategy: The repair includes complete media recovery with no data loss
Repair script: /disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_3200987003.hm

contents of repair script:
   # block media recovery
   recover datafile 1 block 56416;
</pre>
<p>You can use <code class="codeph"><a href="rcmsynta2017.htm#GUID-5B739051-429E-4C72-B96F-4A7E5A7C2A49">SPOOL</a></code> with <code class="codeph">REPAIR FAILURE ... PREVIEW</code> to write a repair script to a file. You can then edit this script and execute it manually. The following example spools a log a repair preview to <code class="codeph">/tmp/repaircmd.dat</code>.</p>
<pre dir="ltr">RMAN&gt; SPOOL LOG TO &#39;/tmp/repaircmd.dat&#39;;
RMAN&gt; REPAIR FAILURE PREVIEW;
RMAN&gt; SPOOL LOG OFF;
</pre></div>
<!-- class="example" --></div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1037">
<tr>
<td class="cellalignment1049">
<table class="cellalignment1042">
<tr>
<td class="cellalignment1041"><a href="rcmsynta2003.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1041"><a href="rcmsynta2005.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1051">
<table class="cellalignment1040">
<tr>
<td class="cellalignment1041"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1041"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1041"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1041"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1041"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1041"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>