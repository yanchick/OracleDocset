<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-79193"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Limitations%20and%20Restrictions%20on%20ODP.NET%20Within%20.NET%20Stored%20Procedure"></a><title>Limitations and Restrictions on ODP.NET Within .NET Stored Procedure</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="dcterms.created" content="2014-10-14T19:43:26Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Data Provider for .NET Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E17732-11"/>
<meta name="dcterms.isVersionOf" content="ODPNT"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="extenBoth.htm" title="Previous" type="text/html"/>
<link rel="Next" href="extenPorting.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E17732-11.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">49/172</span> <!-- End Header --><a id="CJAHJBJI"></a>
<div id="ODPNT448" class="sect1">
<h1 class="sect1"><a id="sthref732"></a><a id="sthref733"></a>Limitations and Restrictions on ODP.NET Within .NET Stored Procedure</h1>
<p>This section covers important concepts that apply when Oracle Data Provider for .NET is used within a .NET stored procedure.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
ODP.NET, Managed Driver does not support .NET stored procedures.</div>
<a id="CHDFEDHC"></a>
<div id="ODPNT449" class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Implicit Database Connection<a id="sthref734"></a><a id="sthref735"></a><a id="sthref736"></a></h2>
<p>Within a .NET stored procedure, an implicit database connection is available for use to access Oracle data. This implicit database connection should be used rather than establishing a user connection because the <a href="glossary.htm#CBAEGHCI"><span class="xrefglossterm">implicit database connection</span></a> is already established by the caller of the .NET stored procedure, thereby minimizing resource usage.</p>
<p>To obtain an <code>OracleConnection</code> object in a .NET stored procedure that represents the implicit database connection, set the <code>ConnectionString</code> property of the <code>OracleConnection</code> object to <code>&#34;context</code> <code>connection=true&#34;</code> and invoke the <code>Open</code> method. No connection string attributes can be used with <code>&#34;context</code> <code>connection=true&#34;</code>, except the <code>Statement</code> <code>Cache</code> <code>Size</code> attribute.</p>
<p>The availability of the implicit database connection can be checked at run time through the static <code>OracleConnection.IsAvailable</code> property. This property always returns <code>true</code> when Oracle Data Provider for .NET is used within a .NET stored procedure. Otherwise, <code>false</code> is returned.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
DBLinks are not supported in .NET stored procedures.</div>
<p>Only one implicit database connection is available within a .NET stored procedure invocation. To establish more connections in addition to the implicit database connection, an explicit connection must be created. When the <code>Close</code> method is invoked on the <code>OracleConnection</code> that represents the implicit database connection, the connection is not actually closed. Therefore, the <code>Open</code> method of the same or another <code>OracleConnection</code> object can be invoked to obtain the connection that represents the implicit database connection.</p>
<p>The implicit database connection can only be acquired by the <code>Open</code> method invocation by a native Oracle thread that initially invokes the .NET stored procedure. However, threads spawned from the native Oracle thread can use implicit database connections that are obtained by the native Oracle thread.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleConnectionClass.htm#BABEIJAB">&#34;IsAvailable&#34;</a></div>
</div>
<!-- class="sect2" -->
<div id="ODPNT450" class="sect2"><a id="sthref737"></a>
<h2 class="sect2">Transaction Support<a id="sthref738"></a><a id="sthref739"></a><a id="sthref740"></a></h2>
<p>The .NET stored procedure execution automatically inherits the current transaction on the implicit database connection. No explicit transaction can be started, committed, or rolled back inside a .NET stored procedure on a Context connection. However, explicit transaction can be started, committed, or rolled back inside a .NET stored procedure on a Client connection.</p>
<p>For example, <code>OracleConnection.BeginTransaction</code> is not allowed inside a .NET stored procedure for a context connection, but is allowed for a client connection. .NET stored procedures do not support distributed transactions. If you have enlisted a client connection in a distributed transaction and call a .NET stored procedure or function, an error occurs.</p>
<p>If a .NET stored procedure or function performs operations on the database that are required to be part of a transaction, the transaction must be started prior to calling the .NET stored procedure. Any desired commit or rollback must be performed after returning from the .NET stored procedure or function.</p>
<p>The following example consists of a client application and a .NET stored procedure, <code>InsertRecordSP</code>, that inserts an employee record into an <code>EMP</code> table.</p>
<p class="subhead2"><a id="ODPNT451"></a>Example (.NET Stored Procedure)</p>
<pre>using System;
using System.Data;
using Oracle.DataAccess.Client;
// This class represents an Oracle .NET stored procedure that inserts
// an employee record into an EMP table of SCOTT schema.
public class InsertRecordSP
{
    // This procedure will insert a row into the emp database
    // For simplicity we are using only two parameters, the rest are hard coded
    public static void InsertRecord( int EmpNo, string EmpName )
    {
        if(OracleConnection.IsAvailable == true )
        {
            OracleConnection conn = new OracleConnection(
                &#34;context connection=true&#34;);
            conn.Open();
            // Create new command object from connection context
            OracleCommand Cmd = conn.CreateCommand();
            Cmd.CommandText = &#34;INSERT INTO EMP( EMPNO, ENAME, JOB,&#34; +
                &#34;MGR, HIREDATE, SAL, COMM, DEPTNO ) &#34; +
                &#34;VALUES ( :1, :2, &#39;ANALYST&#39;, 7566, &#34; +
                &#34;&#39;06-DEC-04&#39;, 5000, 0, 20 )&#34;;
            Cmd.Parameters.Add( &#34;:1&#34;, OracleDbType.Int32,
                EmpNo, ParameterDirection.Input );
            Cmd.Parameters.Add( &#34;:2&#34;, OracleDbType.Varchar2,
                EmpName, ParameterDirection.Input );
            Cmd.ExecuteNonQuery();
        }
    }
}
</pre>
<p class="subhead2"><a id="ODPNT452"></a>Example (Client Application)</p>
<p>The example enters new employee, Bernstein, employee number 7950, into the <code>EMP</code> table.</p>
<pre>// C#
// This sample demonstrates how to start the transaction with ODP.NET client 
// application and execute an Oracle .NET stored procedure that performs
// a DML operation. Since .NET stored procedure inherits the current
// transaction from the implicit database connection,  DML operation 
// in .NET stored procedure will not be in auto-committed mode.
// Therefore, it is up to the client application to do a COMMIT or ROLLBACK
// after returning from .NET stored procedure
using System;
using System.Data;
using Oracle.DataAccess.Client;
// In this class we are starting a transaction on the client side and
// executing a .NET stored procedure, which inserts a record into EMP
// table and then verifies record count before and after COMMIT statement
class TransactionSample
{
    static void Main(string[] args)
    {
        OracleConnection Conn = null;
        OracleTransaction Txn = null;
        OracleCommand Cmd = null;
        try
        {
            Console.WriteLine( &#34;Sample: Open DB connection in non auto-committed &#34; 
               + &#34;mode,&#34; +
                &#34;DML operation performed by .NET stored &#34; +
                &#34;procedure doesn&#39;t have an effect before COMMIT &#34; +
                &#34;is called.&#34; );
            // Create and Open oracle connection
            Conn = new OracleConnection();
            Conn.ConnectionString = &#34;User Id=scott;Password=tiger;&#34; +
                &#34;Data Source=oracle;&#34;;
            Conn.Open();
            // Start transaction
            Txn = Conn.BeginTransaction( IsolationLevel.ReadCommitted );
            // Create command object
            Cmd = new OracleCommand();
            Cmd.Connection = Conn;
            Cmd.CommandType = CommandType.StoredProcedure;
            Cmd.CommandText = &#34;InsertRecord&#34;; // .NET Stored procedure
            // Parameter settings
            OracleParameter EmpNoPrm = Cmd.Parameters.Add(
                &#34;empno&#34;, OracleDbType.Int32 );
            EmpNoPrm.Direction = ParameterDirection.Input;
            EmpNoPrm.Value = 7950;
            OracleParameter EmpNamePrm = Cmd.Parameters.Add(
                &#34;ename&#34;, OracleDbType.Varchar2, 10 );
            EmpNamePrm.Direction = ParameterDirection.Input;
            EmpNamePrm.Value = &#34;Bernstein&#34;;
            // Execute .NET stored procedure
            Cmd.ExecuteNonQuery();
            Console.WriteLine( &#34;Number of record(s) before COMMIT {0}&#34;,
                RecordCount() );
            Txn.Commit();
            Console.WriteLine( &#34;Number of record(s) after COMMIT {0}&#34;,
                RecordCount() );
        }
        catch( OracleException OE )
        {
            Console.WriteLine( OE.Message );
        }
        finally
        {
            // Cleanup objects
            if( null != Txn )
                Txn.Dispose();
            if( null != Cmd )
                Cmd.Dispose();
            if( null != Conn &amp;&amp; Conn.State == ConnectionState.Open )
                Conn.Close();
        }
    }
    static int RecordCount()
    {
        int EmpCount = 0;
        OracleConnection Conn = null;
        OracleCommand Cmd = null;
        try
        {
            Conn = new OracleConnection( &#34;User Id=scott;Password=tiger;&#34; +
                &#34;Data Source=oracle;&#34; );
            Conn.Open();
            Cmd = new OracleCommand( &#34;SELECT COUNT(*) FROM EMP&#34;, Conn );
            Object o = Cmd.ExecuteScalar();
            EmpCount = Convert.ToInt32(o.ToString());
        }
        catch( OracleException OE )
        {
            Console.WriteLine( OE.Message );
        }
        finally
        {
            if( null != Cmd )
                Cmd.Dispose();
        }
        return EmpCount;
       }
      }
</pre></div>
<!-- class="sect2" -->
<div id="ODPNT453" class="sect2"><a id="sthref741"></a>
<h2 class="sect2">Unsupported SQL Commands<a id="sthref742"></a><a id="sthref743"></a><a id="sthref744"></a></h2>
<p>Transaction controls commands such as <code>COMMIT</code>, <code>ROLLBACK</code>, and <code>SAVEPOINT</code> are not supported in a .NET stored procedure.</p>
<p>Data definition commands such as <code>CREATE</code> and <code>ALTER</code> are not supported with an implicit database connection, but they are supported with an explicit user connection in a .NET stored procedure.</p>
</div>
<!-- class="sect2" -->
<div id="ODPNT454" class="sect2"><a id="sthref745"></a>
<h2 class="sect2">Oracle User-Defined Type (UDT) Support</h2>
<p>UDTs are not supported within a context connection but they are supported with a client connection. UDTs are not supported as parameters to .NET stored procedures.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4219">
<tr>
<td class="cellalignment4226">
<table class="cellalignment4224">
<tr>
<td class="cellalignment4223"><a href="extenBoth.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4223"><a href="extenPorting.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4228">
<table class="cellalignment4222">
<tr>
<td class="cellalignment4223"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4223"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4223"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4223"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4223"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4223"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>