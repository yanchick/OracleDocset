<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-56"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Cartridge%20Services%20Using%20C%2C%20C%2B%2B%20and%20Java"></a><title>Cartridge Services Using C, C++ and Java</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="service routine, routine, service, external procedure, OCI access functions, examples, OCIExtProcAllocMemory routine, Maintaining Context - Java"/>
<meta name="dcterms.created" content="2017-06-09T01:57:02Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Data Cartridge Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E15882-06"/>
<meta name="dcterms.isVersionOf" content="ADDCI"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="part4.htm" title="Previous" type="text/html"/>
<link rel="Next" href="ext_types_ref.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E15882-06.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745"></a> <span id="PAGE" style="display:none;">26/33</span> <!-- End Header -->
<a id="ADDCI4180"></a>
<h1 id="ADDCI-GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745" class="sect1"><span class="enumeration_chapter">18</span> Cartridge Services Using C, C++ and Java</h1>
<div>
<p>Consider cartridge services available to programmers using C/C++ and Java.</p>
<div class="infoboxnotealso" id="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745__GUID-BCFF4297-A6C2-4729-9D2B-E464CDBB0AB0">
<p class="notep1">See Also:</p>
<p><a class="olink LNOCI190" target="_blank" href="../LNOCI/oci20ext.htm#LNOCI190"><span class="italic">Oracle Call Interface Programmer&#39;s Guide</span></a> for more details on cartridge services using C</p>
</div>
</div>
<a id="ADDCI4934"></a>
<div class="props_rev_3"><a id="GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA"></a>
<h2 id="ADDCI-GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA" class="sect2">OCI Access Functions for External Procedures</h2>
<div>
<p>When called from an external procedure, a service routine can raise exceptions, allocate memory, and get OCI handles for callbacks to the server. To use the functions, you must specify the <code class="codeph">WITH</code> <code class="codeph">CONTEXT</code> clause, which lets you pass a context structure to the external procedure. The context structure is declared in header file <code class="codeph">ociextp.h</code> as follows:</p>
<pre dir="ltr">typedef struct OCIExtProcContext OCIExtProcContext;
</pre>
<p>Consider how service routines use context information. For more information and examples of usage, see <a class="olink ADFNS" target="_blank" href="../ADFNS/toc.htm"><span class="italic">Oracle Database Advanced Application Developer&#39;s Guide.</span></a></p>
</div>
<a id="ADDCI4935"></a>
<div class="props_rev_3"><a id="GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D"></a>
<h3 id="ADDCI-GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D" class="sect3">OCIExtProcAllocCallMemory</h3>
<div>
<div class="section">
<p>This service routine allocates <span class="italic">n</span> bytes of memory for the duration of the external procedure call. Any memory allocated by the function is freed as soon as control returns to PL/SQL.</p>
<p>Do not use any other function to allocate or free memory.</p>
<p>The C prototype for this function follows:</p>
<pre dir="ltr">void *OCIExtProcAllocCallMemory(
   OCIExtProcContext *with_context, 
   size_t amount);
</pre>
<p>The parameters <span class="italic">with_context</span> and <span class="italic">amount</span> are the context pointer and number of bytes to allocate, respectively. The function returns an untyped pointer to the allocated memory. A return value of zero indicates failure.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4936"></a>
<div class="props_rev_3"><a id="GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB"></a>
<h3 id="ADDCI-GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB" class="sect3">OCIExtProcRaiseExcp</h3>
<div>
<div class="section">
<p><a id="d57687e274" class="indexterm-anchor"></a><a id="d57687e276" class="indexterm-anchor"></a>This service routine raises a predefined exception, which must have a valid Oracle error number in the range <code class="codeph">1</code> to <code class="codeph">32767</code>. After doing any necessary cleanup, the external procedure must return immediately. (No values are assigned to <code class="codeph">OUT</code> or <code class="codeph">IN</code> <code class="codeph">OUT</code> parameters.) The C prototype for this function follows:</p>
<pre dir="ltr">int OCIExtProcRaiseExcp(
   OCIExtProcContext *with_context, 
   size_t error_number);
</pre>
<p>The parameters <span class="italic">with_context</span> and <span class="italic">error_number</span> are the context pointer and Oracle error number. The return values <code class="codeph">OCIEXTPROC_SUCCESS</code> and <code class="codeph">OCIEXTPROC_ERROR</code> indicate success or failure.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4937"></a>
<div class="props_rev_3"><a id="GUID-D9917140-D034-4F5F-99B2-556DB03AC837"></a>
<h3 id="ADDCI-GUID-D9917140-D034-4F5F-99B2-556DB03AC837" class="sect3">OCIExtProcRaiseExcpWithMsg</h3>
<div>
<div class="section">
<p><a id="d57687e367" class="indexterm-anchor"></a><a id="d57687e369" class="indexterm-anchor"></a>This service routine raises a user-defined exception and returns a user-defined error message. The C prototype for this function follows:</p>
<pre dir="ltr">int OCIExtProcRaiseExcpWithMsg(
   OCIExtProcContext *with_context, 
   size_t error_number,
   text   *error_message, 
   size_t  len);
</pre>
<p>The parameters <code class="codeph">with_context</code>, <code class="codeph">error_number</code>, and <code class="codeph">error_message</code> are the context pointer, Oracle error number, and error message text. The parameter <span class="italic">len</span> stores the length of the error message. If the message is a null-terminated string, <span class="italic">len</span> is zero. The return values <code class="codeph">OCIEXTPROC_SUCCESS</code> and <code class="codeph">OCIEXTPROC_ERROR</code> indicate success or failure.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4938"></a>
<div class="props_rev_3"><a id="GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9"></a>
<h3 id="ADDCI-GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9" class="sect3">OCIExtProcGetEnv</h3>
<div>
<div class="section">
<p>This service routine enables OCI callbacks to the database during an external procedure call. Use the OCI handles obtained by this function only for callbacks. If you use them for standard OCI calls, the handles establish a new connection to the database and cannot be used for callbacks in the same transaction. In other words, during an external procedure call, you can use OCI handles for callbacks or a new connection but not for both.</p>
<p>The C prototype for this function follows:</p>
<pre dir="ltr">sword OCIExtProcGetEnv(
   OCIExtProcContext *with_context, 
   OCIEnv    **envh, 
   OCISvcCtx **svch, 
   OCIError  **errh);
</pre>
<p>The parameter <span class="italic">with_context</span> is the context pointer, and the parameters <span class="italic">envh</span>, <span class="italic">svch</span>, and <span class="italic">errh</span> are the OCI environment, service, and error handles, respectively. The return values <code class="codeph">OCIEXTPROC_SUCCESS</code> and <code class="codeph">OCIEXTPROC_ERROR</code> indicate success or failure.</p>
<p><span class="q">&#34;<a href="c_cpp_java.htm#GUID-FE168081-19E5-4991-87C2-40E68995850D">Using Callbacks</a>&#34;</span> shows how <code class="codeph">OCIExtProcGetEnv</code> might be used in callbacks. For a working example, see the script extproc.sql in the PL/SQL demo directory.<a id="d57687e488" class="indexterm-anchor"></a><a id="d57687e492" class="indexterm-anchor"></a> (For the location of this directory, see your Oracle installation or user&#39;s guide.) This script demonstrates the calling of an external procedure. The companion file extproc.c contains the C source code for the external procedure. To run the demo, follow the instructions in <code class="codeph">extproc</code>.<code class="codeph">sql</code>. You must use an account that has <code class="codeph">CREATE</code> <code class="codeph">LIBRARY</code> privileges.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="ADDCI4940"></a><a id="ADDCI4939"></a>
<div class="props_rev_3"><a id="GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A"></a>
<h2 id="ADDCI-GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A" class="sect2">Installing Java Cartridge Services Files</h2>
<div>
<div class="section">
<p>The <code class="codeph">ODCI.jar</code> and <code class="codeph">CartridgeServices.jar</code> files must be installed into the <code class="codeph">SYS</code> schema to use the Java classes described here.</p>
<p>If you installed the Java option, then you must install the <code class="codeph">ODCI.jar</code> and <code class="codeph">CartridgeServices.jar</code> files. You do not have to perform this task if you did not install the Java option.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To install ODCI.jar and CartridgeServices.jar files</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Activate the SQL*Plus prompt.</span>
<div>
<pre dir="ltr">C:\sqlplus
</pre></div>
</li>
<li class="stepexpand"><span>When prompted, login using the <code class="codeph">system</code> account.</span>
<div>
<pre dir="ltr">Enter user-name: system
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Use the server-side loadjava command to install the classes and create the synonyms in the <code class="codeph">SYSTEM</code> schema.</span>
<div>
<pre dir="ltr">SQL&gt; call dbms_java.loadjava(&#39;-resolve -synonym -grant public 
     -verbose vobs/jilip/Cartridge Services.jar&#39;);
SQL&gt; call dbms_java.loadjava(&#39;-resolve -synonym -grant public
     -verbose vobs/jlib/ODCI.jar&#39;);
</pre></div>
</li>
</ol>
<div class="section">
<p>See <a class="olink UPGRD" target="_blank" href="../UPGRD/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a> for further details on installing the <code class="codeph">jar</code> files.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4941"></a>
<div class="props_rev_3"><a id="GUID-CF359033-3ED3-4601-8070-5DB01287D38B"></a>
<h2 id="ADDCI-GUID-CF359033-3ED3-4601-8070-5DB01287D38B" class="sect2">Cartridge Services-Maintaining Context</h2>
<div>
<p>The Java cartridge service is used for maintaining context. It is similar to the OCI context management service. This class is necessary when switching context between the server and the cartridge code.</p>
</div>
<a id="ADDCI4943"></a><a id="ADDCI4944"></a><a id="ADDCI4945"></a><a id="ADDCI4946"></a><a id="ADDCI4942"></a>
<div class="props_rev_3"><a id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD"></a>
<h3 id="ADDCI-GUID-A2345CF6-8A32-48DE-A248-F913111ECADD" class="sect3">ContextManager</h3>
<div>
<div class="section">
<p>ContextManager is a Constructor in class Oracle that extends Object.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><span class="bold">Class Interface</span></p>
</div>
<!-- class="section" -->
<div class="section">
<pre dir="ltr">public static Hashtable ctx extends Object
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><span class="bold">Variable</span></p>
</div>
<!-- class="section" -->
<div class="section">
<pre dir="ltr">ctx public static Hashtable ctx
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><span class="bold">Constructors</span></p>
</div>
<!-- class="section" -->
<div class="section">
<pre dir="ltr">ContextManager public ContextManager()
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><span class="bold">Methods</span></p>
</div>
<!-- class="section" -->
<div class="section">
<p>The following methods are available:</p>
<pre dir="ltr">setContext (static method in class oracle)
getContext (static method in class oracle)
clearContext (static method in class oracle)
</pre></div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4947"></a>
<div class="props_rev_3"><a id="GUID-33645707-174E-47E4-AD6D-7D18572DC731"></a>
<h3 id="ADDCI-GUID-33645707-174E-47E4-AD6D-7D18572DC731" class="sect3">CountException()</h3>
<div>
<div class="section">
<p>Constructor that extends <code class="codeph">Exception</code>.</p>
<pre dir="ltr">Class oracle.CartridgeServices.CountException
</pre></div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4948"></a>
<div class="props_rev_3"><a id="GUID-71AAF380-990D-4739-AF32-ABF668F7575D"></a>
<h3 id="ADDCI-GUID-71AAF380-990D-4739-AF32-ABF668F7575D" class="sect3">CountException(String)</h3>
<div>
<div class="section">
<p>Constructor that extends <code class="codeph">Exception</code>.</p>
<pre dir="ltr">public CountException(String s)
</pre></div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4949"></a>
<div class="props_rev_3"><a id="GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084"></a>
<h3 id="ADDCI-GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084" class="sect3">InvalidKeyException()</h3>
<div>
<div class="section">
<p>Constructor that extends <code class="codeph">Exception</code>.</p>
<pre dir="ltr">public InvalidKeyException(String s)
</pre></div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4950"></a>
<div class="props_rev_3"><a id="GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F"></a>
<h3 id="ADDCI-GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F" class="sect3">InvalidKeyException(String)</h3>
<div>
<div class="section">
<p>Constructor that extends <code class="codeph">Exception</code>.</p>
<pre dir="ltr">public InvalidKeyException(String s)
</pre></div>
<!-- class="section" --></div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5977">
<tr>
<td class="cellalignment5984">
<table class="cellalignment5982">
<tr>
<td class="cellalignment5981"><a href="part4.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5981"><a href="ext_types_ref.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5986">
<table class="cellalignment5980">
<tr>
<td class="cellalignment5981"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5981"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5981"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5981"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5981"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5981"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>