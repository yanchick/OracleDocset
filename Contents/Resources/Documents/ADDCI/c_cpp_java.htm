<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-1"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Implementing%20Data%20Cartridges%20in%20C%2C%20C%2B%2B%2C%20and%20Java"></a><title>Implementing Data Cartridges in C, C++, and Java</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="shared library, Alias library, library, shared, alias, DIRECTORY Object Option, external procedure, overview, registering, registering an external procedure, configuration files for, configuration files for external procedures, data types, specifying, PARAMETERS clause, PARAMETERS clause with external procedure, Restrictions on Callbacks, Callback Restrictions, RPC time out, Debugging External Procedures, External Procedures, Debugging, DEBUG_EXTPROC, Using"/>
<meta name="dcterms.created" content="2017-06-09T01:57:02Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Data Cartridge Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E15882-06"/>
<meta name="dcterms.isVersionOf" content="ADDCI"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="pl_sql.htm" title="Previous" type="text/html"/>
<link rel="Next" href="lobs.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E15882-06.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-387703C2-5DDF-47FE-B78F-21A465989B91"></a> <span id="PAGE" style="display:none;">12/33</span> <!-- End Header -->
<a id="ADDCI250"></a>
<h1 id="ADDCI-GUID-387703C2-5DDF-47FE-B78F-21A465989B91" class="sect1"><span class="enumeration_chapter">5</span> Implementing Data Cartridges in C, C++, and Java</h1>
<div>
<p>Consider how to use C, C++, and Java to implement the methods of a data cartridge. Methods are procedures and functions that define the operations permitted on data defined using the data cartridge. The focus is on issues related to developing and debugging external procedures.</p>
</div>
<a id="ADDCI4335"></a>
<div class="props_rev_3"><a id="GUID-1B118229-8B58-4685-9DA8-1BBC231CEC47"></a>
<h2 id="ADDCI-GUID-1B118229-8B58-4685-9DA8-1BBC231CEC47" class="sect2">Shared Libraries</h2>
<div>
<p>A <span class="bold">shared library</span> is an operating system file, such as a Windows DLL or a Solaris shared object, which stores the coded implementation of external procedures. You can access the shared library from Oracle by using an <span class="bold">alias library</span>, which is a schema object that represents the library within PL/SQL. For security reasons, you need DBA privileges to create an alias library.</p>
<div class="infoboxnotealso" id="GUID-1B118229-8B58-4685-9DA8-1BBC231CEC47__GUID-C68A62D2-E580-4D5D-89CC-A1A3804CD02E">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink LNPLS" target="_blank" href="../LNPLS/toc.htm"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information on using dedicated external procedure agents</p>
</li>
<li>
<p><a class="olink DBSEG" target="_blank" href="../DBSEG/toc.htm"><span class="italic">Oracle Database Security Guide</span></a> for more information on Directory Object support for libraries</p>
</li>
</ul>
</div>
</div>
<div class="props_rev_3"><a id="GUID-248806CE-1CDD-4FFA-9CD8-4E6D23288816"></a>
<h3 id="ADDCI-GUID-248806CE-1CDD-4FFA-9CD8-4E6D23288816" class="sect3">Using Shared Libraries</h3>
<div>
<p>To create the alias library, you must decide on the operating system location for the library, log in as a DBA or as a user with the <code class="codeph">CREATE</code> <code class="codeph">LIBRARY</code> privilege, and then enter the statement in <a href="c_cpp_java.htm#GUID-4BC24ED4-0A90-407C-AD15-3C1953B7DA86__BGBJBCFF">Example 5-1</a>. This creates the alias library schema object in the database. After the alias library is created, you can refer to the shared library by the name <code class="codeph">DS_Lib</code> from PL/SQL. <a href="c_cpp_java.htm#GUID-4BC24ED4-0A90-407C-AD15-3C1953B7DA86__BGBJBCFF">Example 5-1</a> specifies an absolute path for the library.</p>
<p>If you have copies of the library on multiple systems, to support distributed execution of external procedures by designated or dedicated agents, use an environment variable to specify the location of the libraries more generally, as in <a href="c_cpp_java.htm#GUID-915DD434-73A7-4924-81E3-19367CB07529__BGBDIDHB">Example 5-2</a>. This statement uses the environment variable <code class="codeph">${DS_LIB_HOME}</code> to specify a common point of reference or root directory from which the library can be found on all systems. The string following the <code class="codeph">AGENT</code> keyword specifies the agent (actually, a database link) that is used to run any external procedure declared to be in library <code class="codeph">DS_Lib</code>.</p>
<p>Oracle Database 12<span class="italic">c</span> Release 1 (12.1) introduces two extensions to the <a id="d11137e223" class="indexterm-anchor"></a><a id="d11137e227" class="indexterm-anchor"></a><code class="codeph">CREATE LIBRARY</code> syntax: an additional optional <code class="codeph">CREDENTIAL</code> option and a <code class="codeph">DIRECTORY</code> object option. The credential option specifies the credentials of the operating system user that the <code class="codeph">extproc</code> agent impersonates when running an external subprogram that specifies the library. The directory object option specifies the directory where the shared library can be found.</p>
<p><a href="c_cpp_java.htm#GUID-678558E7-9F00-4957-8729-5FC33605A3FB__CBBIGHAF">Example 5-3</a> specifies a directory object option instead of a full path string; it also specifies an optional credential argument. When an external procedure call through the <code class="codeph">extproc</code> process loads the PL/SQL library, <code class="codeph">extproc</code> can authenticate and &#39;impersonate&#39; on behalf of the defined <code class="codeph">smith_credential</code> credential.</p>
<p>Note that if the directory or the credential does not exist when calling <code class="codeph">CREATE LIBRARY</code> statement, the library is created with errors.</p>
</div>
<a id="ADDCI4336"></a>
<div class="props_rev_3"><a id="GUID-4BC24ED4-0A90-407C-AD15-3C1953B7DA86"></a>
<h4 id="ADDCI-GUID-4BC24ED4-0A90-407C-AD15-3C1953B7DA86" class="sect4">Creating an Alias Library</h4>
<div>
<div class="example" id="GUID-4BC24ED4-0A90-407C-AD15-3C1953B7DA86__BGBJBCFF">
<p class="titleinexample">Example 5-1 Creating an Alias Library</p>
<pre dir="ltr">CREATE OR REPLACE LIBRARY DS_Lib AS  
     &#39;/data_cartridge_dir/libdatastream.so&#39;;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4337"></a>
<div class="props_rev_3"><a id="GUID-915DD434-73A7-4924-81E3-19367CB07529"></a>
<h4 id="ADDCI-GUID-915DD434-73A7-4924-81E3-19367CB07529" class="sect4">Specifying the Location of the Library</h4>
<div>
<div class="example" id="GUID-915DD434-73A7-4924-81E3-19367CB07529__BGBDIDHB">
<p class="titleinexample">Example 5-2 Specifying the Location of the Library Using an Environment Variable</p>
<pre dir="ltr">CREATE OR REPLACE LIBRARY DS_Lib AS 
  &#39;${DS_LIB_HOME}/libdatastream.so&#39; AGENT &#39;agent_link&#39;;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI5185"></a>
<div class="props_rev_3"><a id="GUID-678558E7-9F00-4957-8729-5FC33605A3FB"></a>
<h4 id="ADDCI-GUID-678558E7-9F00-4957-8729-5FC33605A3FB" class="sect4">Creating an Alias Library through Directory Objects</h4>
<div>
<div class="example" id="GUID-678558E7-9F00-4957-8729-5FC33605A3FB__CBBIGHAF">
<p class="titleinexample">Example 5-3 Creating an Alias Library Using the Directory Object Option</p>
<pre dir="ltr">CREATE OR REPLACE LIBRARY DS_Lib AS 
  &#39;libdatastream.so&#39; IN data_cartridge_dir AGENT &#39;sales.hq.example.com&#39; 
  CREDENTIAL smith_credential;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
</div>
<a id="ADDCI4334"></a>
<div class="props_rev_3"><a id="GUID-79C1B923-69CA-4C4B-9DE7-616B0D15FF0A"></a>
<h2 id="ADDCI-GUID-79C1B923-69CA-4C4B-9DE7-616B0D15FF0A" class="sect2">External Procedures</h2>
<div>
<p>PL/SQL is a powerful language for database programming, but some methods are too complex to code optimally in PL/SQL. For example, a routine to perform numeric integration probably runs faster if it is implemented in C rather than PL/SQL.</p>
<p>To support such special-purpose processing, PL/SQL provides an interface for calling routines written in other languages. This makes the strengths and capabilities of 3GLs, like C, available through calls from a database server. Such a 3GL routine is called an <span class="bold">external procedure</span>; it is stored in a shared library, registered with PL/SQL, and called from PL/SQL at run time.</p>
<p>External procedures are an important tool for data cartridge developers. They can be used not only to write fast, efficient, computation-intensive routines for cartridge types, but also to integrate existing code with the database as data cartridges. Existing shared libraries from other languages, such as a Windows NT DLL with C routines to perform format conversions for audio files, can be called directly from a method in a type implemented by an audio cartridge. Similarly, you can use external procedures to process signals, drive devices, analyze data streams, render graphics, or process numeric data.</p>
<div class="infoboxnotealso" id="GUID-79C1B923-69CA-4C4B-9DE7-616B0D15FF0A__GUID-0140496B-4D6F-4EA4-BC4D-D0953966B461">
<p class="notep1">See Also:</p>
<p><a class="olink LNPLS" target="_blank" href="../LNPLS/toc.htm"><span class="italic">PL/SQL User&#39;s Guide and Reference</span></a> for details on external procedures and their use</p>
</div>
</div>
<a id="ADDCI4338"></a>
<div class="props_rev_3"><a id="GUID-BA57EC81-16E5-4552-B3B1-B44344D2F8C0"></a>
<h3 id="ADDCI-GUID-BA57EC81-16E5-4552-B3B1-B44344D2F8C0" class="sect3">Registering an External Procedure</h3>
<div>
<div class="section">
<p>To call an external procedure, you must not only instruct PL/SQL regarding the alias library where the external procedure is defined, but also how to call this procedure and what arguments to pass to it.</p>
<p>The <code class="codeph">DataStream</code> type was defined in <a href="obj_types.htm#GUID-B738D559-6FBE-4498-B17C-406A61CF4C2A__CHDGIJCD">Example 3-1</a>, and <a href="obj_types.htm#GUID-48197D66-061D-4480-ACE6-25105E1E87B7__CHDDCIDI">Example 3-2</a> defined methods o f <code class="codeph">DataStream</code> by calling functions from the <code class="codeph">DS_Package</code> package, which is specified in <a href="pl_sql.htm#GUID-9CD9E04E-3F24-4965-B5BA-84C778083C44__CIHBEFGH">Example 4-9</a>. <a href="c_cpp_java.htm#GUID-E6794990-73B3-46FB-BB52-F9DC8E1329DA__BGBCCFEE">Example 5-4</a> defines the body of this package.</p>
<p>Note that in the <code class="codeph">PACKAGE</code> <code class="codeph">BODY</code> declaration clause, the package functions are tied to external procedures in a shared library. The <code class="codeph">EXTERNAL</code> clause in the function declaration registers information about the external procedure, such as its name (found after the <code class="codeph">NAME</code> keyword), its location (which must be an alias library, following the <code class="codeph">LIBRARY</code> keyword), the language in which the external procedure is written (following the <code class="codeph">LANGUAGE</code> keyword), and so on.</p>
<p>The final part of the <code class="codeph">EXTERNAL</code> clause in the example is the <code class="codeph">WITH</code> <code class="codeph">CONTEXT</code> specification. Here, a context pointer is passed to the external procedure. The context pointer is opaque to the external procedure, but is available so that the external procedure can call back to the Oracle server, to potentially access more data in the same transaction context.</p>
<p>Although the example describes external procedure calls from object type methods, a data cartridge can use external procedures from a variety of other places in PL/SQL. External procedure calls can appear in:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Anonymous blocks</p>
</li>
<li>
<p>Standalone and packaged subprograms</p>
</li>
<li>
<p>Methods of an object type</p>
</li>
<li>
<p>Database triggers</p>
</li>
<li>
<p>SQL statements (calls to packaged functions only)</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-BA57EC81-16E5-4552-B3B1-B44344D2F8C0__GUID-44334198-4349-4F76-9927-3FFA30BE6BA0">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p>Description of the parameters that can accompany an <code class="codeph">EXTERNAL</code> clause in <a class="olink LNPLS" target="_blank" href="../LNPLS/toc.htm"><span class="italic">PL/SQL User&#39;s Guide and Reference.</span></a></p>
<p>Information about external procedures and formatting the call specification when passing an object type to a C routine in <a class="olink ADFNS" target="_blank" href="../ADFNS/toc.htm"><span class="variable">Oracle Database Advanced Application Developer&#39;s Guide</span></a></p>
</li>
<li>
<p>The <code class="codeph">WITH</code> <code class="codeph">CONTEXT</code> clause in <span class="q">&#34;<a href="c_cpp_java.htm#GUID-86F5E74D-1E92-4B39-ADB2-686A949FBB85">Using the WITH CONTEXT Clause</a>&#34;</span>.</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
<a id="ADDCI4339"></a>
<div class="props_rev_3"><a id="GUID-E6794990-73B3-46FB-BB52-F9DC8E1329DA"></a>
<h4 id="ADDCI-GUID-E6794990-73B3-46FB-BB52-F9DC8E1329DA" class="sect4">Defining the Body of a Package</h4>
<div>
<div class="example" id="GUID-E6794990-73B3-46FB-BB52-F9DC8E1329DA__BGBCCFEE">
<p class="titleinexample">Example 5-4 Defining the Body of a Package</p>
<pre dir="ltr">CREATE OR REPLACE PACKAGE BODY DS_Package AS 
     FUNCTION DS_Findmin(data  CLOB) RETURN PLS_INTEGER IS EXTERNAL 
     NAME &#34;c_findmin&#34; LIBRARY DS_Lib LANGUAGE C WITH CONTEXT; 
     FUNCTION DS_Findmax(data CLOB) RETURN PLS_INTEGER IS EXTERNAL 
     NAME &#34;c_findmax&#34; LIBRARY DS_Lib LANGUAGE C WITH CONTEXT; 
   END;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
</div>
<a id="ADDCI4341"></a><a id="ADDCI4340"></a>
<div class="props_rev_3"><a id="GUID-DE8AA72F-72D5-4569-902D-67B9B2DC214D"></a>
<h2 id="ADDCI-GUID-DE8AA72F-72D5-4569-902D-67B9B2DC214D" class="sect2">How PL/SQL Calls an External Procedure</h2>
<div>
<p><a id="d11137e783" class="indexterm-anchor"></a>To call an external procedure, PL/SQL must know the DLL or shared library in which the procedure resides. PL/SQL looks up the alias library in the <code class="codeph">EXTERNAL</code> clause of the subprogram that registered the external procedure. The data dictionary is used to determine the actual path to the operating system shared library or DLL.</p>
<p>PL/SQL alerts a Listener process, which in turn starts a session-specific agent. Unless some other particular agent has been designated either in the <code class="codeph">CREATE LIBRARY</code> statement for the procedure&#39;s specified library or in the agent argument of the <code class="codeph">CREATE PROCEDURE</code> statement, the default agent <code class="codeph">extproc</code> is launched. The Listener hands over the connection to the agent. PL/SQL passes the agent the name of the DLL, the name of the external procedure, and any parameters passed in by the caller. The rest of this account assumes that the agent launched is the default agent <code class="codeph">extproc</code>.</p>
<p>After receiving the name of the DLL and the external procedure, <code class="codeph">extproc</code> loads the DLL and runs the external procedure. Also, <code class="codeph">extproc</code> handles service calls, such as raising an exception, and callbacks to the Oracle server. Finally, <code class="codeph">extproc</code> passes to PL/SQL any values returned by the external procedure. <a href="c_cpp_java.htm#GUID-DE8AA72F-72D5-4569-902D-67B9B2DC214D__I1004696">Figure 5-1</a> shows the flow of control.</p>
<div class="figure" id="GUID-DE8AA72F-72D5-4569-902D-67B9B2DC214D__I1004696">
<p class="titleinfigure">Figure 5-1 Calling an External Procedure</p>
<img width="491" height="222" src="img/GUID-5FF864E1-56D5-423A-B1C5-A32879150283-default.gif" alt="Description of Figure 5-1 follows" title="Description of Figure 5-1 follows"/><br/>
<a href="img_text/GUID-5FF864E1-56D5-423A-B1C5-A32879150283-print.htm">Description of &#34;Figure 5-1 Calling an External Procedure&#34;</a></div>
<!-- class="figure" -->
<p>After the external procedure completes, <code class="codeph">extproc</code> remains active throughout your Oracle session. Thus, you incur the cost of spawning <code class="codeph">extproc</code> only one time, no matter how many calls you make. Still, you should call an external procedure only when the computational benefits outweigh the cost. When you log off, <code class="codeph">extproc</code> is killed.</p>
<p>Note that the Listener must start <code class="codeph">extproc</code> on the system that runs the Oracle server. Starting <code class="codeph">extproc</code> on a different system is not supported.</p>
<div class="infoboxnotealso" id="GUID-DE8AA72F-72D5-4569-902D-67B9B2DC214D__GUID-68D20B48-C0FE-4C3F-9281-344843CD36BB">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink LNPLS-GUID-2FBCFBBE-6B42-4DB8-83F3-55B63B75B1EB" target="_blank" href="../LNPLS/overview.htm#LNPLS-GUID-2FBCFBBE-6B42-4DB8-83F3-55B63B75B1EB"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information on using dedicated external procedure agents to run an external procedure</p>
</li>
<li>
<p><a class="olink ADMIN-GUID-DA5E72EA-46BF-4069-9185-393D939F1F77" target="_blank" href="../ADMIN/manproc.htm#ADMIN-GUID-DA5E72EA-46BF-4069-9185-393D939F1F77"><span class="italic">Oracle Database Administrator&#39;s Guide.</span></a> for information about administering <code class="codeph">extproc</code> and external procedure call</p>
</li>
</ul>
</div>
</div>
</div>
<a id="ADDCI4342"></a>
<div class="props_rev_3"><a id="GUID-5ED2C419-E343-4F22-A2D2-94669BC2BA98"></a>
<h2 id="ADDCI-GUID-5ED2C419-E343-4F22-A2D2-94669BC2BA98" class="sect2">Configuring Files for External Procedures</h2>
<div>
<p>The configuration files <code class="codeph">listener.ora</code> and <code class="codeph">tnsnames.ora</code> must have appropriate entries, so that the Listener can dispatch the external procedures.</p>
<p>The Listener configuration file <code class="codeph">listener.ora</code> must have a <code class="codeph">SID_DESC</code> entry for the external procedure, as demonstrated in <a href="c_cpp_java.htm#GUID-F0078766-0B1C-473F-89F5-727B7D15F74C__BGBJEEGF">Example 5-5</a>.</p>
<p><a href="c_cpp_java.htm#GUID-F0078766-0B1C-473F-89F5-727B7D15F74C__BGBJEEGF">Example 5-5</a> assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The Oracle instance is called <code class="codeph">o10</code>.</p>
</li>
<li>
<p>The system or node on which the Oracle server runs is named <code class="codeph">unix123</code>.</p>
</li>
<li>
<p>The installation directory for the Oracle server is <code class="codeph">/rdbms/u01</code>.</p>
</li>
<li>
<p>The port number for Oracle TCP/IP communication is the default Listener port <code class="codeph">1521</code>.</p>
</li>
</ul>
<p>The <code class="codeph">tnsnames.ora</code> file is the network substrate configuration file, and it must also be updated to refer to the external procedure, as demonstrated in <a href="c_cpp_java.htm#GUID-E62E6E16-7C08-46A8-B468-F2382C9A4A57__BGBBGEFC">Example 5-6</a>.</p>
<p><a href="c_cpp_java.htm#GUID-E62E6E16-7C08-46A8-B468-F2382C9A4A57__BGBBGEFC">Example 5-6</a> assumes that IPC mechanisms are used to communicate with the external procedure. You can also use, for example, TCP/IP for communication, in which case the <code class="codeph">PROTOCOL</code> parameter must be set to <code class="codeph">tcp</code>.</p>
<div class="infoboxnotealso" id="GUID-5ED2C419-E343-4F22-A2D2-94669BC2BA98__GUID-F52B1657-942B-4C5F-AD07-973A4AE034A5">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN" target="_blank" href="../ADMIN/toc.htm"><span class="variable">Oracle Database Administrator&#39;s Guide</span></a> for more information about configuring the <code class="codeph">listener.ora</code> and <code class="codeph">tnsnames.ora</code> files</p>
</div>
</div>
<a id="ADDCI4343"></a>
<div class="props_rev_3"><a id="GUID-F0078766-0B1C-473F-89F5-727B7D15F74C"></a>
<h3 id="ADDCI-GUID-F0078766-0B1C-473F-89F5-727B7D15F74C" class="sect3">Updating the Listener Configuration File</h3>
<div>
<div class="example" id="GUID-F0078766-0B1C-473F-89F5-727B7D15F74C__BGBJEEGF">
<p class="titleinexample">Example 5-5 Setting the SID_DESC Entry in the Listener Configuration FIle</p>
<pre dir="ltr"># Listener configuration file  
# This file is generated by stkconf.tsc  
 
CONNECT_TIMEOUT_LISTENER = 0  
 
LISTENER = (ADDRESS_LIST=  
  (ADDRESS=(PROTOCOL=ipc)(KEY=o10))  
  (ADDRESS=(PROTOCOL=tcp)(HOST=unix123)(PORT=1521))  
)

SID_LIST_LISTENER = (SID_LIST=   
  SID_DESC=(SID_NAME=o10)(ORACLE_HOME=/rdbms/u01/app/oracle/product/11.2.0.1.0) 
  SID_DESC=(SID_NAME=extproc)
           (ORACLE_HOME=/rdbms/u01/app/oracle/product/11.2.0.1.0)
  (PROGRAM=extproc))  
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4344"></a>
<div class="props_rev_3"><a id="GUID-E62E6E16-7C08-46A8-B468-F2382C9A4A57"></a>
<h3 id="ADDCI-GUID-E62E6E16-7C08-46A8-B468-F2382C9A4A57" class="sect3">Directing Network to Refer to External Procedures</h3>
<div>
<div class="example" id="GUID-E62E6E16-7C08-46A8-B468-F2382C9A4A57__BGBBGEFC">
<p class="titleinexample">Example 5-6 Updating the Network Substrate Configuration to Refer to External Procedures</p>
<pre dir="ltr">o10 = (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=unix123)(PORT=1521))
  (CONNECT_DATA=(SID=o10)))
extproc_connection_data = (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=o10))
  CONNECT_DATA=(SID=extproc)))
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4345"></a>
<div class="props_rev_3"><a id="GUID-4E35A385-1E42-4C5C-9F9C-25A1993AA5A1"></a>
<h3 id="ADDCI-GUID-4E35A385-1E42-4C5C-9F9C-25A1993AA5A1" class="sect3">Passing Parameters to an External Procedure</h3>
<div>
<p><a id="d11137e1160" class="indexterm-anchor"></a>Passing parameters to an external procedure is complicated by several circumstances:</p>
<ul style="list-style-type: disc;">
<li>
<p>The set of PL/SQL data types does not correspond one-to-one with the set of C data types.</p>
</li>
<li>
<p>PL/SQL parameters can be <code class="codeph">null</code>, whereas C parameters cannot. Unlike C, PL/SQL includes the RDBMS concept of nullity.</p>
</li>
<li>
<p>The external procedure might need the current length or maximum length of <code class="codeph">CHAR</code>, <code class="codeph">LONG</code> <code class="codeph">RAW</code>, <code class="codeph">RAW</code>, and <code class="codeph">VARCHAR2</code> parameters.</p>
</li>
<li>
<p>The external procedure might need character set information about <code class="codeph">CHAR</code>, <code class="codeph">VARCHAR2</code>, and <code class="codeph">CLOB</code> parameters.</p>
</li>
<li>
<p>PL/SQL might need the current length, maximum length, or null status of values returned by the external procedure.</p>
</li>
</ul>
<p>Consider how to best specify a parameter list that deals with these circumstances. An example of parameter passing is shown in <a href="c_cpp_java.htm#GUID-FE168081-19E5-4991-87C2-40E68995850D__BGBBAJIF">Example 5-7</a>, where the package function <code class="codeph">DS_Findmin(data CLOB)</code> calls the C routine <code class="codeph">c_findmin</code> and the <code class="codeph">CLOB</code> argument is passed to the C routine as an <code class="codeph">OCILobLocator()</code>.</p>
</div>
</div>
<a id="ADDCI4346"></a>
<div class="props_rev_3"><a id="GUID-60D44FC3-8ACB-4F0C-8BC5-574E4B634EE8"></a>
<h3 id="ADDCI-GUID-60D44FC3-8ACB-4F0C-8BC5-574E4B634EE8" class="sect3">Specifying Data Types</h3>
<div>
<p><a id="d11137e1282" class="indexterm-anchor"></a>You do not pass parameters to an external procedure directly. Instead, you pass them to the PL/SQL subprogram that registered the external procedure. So, you must specify PL/SQL data types for the parameters. <a href="c_cpp_java.htm#GUID-3AF73F62-7599-47D9-9F0D-20BCD54F0974__G1012384" title="Specifies the mappings from PL/SQL datatypes to supported and default external datatypes">Table 5-1</a> maps each PL/SQL data type to a default external data type. The external data types map to C data type.</p>
<p>In some cases, you can use the <code class="codeph">PARAMETERS</code> clause to override the default data type mappings. For example, you can re-map the PL/SQL data type <code class="codeph">BOOLEAN</code> from external data type <code class="codeph">INT</code> to external data type <code class="codeph">CHAR</code>.</p>
<p>To avoid errors when declaring C prototype parameters, refer to <a href="c_cpp_java.htm#GUID-761FA89E-AA1B-4623-B8D0-214B977CA7B1__G1012786" title="Specifies the C datatype to use for external datatypes and PL/SQL parameter mode">Table 5-2</a>, which shows the C data type to specify for a given external data type and PL/SQL parameter mode. For example, if the external data type of an <code class="codeph">OUT</code> parameter is <code class="codeph">CHAR</code>, specify the data type <code class="codeph">char*</code> in your C prototype.</p>
</div>
<a id="ADDCI4347"></a>
<div class="props_rev_3"><a id="GUID-3AF73F62-7599-47D9-9F0D-20BCD54F0974"></a>
<h4 id="ADDCI-GUID-3AF73F62-7599-47D9-9F0D-20BCD54F0974" class="sect4">Conversion to External Datatypes</h4>
<div>
<div class="tblformal" id="GUID-3AF73F62-7599-47D9-9F0D-20BCD54F0974__G1012384">
<p class="titleintable">Table 5-1 Parameter Datatype Mappings</p>
<table class="cellalignment5987" title="Parameter Datatype Mappings " summary="Specifies the mappings from PL/SQL datatypes to supported and default external datatypes">
<thead>
<tr class="cellalignment5978">
<th class="cellalignment6004" id="d11137e1384">PL/SQL Type</th>
<th class="cellalignment6078" id="d11137e1387">Supported External Types</th>
<th class="cellalignment6079" id="d11137e1390">Default External Type</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5978">
<td class="cellalignment6006" id="d11137e1395" headers="d11137e1384">
<pre dir="ltr">BINARY_INTEGER,
BOOLEAN,
PLS_INTEGER 
</pre></td>
<td class="cellalignment6080" headers="d11137e1395 d11137e1387">
<pre dir="ltr">CHAR, UNSIGNED CHAR, SHORT, UNSIGNED
 SHORT, INT, UNSIGNED INT, LONG,
 UNSIGNED LONG, SB1, UB1, SB2, UB2, 
 SB4, UB4, SIZE_T
</pre></td>
<td class="cellalignment6081" headers="d11137e1395 d11137e1390">
<pre dir="ltr">INT
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6006" id="d11137e1405" headers="d11137e1384">
<pre dir="ltr">NATURAL, NATURALN, 
POSITIVE,
POSITIVEN, 
SIGNTYPE
</pre></td>
<td class="cellalignment6080" headers="d11137e1405 d11137e1387">
<pre dir="ltr">CHAR, UNSIGNED CHAR, SHORT, UNSIGNED
 SHORT, INT, UNSIGNED INT, LONG,
 UNSIGNED LONG, SB1, UB1, SB2 ,UB2,
 SB4, UB4, SIZE_T
</pre></td>
<td class="cellalignment6081" headers="d11137e1405 d11137e1390">
<pre dir="ltr">UNSIGNED INT
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6006" id="d11137e1415" headers="d11137e1384">
<pre dir="ltr">FLOAT, REAL
</pre></td>
<td class="cellalignment6080" headers="d11137e1415 d11137e1387">
<pre dir="ltr">FLOAT
</pre></td>
<td class="cellalignment6081" headers="d11137e1415 d11137e1390">
<pre dir="ltr">FLOAT
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6006" id="d11137e1425" headers="d11137e1384">
<pre dir="ltr">DOUBLE PRECISION
</pre></td>
<td class="cellalignment6080" headers="d11137e1425 d11137e1387">
<pre dir="ltr">DOUBLE
</pre></td>
<td class="cellalignment6081" headers="d11137e1425 d11137e1390">
<pre dir="ltr">DOUBLE
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6006" id="d11137e1435" headers="d11137e1384">
<pre dir="ltr">CHAR, CHARACTER,
LONG, ROWID, VARCHAR, VARCHAR2 
</pre></td>
<td class="cellalignment6080" headers="d11137e1435 d11137e1387">
<pre dir="ltr">STRING
</pre></td>
<td class="cellalignment6081" headers="d11137e1435 d11137e1390">
<pre dir="ltr">STRING
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6006" id="d11137e1445" headers="d11137e1384">
<pre dir="ltr">LONG RAW, RAW
</pre></td>
<td class="cellalignment6080" headers="d11137e1445 d11137e1387">
<pre dir="ltr">RAW
</pre></td>
<td class="cellalignment6081" headers="d11137e1445 d11137e1390">
<pre dir="ltr">RAW
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6006" id="d11137e1455" headers="d11137e1384">
<pre dir="ltr">BFILE, BLOB, CLOB
</pre></td>
<td class="cellalignment6080" headers="d11137e1455 d11137e1387">
<pre dir="ltr">OCILOBLOCATOR
</pre></td>
<td class="cellalignment6081" headers="d11137e1455 d11137e1390">
<pre dir="ltr">OCILOBLOCATOR
</pre></td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="ADDCI4348"></a>
<div class="props_rev_3"><a id="GUID-761FA89E-AA1B-4623-B8D0-214B977CA7B1"></a>
<h4 id="ADDCI-GUID-761FA89E-AA1B-4623-B8D0-214B977CA7B1" class="sect4">Conversion from External Datatypes</h4>
<div>
<div class="tblformal" id="GUID-761FA89E-AA1B-4623-B8D0-214B977CA7B1__G1012786">
<p class="titleintable">Table 5-2 External Data Type Mappings</p>
<table class="cellalignment5987" title="External Data Type Mappings" summary="Specifies the C datatype to use for external datatypes and PL/SQL parameter mode">
<thead>
<tr class="cellalignment5978">
<th class="cellalignment6034" id="d11137e1527">External Data Type</th>
<th class="cellalignment6034" id="d11137e1530">IN, RETURN</th>
<th class="cellalignment6082" id="d11137e1535">IN by Reference, RETURN by Reference</th>
<th class="cellalignment6082" id="d11137e1540">IN OUT, OUT</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1547" headers="d11137e1527">
<pre dir="ltr">CHAR
</pre></td>
<td class="cellalignment6036" headers="d11137e1547 d11137e1530">
<pre dir="ltr">char
</pre></td>
<td class="cellalignment6083" headers="d11137e1547 d11137e1535">
<pre dir="ltr">char *
</pre></td>
<td class="cellalignment6083" headers="d11137e1547 d11137e1540">
<pre dir="ltr">char *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1560" headers="d11137e1527">
<pre dir="ltr">UNSIGNED CHAR
</pre></td>
<td class="cellalignment6036" headers="d11137e1560 d11137e1530">
<pre dir="ltr">unsigned char
</pre></td>
<td class="cellalignment6083" headers="d11137e1560 d11137e1535">
<pre dir="ltr">unsigned char *
</pre></td>
<td class="cellalignment6083" headers="d11137e1560 d11137e1540">
<pre dir="ltr">unsigned char *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1573" headers="d11137e1527">
<pre dir="ltr">SHORT
</pre></td>
<td class="cellalignment6036" headers="d11137e1573 d11137e1530">
<pre dir="ltr">short
</pre></td>
<td class="cellalignment6083" headers="d11137e1573 d11137e1535">
<pre dir="ltr">short *
</pre></td>
<td class="cellalignment6083" headers="d11137e1573 d11137e1540">
<pre dir="ltr">short *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1586" headers="d11137e1527">
<pre dir="ltr">UNSIGNED SHORT
</pre></td>
<td class="cellalignment6036" headers="d11137e1586 d11137e1530">
<pre dir="ltr">unsigned short
</pre></td>
<td class="cellalignment6083" headers="d11137e1586 d11137e1535">
<pre dir="ltr">unsigned short *
</pre></td>
<td class="cellalignment6083" headers="d11137e1586 d11137e1540">
<pre dir="ltr">unsigned short *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1599" headers="d11137e1527">
<pre dir="ltr">INT
</pre></td>
<td class="cellalignment6036" headers="d11137e1599 d11137e1530">
<pre dir="ltr">int
</pre></td>
<td class="cellalignment6083" headers="d11137e1599 d11137e1535">
<pre dir="ltr">int *
</pre></td>
<td class="cellalignment6083" headers="d11137e1599 d11137e1540">
<pre dir="ltr">int *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1612" headers="d11137e1527">
<pre dir="ltr">UNSIGNED INT
</pre></td>
<td class="cellalignment6036" headers="d11137e1612 d11137e1530">
<pre dir="ltr">unsigned int
</pre></td>
<td class="cellalignment6083" headers="d11137e1612 d11137e1535">
<pre dir="ltr">unsigned int *
</pre></td>
<td class="cellalignment6083" headers="d11137e1612 d11137e1540">
<pre dir="ltr">unsigned int *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1625" headers="d11137e1527">
<pre dir="ltr">LONG
</pre></td>
<td class="cellalignment6036" headers="d11137e1625 d11137e1530">
<pre dir="ltr">long
</pre></td>
<td class="cellalignment6083" headers="d11137e1625 d11137e1535">
<pre dir="ltr">long *
</pre></td>
<td class="cellalignment6083" headers="d11137e1625 d11137e1540">
<pre dir="ltr">long *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1638" headers="d11137e1527">
<pre dir="ltr">UNSIGNED LONG
</pre></td>
<td class="cellalignment6036" headers="d11137e1638 d11137e1530">
<pre dir="ltr">unsigned long
</pre></td>
<td class="cellalignment6083" headers="d11137e1638 d11137e1535">
<pre dir="ltr">unsigned long *
</pre></td>
<td class="cellalignment6083" headers="d11137e1638 d11137e1540">
<pre dir="ltr">unsigned long *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1651" headers="d11137e1527">
<pre dir="ltr">SIZE_T
</pre></td>
<td class="cellalignment6036" headers="d11137e1651 d11137e1530">
<pre dir="ltr">size_t
</pre></td>
<td class="cellalignment6083" headers="d11137e1651 d11137e1535">
<pre dir="ltr">size_t *
</pre></td>
<td class="cellalignment6083" headers="d11137e1651 d11137e1540">
<pre dir="ltr">size_t *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1664" headers="d11137e1527">
<pre dir="ltr">SB1
</pre></td>
<td class="cellalignment6036" headers="d11137e1664 d11137e1530">
<pre dir="ltr">sb1
</pre></td>
<td class="cellalignment6083" headers="d11137e1664 d11137e1535">
<pre dir="ltr">sb1 *
</pre></td>
<td class="cellalignment6083" headers="d11137e1664 d11137e1540">
<pre dir="ltr">sb1 *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1677" headers="d11137e1527">
<pre dir="ltr">UB1
</pre></td>
<td class="cellalignment6036" headers="d11137e1677 d11137e1530">
<pre dir="ltr">ub1
</pre></td>
<td class="cellalignment6083" headers="d11137e1677 d11137e1535">
<pre dir="ltr">ub1 *
</pre></td>
<td class="cellalignment6083" headers="d11137e1677 d11137e1540">
<pre dir="ltr">ub1 *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1691" headers="d11137e1527">
<pre dir="ltr">SB2
</pre></td>
<td class="cellalignment6036" headers="d11137e1691 d11137e1530">
<pre dir="ltr">sb2
</pre></td>
<td class="cellalignment6083" headers="d11137e1691 d11137e1535">
<pre dir="ltr">sb2 *
</pre></td>
<td class="cellalignment6083" headers="d11137e1691 d11137e1540">
<pre dir="ltr">sb2 *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1704" headers="d11137e1527">
<pre dir="ltr">UB2
</pre></td>
<td class="cellalignment6036" headers="d11137e1704 d11137e1530">
<pre dir="ltr">ub2
</pre></td>
<td class="cellalignment6083" headers="d11137e1704 d11137e1535">
<pre dir="ltr">ub2 *
</pre></td>
<td class="cellalignment6083" headers="d11137e1704 d11137e1540">
<pre dir="ltr">ub2 *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1717" headers="d11137e1527">
<pre dir="ltr">SB4
</pre></td>
<td class="cellalignment6036" headers="d11137e1717 d11137e1530">
<pre dir="ltr">sb4
</pre></td>
<td class="cellalignment6083" headers="d11137e1717 d11137e1535">
<pre dir="ltr">sb4 *
</pre></td>
<td class="cellalignment6083" headers="d11137e1717 d11137e1540">
<pre dir="ltr">sb4 *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1730" headers="d11137e1527">
<pre dir="ltr">UB4
</pre></td>
<td class="cellalignment6036" headers="d11137e1730 d11137e1530">
<pre dir="ltr">ub4
</pre></td>
<td class="cellalignment6083" headers="d11137e1730 d11137e1535">
<pre dir="ltr">ub4 *
</pre></td>
<td class="cellalignment6083" headers="d11137e1730 d11137e1540">
<pre dir="ltr">ub4 *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1743" headers="d11137e1527">
<pre dir="ltr">FLOAT
</pre></td>
<td class="cellalignment6036" headers="d11137e1743 d11137e1530">
<pre dir="ltr">float
</pre></td>
<td class="cellalignment6083" headers="d11137e1743 d11137e1535">
<pre dir="ltr">float *
</pre></td>
<td class="cellalignment6083" headers="d11137e1743 d11137e1540">
<pre dir="ltr">float *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1756" headers="d11137e1527">
<pre dir="ltr">DOUBLE
</pre></td>
<td class="cellalignment6036" headers="d11137e1756 d11137e1530">
<pre dir="ltr">double
</pre></td>
<td class="cellalignment6083" headers="d11137e1756 d11137e1535">
<pre dir="ltr">double *
</pre></td>
<td class="cellalignment6083" headers="d11137e1756 d11137e1540">
<pre dir="ltr">double *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1769" headers="d11137e1527">
<pre dir="ltr">STRING
</pre></td>
<td class="cellalignment6036" headers="d11137e1769 d11137e1530">
<pre dir="ltr">char *
</pre></td>
<td class="cellalignment6083" headers="d11137e1769 d11137e1535">
<pre dir="ltr">char *
</pre></td>
<td class="cellalignment6083" headers="d11137e1769 d11137e1540">
<pre dir="ltr">char *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1782" headers="d11137e1527">
<pre dir="ltr">RAW
</pre></td>
<td class="cellalignment6036" headers="d11137e1782 d11137e1530">
<pre dir="ltr">unsigned char *
</pre></td>
<td class="cellalignment6083" headers="d11137e1782 d11137e1535">
<pre dir="ltr">unsigned char *
</pre></td>
<td class="cellalignment6083" headers="d11137e1782 d11137e1540">
<pre dir="ltr">unsigned char *
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6036" id="d11137e1795" headers="d11137e1527">
<pre dir="ltr">OCILOBLOCATOR
</pre></td>
<td class="cellalignment6036" headers="d11137e1795 d11137e1530">
<pre dir="ltr">OCILobLocator *
</pre></td>
<td class="cellalignment6083" headers="d11137e1795 d11137e1535">
<pre dir="ltr">OCILobLocator *
</pre></td>
<td class="cellalignment6083" headers="d11137e1795 d11137e1540">
<pre dir="ltr">OCILobLocator **
</pre></td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
</div>
<a id="ADDCI4349"></a>
<div class="props_rev_3"><a id="GUID-D6DB3026-1A29-45F4-94E2-D5EB0703A9E7"></a>
<h3 id="ADDCI-GUID-D6DB3026-1A29-45F4-94E2-D5EB0703A9E7" class="sect3">Using the Parameters Clause</h3>
<div>
<p>You can optionally use the <code class="codeph">PARAMETERS</code> clause to pass additional information about PL/SQL formal parameters and function return values to an external procedure. You can also use this clause to reposition parameters.</p>
<div class="infoboxnotealso" id="GUID-D6DB3026-1A29-45F4-94E2-D5EB0703A9E7__GUID-911AD847-B3B7-4D81-A076-497600B094EC">
<p class="notep1">See Also:</p>
<p><a class="olink LNPLS" target="_blank" href="../LNPLS/toc.htm"><span class="italic">Oracle Database PL/SQL Language Reference.</span></a></p>
</div>
</div>
</div>
<a id="ADDCI4350"></a>
<div class="props_rev_3"><a id="GUID-86F5E74D-1E92-4B39-ADB2-686A949FBB85"></a>
<h3 id="ADDCI-GUID-86F5E74D-1E92-4B39-ADB2-686A949FBB85" class="sect3">Using the WITH CONTEXT Clause</h3>
<div>
<p><a id="d11137e1930" class="indexterm-anchor"></a><a id="d11137e1934" class="indexterm-anchor"></a><a id="d11137e1936" class="indexterm-anchor"></a>When launched, an external procedure must access the database. For example, <code class="codeph">DS_Findmin</code> does not copy the entire <code class="codeph">CLOB</code> data over to <code class="codeph">c_findmin</code>, because doing so would vastly increase the amount of stack that the C routine needs. Instead, the PL/SQL function just passes a <code class="codeph">LOB</code> locator to the C routine, with the intent that the database is accessed again from C to read the actual <code class="codeph">LOB</code> data.</p>
<p>When the C routine reads the data, it can use the OCI buffering and streaming interfaces associated with LOBs, so that only incremental amounts of stack are needed. Such re-access of the database from an external procedure is known as a <strong class="term">callback</strong>.</p>
<p>To be able to call back to a database, you must use the <code class="codeph">WITH</code> <code class="codeph">CONTEXT</code> clause to give the external procedure access to the database environment, service, and error handles. When an external procedure is called using <code class="codeph">WITH</code> <code class="codeph">CONTEXT</code>, the corresponding C routine automatically gets an argument of type <code class="codeph">OCIExtProcContext</code>* as its first parameter. The order of the parameters can be changed using the <code class="codeph">PARAMETERS</code> clause. You can use this context pointer to fetch the handles using the <code class="codeph">OCIExtProcGetEnv</code> call, and then call back to the database. This procedure is shown in <a href="c_cpp_java.htm#GUID-FE168081-19E5-4991-87C2-40E68995850D__BGBBAJIF">Example 5-7</a>.</p>
<div class="infoboxnotealso" id="GUID-86F5E74D-1E92-4B39-ADB2-686A949FBB85__GUID-D86B5331-BED5-43E3-9FB9-07B503FF7C71">
<p class="notep1">See Also:</p>
<p><a class="olink LNOCI" target="_blank" href="../LNOCI/toc.htm"><span class="variable">Oracle Call Interface Programmer&#39;s Guide</span></a> for details about OCI callbacks</p>
</div>
</div>
</div>
</div>
<a id="ADDCI4352"></a><a id="ADDCI4351"></a>
<div class="props_rev_3"><a id="GUID-FE168081-19E5-4991-87C2-40E68995850D"></a>
<h2 id="ADDCI-GUID-FE168081-19E5-4991-87C2-40E68995850D" class="sect2">Using Callbacks</h2>
<div>
<p>An external procedure that runs on the Oracle server can call the access function <code class="codeph">OCIExtProcGetEnv()</code> to obtain the OCI environment and service handles. With the OCI, you can use callbacks to execute SQL statements and PL/SQL subprograms, fetch data, and manipulate LOBs. Moreover, callbacks and external procedures operate in the same user session and transaction context, so they have the same user privileges.</p>
<p><a href="c_cpp_java.htm#GUID-FE168081-19E5-4991-87C2-40E68995850D__BGBBAJIF">Example 5-7</a> is a version of <code class="codeph">c_findmin</code> that is simplified to illustrate callbacks.</p>
<div class="example" id="GUID-FE168081-19E5-4991-87C2-40E68995850D__BGBBAJIF">
<p class="titleinexample">Example 5-7 Using Callbacks</p>
<pre dir="ltr">Static  OCIEnv   *envhp;
Static  OCISvcCtx  *svchp;
Static OCIError   *errhp;
Int   c_findmin (OCIExtProcContext *ctx, OCILobLocator  *lobl) {
sword  retval;
retval = OCIExtProcGetEnv (ctx, &amp;envhp, &amp;svchp, &amp;errhp);
if ((retval != OCI_SUCCESS) &amp;&amp; (retval !=  OCI_SUCCESS_WITH_INFO))
   exit(-1);
   /* Use lobl to read the CLOB, compute the minimum, and store the value
       in retval. */
return retval;
}
</pre></div>
<!-- class="example" --></div>
<a id="ADDCI4353"></a>
<div class="props_rev_3"><a id="GUID-E4FD7D75-72D2-4938-9F2C-C6E19A6311AD"></a>
<h3 id="ADDCI-GUID-E4FD7D75-72D2-4938-9F2C-C6E19A6311AD" class="sect3">Restrictions on Callbacks</h3>
<div>
<div class="section">
<p><a id="d11137e2122" class="indexterm-anchor"></a>With callbacks, the following SQL statements and OCI routines are not supported:</p>
<ul style="list-style-type: disc;">
<li>
<p>Transaction control statements such as <code class="codeph">COMMIT</code></p>
</li>
<li>
<p>Data definition statements such as <code class="codeph">CREATE</code></p>
</li>
<li>
<p>Object-oriented OCI routines such as <code class="codeph">OCIRefClear</code></p>
</li>
<li>
<p>Polling-mode OCI routines such as <code class="codeph">OCIGetPieceInfo</code></p>
</li>
<li>
<p>The following OCI routines:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">OCIEnvInit()</code></p>
</li>
<li>
<p><code class="codeph">OCIInitialize()</code></p>
</li>
<li>
<p><code class="codeph">OCIPasswordChange()</code></p>
</li>
<li>
<p><code class="codeph">OCIServerAttach()</code></p>
</li>
<li>
<p><code class="codeph">OCIServerDetach()</code></p>
</li>
<li>
<p><code class="codeph">OCISessionBegin ()</code></p>
</li>
<li>
<p><code class="codeph">OCISessionEnd ()</code></p>
</li>
<li>
<p><code class="codeph">OCISvcCtxToLda()</code></p>
</li>
<li>
<p><code class="codeph">OCITransCommit()</code></p>
</li>
<li>
<p><code class="codeph">OCITransDetach()</code></p>
</li>
<li>
<p><code class="codeph">OCITransRollback()</code></p>
</li>
<li>
<p><code class="codeph">OCITransStart()</code></p>
</li>
</ul>
</li>
<li>
<p>Also, with OCI routine <code class="codeph">OCIHandleAlloc()</code>, the following handle types are not supported:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">OCI_HTYPE_SERVER</code></p>
</li>
<li>
<p><code class="codeph">OCI_HTYPE_SESSION</code></p>
</li>
<li>
<p><code class="codeph">OCI_HTYPE_SVCCTX</code></p>
</li>
<li>
<p><code class="codeph">OCI_HTYPE_TRANS</code></p>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="ADDCI4354"></a>
<div class="props_rev_3"><a id="GUID-FCCDDCF8-B705-4EC0-9750-ED0789BDB58A"></a>
<h2 id="ADDCI-GUID-FCCDDCF8-B705-4EC0-9750-ED0789BDB58A" class="sect2">Common Potential Errors</h2>
<div>
<p>Consider several common errors that may occur when running external procedures.</p>
</div>
<a id="ADDCI4355"></a>
<div class="props_rev_3"><a id="GUID-57A07AE5-8EB7-4D85-A0F5-3C77CB9B35F4"></a>
<h3 id="ADDCI-GUID-57A07AE5-8EB7-4D85-A0F5-3C77CB9B35F4" class="sect3">Calls to External Functions</h3>
<div>
<div class="section">
<p>You may have specified the wrong path or wrong name for the DLL file, or you may have tried to use a DLL on a network mounted drive (a remote drive).</p>
<pre dir="ltr">Can&#39;t Find DLL
ORA-06520: PL/SQL: Error loading external library
ORA-06522: Unable to load DLL
ORA-06512: at &#34;&lt;name&gt;&#34;, line &lt;number&gt;
ORA-06512: at &#34;&lt;name&gt;&#34;, line &lt;number&gt;
ORA-06512: at line &lt;number&gt;
</pre></div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4356"></a>
<div class="props_rev_3"><a id="GUID-6638C85A-E4E4-4364-8419-5005332808B4"></a>
<h3 id="ADDCI-GUID-6638C85A-E4E4-4364-8419-5005332808B4" class="sect3">RPC Time Out</h3>
<div>
<div class="section">
<p>This error might occur after you exit a debugger while debugging a shared library or DLL. Simply disconnect your client and reconnect to the database.</p>
<pre dir="ltr">ORA-28576: lost RPC connection to external procedure agent
ORA-06512: at &#34;&lt;name&gt;&#34;, line &lt;number&gt;
ORA-06512: at &#34;&lt;name&gt;&#34;, line &lt;number&gt;
ORA-06512: at line &lt;number&gt;
</pre></div>
<!-- class="section" --></div>
</div>
</div>
<a id="ADDCI4357"></a>
<div class="props_rev_3"><a id="GUID-E4B028CC-FFD1-4B63-AF40-E09A0F465C60"></a>
<h2 id="ADDCI-GUID-E4B028CC-FFD1-4B63-AF40-E09A0F465C60" class="sect2">Debugging External Procedures</h2>
<div>
<p>Usually, when an external procedure fails, its C prototype is faulty. That is, the prototype does not match the one generated internally by PL/SQL. This can happen if you specify an incompatible C data type. For example, to pass an <code class="codeph">OUT</code> parameter of type <code class="codeph">REAL</code>, you must specify <code class="codeph">float *</code>. Specifying <code class="codeph">float</code>, <code class="codeph">double *</code>, or any other C data type, results in a mismatch.</p>
<p>In such cases, you might get a lost RPC connection to external procedure agent error, which means that agent <code class="codeph">extproc</code> terminated abnormally because the external procedure caused a core dump. To avoid errors when declaring C prototype parameters, refer to <a href="c_cpp_java.htm#GUID-761FA89E-AA1B-4623-B8D0-214B977CA7B1__G1012786" title="Specifies the C datatype to use for external datatypes and PL/SQL parameter mode">Table 5-2</a>.</p>
</div>
<a id="ADDCI4358"></a>
<div class="props_rev_3"><a id="GUID-FA163AB3-F9CF-4431-88D6-147E5156AEC6"></a>
<h3 id="ADDCI-GUID-FA163AB3-F9CF-4431-88D6-147E5156AEC6" class="sect3">Using Package DEBUG_EXTPROC</h3>
<div>
<p>To help you debug external procedures, PL/SQL provides the utility package <code class="codeph">DEBUG_EXTPROC</code>. To install the package, run the script <code class="codeph">dbgextp</code>.<code class="codeph">sql</code>, which you can find in the PL/SQL demo directory.</p>
<p>To use the package, follow the instructions in <code class="codeph">dbgextp.sql</code>. Your Oracle account must have <code class="codeph">EXECUTE</code> privileges on the package and <code class="codeph">CREATE</code> <code class="codeph">LIBRARY</code> privileges.</p>
<p>Note that <code class="codeph">DEBUG_EXTPROC</code> works only on platforms with debugger utilities that can attach to a running process.</p>
</div>
</div>
<a id="ADDCI4359"></a>
<div class="props_rev_3"><a id="GUID-A713AC5A-46FD-4FCE-BD5E-4557AB4EEC0A"></a>
<h3 id="ADDCI-GUID-A713AC5A-46FD-4FCE-BD5E-4557AB4EEC0A" class="sect3">Debugging C Code in DLLs on Windows NT Systems</h3>
<div>
<div class="section">
<p><a id="d11137e2619" class="indexterm-anchor"></a><a id="d11137e2623" class="indexterm-anchor"></a><a id="d11137e2627" class="indexterm-anchor"></a>If you are developing on a Windows NT system, you may perform the following additional actions to debug external procedures:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Invoke the Windows NT Task Manager; press <span class="bold">Ctrl</span>+<span class="bold">Alt</span>+<span class="bold">Del</span> and select <span class="bold">Task Manager</span>.</span></li>
<li class="stepexpand"><span>In the Processes display, select ExtProc.exe.</span></li>
<li class="stepexpand"><span>Right click, and select Debug.</span></li>
<li class="stepexpand"><span>Select OK in the message box.</span>
<div>
<p>At this point, if you have built your DLL in a debug fashion with Microsoft Visual C++, Visual C++ is activated.</p>
</div>
</li>
<li class="stepexpand"><span>In the Visual C++ window, select Edit &gt; Breakpoints.</span></li>
<li class="stepexpand"><span>Use the breakpoint identified in <code class="codeph">dbgextp.sql</code> in the PL/SQL demo directory.</span></li>
</ol>
</div>
</div>
</div>
<a id="ADDCI4360"></a>
<div class="props_rev_3"><a id="GUID-0920EE62-3F59-4933-8A3E-6179D5FF2B3C"></a>
<h2 id="ADDCI-GUID-0920EE62-3F59-4933-8A3E-6179D5FF2B3C" class="sect2">Guidelines for Using External Procedures with Data Cartridges</h2>
<div>
<p><a id="d11137e2721" class="indexterm-anchor"></a><a id="d11137e2725" class="indexterm-anchor"></a><a id="d11137e2729" class="indexterm-anchor"></a><a id="d11137e2733" class="indexterm-anchor"></a>Make sure to write thread-safe external procedures. In particular, avoid using static variables, which can be shared by routines running in separate threads.</p>
<p>For help in creating a dynamic link library, look in the RDBMS subdirectory <code class="codeph">/public</code>, where a template <code class="codeph">makefile</code> can be found.</p>
<p>When calling external procedures, never write to <code class="codeph">IN</code> parameters or overflow the capacity of <code class="codeph">OUT</code> parameters. PL/SQL does no run-time checks for these error conditions. Likewise, never read an <code class="codeph">OUT</code> parameter or a function result. Also, always assign a value to <code class="codeph">IN</code> <code class="codeph">OUT</code> and <code class="codeph">OUT</code> parameters and to function results. Otherwise, your external procedure does not return successfully.</p>
<p>If you include the <code class="codeph">WITH</code> <code class="codeph">CONTEXT</code> and <code class="codeph">PARAMETERS</code> clauses, you must specify the parameter <code class="codeph">CONTEXT</code>, which shows the position of the context pointer in the parameter list. If you omit the <code class="codeph">PARAMETERS</code> clause, the context pointer is the first parameter passed to the external procedure.</p>
<p>If you include the <code class="codeph">PARAMETERS</code> clause and the external procedure is a function, you must specify the parameter <code class="codeph">RETURN</code> (not <code class="codeph">RETURN property</code>) in the last position.</p>
<p>For every formal parameter, there must be a corresponding parameter in the <code class="codeph">PARAMETERS</code> clause. Also, ensure that the data types of parameters in the <code class="codeph">PARAMETERS</code> clause are compatible with those in the C prototype, because no implicit conversions are done.</p>
<p>A parameter for which you specify <code class="codeph">INDICATOR</code> or <code class="codeph">LENGTH</code> has the same parameter mode as the corresponding formal parameter. However, a parameter for which you specify <code class="codeph">MAXLEN</code>, <code class="codeph">CHARSETID</code>, or <code class="codeph">CHARSETFORM</code> is always treated like an <code class="codeph">IN</code> parameter, even if you also specify <code class="codeph">BY REFERENCE</code>.</p>
<p>With a parameter of type <code class="codeph">CHAR</code>, <code class="codeph">LONG</code> <code class="codeph">RAW</code>, <code class="codeph">RAW</code>, or <code class="codeph">VARCHAR2</code>, you must use the property <code class="codeph">LENGTH</code>. Also, if that parameter is <code class="codeph">IN</code> <code class="codeph">OUT</code> or <code class="codeph">OUT</code> and null, you must set the length of the corresponding C parameter to zero.</p>
<div class="infoboxnotealso" id="GUID-0920EE62-3F59-4933-8A3E-6179D5FF2B3C__GUID-FB5B2BAF-4BF0-4C68-98C1-0D3133812289">
<p class="notep1">See Also:</p>
<p>For more information about multithreading, see the <a class="olink HETER" target="_blank" href="../HETER/toc.htm"><span class="italic">Oracle Database Heterogeneous Connectivity Administrator&#39;s Guide.</span></a></p>
</div>
</div>
</div>
<a id="ADDCI4361"></a>
<div class="props_rev_3"><a id="GUID-4DCE0D7F-1144-47E3-B347-F737B03EC5AE"></a>
<h2 id="ADDCI-GUID-4DCE0D7F-1144-47E3-B347-F737B03EC5AE" class="sect2">Java Methods</h2>
<div>
<p>To use Java Data Cartridges, it is important that you know how to load Java class definitions, about how to call stored procedures, and about context management. Information on ODCI classes can also be found in <a href="serv_c_java_ref.htm#GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745">Cartridge Services Using C_ C++ and Java</a> of this manual.</p>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5977">
<tr>
<td class="cellalignment5984">
<table class="cellalignment5982">
<tr>
<td class="cellalignment5981"><a href="pl_sql.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5981"><a href="lobs.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5986">
<table class="cellalignment5980">
<tr>
<td class="cellalignment5981"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5981"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5981"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5981"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5981"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5981"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>