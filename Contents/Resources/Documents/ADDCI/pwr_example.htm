<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-53"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Power%20Demand%20Cartridge%20Example"></a><title>Power Demand Cartridge Example</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="Creating Statistics Table (PowerCartUserStats), Associating the Extensible Optimizer Methods with Database Objects"/>
<meta name="dcterms.created" content="2017-06-09T01:57:02Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Data Cartridge Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E15882-06"/>
<meta name="dcterms.isVersionOf" content="ADDCI"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="part3.htm" title="Previous" type="text/html"/>
<link rel="Next" href="psbtree_example.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E15882-06.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-60A032E8-F21B-4026-847B-654BE6C38C17"></a> <span id="PAGE" style="display:none;">22/33</span> <!-- End Header -->
<a id="ADDCI3150"></a>
<h1 id="ADDCI-GUID-60A032E8-F21B-4026-847B-654BE6C38C17" class="sect1"><span class="enumeration_chapter">15</span> Power Demand Cartridge Example</h1>
<div>
<p><a id="d42543e50" class="indexterm-anchor"></a><a id="d42543e52" class="indexterm-anchor"></a>Consider the power demand sample data cartridge that is discussed in <a href="pwr_example.htm#GUID-60A032E8-F21B-4026-847B-654BE6C38C17">Power Demand Cartridge Example</a>. The power demand cartridge includes a user-defined object type, extensible indexing, and optimization. The entire cartridge definition is available online in file <code class="codeph">extdemo1.sql</code> in the Oracle demo directory.</p>
<div class="infoboxnotealso" id="GUID-60A032E8-F21B-4026-847B-654BE6C38C17__GUID-5B014064-2FD1-44C0-BF6B-890E9A1DC32A">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dom_idx.htm#GUID-E370B5E4-BAC0-49C6-B17D-830B3A507FB4">Building Domain Indexes</a> for information about extensible query optimization</p>
</li>
<li>
<p><a href="ext_optimizer.htm#GUID-7E1BFCFC-9C05-4CC6-9E4F-B1B1212DBE84">Using Extensible Optimizer</a> for information about extensible indexing</p>
</li>
<li>
<p><a href="part2.htm#GUID-4B20A22F-E8D5-41E7-B819-F69AB25836CB">Introduction to Cartridge Services</a> for information about cartridge services</p>
</li>
</ul>
</div>
</div>
<a id="ADDCI4779"></a><a id="ADDCI4780"></a><a id="ADDCI4781"></a><a id="ADDCI4782"></a><a id="ADDCI4783"></a><a id="ADDCI4784"></a><a id="ADDCI4785"></a><a id="ADDCI4786"></a><a id="ADDCI4778"></a>
<div class="props_rev_3"><a id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC"></a>
<h2 id="ADDCI-GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC" class="sect2">Feature Requirements</h2>
<div>
<p><a id="d42543e139" class="indexterm-anchor"></a><a id="d42543e143" class="indexterm-anchor"></a><a id="d42543e147" class="indexterm-anchor"></a><a id="d42543e149" class="indexterm-anchor"></a>A power utility, <span class="italic">Power-To-The-People</span>, develops a sophisticated model to decide how to deploy its resources. The region served by the utility is represented by a grid laid over a geographic area. This grid is illustrated in <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABJAIIE">Figure 14-1</a>.</p>
<div class="figure" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABJAIIE">
<p class="titleinfigure">Figure 14-1 Region Served by the Power Utility</p>
<img width="407" height="407" src="img/GUID-B282F3FA-7901-427A-8848-6FC758AFE2A9-default.gif" alt="Description of Figure 14-1 follows" title="Description of Figure 14-1 follows"/><br/>
<a href="img_text/GUID-B282F3FA-7901-427A-8848-6FC758AFE2A9-print.htm">Description of &#34;Figure 14-1 Region Served by the Power Utility&#34;</a></div>
<!-- class="figure" -->
<p>This region may be surrounded by other regions some of whose power needs are supplied by other utilities. As pictured, every region is composed of geographic quadrants, called cells, on a 10x10 grid. There are several ways of identifying cells &mdash; by spatial coordinates (longitude/latitude), by a matrix numbering (1,1; 1,2;...), and by numbering them sequentially, as illustrated in <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABEHDCE">Figure 14-2</a>.</p>
<div class="figure" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABEHDCE">
<p class="titleinfigure">Figure 14-2 Regional Grid Cells in Numbered Sequence</p>
<img width="409" height="409" src="img/GUID-D071E1EB-7EA8-46E4-9811-FEF2CCD71B04-default.gif" alt="Description of Figure 14-2 follows" title="Description of Figure 14-2 follows"/><br/>
<a href="img_text/GUID-D071E1EB-7EA8-46E4-9811-FEF2CCD71B04-print.htm">Description of &#34;Figure 14-2 Regional Grid Cells in Numbered Sequence&#34;</a></div>
<!-- class="figure" -->
<p>Within the area represented by each cell, the power used by consumers in that area is recorded each hour. For example, the power demand readings for a particular hour might be represented by <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BGEGFJDE" title="Lists sample power demand readings for a given hour">Table 14-1</a> (cells here represented on a matrix).</p>
<div class="tblformal" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BGEGFJDE">
<p class="titleintable">Table 14-1 Sample Power Demand Readings for an Hour</p>
<table class="cellalignment5987" title="Sample Power Demand Readings for an Hour" summary="Lists sample power demand readings for a given hour">
<thead>
<tr class="cellalignment5978">
<th class="cellalignment5994" id="d42543e198">-</th>
<th class="cellalignment5994" id="d42543e201">1</th>
<th class="cellalignment5994" id="d42543e205">2</th>
<th class="cellalignment5994" id="d42543e209">3</th>
<th class="cellalignment5994" id="d42543e213">4</th>
<th class="cellalignment5994" id="d42543e217">5</th>
<th class="cellalignment5994" id="d42543e221">6</th>
<th class="cellalignment5994" id="d42543e225">7</th>
<th class="cellalignment5994" id="d42543e229">8</th>
<th class="cellalignment5994" id="d42543e233">9</th>
<th class="cellalignment5994" id="d42543e237">10</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e243" headers="d42543e198">
<p><span class="bold">1</span></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e201">
<p><code class="codeph">23</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e205">
<p><code class="codeph">21</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e209">
<p><code class="codeph">25</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e213">
<p><code class="codeph">23</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e217">
<p><code class="codeph">24</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e221">
<p><code class="codeph">25</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e225">
<p><code class="codeph">27</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e229">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e233">
<p><code class="codeph">31</code></p>
</td>
<td class="cellalignment5995" headers="d42543e243 d42543e237">
<p><code class="codeph">30</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e288" headers="d42543e198">
<p><span class="bold">2</span></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e201">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e205">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e209">
<p><code class="codeph">31</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e213">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e217">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e221">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e225">
<p><code class="codeph">23</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e229">
<p><code class="codeph">22</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e233">
<p><code class="codeph">21</code></p>
</td>
<td class="cellalignment5995" headers="d42543e288 d42543e237">
<p><code class="codeph">34</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e333" headers="d42543e198">
<p><span class="bold">3</span></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e201">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e205">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e209">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e213">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e217">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e221">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e225">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e229">
<p><code class="codeph">41</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e233">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e333 d42543e237">
<p><code class="codeph">46</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e378" headers="d42543e198">
<p><span class="bold">4</span></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e201">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e205">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e209">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e213">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e217">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e221">
<p><code class="codeph">26</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e225">
<p><code class="codeph">19</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e229">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e233">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e378 d42543e237">
<p><code class="codeph">43</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e423" headers="d42543e198">
<p><span class="bold">5</span></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e201">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e205">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e209">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e213">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e217">
<p><code class="codeph">41</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e221">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e225">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e229">
<p><code class="codeph">46</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e233">
<p><code class="codeph">47</code></p>
</td>
<td class="cellalignment5995" headers="d42543e423 d42543e237">
<p><code class="codeph">44</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e468" headers="d42543e198">
<p><span class="bold">6</span></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e201">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e205">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e209">
<p><code class="codeph">98</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e213">
<p><code class="codeph">55</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e217">
<p><code class="codeph">54</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e221">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e225">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e229">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e233">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e468 d42543e237">
<p><code class="codeph">44</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e513" headers="d42543e198">
<p><span class="bold">7</span></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e201">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e205">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e209">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e213">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e217">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e221">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e225">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e229">
<p><code class="codeph">55</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e233">
<p><code class="codeph">46</code></p>
</td>
<td class="cellalignment5995" headers="d42543e513 d42543e237">
<p><code class="codeph">34</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e558" headers="d42543e198">
<p><span class="bold">8</span></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e201">
<p><code class="codeph">87</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e205">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e209">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e213">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e217">
<p><code class="codeph">31</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e221">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e225">
<p><code class="codeph">35</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e229">
<p><code class="codeph">38</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e233">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e558 d42543e237">
<p><code class="codeph">39</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e603" headers="d42543e198">
<p><span class="bold">9</span></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e201">
<p><code class="codeph">30</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e205">
<p><code class="codeph">40</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e209">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e213">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e217">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e221">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e225">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e229">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e233">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e603 d42543e237">
<p><code class="codeph">46</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e648" headers="d42543e198">
<p><span class="bold">10</span></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e201">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e205">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e209">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e213">
<p><code class="codeph">12</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e217">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e221">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e225">
<p><code class="codeph">48</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e229">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e233">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e648 d42543e237">
<p><code class="codeph">32</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The power stations also receives reports from two other sources:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">Sensors</span> on the ground provide temperature readings for every cell</p>
<p>By analyzing the correlation between historical power demand from cells and the temperature readings for those regions, the utility is able to determine with a close approximation the expected demand, given specific temperatures.</p>
</li>
<li>
<p><span class="italic">Satellite cameras</span> provide images regarding current conditions that are converted into grayscale images that match the grid illustrated in <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABICABD">Figure 14-3</a>.</p>
</li>
</ul>
<div class="figure" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABICABD">
<p class="titleinfigure">Figure 14-3 Grayscale Representation of Satellite Image</p>
<img width="409" height="408" src="img/GUID-628659D7-615F-46C0-8E41-B559AF222107-default.gif" alt="Description of Figure 14-3 follows" title="Description of Figure 14-3 follows"/><br/>
<a href="img_text/GUID-628659D7-615F-46C0-8E41-B559AF222107-print.htm">Description of &#34;Figure 14-3 Grayscale Representation of Satellite Image &#34;</a></div>
<!-- class="figure" -->
<p>These images are designed so that lighter is colder. Thus, the image shows a cold front moving into the region from the south-west. By correlating the data provided by the grayscale images with temperature readings taken at the same time, the utility has been able to determine what the power demand is given weather conditions viewed from the stratosphere.</p>
<p>The reason that this is important is that a crucial part of this modeling has to do with noting the rapidity and degree of change in the incoming reports as weather changes and power is deployed. The following diagram shows same cold front at a second recording, illustrated in <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABIDHGD">Figure 14-4</a>.</p>
<div class="figure" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABIDHGD">
<p class="titleinfigure">Figure 14-4 Grayscale Representation of Weather Conditions at Second Recording</p>
<img width="409" height="408" src="img/GUID-06F50F09-CAAC-4EC5-A6D4-C8B9DDC639EC-default.gif" alt="Description of Figure 14-4 follows" title="Description of Figure 14-4 follows"/><br/>
<a href="img_text/GUID-06F50F09-CAAC-4EC5-A6D4-C8B9DDC639EC-print.htm">Description of &#34;Figure 14-4 Grayscale Representation of Weather Conditions at Second Recording&#34;</a></div>
<!-- class="figure" -->
<p>By analyzing the extent and speed of the cold front, the utility is able to project what the conditions are likely to be in the short and medium term, as in <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABHCAIH">Figure 14-5</a>.</p>
<div class="figure" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABHCAIH">
<p class="titleinfigure">Figure 14-5 Grayscale Representation of Conditions as Projected</p>
<img width="409" height="408" src="img/GUID-C329BA29-F96F-47B7-A3B0-B224443D893E-default.gif" alt="Description of Figure 14-5 follows" title="Description of Figure 14-5 follows"/><br/>
<a href="img_text/GUID-C329BA29-F96F-47B7-A3B0-B224443D893E-print.htm">Description of &#34;Figure 14-5 Grayscale Representation of Conditions as Projected &#34;</a></div>
<!-- class="figure" -->
<p>By combing the data about these conditions and other anomalous situations (such as the failure of a substation), the utility must be able to organize the most optimal deployment of its resources. <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABFCGBC">Figure 14-6</a> reflects the distribution of substations across the region.</p>
<div class="figure" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABFCGBC">
<p class="titleinfigure">Figure 14-6 Distribution of Power Stations Across the Region</p>
<img width="407" height="407" src="img/GUID-C0ACC7C7-0A97-48A1-AA48-28F63ECB3F2A-default.gif" alt="Description of Figure 14-6 follows" title="Description of Figure 14-6 follows"/><br/>
<a href="img_text/GUID-C0ACC7C7-0A97-48A1-AA48-28F63ECB3F2A-print.htm">Description of &#34;Figure 14-6 Distribution of Power Stations Across the Region&#34;</a></div>
<!-- class="figure" -->
<p>The distribution of power stations means that the utility can redirect its deployment of electricity to the areas of greatest need. <a href="pwr_example.htm#GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABBHACJ">Figure 14-7</a> gives a pictorial representation of the overlap between three stations.</p>
<div class="figure" id="GUID-DF72AE3E-E469-4A87-B3F8-5D60D73FCEEC__BABBHACJ">
<p class="titleinfigure">Figure 14-7 Areas Served by Three Power Stations</p>
<img width="410" height="409" src="img/GUID-077BE085-D980-4DD8-861D-DB7BD3E16B23-default.gif" alt="Description of Figure 14-7 follows" title="Description of Figure 14-7 follows"/><br/>
<a href="img_text/GUID-077BE085-D980-4DD8-861D-DB7BD3E16B23-print.htm">Description of &#34;Figure 14-7 Areas Served by Three Power Stations&#34;</a></div>
<!-- class="figure" -->
<p>Depending on fluctuating requirements, the utility must be able to decide how to deploy its resources, and even whether to purchase power from another utility in the event of shortfall.</p>
</div>
</div>
<a id="ADDCI4788"></a><a id="ADDCI4787"></a>
<div class="props_rev_3"><a id="GUID-9E9E9B45-983F-446C-BDD0-3706FF8903C7"></a>
<h2 id="ADDCI-GUID-9E9E9B45-983F-446C-BDD0-3706FF8903C7" class="sect2">Modeling the Application</h2>
<div>
<p>Consider a technical and business scenario for modeling an application. The Class Diagram in <a href="pwr_example.htm#GUID-9E9E9B45-983F-446C-BDD0-3706FF8903C7__BABGCEHD">Figure 14-8</a> describes the application objects using the Unified Modelling Language (UML) notation.</p>
<div class="figure" id="GUID-9E9E9B45-983F-446C-BDD0-3706FF8903C7__BABGCEHD">
<p class="titleinfigure">Figure 14-8 Application Object Model of the Power Demand Cartridge</p>
<img width="524" height="533" src="img/GUID-4B4E7C84-A5E3-4147-82FD-D9124F41D2EF-default.gif" alt="Description of Figure 14-8 follows" title="Description of Figure 14-8 follows"/><br/>
<a href="img_text/GUID-4B4E7C84-A5E3-4147-82FD-D9124F41D2EF-print.htm">Description of &#34;Figure 14-8 Application Object Model of the Power Demand Cartridge&#34;</a></div>
<!-- class="figure" --></div>
<a id="ADDCI4790"></a><a id="ADDCI4791"></a><a id="ADDCI4789"></a>
<div class="props_rev_3"><a id="GUID-4BBDDBE4-4574-402B-A4A7-3528AB218F83"></a>
<h3 id="ADDCI-GUID-4BBDDBE4-4574-402B-A4A7-3528AB218F83" class="sect3">Sample Queries</h3>
<div>
<div class="section">
<p>Modelling the application in this way makes it possible the following specific queries:</p>
<ul style="list-style-type: disc;">
<li>
<p>Find the cell (geographic quadrant) with the highest demand for a specified time-period.</p>
</li>
<li>
<p>Find the time-period with the highest total demand.</p>
</li>
<li>
<p>Find all cells where demand is greater than some specified value.</p>
</li>
<li>
<p>Find any cell at any time where the demand equals some specified value.</p>
</li>
<li>
<p>Find any time period for which 3 or more cells have a demand greater than some specified.</p>
</li>
<li>
<p>Find the time-period for which there was the greatest disparity (difference) between the cell with the minimum demand and the cell with the maximum demand.</p>
</li>
<li>
<p>Find the times for which 10 or more cells had demand not less than some specified value.</p>
</li>
<li>
<p>Find the times for which the average cell demand was greater than some specified value.</p>
<p>Note that it is assumed that the average is easily computable through <code class="codeph">TotalPowerDemand/100</code>.</p>
</li>
<li>
<p>Find the time-periods for which the median cell demand was greater than some specified value.</p>
<p>Note that we assume that the median value is not easily computable.</p>
</li>
<li>
<p>Find all time-periods for which the total demand rose 10 percent or more over the preceding time&#39;s total demand.</p>
</li>
</ul>
<p>These queries are, of course, only a short list of the possible information that could be gleaned from the system. For instance, it is obvious that the developer of such an application would want to build queries that are based on the information derived from prior queries:</p>
<ul style="list-style-type: disc;">
<li>
<p>What is the percentage change in demand for a particular cell as compared to a previous time-period?</p>
</li>
<li>
<p>Which cells demonstrate rapid increase or decrease in demand measured as percentages that are greater or less than specified values?</p>
</li>
</ul>
<p><a href="pwr_example.htm#GUID-4BBDDBE4-4574-402B-A4A7-3528AB218F83__BABJEFDG">Figure 14-9</a> describes and illustrates the Power Demand cartridge, as implemented.</p>
<div class="figure" id="GUID-4BBDDBE4-4574-402B-A4A7-3528AB218F83__BABJEFDG">
<p class="titleinfigure">Figure 14-9 Implementation Model of the Power Demand Cartridge</p>
<img width="524" height="488" src="img/GUID-9AC3ABA3-D865-4BA0-8DC5-7EDCF5881D5A-default.gif" alt="Description of Figure 14-9 follows" title="Description of Figure 14-9 follows"/><br/>
<a href="img_text/GUID-9AC3ABA3-D865-4BA0-8DC5-7EDCF5881D5A-print.htm">Description of &#34;Figure 14-9 Implementation Model of the Power Demand Cartridge&#34;</a></div>
<!-- class="figure" -->
<p>The utility receives ongoing reports from weather centers about current conditions and from power stations about ongoing power utilization for specific geographical areas (represented by cells on a 10x10 grid). It then compares this information to historical data so it may predict demand for power in the different geographic areas for given time periods.</p>
<p>Each service area for the utility is considered as a 10x10 grid of cells, where each cell&#39;s boundaries are associated with spatial coordinates (longitude/latitude). The geographical areas represented by the cells can be uniform or can have different shapes and sizes. Within the area represented by each cell, the power used by consumers in that area is recorded each hour. For example, the power demand readings for a particular hour might be represented by <a href="pwr_example.htm#GUID-4BBDDBE4-4574-402B-A4A7-3528AB218F83__G1012310" title="Lists sample power demand readings for a different hour than a previous table">Table 14-2</a>.</p>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-4BBDDBE4-4574-402B-A4A7-3528AB218F83__G1012310">
<p class="titleintable">Table 14-2 Sample Power Demand Readings for an Hour</p>
<table class="cellalignment5987" title="Sample Power Demand Readings for an Hour" summary="Lists sample power demand readings for a different hour than a previous table">
<thead>
<tr class="cellalignment5978">
<th class="cellalignment5994" id="d42543e956">-</th>
<th class="cellalignment5994" id="d42543e959">1</th>
<th class="cellalignment5994" id="d42543e963">2</th>
<th class="cellalignment5994" id="d42543e967">3</th>
<th class="cellalignment5994" id="d42543e971">4</th>
<th class="cellalignment5994" id="d42543e975">5</th>
<th class="cellalignment5994" id="d42543e979">6</th>
<th class="cellalignment5994" id="d42543e983">7</th>
<th class="cellalignment5994" id="d42543e987">8</th>
<th class="cellalignment5994" id="d42543e991">9</th>
<th class="cellalignment5994" id="d42543e995">10</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1001" headers="d42543e956">
<p><span class="bold">1</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e959">
<p><code class="codeph">23</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e963">
<p><code class="codeph">21</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e967">
<p><code class="codeph">25</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e971">
<p><code class="codeph">23</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e975">
<p><code class="codeph">24</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e979">
<p><code class="codeph">25</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e983">
<p><code class="codeph">27</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e987">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e991">
<p><code class="codeph">31</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1001 d42543e995">
<p><code class="codeph">30</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1046" headers="d42543e956">
<p><span class="bold">2</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e959">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e963">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e967">
<p><code class="codeph">31</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e971">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e975">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e979">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e983">
<p><code class="codeph">23</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e987">
<p><code class="codeph">22</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e991">
<p><code class="codeph">21</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1046 d42543e995">
<p><code class="codeph">34</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1091" headers="d42543e956">
<p><span class="bold">3</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e959">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e963">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e967">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e971">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e975">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e979">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e983">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e987">
<p><code class="codeph">41</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e991">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1091 d42543e995">
<p><code class="codeph">46</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1136" headers="d42543e956">
<p><span class="bold">4</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e959">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e963">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e967">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e971">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e975">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e979">
<p><code class="codeph">26</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e983">
<p><code class="codeph">19</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e987">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e991">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1136 d42543e995">
<p><code class="codeph">43</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1181" headers="d42543e956">
<p><span class="bold">5</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e959">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e963">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e967">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e971">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e975">
<p><code class="codeph">41</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e979">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e983">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e987">
<p><code class="codeph">46</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e991">
<p><code class="codeph">47</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1181 d42543e995">
<p><code class="codeph">44</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1226" headers="d42543e956">
<p><span class="bold">6</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e959">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e963">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e967">
<p><code class="codeph">98</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e971">
<p><code class="codeph">55</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e975">
<p><code class="codeph">54</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e979">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e983">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e987">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e991">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1226 d42543e995">
<p><code class="codeph">44</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1271" headers="d42543e956">
<p><span class="bold">7</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e959">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e963">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e967">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e971">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e975">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e979">
<p><code class="codeph">44</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e983">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e987">
<p><code class="codeph">55</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e991">
<p><code class="codeph">46</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1271 d42543e995">
<p><code class="codeph">34</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1316" headers="d42543e956">
<p><span class="bold">8</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e959">
<p><code class="codeph">87</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e963">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e967">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e971">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e975">
<p><code class="codeph">31</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e979">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e983">
<p><code class="codeph">35</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e987">
<p><code class="codeph">38</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e991">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1316 d42543e995">
<p><code class="codeph">39</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1361" headers="d42543e956">
<p><span class="bold">9</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e959">
<p><code class="codeph">30</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e963">
<p><code class="codeph">40</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e967">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e971">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e975">
<p><code class="codeph">33</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e979">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e983">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e987">
<p><code class="codeph">32</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e991">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1361 d42543e995">
<p><code class="codeph">46</code></p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5995" id="d42543e1406" headers="d42543e956">
<p><span class="bold">10</span></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e959">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e963">
<p><code class="codeph">42</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e967">
<p><code class="codeph">34</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e971">
<p><code class="codeph">12</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e975">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e979">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e983">
<p><code class="codeph">48</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e987">
<p><code class="codeph">45</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e991">
<p><code class="codeph">43</code></p>
</td>
<td class="cellalignment5995" headers="d42543e1406 d42543e995">
<p><code class="codeph">32</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<p>The numbers in each cell reflect power demand (in some unit of measurement determined by the electric utility) for the hour for that area. For example, the demand for the first cell (1,1) was 23, the demand for the second cell (1,2) was 21, and so on. The demand for the last cell (10, 10) was 32.</p>
<p>The utility uses this data for many monitoring and analytical applications. Readings for individual cells are monitored for unusual surges or decreases in demand. For example, the readings of 98 for (6,3) and 87 for (8,1) might be unusually high, and the readings of 19 for (4,7) and 12 for (10,4) might be unusually low. Trends are also analyzed, such as significant increases or decreases in demand for each neighborhood, for each station, and overall, over time.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="ADDCI4792"></a>
<div class="props_rev_3"><a id="GUID-C78F49B3-DA5A-47A0-81B6-518F87691C91"></a>
<h2 id="ADDCI-GUID-C78F49B3-DA5A-47A0-81B6-518F87691C91" class="sect2">Queries and Extensible Indexing</h2>
<div>
<p>Consider the kinds of queries that benefit from domain indexes. The choice to use extensible indexing depends on whether queries run as efficiently with a standard Oracle index, or with no index at all.</p>
</div>
<a id="ADDCI4793"></a>
<div class="props_rev_3"><a id="GUID-8CD2A893-EB35-4962-9B2A-EE3F395A17DB"></a>
<h3 id="ADDCI-GUID-8CD2A893-EB35-4962-9B2A-EE3F395A17DB" class="sect3">Queries Not Benefiting from Extensible Indexing</h3>
<div>
<p><a id="d42543e1561" class="indexterm-anchor"></a><a id="d42543e1567" class="indexterm-anchor"></a>A query does not require a domain index if both of the following are true:</p>
<ul style="list-style-type: disc;">
<li>
<p>The desired information can be made an attribute (column) of the table and a standard index can be defined on that column.</p>
</li>
<li>
<p>The operations in queries on the data are limited to those operations supported by the standard index, such as <code class="codeph">equals</code>, <code class="codeph">lessthan</code>, <code class="codeph">greaterthan</code>, <code class="codeph">max</code>, and <code class="codeph">min</code> for a b-tree index.</p>
</li>
</ul>
<p>In the <code class="codeph">PowerDemand_Typ</code> object type cartridge example, the values for three columns (<code class="codeph">TotGridDemand</code>, <code class="codeph">MaxCellDemand</code>, and <code class="codeph">MinCellDemand</code>) are set by functions, after which the values do not change. (For example, the total grid power demand for 13:00 on 01-Jan-1998 does not change after it has been computed.) For queries that use these columns, a standard b-tree index on each column is sufficient and recommended for operations like <code class="codeph">equals</code>, <code class="codeph">lessthan</code>, <code class="codeph">greaterthan</code>, <code class="codeph">max</code>, and <code class="codeph">min</code>.</p>
<p>Examples of queries that would not benefit from extensible indexing (using the power demand cartridge) include:</p>
<ul style="list-style-type: disc;">
<li>
<p>Find the cell with the highest power demand for a specific time.</p>
</li>
<li>
<p>Find the time when the total grid power demand was highest.</p>
</li>
<li>
<p>Find all cells where the power demand is greater than a specified value.</p>
</li>
<li>
<p>Find the times for which the average cell demand or the median cell demand was greater than a specified value.</p>
<p>To make this query run efficiently, define two additional columns in the <code class="codeph">PowerDemand_Typ</code> object type (<code class="codeph">AverageCellDemand</code> and <code class="codeph">MedianCellDemand</code>), and create functions to set the values of these columns. (For example, <code class="codeph">AverageCellDemand</code> is <code class="codeph">TotGridDemand</code> divided by 100.) Then, create b-tree indexes on the <code class="codeph">AverageCellDemand</code> and <code class="codeph">MedianCellDemand</code> columns.</p>
</li>
</ul>
</div>
</div>
<a id="ADDCI4794"></a>
<div class="props_rev_3"><a id="GUID-9EF4FDCF-4717-43F8-A1E0-BE5AF74E662D"></a>
<h3 id="ADDCI-GUID-9EF4FDCF-4717-43F8-A1E0-BE5AF74E662D" class="sect3">Queries Benefiting from Extensible Indexing</h3>
<div>
<p><a id="d42543e1715" class="indexterm-anchor"></a><a id="d42543e1721" class="indexterm-anchor"></a>A query benefits from a domain index if the data being queried against cannot be made a simple attribute of a table or if the operation to be performed on the data is not one of the standard operations supported by Oracle indexes.</p>
<p>Examples of queries that would benefit from extensible indexing (using the power demand cartridge) include:</p>
<ul style="list-style-type: disc;">
<li>
<p>Find the first cell for a specified time where the power demand was equal to a specified value.</p>
<p>By asking for the first cell, the query goes beyond a simple true-false check (such as finding out whether <span class="italic">any</span> cell for a specified time had a demand equal to a specified value), and thus benefits from a domain index.</p>
</li>
<li>
<p>Find the time for which there was the greatest disparity, or difference between the cell with the minimum demand and the cell with the maximum demand.</p>
</li>
<li>
<p>Find all times for which <code class="codeph">3</code> or more cells had a demand greater than a specified value.</p>
</li>
<li>
<p>Find all times for which 10 or more cells had a demand not less than a specified value.</p>
</li>
<li>
<p>Find all times for which the total grid demand rose 10 percent or more over the preceding time&#39;s total grid demand.</p>
</li>
</ul>
</div>
</div>
</div>
<a id="ADDCI4795"></a>
<div class="props_rev_3"><a id="GUID-C21C2320-540B-496F-8DFB-C37E6717FF32"></a>
<h2 id="ADDCI-GUID-C21C2320-540B-496F-8DFB-C37E6717FF32" class="sect2">Creating the Domain Index</h2>
<div>
<p><a id="d42543e1804" class="indexterm-anchor"></a><a id="d42543e1810" class="indexterm-anchor"></a>Consider the parts of the power demand cartridge as they relate to extensible indexing. Explanatory text and code segments are mixed.</p>
<p><a id="d42543e1816" class="indexterm-anchor"></a><a id="d42543e1818" class="indexterm-anchor"></a><a id="d42543e1822" class="indexterm-anchor"></a>The entire cartridge definition is available online as extdemo1.sql in the standard Oracle demo directory (location is platform-dependent).</p>
</div>
<a id="ADDCI4797"></a><a id="ADDCI4796"></a>
<div class="props_rev_3"><a id="GUID-4E99E2E1-3152-4450-A5A1-3007E5FC6841"></a>
<h3 id="ADDCI-GUID-4E99E2E1-3152-4450-A5A1-3007E5FC6841" class="sect3">Creating the Schema to Own the Index</h3>
<div>
<div class="section">
<p>Before you create a domain index, create a database user, or schema. to own the index. In the power demand example, the user <code class="codeph">PowerCartUser</code> is created and granted the appropriate privileges. All database structures related to the cartridge are created under this user (that is, while the cartridge developer or DBA is connected to the database as <code class="codeph">PowerCartUser</code>), as demonstrated in <a href="pwr_example.htm#GUID-4E99E2E1-3152-4450-A5A1-3007E5FC6841__CIAEDEHD">Example 14-1</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-4E99E2E1-3152-4450-A5A1-3007E5FC6841__CIAEDEHD">
<p class="titleinexample">Example 14-1 Creating a Database User for the Power Demand Cartridge</p>
<pre dir="ltr">set echo on
connect sys/knl_test7 as sysdba;
drop user PowerCartUser cascade;
create user PowerCartUser identified by PowerCartUser;

-------------------------------------------------------------------
-- INITIAL SET-UP
-------------------------------------------------------------------
-- grant privileges --
grant connect, resource to PowerCartUser;
grant create operator to PowerCartUser;
grant create indextype to PowerCartUser;
grant create table to PowerCartUser;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4799"></a><a id="ADDCI4798"></a>
<div class="props_rev_3"><a id="GUID-B5FAAD9E-228D-43FB-B939-EB48EEF4BA3F"></a>
<h3 id="ADDCI-GUID-B5FAAD9E-228D-43FB-B939-EB48EEF4BA3F" class="sect3">Creating the Object Types</h3>
<div>
<div class="section">
<p>The object type <code class="codeph">PowerDemand_Typ</code> stores the hourly power grid readings. This type is used to define a column in the table in which the readings are stored.</p>
<p>First, three types are defined for later use, as demonstrated in <a href="pwr_example.htm#GUID-B5FAAD9E-228D-43FB-B939-EB48EEF4BA3F__CIABCEDC">Example 14-2</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">PowerGrid_Typ</code> defines the cells in <code class="codeph">PowerDemand_Typ</code>.</p>
</li>
<li>
<p><code class="codeph">NumTab_Typ</code> is used in the table where the index entries are stored.</p>
</li>
<li>
<p>The <code class="codeph">PowerDemand_Typ</code> type includes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Three attributes (<code class="codeph">TotGridDemand</code>, <code class="codeph">MaxCellDemand</code>, <code class="codeph">MinCellDemand</code>) that are set by three member procedures</p>
</li>
<li>
<p>Power demand readings (<code class="codeph">100</code> cells in a grid)</p>
</li>
<li>
<p>The date/time of the power demand readings. (Every hour, <code class="codeph">100</code> areas transmit their power demand readings.)</p>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="example" id="GUID-B5FAAD9E-228D-43FB-B939-EB48EEF4BA3F__CIABCEDC">
<p class="titleinexample">Example 14-2 Creating the Types of Power Demand Cartridge</p>
<pre dir="ltr">CREATE OR REPLACE TYPE PowerGrid_Typ as VARRAY(100) of NUMBER;

CREATE OR REPLACE TYPE NumTab_Typ as TABLE of NUMBER;
</pre>
<pre dir="ltr">CREATE OR REPLACE TYPE PowerDemand_Typ AS OBJECT (
  -- Total power demand for the grid
  TotGridDemand NUMBER,
  -- Cell with maximum/minimum power demand for the grid
  MaxCellDemand NUMBER,
  MinCellDemand NUMBER,
  -- Power grid: 10X10 array represented as Varray(100)
  -- using previously defined PowerGrid_Typ
  CellDemandValues PowerGrid_Typ,
  -- Date/time for power-demand samplings: Every hour,
  -- 100 areas transmit their power demand readings.
  SampleTime DATE,
  --
  -- Methods (Set...) for this type:
  -- Total demand for the entire power grid for a
  -- SampleTime: sets the value of TotGridDemand.
  Member Procedure SetTotalDemand,
  -- Maximum demand for the entire power grid for a
  -- SampleTime: sets the value of MaxCellDemand.
  Member Procedure SetMaxDemand,
  -- Minimum demand for the entire power grid for a
  -- SampleTime: sets the value of MinCellDemand.
  Member Procedure SetMinDemand
);
/
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4802"></a><a id="ADDCI4801"></a>
<div class="props_rev_3"><a id="GUID-E4ECA421-B472-45C7-B4BE-92958672D4AD"></a>
<h3 id="ADDCI-GUID-E4ECA421-B472-45C7-B4BE-92958672D4AD" class="sect3">Defining the Object Type Methods</h3>
<div>
<div class="section">
<p>The <code class="codeph">PowerDemand_Typ</code> object type has methods that set the first three attributes in the type definition:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">TotGridDemand</code>, the total demand for the entire power grid for the hour in question (identified by <code class="codeph">SampleTime</code>)</p>
</li>
<li>
<p><code class="codeph">MaxCellDemand</code>, the highest power demand value for all cells for the <code class="codeph">SampleTime</code></p>
</li>
<li>
<p><code class="codeph">MinCellDemand</code>, the lowest power demand value for all cells for the <code class="codeph">SampleTime</code></p>
</li>
</ul>
<p>The logic for each procedure is not complicated. <code class="codeph">SetTotDemand</code> loops through the cell values and creates a running total. <code class="codeph">SetMaxDemand</code> compares the first two cell values and saves the higher as the current highest value; it then examines each successive cell, comparing it against the current highest value and saving the higher of the two as the current highest value, until it reaches the end of the cell values. <code class="codeph">SetMinDemand</code> uses the same approach as <code class="codeph">SetMaxDemand</code>, but it continually saves the lower value in comparisons to derive the lowest value overall, as demonstrated in <a href="pwr_example.htm#GUID-E4ECA421-B472-45C7-B4BE-92958672D4AD__CIAEIAFE">Example 14-3</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-E4ECA421-B472-45C7-B4BE-92958672D4AD__CIAEIAFE">
<p class="titleinexample">Example 14-3 Implementing an Object Type for Power Demand Cartridge</p>
<pre dir="ltr">CREATE OR REPLACE TYPE BODY PowerDemand_Typ 
IS
  --
  -- Methods (Set...) for this type:
  -- Total demand for the entire power grid for a
  -- SampleTime: sets the value of TotGridDemand.
  Member Procedure SetTotalDemand 
  IS
  I BINARY_INTEGER;
  Total NUMBER;
  BEGIN
    Total :=0;
    I := CellDemandValues.FIRST;   
    WHILE I IS NOT NULL LOOP
   Total := Total + CellDemandValues(I);
        I := CellDemandValues.NEXT(I);
    END LOOP;
    TotGridDemand := Total;
  END;

  -- Maximum demand for the entire power grid for a
  -- SampleTime: sets the value of MaxCellDemand.
  Member Procedure SetMaxDemand 
  IS
  I BINARY_INTEGER;
  Temp NUMBER;
  BEGIN
    I := CellDemandValues.FIRST;   
    Temp := CellDemandValues(I);
    WHILE I IS NOT NULL LOOP
   IF Temp &lt; CellDemandValues(I) THEN
      Temp := CellDemandValues(I);
   END IF;
        I := CellDemandValues.NEXT(I);
    END LOOP;
    MaxCellDemand := Temp;
  END;

  -- Minimum demand for the entire power grid for a
  -- SampleTime: sets the value of MinCellDemand.
  Member Procedure SetMinDemand 
  IS
  I BINARY_INTEGER;
  Temp NUMBER;
  BEGIN
    I := CellDemandValues.FIRST;   
    Temp := CellDemandValues(I);
    WHILE I IS NOT NULL LOOP
   IF Temp &gt; CellDemandValues(I) THEN
      Temp := CellDemandValues(I);
   END IF;
        I := CellDemandValues.NEXT(I);
    END LOOP;
    MinCellDemand := Temp;
  END;
END;
/
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4804"></a><a id="ADDCI4803"></a>
<div class="props_rev_3"><a id="GUID-8CEF68C3-827D-4265-A86C-912B503755E9"></a>
<h3 id="ADDCI-GUID-8CEF68C3-827D-4265-A86C-912B503755E9" class="sect3">Understanding Functions and Operators</h3>
<div>
<p>The power demand cartridge is designed so that users can query the power grid for relationships of <code class="codeph">equality</code>, <code class="codeph">greaterthan</code>, or <code class="codeph">lessthan</code>. However, because of the way the cell demand data is stored, the standard operators (<code class="codeph">=</code>, <code class="codeph">&gt;</code>, <code class="codeph">&lt;</code>) cannot be used. Instead, new operators must be created, and a function must be created to define the implementation for each new operator (that is, how the operator is to be interpreted by Oracle).</p>
<p>For this cartridge, each of the three relationships can be checked in two ways:</p>
<ul style="list-style-type: disc;">
<li>
<p>Whether a specific cell in the grid satisfies the relationship. For example, are there grids where cell <code class="codeph">(3,7)</code> has demand equal to <code class="codeph">25</code>?</p>
<p>These operators have names in the form <code class="codeph">Power_XxxxxSpecific()</code>, such as <code class="codeph">Power_EqualsSpecific()</code>, and the implementing functions have names in the form <code class="codeph">Power_XxxxxSpecific_Func()</code>.</p>
</li>
<li>
<p>Whether any cell in the grid satisfies the relationship. For example, are there grids where any cell has demand equal to <code class="codeph">25</code>?</p>
<p>These operators have names in the form <code class="codeph">Power_XxxxxAny()</code>, such as <code class="codeph">Power_EqualsAny()</code>, and the implementing functions have names in the form <code class="codeph">Power_XxxxxAny_Func()</code>.</p>
</li>
</ul>
<p>For each operator-function pair, the function is defined first and then the operator as using the function. The function is the implementation that would be used if there were no index defined. This implementation must be specified so that the Oracle optimizer can determine costs, decide whether the index should be used, and create an execution plan.</p>
<p><a href="pwr_example.htm#GUID-8CEF68C3-827D-4265-A86C-912B503755E9__G1012446" title="Lists operators defined for the Power Demand cartridge example along with their implementing functions">Table 14-3</a> shows the operators and implementing functions:</p>
<div class="tblformal" id="GUID-8CEF68C3-827D-4265-A86C-912B503755E9__G1012446">
<p class="titleintable">Table 14-3 Operators and Implementing Functions</p>
<table class="cellalignment5987" title="Operators and Implementing Functions" summary="Lists operators defined for the Power Demand cartridge example along with their implementing functions">
<thead>
<tr class="cellalignment5978">
<th class="cellalignment5996" id="d42543e2248">Operator</th>
<th class="cellalignment5997" id="d42543e2251">Implementing Function</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5978">
<td class="cellalignment5998" id="d42543e2256" headers="d42543e2248">
<pre dir="ltr">Power_EqualsSpecific()
</pre></td>
<td class="cellalignment5999" headers="d42543e2256 d42543e2251">
<pre dir="ltr">Power_EqualsSpecific_Func()
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5998" id="d42543e2263" headers="d42543e2248">
<pre dir="ltr">Power_EqualsAny()
</pre></td>
<td class="cellalignment5999" headers="d42543e2263 d42543e2251">
<pre dir="ltr">Power_EqualsAny_Func()
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5998" id="d42543e2270" headers="d42543e2248">
<pre dir="ltr">Power_LessThanSpecific()
</pre></td>
<td class="cellalignment5999" headers="d42543e2270 d42543e2251">
<pre dir="ltr">Power_LessThanSpecific_Func()
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5998" id="d42543e2277" headers="d42543e2248">
<pre dir="ltr">Power_LessThanAny()
</pre></td>
<td class="cellalignment5999" headers="d42543e2277 d42543e2251">
<pre dir="ltr">Power_LessThanAny_Func()
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5998" id="d42543e2284" headers="d42543e2248">
<pre dir="ltr">Power_GreaterThanSpecific()
</pre></td>
<td class="cellalignment5999" headers="d42543e2284 d42543e2251">
<pre dir="ltr">Power_GreaterThanSpecific_Func()
</pre></td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment5998" id="d42543e2291" headers="d42543e2248">
<pre dir="ltr">Power_GreaterThanAny()
</pre></td>
<td class="cellalignment5999" headers="d42543e2291 d42543e2251">
<pre dir="ltr">Power_GreaterThanAny_Func()
</pre></td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Each function and operator returns a numeric value of <code class="codeph">1</code> if the condition is true (for example, if the specified cell is equal to the specified value), <code class="codeph">0</code> if the condition is not true, or <code class="codeph">null</code> if the specified cell number is invalid.</p>
<p>The statements in <a href="pwr_example.htm#GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA__CIAFCFJD">Example 14-4</a> create the implementing functions, <code class="codeph">Power_xxx_Func()</code>, first the <code class="codeph">specific</code> and then the <code class="codeph">any</code> implementations.</p>
<p>The statements in <a href="pwr_example.htm#GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA__CIADJEDC">Example 14-5</a> create the operators (<code class="codeph">Power_xxx</code>). Each statement specifies an implementing function.</p>
</div>
<a id="ADDCI4806"></a><a id="ADDCI4805"></a>
<div class="props_rev_3"><a id="GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA"></a>
<h4 id="ADDCI-GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA" class="sect4">Creating Functions and Operators</h4>
<div>
<div class="section">
<p>Examples <a href="pwr_example.htm#GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA__CIAFCFJD">Example 14-4</a> and <a href="pwr_example.htm#GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA__CIADJEDC">Example 14-5</a>demonstrate how to implement functions and operators for the previously defined object types of the Power Demand cartridge.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA__CIAFCFJD">
<p class="titleinexample">Example 14-4 Implementing Power_XXX_Func() Functions for Power Demand Cartridge</p>
<pre dir="ltr">CREATE FUNCTION Power_EqualsSpecific_Func(
  object PowerDemand_Typ, cell NUMBER, value NUMBER)
RETURN NUMBER AS
  BEGIN
  IF cell &lt;= object.CellDemandValues.LAST
  THEN
     IF (object.CellDemandValues(cell) = value) THEN
   RETURN 1;
     ELSE
   RETURN 0;
     END IF;
  ELSE
     RETURN NULL;
  END IF;
  END;
/
CREATE FUNCTION Power_GreaterThanSpecific_Func(
  object PowerDemand_Typ, cell NUMBER, value NUMBER)
RETURN NUMBER AS
  BEGIN
  IF cell &lt;= object.CellDemandValues.LAST
  THEN
     IF (object.CellDemandValues(cell) &gt; value) THEN
   RETURN 1;
     ELSE
   RETURN 0;
     END IF;
  ELSE
     RETURN NULL;
  END IF;
  END;
/
CREATE FUNCTION Power_LessThanSpecific_Func(
  object PowerDemand_Typ, cell NUMBER, value NUMBER)
RETURN NUMBER AS
  BEGIN
  IF cell &lt;= object.CellDemandValues.LAST
  THEN
     IF (object.CellDemandValues(cell) &lt; value) THEN
   RETURN 1;
     ELSE
   RETURN 0;
     END IF;
  ELSE
     RETURN NULL;
  END IF;
  END;
/
CREATE FUNCTION Power_EqualsAny_Func(
  object PowerDemand_Typ, value NUMBER)
RETURN NUMBER AS
   idx NUMBER;
  BEGIN
    FOR idx IN object.CellDemandValues.FIRST..object.CellDemandValues.LAST LOOP
      IF (object.CellDemandValues(idx) = value) THEN
   RETURN 1;
      END IF;
    END LOOP;
   RETURN 0;
  END;
/
CREATE FUNCTION Power_GreaterThanAny_Func(
  object PowerDemand_Typ, value NUMBER)
RETURN NUMBER AS
   idx NUMBER;
  BEGIN
    FOR idx IN object.CellDemandValues.FIRST..object.CellDemandValues.LAST LOOP
      IF (object.CellDemandValues(idx) &gt; value) THEN
   RETURN 1;
      END IF;
    END LOOP;
   RETURN 0;
  END;
/
CREATE FUNCTION Power_LessThanAny_Func(
  object PowerDemand_Typ, value NUMBER)
RETURN NUMBER AS
   idx NUMBER;
  BEGIN
    FOR idx IN object.CellDemandValues.FIRST..object.CellDemandValues.LAST LOOP
      IF (object.CellDemandValues(idx) &lt; value) THEN
   RETURN 1;
      END IF;
    END LOOP;
   RETURN 0;
  END;
/
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-C3FD1445-8E14-423F-BAC5-CDE6CE63A0DA__CIADJEDC">
<p class="titleinexample">Example 14-5 Implementing Power_XXX() Functions for Power Demand Cartridge</p>
<pre dir="ltr">CREATE OPERATOR Power_Equals BINDING(PowerDemand_Typ, NUMBER, NUMBER)
  RETURN NUMBER USING Power_EqualsSpecific_Func;
CREATE OPERATOR Power_GreaterThan BINDING(PowerDemand_Typ, NUMBER, NUMBER)
  RETURN NUMBER USING Power_GreaterThanSpecific_Func;
CREATE OPERATOR Power_LessThan BINDING(PowerDemand_Typ, NUMBER, NUMBER)
  RETURN NUMBER USING Power_LessThanSpecific_Func;
  
CREATE OPERATOR Power_EqualsAny BINDING(PowerDemand_Typ, NUMBER)
  RETURN NUMBER USING Power_EqualsAny_Func;
CREATE OPERATOR Power_GreaterThanAny BINDING(PowerDemand_Typ, NUMBER)
  RETURN NUMBER USING Power_GreaterThanAny_Func;
CREATE OPERATOR Power_LessThanAny BINDING(PowerDemand_Typ, NUMBER)
  RETURN NUMBER USING Power_LessThanAny_Func;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADDCI4808"></a><a id="ADDCI4807"></a>
<div class="props_rev_3"><a id="GUID-1DFCE5CB-E6DE-4D72-87F8-21334041ADC1"></a>
<h3 id="ADDCI-GUID-1DFCE5CB-E6DE-4D72-87F8-21334041ADC1" class="sect3">Creating the Indextype Implementation Methods</h3>
<div>
<div class="section">
<p><a id="d42543e2451" class="indexterm-anchor"></a>The power demand cartridge creates an object type for the indextype that specifies methods for the domain index. These methods are part of the <code class="codeph">ODCIIndex</code> (Oracle Data Cartridge Interface Index) interface, and they collectively define the behavior of the index in terms of the methods for defining, manipulating, scanning, and exporting the index.</p>
<p><a href="pwr_example.htm#GUID-1DFCE5CB-E6DE-4D72-87F8-21334041ADC1__G1012471" title="Lists the method functions created for the Power Demand cartridge example and describes each">Table 14-4</a> shows the method functions (all but one starting with <code class="codeph">ODCIIndex</code>) created for the power demand cartridge.</p>
<div class="tblformal" id="GUID-1DFCE5CB-E6DE-4D72-87F8-21334041ADC1__G1012471">
<p class="titleintable">Table 14-4 Indextype Methods</p>
<table class="cellalignment5987" title="Indextype Methods" summary="Lists the method functions created for the Power Demand cartridge example and describes each">
<thead>
<tr class="cellalignment5978">
<th class="cellalignment6000" id="d42543e2476">Method</th>
<th class="cellalignment6001" id="d42543e2479">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2484" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-28AC1C1B-6B6B-446F-A6C9-EEF4A4842D5F">ODCIGetInterfaces()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2484 d42543e2479">
<p>Returns the list interface names implemented by the type.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2493" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-C14A0478-6EA1-4EAE-BAA6-AA59EE5D300C">ODCIIndexCreate()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2493 d42543e2479">
<p>Creates a table to store index data. If the base table containing data to be indexed is not empty, this method builds the index for existing data.</p>
<p>This method is called when a <code class="codeph">CREATE</code> <code class="codeph">INDEX</code> statement is issued that refers to the indextype. Upon invocation, any parameters specified in the <code class="codeph">PARAMETERS</code> clause are passed in along with a description of the index.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2513" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-F128CB3B-6B3E-41C3-A623-67BCB5BC9292">ODCIIndexDrop()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2513 d42543e2479">
<p>Drops the table that stores the index data. This method is called when a <code class="codeph">DROP</code> <code class="codeph">INDEX</code> statement specifies the index.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2528" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2528 d42543e2479">
<p>Initializes the scan of the index for the operator predicate. This method is invoked when a query is submitted involving an operator that can be executed using the domain index.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2537" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2537 d42543e2479">
<p>Returns the <code class="codeph">ROWID</code> of each row that satisfies the operator predicate.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2549" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-2F49CDE4-C064-4644-948C-BBF014FDD8C8">ODCIIndexClose()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2549 d42543e2479">
<p>Ends the current use of the index. This method can perform any necessary clean-up.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2558" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-EF42025B-6DE2-4F2A-90EF-62775EE0EED6">ODCIIndexInsert()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2558 d42543e2479">
<p>Maintains the index structure when a record is inserted in a table that contains columns or object attributes indexed by the indextype.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2567" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-4B2E080D-FE8B-4598-9084-56FBE255196B">ODCIIndexDelete()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2567 d42543e2479">
<p>Maintains the index structure when a record is deleted from a table that contains columns or object attributes indexed by the indextype.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2576" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-CB42E738-EFD1-4053-9DDF-BEF455F92815">ODCIIndexUpdate()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2576 d42543e2479">
<p>Maintains the index structure when a record is updated (modified) in a table that contains columns or object attributes indexed by the indextype.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e2585" headers="d42543e2476">
<p><a href="ext_idx_ref.htm#GUID-B4A15D4C-A136-494E-BA05-4E8DD776C118">ODCIIndexGetMetadata()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e2585 d42543e2479">
<p>Allows the export and import of implementation-specific metadata associated with the index.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4810"></a><a id="ADDCI4809"></a>
<div class="props_rev_3"><a id="GUID-82CA23D3-C083-4570-8A1B-E3184007AAB4"></a>
<h3 id="ADDCI-GUID-82CA23D3-C083-4570-8A1B-E3184007AAB4" class="sect3">Defining theType</h3>
<div>
<div class="section">
<p><a href="pwr_example.htm#GUID-82CA23D3-C083-4570-8A1B-E3184007AAB4__CIAFGJIC">Example 14-6</a> creates the <code class="codeph">power_idxtype_im</code> object type. The methods of this type are the ODCI methods to define, manipulate, and scan the domain index. The <code class="codeph">curnum</code> attribute is the cursor number used as context for the scan routines <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a>, <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a>, and <a href="ext_idx_ref.htm#GUID-2F49CDE4-C064-4644-948C-BBF014FDD8C8">ODCIIndexClose()</a>.</p>
<p>The <code class="codeph">CREATE</code> <code class="codeph">TYPE</code> statement is followed by a <code class="codeph">CREATE</code> <code class="codeph">TYPE</code> <code class="codeph">BODY</code> statement that specifies the implementation for each member function:</p>
<pre dir="ltr">CREATE OR REPLACE TYPE BODY power_idxtype_im 
IS
...
</pre>
<p>All the method definitions (except for <a href="ext_idx_ref.htm#GUID-B4A15D4C-A136-494E-BA05-4E8DD776C118">ODCIIndexGetMetadata()</a>, which returns a <code class="codeph">VARCHAR2</code> string) have the following general form:</p>
<pre dir="ltr">  STATIC FUNCTION function-name (...) 
    RETURN NUMBER
  IS
  ...
  END;
</pre></div>
<!-- class="section" -->
<div class="example" id="GUID-82CA23D3-C083-4570-8A1B-E3184007AAB4__CIAFGJIC">
<p class="titleinexample">Example 14-6 Creating power_idxtype_im Object Type for Power Demand Cartridge</p>
<pre dir="ltr">CREATE OR REPLACE TYPE power_idxtype_im AS OBJECT
(
  curnum NUMBER,
  STATIC FUNCTION ODCIGetInterfaces(ifclist OUT sys.ODCIObjectList)
     RETURN NUMBER,
  STATIC FUNCTION ODCIIndexCreate (ia sys.ODCIIndexInfo, parms VARCHAR2, 
     env sys.ODCIEnv) RETURN NUMBER,
  STATIC FUNCTION ODCIIndexDrop(ia sys.ODCIIndexInfo, env sys.ODCIEnv)
     RETURN NUMBER,
  STATIC FUNCTION ODCIIndexStart(sctx IN OUT power_idxtype_im,
                                 ia sys.ODCIIndexInfo,
                                 op sys.ODCIPredInfo, qi sys.ODCIQueryInfo,
                                 strt NUMBER, stop NUMBER,
                                 cmppos NUMBER, cmpval NUMBER, env sys.ODCIEnv) 
     RETURN NUMBER,
  STATIC FUNCTION ODCIIndexStart(sctx IN OUT power_idxtype_im,
                                 ia sys.ODCIIndexInfo,
                                 op sys.ODCIPredInfo, qi sys.ODCIQueryInfo,
                                 strt NUMBER, stop NUMBER,
                                 cmpval NUMBER, env sys.ODCIEnv)
     RETURN NUMBER,
  MEMBER FUNCTION ODCIIndexFetch(nrows NUMBER, rids OUT sys.ODCIRidList, 
     env sys.ODCIEnv) RETURN NUMBER,
  MEMBER FUNCTION ODCIIndexClose (env sys.ODCIEnv) RETURN NUMBER,
  STATIC FUNCTION ODCIIndexInsert(ia sys.ODCIIndexInfo, rid VARCHAR2,
                                  newval PowerDemand_Typ, env sys.ODCIEnv)
     RETURN NUMBER,
  STATIC FUNCTION ODCIIndexDelete(ia sys.ODCIIndexInfo, rid VARCHAR2,
                                  oldval PowerDemand_Typ, env sys.ODCIEnv)
     RETURN NUMBER,
  STATIC FUNCTION ODCIIndexUpdate(ia sys.ODCIIndexInfo, rid VARCHAR2,
                                  oldval PowerDemand_Typ, 
                                  newval PowerDemand_Typ, env sys.ODCIEnv) 
     RETURN NUMBER,
  STATIC FUNCTION ODCIIndexGetMetadata(ia sys.ODCIIndexInfo, 
                                       expversion VARCHAR2, 
                                       newblock OUT PLS_INTEGER, 
                                       env sys.ODCIEnv) 
     RETURN VARCHAR2
);
/
</pre></div>
<!-- class="example" --></div>
<a id="ADDCI4812"></a><a id="ADDCI4811"></a>
<div class="props_rev_3"><a id="GUID-7CDBE109-6EAB-41EE-BFB5-DD94CE516186"></a>
<h4 id="ADDCI-GUID-7CDBE109-6EAB-41EE-BFB5-DD94CE516186" class="sect4">ODCIGetInterfaces()</h4>
<div>
<div class="section">
<p><a id="d42543e2757" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-28AC1C1B-6B6B-446F-A6C9-EEF4A4842D5F">ODCIGetInterfaces()</a> function returns the list of names of the interfaces implemented by the type. To specify the current version of these interfaces, the <a href="ext_idx_ref.htm#GUID-28AC1C1B-6B6B-446F-A6C9-EEF4A4842D5F">ODCIGetInterfaces()</a> routine must return<code class="codeph">&#39;SYS.ODCIINDEX2&#39;</code> in the <code class="codeph">OUT</code> parameter, as demonstrated in <a href="pwr_example.htm#GUID-7CDBE109-6EAB-41EE-BFB5-DD94CE516186__CIAIHJBJ">Example 14-7</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-7CDBE109-6EAB-41EE-BFB5-DD94CE516186__CIAIHJBJ">
<p class="titleinexample">Example 14-7 Registering Interface and Index Functions in Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIGetInterfaces(
  ifclist OUT sys.ODCIObjectList)
RETURN NUMBER IS
BEGIN
  ifclist := sys.ODCIObjectList(sys.ODCIObject(&#39;SYS&#39;,&#39;ODCIINDEX2&#39;));
  return ODCIConst.Success;
END ODCIGetInterfaces;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4814"></a><a id="ADDCI4813"></a>
<div class="props_rev_3"><a id="GUID-E5950FD7-A2C2-4455-BFCA-62FFB2ECCB96"></a>
<h4 id="ADDCI-GUID-E5950FD7-A2C2-4455-BFCA-62FFB2ECCB96" class="sect4">ODCIIndexCreate()</h4>
<div>
<div class="section">
<p><a id="d42543e2835" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-C14A0478-6EA1-4EAE-BAA6-AA59EE5D300C">ODCIIndexCreate()</a> function creates the table to store index data. If the base table containing data to be indexed is not empty, this method inserts the index data entries for existing data.</p>
<p>The function takes the index information as an object parameter whose type is <code class="codeph">SYS</code>.<code class="codeph">ODCIINDEXINFO</code>. The type attributes include the index name, owner name, and so forth. The <code class="codeph">PARAMETERS</code> string specified in the <code class="codeph">CREATE</code> <code class="codeph">INDEX</code> statement is also passed in as a parameter to the function, as demonstrated in <a href="pwr_example.htm#GUID-E5950FD7-A2C2-4455-BFCA-62FFB2ECCB96__CIAFJFEH">Example 14-8</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-E5950FD7-A2C2-4455-BFCA-62FFB2ECCB96__CIAFJFEH">
<p class="titleinexample">Example 14-8 Registering ODCIIndexCreate() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexCreate (
  ia sys.ODCIIndexInfo,
  parms VARCHAR2,
  env sys.ODCIEnv)
RETURN NUMBER IS
  i INTEGER;
  r ROWID;
  p NUMBER;
  v NUMBER;
  stmt1 VARCHAR2(1000);
  stmt2 VARCHAR2(1000);
  stmt3 VARCHAR2(1000);
  cnum1 INTEGER;
  cnum2 INTEGER;
  cnum3 INTEGER;
junk NUMBER;
</pre>
<p>The SQL statement to create the table for the index data is constructed and executed. The table includes the <code class="codeph">ROWID</code> of the base table, <code class="codeph">r</code>, the cell position number (<code class="codeph">cpos</code>) in the grid from 1 to 100, and the power demand value in that cell (<code class="codeph">cval</code>).</p>
<pre dir="ltr">BEGIN
  -- Construct the SQL statement.
  stmt1 := &#39;CREATE TABLE &#39; || ia.IndexSchema || &#39;.&#39; || ia.IndexName ||&#39;_pidx&#39; ||
      &#39;( r ROWID, cpos NUMBER, cval NUMBER)&#39;;

  -- Dump the SQL statement.
  dbms_output.put_line(&#39;ODCIIndexCreate&gt;&gt;&gt;&gt;&gt;&#39;);
  sys.ODCIIndexInfoDump(ia);
  dbms_output.put_line(&#39;ODCIIndexCreate&gt;&gt;&gt;&gt;&gt;&#39;||stmt1);

  -- Execute the statement.
  cnum1 := dbms_sql.open_cursor;
  dbms_sql.parse(cnum1, stmt1, dbms_sql.native);
  junk := dbms_sql.execute(cnum1);
  dbms_sql.close_cursor(cnum1);
</pre>
<p>The function populates the index by inserting rows into the table. The function &#34;unnests&#34; the <code class="codeph">VARRAY</code> attribute and inserts a row for each cell into the table. Thus, each 10 X 10 grid (10 rows, 10 values for each row) becomes 100 rows in the table (one row for each cell).</p>
<pre dir="ltr">  -- Now populate the table.
  stmt2 := &#39; INSERT INTO &#39;|| ia.IndexSchema || &#39;.&#39; || ia.IndexName || &#39;_pidx&#39; ||
      &#39; SELECT :rr, ROWNUM, column_value FROM THE&#39; || &#39; (SELECT CAST (P.&#39;||
      ia.IndexCols(1).ColName||&#39;.CellDemandValues AS NumTab_Typ)&#39;|| &#39; FROM &#39; ||
      ia.IndexCols(1).TableSchema || &#39;.&#39; || ia.IndexCols(1).TableName || &#39; P&#39; ||
      &#39; WHERE P.ROWID = :rr)&#39;;
 
  -- Execute the statement.
  dbms_output.put_line(&#39;ODCIIndexCreate&gt;&gt;&gt;&gt;&gt;&#39;||stmt2);
 
  -- Parse the statement.
  cnum2 := dbms_sql.open_cursor;
  dbms_sql.parse(cnum2, stmt2, dbms_sql.native);
 
  stmt3 := &#39;SELECT ROWID FROM &#39;|| ia.IndexCols(1).TableSchema || &#39;.&#39; ||
      ia.IndexCols(1).TableName;
  dbms_output.put_line(&#39;ODCIIndexCreate&gt;&gt;&gt;&gt;&gt;&#39;||stmt3);
  cnum3 := dbms_sql.open_cursor;
  dbms_sql.parse(cnum3, stmt3, dbms_sql.native);
  dbms_sql.define_column_rowid(cnum3, 1, r);   
  junk := dbms_sql.execute(cnum3);
 
   WHILE dbms_sql.fetch_rows(cnum3) &gt; 0 LOOP
    -- Get column values of the row. --
    dbms_sql.column_value_rowid(cnum3, 1, r);
    -- Bind the row into the cursor for the next insert. --
    dbms_sql.bind_variable_rowid(cnum2, &#39;:rr&#39;, r);
    junk := dbms_sql.execute(cnum2);
  END LOOP;
</pre>
<p>The function concludes by closing the cursors and returning a success status.</p>
<pre dir="ltr">  dbms_sql.close_cursor(cnum2);
  dbms_sql.close_cursor(cnum3);
  RETURN ODCICONST.SUCCESS;
END ODCIInexCreate;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4816"></a><a id="ADDCI4815"></a>
<div class="props_rev_3"><a id="GUID-51A035C8-8C13-4905-B829-DF7998F3E826"></a>
<h4 id="ADDCI-GUID-51A035C8-8C13-4905-B829-DF7998F3E826" class="sect4">ODCIIndexDrop()</h4>
<div>
<div class="section">
<p><a id="d42543e2949" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-F128CB3B-6B3E-41C3-A623-67BCB5BC9292">ODCIIndexDrop()</a> function drops the table that stores the index data, as demonstrated in <a href="pwr_example.htm#GUID-51A035C8-8C13-4905-B829-DF7998F3E826__CIADADCD">Example 14-9</a>. This method is called when a <code class="codeph">DROP</code> <code class="codeph">INDEX</code> statement is issued.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-51A035C8-8C13-4905-B829-DF7998F3E826__CIADADCD">
<p class="titleinexample">Example 14-9 Registering ODCIIndexDrop() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexDrop(ia sys.ODCIIndexInfo, env sys.ODCIEnv)
RETURN NUMBER IS
  stmt VARCHAR2(1000);
  cnum INTEGER;
  junk INTEGER;
BEGIN
  -- Construct the SQL statement.
  stmt := &#39;drop table &#39; || ia.IndexSchema || &#39;.&#39; || ia.IndexName || &#39;_pidx&#39;;
  
  dbms_output.put_line(&#39;ODCIIndexDrop&gt;&gt;&gt;&gt;&gt;&#39;);
  sys.ODCIIndexInfoDump(ia);
  dbms_output.put_line(&#39;ODCIIndexDrop&gt;&gt;&gt;&gt;&gt;&#39;||stmt);
  
  -- Execute the statement.
  cnum := dbms_sql.open_cursor;
  dbms_sql.parse(cnum, stmt, dbms_sql.native);
  junk := dbms_sql.execute(cnum);
  dbms_sql.close_cursor(cnum);
  
  RETURN ODCICONST.SUCCESS;
END ODCIIndexDrop;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4818"></a><a id="ADDCI4817"></a>
<div class="props_rev_3"><a id="GUID-AB826A69-6D7D-4224-99F1-19771BC2D87B"></a>
<h4 id="ADDCI-GUID-AB826A69-6D7D-4224-99F1-19771BC2D87B" class="sect4">ODCIIndexStart(); <span class="bold">Specific</span> Queries</h4>
<div>
<div class="section">
<p><a id="d42543e3026" class="indexterm-anchor"></a>The first definition of the <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a> function initializes the scan of the index to return all rows that satisfy the operator predicate. For example, if a query asks for all instances where cell <code class="codeph">(3,7)</code> has a value equal to <code class="codeph">25</code>, the function initializes the scan to return all rows in the index-organized table for which that cell has that value. This definition of <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a> differs from the definition in <a href="pwr_example.htm#GUID-22B9F918-5A37-414D-B3FC-0B8ADF61BA36">ODCIIndexStart(); Any Queries</a> in that it includes the <code class="codeph">cmppos</code> parameter for the position of the cell.</p>
<p>The <code class="codeph">self</code> parameter is the context that is shared with the <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a> and <a href="ext_idx_ref.htm#GUID-2F49CDE4-C064-4644-948C-BBF014FDD8C8">ODCIIndexClose()</a> functions. The <code class="codeph">ia</code> parameter contains the index information as an object instance of type <code class="codeph">SYS</code>.<code class="codeph">ODCIINDEXINFO</code>, and the <code class="codeph">op</code> parameter contains the operator information as an object instance of type <code class="codeph">SYS</code>.<code class="codeph">ODCIOPERINFO</code>. The <code class="codeph">strt</code> and <code class="codeph">stop</code> parameters are the lower and upper boundary points for the operator return value. The <code class="codeph">cmppos</code> parameter is the cell position and <code class="codeph">cmpval</code> is the value in the cell specified by the operator <code class="codeph">Power_XxxxxSpecific()</code>. This is demonstrated in <a href="pwr_example.htm#GUID-AB826A69-6D7D-4224-99F1-19771BC2D87B__CIAEHIJB">Example 14-10</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-AB826A69-6D7D-4224-99F1-19771BC2D87B__CIAEHIJB">
<p class="titleinexample">Example 14-10 Registering ODCIIndexStart() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexStart(
  sctx IN OUT power_idxtype_im, 
  ia sys.ODCIIndexInfo,
  op sys.ODCIPredInfo, 
  qi sys.ODCIQueryInfo,
  strt NUMBER, stop NUMBER,
  cmppos NUMBER, 
  cmpval NUMBER, 
  env sys.ODCIEnv ) 
RETURN NUMBER IS
  cnum INTEGER;
  rid ROWID;
  nrows INTEGER;
  relop VARCHAR2(2);
  stmt VARCHAR2(1000);
BEGIN
  dbms_output.put_line(&#39;ODCIIndexStart&gt;&gt;&gt;&gt;&gt;&#39;);
  sys.ODCIIndexInfoDump(ia);
  sys.ODCIPredInfoDump(op);
  dbms_output.put_line(&#39;start key : &#39;||strt);
  dbms_output.put_line(&#39;stop key : &#39;||stop);
  dbms_output.put_line(&#39;compare position : &#39;||cmppos);
  dbms_output.put_line(&#39;compare value : &#39;||cmpval);
</pre>
<p>The function checks for errors in the predicate.</p>
<pre dir="ltr">  -- Take care of some error cases.
  -- The only predicates in which btree operators can appear are
  --    op() = 1     OR    op() = 0
  if (strt != 1) and (strt != 0) then
    raise_application_error(-20101, &#39;Incorrect predicate for operator&#39;);
  END if;
 
  if (stop != 1) and (stop != 0) then
    raise_application_error(-20101, &#39;Incorrect predicate for operator&#39;);
  END if;
</pre>
<p>The function generates the SQL statement to be executed. It determines the operator name and the lower and upper index value bounds (the start and stop keys). The start and stop keys can both be 1 (= <code class="codeph">TRUE</code>) or both be 0 (= <code class="codeph">FALSE</code>).</p>
<pre dir="ltr">  -- Generate the SQL statement to be executed.
  -- First, figure out the relational operator needed for the statement.
  -- Take into account the operator name and the start and stop keys. For now, 
  -- the start and stop keys can both be 1 (= TRUE) or both be 0 (= FALSE).
  if op.ObjectName = &#39;POWER_EQUALS&#39; then
    if strt = 1 then 
      relop := &#39;=&#39;;
    else
      relop := &#39;!=&#39;;
    end if;
  elsif op.ObjectName = &#39;POWER_LESSTHAN&#39; then
    if strt = 1 then 
      relop := &#39;&lt;&#39;;
    else
      relop := &#39;&gt;=&#39;;
    end if;
  elsif op.ObjectName = &#39;POWER_GREATERTHAN&#39; then
    if strt = 1 then 
      relop := &#39;&gt;&#39;;
    else
      relop := &#39;&lt;=&#39;;
    end if;
  else
    raise_application_error(-20101, &#39;Unsupported operator&#39;);
  end if;
 
  stmt := &#39;select r from &#39;||ia.IndexSchema||&#39;.&#39;||ia.IndexName||&#39;_pidx&#39;||
      &#39; where cpos &#39;|| &#39;=&#39; ||&#39;&#39;&#39;&#39;||cmppos||&#39;&#39;&#39;&#39;|| &#39; and cval &#39; ||relop||&#39;&#39;&#39;&#39;||
      cmpval||&#39;&#39;&#39;&#39;;
 
  dbms_output.put_line(&#39;ODCIIndexStart&gt;&gt;&gt;&gt;&gt;&#39; || stmt);
   cnum := dbms_sql.open_cursor;
  dbms_sql.parse(cnum, stmt, dbms_sql.native);
  dbms_sql.define_column_rowid(cnum, 1, rid);   
  nrows := dbms_sql.execute(cnum);
</pre>
<p>The function stores the cursor number in the context, which is used by the <code class="codeph">ODCIIndexFetch</code> function, and sets a success return status.</p>
<pre dir="ltr">  -- Set context as the cursor number.
  stcx := power_idxtype_im(cnum);
 
  -- Return success.
  RETURN ODCICONST.SUCCESS;
END ODCIIndexStart;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4820"></a><a id="ADDCI4819"></a>
<div class="props_rev_3"><a id="GUID-22B9F918-5A37-414D-B3FC-0B8ADF61BA36"></a>
<h4 id="ADDCI-GUID-22B9F918-5A37-414D-B3FC-0B8ADF61BA36" class="sect4">ODCIIndexStart(); <span class="bold">Any</span> Queries</h4>
<div>
<div class="section">
<p><a id="d42543e3184" class="indexterm-anchor"></a>This definition of the <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a> function initializes the scan of the index to return all rows that satisfy the operator predicate. For example, if a query asks for all instances where any cell has a value equal to <code class="codeph">25</code>, the function initializes the scan to return all rows in the index-organized table for which that cell has that value. This definition of <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a> differs from the definition in <a href="pwr_example.htm#GUID-AB826A69-6D7D-4224-99F1-19771BC2D87B">ODCIIndexStart(); Specific Queries</a> in that it does not include the <code class="codeph">cmppos</code> parameter.</p>
<p>The <code class="codeph">self</code> parameter is the context that is shared with the <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a> and <a href="ext_idx_ref.htm#GUID-2F49CDE4-C064-4644-948C-BBF014FDD8C8">ODCIIndexClose()</a> functions. The <code class="codeph">ia</code> parameter contains the index information as an object instance of type <code class="codeph">SYS</code>.<code class="codeph">ODCIINDEXINFO</code>, and the <code class="codeph">op</code> parameter contains the operator information as an object instance of type <code class="codeph">SYS</code>.<code class="codeph">ODCIOPERINFO</code>. The <code class="codeph">strt</code> and <code class="codeph">stop</code> parameters are the lower and upper boundary points for the operator return value. The <code class="codeph">cmpval</code> parameter is the value in the cell specified by the operator <code class="codeph">Power_Xxxx()</code>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-22B9F918-5A37-414D-B3FC-0B8ADF61BA36__GUID-2DC85583-9A65-4734-8052-E0AB7BD91C50">
<p class="titleinexample">Example 14-11 Registering ODCIIndexStart() for Any Queries for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexStart(
  sctx IN OUT power_idxtype_im, 
  ia sys.ODCIIndexInfo,
  op sys.ODCIPredInfo, 
  qi sys.ODCIQueryInfo,
  strt NUMBER, 
  stop NUMBER,
  cmpval NUMBER, 
  env sys.ODCIEnv ) 
RETURN NUMBER IS
  cnum INTEGER;
  rid ROWID;
  nrows INTEGER;
  relop VARCHAR2(2);
  stmt VARCHAR2(1000);
BEGIN
  dbms_output.put_line(&#39;ODCIIndexStart&gt;&gt;&gt;&gt;&gt;&#39;);
  sys.ODCIIndexInfoDump(ia);
  sys.ODCIPredInfoDump(op);
  dbms_output.put_line(&#39;start key : &#39;||strt);
  dbms_output.put_line(&#39;stop key : &#39;||stop);
  dbms_output.put_line(&#39;compare value : &#39;||cmpval);
</pre>
<p>The function checks for errors in the predicate.</p>
<pre dir="ltr">  -- Take care of some error cases.
  -- The only predicates in which btree operators can appear are
  --    op() = 1     OR    op() = 0
  if (strt != 1) and (strt != 0) then
    raise_application_error(-20101, &#39;Incorrect predicate for operator&#39;);
  END if;
 
  if (stop != 1) and (stop != 0) then
    raise_application_error(-20101, &#39;Incorrect predicate for operator&#39;);
  END if;
</pre>
<p>The function generates the SQL statement to be executed. It determines the operator name and the lower and upper index value bounds (the start and stop keys). The start and stop keys can both be 1 (= <code class="codeph">TRUE</code>) or both be 0 (= <code class="codeph">FALSE</code>).</p>
<pre dir="ltr">  -- Generate the SQL statement to be executed.
  -- First, figure out the relational operator needed for the statement.
  -- Take into account the operator name and the start and stop keys. For now, 
  -- the start and stop keys can both be 1 (= TRUE) or both be 0 (= FALSE).
  if op.ObjectName = &#39;POWER_EQUALSANY&#39; then
    relop := &#39;=&#39;;
  elsif op.ObjectName = &#39;POWER_LESSTHANANY&#39; then
    relop := &#39;&lt;&#39;;
  elsif op.ObjectName = &#39;POWER_GREATERTHANANY&#39; then
    relop := &#39;&gt;&#39;;
  else
    raise_application_error(-20101, &#39;Unsupported operator&#39;);
  end if;
 
  -- This statement returns the qualifying rows for the TRUE case.
  stmt := &#39;select distinct r from &#39;||ia.IndexSchema||&#39;.&#39;||ia.IndexName||&#39;_pidx&#39;||&#39;
      where cval &#39;||relop||&#39;&#39;&#39;&#39;||cmpval||&#39;&#39;&#39;&#39;;
  -- In the FALSE case, we must find the  complement of the rows.
  if (strt = 0) then
    stmt := &#39;select distinct r from &#39;||ia.IndexSchema||&#39;.&#39;||ia.IndexName||
          &#39;_pidx&#39;||&#39; minus &#39;||stmt;
  end if;
 
  dbms_output.put_line(&#39;ODCIIndexStart&gt;&gt;&gt;&gt;&gt;&#39; || stmt);
  cnum := dbms_sql.open_cursor;
  dbms_sql.parse(cnum, stmt, dbms_sql.native);
  dbms_sql.define_column_rowid(cnum, 1, rid);   
  nrows := dbms_sql.execute(cnum);
</pre>
<p>The function stores the cursor number in the context, which is used by the <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a> function, and sets a success return status.</p>
<pre dir="ltr">  -- Set context as the cursor number.
  self := power_idxtype_im(cnum);
 
  -- Return success.
  RETURN ODCICONST.SUCCESS;
END ODCIIndexStart;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4822"></a><a id="ADDCI4821"></a>
<div class="props_rev_3"><a id="GUID-68AC5CFF-9219-4F6F-8458-EE495FA5893F"></a>
<h4 id="ADDCI-GUID-68AC5CFF-9219-4F6F-8458-EE495FA5893F" class="sect4">ODCIIndexFetch()</h4>
<div>
<div class="section">
<p><a id="d42543e3332" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a> function, demonstrated in <a href="pwr_example.htm#GUID-68AC5CFF-9219-4F6F-8458-EE495FA5893F__CIAGGBBD">Example 14-12</a> returns a batch of <code class="codeph">ROWIDs</code> for the rows that satisfy the operator predicate. Each time <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a> is invoked, it returns the next batch of rows (<code class="codeph">rids</code> parameter, a collection of type <code class="codeph">SYS</code>.<code class="codeph">ODCIRIDLIST</code>) that satisfy the operator predicate. The maximum number of rows that can be returned on each invocation is specified by the <code class="codeph">nrows</code> parameter.</p>
<p>Oracle invokes <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a> repeatedly until all rows that satisfy the operator predicate have been returned.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-68AC5CFF-9219-4F6F-8458-EE495FA5893F__CIAGGBBD">
<p class="titleinexample">Example 14-12 Registering ODCIIndexFetch() for Power Demand Cartridge</p>
<pre dir="ltr">MEMBER FUNCTION ODCIIndexFetch(
  nrows NUMBER, 
  rids OUT sys.ODCIRidList, 
  env sys.ODCIEnv)
RETURN NUMBER IS
  cnum INTEGER;
  idx INTEGER := 1;
  rlist sys.ODCIRidList := sys.ODCIRidList();
  done boolean := FALSE;
</pre>
<p>The function loops through the collection of rows selected by the <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a> function, using the same cursor number, <code class="codeph">cnum</code>, as in the <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a> function, and returns the <code class="codeph">ROWIDs</code>.</p>
<pre dir="ltr">BEGIN
  dbms_output.put_line(&#39;ODCIIndexFetch&gt;&gt;&gt;&gt;&gt;&#39;);
  dbms_output.put_line(&#39;Nrows : &#39;||round(nrows));
 
  cnum := self.curnum;
 
  WHILE not done LOOP
    if idx &gt; nrows then
       done := TRUE;
    else
      rlist.extEND;
      if dbms_sql.fetch_rows(cnum) &gt; 0 then
        dbms_sql.column_value_rowid(cnum, 1, rlist(idx));
        idx := idx + 1;
      else
        rlist(idx) := null;
        done := TRUE;
      END if;
    END if;   
  END LOOP;
 
  rids := rlist;
  RETURN ODCICONST.SUCCESS;
END ODCIIndexFetch;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4824"></a><a id="ADDCI4823"></a>
<div class="props_rev_3"><a id="GUID-211432D0-CEA4-4D20-90A0-AC49EE5BC68A"></a>
<h4 id="ADDCI-GUID-211432D0-CEA4-4D20-90A0-AC49EE5BC68A" class="sect4">ODCIIndexClose()</h4>
<div>
<div class="section">
<p><a id="d42543e3444" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-2F49CDE4-C064-4644-948C-BBF014FDD8C8">ODCIIndexClose()</a> function, demonstrated in <a href="pwr_example.htm#GUID-211432D0-CEA4-4D20-90A0-AC49EE5BC68A__CIAEJGFH">Example 14-13</a>, closes the cursor used by the <a href="ext_idx_ref.htm#GUID-53F2321C-B0F8-4783-AC1B-056372A0C073">ODCIIndexStart()</a> and <a href="ext_idx_ref.htm#GUID-BB601420-A858-46E3-A9AC-3433220D4F82">ODCIIndexFetch()</a> functions.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-211432D0-CEA4-4D20-90A0-AC49EE5BC68A__CIAEJGFH">
<p class="titleinexample">Example 14-13 Registering ODCIIndexStart() for Power Demand Cartridge</p>
<pre dir="ltr">MEMBER FUNCTION ODCIIndexClose (env sys.ODCIEnv) 
RETURN NUMBER IS 
  cnum INTEGER;
BEGIN
  dbms_output.put_line(&#39;ODCIIndexClose&gt;&gt;&gt;&gt;&gt;&#39;);
 
  cnum := self.curnum;
  dbms_sql.close_cursor(cnum);
  RETURN ODCICONST.SUCCESS;
END ODCIIndexClose;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4826"></a><a id="ADDCI4825"></a>
<div class="props_rev_3"><a id="GUID-4F065165-D680-4F2D-823E-FCC7A2A9C5BC"></a>
<h4 id="ADDCI-GUID-4F065165-D680-4F2D-823E-FCC7A2A9C5BC" class="sect4">ODCIIndexInsert()</h4>
<div>
<div class="section">
<p><a id="d42543e3520" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-EF42025B-6DE2-4F2A-90EF-62775EE0EED6">ODCIIndexInsert()</a> function, demonstrated in <a href="pwr_example.htm#GUID-4F065165-D680-4F2D-823E-FCC7A2A9C5BC__CIAGGDAC">Example 14-14</a>, is called when a record is inserted in a table that contains columns or <code class="codeph">OBJECT</code> attributes indexed by the indextype. The new values in the indexed columns are passed in as arguments along with the corresponding row identifier.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-4F065165-D680-4F2D-823E-FCC7A2A9C5BC__CIAGGDAC">
<p class="titleinexample">Example 14-14 Registering ODCIIndexInsert() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexInsert(
  ia sys.ODCIIndexInfo, 
  rid VARCHAR2, 
  newval PowerDemand_Typ, 
  env sys.ODCIEnv) 
RETURN NUMBER AS 
  cid INTEGER; 
  i BINARY_INTEGER;
  nrows INTEGER;
  stmt VARCHAR2(1000);
BEGIN 
  dbms_output.put_line(&#39; &#39;);
  dbms_output.put_line(&#39;ODCIIndexInsert&gt;&gt;&gt;&gt;&gt;&#39;||&#39; TotGridDemand= &#39;||
      newval.TotGridDemand ||&#39; MaxCellDemand= &#39;||newval.MaxCellDemand ||
      &#39; MinCellDemand= &#39;||newval.MinCellDemand) ;
  sys.ODCIIndexInfoDump(ia); 
      
  -- Construct the statement.
  stmt := &#39; INSERT INTO &#39;|| ia.IndexSchema || &#39;.&#39; || ia.IndexName || &#39;_pidx&#39; ||
      &#39; VALUES (:rr, :pos, :val)&#39;;
  
  -- Execute the statement.
  dbms_output.put_line(&#39;ODCIIndexInsert&gt;&gt;&gt;&gt;&gt;&#39;||stmt);
  -- Parse the statement.
  cid := dbms_sql.open_cursor;
  dbms_sql.parse(cid, stmt, dbms_sql.native);
  dbms_sql.bind_variable_rowid(cid, &#39;:rr&#39;, rid);
      
  -- Iterate over the rows of the Varray and insert them.
  i := newval.CellDemandValues.FIRST;   
  WHILE i IS NOT NULL LOOP
    -- Bind the row into the cursor for insert.
    dbms_sql.bind_variable(cid, &#39;:pos&#39;, i);   
    dbms_sql.bind_variable(cid, &#39;:val&#39;, newval.CellDemandValues(i));
    -- Execute.
    nrows := dbms_sql.execute(cid);
    dbms_output.put_line(&#39;ODCIIndexInsert&gt;&gt;&gt;&gt;&gt;(&#39;||&#39;RID&#39;||&#39; , &#39;||i|| &#39; , &#39;||
           newval.CellDemandValues(i)|| &#39;)&#39;);
    i := newval.CellDemandValues.NEXT(i);
  END LOOP;

  dbms_sql.close_cursor(cid);
  RETURN ODCICONST.SUCCESS;
END ODCIIndexInsert;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4828"></a><a id="ADDCI4827"></a>
<div class="props_rev_3"><a id="GUID-E30FF8C3-6251-4AFF-8BDE-E88935CB7235"></a>
<h4 id="ADDCI-GUID-E30FF8C3-6251-4AFF-8BDE-E88935CB7235" class="sect4">ODCIIndexDelete()</h4>
<div>
<div class="section">
<p><a id="d42543e3592" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-4B2E080D-FE8B-4598-9084-56FBE255196B">ODCIIndexDelete()</a> function, demonstrated in <a href="pwr_example.htm#GUID-E30FF8C3-6251-4AFF-8BDE-E88935CB7235__CIAIGHCB">Example 14-15</a>, is called when a record is deleted from a table that contains columns or object attributes indexed by the indextype. The old values in the indexed columns are passed in as arguments along with the corresponding row identifier.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-E30FF8C3-6251-4AFF-8BDE-E88935CB7235__CIAIGHCB">
<p class="titleinexample">Example 14-15 Registering ODCIIndexDelete() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexDelete(
  ia sys.ODCIIndexInfo, 
  rid VARCHAR2,
  oldval PowerDemand_Typ,
  env sys.ODCIEnv) 
RETURN NUMBER AS 
  cid INTEGER; 
  stmt VARCHAR2(1000);
  nrows INTEGER; 
BEGIN 
  dbms_output.put_line(&#39; &#39;);
  dbms_output.put_line(&#39;ODCIIndexDelete&gt;&gt;&gt;&gt;&gt;&#39;||&#39; TotGridDemand= &#39;||
      oldval.TotGridDemand ||&#39; MaxCellDemand= &#39;||oldval.MaxCellDemand ||
      &#39; MinCellDemand= &#39;||oldval.MinCellDemand) ;
  sys.ODCIIndexInfoDump(ia); 
 
  -- Construct the statement.
  stmt := &#39; DELETE FROM &#39;|| ia.IndexSchema || &#39;.&#39; ||ia.IndexName|| &#39;_pidx&#39; || 
      &#39; WHERE r=:rr&#39;;
  dbms_output.put_line(&#39;ODCIIndexDelete&gt;&gt;&gt;&gt;&gt;&#39;||stmt);
 
  -- Parse and execute the statement.
  cid := dbms_sql.open_cursor;
  dbms_sql.parse(cid, stmt, dbms_sql.native);
  dbms_sql.bind_variable_rowid(cid, &#39;:rr&#39;, rid);
  nrows := dbms_sql.execute(cid);     
  dbms_sql.close_cursor(cid);
 
  RETURN ODCICONST.SUCCESS;
END ODCIIndexDelete;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4830"></a><a id="ADDCI4829"></a>
<div class="props_rev_3"><a id="GUID-3878F1E1-F59D-4E36-8F23-FF446AFDC348"></a>
<h4 id="ADDCI-GUID-3878F1E1-F59D-4E36-8F23-FF446AFDC348" class="sect4">ODCIIndexUpdate()</h4>
<div>
<div class="section">
<p><a id="d42543e3660" class="indexterm-anchor"></a>The <a href="ext_idx_ref.htm#GUID-CB42E738-EFD1-4053-9DDF-BEF455F92815">ODCIIndexUpdate()</a> function, demonstrated in <a href="pwr_example.htm#GUID-3878F1E1-F59D-4E36-8F23-FF446AFDC348__CIAJDCEC">Example 14-16</a>, is called when a record is updated in a table that contains columns or object attributes indexed by the indextype. The old and new values in the indexed columns are passed in as arguments along with the row identifier.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-3878F1E1-F59D-4E36-8F23-FF446AFDC348__CIAJDCEC">
<p class="titleinexample">Example 14-16 Registering ODCIIndexUpdate() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexUpdate(
  ia sys.ODCIIndexInfo, 
  rid VARCHAR2, 
  oldval PowerDemand_Typ, 
  newval PowerDemand_Typ, 
  env sys.ODCIEnv) 
RETURN NUMBER AS 
  cid INTEGER; 
  cid2 INTEGER; 
  stmt VARCHAR2(1000);
  stmt2 VARCHAR2(1000);
  nrows INTEGER; 
  i NUMBER;
BEGIN 
  dbms_output.put_line(&#39; &#39;);
  dbms_output.put_line(&#39;ODCIIndexUpdate&gt;&gt;&gt;&gt;&gt; Old&#39;||&#39; TotGridDemand= &#39;||
      oldval.TotGridDemand||&#39; MaxCellDemand= &#39;||oldval.MaxCellDemand ||
      &#39; MinCellDemand= &#39;||oldval.MinCellDemand) ;
  dbms_output.put_line(&#39;ODCIIndexUpdate&gt;&gt;&gt;&gt;&gt; New&#39;||&#39; TotGridDemand= &#39;||
      newval.TotGridDemand ||&#39; MaxCellDemand= &#39;||newval.MaxCellDemand ||
      &#39; MinCellDemand= &#39;||newval.MinCellDemand) ;
  sys.ODCIIndexInfoDump(ia); 

  -- Delete old entries.
  stmt := &#39; DELETE FROM &#39;||ia.IndexSchema ||&#39;.&#39;||ia.IndexName||&#39;_pidx&#39;|| 
      &#39; WHERE r=:rr&#39;;
  dbms_output.put_line(&#39;ODCIIndexUpdate&gt;&gt;&gt;&gt;&gt;&#39;||stmt);
  
  -- Parse and execute the statement.
  cid := dbms_sql.open_cursor;
  dbms_sql.parse(cid, stmt, dbms_sql.native);
  dbms_sql.bind_variable_rowid(cid, &#39;:rr&#39;, rid);
  nrows := dbms_sql.execute(cid);     
  dbms_sql.close_cursor(cid);
 
  -- Insert new entries.
  stmt2 := &#39; INSERT INTO &#39;||ia.IndexSchema||&#39;.&#39;||ia.IndexName||&#39;_pidx&#39;||
      &#39; VALUES (:rr, :pos, :val)&#39;;
  dbms_output.put_line(&#39;ODCIIndexUpdate&gt;&gt;&gt;&gt;&gt;&#39;||stmt2);
 
  -- Parse and execute the statement.
  cid2 := dbms_sql.open_cursor;
  dbms_sql.parse(cid2, stmt2, dbms_sql.native);
  dbms_sql.bind_variable_rowid(cid2, &#39;:rr&#39;, rid);
     
  -- Iterate over the rows of the Varray and insert them.
  i := newval.CellDemandValues.FIRST;   
  WHILE i IS NOT NULL LOOP
    -- Bind the row into the cursor for insert.
    dbms_sql.bind_variable(cid2, &#39;:pos&#39;, i);   
    dbms_sql.bind_variable(cid2, &#39;:val&#39;, newval.CellDemandValues(i));
    nrows := dbms_sql.execute(cid2);
    dbms_output.put_line(&#39;ODCIIndexUpdate&gt;&gt;&gt;&gt;&gt;(&#39;||&#39;RID&#39;||&#39; , &#39;||i ||&#39; , &#39;||
         newval.CellDemandValues(i)|| &#39;)&#39;);
    i := newval.CellDemandValues.NEXT(i);
  END LOOP;
  dbms_sql.close_cursor(cid2);
 
  RETURN ODCICONST.SUCCESS;
END ODCIIndexUpdate;
</pre>
<p><code class="codeph">ODCIIndexUpdate</code> is the last method defined in the <code class="codeph">CREATE</code> <code class="codeph">TYPE</code> <code class="codeph">BODY</code> statement, which ends as follows:</p>
<pre dir="ltr">END;
/
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4832"></a><a id="ADDCI4833"></a><a id="ADDCI4831"></a>
<div class="props_rev_3"><a id="GUID-D42D34EB-5AEF-4F85-A7BD-EA0F2EB2E6F6"></a>
<h4 id="ADDCI-GUID-D42D34EB-5AEF-4F85-A7BD-EA0F2EB2E6F6" class="sect4">ODCIIndexGetMetadata()</h4>
<div>
<div class="section">
<p><a id="d42543e3744" class="indexterm-anchor"></a><a id="d42543e3746" class="indexterm-anchor"></a><a id="d42543e3750" class="indexterm-anchor"></a>The optional <code class="codeph">ODCIIndexGetMetadata()</code> function, as demonstrated in <a href="pwr_example.htm#GUID-D42D34EB-5AEF-4F85-A7BD-EA0F2EB2E6F6__CIABBAEG">Example 14-17</a>, if present, is called by the Export utility to write implementation-specific metadata (which is not stored in the system catalogs) into the export dump file. This metadata might be policy information, version information, user settings, and so on. This metadata is written to the dump file as anonymous PL/SQL blocks that are executed at import time, immediately before the associated index is created.</p>
<p>This method returns strings to the Export utility that comprise the code of the PL/SQL blocks. The Export utility repeatedly calls this method until a zero-length string is returned, thus allowing the creation of any number of PL/SQL blocks of arbitrary complexity. Normally, this method calls functions within a PL/SQL package to make use of package-level variables, such as cursors and iteration counters, that maintain state across multiple calls by Export.</p>
<p>In the power demand cartridge, the only metadata that is passed is a version string of <code class="codeph">V1.0</code>, identifying the current format of the index-organized table that underlies the domain index. The <code class="codeph">power_pkg</code>.<code class="codeph">getversion</code> function generates a call to the <code class="codeph">power_pkg</code>.<code class="codeph">checkversion</code> procedure, to be executed at import time to check that the version string is <code class="codeph">V1.0</code>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-D42D34EB-5AEF-4F85-A7BD-EA0F2EB2E6F6__CIABBAEG">
<p class="titleinexample">Example 14-17 Registering ODCIIndexGetMetadata() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIIndexGetMetadata(
  ia sys.ODCIIndexInfo, 
  expversion VARCHAR2, 
  newblock OUT PLS_INTEGER, 
  env sys.ODCIEnv) 
RETURN VARCHAR2 IS 
 
BEGIN 
  -- Let getversion do all the work since it has to maintain state across calls. 
 
  RETURN power_pkg.getversion (ia.IndexSchema, ia.IndexName, newblock); 
 
  EXCEPTION 
    WHEN OTHERS THEN 
      RAISE; 
 
END ODCIIndexGetMetaData; 
 
</pre></div>
<!-- class="example" -->
<div class="section">
<p>The <code class="codeph">power_pkg</code> package is defined as follows:</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-D42D34EB-5AEF-4F85-A7BD-EA0F2EB2E6F6__GUID-D81BF8B3-527F-4EBE-BE56-7AD80300F4F8">
<p class="titleinexample">Example 14-18 Creating Package power_pkg for the Power Demand Cartridge</p>
<pre dir="ltr">CREATE OR REPLACE PACKAGE power_pkg AS  
  FUNCTION getversion(
    idxschema IN VARCHAR2, 
    idxname IN VARCHAR2,
    newblock OUT PLS_INTEGER) 
  RETURN VARCHAR2; 

  PROCEDURE checkversion (
  version IN VARCHAR2);  
END power_pkg; 
/ 
SHOW ERRORS; 
 
CREATE OR REPLACE PACKAGE BODY power_pkg AS  
  -- iterate is a package-level variable used to maintain state across calls 
  -- by Export in this session. 
  
  iterate NUMBER := 0;  
  
  FUNCTION getversion(
    idxschema IN VARCHAR2, 
    idxname IN VARCHAR2,  
    newblock OUT PLS_INTEGER) 
  RETURN VARCHAR2 IS  
  
  BEGIN  
  
  -- We are generating only one PL/SQL block consisting of one line of code.
    newblock := 1; 
  
    IF iterate = 0 THEN  
      -- Increment iterate so we&#39;ll know we&#39;re done next time we&#39;re called. 
      iterate := iterate + 1;  
  
      -- Return a string that calls checkversion with a version &#39;V1.0&#39; 
      -- Note that export adds the surrounding BEGIN/END pair to form the anon. 
      -- block... we don&#39;t have to. 
  
      RETURN &#39;power_pkg.checkversion(&#39;&#39;V1.0&#39;&#39;);&#39;;  
    ELSE  
      -- reset iterate for next index  
      iterate := 0;  
      -- Return a 0-length string; we won&#39;t be called again for this index. 
      RETURN &#39;&#39;;  
    END IF;  
  END getversion;  
  
  PROCEDURE checkversion (version IN VARCHAR2) 
  IS  
    wrong_version EXCEPTION; 
 
  BEGIN  
    IF version != &#39;V1.0&#39; THEN 
      RAISE wrong_version; 
    END IF; 
  END checkversion;  

END power_pkg;
</pre></div>
<!-- class="example" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-D42D34EB-5AEF-4F85-A7BD-EA0F2EB2E6F6__GUID-62E38A99-7970-40A6-9AE9-E16C7468371C">
<p class="notep1">See Also:</p>
<p><a class="olink SUTIL" target="_blank" href="../SUTIL/toc.htm"><span class="variable">Oracle Database Utilities</span></a> for information about the Export and Import utilities</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="ADDCI4835"></a><a id="ADDCI4834"></a>
<div class="props_rev_3"><a id="GUID-50AEDF62-AA49-40A2-9B4D-64E0C22BDFB6"></a>
<h3 id="ADDCI-GUID-50AEDF62-AA49-40A2-9B4D-64E0C22BDFB6" class="sect3">Creating the Indextype</h3>
<div>
<div class="section">
<p>The power demand cartridge creates the indextype for the domain index. The specification, in <a href="pwr_example.htm#GUID-50AEDF62-AA49-40A2-9B4D-64E0C22BDFB6__CIAHDCFE">Example 14-19</a>, includes the list of operators supported by the indextype. It also identifies the implementation type containing the OCDI index routines.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-50AEDF62-AA49-40A2-9B4D-64E0C22BDFB6__CIAHDCFE">
<p class="titleinexample">Example 14-19 Creating Indextype power_idxtype for Power Demand Cartridge</p>
<pre dir="ltr">CREATE OR REPLACE INDEXTYPE power_idxtype
FOR
  Power_Equals(PowerDemand_Typ, NUMBER, NUMBER),
  Power_GreaterThan(PowerDemand_Typ, NUMBER, NUMBER),
  Power_LessThan(PowerDemand_Typ, NUMBER, NUMBER),
  Power_EqualsAny(PowerDemand_Typ, NUMBER),
  Power_GreaterThanAny(PowerDemand_Typ, NUMBER),
  Power_LessThanAny(PowerDemand_Typ, NUMBER)
USING power_idxtype_im;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADDCI4836"></a>
<div class="props_rev_3"><a id="GUID-AD1B4965-8FDB-458B-9E68-09116FD294E4"></a>
<h2 id="ADDCI-GUID-AD1B4965-8FDB-458B-9E68-09116FD294E4" class="sect2">Defining Types and Methods for Extensible Optimizing</h2>
<div>
<p>Consider the parts of the power demand cartridge as they relate to extensible optimization.</p>
</div>
<a id="ADDCI4838"></a><a id="ADDCI4837"></a>
<div class="props_rev_3"><a id="GUID-12482A82-9C85-450A-AF32-2B7654EA2328"></a>
<h3 id="ADDCI-GUID-12482A82-9C85-450A-AF32-2B7654EA2328" class="sect3">Creating the Statistics Table, PowerCartUserStats</h3>
<div>
<div class="section">
<p>The table <code class="codeph">PowerCartUserStats</code>, demonstrated in <a href="pwr_example.htm#GUID-12482A82-9C85-450A-AF32-2B7654EA2328__CIAGEBIC">Example 14-20</a>, stores statistics about the hourly power grid readings. The method <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> uses these statistics to estimate the selectivity of operator predicates. Because of the types of statistics collected, it is more convenient to use a separate table instead of letting Oracle store the statistics.</p>
<p>The <code class="codeph">PowerCartUserStats</code> table contains the following columns:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The table and column for which statistics are collected</p>
</li>
<li>
<p>The cell for which the statistics are collected</p>
</li>
<li>
<p>The minimum and maximum power demand for the given cell over all power grid readings</p>
</li>
<li>
<p>The number of non-<code class="codeph">null</code> readings for the given cell over all power grid reading</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="example" id="GUID-12482A82-9C85-450A-AF32-2B7654EA2328__CIAGEBIC">
<p class="titleinexample">Example 14-20 Creating Statistics Table PowerCartUserStats for Power Demand Cartridge</p>
<pre dir="ltr">CREATE TABLE PowerCartUserStats (
  -- Table for which statistics are collected
  tab VARCHAR2(30),
  -- Column for which statistics are collected
  col VARCHAR2(30),
  -- Cell position
  cpos NUMBER,
  -- Minimum power demand for the given cell
  lo NUMBER,
  -- Maximum power demand for the given cell
  hi NUMBER,
  -- Number of (non-null) power demands for the given cell
  nrows NUMBER
);
/
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4840"></a><a id="ADDCI4839"></a>
<div class="props_rev_3"><a id="GUID-0BB62838-3F71-42FD-8E13-B05B4C5D3F0B"></a>
<h3 id="ADDCI-GUID-0BB62838-3F71-42FD-8E13-B05B4C5D3F0B" class="sect3">Creating the Extensible Optimizer Methods</h3>
<div>
<p>The power demand cartridge creates an object type that specifies methods used by the extensible optimizer. These methods are part of the <code class="codeph">ODCIStats</code> interface and they collectively define the methods that are called by the methods of <code class="codeph">DBMS_STATS</code> package, or when the optimizer is deciding on the best execution plan for a query.</p>
<p><a href="pwr_example.htm#GUID-0BB62838-3F71-42FD-8E13-B05B4C5D3F0B__G1012516" title="Lists methods to be used by the extensible optimizer that were created for the Power Demand cartridge example and describes each">Table 14-5</a> shows the method functions created for the power demand cartridge. Names of all but one of the functions begin with the string <code class="codeph">ODCIStats</code>.</p>
<div class="tblformal" id="GUID-0BB62838-3F71-42FD-8E13-B05B4C5D3F0B__G1012516">
<p class="titleintable">Table 14-5 Extensible Optimizer Methods</p>
<table class="cellalignment5987" title="Extensible Optimizer Methods" summary="Lists methods to be used by the extensible optimizer that were created for the Power Demand cartridge example and describes each">
<thead>
<tr class="cellalignment5978">
<th class="cellalignment6000" id="d42543e4097">Method</th>
<th class="cellalignment6001" id="d42543e4100">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e4105" headers="d42543e4097">
<p><a href="ext_opt_ref.htm#GUID-866750E9-7193-458B-B29C-6A494094DF6C">ODCIGetInterfaces()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e4105 d42543e4100">
<p>Returns the list of names of the interfaces implemented by the type.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e4114" headers="d42543e4097">
<p><a href="ext_opt_ref.htm#GUID-227ABB3C-6218-4AA9-BC1C-D963EE800D87">ODCIStatsCollect()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e4114 d42543e4100">
<p>Collects statistics for columns of type PowerDemand_Typ or domain indexes of indextype power_idxtype.</p>
<p>This method is called when a statement that refers either to a column of the <code class="codeph">PowerDemand_Typ</code> type or to an index of the <code class="codeph">power_idxtype</code> indextype is issued. Upon invocation, any specified options are passed in along with a description of the column or index.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e4131" headers="d42543e4097">
<p><a href="ext_opt_ref.htm#GUID-294738F4-65B1-4272-BBD6-686F2E38B9C2">ODCIStatsDelete()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e4131 d42543e4100">
<p>Deletes statistics for columns of type <code class="codeph">PowerDemand_Typ</code> or domain indexes of indextype <code class="codeph">power_idxtype</code>.</p>
<p>This method is called when a statement to delete statistics for a column of the appropriate type or an index of the appropriate indextype is issued.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e4148" headers="d42543e4097">
<p><a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e4148 d42543e4100">
<p>Computes the selectivity of a predicate involving an operator or its functional implementation.</p>
<p>Called by the optimizer when a predicate of the appropriate type appears in the <code class="codeph">WHERE</code> clause of a query.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e4162" headers="d42543e4097">
<p><a href="ext_opt_ref.htm#GUID-158EC3A8-CB48-48B2-9405-198BA0FDD777">ODCIStatsIndexCost()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e4162 d42543e4100">
<p>Computes the cost of a domain index access path.</p>
<p>Called by the optimizer to get the cost of a domain index access path, assuming the index can be used for the query.</p>
</td>
</tr>
<tr class="cellalignment5978">
<td class="cellalignment6002" id="d42543e4173" headers="d42543e4097">
<p><a href="ext_opt_ref.htm#GUID-B13AA56D-ABAF-431A-BAED-006B8331DCE1">ODCIStatsFunctionCost()</a></p>
</td>
<td class="cellalignment6003" headers="d42543e4173 d42543e4100">
<p>Computes the cost of a function.</p>
<p>Called by the optimizer to get the cost of executing a function. The function need not necessarily be an implementation of an operator.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<a id="ADDCI4842"></a><a id="ADDCI4841"></a>
<div class="props_rev_3"><a id="GUID-130B2EF6-299F-4181-AB04-3E15B5024869"></a>
<h4 id="ADDCI-GUID-130B2EF6-299F-4181-AB04-3E15B5024869" class="sect4">Creating the Type Definition</h4>
<div>
<div class="section">
<p><a href="pwr_example.htm#GUID-130B2EF6-299F-4181-AB04-3E15B5024869__CIAHBGBI">Example 14-21</a> creates the <code class="codeph">power_statistics</code> object type. This object type&#39;s ODCI methods are used to collect and delete statistics about columns and indexes, compute selectivities of predicates with operators or functions, and to compute costs of domain indexes and functions. The <code class="codeph">curnum</code> attribute is not used.</p>
<p>The <code class="codeph">CREATE TYPE</code> statement is followed by a <code class="codeph">CREATE TYPE BODY</code> statement that specifies the implementation for each member function:</p>
<pre dir="ltr">CREATE OR REPLACE TYPE BODY power_statistics
IS
...
</pre>
<p>All the function definitions have the following general form:</p>
<pre dir="ltr">    STATIC FUNCTION function-name (...)
      BEGIN
        RETURN NUMBER IS
      END;
</pre></div>
<!-- class="section" -->
<div class="example" id="GUID-130B2EF6-299F-4181-AB04-3E15B5024869__CIAHBGBI">
<p class="titleinexample">Example 14-21 Creating power_statistics Object Type Definition for Power Demand Cartridge</p>
<pre dir="ltr">CREATE OR REPLACE TYPE power_statistics AS OBJECT
(
  curnum NUMBER,
  STATIC FUNCTION ODCIGetInterfaces(ifclist OUT sys.ODCIObjectList) 
    RETURN NUMBER,
  STATIC FUNCTION ODCIStatsCollect(col sys.ODCIColInfo, 
      options sys.ODCIStatsOptions, rawstats OUT RAW, env sys.ODCIEnv) 
    RETURN NUMBER,
  STATIC FUNCTION ODCIStatsDelete(col sys.ODCIColInfo, env sys.ODCIEnv) 
      RETURN NUMBER,
  STATIC FUNCTION ODCIStatsCollect(ia sys.ODCIIndexInfo,
      options sys.ODCIStatsOptions, rawstats OUT RAW, env sys.ODCIEnv) 
    RETURN NUMBER,
  STATIC FUNCTION ODCIStatsDelete(ia sys.ODCIIndexInfo, env sys.ODCIEnv) 
      RETURN NUMBER,
  STATIC FUNCTION ODCIStatsSelectivity(pred sys.ODCIPredInfo,
      sel OUT NUMBER, args sys.ODCIArgDescList, strt NUMBER, stop NUMBER,
      object PowerDemand_Typ, cell NUMBER, value NUMBER, env sys.ODCIEnv) 
    RETURN NUMBER,
  PRAGMA restrict_references(ODCIStatsSelectivity, WNDS, WNPS),
  STATIC FUNCTION ODCIStatsSelectivity(pred sys.ODCIPredInfo, sel OUT NUMBER, 
      args sys.ODCIArgDescList, strt NUMBER, stop NUMBER, object PowerDemand_Typ,
      value NUMBER, env sys.ODCIEnv) 
    RETURN NUMBER,
  PRAGMA restrict_references(ODCIStatsSelectivity, WNDS, WNPS),
  STATIC FUNCTION ODCIStatsIndexCost(ia sys.ODCIIndexInfo, sel NUMBER, 
      cost OUT sys.ODCICost, qi sys.ODCIQueryInfo, pred sys.ODCIPredInfo, 
      args sys.ODCIArgDescList, strt NUMBER, stop NUMBER, cmppos NUMBER, 
      cmpval NUMBER, env sys.ODCIEnv)
    RETURN NUMBER,
  PRAGMA restrict_references(ODCIStatsIndexCost, WNDS, WNPS),
  STATIC FUNCTION ODCIStatsIndexCost(ia sys.ODCIIndexInfo, sel NUMBER, 
      cost OUT sys.ODCICost, qi sys.ODCIQueryInfo, pred sys.ODCIPredInfo, 
      args sys.ODCIArgDescList, strt NUMBER, stop NUMBER, cmpval NUMBER, 
      env sys.ODCIEnv) 
    RETURN NUMBER,
  PRAGMA restrict_references(ODCIStatsIndexCost, WNDS, WNPS),
  STATIC FUNCTION ODCIStatsFunctionCost(func sys.ODCIFuncInfo, 
      cost OUT sys.ODCICost, args sys.ODCIArgDescList, object PowerDemand_Typ,
      cell NUMBER, value NUMBER, env sys.ODCIEnv) 
    RETURN NUMBER,
  PRAGMA restrict_references(ODCIStatsFunctionCost, WNDS, WNPS),
  STATIC FUNCTION ODCIStatsFunctionCost(func sys.ODCIFuncInfo,
      cost OUT sys.ODCICost, args sys.ODCIArgDescList, object PowerDemand_Typ,
      value NUMBER, env sys.ODCIEnv) 
    RETURN NUMBER,
  PRAGMA restrict_references(ODCIStatsFunctionCost, WNDS, WNPS)
  STATIC FUNCTION ODCIStatsFunctionCost(func sys.ODCIFuncInfo,
      cost OUT sys.ODCICost, args sys.ODCIArgDescList, object PowerDemand_Typ,
      cell NUMBER, value NUMBER, env sys.ODCIEnv)
    RETURN NUMBER
);
/
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4844"></a><a id="ADDCI4843"></a>
<div class="props_rev_3"><a id="GUID-64490C8E-E5D7-40BE-8A7C-025AD5E3174C"></a>
<h4 id="ADDCI-GUID-64490C8E-E5D7-40BE-8A7C-025AD5E3174C" class="sect4">ODCIGetInterfaces()</h4>
<div>
<div class="section">
<p>The <a href="ext_opt_ref.htm#GUID-866750E9-7193-458B-B29C-6A494094DF6C">ODCIGetInterfaces()</a> function, demonstrated in <a href="pwr_example.htm#GUID-64490C8E-E5D7-40BE-8A7C-025AD5E3174C__CIAJCGEJ">Example 14-22</a>, returns the list of names of the interfaces implemented by the type. There is only one set of the extensible optimizer interface routines, called <code class="codeph">SYS.ODCISTATS</code>, but the server supports multiple versions of them for backward compatibility. To specify the current version of the routines, function <a href="ext_opt_ref.htm#GUID-866750E9-7193-458B-B29C-6A494094DF6C">ODCIGetInterfaces()</a> must specify <code class="codeph">SYS.ODCISTATS2</code> in the <code class="codeph">OUT</code>, <code class="codeph">ODCIObjectList</code> parameter.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-64490C8E-E5D7-40BE-8A7C-025AD5E3174C__CIAJCGEJ">
<p class="titleinexample">Example 14-22 Registering interfaces and Statistics Functions for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIGetInterfaces(
  ifclist OUT sys.ODCIObjectList)
RETURN NUMBER IS
BEGIN
  ifclist := sys.ODCIObjectList(sys.ODCIObject(&#39;SYS&#39;,&#39;ODCISTATS2&#39;));
  RETURN ODCIConst.Success;
END ODCIGetInterfaces;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4846"></a><a id="ADDCI4845"></a>
<div class="props_rev_3"><a id="GUID-AAB58858-E573-489B-ABFD-C59599E52A3B"></a>
<h4 id="ADDCI-GUID-AAB58858-E573-489B-ABFD-C59599E52A3B" class="sect4">ODCIStatsCollect() Method for <span class="bold">PowerDemand_Typ</span> Columns</h4>
<div>
<div class="section">
<p>The <a href="ext_opt_ref.htm#GUID-227ABB3C-6218-4AA9-BC1C-D963EE800D87">ODCIStatsCollect()</a> function, demonstrated in <a href="pwr_example.htm#GUID-AAB58858-E573-489B-ABFD-C59599E52A3B__CIAFECHD">Example 14-23</a>, collects statistics for columns whose data type is the <code class="codeph">PowerDemand_Typ</code> object type. The statistics are collected for each cell in the column over all power grid readings. For a given cell, the statistics collected are the minimum and maximum power grid readings, and the number of non-null readings.</p>
<p>The function takes the column information as an object parameter whose type is <code class="codeph">SYS.ODCICOLINFO</code>. The type attributes include the table name, column name, and so on. Options specified in the <code class="codeph">DBMS_STATS</code> package command used to collect the column statistics are also passed in as parameters. Since the power demand cartridge uses a table to store the statistics, the output parameter <code class="codeph">rawstats</code> is not used in this cartridge.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-AAB58858-E573-489B-ABFD-C59599E52A3B__CIAFECHD">
<p class="titleinexample">Example 14-23 Registering ODCIStatsCollect() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIStatsCollect(
  col sys.ODCIColInfo,
  options sys.ODCIStatsOptions,
  rawstats OUT RAW, 
  env sys.ODCIEnv)
RETURN NUMBER IS
  cnum                INTEGER;
  stmt                VARCHAR2(1000);
  junk                INTEGER;
  cval                NUMBER;
  colname             VARCHAR2(30) := rtrim(ltrim(col.colName, &#39;&#34;&#39;), &#39;&#34;&#39;);
  statsexists         BOOLEAN := FALSE;
  pdemands            PowerDemand_Tab%ROWTYPE;
  user_defined_stats  PowerCartUserStats%ROWTYPE;

  CURSOR c1(tname VARCHAR2, cname VARCHAR2) IS
    SELECT * FROM PowerCartUserStats
    WHERE tab = tname AND col = cname;
  CURSOR c2 IS
    SELECT * FROM PowerDemand_Tab;

  BEGIN
    sys.ODCIColInfoDump(col);
    sys.ODCIStatsOptionsDump(options);

    IF (col.TableSchema IS NULL OR col.TableName IS NULL OR col.ColName IS NULL)
    THEN
      RETURN ODCIConst.Error;
    END IF;

    dbms_output.put_line(&#39;ODCIStatsCollect&gt;&gt;&gt;&gt;&gt;&#39;);
    dbms_output.put_line(&#39;**** Analyzing column &#39;||col.TableSchema|| &#39;.&#39; ||
        col.TableName|| &#39;.&#39; || col.ColName);

    -- Check if statistics exist for this column
    FOR user_defined_stats IN c1(col.TableName, colname) LOOP
      statsexists := TRUE;
      EXIT;
    END LOOP;
</pre>
<p>The function checks whether statistics for this column exist. If so, it initializes them to <code class="codeph">NULL</code>; otherwise, it creates statistics for each of the 100 cells and initializes them to <code class="codeph">NULL</code>.</p>
<pre dir="ltr">    IF not statsexists THEN
      -- column statistics don&#39;t exist; create entries for each of the 100 cells
      cnum := dbms_sql.open_cursor;
      FOR i in 1..100 LOOP
        stmt := &#39;INSERT INTO PowerCartUserStats VALUES( &#39;||&#39;&#39;&#39;&#39;|| col.TableName ||
            &#39;&#39;&#39;, &#39;||&#39;&#39;&#39;&#39;||colname||&#39;&#39;&#39;, &#39;||to_char(i)||&#39;, &#39;||&#39;NULL, NULL, NULL)&#39;;
        dbms_sql.parse(cnum, stmt, dbms_sql.native);
        junk := dbms_sql.execute(cnum);
      END LOOP;
      dbms_sql.close_cursor(cnum);
    ELSE
      -- column statistics exist; initialize to NULL
      cnum := dbms_sql.open_cursor;
      stmt := &#39;UPDATE PowerCartUserStats&#39;||
          &#39; SET lo = NULL, hi = NULL, nrows = NULL&#39;||&#39; WHERE tab = &#39;||
          col.TableName||&#39; AND col = &#39;||colname;
      dbms_sql.parse(cnum, stmt, dbms_sql.native);
      junk := dbms_sql.execute(cnum);
      dbms_sql.close_cursor(cnum);
    END IF;
</pre>
<p>The function collects statistics for the column by reading rows from the table that is being analyzed. This is done by constructing and executing a SQL statement.</p>
<pre dir="ltr">    -- For each cell position, the following statistics are collected:
    --   maximum value
    --   minimum value
    --   number of rows (excluding NULLs)
    cnum := dbms_sql.open_cursor;
    FOR i in 1..100 LOOP
      FOR pdemands IN c2 LOOP
        IF i BETWEEN pdemands.sample.CellDemandValues.FIRST AND
            pdemands.sample.CellDemandValues.LAST THEN
          cval := pdemands.sample.CellDemandValues(i);
          stmt := &#39;UPDATE PowerCartUserStats SET &#39;|| &#39;lo = least(&#39; || &#39;NVL(&#39; ||
              to_char(cval)||&#39;, lo), &#39;||&#39;NVL(&#39;||&#39;lo, &#39;||to_char(cval)||&#39;)), &#39;||
              &#39;hi = greatest(&#39;||&#39;NVL(&#39;||to_char(cval)||&#39;, hi), &#39;||&#39;NVL(&#39;||
              &#39;hi, &#39;||to_char(cval)||&#39;)), &#39;||
              &#39;nrows = decode(nrows, NULL, decode(&#39;||to_char(cval)||
              &#39;, NULL, NULL, 1), decode(&#39;||to_char(cval)|| 
              &#39;, NULL, nrows, nrows+1)) &#39;||&#39;WHERE cpos = &#39;||to_char(i)||
              &#39; AND tab = &#39;&#39;&#39;||col.TableName||&#39;&#39;&#39;&#39;||&#39; AND col = &#39;&#39;&#39;||colname||
              &#39;&#39;&#39;&#39;;
          dbms_sql.parse(cnum, stmt, dbms_sql.native);
          junk := dbms_sql.execute(cnum);
        END IF;
      END LOOP;
    END LOOP;
</pre>
<p>The function concludes by closing the cursor and returning a success status.</p>
<pre dir="ltr">    dbms_sql.close_cursor(cnum);
    rawstats := NULL;
    return ODCIConst.Success;

  END ODCIStatsCollect;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4848"></a><a id="ADDCI4847"></a>
<div class="props_rev_3"><a id="GUID-44A46D99-F33C-4C1C-AB3F-DC0C7BF26D67"></a>
<h4 id="ADDCI-GUID-44A46D99-F33C-4C1C-AB3F-DC0C7BF26D67" class="sect4">ODCIStatsDelete() Method for <span class="bold">PowerDemand_Typ</span> Columns</h4>
<div>
<div class="section">
<p>The <a href="ext_opt_ref.htm#GUID-294738F4-65B1-4272-BBD6-686F2E38B9C2">ODCIStatsDelete()</a> function, demonstrated in <a href="pwr_example.htm#GUID-44A46D99-F33C-4C1C-AB3F-DC0C7BF26D67__CIACJEIF">Example 14-24</a>, deletes statistics of columns whose data type is the <code class="codeph">PowerDemand_Typ</code> object type. The function takes the column information as an object parameter whose type is <code class="codeph">SYS.ODCICOLINFO</code>. The type attributes include the table name, column name, and so on.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-44A46D99-F33C-4C1C-AB3F-DC0C7BF26D67__CIACJEIF">
<p class="titleinexample">Example 14-24 Registering ODCIStatsDelete() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIStatsDelete(
  col sys.ODCIColInfo, 
  env sys.ODCIEnv)
RETURN NUMBER IS
  cnum                INTEGER;
  stmt                VARCHAR2(1000);
  junk                INTEGER;
  colname             VARCHAR2(30) := rtrim(ltrim(col.colName, &#39;&#34;&#39;), &#39;&#34;&#39;);
  statsexists         BOOLEAN := FALSE;
  user_defined_stats  PowerCartUserStats%ROWTYPE;

  CURSOR c1(tname VARCHAR2, cname VARCHAR2) IS
    SELECT * FROM PowerCartUserStats
    WHERE tab = tname AND col = cname;
  BEGIN
  sys.ODCIColInfoDump(col);

  IF (col.TableSchema IS NULL OR col.TableName IS NULL OR col.ColName IS NULL)
  THEN
    RETURN ODCIConst.Error;
  END IF;

  dbms_output.put_line(&#39;ODCIStatsDelete&gt;&gt;&gt;&gt;&gt;&#39;);
  dbms_output.put_line(&#39;**** Analyzing (delete) column &#39;|| col.TableSchema|| 
      &#39;.&#39; ||col.TableName||&#39;.&#39;||col.ColName);
</pre></div>
<!-- class="example" -->
<div class="section">
<p>The function verifies that statistics for the column exist by checking the statistics table. If statistics were not collected, then there is nothing to be done. If, however, statistics are present, it constructs and executes a SQL statement to delete the relevant rows from the statistics table.</p>
<pre dir="ltr">  -- Check if statistics exist for this column
  FOR user_defined_stats IN c1(col.TableName, colname) LOOP
    statsexists := TRUE;
    EXIT;
  END LOOP;

  -- If user-defined statistics exist, delete them
  IF statsexists THEN
    stmt := &#39;DELETE FROM PowerCartUserStats&#39;||&#39; WHERE tab = &#39;&#39;&#39;||col.TableName||
        &#39;&#39;&#39;&#39;|| &#39; AND col = &#39;&#39;&#39; || colname || &#39;&#39;&#39;&#39;;
    cnum := dbms_sql.open_cursor;
    dbms_output.put_line(&#39;ODCIStatsDelete&gt;&gt;&gt;&gt;&gt;&#39;);
    dbms_output.put_line(&#39;ODCIStatsDelete&gt;&gt;&gt;&gt;&gt;&#39; || stmt);
    dbms_sql.parse(cnum, stmt, dbms_sql.native);
    junk := dbms_sql.execute(cnum);
    dbms_sql.close_cursor(cnum);
  END IF;

  RETURN ODCIConst.Success;
END ODCStatsDelete;
</pre></div>
<!-- class="section" --></div>
</div>
<a id="ADDCI4850"></a><a id="ADDCI4849"></a>
<div class="props_rev_3"><a id="GUID-12CD2083-AF25-4F41-91CB-050DEC92259C"></a>
<h4 id="ADDCI-GUID-12CD2083-AF25-4F41-91CB-050DEC92259C" class="sect4">ODCIStatsCollect() Method for <span class="bold">power_idxtype</span> Domain Indexes</h4>
<div>
<div class="section">
<p>The <a href="ext_opt_ref.htm#GUID-227ABB3C-6218-4AA9-BC1C-D963EE800D87">ODCIStatsCollect()</a> function, demonstrated in <a href="pwr_example.htm#GUID-12CD2083-AF25-4F41-91CB-050DEC92259C__CIAECBHC">Example 14-25</a>, collects statistics for domain indexes whose indextype is <code class="codeph">power_idxtype</code>. In the power demand cartridge, this function simply analyzes the index-organized table that stores the index data.</p>
<p>The function takes the index information as an object parameter whose type is <code class="codeph">SYS.ODCIINDEXINFO</code>. The type attributes include the index name, owner name, and so on. Options specified by the <code class="codeph">DBMS_STATS</code> package are used to collect the index statistics are also passed in as parameters. The output parameter <code class="codeph">rawstats</code> is not used.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-12CD2083-AF25-4F41-91CB-050DEC92259C__CIAECBHC">
<p class="titleinexample">Example 14-25 Registering ODCIStatsCollect() for Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIStatsCollect (
  ia sys.ODCIIndexInfo,
  options sys.ODCIStatsOptions, 
  rawstats OUT RAW, 
  env sys.ODCIEnv)
RETURN NUMBER IS
  stmt                VARCHAR2(1000);
 
BEGIN
  -- To analyze a domain index, analyze the table that implements the index
  sys.ODCIIndexInfoDump(ia);
  sys.ODCIStatsOptionsDump(options);

  stmt := &#39;dbms_stats.gather_table_stats(&#39;
         || &#39;&#39;&#39;&#39; || ia.IndexSchema || &#39;&#39;&#39;, &#39;
         || &#39;&#39;&#39;&#39; || ia.IndexName || &#39;_pidx&#39; || &#39;&#39;&#39;);&#39;;
  dbms_output.put_line(&#39;**** Analyzing index &#39;
         || ia.IndexSchema || &#39;.&#39; || ia.IndexName);
  dbms_output.put_line(&#39;SQL Statement: &#39; || stmt); 
  EXECUTE IMMEDIATE &#39;BEGIN &#39; || stmt || &#39; END;&#39;;
  rawstats := NULL;

  RETURN ODCIConst.Success;
END ODCIStatsCollect;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4852"></a><a id="ADDCI4851"></a>
<div class="props_rev_3"><a id="GUID-9613F347-9D87-49C0-84ED-DD0749F4954E"></a>
<h4 id="ADDCI-GUID-9613F347-9D87-49C0-84ED-DD0749F4954E" class="sect4">ODCIStatsDelete() Method for <span class="bold">power_idxtype</span> Domain Indexes</h4>
<div>
<div class="section">
<p>The <a href="ext_opt_ref.htm#GUID-294738F4-65B1-4272-BBD6-686F2E38B9C2">ODCIStatsDelete()</a> function, demonstrated in <a href="pwr_example.htm#GUID-9613F347-9D87-49C0-84ED-DD0749F4954E__CIAJIAAI">Example 14-26</a>, deletes statistics for domain indexes whose indextype is <code class="codeph">power_idxtype</code>. In the power demand cartridge, this function simply deletes the statistics of the index-organized table that stores the index data.</p>
<p>The function takes the index information as an object parameter whose type is <code class="codeph">SYS.ODCIINDEXINFO</code>. The type attributes include the index name, owner name, and so on.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-9613F347-9D87-49C0-84ED-DD0749F4954E__CIAJIAAI">
<p class="titleinexample">Example 14-26 Registering ODCIStatsDelete() for Domain Indexes in Power Demand Cartridge</p>
<pre dir="ltr">STATIC FUNCTION ODCIStatsDelete(
  ia sys.ODCIIndexInfo,
  env sys.ODCIEnv)
RETURN NUMBER IS
  stmt                VARCHAR2(1000);
BEGIN
  -- To delete statistics for a domain index, delete the statistics for the
  -- table implementing the index
  sys.ODCIIndexInfoDump(ia);
  stmt := &#39;dbms_stats.delete_table_stats(&#39;|| &#39;&#39;&#39;&#39; || ia.IndexSchema || &#39;&#39;&#39;, &#39;
      || &#39;&#39;&#39;&#39; || ia.IndexName || &#39;_pidx&#39; || &#39;&#39;&#39;);&#39;;
  dbms_output.put_line(&#39;**** Analyzing (delete) index &#39;||ia.IndexSchema||&#39;.&#39;||
      ia.IndexName);
  dbms_output.put_line(&#39;SQL Statement: &#39; || stmt);

  EXECUTE IMMEDIATE &#39;BEGIN &#39; || stmt || &#39; END;&#39;;
  RETURN ODCIConst.Success;
END ODCIStatsDelete;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4854"></a><a id="ADDCI4855"></a><a id="ADDCI4853"></a>
<div class="props_rev_3"><a id="GUID-3659AEBF-759E-46E9-AE72-7F0970FFF242"></a>
<h4 id="ADDCI-GUID-3659AEBF-759E-46E9-AE72-7F0970FFF242" class="sect4">ODCIStatsSelectivity() Method for <span class="bold">Specific</span> Queries</h4>
<div>
<div class="section">
<p>The first definition of the <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> function estimates the selectivity of operator or function predicates for <code class="codeph">Specific</code> queries. For example, if a query asks for all instances where cell <code class="codeph">(3,7)</code> has a value equal to <code class="codeph">25</code>, the function estimates the percentage of rows in which the given cell has the specified value.</p>
<p>The <code class="codeph">pred</code> parameter contains the function information (the functional implementation of an operator in an operator predicate); this parameter is an object instance of type <code class="codeph">SYS.ODCIPREDINFO</code>. The selectivity is returned as a percentage in the <code class="codeph">sel</code> output parameter. The <code class="codeph">args</code> parameter (an object instance of type <code class="codeph">SYS.ODCIARGDESCLIST</code>) contains a descriptor for each argument of the function, and the start and stop values of the function. For example, if an argument is a column, the argument descriptor contains the table name, column name, and so on. The <code class="codeph">strt</code> and <code class="codeph">stop</code> parameters are the lower and upper boundary points for the function return value. If the function in a predicate contains a literal of type <code class="codeph">PowerDemand_Typ</code>, the <code class="codeph">object</code> parameter contains the value in the form of an object constructor. The <code class="codeph">cell</code> parameter is the cell position and the <code class="codeph">value</code> parameter is the value in the cell specified by the function (<code class="codeph">PowerXxxxxSpecific_Func</code>).</p>
<p>The selectivity is estimated by using a technique similar to that used for simple range predicates. For example, a simple estimate for the selectivity of a predicate like</p>
<pre dir="ltr">  c &gt; v
</pre>
<p>is <code class="codeph">(M-v)/(M-m)</code> where <code class="codeph">m</code> and <code class="codeph">M</code> are the minimum and maximum values, respectively, for the column <code class="codeph">c</code> (as determined from the column statistics), provided the value <code class="codeph">v</code> lies between <code class="codeph">m</code> and <code class="codeph">M</code>.</p>
<p>The <code class="codeph">get_selectivity</code> function, demonstrated in <a href="pwr_example.htm#GUID-3659AEBF-759E-46E9-AE72-7F0970FFF242__CIAJJJFC">Example 14-27</a>, computes the selectivity of a simple range predicate given the minimum and maximum values of the column in the predicate. It assumes that the column values in the table are uniformly distributed between the minimum and maximum values.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-3659AEBF-759E-46E9-AE72-7F0970FFF242__CIAJJJFC">
<p class="titleinexample">Example 14-27 Implementing Selectivity Function for Power Demand Cartridge</p>
<pre dir="ltr">CREATE FUNCTION get_selectivity(relop VARCHAR2, value NUMBER,
                                lo NUMBER, hi NUMBER, ndv NUMBER)
  RETURN NUMBER AS
  sel NUMBER := NULL;
  ndv NUMBER;
BEGIN
  -- This function computes the selectivity (as a percentage)
  -- of a predicate
  --             col &lt;relop&gt; &lt;value&gt;
  -- where &lt;relop&gt; is one of: =, !=, &lt;, &lt;=, &gt;, &gt;=
  --       &lt;value&gt; is one of: 0, 1
  -- lo and hi are the minimum and maximum values of the column in
  -- the table. This function performs a simplistic estimation of the
  -- selectivity by assuming that the range of distinct values of
  -- the column is distributed uniformly in the range lo..hi and that
  -- each distinct value occurs nrows/(hi-lo+1) times (where nrows is
  -- the number of rows).

  IF ndv IS NULL OR ndv &lt;= 0 THEN
    RETURN 0;
  END IF;

  -- col != &lt;value&gt;
  IF relop = &#39;!=&#39; THEN
    IF value between lo and hi THEN
      sel := 1 - 1/ndv;
    ELSE
      sel := 1;
    END IF;

  -- col = &lt;value&gt;
  ELSIF relop = &#39;=&#39; THEN
    IF value between lo and hi THEN
      sel := 1/ndv;
    ELSE
      sel := 0;
    END IF;

  -- col &gt;= &lt;value&gt;
  ELSIF relop = &#39;&gt;=&#39; THEN
    IF lo = hi THEN
      IF value &lt;= lo THEN
        sel := 1;
      ELSE
        sel := 0;
      END IF;
    ELSIF value between lo and hi THEN
      sel := (hi-value)/(hi-lo) + 1/ndv;
    ELSIF value &lt; lo THEN
      sel := 1;
    ELSE
      sel := 0;
    END IF;

  -- col &lt; &lt;value&gt;
  ELSIF relop = &#39;&lt;&#39; THEN
    IF lo = hi THEN
      IF value &gt; lo THEN
        sel := 1;
      ELSE
        sel := 0;
      END IF;
    ELSIF value between lo and hi THEN
      sel := (value-lo)/(hi-lo);
    ELSIF value &lt; lo THEN
      sel := 0;
    ELSE
      sel := 1;
    END IF;

  -- col &lt;= &lt;value&gt;
  ELSIF relop = &#39;&lt;=&#39; THEN
    IF lo = hi THEN
      IF value &gt;= lo THEN
        sel := 1;
      ELSE
        sel := 0;
      END IF;
    ELSIF value between lo and hi THEN
      sel := (value-lo)/(hi-lo) + 1/ndv;
    ELSIF value &lt; lo THEN
      sel := 0;
    ELSE
      sel := 1;
    END IF;

  -- col &gt; &lt;value&gt;
  ELSIF relop = &#39;&gt;&#39; THEN
    IF lo = hi THEN
      IF value &lt; lo THEN
        sel := 1;
      ELSE
        sel := 0;
      END IF;
    ELSIF value between lo and hi THEN
      sel := (hi-value)/(hi-lo);
    ELSIF value &lt; lo THEN
      sel := 1;
    ELSE
      sel := 0;
    END IF;

  END IF;

  RETURN least(100, ceil(100*sel));

END;
/
</pre></div>
<!-- class="example" -->
<div class="section">
<p>The <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> function, demonstrated in <a href="pwr_example.htm#GUID-3659AEBF-759E-46E9-AE72-7F0970FFF242__CIAJECAH">Example 14-28</a>, estimates the selectivity for function predicates which have constant start and stop values. Further, the first argument of the function in the predicate must be a column of type <code class="codeph">PowerDemand_Typ</code> and the remaining arguments must be constants.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-3659AEBF-759E-46E9-AE72-7F0970FFF242__CIAJECAH">
<p class="titleinexample">Example 14-28 Registering ODCIStatsSelectivity() for Queries for Power Demand Cartridge</p>
<pre dir="ltr">  STATIC FUNCTION ODCIStatsSelectivity(pred sys.ODCIPredInfo,
     sel OUT NUMBER, args sys.ODCIArgDescList, strt NUMBER, stop NUMBER,
     object PowerDemand_Typ, cell NUMBER, value NUMBER, env sys.ODCIEnv)
     RETURN NUMBER IS
     fname               varchar2(30);
     relop               varchar2(2);
     lo                  NUMBER;
     hi                  NUMBER;
     nrows               NUMBER;
     colname             VARCHAR2(30);
     statsexists         BOOLEAN := FALSE;
     stats               PowerCartUserStats%ROWTYPE;
     CURSOR c1(cell NUMBER, tname VARCHAR2, cname VARCHAR2) IS
       SELECT * FROM PowerCartUserStats
       WHERE cpos = cell
         AND tab = tname
         AND col = cname;
  BEGIN
    -- compute selectivity only when predicate is of the form:
    --      fn(col, &lt;cell&gt;, &lt;value&gt;) &lt;relop&gt; &lt;val&gt;
    -- In all other cases, return an error and let the optimizer
    -- make a guess. We also assume that the function &#34;fn&#34; has
    -- a return value of 0, 1, or NULL.

    -- start value
    IF (args(1).ArgType != ODCIConst.ArgLit AND
        args(1).ArgType != ODCIConst.ArgNull) THEN
      RETURN ODCIConst.Error;
    END IF;

    -- stop value
    IF (args(2).ArgType != ODCIConst.ArgLit AND
        args(2).ArgType != ODCIConst.ArgNull) THEN
      RETURN ODCIConst.Error;
    END IF;

    -- first argument of function
    IF (args(3).ArgType != ODCIConst.ArgCol) THEN
      RETURN ODCIConst.Error;
    END IF;

    -- second argument of function
    IF (args(4).ArgType != ODCIConst.ArgLit AND
        args(4).ArgType != ODCIConst.ArgNull) THEN
      RETURN ODCIConst.Error;
    END IF;

    -- third argument of function
    IF (args(5).ArgType != ODCIConst.ArgLit AND
        args(5).ArgType != ODCIConst.ArgNull) THEN
      RETURN ODCIConst.Error;
    END IF;

    colname := rtrim(ltrim(args(3).colName, &#39;&#34;&#39;), &#39;&#34;&#39;);
</pre>
<p>The first (column) argument of the function in the predicate must have statistics collected for it. If statistics have not been collected, <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> returns an error status.</p>
<pre dir="ltr">    -- Check if the statistics table exists (we are using a
    -- user-defined table to store the user-defined statistics).
    -- Get user-defined statistics: MIN, MAX, NROWS
    FOR stats IN c1(cell, args(3).TableName, colname) LOOP
      -- Get user-defined statistics: MIN, MAX, NROWS
      lo := stats.lo;
      hi := stats.hi;
      nrows := stats.nrows;
      statsexists := TRUE;
      EXIT;
    END LOOP;

    -- If no user-defined statistics were collected, return error
    IF not statsexists THEN
      RETURN ODCIConst.Error;
    END IF;
</pre>
<p>Each <code class="codeph">Specific</code> function predicate corresponds to an equivalent range predicate. For example, the predicate <code class="codeph">Power_EqualsSpecific_Func(col, 21, 25) = 0</code>, which checks that the reading in cell <code class="codeph">21</code> is not equal to <code class="codeph">25</code>, corresponds to the equivalent range predicate <code class="codeph">col[21] != 25</code>.</p>
<p>The <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> function finds the corresponding range predicates for each <code class="codeph">Specific</code> function predicate. There are several boundary cases where the selectivity can be immediately determined.</p>
<pre dir="ltr">    -- selectivity is 0 for &#34;fn(col, &lt;cell&gt;, &lt;value&gt;) &lt; 0&#34;
    IF (stop = 0 AND
        bitand(pred.Flags, ODCIConst.PredIncludeStop) = 0) THEN
      sel := 0;
      RETURN ODCIConst.Success;
    END IF;

    -- selectivity is 0 for &#34;fn(col, &lt;cell&gt;, &lt;value&gt;) &gt; 1&#34;
    IF (strt = 1 AND
        bitand(pred.Flags, ODCIConst.PredIncludeStart) = 0) THEN
      sel := 0;
      RETURN ODCIConst.Success;
    END IF;

    -- selectivity is 100% for &#34;fn(col, &lt;cell&gt;, &lt;value&gt;) &gt;= 0&#34;
    IF (strt = 0 AND
        bitand(pred.Flags, ODCIConst.PredExactMatch) = 0 AND
        bitand(pred.Flags, ODCIConst.PredIncludeStart) &gt; 0) THEN
      sel := 100;
      RETURN ODCIConst.Success;
    END IF;

    -- selectivity is 100% for &#34;fn(col, &lt;cell&gt;, &lt;value&gt;) &lt;= 1&#34;
    IF (stop = 1 AND
        bitand(pred.Flags, ODCIConst.PredExactMatch) = 0 AND
        bitand(pred.Flags, ODCIConst.PredIncludeStop) &gt; 0) THEN
      sel := 100;
      RETURN ODCIConst.Success;
    END IF;

    -- get function name
    IF bitand(pred.Flags, ODCIConst.PredObjectFunc) &gt; 0 THEN
      fname := pred.ObjectName;
    ELSE
      fname := pred.MethodName;
    END IF;

    -- convert prefix relational operator to infix:
    -- &#34;Power_EqualsSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) = 1&#34;
    -- becomes &#34;col[&lt;cell&gt;] = &lt;value&gt;&#34;

    --   Power_EqualsSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) = 0
    --   Power_EqualsSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &lt;= 0
    --   Power_EqualsSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &lt; 1
    -- can be transformed to
    --   col[&lt;cell&gt;] != &lt;value&gt;
    IF (fname LIKE upper(&#39;Power_Equals%&#39;) AND
        (stop = 0 OR
         (stop = 1 AND
          bitand(pred.Flags, ODCIConst.PredIncludeStop) = 0))) THEN
      relop := &#39;!=&#39;;

    --   Power_LessThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) = 0
    --   Power_LessThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &lt;= 0
    --   Power_LessThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &lt; 1
    -- can be transformed to
    --   col[&lt;cell&gt;] &gt;= &lt;value&gt;
    ELSIF (fname LIKE upper(&#39;Power_LessThan%&#39;) AND
           (stop = 0 OR
            (stop = 1 AND
             bitand(pred.Flags, ODCIConst.PredIncludeStop) = 0))) THEN
      relop := &#39;&gt;=&#39;;

    --   Power_GreaterThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) = 0
    --   Power_GreaterThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &lt;= 0
    --   Power_GreaterThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &lt; 1
    -- can be transformed to
    --   col[&lt;cell&gt;] &lt;= &lt;value&gt;
    ELSIF (fname LIKE upper(&#39;Power_GreaterThan%&#39;) AND
           (stop = 0 OR
            (stop = 1 AND
             bitand(pred.Flags, ODCIConst.PredIncludeStop) = 0))) THEN
      relop := &#39;&lt;=&#39;;

    --   Power_EqualsSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) = 1
    --   Power_EqualsSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &gt;= 1
    --   Power_EqualsSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &gt; 0
    -- can be transformed to
    --   col[&lt;cell&gt;] = &lt;value&gt;
    ELSIF (fname LIKE upper(&#39;Power_Equals%&#39;) AND
           (strt = 1 OR
            (strt = 0 AND
             bitand(pred.Flags, ODCIConst.PredIncludeStart) = 0))) THEN
      relop := &#39;=&#39;;

    --   Power_LessThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) = 1
    --   Power_LessThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &gt;= 1
    --   Power_LessThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &gt; 0
    -- can be transformed to
    --   col[&lt;cell&gt;] &lt; &lt;value&gt;
    ELSIF (fname LIKE upper(&#39;Power_LessThan%&#39;) AND
           (strt = 1 OR
            (strt = 0 AND
             bitand(pred.Flags, ODCIConst.PredIncludeStart) = 0))) THEN
      relop := &#39;&lt;&#39;;

    --   Power_GreaterThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) = 1
    --   Power_GreaterThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &gt;= 1
    --   Power_GreaterThanSpecific_Func(col, &lt;cell&gt;, &lt;value&gt;) &gt; 0
    -- can be transformed to
    --   col[&lt;cell&gt;] &gt; &lt;value&gt;
    ELSIF (fname LIKE upper(&#39;Power_GreaterThan%&#39;) AND
           (strt = 1 OR
            (strt = 0 AND
             bitand(pred.Flags, ODCIConst.PredIncludeStart) = 0))) THEN
      relop := &#39;&gt;&#39;;

    ELSE
      RETURN ODCIConst.Error;

    END IF;
</pre>
<p>After the <code class="codeph">Specific</code> function predicate is transformed into a simple range predicate, <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> calls <code class="codeph">get_selectivity</code> to compute the selectivity for the range predicate (and thus, equivalently, for the <code class="codeph">Specific</code> function predicate). It returns with a success status.</p>
<pre dir="ltr">    sel := get_selectivity(relop, value, lo, hi, nrows);
    RETURN ODCIConst.Success;
  END;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4857"></a><a id="ADDCI4856"></a>
<div class="props_rev_3"><a id="GUID-A248709C-33C3-4171-BBE8-270972724BFA"></a>
<h4 id="ADDCI-GUID-A248709C-33C3-4171-BBE8-270972724BFA" class="sect4">ODCIStatsIndexCost() Method for <span class="bold">Specific</span> Queries</h4>
<div>
<div class="section">
<p>The first definition of the <a href="ext_opt_ref.htm#GUID-158EC3A8-CB48-48B2-9405-198BA0FDD777">ODCIStatsIndexCost()</a> function, demonstrated in <a href="pwr_example.htm#GUID-A248709C-33C3-4171-BBE8-270972724BFA__CIABCJAG">Example 14-29</a>, estimates the cost of the domain index for <code class="codeph">Specific</code> queries. For example, if a query asks for all instances where cell <code class="codeph">(3,7)</code> has a value equal to <code class="codeph">25</code>, the function estimates the cost of the domain index access path to evaluate this query. This definition of <a href="ext_opt_ref.htm#GUID-158EC3A8-CB48-48B2-9405-198BA0FDD777">ODCIStatsIndexCost()</a> differs from the definition in <a href="pwr_example.htm#GUID-2AFC0498-0606-4B99-AD0B-480339855F44">ODCIStatsIndexCost() Method for Any Queries</a> in that it includes the <code class="codeph">cmppos</code> parameter for the position of the cell.</p>
<p>The <code class="codeph">ia</code> parameter contains the index information as an object instance of type <code class="codeph">SYS.ODCIINDEXINFO</code>. The <code class="codeph">sel</code> parameter is the selectivity of the operator predicate as estimated by the <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> function for <code class="codeph">Specific</code> queries. The estimated cost is returned in the <code class="codeph">cost</code> output parameter. The <code class="codeph">qi</code> parameter contains some information about the query and its environment, such as whether the <code class="codeph">ALL_ROWS</code> or <code class="codeph">FIRST_ROWS</code> optimizer mode is being used. The <code class="codeph">pred</code> parameter contains the operator information as an object instance of type <code class="codeph">SYS.ODCIPREDINFO</code>. The <code class="codeph">args</code> parameter contains descriptors of the value arguments of the operator, and the start and stop values of the operator. The <code class="codeph">strt</code> and <code class="codeph">stop</code> parameters are the lower and upper boundary points for the operator return value. The <code class="codeph">cmppos</code> parameter is the cell position and <code class="codeph">cmpval</code> is the value in the cell specified by the operator <code class="codeph">Power_XxxxxSpecific()</code>.</p>
<p>In the power demand cartridge, the domain index cost for <code class="codeph">Specific</code> queries is identical to the domain index cost for <code class="codeph">Any</code> queries, so this version of the <a href="ext_opt_ref.htm#GUID-158EC3A8-CB48-48B2-9405-198BA0FDD777">ODCIStatsIndexCost()</a> function simply calls the second definition of the function, described in <a href="pwr_example.htm#GUID-2AFC0498-0606-4B99-AD0B-480339855F44">ODCIStatsIndexCost() Method for Any Queries</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-A248709C-33C3-4171-BBE8-270972724BFA__CIABCJAG">
<p class="titleinexample">Example 14-29 Registering ODCISIndexCost() for Queries for Power Demand Cartridge</p>
<pre dir="ltr">  STATIC FUNCTION ODCIStatsIndexCost(ia sys.ODCIIndexInfo,
     sel NUMBER, cost OUT sys.ODCICost, qi sys.ODCIQueryInfo,
     pred sys.ODCIPredInfo, args sys.ODCIArgDescList,
     strt NUMBER, stop NUMBER, cmppos NUMBER, cmpval NUMBER, env sys.ODCIEnv)
     RETURN NUMBER IS
  BEGIN
    -- This is the cost for queries on a specific cell; simply
    -- use the cost for queries on any cell.
    RETURN ODCIStatsIndexCost(ia, sel, cost, qi, pred, args,
                              strt, stop, cmpval, env);
  END;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4859"></a><a id="ADDCI4858"></a>
<div class="props_rev_3"><a id="GUID-2AFC0498-0606-4B99-AD0B-480339855F44"></a>
<h4 id="ADDCI-GUID-2AFC0498-0606-4B99-AD0B-480339855F44" class="sect4">ODCIStatsIndexCost() Method for <span class="bold">Any</span> Queries</h4>
<div>
<div class="section">
<p>The second definition of the <a href="ext_opt_ref.htm#GUID-158EC3A8-CB48-48B2-9405-198BA0FDD777">ODCIStatsIndexCost()</a> function, demonstrated in <a href="pwr_example.htm#GUID-2AFC0498-0606-4B99-AD0B-480339855F44__CIAEDEIG">Example 14-30</a>, estimates the cost of the domain index for <code class="codeph">Any</code> queries. For example, if a query asks for all instances where any cell has a value equal to 25, the function estimates the cost of the domain index access path to evaluate this query. This definition of <a href="ext_opt_ref.htm#GUID-158EC3A8-CB48-48B2-9405-198BA0FDD777">ODCIStatsIndexCost()</a> differs from the definition in <a href="pwr_example.htm#GUID-A248709C-33C3-4171-BBE8-270972724BFA">ODCIStatsIndexCost() Method for Specific Queries</a> in that it does not include the <code class="codeph">cmppos</code> parameter.</p>
<p>The <code class="codeph">ia</code> parameter contains the index information as an object instance of type <code class="codeph">SYS.ODCIINDEXINFO</code>. The <code class="codeph">sel</code> parameter is the selectivity of the operator predicate as estimated by the <a href="ext_opt_ref.htm#GUID-4CEECA5F-099A-4558-A50C-FD856A814CF3">ODCIStatsSelectivity()</a> function for <code class="codeph">Any</code> queries. The estimated cost is returned in the <code class="codeph">cost</code> output parameter. The <code class="codeph">qi</code> parameter contains some information about the query and its environment, such as whether the <code class="codeph">ALL_ROWS</code> or <code class="codeph">FIRST_ROWS</code> optimizer mode is being used. The <code class="codeph">pred</code> parameter contains the operator information as an object instance of type <code class="codeph">SYS.ODCIPREDINFO</code>. The <code class="codeph">args</code> parameter contains descriptors of the value arguments of the operator, and the start and stop values of the operator. The <code class="codeph">strt</code> and <code class="codeph">stop</code> parameters are the lower and upper boundary points for the operator return value. The <code class="codeph">cmpval</code> parameter is the value in the cell specified by the operator <code class="codeph">Power_XxxxxAny()</code>.</p>
<p>The index cost is estimated as the number of blocks in the index-organized table implementing the index multiplied by the selectivity of the operator predicate times a constant factor.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-2AFC0498-0606-4B99-AD0B-480339855F44__CIAEDEIG">
<p class="titleinexample">Example 14-30 Registering ODCIStatsIndexCost() for Any Queries for Power Demand Cartridge</p>
<pre dir="ltr">  STATIC FUNCTION ODCIStatsIndexCost(ia sys.ODCIIndexInfo,
     sel NUMBER, cost OUT sys.ODCICost, qi sys.ODCIQueryInfo,
     pred sys.ODCIPredInfo, args sys.ODCIArgDescList,
     strt NUMBER, stop NUMBER, cmpval NUMBER, env sys.ODCIEnv)
     RETURN NUMBER IS
     ixtable             VARCHAR2(40);
     numblocks           NUMBER := NULL;
     get_table           user_tables%ROWTYPE;
     CURSOR c1(tab VARCHAR2) IS
       SELECT * FROM user_tables WHERE table_name = tab;
  BEGIN
    -- This is the cost for queries on any cell.

    -- To compute the cost of a domain index, multiply the
    -- number of blocks in the table implementing the index
    -- with the selectivity

    -- Return if we don&#39;t have predicate selectivity
    IF sel IS NULL THEN
      RETURN ODCIConst.Error;
    END IF;

    cost := sys.ODCICost(NULL, NULL, NULL, NULL);

    -- Get name of table implementing the domain index
    ixtable := ia.IndexName || &#39;_pidx&#39;;

    -- Get number of blocks in domain index
    FOR get_table IN c1(upper(ixtable)) LOOP
      numblocks := get_table.blocks;
      EXIT;
    END LOOP;

    IF numblocks IS NULL THEN
      -- Exit if there are no user-defined statistics for the index
      RETURN ODCIConst.Error;
    END IF;

    cost.CPUCost := ceil(400*(sel/100)*numblocks);
    cost.IOCost := ceil(1.5*(sel/100)*numblocks);
    RETURN ODCIConst.Success;
  END;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4861"></a><a id="ADDCI4860"></a>
<div class="props_rev_3"><a id="GUID-A3398ED3-8FD7-43E2-8A15-E0E37D08DE9B"></a>
<h4 id="ADDCI-GUID-A3398ED3-8FD7-43E2-8A15-E0E37D08DE9B" class="sect4">ODCIStatsFunctionCost() Method</h4>
<div>
<div class="section">
<p>The <a href="ext_opt_ref.htm#GUID-B13AA56D-ABAF-431A-BAED-006B8331DCE1">ODCIStatsFunctionCost()</a> function, demonstrated in <a href="pwr_example.htm#GUID-A3398ED3-8FD7-43E2-8A15-E0E37D08DE9B__CIAHHBJG">Example 14-31</a>, estimates the cost of evaluating a function <code class="codeph">Power_XxxxxSpecific_Func()</code> or <code class="codeph">Power_XxxxxAny_Func()</code>.</p>
<p>The <code class="codeph">func</code> parameter contains the function information; this parameter is an object instance of type <code class="codeph">SYS.ODCIFUNCINFO</code>. The estimated cost is returned in the output <code class="codeph">cost</code> parameter. The <code class="codeph">args</code> parameter as an object instance of type <code class="codeph">SYS.ODCIARGDESCLIST</code> contains a descriptor for each argument of the function. If the function contains a literal of type <code class="codeph">PowerDemand_Typ</code> as its first argument, the <code class="codeph">object</code> parameter contains the value in the form of an object constructor. The <code class="codeph">value</code> parameter is the value in the cell specified by the function <code class="codeph">PowerXxxxxSpecific_Func()</code> or <code class="codeph">Power_XxxxxAny_Func()</code>.</p>
<p>The function cost is simply estimated as some default value depending on the function name. Since the functions do not read any data from disk, the I/O cost is set to zero.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-A3398ED3-8FD7-43E2-8A15-E0E37D08DE9B__CIAHHBJG">
<p class="titleinexample">Example 14-31 Registering ODCIStatsFunctionCost() for Power Demand Cartridge</p>
<pre dir="ltr">  STATIC FUNCTION ODCIStatsFunctionCost(func sys.ODCIFuncInfo,
     cost OUT sys.ODCICost, args sys.ODCIArgDescList,
     object PowerDemand_Typ, value NUMBER, env sys.ODCIEnv)
     RETURN NUMBER IS
     fname               VARCHAR2(30);
  BEGIN
    cost := sys.ODCICost(NULL, NULL, NULL, NULL);

    -- Get function name
    IF  bitand(func.Flags, ODCIConst.ObjectFunc) &gt; 0 THEN
      fname := func.ObjectName;
    ELSE
      fname := func.MethodName;
    END IF;

    IF fname LIKE upper(&#39;Power_LessThan%&#39;) THEN
      cost.CPUCost := 5000;
      cost.IOCost := 0;
      RETURN ODCIConst.Success;
    ELSIF fname LIKE upper(&#39;Power_Equals%&#39;) THEN
      cost.CPUCost := 7000;
      cost.IOCost := 0;
      RETURN ODCIConst.Success;
    ELSIF fname LIKE upper(&#39;Power_GreaterThan%&#39;) THEN
      cost.CPUCost := 5000;
      cost.IOCost := 0;
      RETURN ODCIConst.Success;
    ELSE
      RETURN ODCIConst.Error;
    END IF;
  END;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADDCI4863"></a><a id="ADDCI4862"></a>
<div class="props_rev_3"><a id="GUID-3D3E0C4D-D3FC-426C-A4C9-5BABA008B6BE"></a>
<h3 id="ADDCI-GUID-3D3E0C4D-D3FC-426C-A4C9-5BABA008B6BE" class="sect3">Associating the Extensible Optimizer Methods with Database Objects</h3>
<div>
<div class="section">
<p>In order for the optimizer to use the methods defined in the <code class="codeph">power_statistics</code> object type, they have to be associated with the appropriate database objects, as demonstrated in <a href="pwr_example.htm#GUID-3D3E0C4D-D3FC-426C-A4C9-5BABA008B6BE__CIAFGDIF">Example 14-32</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-3D3E0C4D-D3FC-426C-A4C9-5BABA008B6BE__CIAFGDIF">
<p class="titleinexample">Example 14-32 Using Statistics Methods with Database Objects for Power Demand Cartridge</p>
<pre dir="ltr">  Associate statistics type with types, indextypes, and functions
ASSOCIATE STATISTICS WITH TYPES PowerDemand_Typ USING power_statistics;
ASSOCIATE STATISTICS WITH INDEXTYPES power_idxtype USING power_statistics
  WITH SYSTEM MANAGED STORAGE TABLES;
ASSOCIATE STATISTICS WITH FUNCTIONS
  Power_EqualsSpecific_Func,
  Power_GreaterThanSpecific_Func,
  Power_LessThanSpecific_Func,
  Power_EqualsAny_Func,
  Power_GreaterThanAny_Func,
  Power_LessThanAny_Func
  USING power_statistics;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4865"></a><a id="ADDCI4864"></a>
<div class="props_rev_3"><a id="GUID-B2AFBB43-0A13-4309-A0B7-D8D81A808E83"></a>
<h3 id="ADDCI-GUID-B2AFBB43-0A13-4309-A0B7-D8D81A808E83" class="sect3">Analyzing the Database Objects</h3>
<div>
<div class="section">
<p>Analyzing tables, columns, and indexes ensures that the optimizer has the relevant statistics to estimate accurate costs for various access paths and choose a good plan. Further, the selectivity and cost functions defined in the <code class="codeph">power_statistics</code> object type rely on the presence of statistics. <a href="pwr_example.htm#GUID-B2AFBB43-0A13-4309-A0B7-D8D81A808E83__CIABDGID">Example 14-33</a> demonstrates statements that analyze the database objects and verify that statistics were indeed collected.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-B2AFBB43-0A13-4309-A0B7-D8D81A808E83__CIABDGID">
<p class="titleinexample">Example 14-33 Analyzing Database Objects for the Power Demand Cartridge</p>
<pre dir="ltr">-- Analyze the table
EXECUTE dbms_stats.gather_table_stats(
    &#39;POWERCARTUSER&#39;, &#39;POWERDEMAND_TAB&#39;, cascade =&gt; TRUE);

-- Verify that user-defined statistics were collected
SELECT tab tablename, col colname, cpos, lo, hi, nrows
FROM PowerCartUserStats
WHERE nrows IS NOT NULL
ORDER BY cpos;

-- Delete the statistics
EXECUTE dbms_stats.delete_table_stats(&#39;POWERCARTUSER&#39;, &#39;POWERDEMAND_TAB&#39;);

-- Verify that user-defined statistics were deleted
SELECT tab tablename, col colname, cpos, lo, hi, nrows
FROM PowerCartUserStats
WHERE nrows IS NOT NULL
ORDER BY cpos;

-- Re-analyze the table
EXECUTE dbms_stats.gather_table_stats(
   &#39;POWERCARTUSER&#39;, &#39;POWERDEMAND_TAB&#39;,cascade =&gt; TRUE);

-- Verify that user-defined statistics were re-collected
SELECT tab tablename, col colname, cpos, lo, hi, nrows
FROM PowerCartUserStats
WHERE nrows IS NOT NULL
ORDER BY cpos;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADDCI4866"></a>
<div class="props_rev_3"><a id="GUID-62E8B2EA-FC0B-43A1-9A6D-6FD3CD7587BF"></a>
<h2 id="ADDCI-GUID-62E8B2EA-FC0B-43A1-9A6D-6FD3CD7587BF" class="sect2">Testing the Domain Index</h2>
<div>
<p>Consider the parts of the power demand example that perform some simple tests of the domain index, and how to test the domain index and see if it is causing more efficient execution of queries than would occur without an index. These tests consist of:</p>
<ul style="list-style-type: disc;">
<li>
<p>Creating the power demand table (<code class="codeph">PowerDemand_Tab</code>) and populating it with a small amount of data</p>
</li>
<li>
<p>Executing some queries before the index is created (and showing the execution plans without an index being used)</p>
<p>The execution plans show that a full table scan is performed in each case.</p>
</li>
<li>
<p>Creating the index on the grid</p>
</li>
<li>
<p>Executing the same queries after the index is created (and showing the execution plans with the index being used)</p>
<p>The execution plans show that Oracle is using the index and not performing full table scans, thus resulting in more efficient execution.</p>
</li>
</ul>
<p>The statements described here are available online in the example file (tkqxpwr.sql).</p>
</div>
<a id="ADDCI4868"></a><a id="ADDCI4869"></a><a id="ADDCI4870"></a><a id="ADDCI4867"></a>
<div class="props_rev_3"><a id="GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C"></a>
<h3 id="ADDCI-GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C" class="sect3">Creating and Populating the Power Demand Table</h3>
<div>
<div class="section">
<p>The power demand table, as demonstrated in <a href="pwr_example.htm#GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C__CIABEGBC">Example 14-34</a>, is created with two columns:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">region</code> allows the electric utility to use the grid scheme in multiple areas or states. Each region, such as New York, New Jersey, Pennsylvania, and so on, is represented by a <code class="codeph">10x10</code> grid.</p>
</li>
<li>
<p><code class="codeph">sample</code> is a collection of samplings, or power demand readings from each cell in the grid, defined using the <code class="codeph">PowerDemand_Typ</code> object type.</p>
</li>
</ul>
<p>Several rows are inserted, representing power demand data for two regions, <code class="codeph">1</code> and <code class="codeph">2</code>, for several hourly timestamps. For simplicity, values are inserted only into the first <code class="codeph">5</code> positions of each grid; the remaining <code class="codeph">95</code> values are set to <code class="codeph">null</code>, as demonstrated in <a href="pwr_example.htm#GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C__CIAGCGBE">Example 14-35</a>.</p>
<p>Finally, the values for <code class="codeph">TotGridDemand</code>, <code class="codeph">MaxCellDemand</code>, and <code class="codeph">MinCellDemand</code> are computed and set for each of the newly inserted rows, and these values are displayed, as demonstrated in <a href="pwr_example.htm#GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C__CIAEFDEB">Example 14-36</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C__CIABEGBC">
<p class="titleinexample">Example 14-34 Creating PowerDemand_Tab Table for Power Demand Cartridge</p>
<pre dir="ltr">CREATE TABLE PowerDemand_Tab (
  -- Region for which these power demand readings apply
  region NUMBER,
  -- Values for each &#34;sampling&#34; time (for a given hour)
  sample PowerDemand_Typ
);
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C__CIAGCGBE">
<p class="titleinexample">Example 14-35 Populating PowerDemand_Tab Table for Power Demand Cartridge</p>
<pre dir="ltr">-- The next INSERT statements &#34;cheats&#34; by supplying only 5 grid values
  
-- First 5 INSERT statements are for region 1 (1 AM to 5 AM on 01-Feb-1998).
 
INSERT INTO PowerDemand_Tab VALUES(1,
   PowerDemand_Typ(NULL, NULL, NULL, PowerGrid_Typ(55,8,13,9,5),
   to_date(&#39;02-01-1998 01&#39;,&#39;MM-DD-YYYY HH&#39;))
);
 
INSERT INTO PowerDemand_Tab VALUES(1,
   PowerDemand_Typ(NULL, NULL, NULL, PowerGrid_Typ(56,8,13,9,3),
   to_date(&#39;02-01-1998 02&#39;,&#39;MM-DD-YYYY HH&#39;))
);
 
INSERT INTO PowerDemand_Tab VALUES(1,
   PowerDemand_Typ(NULL, NULL, NULL, PowerGrid_Typ(55,8,13,9,3),
   to_date(&#39;02-01-1998 03&#39;,&#39;MM-DD-YYYY HH&#39;))
);
  
INSERT INTO PowerDemand_Tab VALUES(1,
   PowerDemand_Typ(NULL, NULL, NULL, PowerGrid_Typ(54,8,13,9,3),
   to_date(&#39;02-01-1998 04&#39;,&#39;MM-DD-YYYY HH&#39;))
);
 
INSERT INTO PowerDemand_Tab VALUES(1,
   PowerDemand_Typ(NULL, NULL, NULL, PowerGrid_Typ(54,8,12,9,3),
   to_date(&#39;02-01-1998 05&#39;,&#39;MM-DD-YYYY HH&#39;))
);
 
-- Also insert some rows for region 2.
 
INSERT INTO PowerDemand_Tab VALUES(2,
   PowerDemand_Typ(NULL, NULL, NULL, PowerGrid_Typ(9,8,11,16,5),
   to_date(&#39;02-01-1998 01&#39;,&#39;MM-DD-YYYY HH&#39;))
);
  
INSERT INTO PowerDemand_Tab VALUES(2,
   PowerDemand_Typ(NULL, NULL, NULL, PowerGrid_Typ(9,8,11,20,5),
   to_date(&#39;02-01-1998 02&#39;,&#39;MM-DD-YYYY HH&#39;))
);
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-E784E9CF-E397-4190-8AA0-9BE1BAE5885C__CIAEFDEB">
<p class="titleinexample">Example 14-36 Computing Grid and Cell Demands for Power Demand Cartridge</p>
<pre dir="ltr">DECLARE
CURSOR c1 IS SELECT Sample, Region FROM PowerDemand_Tab FOR UPDATE;
s PowerDemand_Typ;
r NUMBER;
BEGIN
  OPEN c1;
  LOOP
     FETCH c1 INTO s,r;
     EXIT WHEN c1%NOTFOUND;
     s.SetTotalDemand;
     s.SetMaxDemand;
     s.SetMinDemand;
     dbms_output.put_line(s.TotGridDemand);
     dbms_output.put_line(s.MaxCellDemand);
     dbms_output.put_line(s.MinCellDemand);
     UPDATE PowerDemand_Tab SET Sample = s WHERE CURRENT OF c1;
  END LOOP;
  CLOSE c1;
END;
/

-- Examine the values. 
SELECT region, P.Sample.TotGridDemand, P.Sample.MaxCellDemand,
   P.Sample.MinCellDemand,
   to_char(P.sample.sampletime, &#39;MM-DD-YYYY HH&#39;) 
 FROM PowerDemand_Tab P;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4872"></a><a id="ADDCI4871"></a>
<div class="props_rev_3"><a id="GUID-F34AB274-C2F2-4AF2-A435-E6C826426F41"></a>
<h3 id="ADDCI-GUID-F34AB274-C2F2-4AF2-A435-E6C826426F41" class="sect3">Querying Without the Index</h3>
<div>
<div class="section">
<p>The queries used here are executed by applying the underlying function <code class="codeph">PowerEqualsSpecific_Func()</code> for every row in the table, because the index has not yet been defined.</p>
<p>The example file includes queries that check, both for a specific cell number and for any cell number, for values equal to, greater than, and less than a specified value. For example, the equality queries are demonstrated in <a href="pwr_example.htm#GUID-F34AB274-C2F2-4AF2-A435-E6C826426F41__CIAEIGFE">Example 14-37</a>.</p>
<p>The execution plans show that a full table scan is performed in each case:</p>
<pre dir="ltr">OPERATIONS       OPTIONS         OBJECT_NAME    
---------------  --------------- ---------------
SELECT STATEMENT                                
TABLE ACCESS     FULL            POWERDEMAND_TAB
</pre></div>
<!-- class="section" -->
<div class="example" id="GUID-F34AB274-C2F2-4AF2-A435-E6C826426F41__CIAEIGFE">
<p class="titleinexample">Example 14-37 Making Equality Queries for Power Demand Cartridge</p>
<pre dir="ltr">SET SERVEROUTPUT ON
-------------------------------------------------------------------
-- Query, referencing the operators (without index)
-------------------------------------------------------------------
explain plan for
SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_Equals(P.Sample,2,10) = 1;
@tkoqxpll
 
SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_Equals(P.Sample,2,10) = 1;

explain plan for
SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand,
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_Equals(P.Sample,1,25) = 1;
@tkoqxpll

SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand,
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_Equals(P.Sample,1,25) = 1;
 
explain plan for
SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_Equals(P.Sample,2,8) = 1;
@tkoqxpll
 
SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_Equals(P.Sample,2,8) = 1;
 
explain plan for
SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_EqualsAny(P.Sample,9) = 1;
@tkoqxpll
 
SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     P.Sample.MinCellDemand
   FROM PowerDemand_Tab P
   WHERE Power_EqualsAny(P.Sample,9) = 1;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4874"></a><a id="ADDCI4873"></a>
<div class="props_rev_3"><a id="GUID-F1752A63-2BF6-4F5E-8ED2-B5FF7F6D1052"></a>
<h3 id="ADDCI-GUID-F1752A63-2BF6-4F5E-8ED2-B5FF7F6D1052" class="sect3">Creating the Index</h3>
<div>
<div class="section">
<p>The index is created on the <code class="codeph">Sample</code> column in the power demand table, as demonstrated in <a href="pwr_example.htm#GUID-F1752A63-2BF6-4F5E-8ED2-B5FF7F6D1052__CIAGHACH">Example 14-38</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-F1752A63-2BF6-4F5E-8ED2-B5FF7F6D1052__CIAGHACH">
<p class="titleinexample">Example 14-38 Creating an Index in PowerDemand_Tab Table for Power Demand Cartridge</p>
<pre dir="ltr">CREATE INDEX PowerIndex ON PowerDemand_Tab(Sample) 
   INDEXTYPE IS power_idxtype;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADDCI4876"></a><a id="ADDCI4875"></a>
<div class="props_rev_3"><a id="GUID-FDE33DF6-0131-47E3-8C19-BDE7892DA267"></a>
<h3 id="ADDCI-GUID-FDE33DF6-0131-47E3-8C19-BDE7892DA267" class="sect3">Querying with the Index</h3>
<div>
<div class="section">
<p>The queries used here are identical to those in <span class="q">&#34;<a href="pwr_example.htm#GUID-F34AB274-C2F2-4AF2-A435-E6C826426F41">Querying Without the Index</a>&#34;</span>, but this time the index is used.</p>
<p>The execution plans show that Oracle is using the domain index and not performing full table scans, thus resulting in more efficient execution, as demonstrated in <a href="pwr_example.htm#GUID-FDE33DF6-0131-47E3-8C19-BDE7892DA267__CIAIIFAC">Example 14-39</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-FDE33DF6-0131-47E3-8C19-BDE7892DA267__CIAIIFAC">
<p class="titleinexample">Example 14-39 Making Equality Queries with Index for Power Demand Cartridge</p>
<pre dir="ltr">SQLPLUS&gt; -------------------------------------------------------------------
SQLPLUS&gt; -- Query, referencing the operators (with index)
SQLPLUS&gt; -------------------------------------------------------------------
SQLPLUS&gt; explain plan for
     2&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     3&gt;      P.Sample.MinCellDemand
     4&gt;    FROM PowerDemand_Tab P
     5&gt;    WHERE Power_Equals(P.Sample,2,10) = 1;
Statement processed.
SQLPLUS&gt; @tkoqxpll
SQLPLUS&gt; set echo off
Echo                            OFF
Charwidth                       15
OPERATIONS      OPTIONS         OBJECT_NAME    
--------------- --------------- ---------------
SELECT STATEMEN                                
TABLE ACCESS    BY ROWID        POWERDEMAND_TAB
DOMAIN INDEX                    POWERINDEX     
3 rows selected.
Statement processed.
Echo                            ON
SQLPLUS&gt;  
SQLPLUS&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     2&gt;      P.Sample.MinCellDemand
     3&gt;    FROM PowerDemand_Tab P
     4&gt;    WHERE Power_Equals(P.Sample,2,10) = 1;
REGION     SAMPLE.TOT SAMPLE.MAX SAMPLE.MIN
---------- ---------- ---------- ----------
0 rows selected.
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;
ODCIIndexInfo
Index owner : POWERCARTUSER
Index name : POWERINDEX
Table owner : POWERCARTUSER
Table name : POWERDEMAND_TAB
Indexed column : &#34;SAMPLE&#34;
Indexed column type :POWERDEMAND_TYP
Indexed column type schema:POWERCARTUSER
ODCIPredInfo
Object owner : POWERCARTUSER
Object name : POWER_EQUALS
Method name : 
Predicate bounds flag :
     Exact Match
     Include Start Key
     Include Stop Key
start key : 1
stop key : 1
compare position : 2
compare value : 10
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;select r from POWERCARTUSER.POWERINDEX_pidx where cpos =&#39;2&#39; and cval =&#39;10&#39;
ODCIIndexFetch&gt;&gt;&gt;&gt;&gt;
Nrows : 2000
ODCIIndexClose&gt;&gt;&gt;&gt;&gt;
SQLPLUS&gt;  
SQLPLUS&gt; explain plan for
     2&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     3&gt;      P.Sample.MinCellDemand
     4&gt;    FROM PowerDemand_Tab P
     5&gt;    WHERE Power_Equals(P.Sample,2,8) = 1;
Statement processed.
SQLPLUS&gt; @tkoqxpll
SQLPLUS&gt; set echo off
Echo                            OFF
Charwidth                       15
OPERATIONS      OPTIONS         OBJECT_NAME    
--------------- --------------- ---------------
SELECT STATEMEN                                
TABLE ACCESS    BY ROWID        POWERDEMAND_TAB
DOMAIN INDEX                    POWERINDEX     
3 rows selected.
Statement processed.
Echo                            ON
SQLPLUS&gt;  
SQLPLUS&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     2&gt;      P.Sample.MinCellDemand
     3&gt;    FROM PowerDemand_Tab P
     4&gt;    WHERE Power_Equals(P.Sample,2,8) = 1;
REGION     SAMPLE.TOT SAMPLE.MAX SAMPLE.MIN
---------- ---------- ---------- ----------
         1         90         55          5
         1         89         56          3
         1         88         55          3
         1         87         54          3
         1         86         54          3
         2         49         16          5
         2         53         20          5
7 rows selected.
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;
ODCIIndexInfo
Index owner : POWERCARTUSER
Index name : POWERINDEX
Table owner : POWERCARTUSER
Table name : POWERDEMAND_TAB
Indexed column : &#34;SAMPLE&#34;
Indexed column type :POWERDEMAND_TYP
Indexed column type schema:POWERCARTUSER
ODCIPredInfo
Object owner : POWERCARTUSER
Object name : POWER_EQUALS
Method name : 
Predicate bounds flag :
     Exact Match
     Include Start Key
     Include Stop Key
start key : 1
stop key : 1
compare position : 2
compare value : 8
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;select r from POWERCARTUSER.POWERINDEX_pidx where cpos =&#39;2&#39; and cval =&#39;8&#39;
ODCIIndexFetch&gt;&gt;&gt;&gt;&gt;
Nrows : 2000
ODCIIndexClose&gt;&gt;&gt;&gt;&gt;
SQLPLUS&gt;  
SQLPLUS&gt; explain plan for
     2&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     3&gt;      P.Sample.MinCellDemand
     4&gt;    FROM PowerDemand_Tab P
     5&gt;    WHERE Power_EqualsAny(P.Sample,9) = 1;
Statement processed.
SQLPLUS&gt; @tkoqxpll
SQLPLUS&gt; set echo off
Echo                            OFF
Charwidth                       15
OPERATIONS      OPTIONS         OBJECT_NAME    
--------------- --------------- ---------------
SELECT STATEMEN                                
TABLE ACCESS    BY ROWID        POWERDEMAND_TAB
DOMAIN INDEX                    POWERINDEX     
3 rows selected.
Statement processed.
Echo                            ON
SQLPLUS&gt;  
SQLPLUS&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand, 
     2&gt;      P.Sample.MinCellDemand
     3&gt;    FROM PowerDemand_Tab P
     4&gt;    WHERE Power_EqualsAny(P.Sample,9) = 1;
REGION     SAMPLE.TOT SAMPLE.MAX SAMPLE.MIN
---------- ---------- ---------- ----------
         1         90         55          5
         1         89         56          3
         1         88         55          3
         1         87         54          3
         1         86         54          3
         2         49         16          5
         2         53         20          5
7 rows selected.
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;
ODCIIndexInfo
Index owner : POWERCARTUSER
Index name : POWERINDEX
Table owner : POWERCARTUSER
Table name : POWERDEMAND_TAB
Indexed column : &#34;SAMPLE&#34;
Indexed column type :POWERDEMAND_TYP
Indexed column type schema:POWERCARTUSER
ODCIPredInfo
Object owner : POWERCARTUSER
Object name : POWER_EQUALSANY
Method name : 
Predicate bounds flag :
     Exact Match
     Include Start Key
     Include Stop Key
start key : 1
stop key : 1
compare value : 9
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;select distinct r from POWERCARTUSER.POWERINDEX_pidx where cval =&#39;9&#39;
ODCIIndexFetch&gt;&gt;&gt;&gt;&gt;
Nrows : 2000
ODCIIndexClose&gt;&gt;&gt;&gt;&gt;
SQLPLUS&gt;
SQLPLUS&gt; explain plan for
     2&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand,
     3&gt;      P.Sample.MinCellDemand
     4&gt;    FROM PowerDemand_Tab P
     5&gt;    WHERE Power_GreaterThanAny(P.Sample,50) = 1;
Statement processed.
SQLPLUS&gt; @tkoqxpll
SQLPLUS&gt; set echo off
Echo                            OFF
Charwidth                       15
OPERATIONS      OPTIONS         OBJECT_NAME    
--------------- --------------- ---------------
SELECT STATEMEN                                
TABLE ACCESS    BY ROWID        POWERDEMAND_TAB
DOMAIN INDEX                    POWERINDEX     
3 rows selected.
Statement processed.
Echo                            ON
SQLPLUS&gt;
SQLPLUS&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand,
     2&gt;      P.Sample.MinCellDemand
     3&gt;    FROM PowerDemand_Tab P
     4&gt;    WHERE Power_GreaterThanAny(P.Sample,50) = 1;
REGION     SAMPLE.TOT SAMPLE.MAX SAMPLE.MIN
---------- ---------- ---------- ----------
         1         90         55          5
         1         89         56          3
         1         88         55          3
         1         87         54          3
         1         86         54          3
5 rows selected.
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;
ODCIIndexInfo
Index owner : POWERCARTUSER
Index name : POWERINDEX
Table owner : POWERCARTUSER
Table name : POWERDEMAND_TAB
Indexed column : &#34;SAMPLE&#34;
Indexed column type :POWERDEMAND_TYP
Indexed column type schema:POWERCARTUSER
ODCIPredInfo
Object owner : POWERCARTUSER
Object name : POWER_GREATERTHANANY
Method name :
Predicate bounds flag :
     Exact Match
     Include Start Key
     Include Stop Key
start key : 1
stop key : 1
compare value : 50
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;select distinct r from POWERCARTUSER.POWERINDEX_pidx where cv
al &gt;&#39;50&#39;
ODCIIndexFetch&gt;&gt;&gt;&gt;&gt;
Nrows : 2000
ODCIIndexClose&gt;&gt;&gt;&gt;&gt;
SQLPLUS&gt;
SQLPLUS&gt; explain plan for
     2&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand,
     3&gt;      P.Sample.MinCellDemand
     4&gt;    FROM PowerDemand_Tab P
     5&gt;    WHERE Power_LessThanAny(P.Sample,50) = 0;
Statement processed.
SQLPLUS&gt; @tkoqxpll
SQLPLUS&gt; set echo off
Echo                            OFF
Charwidth                       15
OPERATIONS      OPTIONS         OBJECT_NAME    
--------------- --------------- ---------------
SELECT STATEMEN                                
TABLE ACCESS    BY ROWID        POWERDEMAND_TAB
DOMAIN INDEX                    POWERINDEX     
3 rows selected.
Statement processed.
Echo                            ON
SQLPLUS&gt;
SQLPLUS&gt; SELECT P.Region, P.Sample.TotGridDemand ,P.Sample.MaxCellDemand,
     2&gt;      P.Sample.MinCellDemand
     3&gt;    FROM PowerDemand_Tab P
     4&gt;    WHERE Power_LessThanAny(P.Sample,50) = 0;
REGION     SAMPLE.TOT SAMPLE.MAX SAMPLE.MIN
---------- ---------- ---------- ----------
0 rows selected.
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;
ODCIIndexInfo
Index owner : POWERCARTUSER
Index name : POWERINDEX
Table owner : POWERCARTUSER
Table name : POWERDEMAND_TAB
Indexed column : &#34;SAMPLE&#34;
Indexed column type :POWERDEMAND_TYP
Indexed column type schema:POWERCARTUSER
ODCIPredInfo
Object owner : POWERCARTUSER
Object name : POWER_LESSTHANANY
Method name :
Predicate bounds flag :
     Exact Match
     Include Start Key
     Include Stop Key
start key : 0
stop key : 0
compare value : 50
ODCIIndexStart&gt;&gt;&gt;&gt;&gt;select distinct r from POWERCARTUSER.POWERINDEX_pidx minus se
lect distinct r from POWERCARTUSER.POWERINDEX_pidx where cval &lt;&#39;50&#39;
ODCIIndexFetch&gt;&gt;&gt;&gt;&gt;
Nrows : 2000
ODCIIndexClose&gt;&gt;&gt;&gt;&gt;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5977">
<tr>
<td class="cellalignment5984">
<table class="cellalignment5982">
<tr>
<td class="cellalignment5981"><a href="part3.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5981"><a href="psbtree_example.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5986">
<table class="cellalignment5980">
<tr>
<td class="cellalignment5981"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5981"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5981"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5981"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5981"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5981"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>