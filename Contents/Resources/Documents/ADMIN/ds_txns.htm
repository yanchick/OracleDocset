<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-201"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Distributed%20Transactions%20Concepts"></a><title>Distributed Transactions Concepts</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="Distributed transactions update data on two or more distinct nodes of a distributed database."/>
<meta name="keywords" content="distributed transactions, defined, DML and DDL, transaction control statements, distributed transactions and, session trees, session trees for distributed transactions, definition, clients, database servers, database server role, servers, role in two-phase commit, local coordinators, global coordinators, global coordinator, commit point site, committing transactions, commit point site for distributed transactions, committing, commit point strength, COMMIT_POINT_STRENGTH initialization parameter, initialization parameters, COMMIT_POINT_STRENGTH, distributed databases, how the database determines, determining, transaction management, overview, two-phase commit, phases, prepare phase, in two-phase commit, commit phase, prepared response, read-only response, recognizing read-only nodes, abort response, steps, in-doubt transactions, transactions, in-doubt, steps in commit phase, global database consistency, distributed databases and, system change numbers, coordination in a distributed database system, forget phase, automatic resolution, manual resolution, SCNs and, case study, example"/>
<meta name="dcterms.created" content="2017-07-10T12:24:11Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Administrator&rsquo;s Guide"/>
<meta name="dcterms.identifier" content="E41484-15"/>
<meta name="dcterms.isVersionOf" content="ADMIN"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="ds_appdev.htm" title="Previous" type="text/html"/>
<link rel="Next" href="ds_txnman.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41484-15.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-C1B373BA-410E-4F38-8522-F72A74665919"></a> <span id="PAGE" style="display:none;">43/59</span> <!-- End Header -->
<a id="ADMIN031"></a>
<h1 id="ADMIN-GUID-C1B373BA-410E-4F38-8522-F72A74665919" class="sect1"><span class="enumeration_chapter">34</span> Distributed Transactions Concepts</h1>
<p>Distributed transactions update data on two or more distinct nodes of a distributed database.</p>
<a id="ADMIN13143"></a><a id="ADMIN12211"></a>
<div class="props_rev_3"><a id="GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15"></a>
<h2 id="ADMIN-GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15" class="sect2"><span class="enumeration_section">34.1</span> What Are Distributed Transactions?</h2>
<div>
<p>A <span class="bold">distributed transaction</span> includes one or more statements that, individually or as a group, update data on two or more distinct nodes of a distributed database.</p>
<p>For example, assume the database configuration depicted in <a href="ds_txns.htm#GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15__i1107562">Figure 34-1</a>:</p>
<div class="figure" id="GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15__i1107562">
<p class="titleinfigure">Figure 34-1 Distributed System</p>
<img width="510" height="319" src="img/GUID-D521B4E9-E916-4B02-8B0E-4FAF4DC61423-default.gif" alt="Description of Figure 34-1 follows" title="Description of Figure 34-1 follows"/><br/>
<a href="img_text/GUID-D521B4E9-E916-4B02-8B0E-4FAF4DC61423-print.htm">Description of &#34;Figure 34-1 Distributed System&#34;</a></div>
<!-- class="figure" -->
<p>The following distributed transaction executed by <code class="codeph">scott</code> updates the local <code class="codeph">sales</code> database, the remote <code class="codeph">hq</code> database, and the remote <code class="codeph">maint</code> database:</p>
<pre dir="ltr">UPDATE scott.dept@hq.us.example.com
  SET loc = &#39;REDWOOD SHORES&#39;
  WHERE deptno = 10;
UPDATE scott.emp
  SET deptno = 11
  WHERE deptno = 10;
UPDATE scott.bldg@maint.us.example.com
  SET room = 1225
  WHERE room = 1163;
COMMIT;
</pre>
<div class="infobox-note" id="GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15__GUID-00CCF6B6-33AA-4264-A5FC-8F1EB3D700F4">
<p class="notep1">Note:</p>
<p>If all statements of a transaction reference only a single remote node, then the transaction is remote, not distributed.</p>
</div>
<p>There are two types of permissible operations in distributed transactions: DML and DDL transactions, and transaction control statement.</p>
</div>
<a id="ADMIN12212"></a>
<div class="props_rev_3"><a id="GUID-1877D055-CF22-45C6-BFBD-F8126A1F517F"></a>
<h3 id="ADMIN-GUID-1877D055-CF22-45C6-BFBD-F8126A1F517F" class="sect3"><span class="enumeration_section">34.1.1</span> DML and DDL Transactions</h3>
<div>
<p>Some DML and DDL operations are supported in a distributed transaction.</p>
<p>The following are the DML and DDL operations supported in a distributed transaction:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">CREATE</code> <code class="codeph">TABLE</code> <code class="codeph">AS</code> <code class="codeph">SELECT</code></p>
</li>
<li>
<p><code class="codeph">DELETE</code></p>
</li>
<li>
<p><code class="codeph">INSERT</code> (default and direct load)</p>
</li>
<li>
<p><code class="codeph">UPDATE</code></p>
</li>
<li>
<p><code class="codeph">LOCK</code> <code class="codeph">TABLE</code></p>
</li>
<li>
<p><code class="codeph">SELECT</code></p>
</li>
<li>
<p><code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code></p>
</li>
</ul>
<p>You can execute DML and DDL statements in parallel, and <code class="codeph">INSERT</code> direct load statements serially, but note the following restrictions:</p>
<ul style="list-style-type: disc;">
<li>
<p>All remote operations must be <code class="codeph">SELECT</code> statements.</p>
</li>
<li>
<p>These statements must not be clauses in another distributed transaction.</p>
</li>
<li>
<p>If the table referenced in the <span class="italic">table_expression_clause</span> of an <code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, or <code class="codeph">DELETE</code> statement is remote, then execution is serial rather than parallel.</p>
</li>
<li>
<p>You cannot perform remote operations after issuing parallel DML/DDL or direct load <code class="codeph">INSERT</code>.</p>
</li>
<li>
<p>If the transaction begins using XA or OCI, it executes serially.</p>
</li>
<li>
<p>No loopback operations can be performed on the transaction originating the parallel operation. For example, you cannot reference a remote object that is actually a synonym for a local object.</p>
</li>
<li>
<p>If you perform a distributed operation other than a <code class="codeph">SELECT</code> in the transaction, no DML is parallelized.</p>
</li>
</ul>
</div>
</div>
<a id="ADMIN12213"></a>
<div class="props_rev_3"><a id="GUID-66FABBBA-9E62-49B0-953B-72771346511A"></a>
<h3 id="ADMIN-GUID-66FABBBA-9E62-49B0-953B-72771346511A" class="sect3"><span class="enumeration_section">34.1.2</span> Transaction Control Statements</h3>
<div>
<p>Some transaction control statements are supported in distributed transactions.</p>
<p>The following are the supported transaction control statements:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">COMMIT</code></p>
</li>
<li>
<p><code class="codeph">ROLLBACK</code></p>
</li>
<li>
<p><code class="codeph">SAVEPOINT</code></p>
<div class="infoboxnotealso" id="GUID-66FABBBA-9E62-49B0-953B-72771346511A__GUID-55007788-8BCB-417D-8EA3-153353EB54CA">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF" target="_blank" href="../SQLRF/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about these SQL statements</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2"><a id="GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32"></a>
<h2 id="ADMIN-GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" class="sect2"><span class="enumeration_section">34.2</span> Session Trees for Distributed Transactions</h2>
<p>A session tree is a hierarchical model that describes the relationships among sessions and their roles.</p>
<a id="ADMIN13144"></a><a id="ADMIN12214"></a>
<div class="props_rev_3"><a id="GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C"></a>
<h3 id="ADMIN-GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C" class="sect3"><span class="enumeration_section">34.2.1</span> About Session Trees for Distributed Transactions</h3>
<div>
<p>As the statements in a distributed transaction are issued, the database defines a <span class="bold">session tree</span> of all nodes participating in the transaction.</p>
<p>A session tree is a hierarchical model that describes the relationships among sessions and their roles. <a href="ds_txns.htm#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">Figure 34-2</a> illustrates a session tree:</p>
<div class="figure" id="GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">
<p class="titleinfigure">Figure 34-2 Example of a Session Tree</p>
<img width="672" height="351" src="img/GUID-2C570499-2049-451C-8543-D1FF0BDE806E-default.png" alt="Description of Figure 34-2 follows" title="Description of Figure 34-2 follows"/><br/>
<a href="img_text/GUID-2C570499-2049-451C-8543-D1FF0BDE806E-print.htm">Description of &#34;Figure 34-2 Example of a Session Tree&#34;</a></div>
<!-- class="figure" -->
<p>All nodes participating in the session tree of a distributed transaction assume one or more of the following roles:</p>
<div class="tblformal" id="GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__GUID-C3FFF1DC-13A2-4E1C-9AED-DBB9C9003FBC">
<table class="cellalignment1849" summary="Column 1 contains the name of the role and column 2 describes node behavior.">
<thead>
<tr class="cellalignment1843">
<th class="cellalignment1882" id="d250483e572">Role</th>
<th class="cellalignment1965" id="d250483e575">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e580" headers="d250483e572">
<p>Client</p>
</td>
<td class="cellalignment1966" headers="d250483e580 d250483e575">
<p>A node that references information in a database belonging to a different node.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e587" headers="d250483e572">
<p>Database server</p>
</td>
<td class="cellalignment1966" headers="d250483e587 d250483e575">
<p>A node that receives a request for information from another node.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e594" headers="d250483e572">
<p>Global coordinator</p>
</td>
<td class="cellalignment1966" headers="d250483e594 d250483e575">
<p>The node that originates the distributed transaction.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e601" headers="d250483e572">
<p>Local coordinator</p>
</td>
<td class="cellalignment1966" headers="d250483e601 d250483e575">
<p>A node that is forced to reference data on other nodes to complete its part of the transaction.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e608" headers="d250483e572">
<p>Commit point site</p>
</td>
<td class="cellalignment1966" headers="d250483e608 d250483e575">
<p>The node that commits or rolls back the transaction as instructed by the global coordinator.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The role a node plays in a distributed transaction is determined by:</p>
<ul style="list-style-type: disc;">
<li>
<p>Whether the transaction is local or remote</p>
</li>
<li>
<p>The <span class="bold">commit point strength</span> of the node (<span class="q">&#34;<a href="ds_txns.htm#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" title="The job of the commit point site is to initiate a commit or roll back operation as instructed by the global coordinator.">Commit Point Site</a> &#34;</span>)</p>
</li>
<li>
<p>Whether all requested data is available at a node, or whether other nodes need to be referenced to complete the transaction</p>
</li>
<li>
<p>Whether the node is read-only</p>
</li>
</ul>
</div>
</div>
<a id="ADMIN12215"></a>
<div class="props_rev_3"><a id="GUID-EDF6B245-7FE7-4114-A112-349DB5690EE1"></a>
<h3 id="ADMIN-GUID-EDF6B245-7FE7-4114-A112-349DB5690EE1" class="sect3"><span class="enumeration_section">34.2.2</span> Clients</h3>
<div>
<p>A node acts as a client when it references information from a database on another node.</p>
<p>The referenced node is a database server. In <a href="ds_txns.htm#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">Figure 34-2</a>, the node <code class="codeph">sales</code> is a client of the nodes that host the <code class="codeph">warehouse</code> and <code class="codeph">finance</code> databases.</p>
</div>
</div>
<a id="ADMIN12216"></a>
<div class="props_rev_3"><a id="GUID-44F33D25-94AB-497C-8FC7-8002E2661465"></a>
<h3 id="ADMIN-GUID-44F33D25-94AB-497C-8FC7-8002E2661465" class="sect3"><span class="enumeration_section">34.2.3</span> Database Servers</h3>
<div>
<p>A database server is a node that hosts a database from which a client requests data.</p>
<p>In <a href="ds_txns.htm#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">Figure 34-2</a>, an application at the <code class="codeph">sales</code> node initiates a distributed transaction that accesses data from the <code class="codeph">warehouse</code> and <code class="codeph">finance</code> nodes. Therefore, <code class="codeph">sales.example.com</code> has the role of client node, and <code class="codeph">warehouse</code> and <code class="codeph">finance</code> are both database servers. In this example, <code class="codeph">sales</code> is a database server <span class="italic">and</span> a client because the application also modifies data in the <code class="codeph">sales</code> database.</p>
</div>
</div>
<a id="ADMIN12217"></a>
<div class="props_rev_3"><a id="GUID-7FD5C82A-0A78-4A91-9281-794D4D4422B5"></a>
<h3 id="ADMIN-GUID-7FD5C82A-0A78-4A91-9281-794D4D4422B5" class="sect3"><span class="enumeration_section">34.2.4</span> Local Coordinators</h3>
<div>
<p>A node that must reference data on other nodes to complete its part in the distributed transaction is called a local coordinator.</p>
<p>In <a href="ds_txns.htm#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">Figure 34-2</a>, <code class="codeph">sales</code> is a local coordinator because it coordinates the nodes it directly references: <code class="codeph">warehouse</code> and <code class="codeph">finance.</code> The node <code class="codeph">sales</code> also happens to be the global coordinator because it coordinates all the nodes involved in the transaction.</p>
<p>A local coordinator is responsible for coordinating the transaction among the nodes it communicates directly with by:</p>
<ul style="list-style-type: disc;">
<li>
<p>Receiving and relaying transaction status information to and from those nodes</p>
</li>
<li>
<p>Passing queries to those nodes</p>
</li>
<li>
<p>Receiving queries from those nodes and passing them on to other nodes</p>
</li>
<li>
<p>Returning the results of queries to the nodes that initiated them</p>
</li>
</ul>
</div>
</div>
<a id="ADMIN12218"></a>
<div class="props_rev_3"><a id="GUID-1C9E8C56-9AB6-4560-9D70-33F772C5942B"></a>
<h3 id="ADMIN-GUID-1C9E8C56-9AB6-4560-9D70-33F772C5942B" class="sect3"><span class="enumeration_section">34.2.5</span> Global Coordinator</h3>
<div>
<p>The node where the distributed transaction originates is called the global coordinator.</p>
<p>The database application issuing the distributed transaction is directly connected to the node acting as the global coordinator. For example, in <a href="ds_txns.htm#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">Figure 34-2</a>, the transaction issued at the node <code class="codeph">sales</code> references information from the database servers <code class="codeph">warehouse</code> and <code class="codeph">finance</code>. Therefore, <code class="codeph">sales.example.com</code> is the global coordinator of this distributed transaction.</p>
<p>The global coordinator becomes the parent or root of the session tree. The global coordinator performs the following operations during a distributed transaction:</p>
<ul style="list-style-type: disc;">
<li>
<p>Sends all of the distributed transaction SQL statements, remote procedure calls, and so forth to the directly referenced nodes, thus forming the session tree</p>
</li>
<li>
<p>Instructs all directly referenced nodes other than the commit point site to prepare the transaction</p>
</li>
<li>
<p>Instructs the commit point site to initiate the global commit of the transaction if all nodes prepare successfully</p>
</li>
<li>
<p>Instructs all nodes to initiate a global rollback of the transaction if there is an abort response</p>
</li>
</ul>
</div>
</div>
<div class="sect3"><a id="GUID-51F21E1B-B735-48DC-8500-94DACAA863A0"></a>
<h3 id="ADMIN-GUID-51F21E1B-B735-48DC-8500-94DACAA863A0" class="sect3"><span class="enumeration_section">34.2.6</span> Commit Point Site</h3>
<p>The system administrator always designates one node to be the commit point site.</p>
<a id="ADMIN13145"></a><a id="ADMIN12219"></a>
<div class="props_rev_3"><a id="GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E"></a>
<h4 id="ADMIN-GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" class="sect4"><span class="enumeration_section">34.2.6.1</span> About the Commit Point Site</h4>
<div>
<p>The job of the commit point site is to initiate a commit or roll back operation as instructed by the global coordinator.</p>
<p>The system administrator always designates one node to be the commit point site in the session tree by assigning all nodes a commit point strength. The node selected as commit point site should be the node that stores the most critical data.</p>
<p><a href="ds_txns.htm#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E__i1007732">Figure 34-3</a> illustrates an example of distributed system, with <code class="codeph">sales</code> serving as the commit point site:</p>
<div class="figure" id="GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E__i1007732">
<p class="titleinfigure">Figure 34-3 Commit Point Site</p>
<img width="471" height="297" src="img/GUID-D5328E4E-E60A-45C4-A6BF-A44FA0DCBA28-default.gif" alt="Description of Figure 34-3 follows" title="Description of Figure 34-3 follows"/><br/>
<a href="img_text/GUID-D5328E4E-E60A-45C4-A6BF-A44FA0DCBA28-print.htm">Description of &#34;Figure 34-3 Commit Point Site&#34;</a></div>
<!-- class="figure" -->
<p>The commit point site is distinct from all other nodes involved in a distributed transaction in these ways:</p>
<ul style="list-style-type: disc;">
<li>
<p>The commit point site never enters the prepared state. Consequently, if the commit point site stores the most critical data, this data never remains in-doubt, even if a failure occurs. In failure situations, failed nodes remain in a prepared state, holding necessary locks on data until in-doubt transactions are resolved.</p>
</li>
<li>
<p>The commit point site commits before the other nodes involved in the transaction. In effect, the outcome of a distributed transaction at the commit point site determines whether the transaction at all nodes is committed or rolled back: the other nodes follow the lead of the commit point site. The global coordinator ensures that all nodes complete the transaction in the same manner as the commit point site.</p>
</li>
</ul>
</div>
</div>
<a id="ADMIN12220"></a>
<div class="props_rev_3"><a id="GUID-AA225F8C-3896-4B37-88F4-4B2B8F974202"></a>
<h4 id="ADMIN-GUID-AA225F8C-3896-4B37-88F4-4B2B8F974202" class="sect4"><span class="enumeration_section">34.2.6.2</span> How a Distributed Transaction Commits</h4>
<div>
<p>A distributed transaction is considered committed after all non-commit-point sites are prepared, and the transaction has been actually committed at the commit point site.</p>
<p>The redo log at the commit point site is updated as soon as the distributed transaction is committed at this node.</p>
<p>Because the commit point log contains a record of the commit, the transaction is considered committed even though some participating nodes may still be only in the prepared state and the transaction not yet actually committed at these nodes. In the same way, a distributed transaction is considered <span class="italic">not</span> committed if the commit has not been logged at the commit point site.</p>
</div>
</div>
<a id="ADMIN13146"></a><a id="ADMIN12221"></a>
<div class="props_rev_3"><a id="GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035"></a>
<h4 id="ADMIN-GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035" class="sect4"><span class="enumeration_section">34.2.6.3</span> Commit Point Strength</h4>
<div>
<p>Every database server must be assigned a commit point strength. If a database server is referenced in a distributed transaction, the value of its commit point strength determines which role it plays in the two-phase commit.</p>
<p>Specifically, the commit point strength determines whether a given node is the commit point site in the distributed transaction and thus commits before all of the other nodes. This value is specified using the initialization parameter <code class="codeph">COMMIT_POINT_STRENGTH</code>. This section explains how the database determines the commit point site.</p>
<p>The commit point site, which is determined at the beginning of the prepare phase, is selected only from the nodes participating in the transaction. The following sequence of events occurs:</p>
<ol>
<li>
<p>Of the nodes directly referenced by the global coordinator, the database selects the node with the highest commit point strength as the commit point site.</p>
</li>
<li>
<p>The initially-selected node determines if any of the nodes from which it has to obtain information for this transaction has a higher commit point strength.</p>
</li>
<li>
<p>Either the node with the highest commit point strength directly referenced in the transaction or one of its servers with a higher commit point strength becomes the commit point site.</p>
</li>
<li>
<p>After the final commit point site has been determined, the global coordinator sends prepare responses to all nodes participating in the transaction.</p>
</li>
</ol>
<p><a href="ds_txns.htm#GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__i1007762">Figure 34-4</a> shows in a sample session tree the commit point strengths of each node (in parentheses) and shows the node chosen as the commit point site:</p>
<div class="figure" id="GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__i1007762">
<p class="titleinfigure">Figure 34-4 Commit Point Strengths and Determination of the Commit Point Site</p>
<img width="651" height="387" src="img/GUID-3BE190B2-98FD-402C-978D-6BBE267DE979-default.png" alt="Description of Figure 34-4 follows" title="Description of Figure 34-4 follows"/><br/>
<a href="img_text/GUID-3BE190B2-98FD-402C-978D-6BBE267DE979-print.htm">Description of &#34;Figure 34-4 Commit Point Strengths and Determination of the Commit Point Site&#34;</a></div>
<!-- class="figure" -->
<p>The following conditions apply when determining the commit point site:</p>
<ul style="list-style-type: disc;">
<li>
<p>A read-only node cannot be the commit point site.</p>
</li>
<li>
<p>If multiple nodes directly referenced by the global coordinator have the same commit point strength, then the database designates one of these as the commit point site.</p>
</li>
<li>
<p>If a distributed transaction ends with a rollback, then the prepare and commit phases are not needed. Consequently, the database never determines a commit point site. Instead, the global coordinator sends a <code class="codeph">ROLLBACK</code> statement to all nodes and ends the processing of the distributed transaction.</p>
</li>
</ul>
<p>As <a href="ds_txns.htm#GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__i1007762">Figure 34-4</a> illustrates, the commit point site and the global coordinator can be different nodes of the session tree. The commit point strength of each node is communicated to the coordinators when the initial connections are made. The coordinators retain the commit point strengths of each node they are in direct communication with so that commit point sites can be efficiently selected during two-phase commits. Therefore, it is not necessary for the commit point strength to be exchanged between a coordinator and a node each time a commit occurs.</p>
<div class="infoboxnotealso" id="GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__GUID-F4E4418A-C484-4B33-B544-0DE984DA7821">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="ds_txnman.htm#GUID-45329B02-514E-446E-89FE-14BA008BEA07" title="The database with the highest commit point strength determines which node commits first in a distributed transaction.">Specifying the Commit Point Strength of a Node</a>&#34;</span> to learn how to set the commit point strength of a node</p>
</li>
<li>
<p><a class="olink REFRN10018" target="_blank" href="../REFRN/GUID-691558F3-45F5-4A68-BE54-C28769392708.htm#REFRN10018"><span class="italic">Oracle Database Reference</span></a> for more information about the initialization parameter <code class="codeph">COMMIT_POINT_STRENGTH</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2"><a id="GUID-8152084F-4760-4B89-A91C-9A84F81C23D1"></a>
<h2 id="ADMIN-GUID-8152084F-4760-4B89-A91C-9A84F81C23D1" class="sect2"><span class="enumeration_section">34.3</span> Two-Phase Commit Mechanism</h2>
<p>In a distributed database environment, the database must coordinate the committing or rolling back of the changes in a distributed transaction as a self-contained unit.</p>
<a id="ADMIN12222"></a>
<div class="props_rev_3"><a id="GUID-70B07308-1C4C-404C-9165-9563DC3DE09C"></a>
<h3 id="ADMIN-GUID-70B07308-1C4C-404C-9165-9563DC3DE09C" class="sect3"><span class="enumeration_section">34.3.1</span> About the Two-Phase Commit Mechanism</h3>
<div>
<p>Unlike a transaction on a local database, a distributed transaction involves altering data on multiple databases. Consequently, distributed transaction processing is more complicated, because the database must coordinate the committing or rolling back of the changes in a transaction as a self-contained unit. In other words, the entire transaction commits, or the entire transaction rolls back.</p>
<p>The database ensures the integrity of data in a distributed transaction using the <span class="bold">two-phase commit mechanism</span>. In the <span class="bold">prepare phase</span>, the initiating node in the transaction asks the other participating nodes to promise to commit or roll back the transaction. During the <span class="bold">commit phase</span>, the initiating node asks all participating nodes to commit the transaction. If this outcome is not possible, then all nodes are asked to roll back.</p>
<p>All participating nodes in a distributed transaction should perform the same action: they should either all commit or all perform a rollback of the transaction. The database automatically controls and monitors the commit or rollback of a distributed transaction and maintains the integrity of the <span class="bold">global database</span> (the collection of databases participating in the transaction) using the two-phase commit mechanism. This mechanism is completely transparent, requiring no programming on the part of the user or application developer.</p>
<p>The commit mechanism has the following distinct phases, which the database performs automatically whenever a user commits a distributed transaction:</p>
<div class="tblformal" id="GUID-70B07308-1C4C-404C-9165-9563DC3DE09C__GUID-0C79A9BC-545F-4A92-8476-8CDE11C2510A">
<table class="cellalignment1849" summary="Column 1 lists the phases of commit and column 2 describes each phase.">
<thead>
<tr class="cellalignment1843">
<th class="cellalignment1882" id="d250483e1613">Phase</th>
<th class="cellalignment1965" id="d250483e1616">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e1621" headers="d250483e1613">
<p>Prepare phase</p>
</td>
<td class="cellalignment1966" headers="d250483e1621 d250483e1616">
<p>The initiating node, called the <span class="bold">global coordinator</span>, asks participating nodes other than the commit point site to promise to commit or roll back the transaction, even if there is a failure. If any node cannot prepare, the transaction is rolled back.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e1631" headers="d250483e1613">
<p>Commit phase</p>
</td>
<td class="cellalignment1966" headers="d250483e1631 d250483e1616">
<p>If all participants respond to the coordinator that they are prepared, then the coordinator asks the commit point site to commit. After it commits, the coordinator asks all other nodes to commit the transaction.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e1638" headers="d250483e1613">
<p>Forget phase</p>
</td>
<td class="cellalignment1966" headers="d250483e1638 d250483e1616">
<p>The global coordinator forgets about the transaction.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<div class="sect3"><a id="GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155"></a>
<h3 id="ADMIN-GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155" class="sect3"><span class="enumeration_section">34.3.2</span> Prepare Phase</h3>
<p>Prepare phase is the first phase in committing a distributed transaction.</p>
<a id="ADMIN12223"></a>
<div class="props_rev_3"><a id="GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3"></a>
<h4 id="ADMIN-GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3" class="sect4"><span class="enumeration_section">34.3.2.1</span> About Prepare Phase</h4>
<div>
<p>The first phase in committing a distributed transaction is the prepare phase.</p>
<p>In this phase, the database does not actually commit or roll back the transaction. Instead, all nodes referenced in a distributed transaction (except the commit point site, described in the <span class="q">&#34;<a href="ds_txns.htm#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" title="The job of the commit point site is to initiate a commit or roll back operation as instructed by the global coordinator.">Commit Point Site</a> &#34;</span>) are told to prepare to commit. By preparing, a node:</p>
<ul style="list-style-type: disc;">
<li>
<p>Records information in the redo logs so that it can subsequently either commit or roll back the transaction, regardless of intervening failures</p>
</li>
<li>
<p>Places a distributed lock on modified tables, which prevents reads</p>
</li>
</ul>
<p>When a node responds to the global coordinator that it is prepared to commit, the prepared node <span class="italic">promises</span> to either commit or roll back the transaction later, but does not make a unilateral decision on whether to commit or roll back the transaction. The promise means that if an instance failure occurs at this point, the node can use the redo records in the online log to recover the database back to the prepare phase.</p>
<div class="infobox-note" id="GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3__GUID-26D79DB7-713C-42C7-A636-CDBFC252E550">
<p class="notep1">Note:</p>
<p>Queries that start after a node has prepared cannot access the associated locked data until all phases complete. The time is insignificant unless a failure occurs (see <span class="q">&#34;<a href="ds_txnman.htm#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="A transaction is in-doubt when there is a failure during any aspect of the two-phase commit. Distributed transactions become in-doubt in the following ways: a server system running Oracle Database software crashes, a network connection between two or more Oracle Databases involved in distributed processing is disconnected, or an unhandled software error occurs.">Deciding How to Handle In-Doubt Transactions</a>&#34;</span>).</p>
</div>
</div>
</div>
<a id="ADMIN12224"></a>
<div class="props_rev_3"><a id="GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7"></a>
<h4 id="ADMIN-GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7" class="sect4"><span class="enumeration_section">34.3.2.2</span> Types of Responses in the Prepare Phase</h4>
<div>
<p>When a node is told to prepare, it can respond in the different ways.</p>
<div class="tblformal" id="GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7__GUID-7416C366-2D44-4FFD-B30A-99D06BFFF7AD">
<table class="cellalignment1849" summary="Column 1 lists possible responses when a node is told to prepare; column 2 explains the meaning of the response.">
<thead>
<tr class="cellalignment1843">
<th class="cellalignment1882" id="d250483e1873">Response</th>
<th class="cellalignment1965" id="d250483e1876">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e1881" headers="d250483e1873">
<p>Prepared</p>
</td>
<td class="cellalignment1966" headers="d250483e1881 d250483e1876">
<p>Data on the node has been modified by a statement in the distributed transaction, and the node has successfully prepared.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e1888" headers="d250483e1873">
<p>Read-only</p>
</td>
<td class="cellalignment1966" headers="d250483e1888 d250483e1876">
<p>No data on the node has been, or can be, modified (only queried), so no preparation is necessary.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1885" id="d250483e1895" headers="d250483e1873">
<p>Abort</p>
</td>
<td class="cellalignment1966" headers="d250483e1895 d250483e1876">
<p>The node cannot successfully prepare.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<a id="ADMIN12225"></a>
<div class="props_rev_3"><a id="GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52"></a>
<h5 id="ADMIN-GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52" class="sect5"><span class="enumeration_section">34.3.2.2.1</span> Prepared Response</h5>
<div>
<p>When a node has successfully prepared, it issues a <span class="bold">prepared message</span>.</p>
<p>The message indicates that the node has records of the changes in the online log, so it is prepared either to commit or perform a rollback. The message also guarantees that locks held for the transaction can survive a failure.</p>
</div>
</div>
<a id="ADMIN12226"></a>
<div class="props_rev_3"><a id="GUID-16E4E2D9-9364-425F-84CC-2266BECC340F"></a>
<h5 id="ADMIN-GUID-16E4E2D9-9364-425F-84CC-2266BECC340F" class="sect5"><span class="enumeration_section">34.3.2.2.2</span> Read-Only Response</h5>
<div>
<p>When a node is asked to prepare, and the SQL statements affecting the database do not change any data on the node, the node responds with a <span class="bold">read-only message</span>.</p>
<p>The message indicates that the node will not participate in the commit phase.</p>
<p>There are three cases in which all or part of a distributed transaction is read-only:</p>
<div class="tblformal" id="GUID-16E4E2D9-9364-425F-84CC-2266BECC340F__GUID-C1CF6127-0C5E-49AB-8A85-83FC22882255">
<table class="cellalignment1849" summary="Column 1 lists the cases where a distributed transaction might be read-only; column 2 lists the associated conditions; column 3 explains the consequences.">
<thead>
<tr class="cellalignment1843">
<th class="cellalignment1897" id="d250483e2071">Case</th>
<th class="cellalignment1892" id="d250483e2074">Conditions</th>
<th class="cellalignment1864" id="d250483e2077">Consequence</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1843">
<td class="cellalignment1899" id="d250483e2082" headers="d250483e2071">
<p>Partially read-only</p>
</td>
<td class="cellalignment1895" headers="d250483e2082 d250483e2074">
<p>Any of the following occurs:</p>
<ul style="list-style-type: disc;">
<li>
<p>Only queries are issued at one or more nodes.</p>
</li>
<li>
<p>No data is changed.</p>
</li>
<li>
<p>Changes rolled back due to triggers firing or constraint violations.</p>
</li>
</ul>
</td>
<td class="cellalignment1866" headers="d250483e2082 d250483e2077">
<p>The read-only nodes recognize their status when asked to prepare. They give their local coordinators a read-only response. Thus, the commit phase completes faster because the database eliminates read-only nodes from subsequent processing.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1899" id="d250483e2102" headers="d250483e2071">
<p>Completely read-only with prepare phase</p>
</td>
<td class="cellalignment1895" headers="d250483e2102 d250483e2074">
<p>All of following occur:</p>
<ul style="list-style-type: disc;">
<li>
<p>No data changes.</p>
</li>
<li>
<p>Transaction is <span class="italic">not</span> started with <code class="codeph">SET TRANSACTION READ ONLY</code> statement.</p>
</li>
</ul>
</td>
<td class="cellalignment1866" headers="d250483e2102 d250483e2077">
<p>All nodes recognize that they are read-only during prepare phase, so no commit phase is required. The global coordinator, not knowing whether all nodes are read-only, must still perform the prepare phase.</p>
</td>
</tr>
<tr class="cellalignment1843">
<td class="cellalignment1899" id="d250483e2125" headers="d250483e2071">
<p>Completely read-only without two-phase commit</p>
</td>
<td class="cellalignment1895" headers="d250483e2125 d250483e2074">
<p>All of following occur:</p>
<ul style="list-style-type: disc;">
<li>
<p>No data changes.</p>
</li>
<li>
<p>Transaction <span class="italic">is</span> started with <code class="codeph">SET TRANSACTION READ ONLY</code> statement.</p>
</li>
</ul>
</td>
<td class="cellalignment1866" headers="d250483e2125 d250483e2077">
<p>Only queries are allowed in the transaction, so global coordinator does not have to perform two-phase commit. Changes by other transactions do not degrade global transaction-level read consistency because of global SCN coordination among nodes. The transaction does not use undo segments.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Note that if a distributed transaction is set to read-only, then it does not use undo segments. If many users connect to the database and their transactions are <span class="italic">not</span> set to <code class="codeph">READ ONLY</code>, then they allocate undo space even if they are only performing queries.</p>
</div>
</div>
<a id="ADMIN12227"></a>
<div class="props_rev_3"><a id="GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6"></a>
<h5 id="ADMIN-GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6" class="sect5"><span class="enumeration_section">34.3.2.2.3</span> Abort Response</h5>
<div>
<p>The <span class="bold">abort message</span> results in specific actions.</p>
<p>When a node cannot successfully prepare, it performs the following actions:</p>
<ol>
<li>
<p>Releases resources currently held by the transaction and rolls back the local portion of the transaction.</p>
</li>
<li>
<p>Responds to the node that referenced it in the distributed transaction with an abort message.</p>
</li>
</ol>
<p>These actions then propagate to the other nodes involved in the distributed transaction so that they can roll back the transaction and guarantee the integrity of the data in the global database. This response enforces the primary rule of a distributed transaction: <span class="italic">all nodes involved in the transaction either all commit or all roll back the transaction at the same logical time</span>.</p>
</div>
</div>
</div>
<a id="ADMIN12228"></a>
<div class="props_rev_3"><a id="GUID-77A6C58F-AF82-40FA-A12D-8168026DBBC6"></a>
<h4 id="ADMIN-GUID-77A6C58F-AF82-40FA-A12D-8168026DBBC6" class="sect4"><span class="enumeration_section">34.3.2.3</span> Steps in the Prepare Phase</h4>
<div>
<p>The prepare phase in the two-phase commit process includes specific steps.</p>
<p>To complete the prepare phase, each node excluding the commit point site performs the following steps:</p>
<ol>
<li>
<p>The node requests that its <span class="bold">descendants</span>, that is, the nodes subsequently referenced, prepare to commit.</p>
</li>
<li>
<p>The node checks to see whether the transaction changes data on itself or its descendants. If there is no change to the data, then the node skips the remaining steps and returns a read-only response (see <span class="q">&#34;<a href="ds_txns.htm#GUID-16E4E2D9-9364-425F-84CC-2266BECC340F" title="When a node is asked to prepare, and the SQL statements affecting the database do not change any data on the node, the node responds with a read-only message.">Read-Only Response</a>&#34;</span>).</p>
</li>
<li>
<p>The node allocates the resources it must commit the transaction if data is changed.</p>
</li>
<li>
<p>The node saves redo records corresponding to changes made by the transaction to its redo log.</p>
</li>
<li>
<p>The node guarantees that locks held for the transaction are able to survive a failure.</p>
</li>
<li>
<p>The node responds to the initiating node with a prepared response (see <span class="q">&#34;<a href="ds_txns.htm#GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52" title="When a node has successfully prepared, it issues a prepared message.">Prepared Response</a>&#34;</span>) or, if its attempt or the attempt of one of its descendents to prepare was unsuccessful, with an abort response (see <span class="q">&#34;<a href="ds_txns.htm#GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6" title="The abort message results in specific actions.">Abort Response</a>&#34;</span>).</p>
</li>
</ol>
<p>These actions guarantee that the node can subsequently commit or roll back the transaction on the node. The prepared nodes then wait until a <code class="codeph">COMMIT</code> or <code class="codeph">ROLLBACK</code> request is received from the global coordinator.</p>
<p>After the nodes are prepared, the distributed transaction is said to be <span class="bold">in-doubt</span> (see <span class="q">&#34;<a href="ds_txns.htm#GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C" title="The two-phase commit mechanism ensures that all nodes either commit or perform a rollback together. What happens if any of the three phases fails because of a system or network error? The transaction becomes in-doubt.">In-Doubt Transactions</a>&#34;</span>). It retains in-doubt status until all changes are either committed or rolled back.</p>
</div>
</div>
</div>
<a id="ADMIN12229"></a>
<div class="props_rev_3"><a id="GUID-6D72F449-2A6C-49E3-84C6-10E09C751605"></a>
<h3 id="ADMIN-GUID-6D72F449-2A6C-49E3-84C6-10E09C751605" class="sect3"><span class="enumeration_section">34.3.3</span> Commit Phase</h3>
<p>The second phase in committing a distributed transaction is the commit phase. Before this phase occurs, <span class="italic">all</span> nodes other than the commit point site referenced in the distributed transaction have guaranteed that they are prepared, that is, they have the necessary resources to commit the transaction.</p>
<a id="ADMIN12230"></a>
<div class="props_rev_3"><a id="GUID-29693A46-C02E-4B2B-B914-412E1DD58098"></a>
<h4 id="ADMIN-GUID-29693A46-C02E-4B2B-B914-412E1DD58098" class="sect4"><span class="enumeration_section">34.3.3.1</span> Steps in the Commit Phase</h4>
<div>
<p>The commit phase in the two-phase commit process includes specific steps.</p>
<p>The commit phase consists of the following steps:</p>
<ol>
<li>
<p>The global coordinator instructs the commit point site to commit.</p>
</li>
<li>
<p>The commit point site commits.</p>
</li>
<li>
<p>The commit point site informs the global coordinator that it has committed.</p>
</li>
<li>
<p>The global and local coordinators send a message to all nodes instructing them to commit the transaction.</p>
</li>
<li>
<p>At each node, the database commits the local portion of the distributed transaction and releases locks.</p>
</li>
<li>
<p>At each node, the database records an additional redo entry in the local redo log, indicating that the transaction has committed.</p>
</li>
<li>
<p>The participating nodes notify the global coordinator that they have committed.</p>
</li>
</ol>
<p>When the commit phase is complete, the data on all nodes of the distributed system is consistent.</p>
</div>
</div>
<a id="ADMIN12231"></a>
<div class="props_rev_3"><a id="GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C"></a>
<h4 id="ADMIN-GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C" class="sect4"><span class="enumeration_section">34.3.3.2</span> Guaranteeing Global Database Consistency</h4>
<div>
<p>Each committed transaction has an associated system change number (SCN) to uniquely identify the changes made by the SQL statements within that transaction.</p>
<p>The SCN functions as an internal timestamp that uniquely identifies a committed version of the database.</p>
<p>In a distributed system, the SCNs of communicating nodes are coordinated when all of the following actions occur:</p>
<ul style="list-style-type: disc;">
<li>
<p>A connection occurs using the path described by one or more database links</p>
</li>
<li>
<p>A distributed SQL statement executes</p>
</li>
<li>
<p>A distributed transaction commits</p>
</li>
</ul>
<p>Among other benefits, the coordination of SCNs among the nodes of a distributed system ensures global read-consistency at both the statement and transaction level. If necessary, global time-based recovery can also be completed.</p>
<p>During the prepare phase, the database determines the highest SCN at all nodes involved in the transaction. The transaction then commits with the high SCN at the commit point site. The commit SCN is then sent to all prepared nodes with the commit decision.</p>
<div class="infoboxnotealso" id="GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C__GUID-257994BE-CAA6-462E-BEA0-F1481ADFD034">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="ds_txnman.htm#GUID-195124A5-FF1B-40BA-BAF9-CB5272E8BFD3" title="An important restriction exists in the Oracle Database implementation of distributed read consistency.">Managing Read Consistency</a>&#34;</span> for information about managing time lag issues in read consistency</p>
</div>
</div>
</div>
</div>
<a id="ADMIN12232"></a>
<div class="props_rev_3"><a id="GUID-3A7B038B-61F9-42C1-823F-4E304B68462C"></a>
<h3 id="ADMIN-GUID-3A7B038B-61F9-42C1-823F-4E304B68462C" class="sect3"><span class="enumeration_section">34.3.4</span> Forget Phase</h3>
<div>
<p>After the participating nodes notify the commit point site that they have committed, the commit point site can forget about the transaction.</p>
<p>The following steps occur:</p>
<ol>
<li>
<p>After receiving notice from the global coordinator that all nodes have committed, the commit point site erases status information about this transaction.</p>
</li>
<li>
<p>The commit point site informs the global coordinator that it has erased the status information.</p>
</li>
<li>
<p>The global coordinator erases its own information about the transaction.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2"><a id="GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A"></a>
<h2 id="ADMIN-GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A" class="sect2"><span class="enumeration_section">34.4</span> In-Doubt Transactions</h2>
<p>A transaction becomes in-doubt if the two-phase commit mechanism fails.</p>
<a id="ADMIN12233"></a>
<div class="props_rev_3"><a id="GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C"></a>
<h3 id="ADMIN-GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C" class="sect3"><span class="enumeration_section">34.4.1</span> About In-Doubt Transactions</h3>
<div>
<p>The two-phase commit mechanism ensures that all nodes either commit or perform a rollback together. What happens if any of the three phases fails because of a system or network error? The transaction becomes in-doubt.</p>
<p>Distributed transactions can become in-doubt in the following ways:</p>
<ul style="list-style-type: disc;">
<li>
<p>A server system running Oracle Database software crashes</p>
</li>
<li>
<p>A network connection between two or more Oracle Databases involved in distributed processing is disconnected</p>
</li>
<li>
<p>An unhandled software error occurs</p>
</li>
</ul>
<p>The RECO process automatically resolves in-doubt transactions when the system, network, or software problem is resolved. Until RECO can resolve the transaction, the data is locked for both reads and writes. The database blocks reads because it cannot determine which version of the data to display for a query.</p>
</div>
</div>
<a id="ADMIN12234"></a>
<div class="props_rev_3"><a id="GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5"></a>
<h3 id="ADMIN-GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5" class="sect3"><span class="enumeration_section">34.4.2</span> Automatic Resolution of In-Doubt Transactions</h3>
<p>In the majority of cases, the database resolves the in-doubt transaction automatically. Assume that there are two nodes, <code class="codeph">local</code> and <code class="codeph">remote</code>, in the following scenarios. The local node is the commit point site. User <code class="codeph">scott</code> connects to <code class="codeph">local</code> and executes and commits a distributed transaction that updates <code class="codeph">local</code> and <code class="codeph">remote</code>.</p>
<a id="ADMIN13147"></a><a id="ADMIN12235"></a>
<div class="props_rev_3"><a id="GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC"></a>
<h4 id="ADMIN-GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC" class="sect4"><span class="enumeration_section">34.4.2.1</span> Failure During the Prepare Phase</h4>
<div>
<p>An example illustrates the steps that are followed when there is a failure during the prepare phase of a two-phase transaction.</p>
<p><a href="ds_txns.htm#GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC__i1008049">Figure 34-5</a> illustrates the sequence of events when there is a failure during the prepare phase of a distributed transaction:</p>
<div class="figure" id="GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC__i1008049">
<p class="titleinfigure">Figure 34-5 Failure During Prepare Phase</p>
<img width="521" height="305" src="img/GUID-8C6B1235-9821-4ADA-9A0E-59F4F5C94D10-default.gif" alt="Description of Figure 34-5 follows" title="Description of Figure 34-5 follows"/><br/>
<a href="img_text/GUID-8C6B1235-9821-4ADA-9A0E-59F4F5C94D10-print.htm">Description of &#34;Figure 34-5 Failure During Prepare Phase&#34;</a></div>
<!-- class="figure" -->
<p>The following steps occur:</p>
<ol>
<li>
<p>User <code class="codeph">SCOTT</code> connects to <code class="codeph">Local</code> and executes a distributed transaction.</p>
</li>
<li>
<p>The global coordinator, which in this example is also the commit point site, requests all databases other than the commit point site to promise to commit or roll back when told to do so.</p>
</li>
<li>
<p>The <code class="codeph">remote</code> database crashes before issuing the prepare response back to <code class="codeph">local</code>.</p>
</li>
<li>
<p>The transaction is ultimately rolled back on each database by the RECO process when the remote site is restored.</p>
</li>
</ol>
</div>
</div>
<a id="ADMIN13148"></a><a id="ADMIN12236"></a>
<div class="props_rev_3"><a id="GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8"></a>
<h4 id="ADMIN-GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8" class="sect4"><span class="enumeration_section">34.4.2.2</span> Failure During the Commit Phase</h4>
<div>
<p>An example illustrates the steps that are followed when there is a failure during the commit phase of a two-phase transaction.</p>
<p><a href="ds_txns.htm#GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8__CHDGGDDE">Figure 34-6</a> illustrates the sequence of events when there is a failure during the commit phase of a distributed transaction:</p>
<div class="figure" id="GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8__CHDGGDDE">
<p class="titleinfigure">Figure 34-6 Failure During Commit Phase</p>
<img width="575" height="309" src="img/GUID-3337CD82-F0CB-4A57-A9D5-CEACF3837F21-default.gif" alt="Description of Figure 34-6 follows" title="Description of Figure 34-6 follows"/><br/>
<a href="img_text/GUID-3337CD82-F0CB-4A57-A9D5-CEACF3837F21-print.htm">Description of &#34;Figure 34-6 Failure During Commit Phase&#34;</a></div>
<!-- class="figure" -->
<p>The following steps occur:</p>
<ol>
<li>
<p>User <code class="codeph">Scott</code> connects to <code class="codeph">local</code> and executes a distributed transaction.</p>
</li>
<li>
<p>The global coordinator, which in this case is also the commit point site, requests all databases other than the commit point site to promise to commit or roll back when told to do so.</p>
</li>
<li>
<p>The commit point site receives a prepared message from <code class="codeph">remote</code> saying that it will commit.</p>
</li>
<li>
<p>The commit point site commits the transaction locally, then sends a commit message to <code class="codeph">remote</code> asking it to commit.</p>
</li>
<li>
<p>The <code class="codeph">remote</code> database receives the commit message, but cannot respond because of a network failure.</p>
</li>
<li>
<p>The transaction is ultimately committed on the remote database by the RECO process after the network is restored.</p>
<div class="infoboxnotealso" id="GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8__GUID-B0A9A84C-61E5-4AC3-8A50-F2AE67BF8DE6">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="ds_txnman.htm#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="A transaction is in-doubt when there is a failure during any aspect of the two-phase commit. Distributed transactions become in-doubt in the following ways: a server system running Oracle Database software crashes, a network connection between two or more Oracle Databases involved in distributed processing is disconnected, or an unhandled software error occurs.">Deciding How to Handle In-Doubt Transactions</a>&#34;</span> for a description of failure situations and how the database resolves intervening failures during two-phase commit</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="ADMIN12237"></a>
<div class="props_rev_3"><a id="GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076"></a>
<h3 id="ADMIN-GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076" class="sect3"><span class="enumeration_section">34.4.3</span> Manual Resolution of In-Doubt Transactions</h3>
<div>
<p>In some cases, you must resolve an in-doubt transaction manually.</p>
<p>You should only need to resolve an in-doubt transaction manually in the following cases:</p>
<ul style="list-style-type: disc;">
<li>
<p>The in-doubt transaction has locks on critical data or undo segments.</p>
</li>
<li>
<p>The cause of the system, network, or software failure cannot be repaired quickly.</p>
</li>
</ul>
<p>Resolution of in-doubt transactions can be complicated. The procedure requires that you do the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Identify the transaction identification number for the in-doubt transaction.</p>
</li>
<li>
<p>Query the <code class="codeph">DBA_2PC_PENDING</code> and <code class="codeph">DBA_2PC_NEIGHBORS</code> views to determine whether the databases involved in the transaction have committed.</p>
</li>
<li>
<p>If necessary, force a commit using the <code class="codeph">COMMIT FORCE</code> statement or a rollback using the <code class="codeph">ROLLBACK FORCE</code> statement.</p>
<div class="infoboxnotealso" id="GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076__GUID-E03E3E1B-490B-4A4F-89A5-B6545BCDBDBA">
<p class="notep1">See Also:</p>
<p>The following sections explain how to resolve in-doubt transactions:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="ds_txnman.htm#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="A transaction is in-doubt when there is a failure during any aspect of the two-phase commit. Distributed transactions become in-doubt in the following ways: a server system running Oracle Database software crashes, a network connection between two or more Oracle Databases involved in distributed processing is disconnected, or an unhandled software error occurs.">Deciding How to Handle In-Doubt Transactions</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="ds_txnman.htm#GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93" title="Use the COMMIT or ROLLBACK statement with the FORCE option and a text string that indicates either the local or global transaction ID of the in-doubt transaction to commit.">Manually Overriding In-Doubt Transactions</a>&#34;</span></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<a id="ADMIN12238"></a>
<div class="props_rev_3"><a id="GUID-97643C4A-6FB3-4B0B-8C0C-E44CDB560508"></a>
<h3 id="ADMIN-GUID-97643C4A-6FB3-4B0B-8C0C-E44CDB560508" class="sect3"><span class="enumeration_section">34.4.4</span> Relevance of System Change Numbers for In-Doubt Transactions</h3>
<div>
<p>A <span class="bold">system change number</span> (SCN) is an internal timestamp for a committed version of the database. The Oracle Database server uses the SCN clock value to guarantee transaction consistency.</p>
<p>For example, when a user commits a transaction, the database records an SCN for this commit in the redo log.</p>
<p>The database uses SCNs to coordinate distributed transactions among different databases. For example, the database uses SCNs in the following way:</p>
<ol>
<li>
<p>An application establishes a connection using a database link.</p>
</li>
<li>
<p>The distributed transaction commits with the highest global SCN among all the databases involved.</p>
</li>
<li>
<p>The commit global SCN is sent to all databases involved in the transaction.</p>
</li>
</ol>
<p>SCNs are important for distributed transactions because they function as a synchronized commit timestamp of a transaction, even if the transaction fails. If a transaction becomes in-doubt, an administrator can use this SCN to coordinate changes made to the global database. The global SCN for the transaction commit can also be used to identify the transaction later, for example, in distributed recovery.</p>
</div>
</div>
</div>
<div class="sect2"><a id="GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF"></a>
<h2 id="ADMIN-GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" class="sect2"><span class="enumeration_section">34.5</span> Distributed Transaction Processing: Case Study</h2>
<p>A case study illustrates distributed transaction processing.</p>
<a id="ADMIN12239"></a>
<div class="props_rev_3"><a id="GUID-EC814CDE-5481-4FA7-A9F4-2FCFDD3535AA"></a>
<h3 id="ADMIN-GUID-EC814CDE-5481-4FA7-A9F4-2FCFDD3535AA" class="sect3"><span class="enumeration_section">34.5.1</span> About the Distributed Transaction Processing Case Study</h3>
<div>
<p>In this scenario, a company has separate Oracle Database servers, <code class="codeph">sales.example.com</code> and <code class="codeph">warehouse.example.com</code>. As users insert sales records into the <code class="codeph">sales</code> database, associated records are being updated at the <code class="codeph">warehouse</code> database.</p>
<p>This case study of distributed processing illustrates:</p>
<ul style="list-style-type: disc;">
<li>
<p>The definition of a session tree</p>
</li>
<li>
<p>How a commit point site is determined</p>
</li>
<li>
<p>When prepare messages are sent</p>
</li>
<li>
<p>When a transaction actually commits</p>
</li>
<li>
<p>What information is stored locally about the transaction</p>
</li>
</ul>
</div>
</div>
<a id="ADMIN13149"></a><a id="ADMIN12240"></a>
<div class="props_rev_3"><a id="GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0"></a>
<h3 id="ADMIN-GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0" class="sect3"><span class="enumeration_section">34.5.2</span> Stage 1: Client Application Issues DML Statements</h3>
<div>
<p>An example illustrates the first stage in distributed transaction processing.</p>
<p>At the Sales department, a salesperson uses SQL*Plus to enter a sales order and then commit it. The application issues several SQL statements to enter the order into the <code class="codeph">sales</code> database and update the inventory in the <code class="codeph">warehouse</code> database:</p>
<pre dir="ltr">CONNECT scott@sales.example.com ...;
INSERT INTO orders ...;
UPDATE inventory@warehouse.example.com ...;
INSERT INTO orders ...;
UPDATE inventory@warehouse.example.com ...;
COMMIT;
</pre>
<p>These SQL statements are part of a single distributed transaction, guaranteeing that all issued SQL statements succeed or fail as a unit. Treating the statements as a unit prevents the possibility of an order being placed and then inventory not being updated to reflect the order. In effect, the transaction guarantees the consistency of data in the global database.</p>
<p>As each of the SQL statements in the transaction executes, the session tree is defined, as shown in <a href="ds_txns.htm#GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0__CHDJICHD">Figure 34-7</a>.</p>
<div class="figure" id="GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0__CHDJICHD">
<p class="titleinfigure">Figure 34-7 Defining the Session Tree</p>
<img width="660" height="350" src="img/GUID-69375ECE-AD12-401B-BF14-E52A0220BCBB-default.png" alt="Description of Figure 34-7 follows" title="Description of Figure 34-7 follows"/><br/>
<a href="img_text/GUID-69375ECE-AD12-401B-BF14-E52A0220BCBB-print.htm">Description of &#34;Figure 34-7 Defining the Session Tree&#34;</a></div>
<!-- class="figure" -->
<p>Note the following aspects of the transaction:</p>
<ul style="list-style-type: disc;">
<li>
<p>An order entry application running on the <code class="codeph">sales</code> database initiates the transaction. Therefore, <code class="codeph">sales.example.com</code> is the global coordinator for the distributed transaction.</p>
</li>
<li>
<p>The order entry application inserts a new sales record into the <code class="codeph">sales</code> database and updates the inventory at the warehouse. Therefore, the nodes <code class="codeph">sales.example.com</code> and <code class="codeph">warehouse.example.com</code> are both database servers.</p>
</li>
<li>
<p>Because <code class="codeph">sales.example.com</code> updates the inventory, it is a client of <code class="codeph">warehouse.example.com</code>.</p>
</li>
</ul>
<p>This stage completes the definition of the session tree for this distributed transaction. Each node in the tree has acquired the necessary data locks to execute the SQL statements that reference local data. These locks remain even after the SQL statements have been executed until the two-phase commit is completed.</p>
</div>
</div>
<a id="ADMIN13150"></a><a id="ADMIN12241"></a>
<div class="props_rev_3"><a id="GUID-8041782B-495C-4D10-8297-E3A79C756CA6"></a>
<h3 id="ADMIN-GUID-8041782B-495C-4D10-8297-E3A79C756CA6" class="sect3"><span class="enumeration_section">34.5.3</span> Stage 2: Oracle Database Determines Commit Point Site</h3>
<div>
<p>An example illustrates the second stage in distributed transaction processing.</p>
<p>The database determines the commit point site immediately following the <code class="codeph">COMMIT</code> statement. <code class="codeph">sales.example.com</code>, the global coordinator, is determined to be the commit point site, as shown in <a href="ds_txns.htm#GUID-8041782B-495C-4D10-8297-E3A79C756CA6__i1008181">Figure 34-8</a>.</p>
<div class="infoboxnotealso" id="GUID-8041782B-495C-4D10-8297-E3A79C756CA6__GUID-BF0CE623-A2A3-4333-B5C1-AF21741174E1">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="ds_txns.htm#GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035" title="Every database server must be assigned a commit point strength. If a database server is referenced in a distributed transaction, the value of its commit point strength determines which role it plays in the two-phase commit.">Commit Point Strength</a>&#34;</span> for more information about how the commit point site is determined</p>
</div>
<div class="figure" id="GUID-8041782B-495C-4D10-8297-E3A79C756CA6__i1008181">
<p class="titleinfigure">Figure 34-8 Determining the Commit Point Site</p>
<img width="497" height="222" src="img/GUID-064FE90A-25FE-44A4-A73A-680E8DCBBBBA-default.png" alt="Description of Figure 34-8 follows" title="Description of Figure 34-8 follows"/><br/>
<a href="img_text/GUID-064FE90A-25FE-44A4-A73A-680E8DCBBBBA-print.htm">Description of &#34;Figure 34-8 Determining the Commit Point Site&#34;</a></div>
<!-- class="figure" --></div>
</div>
<a id="ADMIN13151"></a><a id="ADMIN12242"></a>
<div class="props_rev_3"><a id="GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64"></a>
<h3 id="ADMIN-GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64" class="sect3"><span class="enumeration_section">34.5.4</span> Stage 3: Global Coordinator Sends Prepare Response</h3>
<div>
<p>An example illustrates the third stage in distributed transaction processing.</p>
<p>The prepare stage involves the following steps:</p>
<ol>
<li>
<p>After the database determines the commit point site, the global coordinator sends the prepare message to all directly referenced nodes of the session tree, <span class="italic">excluding</span> the commit point site. In this example, <code class="codeph">warehouse.example.com</code> is the only node asked to prepare.</p>
</li>
<li>
<p>Node <code class="codeph">warehouse.example.com</code> tries to prepare. If a node can guarantee that it can commit the locally dependent part of the transaction and can record the commit information in its local redo log, then the node can successfully prepare. In this example, only <code class="codeph">warehouse.example.com</code> receives a prepare message because <code class="codeph">sales.example.com</code> is the commit point site.</p>
</li>
<li>
<p>Node <code class="codeph">warehouse.example.com</code> responds to <code class="codeph">sales.example.com</code> with a prepared message.</p>
</li>
</ol>
<p>As each node prepares, it sends a message back to the node that asked it to prepare. Depending on the responses, one of the following can happen:</p>
<ul style="list-style-type: disc;">
<li>
<p>If <span class="italic">any</span> of the nodes asked to prepare responds with an abort message to the global coordinator, then the global coordinator tells all nodes to roll back the transaction, and the operation is completed.</p>
</li>
<li>
<p>If <span class="italic">all</span> nodes asked to prepare respond with a prepared or a read-only message to the global coordinator, that is, they have successfully prepared, then the global coordinator asks the commit point site to commit the transaction.</p>
</li>
</ul>
<div class="figure" id="GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64__GUID-FE73F862-33F9-4072-94EA-58A4C646B750">
<p class="titleinfigure">Figure 34-9 Sending and Acknowledging the Prepare Message</p>
<img width="497" height="275" src="img/GUID-3E892E15-20D0-46ED-9B28-0BBE65FD1CDB-default.png" alt="Description of Figure 34-9 follows" title="Description of Figure 34-9 follows"/><br/>
<a href="img_text/GUID-3E892E15-20D0-46ED-9B28-0BBE65FD1CDB-print.htm">Description of &#34;Figure 34-9 Sending and Acknowledging the Prepare Message&#34;</a></div>
<!-- class="figure" --></div>
</div>
<a id="ADMIN12243"></a>
<div class="props_rev_3"><a id="GUID-9B71148F-3E08-4C0F-9EA5-DD9CCCE044A0"></a>
<h3 id="ADMIN-GUID-9B71148F-3E08-4C0F-9EA5-DD9CCCE044A0" class="sect3"><span class="enumeration_section">34.5.5</span> Stage 4: Commit Point Site Commits</h3>
<div>
<p>An example illustrates the fourth stage in distributed transaction processing.</p>
<p>The committing of the transaction by the commit point site involves the following steps:</p>
<ol>
<li>
<p>Node <code class="codeph">sales.example.com</code>, receiving acknowledgment that <code class="codeph">warehouse.example.com</code> is prepared, instructs the commit point site to commit the transaction.</p>
</li>
<li>
<p>The commit point site now commits the transaction locally and records this fact in its local redo log.</p>
</li>
</ol>
<p>Even if <code class="codeph">warehouse.example.com</code> has not yet committed, the outcome of this transaction is predetermined. In other words, the transaction <span class="italic">will</span> be committed at all nodes even if the ability of a given node to commit is delayed.</p>
</div>
</div>
<a id="ADMIN12244"></a>
<div class="props_rev_3"><a id="GUID-086BF245-5E2D-4612-8109-9E2206CA4234"></a>
<h3 id="ADMIN-GUID-086BF245-5E2D-4612-8109-9E2206CA4234" class="sect3"><span class="enumeration_section">34.5.6</span> Stage 5: Commit Point Site Informs Global Coordinator of Commit</h3>
<div>
<p>An example illustrates the fifth stage in distributed transaction processing.</p>
<p>This stage involves the following steps:</p>
<ol>
<li>
<p>The commit point site tells the global coordinator that the transaction has committed. Because the commit point site and global coordinator are the same node in this example, no operation is required. The commit point site knows that the transaction is committed because it recorded this fact in its online log.</p>
</li>
<li>
<p>The global coordinator confirms that the transaction has been committed on all other nodes involved in the distributed transaction.</p>
</li>
</ol>
</div>
</div>
<a id="ADMIN13152"></a><a id="ADMIN12245"></a>
<div class="props_rev_3"><a id="GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB"></a>
<h3 id="ADMIN-GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB" class="sect3"><span class="enumeration_section">34.5.7</span> Stage 6: Global and Local Coordinators Tell All Nodes to Commit</h3>
<div>
<p>An example illustrates the sixth stage in distributed transaction processing.</p>
<p>The committing of the transaction by all the nodes in the transaction involves the following steps:</p>
<ol>
<li>
<p>After the global coordinator has been informed of the commit at the commit point site, it tells all other directly referenced nodes to commit.</p>
</li>
<li>
<p>In turn, any local coordinators instruct their servers to commit, and so on.</p>
</li>
<li>
<p>Each node, including the global coordinator, commits the transaction and records appropriate redo log entries locally. As each node commits, the resource locks that were being held locally for that transaction are released.</p>
</li>
</ol>
<p>In <a href="ds_txns.htm#GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB__i1008221">Figure 34-10</a>, <code class="codeph">sales.example.com</code>, which is both the commit point site and the global coordinator, has already committed the transaction locally. <code class="codeph">sales</code> now instructs <code class="codeph">warehouse.example.com</code> to commit the transaction.</p>
<div class="figure" id="GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB__i1008221">
<p class="titleinfigure">Figure 34-10 Instructing Nodes to Commit</p>
<img width="495" height="278" src="img/GUID-C6E9D296-7D59-4F00-AB48-46907D43CFB5-default.png" alt="Description of Figure 34-10 follows" title="Description of Figure 34-10 follows"/><br/>
<a href="img_text/GUID-C6E9D296-7D59-4F00-AB48-46907D43CFB5-print.htm">Description of &#34;Figure 34-10 Instructing Nodes to Commit&#34;</a></div>
<!-- class="figure" --></div>
</div>
<a id="ADMIN12246"></a>
<div class="props_rev_3"><a id="GUID-6C7CD670-9137-4430-AE9C-772EDF773BC6"></a>
<h3 id="ADMIN-GUID-6C7CD670-9137-4430-AE9C-772EDF773BC6" class="sect3"><span class="enumeration_section">34.5.8</span> Stage 7: Global Coordinator and Commit Point Site Complete the Commit</h3>
<div>
<p>An example illustrates the seventh stage in distributed transaction processing.</p>
<p>The completion of the commit of the transaction occurs in the following steps:</p>
<ol>
<li>
<p>After all referenced nodes and the global coordinator have committed the transaction, the global coordinator informs the commit point site of this fact.</p>
</li>
<li>
<p>The commit point site, which has been waiting for this message, erases the status information about this distributed transaction.</p>
</li>
<li>
<p>The commit point site informs the global coordinator that it is finished. In other words, the commit point site forgets about committing the distributed transaction. This action is permissible because all nodes involved in the two-phase commit have committed the transaction successfully, so they will never have to determine its status in the future.</p>
</li>
<li>
<p>The global coordinator finalizes the transaction by forgetting about the transaction itself.</p>
</li>
</ol>
<p>After the completion of the <code class="codeph">COMMIT</code> phase, the distributed transaction is itself complete. The steps described are accomplished automatically and in a fraction of a second.</p>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1842">
<tr>
<td class="cellalignment1854">
<table class="cellalignment1847">
<tr>
<td class="cellalignment1846"><a href="ds_appdev.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment1846"><a href="ds_txnman.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1856">
<table class="cellalignment1845">
<tr>
<td class="cellalignment1846"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment1846"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment1846"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment1846"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment1846"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment1846"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>