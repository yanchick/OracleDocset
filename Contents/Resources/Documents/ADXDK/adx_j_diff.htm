<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-1656"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Determining%20XML%20Differences%20Using%20Java"></a><title>Determining XML Differences Using Java</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="Java XML diffing library, oracle.xml.diff package, XML diffing methods, Java, XML hash methods, XML equal methods, text node normalization, XML namespace prefixes, ignoring differences, XML input documents, comparing and contrasting, Java diff operations, append-node, insert-node-before, delete-node, examples, Java diff output schema, xdiff.xsd"/>
<meta name="dcterms.created" content="2016-12-08T13:58:19Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="XML Developer&#39;s Kit Programmer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E54405-06"/>
<meta name="dcterms.isVersionOf" content="ADXDK"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="adx_j_pipeline.htm" title="Previous" type="text/html"/>
<link rel="Next" href="adx_j_xsu.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E54405-06.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-BA951010-1085-4715-89F0-1F2312C4AA4A"></a> <span id="PAGE" style="display:none;">20/50</span> <!-- End Header -->
<a id="ADXDK1005"></a><a id="ADXDK199"></a>
<h1 id="ADXDK-GUID-BA951010-1085-4715-89F0-1F2312C4AA4A" class="sect1"><span class="enumeration_chapter">12</span> Determining XML Differences Using Java</h1>
<div>
<p>This chapter explains how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer&#39;s Kit (XDK).</p>
<div class="section">
<p class="subhead1">Topics:</p>
</div>
<!-- class="section" -->
<ul style="list-style-type: disc;">
<li>
<p><a href="adx_j_diff.htm#GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C">Overview of XML Diffing Utilities for Java</a></p>
</li>
<li>
<p><a href="adx_j_diff.htm#GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC">User Options for the Java XML Diffing Library</a></p>
</li>
<li>
<p><a href="adx_j_diff.htm#GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94">Using Java XML Diffing Methods to Find Differences</a></p>
</li>
<li>
<p><a href="adx_j_diff.htm#GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0">Invoking diff and difftoDoc Methods in a Java Application</a></p>
</li>
<li>
<p><a href="adx_j_diff.htm#GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44">Using Java XML hash and equal Methods to Identify and Compare Inputs</a></p>
</li>
<li>
<p><a href="adx_j_diff.htm#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3">Diff Output Schema</a></p>
</li>
</ul>
</div>
<a id="ADXDK128"></a>
<div class="props_rev_3"><a id="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C"></a>
<h2 id="ADXDK-GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C" class="sect2"><span class="enumeration_section">12.1</span> Overview of XML Diffing Utilities for Java</h2>
<div>
<p>The Java XML diffing library includes diffing, hashing, and equality comparison methods for XML inputs in the <code>XmlUtils</code> class of the <code>oracle.xml.diff</code> package. The <code>Options</code> class in the <code>oracle.xml.diff</code> package provides options that enable users to control how the input is processed by the methods in the <code>XmlUtils</code> class (see <a href="adx_j_diff.htm#GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC">User Options for the Java XML Diffing Library</a>). One of these supported options is white space normalization, which is enabled by default.</p>
<p>The algorithm used by the XML diffing methods is specifically designed for the use case of finding differences between two large XML documents (5 MB or more) within seconds, where the minimal diff is not required. The minimal diff is the smallest possible set of changes which, when applied to the first XML input, produces an output equivalent (identical) to the second XML input. Known minimal diff algorithms require prohibitively large amounts of memory and time for processing multimegabyte inputs. The algorithm used in the XML diff methods produces best quality (as close to minimal as possible) diffs in the absence of recurring identical subtrees in the XML inputs.</p>
<p>The Java XML diffing library provides several equivalent variants of each method to allow XML inputs in different forms, including Document Object Model (DOM) nodes, files, and input streams. Internally, the diffing, hashing, and equality comparisons operate on a DOM tree. Input that is not in the form of a DOM tree is internally converted to a DOM tree. To reduce computational overhead, Oracle recommends passing in DOM directly whenever possible.</p>
<p>The Java XML diffing library includes methods to return the diff output as a DOM document, or as a list of objects, each representing a diff operation. With the second option, you can avoid the overhead of XML document generation. With the first option, the resulting document conforms to the XML schema described in <a href="adx_j_diff.htm#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3">Diff Output Schema</a>. The first option is useful, for example, if the diff output must be stored as a log for future reference.</p>
<p>The hash methods provided by the Java XML diffing library compute the hash value of XML input. If the hash values of the two XML inputs are equal, they are identical with a very high probability.</p>
<p>The equal methods provided in the Java XML diffing library compare two inputs for equality.</p>
<p>To use the Java XML diffing library, your application must run with Java version 1.6 or later, with any DOM implementation.</p>
<div class="infobox-note" id="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C__GUID-0943AF26-DB52-4EB3-A960-24197461333F">
<p class="notep1">Note:</p>
<p>The application programming interface (API) components described in this chapter are contained within the Java package <code>oracle.xml.diff</code>. For brevity, fully qualified names are used only when necessary to avoid confusion.</p>
<p>See <a class="olink JAXML" target="_blank" href="../JAXML/toc.htm"><span class="italic">Oracle Database XML Java API Reference</span></a> for more information about the <code>oracle.xml.diff</code> package.</p>
</div>
</div>
</div>
<a id="ADXDK129"></a>
<div class="props_rev_3"><a id="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC"></a>
<h2 id="ADXDK-GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC" class="sect2"><span class="enumeration_section">12.2</span> User Options for the Java XML Diffing Library</h2>
<div>
<p>The Java XML diffing library supports two options, which you can set using methods in the <code>Options</code> class of the <code>oracle.xml.diff</code> package. The <code>Options</code> object is passed in directly to the diff, hash, and equal methods on each invocation.</p>
<ul style="list-style-type: disc;">
<li>
<p>Text Node Normalization (enabled by default)</p>
<p>Text nodes are normalized in the DOM trees on which the diff, hash, and equal methods operate. Text node normalization involves coalescing adjacent text nodes, followed by stripping leading and trailing white space from the coalesced nodes. Single text nodes have their leading and trailing white space stripped. White-space-only text nodes are eliminated.</p>
<p>Normalization is performed within the library with minimal additional space, and without modifying the provided XML inputs.</p>
<p>To perform your own normalization on the DOM inputs before passing them to the library, you must invoke the method <code>normalizeTextNodes(false)</code> on the <code>Options</code> object to turn off the default normalization.</p>
<p>Oracle does not recommend invoking the diff methods without performing some type of normalization, either the default or your own. The diff quality suffers in the presence of identical white space text nodes, which commonly occur in XML documents.</p>
</li>
<li>
<p>Ignoring Namespace Prefix Differences (enabled by default)</p>
<p>XML namespace prefix differences are ignored by the diff, hash, and equal methods. For example, two DOM nodes are considered equal if they are identical except for having different prefixes (even if the two different prefixes map to Universal Resource Identifier (URI) of the same namespace. To configure the library to treat different namespace prefixes as truly different, even if they map to the same URI, you can invoke the method <code>ignorePrefixDifferences(false)</code> on the <code>Options</code> object to turn off the default namespace prefix behavior.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC__GUID-20627278-C69D-40B9-AB45-405F3EB664CC">
<p class="notep1">See Also:</p>
<p><a class="olink JAXML" target="_blank" href="../JAXML/toc.htm"><span class="italic">Oracle Database XML Java API Reference</span></a> for details about the methods in the <code>Options</code> class</p>
</div>
</div>
</div>
<a id="ADXDK1006"></a><a id="ADXDK130"></a>
<div class="props_rev_3"><a id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94"></a>
<h2 id="ADXDK-GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94" class="sect2"><span class="enumeration_section">12.3</span> Using Java XML Diffing Methods to Find Differences</h2>
<div>
<p>The Java XML dffing library provides various <code>diff</code> and <code>diffToDoc</code> methods in the <code>XmlUtils</code> class of the <code>oracle.xml.diff</code> package. You can use these methods to compare two XML inputs to determine if there are any differences between them.</p>
<p>The <code>diffToDoc</code> methods return the output as a DOM document that conforms to the schema described in <a href="adx_j_diff.htm#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3">Diff Output Schema</a>. The Java XML diffing library includes several equivalent variants of these methods, which accept inputs in different forms (DOM nodes, files, and others).</p>
<p>The Java XML diffing library includes an equivalent set of <code>diff</code> methods that enable you to work on the diff output that is returned as a list of diff operation objects.</p>
<p>Because the DOM document that represents the diff does not need to be constructed, using the <code>diff</code> methods is more efficient than using the <code>difftoDoc</code> methods. You should consider using these methods whenever you do not need a representation of the diff in XML form. To use the <code>diff</code> methods, you must create an implementation of the <code>DiffOpReceiver</code> interface, and then pass it as a parameter to the <code>diff</code> methods. The <code>DiffOpReceiver.receiveDiff</code> method receives the diff as a list of <code>DiffOp</code> objects.</p>
<p>The diff result, whether it is returned as a DOM document or as a list of <code>DiffOps</code> objects, can be understood as a series of diff operations. The possible diff operations are:</p>
<ul style="list-style-type: disc;">
<li>
<p>append-node</p>
</li>
<li>
<p>insert-node-before</p>
</li>
<li>
<p>delete-node</p>
</li>
</ul>
<p>Applying the sequence of diff operations on the first DOM tree produces a tree that is equivalent to the second DOM tree. For example, using these two XML inputs:</p>
<p>First input: <code>&lt;a&gt;&lt;b/&gt;&lt;/a&gt;</code></p>
<p>Second input: <code>&lt;a&gt;&lt;c/&gt;&lt;/a&gt;</code></p>
<p>The diff result from comparing the first and second input is a list, with these two diff operations:</p>
<pre dir="ltr">delete-node /a[1]/b[1]
append-node &lt;c/&gt; to /a[1]
</pre>
<p>Deleting the node represented by the XPath expression <code>/a/b</code> in the first input, and then appending <code>&lt;c/&gt;</code> to the node represented by the XPath expression <code>/a</code> in the first input produces the result <code>&lt;a&gt;&lt;c/&gt;&lt;/a&gt;</code>, which is equivalent to the second input.</p>
<p>When the diff operations are output to a DOM document by the <code>domToDoc(&hellip;)</code> method, they rely on XPath expressions to indicate the node locations. These XPath locations refer to node positions in the original first input. They do not reflect the applied diff operations.</p>
<div class="infobox-note" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-0426B707-A522-421F-ACD9-E2E963666982">
<p class="notep1">Note:</p>
<p>The Java XML diffing library does not support append-node, insert-node-before, and delete-node operations for attribute nodes. Thus, when any attributes of a node are changed, the change is shown as a delete of the whole node, followed by the insert or the append of the new node with the changed attributes.</p>
<p>For example, for these two inputs:</p>
<p>First input: <code>&lt;a attr1=&#34;val1&#34;&gt;&lt;b/&gt;&lt;/a&gt;</code></p>
<p>Second input: <code>&lt;a attr2=&#34;val2&#34;&gt;&lt;b/&lt;/a&gt;</code></p>
<p>The diff consists of these two diff operations:</p>
<pre dir="ltr">insert &lt;a attr2=&#34;val2&#34;&gt;&lt;b/&gt;&lt;/a&gt; before /a[1]
delete /a[1]
</pre></div>
<div class="section">
<p class="subhead2">Topics:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><a href="adx_j_diff.htm#GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C">About the append-node Operation</a></p>
</li>
<li>
<p><a href="adx_j_diff.htm#GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6">About the insert-node-before Operation</a></p>
</li>
<li>
<p><a href="adx_j_diff.htm#GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B">About the delete-node Operation</a></p>
</li>
</ul>
<div class="infobox-note" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-6D59B4CF-C68E-4922-9056-5BC104A7FCB6">
<p class="notep1">Note:</p>
<p>This section uses XML document output to describe each diff operation. Although they are not described here, diff operation results that are returned programmatically are equivalent.</p>
</div>
<div class="infoboxnotealso" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-C00159F4-0834-44FC-B78D-3B96990ED441">
<p class="notep1">See Also:</p>
<p><a class="olink JAXML" target="_blank" href="../JAXML/toc.htm"><span class="italic">Oracle Database XML Java API Reference</span></a> for more information about the <code>DiffOpReceiver</code> interface, and for details about the methods in the <code>XmlUtils</code> class</p>
</div>
</div>
<!-- class="section" --></div>
<a id="ADXDK138"></a><a id="ADXDK131"></a>
<div class="props_rev_3"><a id="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C"></a>
<h3 id="ADXDK-GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C" class="sect3"><span class="enumeration_section">12.3.1</span> About the append-node Operation</h3>
<div>
<p>The append-node operation specifies that a given node is to be appended as the last child of a particular first input node. <a href="adx_j_diff.htm#GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">Example 12-1</a> shows an append-node operation that adds the highlighted node <code>&lt;enumeration value=&#34;FL&#34;/&gt;</code> to a document.</p>
<p>Invoking a <code>diffToDoc(&hellip;)</code> method, using the original document (without the highlighted change) and the changed document as input produces this output:</p>
<pre dir="ltr">&lt;xd:append-node
 xd:parent-xpath=&#34;/schema[1]/simpleType[1]/restriction[1]&#34;
 xd:node-type=&#34;element&#34;&gt; 
         &lt;xd:content&gt; 
             &lt;enumeration value=&#34;FL&#34;/&gt; 
         &lt;/xd:content&gt; 
&lt;/xd:append-node&gt;
</pre>
<p>The append-node operation is represented by the <code>&lt;append-node&gt;</code> element in the preceding output. This element specifies that a node of the given type is added as the last child of the given first input parent node. The <code>parent-xpath</code> attribute specifies the parent node. The <code>node-type</code> attribute specifies the type of the node to be appended. The <code>&lt;content&gt;</code> child element specifies the node to be appended.</p>
<p>Alternatively, when the <code>diff(&hellip;)</code> methods are used, the append-node operation is accessible in the <code>DiffOpReceiver.receiverDiff(&hellip;)</code> method as a <code>DiffOp</code> object. In this case, the operation returns the actual references to the nodes in the two DOM trees involved in the diff operation. The reference to the parent node in the first input is returned by invoking the <code>getParent()</code> method of <code>DiffOp</code>. The reference to the node to be appended from the second input is returned by invoking the <code>getNew()</code> method of <code>DiffOp</code>.</p>
<div class="example" id="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">
<p class="titleinexample">Example 12-1 Appending a Node</p>
<pre dir="ltr">&lt;schema&gt;
&hellip;
     &lt;simpleType name=&#34;USState&#34;&gt; 
          &lt;restriction base=&#34;string&#34;&gt; 
               &lt;enumeration value=&#34;NY&#34;/&gt; 
               &lt;enumeration value=&#34;TX&#34;/&gt; 
               &lt;enumeration value=&#34;CA&#34;/&gt;
               <span class="bold">&lt;enumeration value=&#34;FL&#34;/&gt;</span>
          &lt;/restriction&gt; 
     &lt;/simpleType&gt;  
&hellip;
&lt;/schema&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK140"></a><a id="ADXDK139"></a>
<div class="props_rev_3"><a id="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6"></a>
<h3 id="ADXDK-GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6" class="sect3"><span class="enumeration_section">12.3.2</span> About the insert-node-before Operation</h3>
<div>
<p>The insert-node-before operation specifies that a given node is to be inserted before a particular node in the first input. <a href="adx_j_diff.htm#GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6__BABGGHJD">Example 12-2</a> shows an insert-node-before operation that inserts the highlighted node <code>&lt;!-- A type representing US States --&gt;</code> before the node <code>&lt;simpleType name=&#34;USState&#34;&gt;</code> in a document.</p>
<p>Invoking a <code>diffToDoc(&hellip;)</code> method, using the original document (without the highlighted change) and the changed document as input produces this output:</p>
<pre dir="ltr">&lt;xd:insert-node-before xd:node-type=&#34;comment&#34; 
 xd:xpath=&#34;/schema[1]/simpleType[1]&#34;&gt;
           &lt;xd:content&gt;
                   &lt;!-- A type representing US States --&gt;
           &lt;/xd:content&gt;
&lt;/xd:insert-node-before&gt;
</pre>
<p>The insert-node-before operation is represented by the <code>&lt;insert-node-before&gt;</code> element in the preceding output. This element specifies that a node of the given type is inserted before the given first input node. The <code>xpath</code> attribute specifies the location of the first input node. The <code>node-type</code> attribute specifies the type of the node to be inserted. The <code>&lt;content&gt;</code> child element specifies the node to be inserted.</p>
<p>Alternatively, when the <code>diff(&hellip;)</code> methods are used, the insert-node-before operation is accessible in the <code>DiffOpReceiver.receiverDiff(&hellip;)</code> method as a <code>DiffOp</code> object. In this case, the operation returns the actual references to the nodes in the two DOM trees involved in the diff operation. The reference to the node before which to insert a node in the first input is returned by invoking the <code>getSibling()</code> method of <code>DiffOp</code>. The reference to the node to be inserted from the second input is returned by invoking the <code>getNew()</code> method of <code>DiffOp</code>.</p>
<div class="example" id="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6__BABGGHJD">
<p class="titleinexample">Example 12-2 Inserting a Node</p>
<pre dir="ltr">&lt;schema&gt;
&hellip;
    <span class="bold">&lt;!-- A type representing US States --&gt;</span>   
    &lt;simpleType name=&#34;USState&#34;&gt; 
            &lt;restriction base=&#34;string&#34;&gt; 
                &lt;enumeration value=&#34;NY&#34;/&gt; 
                &lt;enumeration value=&#34;TX&#34;/&gt; 
                &lt;enumeration value=&#34;CA&#34;/&gt; 
            &lt;/restriction&gt; 
    &lt;/simpleType&gt;
&hellip;
&lt;/schema&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK197"></a><a id="ADXDK141"></a>
<div class="props_rev_3"><a id="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B"></a>
<h3 id="ADXDK-GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B" class="sect3"><span class="enumeration_section">12.3.3</span> About the delete-node Operation</h3>
<div>
<p>The delete-node operation specifies that a particular node (and its subtree) in the first input is to be deleted. <a href="adx_j_diff.htm#GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B__BABJAAAJ">Example 12-3</a> shows a delete-node operation that deletes the highlighted node <code>&lt;element name=&#34;LineItems&#34; maxOccurs=&#34;unbounded&#34;&gt;</code> from a document.</p>
<p>Invoking a diffToDoc(&hellip;) method, using the original document (without the highlighted change) and the changed document as input produces this output:</p>
<pre dir="ltr">&lt;xd:delete-node xd:node-type=&#34;element&#34; xd:xpath=
 &#34;/schema[1]/element[1]/complexType[1]/sequence[1]/element[1]/element[1]&#34;/&gt;
</pre>
<p>The delete-node operation is represented by the <code>&lt;delete-node&gt;</code> element in the preceding output. This element specifies that a node of the given type is deleted. The <code>xpath</code> attribute specifies the location of the first input node. The <code>node-type</code> attribute specifies the type of the node to be deleted.</p>
<p>Alternatively, when the <code>diff(&hellip;)</code> methods are used, the delete-node operation is accessible in the <code>DiffOpReceiver.receiverDiff(&hellip;)</code> method as a <code>DiffOp</code> object. In this case, the operation returns the actual reference to the node in the first input DOM tree. The reference to the node to be deleted from the first input is returned by invoking <code>getCurrent()</code> method of <code>DiffOp</code>.</p>
<div class="example" id="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B__BABJAAAJ">
<p class="titleinexample">Example 12-3 Deleting a Node</p>
<pre dir="ltr">&lt;schema&gt;
&hellip;
     &lt;element name=&#34;PurchaseOrder&#34;&gt; 
        &lt;complexType&gt; 
           &lt;sequence&gt; 
              &lt;element name=&#34;PO-Number&#34; type=&#34;string&#34;&gt; 
                 <span class="bold">&lt;element name=&#34;LineItems&#34; maxOccurs=&#34;unbounded&#34;&gt;</span>
&hellip;
&lt;/schema&gt;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADXDK200"></a><a id="ADXDK203"></a><a id="ADXDK198"></a>
<div class="props_rev_3"><a id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0"></a>
<h2 id="ADXDK-GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0" class="sect2"><span class="enumeration_section">12.4</span> Invoking diff and difftoDoc Methods in a Java Application</h2>
<div>
<div class="section">
<p>The examples in this section show how to perform a diff between two inputs by invoking <code>diff</code> and <code>diffToDoc</code> methods from a Java application.</p>
<p><a href="adx_j_diff.htm#GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABHAGEF">Example 12-4</a> shows how to use the <code>diffToDoc</code> method to compare the input files <code>doc</code> and <code>doc1</code>.</p>
<p>Continuing with this example, the two input files <code>f1.xml</code> and <code>f2.xml</code> contain the same data as in <a href="adx_j_diff.htm#GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">Example 12-1</a>.</p>
<p>This sample code displays the contents of <code>f1.xml</code>:</p>
<pre dir="ltr">&lt;schema&gt;
     &lt;simpleType name=&#34;USState&#34;&gt;
          &lt;restriction base=&#34;string&#34;&gt;
               &lt;enumeration value=&#34;NY&#34;/&gt;
               &lt;enumeration value=&#34;TX&#34;/&gt;
               &lt;enumeration value=&#34;CA&#34;/&gt;
          &lt;/restriction&gt;
     &lt;/simpleType&gt;
&lt;/schema&gt;
</pre>
<p>And this sample code displays the contents of <code>f2.xml</code>:</p>
<pre dir="ltr">&lt;schema&gt;
     &lt;simpleType name=&#34;USState&#34;&gt;
          &lt;restriction base=&#34;string&#34;&gt;
               &lt;enumeration value=&#34;NY&#34;/&gt;
               &lt;enumeration value=&#34;TX&#34;/&gt;
               &lt;enumeration value=&#34;CA&#34;/&gt;
               &lt;enumeration value=&#34;FL&#34;/&gt;
          &lt;/restriction&gt;
     &lt;/simpleType&gt;
&lt;/schema&gt;
</pre>
<p>Assume that <code>textDiff.java</code> and the input files are in the current directory. Then enter these commands to compile and run the example:</p>
<pre dir="ltr">javac -classpath &#34;xml.jar&#34; textDiff.java
java &ndash;classpath &ldquo;xml.jar:.&#34; textDiff f1.xml f2.xml
</pre>
<p>Serializing the resulting <code>diffAsDom</code> document produces this output:</p>
<pre dir="ltr">&lt;xd:xdiff xmlns:xd=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd&#34;
    xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd http://xmlns.oracle.com/xdb/xdiff.xsd&#34;&gt;
    &lt;?oracle-xmldiff operations-in-docorder=&#34;true&#34;
     output-model=&#34;snapshot&#34; diff-algorithm=&#34;greedy-heuristic&#34;?&gt;
    &lt;xd:append-node xd:node-type=&#34;element&#34; 
     xd:parent-xpath=&#34;/schema[1]/simpleType[1]/restriction[1]&#34;&gt;
        &lt;xd:content&gt;
            &lt;enumeration value=&#34;FL&#34;/&gt;
        &lt;/xd:content&gt;
    &lt;/xd:append-node&gt;
&lt;/xd:xdiff&gt;
</pre>
<p><a href="adx_j_diff.htm#GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABIEBAA">Example 12-5</a> shows how to use an implementation of the <code>DiffOpReceiver</code> interface to process the diff returned from the comparison between two XML inputs as a list of <code>DiffOp</code> objects.</p>
<p>Enter these commands to compile and run the example:</p>
<pre dir="ltr">javac -classpath &#34;xml.jar&#34; progDiff.java
java &ndash;classpath &ldquo;xml.jar:.&#34; progDiff f1.xml f2.xml
</pre>
<p>The example generates this output:</p>
<pre dir="ltr">APPENDING NODE:
&lt;enumeration value=&#34;FL&#34;/&gt;
TO THE PARENT NODE:
&lt;restriction base=&#34;string&#34;&gt;
    &lt;enumeration value=&#34;NY&#34;/&gt;
    &lt;enumeration value=&#34;TX&#34;/&gt;
    &lt;enumeration value=&#34;CA&#34;/&gt;
&lt;/restriction&gt;
</pre></div>
<!-- class="section" -->
<div class="example" id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABHAGEF">
<p class="titleinexample">Example 12-4 Getting a diff as a Document from a Java Application</p>
<pre dir="ltr">import oracle.xml.diff.XmlUtils;
import oracle.xml.diff.Options;
 
import java.io.File;
 
import org.w3c.dom.Node;
import org.w3c.dom.Document;
 
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
 
public class textDiff
{
    public static void main(String[] args) throws Exception
    {
        XmlUtils xmlUtils = new XmlUtils();
 
        //Parse the two input files
        DocumentBuilderFactory dbFactory =   
                  DocumentBuilderFactory.newInstance();
        dbFactory.setNamespaceAware(true);
        DocumentBuilder docBuilder = 
                  dbFactory.newDocumentBuilder();
        Node doc = docBuilder.parse(new File(args[0]));
        Node doc1 = docBuilder.parse(new File(args[1]));
 
        //Run the diff
        try
        {
            Document diffAsDom = xmlUtils.diffToDoc(doc, 
                                  doc1, new Options());
        }
        catch (Exception e)
        {
            e.printStackTrace();
        }
    }
}
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABIEBAA">
<p class="titleinexample">Example 12-5 Getting a diff Using DiffOpReceiver from a Java Application</p>
<pre dir="ltr">import oracle.xml.diff.DiffOp;
import oracle.xml.diff.DiffOpReceiver;
 
import java.util.List;
import java.util.Properties;
 
import java.io.File;
 
import org.w3c.dom.Node;
 
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
 
public class progDiff
{
  public static void main(String[] args) throws Exception
  {
     XmlUtils xmlUtils = new XmlUtils();
 
     //Parse the two input files
     DocumentBuilderFactory dbFac = 
                        DocumentBuilderFactory.newInstance();
     dbFac.setNamespaceAware(true);
     DocumentBuilder docBuilder = dbFac.newDocumentBuilder();
     Node doc = docBuilder.parse(new File(args[0]));
     Node doc1 = docBuilder.parse(new File(args[1]));
 
     Options opt = new Options();
 
     //Instantiate the DiffOpReceiver. This is the object that 
     //will receive DiffOps, ie diff operations that the XmlDiff
     //outputs. Each object represents either deletion or insert   
     //or append of a node. In this DiffOpReceiverImpl     
     //implementation (see below) of the DiffOpReceiver 
     //interface, we simply print out each diff operation.
     DiffOpReceiver diffOpRec = 
                 new progDiff().new DiffOpReceiverImpl();
     xmlUtils.diff(doc, doc1, diffOpRec, opt);
  }
 
  class DiffOpReceiverImpl implements DiffOpReceiver
  {
      public void receiveDiff(List&lt;DiffOp&gt; diffOps)
      {
         try
         {
             for (int i = 0; i &lt; diffOps.size(); i++)
             {
                 DiffOp diffOperation= diffOps.get(i);
 
                 //Delete operation, print out the deleted
                 // node from the first tree
                 if (diffOperation.getOpName() ==
                     DiffOp.Name.DELETE)
                    System.out.println (&#34;DELETING NODE:\n&#34; + 
    XmlUtils.nodeToString(diffOperation.getCurrent(), false));
                 
                 //Insert operation. Print out the node 
                 //from the second tree to be inserted,
                 //and the node from the first tree 
                 //before  which the insertion will happen
                 else if (diffOperation.getOpName() == 
                          DiffOp.Name.INSERT_BEFORE_NODE)
                    System.out.println (&#34;INSERTING NODE:\n&#34; + 
       XmlUtils.nodeToString(diffOperation.getNew(), false) +
                                           &#34;BEFORE NODE:\n&#34; + 
    XmlUtils.nodeToString(diffOperation.getSibling(), false));
                 
 
 
 
                 //Append as the last node of the parent. 
                 //Print out the node from the second tree
                 //that will be appended, and the parent 
                 //node from the first tree to which the
                 //former node will be appended as the 
                 //last child.
                 else if (diffOperation.getOpName() ==   
                    DiffOp.Name.INSERT_BY_APPENDING)
                    System.out.println (&#34;APPENDING NODE:\n&#34; +
       XmlUtils.nodeToString(diffOperation.getNew(), false) +
                                    &#34;TO THE PARENT NODE:\n&#34; +  
       XmlUtils.nodeToString(diffOperation.getParent(), false));
           }
       }
       catch (Exception e)
       {
           System.err.println (&#34;Error while printing out the 
                            diff result:&#34; + e.getMessage());
       }
    }
  }
}
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK204"></a>
<div class="props_rev_3"><a id="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44"></a>
<h2 id="ADXDK-GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44" class="sect2"><span class="enumeration_section">12.5</span> Using Java XML hash and equal Methods to Identify and Compare Inputs</h2>
<div>
<p>The Java XML diffing library provides <code>hash</code> methods to compute a hash value that uniquely identifies the input, with a high probability. Because there is a very low probability of a hash collision, there can be no guarantee that two inputs are identical when their hash values match. To check that two inputs are truly identical with absolute certainty, use the <code>equal</code> methods. The <code>equal</code> methods process both inputs simultaneously, while checking them for absolute equality.</p>
<p>The Java XML diffing library provides several equivalent variants of the <code>hash</code> and <code>equal</code> methods that accept inputs in different forms (DOM nodes, files, and more).</p>
<div class="infoboxnotealso" id="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44__GUID-2F7D5446-48F4-4B07-8FDF-E746A6B039AD">
<p class="notep1">See Also:</p>
<p><a class="olink JAXML" target="_blank" href="../JAXML/toc.htm"><span class="italic">Oracle Database XML Java API Reference</span></a> for details about the <code>hash</code> and <code>equal</code> methods in the <code>XmlUtils</code> class</p>
</div>
</div>
</div>
<a id="ADXDK206"></a><a id="ADXDK205"></a>
<div class="props_rev_3"><a id="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3"></a>
<h2 id="ADXDK-GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" class="sect2"><span class="enumeration_section">12.6</span> Diff Output Schema</h2>
<div>
<p><a href="adx_j_diff.htm#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3__BABBHHCB">Example 12-6</a> shows the Diff output schema (<code>xdiff.xsd</code>) to which the Java XML diffing library conforms.</p>
<div class="example" id="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3__BABBHHCB">
<p class="titleinexample">Example 12-6 Diff Output Schema: xdiff.xsd</p>
<pre dir="ltr">&lt;schema targetNamespace=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd&#34;
    xmlns=&#34;http://www.w3.org/2001/XMLSchema&#34;
    xmlns:xd=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd&#34;
    version=&#34;1.0&#34; elementFormDefault=&#34;qualified&#34;
    attributeFormDefault=&#34;qualified&#34;&gt;
    &lt;annotation&gt;
        &lt;documentation&gt; 
         Defines the structure of XML documents that capture the difference
         between two XML inputs. Changes that are not supported by Oracle
         XmlDiff may not be expressible in this schema.
           
        &#39;oracle-xmldiff&#39; PI:
 
        We use &#39;oracle-xmldiff&#39; PI to describe certain aspects of the diff.
        This should be the first element of top level xdiff element.
 
        version-number: version number of the XML diff schema
       
        output-model: output model for representing the diff. Currently, only
        the &#34;snapshot&#34; model is supported.
       
        Snapshot model:
        Each operation uses XPaths as if no operations
        have been applied to the input document.
        Default and works for both Xmldiff and XmlPatch. 
 
        &lt;!-- Example:
            &lt;?oracle-xmldiff version-number = &#34;1.0&#34; output-model = &#34;snapshot&#34;?&gt;
        --&gt;
        &lt;/documentation&gt; 
     &lt;/annotation&gt; 
    &lt;!-- Enumerate the supported node types --&gt; 
    &lt;simpleType name=&#34;xdiff-nodetype&#34;&gt; 
        &lt;restriction base=&#34;string&#34;&gt; 
            &lt;enumeration value=&#34;element&#34;/&gt; 
            &lt;enumeration value=&#34;text&#34;/&gt; 
            &lt;enumeration value=&#34;cdata&#34;/&gt;
            &lt;enumeration value=&#34;processing-instruction&#34;/&gt;
            &lt;enumeration value=&#34;comment&#34;/&gt;            
         &lt;/restriction&gt; 
    &lt;/simpleType&gt;
 
    &lt;element name=&#34;xdiff&#34;&gt; 
        &lt;complexType&gt; 
            &lt;choice minOccurs=&#34;0&#34; maxOccurs=&#34;unbounded&#34;&gt; 
 
                &lt;element name=&#34;append-node&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name=&#34;content&#34; type=&#34;anyType&#34;/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt; 
                        &lt;attribute name=&#34;parent-xpath&#34; type=&#34;string&#34;/&gt; 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name=&#34;insert-node-before&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name=&#34;content&#34; type=&#34;anyType&#34;/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name=&#34;xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt;
 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name=&#34;delete-node&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt;
                        &lt;attribute name=&#34;xpath&#34; type=&#34;string&#34;/&gt; 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
             &lt;/choice&gt; 
        &lt;/complexType&gt; 
    &lt;/element&gt; 
&lt;/schema&gt;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment643">
<tr>
<td class="cellalignment670">
<table class="cellalignment648">
<tr>
<td class="cellalignment647"><a href="adx_j_pipeline.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment647"><a href="adx_j_xsu.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment672">
<table class="cellalignment646">
<tr>
<td class="cellalignment647"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment647"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment647"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment647"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment647"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment647"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>