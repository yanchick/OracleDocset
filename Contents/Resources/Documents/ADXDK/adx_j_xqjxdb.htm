<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-1666"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20XQuery%20API%20for%20Java%20to%20Access%20Oracle%20XML%20DB"></a><title>Using XQuery API for Java to Access Oracle XML DB</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="XQuery API for Java (XQJ), XQJ, JSR-225, Java Specification Request, 225, XML DB, JAR files for XQJ, CLASSPATH environment variable, for XQJ"/>
<meta name="dcterms.created" content="2016-12-08T13:58:19Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="XML Developer&#39;s Kit Programmer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E54405-06"/>
<meta name="dcterms.isVersionOf" content="ADXDK"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="adx_j_xqj.htm" title="Previous" type="text/html"/>
<link rel="Next" href="adx_j_sproc.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E54405-06.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-DDFFD115-A115-4B6C-805C-350AF78281EB"></a> <span id="PAGE" style="display:none;">16/50</span> <!-- End Header -->
<script>
//<![CDATA[
window.name='adx_j_xqjxdb'
//]]>
</script> <script>
    function footdisplay(footnum,footnote) {
    var msg = window.open('', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');

    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>');
    msg.document.write('Footnote&amp;nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('');
    msg.document.write('<style> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
</script><noscript>
<p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
</noscript><a id="ADXDK992"></a><a id="ADXDK136"></a>
<h1 id="ADXDK-GUID-DDFFD115-A115-4B6C-805C-350AF78281EB" class="sect1"><span class="enumeration_chapter">8</span> Using XQuery API for Java to Access Oracle XML DB</h1>
<div>
<p>This chapter explains how to use the XQuery API for Java (XQJ) to access Oracle XML DB.</p>
<div class="section">
<p class="subhead1">Topics:</p>
</div>
<!-- class="section" -->
<ul style="list-style-type: disc;">
<li>
<p><a href="adx_j_xqjxdb.htm#GUID-4CCB8866-D4A3-4CB7-B08B-00C227CE6F0B">Introduction to Oracle XML DB Support for XQJ</a></p>
</li>
<li>
<p><a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E">Examples: Using XQJ to Query XML DB</a></p>
</li>
<li>
<p><a href="adx_j_xqjxdb.htm#GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A">XQJ Support for Oracle XML DB</a></p>
</li>
<li>
<p><a href="adx_j_xqjxdb.htm#GUID-1A6A963C-2C86-4592-A82A-5CFC1DCDE373">XQJ Performance Considerations for Use with Oracle XML DB</a></p>
</li>
</ul>
</div>
<a id="ADXDK963"></a>
<div class="props_rev_3"><a id="GUID-4CCB8866-D4A3-4CB7-B08B-00C227CE6F0B"></a>
<h2 id="ADXDK-GUID-4CCB8866-D4A3-4CB7-B08B-00C227CE6F0B" class="sect2"><span class="enumeration_section">8.1</span> Introduction to Oracle XML DB Support for XQJ</h2>
<div>
<p>XQuery API for Java (XQJ), also known as JSR-225, provides an industry-standard way for Java programs to access Extensible Markup Language (XML) data using XQuery. It lets you evaluate XQuery expressions against XML data sources and process the results as XML data.</p>
<p>Oracle provides two XQuery engines for evaluating XQuery expressions: one in Oracle XML DB, for use with XML data in the database, and one in Oracle XML Developer&#39;s Kit (XDK), for use with XML data outside the database. (See <a href="adx_j_xqj.htm#GUID-9E6570F0-37BB-4690-BFF6-A2052B5B57E8">Using the XQuery Processor for Java</a> for information about the XQuery engine for XDK).</p>
<p>Oracle provides two different XQJ implementations for accessing these two XQuery engines. Both implementations are part of XDK, enabling you to use XDK to access XML data with a standard XQJ API whether that data resides in the database or elsewhere.</p>
<p>The queries executed by XQJ are written in standard World Wide Web Consortium (W3C) XQuery 1.0 language, as supported by Oracle XML DB. A typical use case for this feature is to access XML data stored in remote databases (in Oracle XML DB) from a local Java program.</p>
<p>General information about XQuery and XQJ is documented outside of this document.</p>
<div class="infoboxnotealso" id="GUID-4CCB8866-D4A3-4CB7-B08B-00C227CE6F0B__GUID-51568F89-4794-4BBA-B230-972A576E57D5">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADXDB0100" target="_blank" href="../ADXDB/xdb01int.htm#ADXDB0100"><span class="italic">Oracle XML DB Developer&#39;s Guide</span></a> for more information about Oracle XML DB, including details about XQuery capabilities and support in Oracle XML DB</p>
</li>
<li>
<p><code>XQuery Packages</code> in <a class="olink JAXML" target="_blank" href="../JAXML/toc.htm"><span class="italic">Oracle Database XML Java API Reference</span></a> for the related API documentation</p>
</li>
<li>
<p><a href="http://www.w3.org/TR/xquery/" target="_blank"><code>http://www.w3.org/TR/xquery/</code></a> for information about XQuery 1.0: An XML Query Language (Second Edition)</p>
</li>
<li>
<p>XQuery API for Java (XQJ) 1.0 Specification, March 2009, <a href="https://jcp.org/aboutJava/communityprocess/final/jsr225/" target="_blank"><code>https://jcp.org/aboutJava/communityprocess/final/jsr225/</code></a></p>
<p>This specification is very concrete, with understandable examples.</p>
</li>
</ul>
</div>
</div>
<a id="ADXDK962"></a>
<div class="props_rev_3"><a id="GUID-D3053B76-1E68-4EAB-A47D-38D602772647"></a>
<h3 id="ADXDK-GUID-D3053B76-1E68-4EAB-A47D-38D602772647" class="sect3"><span class="enumeration_section">8.1.1</span> Prerequisites</h3>
<div>
<p>You must have Java Runtime Environment 1.6 to use XQJ with Oracle XML DB.</p>
<p>In addition, the required Java Archive (JAR) files listed in <span class="q">&#34;<a href="adx_j_xqj.htm#GUID-42469EA3-F7DC-41AF-A58B-795ED2BDC7AA">Introduction to the XQuery Processor for Java</a>&#34;</span> and these JAR files must be in the <code>CLASSPATH</code> environment variable (or passed using the command-line option <code>classpath</code>):</p>
<ul style="list-style-type: disc;">
<li>
<p><code>jdbc/lib/ojdbc6.jar</code></p>
</li>
<li>
<p><code>rdbms/jlib/xdb6.jar</code></p>
</li>
</ul>
<p>The directory paths for these JAR files are relative to the <code>ORACLE_HOME</code> directory of your database installation.</p>
</div>
</div>
</div>
<a id="ADXDK210"></a><a id="ADXDK964"></a><a id="ADXDK209"></a>
<div class="props_rev_3"><a id="GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E"></a>
<h2 id="ADXDK-GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E" class="sect2"><span class="enumeration_section">8.2</span> Examples: Using XQJ to Query Oracle XML DB</h2>
<div>
<div class="section">
<p>You can use XQJ to query and retrieve data in Oracle XML DB, as shown by the examples in this section.</p>
<p><a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBCIJEB">Example 8-1</a> shows how to use XQJ to query data from a table in Oracle XML DB. It uses the <code>WAREHOUSES</code> table in the Order Entry (OE) database sample schema. The OE sample schema contains XML documents with warehouse information in the <code>WAREHOUSES</code> table. The <code>WAREHOUSES</code> table contains an XMLType column <code>warehouse_spec</code> and other columns. (See the discussion about standard database schemas in <a class="olink ADXDB3910" target="_blank" href="../ADXDB/preface.htm#ADXDB3910"><span class="italic">Oracle XML DB Developer&#39;s Guide</span></a> for more information about the data used in this example.)</p>
<p>Specifically, <a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBCIJEB">Example 8-1</a> shows how to perform these steps:</p>
<ol>
<li>
<p>Get an XQJ connection to Oracle XML DB.</p>
<p>Every program using XQJ to connect to Oracle XML DB must first create an OXQDDataSource object. Then, OXQDDataSource must be initialized with the required property values before getting an XQJ connection to the Oracle XML DB instance.</p>
</li>
<li>
<p>Prepare an XQuery expression.</p>
</li>
<li>
<p>Submit the XQuery expression for evaluation.</p>
</li>
<li>
<p>Print each item in the resulting XQuery sequence.</p>
</li>
</ol>
<p>In <a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBCIJEB">Example 8-1</a>, the XQuery expression accesses the <code>WAREHOUSES</code> table through the use of the Universal Resource Identifier (URI) scheme <code>oradb</code>. (See the discussion about the URI scheme <code>oradb</code> in <a class="olink ADXDB5994" target="_blank" href="../ADXDB/xdb_xquery.htm#ADXDB5994"><span class="italic">Oracle XML DB Developer&#39;s Guide</span></a> for more information about using XQuery with XML DB to query table or view data.)</p>
<p><a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBCIJEB">Example 8-1</a> also shows how to bind external variable values in XQJ. The query has an external variable <code>$x</code>, which is used to filter the returned rows from the <code>WAREHOUSES</code> table, by <code>WAREHOUSE_ID</code>.</p>
<p><a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBCIJEB">Example 8-1</a> generates this output (reformatted for better readability):</p>
<pre>&lt;Warehouse&gt;&lt;Building&gt;Owned&lt;/Building&gt;&lt;Area&gt;25000&lt;/Area&gt;&lt;Docks&gt;2&lt;/Docks&gt;
 &lt;DockType&gt;Rearload&lt;/DockType&gt;&lt;WaterAccess&gt;Y&lt;/WaterAccess&gt;
 &lt;RailAccess&gt;N&lt;/RailAccess&gt;&lt;Parking&gt;Street&lt;/Parking&gt;
 &lt;VClearance&gt;10 ft&lt;/VClearance&gt;&lt;/Warehouse&gt;

&lt;Warehouse&gt;&lt;Building&gt;Rented&lt;/Building&gt;&lt;Area&gt;50000&lt;/Area&gt;&lt;Docks&gt;1&lt;/Docks&gt;
 &lt;DockType&gt;Sideload&lt;/DockType&gt;&lt;WaterAccess&gt;Y&lt;/WaterAccess&gt;
 &lt;RailAccess&gt;N&lt;/RailAccess&gt;&lt;Parking&gt;Lot&lt;/Parking&gt;
 &lt;VClearance&gt;12 ft&lt;/VClearance&gt;&lt;/Warehouse&gt;
</pre>
<p><a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBBGDEJ">Example 8-2</a> shows how to use XQJ to retrieve data from the Oracle XML DB repository. This example assumes that two files, <code>depts.xml</code> and <code>emps.xml</code>, have been uploaded into the XML DB repository under the folder <code>/public</code>. For example, you can use FTP to upload the two files into the Oracle XML DB repository. (See the discussion about using the Oracle XML DB repository in <a class="olink ADXDB4174" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADXDB4174"><span class="italic">Oracle XML DB Developer&#39;s Guide</span></a> for more information about storing data in and using the Oracle XML DB repository.)</p>
<p>The content of <code>depts.xml</code> is:</p>
<pre dir="ltr">depts.xml:
 
&lt;?xml version=&#34;1.0&#34;?&gt;
     &lt;depts&gt;
       &lt;dept deptno=&#34;10&#34; dname=&#34;Administration&#34;/&gt;
       &lt;dept deptno=&#34;20&#34; dname=&#34;Marketing&#34;/&gt;
       &lt;dept deptno=&#34;30&#34; dname=&#34;Purchasing&#34;/&gt;
     &lt;/depts&gt;
</pre>
<p>The content of <code>emps.xml</code> is:</p>
<pre dir="ltr">emps.xml:
 
&lt;?xml version=&#34;1.0&#34;?&gt;
   &lt;emps&gt;
    &lt;emp empno=&#34;1&#34; deptno=&#34;10&#34; ename=&#34;John&#34;  salary=&#34;21000&#34;/&gt;
       &lt;emp empno=&#34;2&#34; deptno=&#34;10&#34; ename=&#34;Jack&#34; salary=&#34;310000&#34;/&gt;
       &lt;emp empno=&#34;3&#34; deptno=&#34;20&#34; ename=&#34;Jill&#34; salary=&#34;100001&#34;/&gt;
     &lt;/emps&gt;
</pre>
<p>You can use the <code>fn:doc</code> and <code>fn:collection</code> functions to query the data in the Oracle XML DB repository with XQuery. <a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBBGDEJ">Example 8-2</a> shows how to use the <code>fn:doc</code> function within XQuery to access the repository. (See the discussion about querying XML data in the Oracle XML DB repository in <a class="olink ADXDB5125" target="_blank" href="../ADXDB/xdb04cre.htm#ADXDB5125"><span class="italic">Oracle XML DB Developer&#39;s Guide</span></a> for more information about using these XQuery functions.)</p>
<p><a href="adx_j_xqjxdb.htm#GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBBGDEJ">Example 8-2</a> generates this output:</p>
<pre dir="ltr">&lt;emp ename=&#34;Jack&#34; dept=&#34;Administration&#34;/&gt;
&lt;emp ename=&#34;Jill&#34; dept=&#34;Marketing&#34;/&gt;
</pre></div>
<!-- class="section" -->
<div class="example" id="GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBCIJEB">
<p class="titleinexample">Example 8-1 Using XQJ to Query an XML DB Table with XQuery</p>
<pre dir="ltr">import oracle.xml.xquery.xqjdb.OXQDDataSource;
 
import javax.xml.xquery.XQItemType;
import javax.xml.xquery.XQResultSequence;
import javax.xml.xquery.XQConnection;
import javax.xml.xquery.XQPreparedExpression;
import javax.xml.namespace.QName;
 
public class example1
{
  public static void main(String argv[])
  {
    try
    {
      // Create a new OXQDDataSource for connecting to Oracle XML DB
      OXQDDataSource oxqDS = new OXQDDataSource();
      // Set appropriate connection information for the database instance.
      // Must use the thin driver
      oxqDS.setProperty(&#34;driver&#34;, &#34;jdbc:oracle:thin&#34;);
      oxqDS.setProperty(&#34;dbusername&#34;, &#34;oe&#34;);
      oxqDS.setProperty(&#34;dbpassword&#34;, &#34;oe&#34;);
      // Machine hostname
      oxqDS.setProperty(&#34;dbserver&#34;, &#34;myserver&#34;);
      // Database instance port number
      oxqDS.setProperty(&#34;dbport&#34;, &#34;6479&#34;);
      // Database instance port number
      oxqDS.setProperty(&#34;serviceName&#34;, &#34;mydbinstance&#34;);
      XQConnection conn = oxqDS.getConnection();
      XQItemType  itemTypeInt = conn.createAtomicType(XQItemType.XQBASETYPE_INT);
      XQPreparedExpression expr = conn.prepareExpression(&#34;declare variable $x as
        xs:int external; for $i in fn:collection(&#39;oradb:/OE/WAREHOUSES&#39;) where
          $i/ROW/WAREHOUSE_ID &lt; $x return $i/ROW/WAREHOUSE_SPEC/Warehouse&#34;);
      expr.bindInt(new QName(&#34;x&#34;), 3, itemTypeInt);
      XQResultSequence xqSeq = expr.executeQuery();
      while (xqSeq.next())
         System.out.println (xqSeq.getItemAsString(null));
     }
     catch (Exception e)
     {
      e.printStackTrace();
     }
  }
}
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-445890C9-62DD-4ED9-BC27-B1FC11AC014E__BGBBGDEJ">
<p class="titleinexample">Example 8-2 Using XQJ to Query the XML DB Repository with XQuery</p>
<pre dir="ltr">import oracle.xml.xquery.xqjdb.OXQDDataSource;
 
import javax.xml.xquery.XQItemType;
import javax.xml.xquery.XQResultSequence;
import javax.xml.xquery.XQConnection;
import javax.xml.xquery.XQPreparedExpression;
import javax.xml.namespace.QName;

public class example2
{
  public static void main(String argv[])
  {
    try
    {
      // Create a new OXQDDataSource for connecting to Oracle XML DB
      OXQDDataSource oxqDS = new OXQDDataSource();
      // Set appropriate connection information for the database instance.
      // Must use the thin driver
      oxqDS.setProperty(&#34;driver&#34;, &#34;jdbc:oracle:thin&#34;);
      oxqDS.setProperty(&#34;dbusername&#34;, &#34;oe&#34;);
      oxqDS.setProperty(&#34;dbpassword&#34;, &#34;oe&#34;);
      // Machine hostname
      oxqDS.setProperty(&#34;dbserver&#34;, &#34;myserver&#34;);
      // Database instance port number
      oxqDS.setProperty(&#34;dbport&#34;, &#34;6479&#34;);
      // Database instance port number
      oxqDS.setProperty(&#34;serviceName&#34;, &#34;mydbinstance&#34;);
      XQConnection conn = oxqDS.getConnection();
      XQPreparedExpression expr = conn.prepareExpression(&#34;for $e in
        doc(\&#34;/public/emps.xml\&#34;)/emps/emp let $d :=
        doc(\&#34;/public/depts.xml\&#34;)//dept[@deptno = $e/@deptno]/@dname where
        $e/@salary &gt; 100000 order by $e/@empno return 
        &lt;emp ename=\&#34;{$e/@ename}\&#34; dept=\&#34;{$d}\&#34;/&gt;&#34;);
      XQResultSequence xqSeq = expr.executeQuery();
      while (xqSeq.next())
         System.out.println (xqSeq.getItemAsString(null));
     }
     catch (Exception e)
     {
      e.printStackTrace();
     }
  }
}
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK202"></a><a id="ADXDK201"></a><a id="ADXDK137"></a>
<div class="props_rev_3"><a id="GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A"></a>
<h2 id="ADXDK-GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A" class="sect2"><span class="enumeration_section">8.3</span> XQJ Support for Oracle XML DB</h2>
<div>
<p>The two Oracle XQJ implementations differ in some respects. Oracle XML DB support for XQJ is described in this section. <a href="adx_j_xqj.htm#GUID-9E6570F0-37BB-4690-BFF6-A2052B5B57E8">Using the XQuery Processor for Java</a> provides information about using XQJ to access the mid-tier XQuery engine.</p>
<p><a href="adx_j_xqjxdb.htm#GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBBEAIA" title="OXQDataSource Properties">Table 8-1</a> describes the OXQDDataSource properties to be used for connection to Oracle XML DB. To create an XQJ connection to Oracle XML DB, you must set the values for these properties. You must set either the <code>dbname</code> or the <code>serviceName</code> property value, and all the other OXQDDataSource property values listed in <a href="adx_j_xqjxdb.htm#GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBBEAIA" title="OXQDataSource Properties">Table 8-1</a>.</p>
<div class="tblformalwide" id="GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBBEAIA">
<p class="titleintable">Table 8-1 OXQDDataSource Properties</p>
<table class="cellalignment655" title="OXQDDataSource Properties" summary="OXQDataSource Properties">
<thead>
<tr class="cellalignment644">
<th class="cellalignment726" id="d43401e690">Property</th>
<th class="cellalignment727" id="d43401e693">Value</th>
<th class="cellalignment677" id="d43401e696">Get Method</th>
<th class="cellalignment677" id="d43401e699">Set Method</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment644">
<td class="cellalignment728" id="d43401e704" headers="d43401e690">
<p><code>driver</code></p>
</td>
<td class="cellalignment729" headers="d43401e704 d43401e693">
<p><code>jdbc:oracle:thin</code></p>
</td>
<td class="cellalignment679" headers="d43401e704 d43401e696">
<p><code>getDriver</code></p>
</td>
<td class="cellalignment679" headers="d43401e704 d43401e699">
<p><code>setDriver</code></p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment728" id="d43401e721" headers="d43401e690">
<p><code>dbusername</code></p>
</td>
<td class="cellalignment729" headers="d43401e721 d43401e693">
<p>Database schema (user) name</p>
</td>
<td class="cellalignment679" headers="d43401e721 d43401e696">
<p><code>getDBUserName</code></p>
</td>
<td class="cellalignment679" headers="d43401e721 d43401e699">
<p><code>setDBUserName</code></p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment728" id="d43401e737" headers="d43401e690">
<p><code>dbpassword</code></p>
</td>
<td class="cellalignment729" headers="d43401e737 d43401e693">
<p>Password for database schema</p>
</td>
<td class="cellalignment679" headers="d43401e737 d43401e696">
<p><code>getDBPassword</code></p>
</td>
<td class="cellalignment679" headers="d43401e737 d43401e699">
<p><code>setDBPassword</code></p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment728" id="d43401e753" headers="d43401e690">
<p><code>dbserver</code></p>
</td>
<td class="cellalignment729" headers="d43401e753 d43401e693">
<p>Host name for the database instance</p>
</td>
<td class="cellalignment679" headers="d43401e753 d43401e696">
<p><code>getDBServer</code></p>
</td>
<td class="cellalignment679" headers="d43401e753 d43401e699">
<p><code>setDBServer</code></p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment728" id="d43401e769" headers="d43401e690">
<p><code>dbport</code></p>
</td>
<td class="cellalignment729" headers="d43401e769 d43401e693">
<p>Port number of the database instance for XQJ connection</p>
</td>
<td class="cellalignment679" headers="d43401e769 d43401e696">
<p><code>getDBPort</code></p>
</td>
<td class="cellalignment679" headers="d43401e769 d43401e699">
<p><code>setDBPort</code></p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment728" id="d43401e785" headers="d43401e690">
<p><code>dbname</code></p>
</td>
<td class="cellalignment729" headers="d43401e785 d43401e693">
<p>Database instance name (service id)<a id="GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBBCCFH" href="#GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBBCCFH" onclick="footdisplay(1,&#34;You can identify the database using either the service id or the service name. &#34;)"><sup>Foot&nbsp;1</sup></a></p>
</td>
<td class="cellalignment679" headers="d43401e785 d43401e696">
<p><code>getDBName</code></p>
</td>
<td class="cellalignment679" headers="d43401e785 d43401e699">
<p><code>setDBName</code></p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment728" id="d43401e804" headers="d43401e690">
<p><code>serviceName</code></p>
</td>
<td class="cellalignment729" headers="d43401e804 d43401e693">
<p>Service name<a id="fnsrc_d43401e811" href="#fnsrc_d43401e811" onclick="footdisplay(1,&#34;You can identify the database using either the service id or the service name. &#34;)"><sup>Footref&nbsp;1</sup></a></p>
</td>
<td class="cellalignment679" headers="d43401e804 d43401e696">
<p><code>getServiceName</code></p>
</td>
<td class="cellalignment679" headers="d43401e804 d43401e699">
<p><code>setServiceName</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;1</sup></p>
<p>You can identify the database using either the service id or the service name.</p>
<p><a href="adx_j_xqjxdb.htm#GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBHICIJ" title="Oracle XML DB Support for XQJ">Table 8-2</a> describes the Oracle XML DB support for optional XQJ features.</p>
<div class="infobox-note" id="GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__GUID-47A8F4C2-94C1-40F6-96A7-A40E8D0A9C6D">
<p class="notep1">Note:</p>
<p>Oracle XML DB support for some XQJ features differs from their support by the mid-tier XQuery engine. In particular, the Oracle XML DB XQJ implementation does not support the use of user-defined types.</p>
</div>
<div class="tblformalwide" id="GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBHICIJ">
<p class="titleintable">Table 8-2 Oracle XML DB Support for Optional XQJ Features</p>
<table class="cellalignment655" title="Oracle XML DB Support for Optional XQJ Features" summary="Oracle XML DB Support for XQJ">
<thead>
<tr class="cellalignment644">
<th class="cellalignment730" id="d43401e840">XQJ Feature</th>
<th class="cellalignment689" id="d43401e843">Oracle XML DB Support</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e848" headers="d43401e840">
<p>Class name of <code>XQDataSource</code> implementation</p>
</td>
<td class="cellalignment691" headers="d43401e848 d43401e843">
<p><code>oracle.xml.xquery.xqjdb.OXQDDataSource</code></p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e859" headers="d43401e840">
<p>JDBC connections</p>
</td>
<td class="cellalignment691" headers="d43401e859 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e866" headers="d43401e840">
<p>Properties defined on <code>OXQDDataSource</code> (connection information)</p>
</td>
<td class="cellalignment691" headers="d43401e866 d43401e843">
<p>See <a href="adx_j_xqjxdb.htm#GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__BGBBEAIA" title="OXQDataSource Properties">Table 8-1</a>.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e881" headers="d43401e840">
<p>Commands</p>
</td>
<td class="cellalignment691" headers="d43401e881 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e888" headers="d43401e840">
<p><code>XQPreparedExpression.cancel</code> (cancelling of query execution)</p>
</td>
<td class="cellalignment691" headers="d43401e888 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e897" headers="d43401e840">
<p>Serialization</p>
</td>
<td class="cellalignment691" headers="d43401e897 d43401e843">
<p>Only parameter <code>method</code> with value <code>xml</code> and parameter <code>encoding</code> with value <code>UTF-8</code> or <code>UTF-16</code>.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e919" headers="d43401e840">
<p>Additional StAX and SAX events</p>
</td>
<td class="cellalignment691" headers="d43401e919 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e926" headers="d43401e840">
<p>User-defined schema types</p>
</td>
<td class="cellalignment691" headers="d43401e926 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e933" headers="d43401e840">
<p>Node identity, document order, and full-node context preservation when a node is bound to an external variable</p>
</td>
<td class="cellalignment691" headers="d43401e933 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e940" headers="d43401e840">
<p>Login timeout</p>
</td>
<td class="cellalignment691" headers="d43401e940 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e947" headers="d43401e840">
<p>Transactions</p>
</td>
<td class="cellalignment691" headers="d43401e947 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e955" headers="d43401e840">
<p>Behavior of <code>XQItemAccessor</code> method <code>getNodeUri()</code> when the input node is not a document node</p>
</td>
<td class="cellalignment691" headers="d43401e955 d43401e843">
<p>Return <code>NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e971" headers="d43401e840">
<p>Behavior of <code>XQItemType</code> method <code>getTypeName()</code> for anonymous types</p>
</td>
<td class="cellalignment691" headers="d43401e971 d43401e843">
<p>Return <code>false</code>.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e987" headers="d43401e840">
<p>Behavior of <code>XQItemType</code> method <code>getSchemaURI()</code></p>
</td>
<td class="cellalignment691" headers="d43401e987 d43401e843">
<p>Return <code>NULL</code> or the schema URI provided during type creation. Currently, the Oracle XML DB XQJ implementation does not use the schema URI to get type information, and user-defined types are not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e1002" headers="d43401e840">
<p>Behavior of <code>XQDataFactory</code> methods <code>createItemFromDocument()</code> and <code>bindDocument()</code> if the input is not a well-formed XML document</p>
</td>
<td class="cellalignment691" headers="d43401e1002 d43401e843">
<p>Raise an exception.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e1018" headers="d43401e840">
<p>Additional error codes returned from <code>XQQueryException</code></p>
</td>
<td class="cellalignment691" headers="d43401e1018 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e1027" headers="d43401e840">
<p>Interfaces <code>ConnectionPoolXQDataSource</code>, <code>PooledXQConnection</code>, <code>XQConnectionEvent</code>, <code>XQConnectionEventListener</code></p>
</td>
<td class="cellalignment691" headers="d43401e1027 d43401e843">
<p>Not supported.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e1045" headers="d43401e840">
<pre dir="ltr">XQDataSource.getConnection(
  java.sql.Connection)
</pre></td>
<td class="cellalignment691" headers="d43401e1045 d43401e843">
<p>Not supported. (JDBC connections are not supported.)</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment731" id="d43401e1052" headers="d43401e840">
<pre dir="ltr">XQDataSource.getConnection(
  java.lang.String,
  java.lang.String)
</pre></td>
<td class="cellalignment691" headers="d43401e1052 d43401e843">
<p>Same as <code>getConnection()</code> with no arguments: the arguments are ignored.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-02F09032-5E3C-4CE1-AADE-E9FFF70DC01A__GUID-184746E1-31CC-4633-B897-9B58DBFD6684">
<p class="notep1">See Also:</p>
<p><a class="olink ADXDB1700" target="_blank" href="../ADXDB/xdb_xquery.htm#ADXDB1700"><span class="italic">Oracle XML DB Developer&#39;s Guide</span></a> for information about using the XQuery language with Oracle XML DB</p>
</div>
</div>
<a id="ADXDK207"></a>
<div class="props_rev_3"><a id="GUID-E2322A10-4973-40D6-B050-897FA1CC0972"></a>
<h3 id="ADXDK-GUID-E2322A10-4973-40D6-B050-897FA1CC0972" class="sect3"><span class="enumeration_section">8.3.1</span> Other Oracle XML DB XQJ Support Limitations</h3>
<div>
<p>Oracle XML DB support for XQJ has this limitations. None of these limitations apply to mid-tier XQuery engine support for XQJ.</p>
<ul style="list-style-type: disc;">
<li>
<p>All Oracle XML DB XQuery support limitations apply to Oracle XML DB support for XQJ as well.</p>
</li>
<li>
<p>Only the XDK Document Object Model (DOM) is supported. Use of any other DOM can cause errors.</p>
</li>
<li>
<p>Do not expect the Oracle XML DB XQJ implementation to be interoperable with another XQJ implementation, including the XDK Java implementation of XQJ. (See the XQJ standard (JSR-225) for the meaning of &#34;interoperable&#34;.)</p>
</li>
<li>
<p><code>XQDataSource</code> methods <code>getLogWriter</code> and <code>setLogWriter</code> have no effect (they are ignored).</p>
</li>
<li>
<p><code>XQStaticContent</code> methods <code>getBoundarySpacePolicy</code>, <code>setBoundarySpacePolicy</code>, <code>getDefaultCollation</code>, and <code>setDefaultCollation</code> have no effect (they are ignored).</p>
</li>
<li>
<p>The copy namespaces mode for <code>XQStaticContent</code> methods <code>setCopyNamespacesModPreserve</code> and <code>setCopyNamespacesModeInherit</code> has no effect (it is ignored). The values used are always <code>preserve</code> and <code>inherit</code>, respectively.</p>
</li>
<li>
<p>Use of <code>XQDynamicContext</code> methods to bind <code>DocumentFragment</code> objects is not supported.</p>
</li>
<li>
<p>Values of type <code>xs:duration</code> are not supported. Using an <code>XQDynamicContext</code> method to bind <code>xs:duration</code>, or accessing an <code>xs:duration</code> value, raises an error.</p>
</li>
<li>
<p>The year of a <code>xs:date</code>, <code>xs:dateTime</code>, <code>xs:gYear</code>, and <code>xs:gYearMonth</code> value must be from -4712 to 9999, inclusive. Using a year outside this range can raise an error or produce unpredictable results.</p>
</li>
</ul>
</div>
</div>
</div>
<a id="ADXDK208"></a>
<div class="props_rev_3"><a id="GUID-1A6A963C-2C86-4592-A82A-5CFC1DCDE373"></a>
<h2 id="ADXDK-GUID-1A6A963C-2C86-4592-A82A-5CFC1DCDE373" class="sect2"><span class="enumeration_section">8.4</span> XQJ Performance Considerations for Use with Oracle XML DB</h2>
<div>
<p>To fetch a sequence of items from the database, use <code>XQResultSequence</code> method <code>next()</code> to retrieve a single item at a time; then use an <code>XQItemAccessor</code> method to fetch all data corresponding to that item.</p>
<p>This provides better performance than using these whole-sequence fetch methods, which each materialize the entire sequence before returning any data.</p>
<ul style="list-style-type: disc;">
<li>
<p><code>getSequenceAsStream()</code></p>
</li>
<li>
<p><code>getSequenceAsString(java.util.Properties props)</code></p>
</li>
<li>
<p><code>writeSequence(java.io.OutputStream os, java.util.Properties props)</code></p>
</li>
<li>
<p><code>writeSequence(java.io.Writer ow, java.util.Properties props)</code></p>
</li>
<li>
<p><code>writeSequenceToResult(javax.xml.transform.Result result)</code></p>
</li>
<li>
<p><code>writeSequenceToSAX(org.xml.sax.ContentHandler saxhdlr)</code></p>
</li>
</ul>
<p>For example, if you invoke <code>getSequenceAsStream()</code>, all of the XQuery result sequence data is fetched from the database before the <code>XMLStreamReader</code> instance that is built from it is returned to your program.</p>
<p>Be aware also that items themselves are not streamable: the item accessor methods always materialize an entire item before outputting any part of it.</p>
<p>For inputting, all bind methods defined on <code>XQDynamicContext</code> fully materialize the input data before passing it to the database.</p>
<p>For example, when you invoke <code>bindDocument(javax.xml.namespace.QName varName, javax.xml.stream.XMLStreamReader value, XQItemType type)</code>, all the data that is referenced by the input <code>XMLStreamReader</code> instance is processed before the external XQuery variable is bound to it.</p>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment643">
<tr>
<td class="cellalignment670">
<table class="cellalignment648">
<tr>
<td class="cellalignment647"><a href="adx_j_xqj.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment647"><a href="adx_j_sproc.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment672">
<table class="cellalignment646">
<tr>
<td class="cellalignment647"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment647"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment647"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment647"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment647"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment647"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>


</body></html>