<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-1638"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Determining%20XML%20Differences%20Using%20C"></a><title>Determining XML Differences Using C</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="XMLDiff in C, XmlDiff, command-line options for C, Xdiff instance document, Xdiff schema, XMLDiff, example in C, XmlPatch, XmlHash, example in C"/>
<meta name="dcterms.created" content="2016-12-08T13:58:19Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="XML Developer&#39;s Kit Programmer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E54405-06"/>
<meta name="dcterms.isVersionOf" content="ADXDK"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2001, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="adx_c_sproc.htm" title="Previous" type="text/html"/>
<link rel="Next" href="adx_c_soap.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E54405-06.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-C602E94C-6FC5-4451-B2E0-ED6C5A888B52"></a> <span id="PAGE" style="display:none;">32/50</span> <!-- End Header -->
<a id="ADXDK1041"></a><a id="ADXDK2500"></a>
<h1 id="ADXDK-GUID-C602E94C-6FC5-4451-B2E0-ED6C5A888B52" class="sect1"><span class="enumeration_chapter">23</span> Determining XML Differences Using C</h1>
<div>
<p>This chapter explains how to determine the differences between two Extensible Markup Language (XML) inputs and apply the differences as a patch to one of the XML documents.</p>
<div class="section">
<p class="subhead1">Topics:</p>
</div>
<!-- class="section" -->
<ul style="list-style-type: disc;">
<li>
<p><a href="adx_c_diff.htm#GUID-9CE0A27F-1595-4BA1-8BF2-083C10274EA9">Overview of XMLDiff in C</a></p>
</li>
<li>
<p><a href="adx_c_diff.htm#GUID-D25785EA-996A-44BE-ADF8-FF47DDD174E8">Using XmlDiff</a></p>
</li>
<li>
<p><a href="adx_c_diff.htm#GUID-45E03E82-7DE3-49C3-A29A-8AC3091566EE">Using XmlPatch</a></p>
</li>
<li>
<p><a href="adx_c_diff.htm#GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF">Using XmlHash</a></p>
</li>
</ul>
</div>
<a id="ADXDK19828"></a>
<div class="props_rev_3"><a id="GUID-9CE0A27F-1595-4BA1-8BF2-083C10274EA9"></a>
<h2 id="ADXDK-GUID-9CE0A27F-1595-4BA1-8BF2-083C10274EA9" class="sect2"><span class="enumeration_section">23.1</span> Overview of XMLDiff in C</h2>
<div>
<p>You can use Oracle <code>XmlDiff</code> to determine the differences between two similar XML documents. <code>XmlDiff</code> generates an <code>Xdiff</code> instance document that indicates the differences. The <code>Xdiff</code> instance document is an XML document that conforms to an XML schema, the <code>Xdiff</code> schema.</p>
<p>You can then use <code>XmlPatch</code>, which takes the <code>Xdiff</code> instance document and applies the changes to other documents. You can use this process to apply the same changes to a large number of XML documents.</p>
<p><code>XmlDiff</code> supports only the Document Object Model (DOM) application programming interface (API) for input and output.</p>
<p><code>XmlPatch</code> also supports the DOM for the input and patch documents.</p>
<p>You can use <code>XmlDiff</code> and <code>XmlPatch</code> through a C API or a command-line tool. They are exposed by two structured query language (SQL) functions.</p>
<p>An <code>XmlHash</code> C API is provided to compute the hash value of an XML tree or subtree. If hash values of two trees or subtrees are equal, the trees are identical to a very high probability.</p>
</div>
<a id="ADXDK19829"></a>
<div class="sect3"><a id="GUID-BB147A78-50C6-43DD-8A07-CAAB060A5F74"></a>
<h3 id="ADXDK-GUID-BB147A78-50C6-43DD-8A07-CAAB060A5F74" class="sect3"><span class="enumeration_section">23.1.1</span> Flow of Process for XMLDiff</h3>
<div>
<p>The flow of the process is:</p>
<ol>
<li>
<p>The two input documents are compared by <code>XmlDiff</code>.</p>
</li>
<li>
<p><code>XmlDiff</code> creates a <code>Xdiff</code> instance document.</p>
</li>
<li>
<p>The application can pass the <code>Xdiff</code> instance document to <code>XmlPatch</code>, if this is required.</p>
</li>
<li>
<p><code>XmlPatch</code> can apply the differences captured from the comparison to other documents as specified by the application.</p>
</li>
</ol>
</div>
</div>
</div>
<a id="ADXDK2510"></a>
<div class="props_rev_3"><a id="GUID-D25785EA-996A-44BE-ADF8-FF47DDD174E8"></a>
<h2 id="ADXDK-GUID-D25785EA-996A-44BE-ADF8-FF47DDD174E8" class="sect2"><span class="enumeration_section">23.2</span> Using XmlDiff</h2>
<div>
<p><code>XmlDiff</code> compares the trees that represent the two input documents to determine differences.</p>
<p>Both input documents must use the same character-set encoding. The <code>Xdiff</code> (output) instance document has the same encoding as the data encoding (DOM encoding) of the input documents.</p>
</div>
<a id="ADXDK19830"></a>
<div class="props_rev_3"><a id="GUID-21B69703-474D-4F5A-9804-DD67F1EBC279"></a>
<h3 id="ADXDK-GUID-21B69703-474D-4F5A-9804-DD67F1EBC279" class="sect3"><span class="enumeration_section">23.2.1</span> User Options for Optimization</h3>
<div>
<p>There are two options for the comparison, known as optimizations:</p>
<ul style="list-style-type: disc;">
<li>
<p>Global Optimization&mdash;Default</p>
<p>The whole document trees are compared.</p>
</li>
<li>
<p>Local Optimization</p>
<p>Comparison is at the sibling level. Local optimization compares siblings under the corresponding parents from two trees.</p>
</li>
</ul>
<p>Global optimization can take more time and space for large documents but always produces the smallest set of differences (the optimal difference). Local optimization is much faster, but may not produce the optimal difference.</p>
</div>
</div>
<a id="ADXDK19831"></a>
<div class="props_rev_3"><a id="GUID-CD4119E5-921E-498A-8F3F-3432D5CD08C8"></a>
<h3 id="ADXDK-GUID-CD4119E5-921E-498A-8F3F-3432D5CD08C8" class="sect3"><span class="enumeration_section">23.2.2</span> User Option for Hashing</h3>
<div>
<p>Hashing generally speeds up global optimization with a small possible loss in quality. Hashing improves the quality of the difference output, with local optimization. Using different hash levels may generate both local and global differences.</p>
<p>You can specify the use of hashing for both local and global optimization.</p>
<p>To specify hashing, provide the <code>hashLevel</code> parameter. If <code>hashLevel</code> is greater than 1, then only the <code>DOMHash</code> values are used for comparing all subtrees at <code>depth &gt;= hashLevel</code> of difference. If the hash values are equal, then the subtrees are presumed to be equal.</p>
</div>
</div>
<a id="ADXDK19832"></a>
<div class="props_rev_3"><a id="GUID-C427B536-D231-4214-A051-E32F24251A22"></a>
<h3 id="ADXDK-GUID-C427B536-D231-4214-A051-E32F24251A22" class="sect3"><span class="enumeration_section">23.2.3</span> How XmlDiff Looks at Input Documents</h3>
<div>
<p><code>XmlDiff</code> ignores differences in the order of attributes while doing the comparison.</p>
<p><code>XmlDiff</code> ignores DocType declarations. Files are not validated against the document type definition (DTD).</p>
<p><code>XmlDiff</code> ignores any differences in the namespace prefixes if the namespace prefixes refer to the same namespace Universal Resource Identifier (URI). Otherwise, if two nodes have the same local name and content but differ in namespace URI, these differences are indicated.</p>
<div class="infobox-note" id="GUID-C427B536-D231-4214-A051-E32F24251A22__GUID-50B88F23-AF51-4934-A31A-68E87E2DBFC2">
<p class="notep1">Note:</p>
<p><code>XmlDiff</code> operates on its input documents in a nonschema-based way. It does not operate on elements or attributes in a type-aware manner.</p>
</div>
</div>
</div>
<a id="ADXDK19833"></a><a id="ADXDK2540"></a>
<div class="props_rev_3"><a id="GUID-74C319A8-BE88-4200-AABC-FD153108D3F3"></a>
<h3 id="ADXDK-GUID-74C319A8-BE88-4200-AABC-FD153108D3F3" class="sect3"><span class="enumeration_section">23.2.4</span> Using the XmlDiff Command-Line Utility</h3>
<div>
<div class="section">
<p><a href="adx_c_diff.htm#GUID-74C319A8-BE88-4200-AABC-FD153108D3F3__BABJDEEA" title="rows are XmlDiff command line options. first column is option name, second column description">Table 23-1</a> describes command-line options:</p>
<div class="tblformal" id="GUID-74C319A8-BE88-4200-AABC-FD153108D3F3__BABJDEEA">
<p class="titleintable">Table 23-1 XmlDiff Command-Line Options for the C Language</p>
<table class="cellalignment650" title="XmlDiff Command-Line Options for the C Language" summary="rows are XmlDiff command line options. first column is option name, second column description">
<thead>
<tr class="cellalignment644">
<th class="cellalignment678" id="d109880e798">Option</th>
<th class="cellalignment686" id="d109880e801">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e806" headers="d109880e798">
<p><code>-e</code> encoding</p>
</td>
<td class="cellalignment687" headers="d109880e806 d109880e801">
<p>Specify default input-file encoding. If no encoding is specified in XML file, this encoding is assumed for input.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e815" headers="d109880e798">
<p><code>-E</code> encoding</p>
</td>
<td class="cellalignment687" headers="d109880e815 d109880e801">
<p>Specify output/data encoding. DOMs and the <code>Xdiff</code> instance document are created in this encoding. Default is 8-bit encoding of Unicode (UTF-8).</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e827" headers="d109880e798">
<p><code>-h</code> <code>hash</code>L<code>evel</code></p>
</td>
<td class="cellalignment687" headers="d109880e827 d109880e801">
<p>Specify the hash level. <code>0</code> means none.</p>
<p>If greater than <code>1</code>, starting depth to use hashing for subtrees.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e849" headers="d109880e798">
<p><code>-g</code></p>
</td>
<td class="cellalignment687" headers="d109880e849 d109880e801">
<p>Set global optimization (default).</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e857" headers="d109880e798">
<p><code>-l</code></p>
</td>
<td class="cellalignment687" headers="d109880e857 d109880e801">
<p>Set local optimization.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e865" headers="d109880e798">
<p><code>-p</code></p>
</td>
<td class="cellalignment687" headers="d109880e865 d109880e801">
<p>Show this usage help.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e873" headers="d109880e798">
<p><code>-u</code></p>
</td>
<td class="cellalignment687" headers="d109880e873 d109880e801">
<p>Disable update operation.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" --></div>
</div>
<a id="ADXDK19835"></a><a id="ADXDK19834"></a>
<div class="props_rev_3"><a id="GUID-3750C497-D76A-4F95-9DEB-BC047170FF14"></a>
<h3 id="ADXDK-GUID-3750C497-D76A-4F95-9DEB-BC047170FF14" class="sect3"><span class="enumeration_section">23.2.5</span> Sample Input Document</h3>
<div>
<div class="section">
<p><a href="adx_c_diff.htm#GUID-3750C497-D76A-4F95-9DEB-BC047170FF14__BABBHCIA">Example 23-1</a> is a sample <code>xml</code> document that you can use to explain updates resulting from using both <code>XmlDiff</code> and <code>XmlPatch</code>. It is followed by some hypothetical changes.</p>
<p>Assume that there is another file, <code>book2.xml</code>, that looks just like the <a href="adx_c_diff.htm#GUID-3750C497-D76A-4F95-9DEB-BC047170FF14__BABBHCIA">Example 23-1</a> except that it causes these actions:</p>
<ul style="list-style-type: disc;">
<li>
<p>Deletes &#34;The Eleventh Commandment&#34;, a <code>delete-node</code> operation.</p>
</li>
<li>
<p>Changes the country code for the &#34;C++ Primer&#34; to US from USA, an <code>update-node</code> operation.</p>
</li>
<li>
<p>Adds a description to &#34;Emperor&#39;s New Mind&#34;, an <code>append-node</code> operation.</p>
</li>
<li>
<p>Adds the edition to &#34;Evening News&#34;, an <code>insert-node-before</code> operation.</p>
</li>
<li>
<p>Updates the price of &#34;Evening News&#34;, an <code>update-node</code> operation.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="example" id="GUID-3750C497-D76A-4F95-9DEB-BC047170FF14__BABBHCIA">
<p class="titleinexample">Example 23-1 book1.xml</p>
<pre dir="ltr">&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;booklist xmlns=&#34;http://booklist.oracle.com&#34;&gt;
  &lt;book&gt;    
    &lt;title&gt;Twelve Red Herrings&lt;/title&gt;
    &lt;author&gt;Jeffrey Archer&lt;/author&gt;
    &lt;publisher&gt;Harper Collins&lt;/publisher&gt;
    &lt;price&gt;7.99&lt;/price&gt;      
  &lt;/book&gt;
  &lt;book&gt;
    &lt;title language=&#34;English&#34;&gt;The Eleventh Commandment&lt;/title&gt;
    &lt;author&gt;Jeffrey Archer&lt;/author&gt;
    &lt;publisher&gt;McGraw Hill&lt;/publisher&gt;   
    &lt;price&gt;3.99&lt;/price&gt;
  &lt;/book&gt;
  &lt;book&gt;
    &lt;title language=&#34;English&#34; country=&#34;USA&#34;&gt;C++ Primer&lt;/title&gt;
    &lt;author&gt;Lippmann&lt;/author&gt;
    &lt;publisher&gt;Harper Collins&lt;/publisher&gt;   
    &lt;price&gt;4.99&lt;/price&gt;
  &lt;/book&gt;          
  &lt;book&gt;
    &lt;title&gt;Emperor&#39;s New Mind&lt;/title&gt;
    &lt;author&gt;Roger Penrose&lt;/author&gt;
    &lt;publisher&gt;Oxford Publishing Company&lt;/publisher&gt;
    &lt;price&gt;15.9&lt;/price&gt;
  &lt;/book&gt;          
  &lt;book&gt;
    &lt;title&gt;Evening News&lt;/title&gt;
    &lt;author&gt;Arthur Hailey&lt;/author&gt;
    &lt;publisher&gt;MacMillan Publishers&lt;/publisher&gt;
    &lt;price&gt;9.99&lt;/price&gt;
  &lt;/book&gt;  
&lt;/booklist&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK19837"></a><a id="ADXDK19836"></a>
<div class="props_rev_3"><a id="GUID-F7B63052-2AC2-4E25-A50D-CF8F0F2ADCAB"></a>
<h3 id="ADXDK-GUID-F7B63052-2AC2-4E25-A50D-CF8F0F2ADCAB" class="sect3"><span class="enumeration_section">23.2.6</span> Sample Xdiff Instance Document</h3>
<div>
<div class="section">
<p>This section shows the <code>Xdiff</code> instance document produced by the comparison of these two XML files described in the previous section. The sections that follow explain the XML processing instructions and the operations on this document.</p>
<p>You can invoke <code>XmlDiff</code>:</p>
<pre dir="ltr">&gt; xmldiff book1.xml book2.xml
</pre>
<p>You can also examine the sample application for arguments and flags.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-F7B63052-2AC2-4E25-A50D-CF8F0F2ADCAB__GUID-911590D7-7364-4788-AFA0-233514ABBEF8">
<p class="titleinexample">Example 23-2 Sample Xdiff Instance Document</p>
<pre dir="ltr">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;xd:xdiff xsi:schemaLocation=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd
xmlns:xd=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; 
xmlns:oraxdfns_0=&#34;http://booklist.oracle.com&#34;&gt;
<span class="bold">    &lt;?oracle-xmldiff operations-in-docorder=&#34;true&#34; output-model=&#34;snapshot&#34; </span>
<span class="bold">        diff-algorithm=&#34;global&#34;?&gt; </span>
    &lt;xd:delete-node xd:node-type=&#34;element&#34; xd:xpath=&#34;/oraxdfns_0
              :booklist[1]/oraxdfns_0:book[2]&#34;/&gt;
    &lt;xd:update-node xd:node-type=&#34;attribute&#34; 
         xd:parent-xpath=&#34;/oraxdfns_0:booklist[1]/oraxdfns_0:book[3]/oraxdfns_0
              :title[1]&#34; xd:attr-local=&#34;country&#34;&gt;
                &lt;xd:content&gt;US&lt;/xd:content&gt;
    &lt;/xd:update-node&gt;
    &lt;xd:append-node xd:node-type=&#34;element&#34; xd:parent-xpath=&#34;/oraxdfns_0
              :booklist[1]/oraxdfns_0:book[4]&#34;&gt;
        &lt;xd:content&gt;
            &lt;oraxdfns_0:description&gt; This is a classic &lt;/oraxdfns_0:description&gt;
        &lt;/xd:content&gt;
    &lt;/xd:append-node&gt;
    &lt;xd:insert-node-before xd:node-type=&#34;element&#34; xd:xpath=&#34;/oraxdfns_0
              :booklist[1]/oraxdfns_0:book[5]/oraxdfns_0:author[1]&#34;&gt;
        &lt;xd:content&gt;
            &lt;oraxdfns_0:edition&gt;Hardcover&lt;/oraxdfns_0:edition&gt;
        &lt;/xd:content&gt;
    &lt;/xd:insert-node-before&gt;
    &lt;xd:update-node xd:node-type=&#34;text&#34; xd:xpath=&#34;/oraxdfns_0
           :booklist[1]/oraxdfns_0:book[5]/oraxdfns_0:price[1]/text()[1]&#34;&gt;
        &lt;xd:content&gt;12.99&lt;/xd:content&gt;
    &lt;/xd:update-node&gt;
&lt;/xd:xdiff&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK19838"></a>
<div class="props_rev_3"><a id="GUID-707B667B-9A93-40E0-A109-1FE89C58BF47"></a>
<h3 id="ADXDK-GUID-707B667B-9A93-40E0-A109-1FE89C58BF47" class="sect3"><span class="enumeration_section">23.2.7</span> Output Model and XML Processing Instructions</h3>
<div>
<p>The <code>Xdiff</code> instance document uses some XML processing instructions (shown in bold in the previous section) that are used to represent certain aspects of the differencing process. See <span class="q">&#34;<a href="adx_c_diff.htm#GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94">Xdiff Schema</a>.&#34;</span> These instructions and related options are:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>operations-in-docorder</code>: Options are <code>true</code> or <code>false</code>:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>true</code>&mdash;The <code>Xdiff</code> instance document refers to the nodes from the first document in the same order as in the document.</p>
</li>
<li>
<p><code>false</code>&mdash;The <code>Xdiff</code> instance document does not refer to the nodes from the first document in the same order as in the document.</p>
</li>
</ul>
<p>The output of global optimization meets the <code>operations-in-docorder</code> requirement, but local optimization does not.</p>
</li>
<li>
<p><code>output-model</code>: Options are:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>snapshot</code>&mdash;<code>Xmldiff</code> generates output in snapshot model and follows the UNIX <span class="italic">diff</span> model. Each operation uses <code>XPath</code> as if no operations have been applied to the input document. This is the default. <code>XmlPatch</code> can handle this model only if <code>operations-in-docorder</code> is set to <code>true</code> and the <code>XPath</code>s are simple. Simple <code>XPath</code>s require a child axis, no wild cards, and must use positional predicates, such as <code>/root[1]/child[2]/text()[2]</code>.</p>
</li>
<li>
<p><code>current</code>&mdash;Each operation uses <code>XPath</code> as if all operations up to the previous one have been applied to the input document. Even though <code>XmlDiff</code> does not generate differences in the current model, <code>XmlPatch</code> can handle a hand-crafted <code>diff</code> document in the current model</p>
</li>
</ul>
</li>
<li>
<p><code>diff-algorithm</code>: Options indicate which optimization generated the differences.</p>
<ul style="list-style-type: disc;">
<li>
<p>Global optimization</p>
</li>
<li>
<p>Local optimization</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-707B667B-9A93-40E0-A109-1FE89C58BF47__GUID-EEF18D90-7EA1-47B4-B997-B8989D01484F">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="adx_c_diff.htm#GUID-21B69703-474D-4F5A-9804-DD67F1EBC279">User Options for Optimization</a>.&#34;</span></p>
</div>
</li>
</ul>
</div>
</div>
<a id="ADXDK1042"></a><a id="ADXDK19839"></a>
<div class="props_rev_3"><a id="GUID-BBB028EC-736C-4F02-B330-75A03B96C1E6"></a>
<h3 id="ADXDK-GUID-BBB028EC-736C-4F02-B330-75A03B96C1E6" class="sect3"><span class="enumeration_section">23.2.8</span> Xdiff Operations</h3>
<div>
<p><code>XmlDiff</code> captures differences using operations indicated by the <code>Xdiff</code> instance document.</p>
<div class="tblformal" id="GUID-BBB028EC-736C-4F02-B330-75A03B96C1E6__GUID-F418F0B5-0171-45B7-91C2-43BD5FDA9ABD">
<p class="titleintable">Table 23-2 Xdiff Operation Attributes</p>
<table class="cellalignment650" title="Xdiff Operation Attributes" summary="Lists and describes the attributes of an Xdiff operation.">
<thead>
<tr class="cellalignment644">
<th class="cellalignment678" id="d109880e1412">Attribute</th>
<th class="cellalignment686" id="d109880e1415">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e1420" headers="d109880e1412">
<p><code>parent-path</code> or <code>xpath</code></p>
</td>
<td class="cellalignment687" headers="d109880e1420 d109880e1415">
<p>Specifies the <code>XPATH</code> location of the parent node of the operand node or the <code>XPATH</code> location of node.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e1437" headers="d109880e1412">
<p><code>node-type</code></p>
</td>
<td class="cellalignment687" headers="d109880e1437 d109880e1415">
<p>Specifies the type of the operand node.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e1445" headers="d109880e1412">
<p><code>content</code></p>
</td>
<td class="cellalignment687" headers="d109880e1445 d109880e1415">
<p>Child element that specifies the new subtree or value appended or inserted.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The <code>Xdiff</code> operations, presented in the <code>Xdiff</code> Instance Document, are:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>append-node</code>:</p>
<p>The <code>append-node</code> element specifies that a node of the given type is added as the last child of the given parent.</p>
</li>
<li>
<p><code>insert-node-before</code>:</p>
<p>The <code>insert-node-before</code> element specifies that a node of the given type is inserted before the given reference node.</p>
</li>
<li>
<p><code>delete-node</code>:</p>
<p>The <code>delete-node</code> element specifies that the node be deleted along with all its children. You can use this element to delete elements, comments, and so on.</p>
</li>
<li>
<p><code>update-node</code>:</p>
<p><code>update-node</code> specifies that the value associated with the node with the given <code>XPath</code> expression is updated to the new value, which is specified. Content is the value for a text node. The value of an attribute is the value for an attribute node.</p>
<ul style="list-style-type: disc;">
<li>
<p>Update for Text Nodes:</p>
<ul style="list-style-type: disc;">
<li>
<p>Generation of update node operations can be turned off by the user.</p>
</li>
<li>
<p>The value of an attribute is the value for an attribute node.</p>
</li>
<li>
<p><code>update-node</code> is generated for text nodes only by global optimization.</p>
</li>
</ul>
</li>
<li>
<p>Update for Elements:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>XmlDiff</code> does not generate update operations for element nodes.</p>
<p>You can either manually modify the <code>Xdiff</code> instance document to create an update operation that works with <code>XmlPatch</code>, or provide a totally hand-written <code>Xdiff</code> instance document. All children of the element operated on by the update are deleted. Any new subtree specified under the content node is imported.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<a id="ADXDK19840"></a>
<div class="props_rev_3"><a id="GUID-4BF58AA7-A438-4663-9483-2DEAAC908885"></a>
<h3 id="ADXDK-GUID-4BF58AA7-A438-4663-9483-2DEAAC908885" class="sect3"><span class="enumeration_section">23.2.9</span> Format of Xdiff Instance Document</h3>
<div>
<p>The output of <code>XmlDiff</code>, the <code>Xdiff</code> instance document, is in XML format and conforms to the <code>Xdiff</code> schema shown in the next section.</p>
<p>The output document contains a sequence of operations describing the differences between the two input documents. If you apply the differences from the first document, you get the second document.</p>
</div>
</div>
<a id="ADXDK19842"></a><a id="ADXDK19841"></a>
<div class="props_rev_3"><a id="GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94"></a>
<h3 id="ADXDK-GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94" class="sect3"><span class="enumeration_section">23.2.10</span> Xdiff Schema</h3>
<div>
<p><a href="adx_c_diff.htm#GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94__BABJEFEE">Example 23-3</a> shows the <code>Xdiff</code> schema to which the <code>Xdiff</code> instance document (output) adheres.</p>
<div class="example" id="GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94__BABJEFEE">
<p class="titleinexample">Example 23-3 Xdiff Schema: xdiff.xsd</p>
<pre dir="ltr">&lt;schema targetNamespace=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd&#34; 
    xmlns=&#34;http://www.w3.org/2001/XMLSchema&#34; 
    xmlns:xd=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd&#34; 
    version=&#34;1.0&#34; elementFormDefault=&#34;qualified&#34;
    attributeFormDefault=&#34;qualified&#34;&gt; 
    &lt;annotation&gt; 
        &lt;documentation&gt; 
         Defines the structure of XML documents that capture the difference 
         between two XML documents. Changes that are not supported by Oracle 
         XmlDiff may not be expressible in this schema. 
           
       &#39;oracle-xmldiff&#39; PI in Xdiff document:
 
       We use &#39;oracle-xmldiff&#39; PI to describe certain aspects of the diff.
       The PI denotes values for &#39;operations-in-docorder&#39; and &#39;output-model&#39;.
       The output of XmlDiff has the PI always. If the user hand-codes a diff doc
       then it must also have the PI in it as the first child of top level xdiff
       element, to be able to call XmlPatch.
 
       operations-in-docorder: 
       Can be either &#39;true&#39; or &#39;false&#39;.
       If true, the operations in the diff document refer to the
       elements of the input doc in the same order as document order. Output of
       global algorithm meets this requirement while local does not.
       
       output-model:
       output models for representing the diff. Can be either &#39;Snapshot&#39; or 
       &#39;Current&#39;.
 
       Snapshot model:
       Each operation uses Xpaths as if no operations
       have been applied to the input document. (like UNIX diff)
       This is the model used in the output of XmlDiff. XmlPatch works with 
       this (and the current model too).
       For XmlPatch to handle this model, &#34;operations-in-docorder&#34; must be 
       true and the Xpaths must be simple. (see XmlDif C API documentation).
 
       Current model:
       Each operation uses Xpaths as if all operations till the previous one
       have been applied to the input document. Works with XmlPatch even if 
       the &#39;operations-in-docorder&#39; criterion is not met and the xpaths are 
       not simple.
       &lt;!-- Example:
            &lt;?oracle-xmldiff operations-in-docorder=&#34;true&#34; output-model=
            &#34;snapshot&#34; diff-algorithm=&#34;global&#34;?&gt;
        --&gt;
      &lt;/documentation&gt; 
    &lt;/annotation&gt; 
    &lt;!-- Enumerate the supported node types --&gt; 
    &lt;simpleType name=&#34;xdiff-nodetype&#34;&gt; 
        &lt;restriction base=&#34;string&#34;&gt; 
            &lt;enumeration value=&#34;element&#34;/&gt; 
            &lt;enumeration value=&#34;attribute&#34;/&gt; 
            &lt;enumeration value=&#34;text&#34;/&gt; 
            &lt;enumeration value=&#34;cdata&#34;/&gt; 
            &lt;enumeration value=&#34;entity-reference&#34;/&gt;
            &lt;enumeration value=&#34;entity&#34;/&gt;
            &lt;enumeration value=&#34;processing-instruction&#34;/&gt;
            &lt;enumeration value=&#34;notation&#34;/&gt;
            &lt;enumeration value=&#34;comment&#34;/&gt;            
         &lt;/restriction&gt; 
    &lt;/simpleType&gt;
 
    &lt;element name=&#34;xdiff&#34;&gt; 
        &lt;complexType&gt; 
            &lt;choice minOccurs=&#34;0&#34; maxOccurs=&#34;unbounded&#34;&gt; 
                &lt;element name=&#34;append-node&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name=&#34;content&#34; type=&#34;anyType&#34;/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt; 
                        &lt;attribute name=&#34;xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;parent-xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;attr-local&#34; type=&#34;string&#34;/&gt;
                        &lt;attribute name=&#34;attr-nsuri&#34; type=&#34;string&#34;/&gt;
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name=&#34;insert-node-before&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name=&#34;content&#34; type=&#34;anyType&#34;/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name=&#34;xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt;
 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name=&#34;delete-node&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt;
                        &lt;attribute name=&#34;xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;parent-xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;attr-local&#34; type=&#34;string&#34;/&gt;
                        &lt;attribute name=&#34;attr-nsuri&#34; type=&#34;string&#34;/&gt;
                    &lt;/complexType&gt; 
                &lt;/element&gt;
                 &lt;element name=&#34;update-node&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name=&#34;content&#34; type=&#34;anyType&#34;/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt; 
                        &lt;attribute name=&#34;parent-xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;attr-local&#34; type=&#34;string&#34;/&gt;
                        &lt;attribute name=&#34;attr-nsuri&#34; type=&#34;string&#34;/&gt;
                    &lt;/complexType&gt; 
                &lt;/element&gt;
                &lt;element name=&#34;rename-node&#34;&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name=&#34;content&#34; type=&#34;anyType&#34;/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name=&#34;xpath&#34; type=&#34;string&#34;/&gt; 
                        &lt;attribute name=&#34;node-type&#34; type=&#34;xd:xdiff-nodetype&#34;/&gt; 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
            &lt;/choice&gt; 
         &lt;attribute name=&#34;xdiff-version&#34; type=&#34;string&#34;/&gt; 
        &lt;/complexType&gt; 
    &lt;/element&gt; 
&lt;/schema&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK19844"></a><a id="ADXDK19843"></a>
<div class="props_rev_3"><a id="GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D"></a>
<h3 id="ADXDK-GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D" class="sect3"><span class="enumeration_section">23.2.11</span> Using XMLDiff in an Application</h3>
<div>
<p>In an application, <code>XmlDiff</code> takes the source types and locations of the input documents as arguments. The source type can be a URL, file, <code>orastream</code> and <code>stream</code> context pointers, buffer, and <code>buffer_length</code> pointers or the pointer to a DOM document element (<code>docelement</code>).</p>
<p><code>XmlDiff</code> returns the document node for the DOM for the <code>Xdiff</code> instance document.</p>
<p>XmlDiff builds the DOM for the two documents, if they are not already provided as DOM, before performing a comparison.</p>
<div class="infoboxnotealso" id="GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D__GUID-C52B078B-71D7-45E8-9C6E-172FC550B25B">
<p class="notep1">See Also:</p>
<p><a class="olink CAXML6192" target="_blank" href="../CAXML/xmldiff.htm#CAXML6192"><span class="italic">Oracle Database XML C API Reference</span></a> for the C API for the flags that control the behavior of <code>XmlDiff</code></p>
</div>
<div class="example" id="GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D__GUID-9D8E4169-0CD1-401C-A097-F0F9D7B70077">
<p class="titleinexample">Example 23-4 XMLDiff Application</p>
<pre dir="ltr"># include &lt;xmldf.h&gt;
...
xmlctx     *xctx;
xmldocnode *doc1, *doc2, *doc3;
uword       hash_level;
oratext    *s, *inp1 = &#34;book1.xml&#34;, *inp2=&#34;book2.xml&#34;;
xmlerr      err;
ub4         flags;

flags = 0; /* defaults : global algorithm */
hash_level = 0; /* no hashing */
/* create XML meta context */
if (!(xctx = XmlCreate(&amp;err, (oratext *) &#34;XmlDiff&#34;, NULL)))
{
   printf(&#34;Failed to create XML context, error %u\n&#34;,
(unsigned) err);
err_exit(&#34;Exiting&#34;);
}
/* Load the two input files */
if (!(doc1 = XmlLoadDom(xctx, &amp;err, &#34;file&#34;, inp1, &#34;discard_whitespace&#34;, TRUE,
 NULL)))
{
   printf(&#34;Parsing first file failed, error %u\n&#34;, (unsigned)err);
   err_exit((oratext *)&#34;Exiting.&#34;);
}
if (!(doc2 = XmlLoadDom(xctx, &amp;err, &#34;file&#34;, inp2, &#34;discard_whitespace&#34;, TRUE,
    NULL)))
{
   printf(&#34;Parsing second file failed, error %u\n&#34;, (unsigned)err);
   err_exit((oratext *)&#34;Exiting.&#34;);
}
 
/* run XmlDiff on the DOM trees. */
 
doc3 = XmlDiff(xctx, &amp;err, flags, XMLDF_SRCT_DOM, doc1, NULL, XMLDF_SRCT_DOM,
               doc2, NULL,hash_level, NULL);
 
if(!doc3)
   printf(&#34;XmlDiff Failed, error %u\n&#34;, (unsigned)err);
else
{
if(err != XMLERR_OK)
printf(&#34;XmlDiff returned error %u\n&#34;, (unsigned)err);
/* Now we have the DOM tree in doc3 which represent the Diff */
...
}
 
XmlFreeDocument(xctx, doc1);
XmlFreeDocument(xctx, doc2);
XmlFreeDocument(xctx, doc3);
XmlDestroy(xctx);
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDK19846"></a><a id="ADXDK19845"></a>
<div class="props_rev_3"><a id="GUID-CB4DB221-21E5-4E33-98CC-9E07C28567C0"></a>
<h3 id="ADXDK-GUID-CB4DB221-21E5-4E33-98CC-9E07C28567C0" class="sect3"><span class="enumeration_section">23.2.12</span> Customized Output</h3>
<div>
<p>A customized output builder stores differences in any format suitable to the application. You can create your own customized output builder, rather than using the default <code>Xdiff</code> instance document, which is generated by <code>XmlDiff</code> and that conforms to the <code>Xdiff</code> schema.</p>
<p>To create a customized output builder, you must provide a callback that can be called after <code>XmlDiff</code> determines the differences. The differences are passed to the callback as an array of <code>xmdlfop</code>. The callback may be called multiple times as the differences are being generated.</p>
<p>Using a customized output builder may perform better than using the default, because it does not have to maintain the internal state necessary for <code>XPath</code> generation.</p>
<p>By default, <code>XmlDiff</code> captures the differences in XML conforming to the <code>Xdiff</code> schema. If necessary, plug in your own output builder. The differences are represented as an array <code>xmldfop</code>. You must write an output builder callback function. The function signature is:</p>
<pre dir="ltr">xmlerr(*xdfobcb)(void *uctx, xmldfop *escript, ub4 escript_siz);
</pre>
<p><code>uctx</code> is the user specific context.</p>
<p><code>escript</code> is the array of size <code>escript_siz</code>:</p>
<pre dir="ltr">diff[escript_siz]
</pre>
<p><code>mctx</code> is the memory context.</p>
<p>Supply this memory context through properties to <code>XmlDiff()</code>. Use this memory context to allocate <code>escript</code>. You must later free <code>escript</code>.</p>
<p>Invoke the output builder callback after the differences have been found which happens even before the invocation of <code>XmlDiff()</code> returns. The output builder callback can be called multiple times.</p>
<div class="example" id="GUID-CB4DB221-21E5-4E33-98CC-9E07C28567C0__GUID-C4B6D5C8-4448-4073-84FD-272679581F03">
<p class="titleinexample">Example 23-5 Customized XMLDiff Output</p>
<pre dir="ltr"> /* Sample useage:  */
 ...
 #include &lt;orastruc.h&gt; / * for &#39;oraprop&#39; * /
 ...
 static oraprop diff_props[] = {
    ORAPROP(XMLDF_PROPN_CUSTOM_OB, XMLDF_PROPI_CUSTOM_OB, POINTER),
    ORAPROP(XMLDF_PROPN_CUSTOM_OBMCX, XMLDF_PROPI_CUSTOM_OBMCX, POINTER),
    ORAPROP(XMLDF_PROPN_CUSTOM_OBUCX, XMLDF_PROPI_CUSTOM_OBUCX, POINTER),
        { NULL }
  }; 
  ...
  oramemctx *mymemctx;
  ...
  xmlerr myob(void *uctx,  xmldfop *escript, ub4 escript_siz)
  {
     /* process diff which is available in escript * /
     
     /* free escript - the caller has to do this * /
     OraMemFree(mymemctx, escript);
  }
 
  main()
  {
   ...
      myctxt  *myctx;
 
      diff_props[0].value_oraprop.p_oraprop_v = myob;
      diff_props[1].value_oraprop.p_oraprop_v = mymemctx;
      diff_props[2].value_oraprop.p_oraprop_v = myctx;
      XmlDiff(xctx, &amp;err, 0, doc1, NULL, 0, doc2, NULL, 0, diff_props);
 ...
 
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADXDK2520"></a>
<div class="props_rev_3"><a id="GUID-45E03E82-7DE3-49C3-A29A-8AC3091566EE"></a>
<h2 id="ADXDK-GUID-45E03E82-7DE3-49C3-A29A-8AC3091566EE" class="sect2"><span class="enumeration_section">23.3</span> Using XmlPatch</h2>
<div>
<div class="section">
<p><code>XmlPatch</code> takes the <code>Xdiff</code> instance document, either as generated by <code>XmlDiff</code> or created by another mechanism, and follows the instructions in the <code>Xdiff</code> instance document to modify other XML documents as specified.</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><a href="adx_c_diff.htm#GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA">Using the XmlPatch Command-Line Utility</a></p>
</li>
<li>
<p><a href="adx_c_diff.htm#GUID-7C4C7410-A8FA-4EE7-9996-31799450485E">Using XmlPatch in an Application</a></p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="ADXDK19847"></a><a id="ADXDK2550"></a>
<div class="props_rev_3"><a id="GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA"></a>
<h3 id="ADXDK-GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA" class="sect3"><span class="enumeration_section">23.3.1</span> Using the XmlPatch Command-Line Utility</h3>
<div>
<div class="section">
<p><a href="adx_c_diff.htm#GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA__BABFFEGF" title="rows are XmlPatch command line options. first column is option name, second column description">Table 23-3</a> describes the <code>XmlPatch</code> command-line options:</p>
<div class="tblformal" id="GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA__BABFFEGF">
<p class="titleintable">Table 23-3 XmlPatch for C Command-Line Options</p>
<table class="cellalignment650" title="XmlPatch for C Command-Line Options" summary="rows are XmlPatch command line options. first column is option name, second column description">
<thead>
<tr class="cellalignment644">
<th class="cellalignment678" id="d109880e2209">Option</th>
<th class="cellalignment686" id="d109880e2212">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e2217" headers="d109880e2209">
<p><code>-e</code> encoding</p>
</td>
<td class="cellalignment687" headers="d109880e2217 d109880e2212">
<p>Specify default input-file encoding. If no encoding is specified in XML file, this encoding is assumed for input.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e2226" headers="d109880e2209">
<p><code>-E</code> encoding</p>
</td>
<td class="cellalignment687" headers="d109880e2226 d109880e2212">
<p>Specify output/data encoding. DOMs and patched document are created in this encoding. Default is UTF-8.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e2235" headers="d109880e2209">
<p><code>-i</code></p>
</td>
<td class="cellalignment687" headers="d109880e2235 d109880e2212">
<p>Interpret file names as URLs.</p>
</td>
</tr>
<tr class="cellalignment644">
<td class="cellalignment680" id="d109880e2243" headers="d109880e2209">
<p><code>-h</code></p>
</td>
<td class="cellalignment687" headers="d109880e2243 d109880e2212">
<p>Show this usage help.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" --></div>
</div>
<a id="ADXDK19849"></a><a id="ADXDK19848"></a>
<div class="props_rev_3"><a id="GUID-7C4C7410-A8FA-4EE7-9996-31799450485E"></a>
<h3 id="ADXDK-GUID-7C4C7410-A8FA-4EE7-9996-31799450485E" class="sect3"><span class="enumeration_section">23.3.2</span> Using XmlPatch in an Application</h3>
<div>
<div class="section">
<p><code>XmlPatch</code> takes the source types and locations of the input document and the <code>diff</code> document as arguments. The source type can be a URL, file, <code>orastream</code> and <code>stream</code> context pointers, buffer and <code>buffer_length</code> pointers, or the pointer to a DOM document element (<code>docelement</code>).</p>
<div class="infoboxnotealso" id="GUID-7C4C7410-A8FA-4EE7-9996-31799450485E__GUID-07697ED1-8946-4A67-AD05-5087FFF23257">
<p class="notep1">See Also:</p>
<p><a class="olink CAXML6201" target="_blank" href="../CAXML/xmldiff.htm#CAXML6201"><span class="italic">Oracle Database XML C API Reference</span></a> for the C API for the flags that control the behavior of <code>XmlPatch</code></p>
</div>
<p>The modes that were set by the <code>Xdiff</code> schema affect how <code>XmlPatch</code> works.</p>
<p>If the <code>output-model</code> is <code>Snapshot</code>, <code>XmlPatch</code> only works if <code>operations-in-docorder</code> is <code>TRUE</code>.</p>
<p>If the <code>output-model</code> is <code>Current</code>, it is not necessary that <code>operations-in-docorder</code> be set to <code>TRUE</code>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-7C4C7410-A8FA-4EE7-9996-31799450485E__GUID-A71CE5FF-ADAC-457C-A02D-401ABE25AE8E">
<p class="titleinexample">Example 23-6 Sample Application for XmlPatch</p>
<pre dir="ltr">...
#include &lt;xmldf.h&gt;
...
xmlctx     *xctx;
xmldocnode *doc1, *doc2;
oratext    *s;
oratext    *inp1 = &#34;book1.xml&#34;; /* input document */
oratext    *inp2 = &#34;diff.xml&#34;, /* diff document */
xmlerr      err;
 
/* create XML meta context */
if (!(xctx = XmlCreate(&amp;err, (oratext *) &#34;XmlPatch&#34;, NULL)))
{
   printf(&#34;Failed to create XML context, error %u\n&#34;,
(unsigned) err);
err_exit(&#34;Exiting&#34;);
}
/* Load the two input files */
if (!(doc1 = XmlLoadDom(xctx, &amp;err, &#34;file&#34;, inp1, &#34;discard_whitespace&#34;, TRUE,
    NULL)))
{
   printf(&#34;Parsing first file failed, error %u\n&#34;, (unsigned)err);
   err_exit((oratext *)&#34;Exiting.&#34;);
}
if (!(doc2 = XmlLoadDom(xctx, &amp;err, &#34;file&#34;, inp2, &#34;discard_whitespace&#34;, TRUE,
    NULL)))
{
   printf(&#34;Parsing second file failed, error %u\n&#34;, (unsigned)err);
   err_exit((oratext *)&#34;Exiting.&#34;);
}
 
/* call XmlPatch */
if(!XmlPatch(xctx, &amp;err, 0, XMLDF_SRCT_DOM, doc1, NULL, XMLDF_SRCT_DOM,
           doc2, NULL, NULL));
 
   printf(&#34;XmlPatch Failed, error %u\n&#34;, (unsigned)err);
else
{
if(err != XMLERR_OK)
printf(&#34;XmlPatch returned error %u\n&#34;, (unsigned)err);
/* Now we have the patched document in doc1 */
...
}
 
XmlFreeDocument(xctx, doc1);
XmlFreeDocument(xctx, doc2);
XmlDestroy(xctx);
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADXDK19850"></a><a id="ADXDK2530"></a>
<div class="props_rev_3"><a id="GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF"></a>
<h2 id="ADXDK-GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF" class="sect2"><span class="enumeration_section">23.4</span> Using XmlHash</h2>
<div>
<div class="section">
<p>XDK provides <code>XmlHash,</code> which computes a hash value for an XML tree or subtree. If the hash values of two subtrees are equal, it is highly probable that they are the same XML. You can use <code>XmlHash</code> to do a quick comparison, for example, to see if the XML tree is already in the database.</p>
<p>You can run <code>XmlDiff</code> again, if necessary, on any matches, to be absolutely certain there is a match. You can compute the hash value of the new document and query the database for it.</p>
<p><a href="adx_c_diff.htm#GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF__BABDABHF">Example 23-7</a> shows a sample program that uses <code>XmlHash</code>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF__BABDABHF">
<p class="titleinexample">Example 23-7 XmlHash Program</p>
<pre dir="ltr">sword main(sword argc, char *argv[])
{
   xmlctx     *xctx;
   xmldfsrct   srct;
   oratext    *data_encoding, *input_encoding, *s, *inp1;
   ub1         flags;
   xmlerr      err;
   ub4         num_args;
   xmlhasht    digest;
   flags = 0; /* defaults */
   srct = XMLDF_SRCT_FILE;
   inp1 = &#34;somexml.xml&#34;;
   xctx = XmlCreate(&amp;err, (oratext *) &#34;XmlHash&#34;, NULL);
 
   if (!xctx)
   {
      /* handle error with creating xml context and exit */
      ...
   }
 
   /* run XmlHash */
   err = XmlHash(xctx, &amp;digest, 0, srct, inp1, NULL, NULL);
   if(err)
      printf(&#34;XmlHash returned error:%d \n&#34;, err);
   else
      txdfha_pd(digest);
 
   XmlDestroy(xctx);
 
   return (sword )err;
}
 
/* print bytes in xml hash */
static void txdfha_pd(xmlhasht digest)
{
   ub4  i;
 
   for(i = 0; i &lt; digest.l_xmlhasht; i++)
      printf(&#34;%x &#34;, digest.d_xmlhasht[i]);
 
   printf(&#34;\n&#34;);
}
</pre></div>
<!-- class="example" --></div>
<a id="ADXDK19851"></a>
<div class="props_rev_3"><a id="GUID-6DE2C17C-A24B-428D-9BED-9A6FC9E52390"></a>
<h3 id="ADXDK-GUID-6DE2C17C-A24B-428D-9BED-9A6FC9E52390" class="sect3"><span class="enumeration_section">23.4.1</span> Invoking XmlDiff and XmlPatch</h3>
<div>
<div class="section">
<p><code>XmlDiff</code> and <code>XmlPatch</code> can be called as command-line tools and from the C language. They are also available as SQL functions.</p>
<div class="infoboxnotealso" id="GUID-6DE2C17C-A24B-428D-9BED-9A6FC9E52390__GUID-88A4522A-6FF1-4A9D-8643-E5D42F877A9D">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink SQLRF20025" target="_blank" href="../SQLRF/functions257.htm#SQLRF20025"><span class="italic">Oracle Database SQL Language Reference,</span></a> <code>XMLDiff</code></p>
</li>
<li>
<p><a class="olink SQLRF20026" target="_blank" href="../SQLRF/functions263.htm#SQLRF20026"><span class="italic">Oracle Database SQL Language Reference</span></a>, <code>XMLPatch</code></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment643">
<tr>
<td class="cellalignment670">
<table class="cellalignment648">
<tr>
<td class="cellalignment647"><a href="adx_c_sproc.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment647"><a href="adx_c_soap.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2001, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment672">
<table class="cellalignment646">
<tr>
<td class="cellalignment647"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment647"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment647"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment647"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment647"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment647"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>