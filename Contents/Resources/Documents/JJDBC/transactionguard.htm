<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-71029"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Transaction%20Guard%20for%20Java"></a><title>Transaction Guard for Java</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="description" content="This book describes how to use Oracle JDBC drivers to develop powerful Java database applications."/>
<meta name="dcterms.created" content="2014-06-30T1:22:37Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database JDBC Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49300-05"/>
<meta name="dcterms.isVersionOf" content="JJDBC"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="part6.htm" title="Previous" type="text/html"/>
<link rel="Next" href="appcontnew.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49300-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">39/55</span> <!-- End Header -->
<div id="JJDBC29121" class="chapter"><a id="CIHCDEHC"></a>
<h1 class="chapter"><span class="secnum">26</span> Transaction Guard for Java</h1>
<p>Oracle Database 12<span class="italic">c</span> Release 1 (12.1) introduces Transaction Guard feature that provides a generic infrastructure for at-most-once execution during planned and unplanned outages and duplicate submissions. This chapter discusses Transaction Guard for Java in the following sections:</p>
<ul>
<li>
<p><a href="#CIHIAAFH">Overview of Transaction Guard for Java</a></p>
</li>
<li>
<p><a href="#CIHIIIAF">Transaction Guard for Java APIs</a></p>
</li>
<li>
<p><a href="#CIHGJDCJ">Using Transaction Guard APIs: Complete Example</a></p>
</li>
<li>
<p><a href="#CIHIBHCF">Using Server-Side Transaction Guard APIs</a></p>
</li>
</ul>
<a id="CIHIAAFH"></a>
<div id="JJDBC29122" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of <a id="sthref854"></a>Transaction Guard for Java</h2>
<p>For the current applications, determining the outcome of the last commit operation in a guaranteed and scalable manner, following a communication failure to the server, is an unsolved problem. In many cases, the end users are asked to follow certain steps to avoid resubmitting duplicate request. For example, some applications warn users not to click the Submit button twice because if it is not followed, then users may unintentionally purchase the same items twice and submit multiple payments for the same invoice.</p>
<p>To solve this problem, Transaction Guard for Java provides transaction idempotence, that is, every transaction has <a id="sthref855"></a><a id="sthref856"></a>at-most-once execution that prevents applications from submitting duplicate transactions. Every transaction is tagged with a <a id="sthref857"></a><a id="sthref858"></a><a id="sthref859"></a><a id="sthref860"></a>Logical Transaction Identifier (<code>LTXID</code>), which can be used by the application after the occurrence of a failure to verify whether the transaction had committed before the failure or not. For example, if the commit calls do not return, then, using the <code>LTXID</code>, the application can find out whether it succeeded or not.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADFNS8000" href="../ADFNS/adfns_trans_idemp_guard.htm#ADFNS8000"><span class="italic">Oracle Database Development Guide</span></a></div>
<p>The Application Continuity for Java feature uses Transaction Guard for Java internally, which enables transparent session recovery and replay of SQL statements (queries and DMLs) since the beginning of the in-flight transaction. Application Continuity enables recovery of work after the occurrence of a planned or unplanned outage and Transaction Guard for Java ensures transaction idempotence. When an outage occurs, the recovery restores the state exactly as it was before the failure occurred.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="appcontnew.htm#CJADIIJJ">&#34;Application Continuity for Java&#34;</a></div>
</div>
<!-- class="sect1" -->
<a id="CIHIIIAF"></a>
<div id="JJDBC29123" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Transaction Guard for Java APIs</h2>
<p>This section discusses the APIs associated with Transaction Guard for Java for the following activities:</p>
<ul>
<li>
<p><a href="#CIHJEEAF">Retrieving the Logical Transaction Identifiers</a></p>
</li>
<li>
<p><a href="#CIHEFHAI">Retrieving the Updated Logical Transaction Identifiers</a></p>
</li>
</ul>
<a id="CIHJEEAF"></a>
<div id="JJDBC29124" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Retrieving the Logical Transaction Identifiers</h3>
<p>Use the <a id="sthref861"></a><code>getLogicalTransactionId</code> method of the <code>oracle.jdbc.OracleConnection</code> interface to retrieve the current Logical Transaction Identifiers that are sent by the server. This method call does not make a database round-trip.</p>
<p class="subhead2"><a id="JJDBC29125"></a>Example</p>
<pre>      OracleConnection oconn = (OracleConnection) ods.getConnection();
      ...
      // Getting the 1st LTXID after connecting
      LogicalTransactionId firstLtxid = oconn.getLogicalTransactionId();
</pre></div>
<!-- class="sect2" -->
<a id="CIHEFHAI"></a>
<div id="JJDBC29126" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Retrieving the Updated Logical Transaction Identifiers</h3>
<p>Use the <a id="sthref862"></a><code>oracle.jdbc.LogicalTransactionIdEventListener</code> interface for receiving updates to Logical Transaction Identifiers. You must implement this interface in your application to process the Logical Transaction Identifier events.</p>
<div id="JJDBC29127" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref863"></a>
<h4 class="sect3">Registering Event Listeners</h4>
<p>Use the <code><a id="sthref864"></a>addLogicalTransactionIdEventListener</code> method to register a listener to the Logical Transaction Identifier events.</p>
<p class="subhead2"><a id="JJDBC29128"></a>Example</p>
<pre>      OracleConnection oconn = (OracleConnection) ods.getConnection();
      ...
      // The subsequent LTXID updates can be obtained through the listener
      oconn.addLogicalTransactionIdEventListener(this);

</pre>
<p>You can also use the <code>addLogicalTransactionIdEventListener(LogicalTransactionIdEventListener listener, java.util.concurrent.Executor executor)</code> method to register a listener with an executor.</p>
</div>
<!-- class="sect3" -->
<div id="JJDBC29129" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref865"></a>
<h4 class="sect3">Unregistering Event Listeners</h4>
<p>Use the <code><a id="sthref866"></a>removeLogicalTransactionIdEventListener</code> method to unregister a listener from the Logical Transaction Identifier events.</p>
<p class="subhead2"><a id="JJDBC29130"></a>Example</p>
<pre>      OracleConnection oconn = (OracleConnection) ods.getConnection();
      ...
      // The subsequent LTXID updates can be obtained through the listener
      oconn.removeLogicalTransactionIdEventListener(this);

</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CIHGJDCJ"></a>
<div id="JJDBC29131" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using Transaction Guard APIs: Complete Example</h2>
<p>The following is a complete example using the Transaction Guard APIs.</p>
<pre>      import oracle.jdbc.pool.OracleDataSource;
      import oracle.jdbc.OracleConnection;
      import oracle.jdbc.LogicalTransactionId;
      import oracle.jdbc.LogicalTransactionIdEvent;
      import oracle.jdbc.LogicalTransactionIdEventListener;
      
      public class transactionGuardExample
      {
            ...
            ...
            OracleDataSource ods = new OracleDataSource();
            ods.setURL(url);
            ods.setUser(&#34;user&#34;);
            ods.setPassword(&#34;password&#34;);
 
            OracleConnection oconn = (OracleConnection) ods.getConnection();
 
            // Getting the 1st LTXID after connecting
            LogicalTransactionId firstLtxid = oconn.getLogicalTransactionId();
 
            // The subsequent LTXID updates can be obtained via the listener
            oconn.addLogicalTransactionIdEventListener(this);
        }
 
      public class LtxidListenerImpl
        implements LogicalTransactionIdEventListener
      {
        ...
 
        public void onLogicalTransactionIdEvent(LogicalTransactionIdEvent ltxidEvent)
        {
          LogicalTransactionId newLtxid = ltxidEvent.getLogicalTransactionId();
          // process newLtxid ......
        }
      }
</pre></div>
<!-- class="sect1" -->
<a id="CIHIBHCF"></a>
<div id="JJDBC29132" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Using Server-Side Transaction Guard APIs</h2>
<p>The <code>DBMS_APP_CONT</code> package contains the <code><a id="sthref867"></a>GET_LTXID_OUTCOME</code> procedure that contains the server-side Transaction Guard APIs. This procedure forces the outcome of a transaction. If the transaction is not committed, then a fake transaction is committed. Otherwise, the state of the transaction is returned. By default, the <code>EXECUTE</code> privilege for this package is granted to Database Administrators.</p>
<p class="subhead2"><a id="JJDBC29133"></a>Syntax</p>
<pre>  PROCEDURE GET_LTXID_OUTCOME(CLIENT_LTXID        IN  RAW,
                              committed           OUT BOOLEAN,
                              USER_CALL_COMPLETED OUT BOOLEAN);
</pre>
<p class="subhead2"><a id="JJDBC29134"></a>Input Parameter</p>
<p><code>CLIENT_LTXID</code> specifies the <code>LTXID</code> from the client driver.</p>
<p class="subhead2"><a id="JJDBC29135"></a>Output Parameter</p>
<p><code>COMMITTED</code> specifies that the transaction is committed.</p>
<p><code>USER_CALL_COMPLETED</code> specifies that the user call, which committed the transaction, is complete.</p>
<p class="subhead2"><a id="JJDBC29136"></a>Exceptions</p>
<p><code>SERVER_AHEAD</code> is thrown when the server is ahead of the client. So, the transaction is an old transaction and must have already been committed.</p>
<p><code>CLIENT_AHEAD</code> is thrown when the client is ahead of the server. This can only happen if the server is flashed back or the <code>LTXID</code> is corrupted. In either of these situations, the outcome cannot be determined.</p>
<p><code>ERROR</code> is thrown when an error occurs during processing and the outcome cannot be determined. It specifies the error code raised during the execution of the current procedure.</p>
<p class="subhead2"><a id="JJDBC29149"></a>Example</p>
<p><a href="#BABBEAGE">Example 26-1</a> shows how you can call the <code>GET_LTXID_OUTCOME</code> procedure and find out the outcome of an <code>LTXID</code>:</p>
<div id="JJDBC29150" class="example">
<p class="titleinexample"><a id="BABBEAGE"></a>Example 26-1 Finding Out the Outcome of an LTXID</p>
<pre>    ...
    OracleConnection oconn = (OracleConnection) ods.getConnection();
    LogicalTransactionId ltxid = oconn.getLogicalTransactionId();
    boolean committed = false;
    boolean call_completed = false;
 
    try
    {
      CallableStatement cstmt = oconn.prepareCall(GET_LTXID_OUTCOME);
      cstmt.setObject(1, ltxid);
      cstmt.registerOutParameter(2, OracleTypes.BIT);
      cstmt.registerOutParameter(3, OracleTypes.BIT);
 
      cstmt.execute();
 
      committed = cstmt.getBoolean(2);
      call_completed = cstmt.getBoolean(3);
 
      System.out.println(&#34;LTXID committed ? &#34; + committed);
      System.out.println(&#34;User call completed ? &#34; + call_completed);
    }
    catch (SQLException sqlexc)
    {
      System.out.println(&#34;Calling GET_LTXID_OUTCOME failed&#34;);
      sqlexc.printStackTrace();
    }
</pre></div>
<!-- class="example" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2237">
<tr>
<td class="cellalignment2246">
<table class="cellalignment2242">
<tr>
<td class="cellalignment2241"><a href="part6.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2241"><a href="appcontnew.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2249">
<table class="cellalignment2240">
<tr>
<td class="cellalignment2241"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2241"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2241"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2241"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2241"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2241"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>