<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-71024"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Server-Side%20Internal%20Driver"></a><title>Server-Side Internal Driver</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="description" content="This book describes how to use Oracle JDBC drivers to develop powerful Java database applications."/>
<meta name="dcterms.created" content="2014-06-30T1:22:36Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database JDBC Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49300-05"/>
<meta name="dcterms.isVersionOf" content="JJDBC"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="instclnt.htm" title="Previous" type="text/html"/>
<link rel="Next" href="part3.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49300-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">16/55</span> <!-- End Header -->
<div id="JJDBC28250" class="chapter"><a id="BCGHCFCF"></a>
<h1 class="chapter"><span class="secnum">7</span> Server-Side Internal Driver</h1>
<p>This chapter covers the following topics:</p>
<ul>
<li>
<p><a href="#BCGGHHJD">Overview of the Server-Side Internal Driver</a></p>
</li>
<li>
<p><a href="#i1024903">Connecting to the Database</a></p>
</li>
<li>
<p><a href="#BABJIFAC">Session and Transaction Context</a></p>
</li>
<li>
<p><a href="#i1013483">Testing JDBC on the Server</a></p>
</li>
<li>
<p><a href="#CIHIEBGC">Loading an Application into the Server</a></p>
</li>
</ul>
<a id="BCGGHHJD"></a>
<div id="JJDBC28251" class="sect1">
<h2 class="sect1">Overview of the Server-Side Internal Driver</h2>
<p>The server-side internal driver is intrinsically tied to Oracle Database and to the embedded Java Virtual Machine, also known as Oracle <a id="sthref308"></a>Java Virtual Machine (Oracle <a id="sthref309"></a>JVM). The driver runs as part of the same process as the Database. It also runs within the default session, the same session in which the Oracle JVM was started. Each Oracle JVM session has a single implicit native connection to the Database session in which it exists. This connection is conceptual and is not a Java object. It is an inherent aspect of the session and cannot be opened or closed from within the JVM.</p>
<p>The server-side internal driver is optimized to run within the database server and provide direct access to SQL data and PL/SQL subprograms on the local database. The entire JVM operates in the same address space as the database and the <a id="sthref310"></a><a id="sthref311"></a>SQL engine. Access to the SQL engine is a function call. This enhances the performance of your Java Database Connectivity (JDBC) applications and is much faster than running a remote Oracle Net call to access the SQL engine.</p>
<p>The server-side internal driver supports the same features, application programming interfaces (APIs), and Oracle extensions as the client-side drivers. This makes application partitioning very straightforward. For example, if you have a Java application that is data-intensive, then you can easily move it into the database server for better performance, without having to modify the application-specific calls.</p>
</div>
<!-- class="sect1" -->
<a id="i1024903"></a>
<div id="JJDBC28252" class="sect1">
<h2 class="sect1">Connecting to the Database</h2>
<p>As described in the preceding section, the <a id="sthref312"></a><a id="sthref313"></a><a id="sthref314"></a><a id="sthref315"></a>server-side internal driver runs within a default session. Therefore, you are already connected. There are two methods to access the default connection:</p>
<ul>
<li>
<p>Use the <code>OracleDataSource.getConnection</code> method, with any of the following forms as the URL string:</p>
<ul>
<li>
<p><code>jdbc:oracle:kprb</code></p>
</li>
<li>
<p><code>jdbc:default:connection</code></p>
</li>
<li>
<p><code>jdbc:oracle:kprb:</code></p>
</li>
<li>
<p><code>jdbc:default:connection:</code></p>
</li>
</ul>
</li>
<li>
<p>Use the Oracle-specific <code>defaultConnection</code> method of the <code>OracleDriver</code> class.</p>
</li>
</ul>
<p>Using <code>defaultConnection</code> is generally recommended.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You are no longer required to register the <code>OracleDriver</code> class for connecting with the server-side internal driver.</div>
<p class="subhead2"><a id="JJDBC28253"></a>Connecting with the OracleDriver Class defaultConnection Method</p>
<p>The <code><a id="sthref316"></a></code><code>defaultConnection</code> method of the <code>oracle.jdbc.OracleDriver</code> class is an Oracle extension and always returns the same connection object. Even if you call this method multiple times, assigning the resulting connection object to different variable names, then only a single connection object is reused.</p>
<p>You need <span class="italic">not</span> include a connection string in the <code>defaultConnection</code> call. For example:</p>
<pre>import java.sql.*; 
import oracle.jdbc.*; 
  
class JDBCConnection 
{ 
  public static Connection connect() throws SQLException 
  { 
    Connection conn = null; 
    try {  
      // connect with the server-side internal driver
         conn = ora.defaultConnection(); 
      } 
 
    } catch (SQLException e) {...}
    return conn; 
  } 
}
</pre>
<p>Note that there is no <code>conn.close</code> call in the example. When JDBC code is running inside the target server, the connection is an implicit data channel, not an explicit connection instance as from a client. It should <span class="italic">not</span> be closed.</p>
<p>OracleDriver has a static variable to store a default connection instance. The method <code>OracleDriver.defaultConnection</code> returns this default connection instance if the connection exists and is not closed. Otherwise, it creates a new, open instance and stores it in the static variable and returns it to the caller.</p>
<p>Typically, you should use the <code>OracleDriver.defaultConnection</code> method. This method is faster and uses less resources. Java stored procedures should be carefully written. For example, to close statements before the end of each call.</p>
<p>Typically, you should not close the default connection instance because it is a single instance that can be stored in multiple places, and if you close the instance, each would become unusable. If it is closed, a later call to the <code>OracleDriver.defaultConnection</code> method gets a new, open instance.</p>
<p class="subhead2"><a id="JJDBC28254"></a>Connecting with the OracleDataSource.getConnection Method</p>
<p>To connect to the internal server connection from code that is running within the target server, you can use the <code>OracleDataSource.getConnection</code> method with either of the following <a id="sthref317"></a><a id="sthref318"></a>URLs:</p>
<pre>OracleDataSource ods = new OracleDataSource();
ods.setURL(&#34;jdbc:oracle:kprb&#34;);
Connection conn = ods.getConnection();
</pre>
<p>or:</p>
<pre>OracleDataSource ods = new OracleDataSource();
ods.setURL(&#34;jdbc:default:connection&#34;);
Connection conn = ods.getConnection();
</pre>
<p>or:</p>
<pre>OracleDataSource ods = new OracleDataSource();
ods.setURL(&#34;jdbc:oracle:kprb:&#34;);
Connection conn = ods.getConnection();
</pre>
<p>or:</p>
<pre>OracleDataSource ods = new OracleDataSource();
ods.setURL(&#34;jdbc:default:connection:&#34;);
Connection conn = ods.getConnection();
</pre>
<p>Any user name or password you include in the URL is ignored in connecting to the default server connection.</p>
<p>The <code>OracleDataSource.getConnection</code> method returns a new Java <code>Connection</code> object every time you call it. The fact that <code>OracleDataSource.getConnection</code> returns a new connection object every time you call it is significant if you are working with object maps or <a id="sthref319"></a>type maps. A type map is associated with a specific <code>Connection</code> object and with any state that is part of the object. If you want to use multiple type maps as part of your program, then you can call <code>getConnection</code> to create a new <code>Connection</code> object for each type map.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Although the <code>OracleDataSource.getConnection</code> method returns a new object every time you call it, it does not create a new database connection every time. They all utilize the same implicit native connection and share the same session state, in particular, the local transaction.</div>
</div>
<!-- class="sect1" -->
<a id="BABJIFAC"></a>
<div id="JJDBC28258" class="sect1">
<h2 class="sect1">Session and Transaction Context</h2>
<p><a id="sthref320"></a><a id="sthref321"></a><a id="sthref322"></a><a id="sthref323"></a>The server-side driver operates within a default session and default transaction context. The default session is the session in which the JVM was started. In effect, you are already connected to the database on the server. This is different from the client-side where there is no default session. You must explicitly connect to the database.</p>
<p>Auto-commit mode is disabled in the server. You must manage transaction <code>COMMIT</code> and <code>ROLLBACK</code> operations explicitly by using the appropriate methods on the connection object:</p>
<pre>conn.commit();
</pre>
<p>or:</p>
<pre>conn.rollback();
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
As a best practice, it is recommended not to commit or rollback a transaction inside the server.</div>
</div>
<!-- class="sect1" -->
<a id="i1013483"></a>
<div id="JJDBC28259" class="sect1">
<h2 class="sect1">Testing JDBC on the Server</h2>
<p>Almost any <a id="sthref324"></a>JDBC program that can run on a client can also run on the server. All the programs in the <code>samples</code> directory can be run on the server, with only minor modifications. Usually, these modifications concern only the connection statement.</p>
<p>Consider the following code fragment which obtains a connection to a database:</p>
<pre>ods.setUrl(
&#34;jdbc:oracle:oci:@(DESCRIPTION=
  (ADDRESS=(PROTOCOL=TCP)(HOST=cluster_alias)
    (PORT=5221))
    (CONNECT_DATA=(SERVICE_NAME=orcl)))&#34;);
ods.setUser(&#34;HR&#34;);
ods.setPassword(&#34;hr&#34;);
Connection conn = ods.getConnection();  
</pre>
<p>We can modify this code fragment for use in the server-side internal driver. In the server-side internal driver, no user, password, or database information is necessary. For the connection statement, you use:</p>
<pre>ods.setUrl(
&#34;jdbc:oracle:kprb:@&#34;);
Connection conn = ods.getConnection();  
</pre>
<p>However, the most convenient way to get a connection is to call the <code>OracleDriver.defaultConnection</code> method, as follows:</p>
<pre>Connection conn = OracleDriver.defaultConnection();  
</pre></div>
<!-- class="sect1" -->
<a id="CIHIEBGC"></a>
<div id="JJDBC28260" class="sect1">
<h2 class="sect1">Loading an Application into the Server</h2>
<p>When loading an application into the server, you can load <code>.class</code> files that you have already compiled on the client or you can load <code>.java</code> source files and have them automatically compiled on the server.</p>
<div id="JJDBC28261" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref325"></a>
<h3 class="sect2">Using the Loadjava Utility</h3>
<p>You can use the <code>loadjava</code> utility to load your files. You can either specify source file names on the command line or put the files into a Java Archive (JAR) file and specify the JAR file name on the command line.</p>
<p>The <code>loadjava</code> script, which runs the actual utility, is in the <code>bin</code> directory in your Oracle home. This directory should already be in your path once Oracle has been installed.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code>loadjava</code> utility supports compressed files.</div>
<p class="subhead2"><a id="JJDBC28262"></a>Loading Class Files into the Server</p>
<p>Consider a case where you have the following three class files in your application: <code>Foo1.class</code>, <code>Foo2.class</code>, and <code>Foo3.class</code>. Each class is written into its own class schema object in the server.</p>
<p>You can load the class files using the default JDBC Oracle Call Interface (OCI) driver in the following ways:</p>
<ul>
<li>
<p>Specifying the individual class file names, as follows:</p>
<pre>loadjava -user HR Foo1.class Foo2.class Foo3.class
Password: <span class="italic">password</span>
</pre></li>
<li>
<p>Specifying the class file names using a wildcard, as follows:</p>
<pre>loadjava -user HR Foo*.class
Password: <span class="italic">password</span>
</pre></li>
<li>
<p>Specifying a JAR file that contains the class files, as follows:</p>
<pre>loadjava -user HR Foo.jar
Password: <span class="italic">password</span>
</pre></li>
</ul>
<p>You can load the files using the JDBC Thin driver, as follows:</p>
<pre>loadjava -thin -user HR@localhost:5221:orcl Foo.jar
Password: <span class="italic">password</span>
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Starting from Oracle Database 12<span class="italic">c</span> Release 1 (12.1), JDK 6, and JDK 7 are supported. However, only one of the JVMs will be active at a given time.
<p>Ensure that your classes are not compiled using a newer version of JDK than the active runtime version on the server.</p>
</div>
<p class="subhead2"><a id="JJDBC28263"></a>Loading Source Files into the Server</p>
<p>If you enable the <code>loadjava -resolve</code> option when loading a <code>.java</code> source file, then the server-side compiler will compile your application as it is loaded, resulting in both a source schema object for the original source code and one or more class schema objects for the compiled output.</p>
<p>If you do not specify <code>-resolve</code>, then the source is loaded into a source schema object without any compilation. In this case, however, the source is implicitly compiled the first time an attempt is made to use a class defined in the source.</p>
<p>For example, run <code>loadjava</code> as follows to load and compile <code>Foo.java</code>, using the default JDBC OCI driver:</p>
<pre>loadjava -user HR -resolve Foo.java
Password: <span class="italic">password</span>
</pre>
<p>Or, use the following command to load using the JDBC Thin driver:</p>
<pre>loadjava -thin -user HR@localhost:5221:orcl -resolve Foo.java
Password: <span class="italic">password</span>
</pre>
<p>Either of these will result in appropriate class schema objects being created in addition to the source schema object.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle generally recommends compiling source on the client, whenever possible, and loading the <code>.class</code> files instead of the source files into the server.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink JJDEV10060" href="../JJDEV/cheleven.htm#JJDEV10060"><span class="italic">Oracle Database Java Developer&#39;s Guide</span></a></div>
</div>
<!-- class="sect2" -->
<div id="JJDBC28264" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref326"></a>
<h3 class="sect2">Using the JVM Command Line</h3>
<p>You can also use the JVM command-line option to load your files. The command-line interface to Oracle JVM is analogous to using the JDK or JRE shell commands. You can:</p>
<ul>
<li>
<p>Use the standard <code>-classpath</code> syntax to indicate where to find the classes to load</p>
</li>
<li>
<p>Set the system properties by using the standard <code>-D</code> syntax</p>
</li>
</ul>
<p>The interface is a PL/SQL function that takes a string (<code>VARCHAR2</code>) argument, parses it as a command-line input and if it is properly formed, runs the indicated Java method in Oracle JVM. To do this, PL/SQL package <code>DBMS_JAVA</code> provides the following functions:</p>
<ul>
<li>
<p><code>runjava</code></p>
<p>You can use the <code>runjava</code> function in the following way:</p>
<pre>FUNCTION runjava(cmdline VARCHAR2) RETURN VARCHAR2;
</pre></li>
<li>
<p><code>runjava_in_current_session</code></p>
<p>You can use the <code>runjava_in_current_sessio</code>n function in the following way:</p>
<pre>FUNCTION runjava_in_current_session(cmdline VARCHAR2) RETURN VARCHAR2;
</pre></li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Starting with Oracle Database 11<span class="italic">g</span> Release 1, there is a just-in-time (JIT) compiler for Oracle JVM environment. A JIT compiler for Oracle JVM enables much faster execution because the JIT compiler uses advanced techniques as compared to the old Native compiler and compiles dynamically generated code. Unlike the old Native compiler, the JIT compiler does not require a C compiler. It is enabled without the support of any plug-ins.
<p>For more information, refer to <a class="olink JJDEV09000" href="../JJDEV/chnine.htm#JJDEV09000"><span class="italic">Oracle Database Java Developer&#39;s Guide</span></a>.</p>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2237">
<tr>
<td class="cellalignment2246">
<table class="cellalignment2242">
<tr>
<td class="cellalignment2241"><a href="instclnt.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2241"><a href="part3.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2249">
<table class="cellalignment2240">
<tr>
<td class="cellalignment2241"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2241"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2241"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2241"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2241"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2241"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>