<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-70985"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Database%20Resident%20Connection%20Pooling"></a><title>Database Resident Connection Pooling</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="description" content="This book describes how to use Oracle JDBC drivers to develop powerful Java database applications."/>
<meta name="dcterms.created" content="2014-06-30T1:22:37Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database JDBC Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49300-05"/>
<meta name="dcterms.isVersionOf" content="JJDBC"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="ociconpl.htm" title="Previous" type="text/html"/>
<link rel="Next" href="streamsaq.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49300-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">35/55</span> <!-- End Header -->
<div id="JJDBC29023" class="chapter"><a id="CHDBGDAF"></a>
<h1 class="chapter"><span class="secnum">23</span> Database Resident Connection Pooling</h1>
<p><a id="sthref836"></a>Database Resident Connection Pool (DRCP) is a connection pool in the server that is shared across many clients. You should use DRCP in connection pools where the number of active connections is fairly less than the number of open connections. As the number of instances of connection pools that can share the connections from DRCP pool increases, the benefits derived from using DRCP increases. DRCP increases Database server scalability and resolves the resource wastage issue that is associated with middle-tier connection pooling.</p>
<p>This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#CHDJAABD">Overview of Database Resident Connection Pooling</a></p>
</li>
<li>
<p><a href="#CHDIACBG">Enabling Database Resident Connection Pooling</a></p>
</li>
<li>
<p><a href="#CHDGGJII">Sharing Pooled Servers Across Multiple Connection Pools</a></p>
</li>
<li>
<p><a href="#CHDGDGJE">APIs for Using DRCP</a></p>
</li>
</ul>
<a id="CHDJAABD"></a>
<div id="JJDBC29024" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Overview of <a id="sthref837"></a><a id="sthref838"></a>Database Resident Connection Pooling</h2>
<p>In middle-tier connection pools, every connection cache maintains a minimum number of connections to the server. Each connection represents used up resources at the server. All these open connections are not utilized at any given time, which means that there are unused resources that unnecessarily take up server resources. In a multiple middle-tier scenario, these connections are not shared with any other middle tier and are retained in the cache even if some of these are idle. However, a large number of such middle-tier connection pools increase the number of inactive connections to the Database server significantly and waste a lot of Database resources because all the connections do not remain active simultaneously.</p>
<p>For example, in a middle-tier connection pool, if the minimum pool size is 200, then the connection pool has 200 connections to the server, and the Database server has 200 server processes associated with these connections. If there are 30 middle tiers with a connection pool of minimum size 200, then the server has 6000 (200 * 30) corresponding server processes running. Typically, on an average only 5% of the connections, and in turn, server processes are in use at any given time. So, out of the 6,000 server processes, only 300 server processes are active at any given time. This leads to over 5,700 unused server processes on the server. These unused processes are the wasted resources on the server.</p>
<p>The Database Resident Connection Pool implementation creates a pool on the server side, which is shared across multiple client pools. This significantly lowers memory consumption on the server because of reduced number of server processes on the server and increases the scalability of the Database server.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink CNCPT1896" href="../CNCPT/dist_pro.htm#CNCPT1896"><span class="italic">Oracle Database Concepts</span></a></p>
</li>
<li>
<p><a class="olink ADMIN12347" href="../ADMIN/manproc.htm#ADMIN12347"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a></p>
</li>
<li>
<p><a class="olink ADMIN" href="../ADMIN/toc.htm"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="CHDIACBG"></a>
<div id="JJDBC29025" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Enabling Database Resident Connection Pooling</h2>
<p>This section describes how to enable DRCP in the server side and the client side:</p>
<ul>
<li>
<p><a href="#CHDHFAEJ">Enabling DRCP on the Server Side</a></p>
</li>
<li>
<p><a href="#CHDDDEIG">Enabling DRCP on the Client Side</a></p>
</li>
</ul>
<a id="CHDHFAEJ"></a>
<div id="JJDBC29026" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><a id="sthref839"></a>Enabling DRCP on the Server Side</h3>
<p>You must be a database administrator (DBA) and must log on as <code>SYSDBA</code> to start and end a pool. This section contains the following subsections:</p>
<ul>
<li>
<p><a href="#CHDBFCIF">Setting the Statement Cache Size</a></p>
</li>
<li>
<p><a href="#CHDJJGDE">Starting a Pool</a></p>
</li>
<li>
<p><a href="#CHDDJDHD">Ending a Pool</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
The features of DRCP can be leveraged only with a connection pool on the client because JDBC does not have a default pool on its own. If you do not have a client connection pool and make any change to the Database with auto commit set to <code>false</code>, then the changes are not committed to the Database while closing the connection.</div>
<p class="subhead2"><a id="CHDJJGDE"></a><a id="JJDBC29027"></a>Starting a Pool</p>
<p>Run the <code><a id="sthref840"></a>dbms_connection_pool.start_pool</code> method with the default settings to start the default pool, <code>SYS_DEFAULT_CONNECTION_POOL</code>. For example:</p>
<pre>sqlplus /nolog
connect / as sysdba
execute dbms_connection_pool.start_pool();
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN12347" href="../ADMIN/manproc.htm#ADMIN12347"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> and <a href="stmtcach.htm#i1069942">&#34;About Statement Caching&#34;</a> for more information</div>
<p class="subhead2"><a id="CHDDJDHD"></a><a id="JJDBC29028"></a>Ending a Pool</p>
<p>Run the <code><a id="sthref841"></a>dbms_connection_pool.stop_pool</code> method with the default settings to end the pool. For example:</p>
<pre>sqlplus /nolog
connect / as sysdba
execute dbms_connection_pool.stop_pool();
</pre>
<p class="subhead2"><a id="CHDBFCIF"></a><a id="JJDBC29144"></a>Setting the Statement Cache Size</p>
<p>If you use DRCP, caching is also done at the server side. So, you must specify the statement cache size on the server side in the following way, where 50 is the preferred size:</p>
<pre>execute DBMS_CONNECTION_POOL.CONFIGURE_POOL (session_cached_cursors=&gt;50);
</pre></div>
<!-- class="sect2" -->
<a id="CHDDDEIG"></a>
<div id="JJDBC29029" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><a id="sthref842"></a>Enabling DRCP on the Client Side</h3>
<p>Perform the following steps to enable DRCP on the client side:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In <a href="#CHDCAIEI">Example 23-1</a>, we are using Universal Connection Pool as the client-side connection pool. For any other connection pools, you can enable DRCP by performing the following two steps and using <code>oracle.jdbc.pool.OracleConnectionPoolDataSource</code> as the connection factory.</div>
<ul>
<li>
<p>Pass a non-null and non-empty String value to the connection property <code>oracle.jdbc.DRCPConnectionClass</code></p>
</li>
<li>
<p>Append (<code>SERVER=POOLED</code>) to the <code>CONNECT_DATA</code> in the long connection string</p>
</li>
</ul>
<p>You can also specify <code>(SERVER=POOLED)</code> in short URL from as follows:</p>
<pre>jdbc:oracle:thin:@//&lt;host&gt;:&lt;port&gt;/&lt;service_name&gt;[:POOLED]
</pre>
<p>For example:</p>
<pre>jdbc:oracle:thin:@//localhost:5221/orcl:POOLED
</pre>
<p><a href="#CHDCAIEI">Example 23-1</a> shows how to enable DRCP on client side:</p>
<div id="JJDBC29043" class="example">
<p class="titleinexample"><a id="CHDCAIEI"></a>Example 23-1 Enabling DRCP on Client Side Using Universal Connection Pool</p>
<pre>String url = &#34;jdbc:oracle:thin:@//localhost:5521/orcl:POOLED&#34;;
PoolDataSource pds = PoolDataSourceFactory.getPoolDataSource();
pds.setConnectionFactoryClassName(&#34;oracle.jdbc.pool.OracleDataSource&#34;);
// Set DataSource Property
pds.setUser(&#34;HR&#34;);
pds.setPassword(&#34;hr&#34;);
System.out.println (&#34;Connecting to &#34; + url);
pds.setURL(url);
pds.setConnectionPoolName(&#34;HR-Pool1&#34;);
pds.setMinPoolSize(2);
pds.setMaxPoolSize(3);
pds.setInitialPoolSize(2);
Properties prop = new Properties();
prop.put(&#34;oracle.jdbc.DRCPConnectionClass&#34;, &#34;HR-Pool1&#34;);
pds.setConnectionProperties(prop);
</pre></div>
<!-- class="example" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
Oracle Universal Connection Pool for JDBC Developer&#39;s Guide for more information about Universal Connection Pool</div>
<div class="infobox-note">
<p class="notep1">Note:</p>
In UCP, if you do not provide a connection class, then the connection pool name is used as the connection class name by default.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CHDGGJII"></a>
<div id="JJDBC29031" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><a id="sthref843"></a>Sharing Pooled Servers Across Multiple Connection Pools</h2>
<p>To share pooled server processes on the server across multiple Connection pools, set the same DRCP Connection class name for all the pooled server processes on the server. You can set the DRCP Connection class name using the connection property <code>oracle.jdbc.DRCPConnectionClass</code> as discussed in <a href="#CHDDDEIG">&#34;Enabling DRCP on the Client Side&#34;</a>.</p>
</div>
<!-- class="sect1" -->
<div id="JJDBC29145" class="sect1"><!-- infolevel="all" infotype="General" --><a id="sthref844"></a>
<h2 class="sect1"><a id="sthref845"></a>DRCP Tagging</h2>
<p>DRCP enables you to request the Server connection pool to associate a Server process with a particular tag name.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink LNOCI16617" href="../LNOCI/oci09adv.htm#LNOCI16617"><span class="italic">Oracle Call Interface Programmer&#39;s Guide</span></a> for more information about session pooling and connection tagging</div>
</div>
<!-- class="sect1" -->
<a id="CHDGDGJE"></a>
<div id="JJDBC29030" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><a id="sthref846"></a>APIs for Using DRCP</h2>
<p>In DRCP, you can apply a tag to a given connection and retrieve that tagged connection later. Connection tagging enhances session pooling because you can retrieve specific sessions easily.</p>
<p>If you want to take advantage of DRCP with higher granular control for your Custom connection pool implementations, then you must use the following APIs declared in the <code>oracle.jdbc.OracleConnection</code> interfaces:</p>
<ul>
<li>
<p><code><a id="sthref847"></a>attachServerConnection</code></p>
</li>
<li>
<p><a id="sthref848"></a><code>detachServerConnection</code></p>
</li>
<li>
<p><code><a id="sthref849"></a>isDRCPEnabled</code></p>
</li>
<li>
<p><code><a id="sthref850"></a>needToPurgeStatementCache</code></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink JAJDB" href="../JAJDB/toc.htm"><span class="italic">Oracle Database JDBC Java API Reference</span></a></div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2237">
<tr>
<td class="cellalignment2246">
<table class="cellalignment2242">
<tr>
<td class="cellalignment2241"><a href="ociconpl.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2241"><a href="streamsaq.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2249">
<table class="cellalignment2240">
<tr>
<td class="cellalignment2241"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2241"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2241"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2241"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2241"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2241"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>