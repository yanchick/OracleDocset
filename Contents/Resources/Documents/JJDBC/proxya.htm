<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-71020"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Proxy%20Authentication"></a><title>Proxy Authentication</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="description" content="This book describes how to use Oracle JDBC drivers to develop powerful Java database applications."/>
<meta name="dcterms.created" content="2014-06-30T1:22:36Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database JDBC Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E49300-05"/>
<meta name="dcterms.isVersionOf" content="JJDBC"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="clntsec.htm" title="Previous" type="text/html"/>
<link rel="Next" href="part4.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49300-05.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">20/55</span> <!-- End Header -->
<div id="JJDBC28352" class="chapter"><a id="CHDHHAAD"></a>
<h1 class="chapter"><span class="secnum">10</span> Proxy Authentication</h1>
<p>Oracle Java Database Connectivity (JDBC) provides proxy authentication, also called N-tier authentication. This feature is supported through both the JDBC Oracle Call Interface (OCI) driver and the JDBC Thin driver. This chapter contains the following sections:</p>
<ul>
<li>
<p><a href="#i1014347">About Proxy Authentication</a></p>
</li>
<li>
<p><a href="#CHDJGEFH">Types of Proxy Connections</a></p>
</li>
<li>
<p><a href="#BABEJEIA">Creating Proxy Connections</a></p>
</li>
<li>
<p><a href="#CHDHGCEC">Closing a Proxy Session</a></p>
</li>
<li>
<p><a href="#BABIEGEA">Caching Proxy Connections</a></p>
</li>
<li>
<p><a href="#CHDFIIBB">Limitations of Proxy Connections</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle Database supports proxy authentication functionality in three tiers <span class="italic">only</span>. It does not support it across multiple middle tiers.</div>
<a id="i1014347"></a>
<div id="JJDBC28353" class="sect1">
<h2 class="sect1">About Proxy Authentication</h2>
<p>Proxy authentication is the process of using a middle tier for user authentication. You can design a middle tier server to proxy clients in a secure fashion by using the following three forms of proxy authentication:</p>
<ul>
<li>
<p>The middle tier server authenticates itself with the database server and a client. In this case, an application user or another application, authenticates itself with the middle tier server. Client identities can be maintained all the way through to the database.</p>
</li>
<li>
<p>The client, that is, a database user, is not authenticated by the middle tier server. The client&#39;s identity and database password are passed through the middle tier server to the database server for authentication.</p>
</li>
<li>
<p>The client, that is, a global user, is authenticated by the middle tier server, and passes either a Distinguished name (DN) or a Certificate through the middle tier for retrieving the client&#39;s user name.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Operations done on behalf of a client by a middle tier server can be audited. For more information, refer to <a class="olink DBSEG725" href="../DBSEG/audit_config.htm#DBSEG725"><span class="italic">Oracle Database Security Guide</span></a>.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#BABEJEIA">&#34;Creating Proxy Connections&#34;</a></div>
</li>
</ul>
<p>In all cases, an administrator must authorize the middle tier server to proxy a client, that is, to act on behalf of the client. Suppose, the middle tier server initially connects to the database as user <code>HR</code> and activates a proxy connection as user <code>jeff</code>, and then issues the following statement to authorize the middle tier server to proxy a client:</p>
<pre>ALTER USER jeff GRANT CONNECT THROUGH HR;
</pre>
<p>You can also:</p>
<ul>
<li>
<p>Specify roles that the middle tier is permitted to activate when connecting as the client. For example,</p>
<pre>CREATE ROLE role1; 
GRANT SELECT ON employees TO role1;
ALTER USER jeff GRANT CONNECT THROUGH HR ROLE role1;
</pre>
<p>The role clause limits the access only to those database objects that are mentioned in the list of the roles. The list of roles can be empty.</p>
</li>
<li>
<p>Find the users who are currently authorized to connect through a middle tier by querying the <code>PROXY_USERS</code> data dictionary view.</p>
</li>
<li>
<p>Disallow a proxy connection by using the <code>REVOKE CONNECT THROUGH</code> clause of <code>ALTER USER</code> statement.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
In case of proxy authentication, a JDBC connection to the database creates a database session during authentication, and then other sessions can be created during the life time of the connection.</div>
<p>You need to use the different fields and methods present in the <code>oracle.jdbc.OracleConnection</code> interface to set up the different types of proxy connections.</p>
</div>
<!-- class="sect1" -->
<a id="CHDJGEFH"></a>
<div id="JJDBC28354" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Types of Proxy Connections</h2>
<p>You can create proxy connections using any one of the following options:</p>
<ul>
<li>
<p><code>USER NAME</code></p>
<p>This is done by supplying the user name or the password or both. The SQL statement for specifying authentication using password is:</p>
<pre>ALTER USER jeff GRANT CONNECT THROUGH HR AUTHENTICATED USING <span class="italic">password</span>;
</pre>
<p>In this case, <code>jeff</code> is the user name and <code>HR</code> is the proxy for <code>jeff</code>.</p>
<p>The password option exists for additional security. Having no <code>authenticated</code> clause implies default authentication, which is using only the user name without the password. The SQL statement for specifying default authentication is:</p>
<pre>ALTER USER jeff GRANT CONNECT THROUGH HR
</pre></li>
<li>
<p><code>DISTINGUISHED NAME</code></p>
<p>This is a global name in lieu of the password of the user being proxied for. An example of the corresponding SQL statement using a distinguished name is:</p>
<pre>CREATE USER jeff IDENTIFIED GLOBALLY AS &#39;CN=jeff,OU=americas,O=oracle,L=redwoodshores,ST=ca,C=us&#39;;
</pre>
<p>The string that follows the <code>identified globally as</code> clause is the distinguished name. It is then necessary to authenticate using this distinguished name. The corresponding SQL statement to specify authentication using distinguished name is:</p>
<pre>ALTER USER jeff GRANT CONNECT THROUGH HR AUTHENTICATED USING DISTINGUISHED NAME;
</pre></li>
<li>
<p><code>CERTIFICATE</code></p>
<p>This is a more encrypted way of passing the credentials of the user, who is to be proxied, to the database. The certificate contains the distinguished name encoded in it. One way of generating the certificate is by creating a wallet and then decoding the wallet to get the certificate. The wallet can be created using <code>runutl mkwallet</code>. It is then necessary to authenticate using the generated certificate. The SQL statement for specifying authentication using certificate is:</p>
<pre>ALTER USER jeff GRANT CONNECT THROUGH HR AUTHENTICATED USING CERTIFICATE;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The use of certificates for proxy authentication will be desupported in future Oracle Database releases.</div>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>All the options can be associated with roles.</p>
</li>
<li>
<p>When opening a new proxied connection, a new session is started on the Database server. If you start a global transaction and then call the <code>openProxySession</code> method, then, at this point, you are no longer a part of the global transaction and instead it is like you are in a freshly created JDBC connection. Typically, this never happens because the <code>openProxySession</code> method is called prior to creating or resuming a global transaction. In such a case, you are still a part of the global transaction.</p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="BABEJEIA"></a>
<div id="JJDBC28355" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Creating Proxy Connections</h2>
<p>A user, say <code>jeff</code>, has to connect to the database through another user, say <code>HR</code>. The proxy user, <code>HR</code>, should have an active authenticated connection. A proxy session is then created on this active connection, with the driver issuing a command to the server to create a session for the user, <code>jeff</code>. The server returns the new session ID, and the driver sends a session switch command to switch to this new session.</p>
<p>The JDBC OCI and Thin driver switch sessions in the same manner. The drivers permanently switch to the new session, <code>jeff</code>. As a result, the proxy session, <code>HR</code>, is not available until the new session, <code>jeff</code>, is closed.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You can use the <code>isProxySession</code> method from the <code>oracle.jdbc.OracleConnection</code> interface to check if the current session associated with your connection is a proxy session. This method returns <code>true</code> if the current session associated with the connection is a proxy session.</div>
<p>A new proxy session is opened by using the following method from the <code>oracle.jdbc.OracleConnection</code> interface:</p>
<pre>void openProxySession(int type, java.util.Properties prop) throws SQLExceptionOpens
</pre>
<p>Where,</p>
<p><code>type</code> is the type of the proxy session and can have the following values:</p>
<ul>
<li>
<p><code>OracleConnection.PROXYTYPE_USER_NAME</code></p>
<p>This type is used for specifying the user name.</p>
</li>
<li>
<p><code>OracleConnection.PROXYTYPE_DISTINGUISHED_NAME</code></p>
<p>This type is used for specifying the distinguished name of the user.</p>
</li>
<li>
<p><code>OracleConnection.PROXYTYPE_CERTIFICATE</code></p>
<p>This type is used for specifying the proxy certificate.</p>
</li>
</ul>
<p><code>prop</code> is the property value of the proxy session and can have the following values:</p>
<ul>
<li>
<p><code>PROXY_USER_NAME</code></p>
<p>This property value should be used with the type <code>OracleConnection.PROXYTYPE_USER_NAME</code>. The value should be a <code>java.lang.String</code>.</p>
</li>
<li>
<p><code>PROXY_DISTINGUISHED_NAME</code></p>
<p>This property value should be used with the type <code>OracleConnection.PROXYTYPE_DISTINGUISHED_NAME</code>. The value should be a <code>java.lang.String</code>.</p>
</li>
<li>
<p><code>PROXY_CERTIFICATE</code></p>
<p>This property value should be used with the type <code>OracleConnection.PROXYTYPE_CERTIFICATE</code>. The value is a <code>bytep[]</code> array that contains the certificate.</p>
</li>
<li>
<p><code>PROXY_ROLES</code></p>
<p>This property value can be used with the following types:</p>
<ul>
<li>
<p><code>OracleConnection.PROXYTYPE_USER_NAME</code></p>
</li>
<li>
<p><code>OracleConnection.PROXYTYPE_DISTINGUISHED_NAME</code></p>
</li>
<li>
<p><code>OracleConnection.PROXYTYPE_CERTIFICATE</code></p>
</li>
</ul>
<p>The value should be a <code>java.lang.String</code>.</p>
</li>
<li>
<p><code>PROXY_SESSION</code></p>
<p>This property value is used with the <code>close</code> method to close the proxy session.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDHGCEC">Closing a Proxy Session</a></div>
</li>
<li>
<p><code>PROXY_USER_PASSWORD</code></p>
<p>This property value should be used with the type <code>OracleConnection.PROXYTYPE_USER_NAME</code>. The value should be a <code>java.lang.String</code>.</p>
</li>
</ul>
<p>The following code snippet shows the use of the <code>openProxySession</code> method:</p>
<pre>    java.util.Properties prop = new java.util.Properties();
    prop.put(OracleConnection.PROXY_USER_NAME, &#34;jeff&#34;);
    String[] roles = {&#34;role1&#34;, &#34;role2&#34;};
    prop.put(OracleConnection.PROXY_ROLES, roles);
    conn.openProxySession(OracleConnection.PROXYTYPE_USER_NAME, prop);
    
</pre></div>
<!-- class="sect1" -->
<a id="CHDHGCEC"></a>
<div id="JJDBC28356" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Closing a Proxy Session</h2>
<p>You can close the proxy session opened with the <code>OracleConnection.openProxySession</code> method by passing the <code>OracleConnection.PROXY_SESSION</code> parameter to the <code>OracleConnection.close</code> method in the following way:</p>
<pre>OracleConnection.close(OracleConnection.PROXY_SESSION);
</pre>
<p>This is similar to closing a proxy session on a non-cached connection. The standard <code>close</code> method must be called explicitly to close the connection itself. If the <code>close</code> method is called directly, without closing the proxy session, then both the proxy session and the connection are closed. This can be achieved in the following way:</p>
<pre>OracleConnection.close(OracleConnection.INVALID_CONNECTION);
</pre></div>
<!-- class="sect1" -->
<a id="BABIEGEA"></a>
<div id="JJDBC28357" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Caching Proxy Connections</h2>
<p>Proxy connections, like standard connections, can be cached. Caching proxy connections enhances the performance. To cache a proxy connection, you need to create a connection using one of the <code>getConnection</code> methods on a cache enabled <code>OracleDataSource</code> object.</p>
<p>A proxy connection may be cached in the connection cache using the connection attributes feature of the connection cache. Connection attributes are name/value pairs that are user-defined and help tag a connection before returning it to the connection cache for reuse. When the tagged connection is retrieved, it can be directly used without having to do a round-trip to create or close a proxy session. Universal Connection Pool supports caching of any user/password authenticated connection. Therefore, any user authenticated proxy connection can be cached and retrieved.</p>
<p>It is recommended that proxy connections should not be closed without applying the connection attributes. If a proxy connection is closed without applying the connection attributes, the connection is returned to the connection cache for reuse, but cannot be retrieved. The connection caching mechanism does not remember or reset session state.</p>
<p>A proxy connection can be removed from the connection cache by closing the connection directly.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#CHDHGCEC">&#34;Closing a Proxy Session&#34;</a></div>
</div>
<!-- class="sect1" -->
<a id="CHDFIIBB"></a>
<div id="JJDBC28358" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Limitations of Proxy Connections</h2>
<p>Closing a proxy connection automatically closes every SQL Statement created by the proxy connection, during the proxy session or prior to the proxy session. This may cause unexpected consequences on application pooling or statement caching. The following code samples explain this limitation of proxy connections:</p>
<p class="subhead2"><a id="JJDBC28359"></a>Example 1</p>
<pre>....
public void displayName(String N)  // Any function using the Proxy feature
{
     Properties props = new Properties();
     props.put(&#34;PROXY_USER_NAME&#34;, proxyUser);
     c.openProxySession(OracleConnection.PROXYTYPE_USER_NAME, props);
     .......
     c.close(OracleConnection.PROXY_SESSION);
}
 
public static void main (String args[]) throws SQLException
{
    ............
    PreparedStatement pstmt = conn.prepareStatement(&#34;SELECT first_name FROM EMPLOYEES WHERE employee_id = ?&#34;);
    pstmt.setInt(1, 205);
    ResultSet rs = pstmt.executeQuery();
    while (rs.next())
    {
        displayName(rs.getString(1));
         if (rs.isClosed() // The ResultSet is already closed while closing the connection!
         {
             throw new Exception(&#34;Your ResultSet has been prematurely closed! 
Your Statement object is also dead now.&#34;);
         }
    }
}
</pre>
<p>In the preceding example, when you close the proxy connection in the <code>displayName</code> method, then the <code>PreparedStatement</code> object and the <code>ResultSet</code> object also get closed. So, if you do not check the status of the <code>ResultSet</code> object inside loop, then the loop will fail when the <code>next</code> method is called for the second time.</p>
<p class="subhead2"><a id="JJDBC28360"></a>Example 2</p>
<pre>    ....
    PreparedStatement pstmt = conn.prepareStatement(&#34;SELECT first_name FROM EMPLOYEES WHERE employee_id = ?&#34;);
    pstmt.setString(1, &#34;205&#34;);
    ResultSet rs = pstmt.executeQuery();
    while (rs.next())
    {
        ....
    }
 
    Properties props = new Properties();
    props.put(&#34;PROXY_USER_NAME&#34;, proxyUser);
 
    conn.openProxySession(OracleConnection.PROXYTYPE_USER_NAME, props);
    .......
    conn.close(OracleConnection.PROXY_SESSION);
 
    // Try to use the PreparedStatement again
    pstmt.setString(1, &#34;28960&#34;);
// This line of code will fail because the Statement is already closed while closing the connection!
    rs = pstmt.executeQuery(); 
</pre>
<p>In the preceding example, the <code>PreparedStatement</code> object and the <code>ResultSet</code> object work fine before opening the proxy connection. But, if you try to execute the same <code>PreparedStatement</code> object after closing the proxy connection, then the statement fails.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2237">
<tr>
<td class="cellalignment2246">
<table class="cellalignment2242">
<tr>
<td class="cellalignment2241"><a href="clntsec.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2241"><a href="part4.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2249">
<table class="cellalignment2240">
<tr>
<td class="cellalignment2241"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2241"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2241"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2241"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2241"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2241"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>