<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-107393"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20TimesTen%20Application-Tier%20Database%20Cache%20with%20Data%20Guard"></a><title>Using TimesTen Application-Tier Database Cache with Data Guard</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 726"/>
<meta name="dcterms.created" content="2014-09-23T15:6:32Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="TimesTen Application-Tier Database Cache User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E21634-12"/>
<meta name="dcterms.isVersionOf" content="TTCAC"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2012, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rac.htm" title="Previous" type="text/html"/>
<link rel="Next" href="summary.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E21634-12.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">16/21</span> <!-- End Header -->
<div id="TTCAC341" class="chapter"><a id="BHCHEAIG"></a>
<h1 class="chapter"><span class="secnum">12</span> Using TimesTen Application-Tier Database Cache with Data Guard</h1>
<p>This chapter describes how to configure TimesTen Application-Tier Database Cache (TimesTen Cache) to work with either synchronous Data Guard or Data Guard used during planned maintenance. It includes the following topics:</p>
<ul>
<li>
<p><a href="#BJEIDFEJ">Components of MAA for TimesTen Application-Tier Database Cache</a></p>
</li>
<li>
<p><a href="#BJEFBFED">How TimesTen Cache works with Data Guard</a></p>
</li>
</ul>
<a id="BJEIDFEJ"></a>
<div id="TTCAC342" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Components of MAA for TimesTen Application-Tier Database Cache</h2>
<p>Oracle <a id="sthref768"></a>Maximum Availability Architecture (MAA) is Oracle Database&#39;s best practices blueprint based on proven Oracle Database high availability (HA) technologies and recommendations. The goal of MAA is to achieve the optimal high availability architecture at the lowest cost and complexity.</p>
<p>To be compliant with MAA, TimesTen Cache must support Oracle Real Application Clusters (Oracle RAC) and Oracle Data Guard, as well as have its own HA capability. TimesTen Cache provides its own HA capability through active standby pair replication of cache tables in read-only and AWT cache groups. See <a href="rac.htm#BHCHEAIF">&#34;Using TimesTen Application-Tier Database Cache in an Oracle RAC Environment&#34;</a> for more information on TimesTen Cache and Oracle RAC.</p>
<p>Oracle <a id="sthref769"></a>Data Guard provides the management, monitoring, and automation software infrastructure to create and maintain one or more synchronized standby databases to protect data from failures, disasters, errors and corruptions. If the primary database becomes unavailable because of a planned or an unplanned outage, Data Guard can switch any standby database to the primary role, thus minimizing downtime and preventing any data loss. For more information about Data Guard, see <a class="olink SBYDB" href="../SBYDB/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a>.</p>
<p>The MAA framework for TimesTen Cache supports cache tables in explicitly loaded read-only and AWT cache groups. For cache tables in dynamic cache groups of any cache group type, SWT cache groups, and user managed cache groups that use the <code>AUTOREFRESH</code> cache group attribute, TimesTen Cache cannot access the Oracle database during a failover and switchover because cache applications wait until the failover and switchover completes.</p>
<p>In general, however, all cache groups types are supported with synchronous Data Guard or Data Guard during planned maintenance.</p>
</div>
<!-- class="sect1" -->
<a id="BJEFBFED"></a>
<div id="TTCAC343" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">How TimesTen Cache works with Data Guard</h2>
<p>TimesTen Cache works with synchronous physical standby failover and switchover and logical standby switchover as long as the object IDs for cached Oracle Database tables remain the same on the primary and standby databases. Object IDs can change if the table is dropped and re-created, altered, or a truncated flashback operation or online segment shrink is executed.</p>
<p>During a transient upgrade, a physical standby database is transformed into a logical standby database. For the time that the standby database is logical, the user must ensure that the object IDs of the cached Oracle Database tables do not change. Specifically, tables that are cached should not be dropped and re-created, truncated, altered, flashed back or have an online segment shrunk.</p>
<div id="TTCAC344" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref770"></a>
<h3 class="sect2">Configuring the Oracle databases</h3>
<p>In order for TimesTen Cache to fail over and switch over properly, configure the Oracle primary and standby databases using the following steps:</p>
<ol>
<li>
<p>The Data Guard configuration must be managed by the Data Guard Broker so that the TimesTen Cache daemon processes and application clients respond faster to failover and switchover events.</p>
</li>
<li>
<p>If you are configuring an Oracle RAC database, use the Oracle Enterprise Manager Cluster Managed Database Services Page to create database services that TimesTen Cache and its client applications use to connect to the Oracle primary database. See <a class="olink RACAD076" href="../RACAD/GUID-8DC4D5E0-CA9D-47BC-BAD0-8769405AFEC5.htm#RACAD076">&#34;Introduction to Automatic Workload Management&#34;</a> in <span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span> for information about creating database services.</p>
</li>
<li>
<p>If you created the database service in step 2, use the <code>MODIFY_SERVICE</code> function of the <code>DBMS_SERVICE</code> PL/SQL package to modify the service to enable high availability notification to be sent through Advanced Queuing (AQ) by setting the <code>aq_ha_notifications</code> attribute to <code>TRUE</code>. To configure server side TAF settings, set the failover attributes, as shown in the following example:</p>
<pre>BEGIN
DBMS_SERVICE.MODIFY_SERVICE 
(service_name =&gt; &#39;DBSERV&#39;,
 goal =&gt; DBMS_SERVICE.GOAL_NONE,
 dtp =&gt; false,
 aq_ha_notifications =&gt; true,
 failover_method =&gt; &#39;BASIC&#39;, 
 failover_type =&gt; &#39;SELECT&#39;, 
 failover_retries =&gt; 180, 
 failover_delay =&gt; 1);
END;
</pre></li>
<li>
<p>If you did not create the database service in step 2, use the <code>CREATE_SERVICE</code> function of the <code>DBMS_SERVICE</code> PL/SQL package to create the database service, enable high availability notification, and configure server side TAF settings:</p>
<pre>BEGIN
DBMS_SERVICE.CREATE_SERVICE
(service_name =&gt; &#39;DBSERV&#39;, 
 network_name =&gt; &#39;DBSERV&#39;, 
 goal =&gt; DBMS_SERVICE.GOAL_NONE,
 dtp =&gt; false,
 aq_ha_notifications =&gt; true, 
 failover_method =&gt; &#39;BASIC&#39;, 
 failover_type =&gt; &#39;SELECT&#39;, 
 failover_retries =&gt; 180, 
 failover_delay =&gt; 1);
END;
</pre></li>
<li>
<p>Create two triggers to relocate the database service to a Data Guard standby database (Oracle RAC or non-Oracle RAC) after it has switched to the primary role. The first trigger fires on the system start event and starts up the <code>DBSERV</code> service:</p>
<pre>CREATE OR REPLACE TRIGGER manage_service 
AFTER STARTUP ON DATABASE 
DECLARE 
  role VARCHAR(30); 
BEGIN 
  SELECT database_role INTO role FROM v$database; 
  IF role = &#39;PRIMARY&#39; THEN 
    dbms_service.start_service(&#39;DBSERV&#39;); 
  END IF; 
END;
</pre>
<p>The second trigger fires when the standby database remains open during a failover and switchover upon a database role change. It relocates the <code>DBSERV</code> service from the old primary to the new primary database and disconnects any connections to that service on the old primary database so that TimesTen Cache and its client applications can reconnect to the new primary database:</p>
<pre>CREATE OR REPLACE TRIGGER relocate_service 
AFTER DB_ROLE_CHANGE ON DATABASE 
DECLARE 
  role VARCHAR(30);
BEGIN
  SELECT database_role INTO role FROM v$database;
  IF role = &#39;PRIMARY&#39; THEN
    dbms_service.start_service(&#39;DBSERV&#39;);
  ELSE
    dbms_service.stop_service(&#39;DBSERV&#39;);
  dbms_lock.sleep(2);
  FOR x IN (SELECT s.sid, s.serial# 
            FROM v$session s, v$process p
            WHERE s.service_name=&#39;DBSERV&#39; AND s.paddr=p.addr)
    LOOP 
      BEGIN 
        EXECUTE IMMEDIATE 
           &#39;ALTER SYSTEM DISCONNECT SESSION 
           &#39;&#39;&#39; || x.sid || &#39;,&#39;|| x.serial# || &#39;&#39;&#39; IMMEDIATE&#39;;
        EXCEPTION WHEN OTHERS THEN 
        BEGIN 
          DBMS_OUTPUT.PUT_LINE(DBMS_UTILITY.FORMAT_ERROR_STACK);
        END; 
      END; 
    END LOOP; 
  END IF; 
END;
</pre></li>
<li>
<p>As an option, to reduce the performance impact to TimesTen Cache applications and minimize the downtime during a physical or logical standby database switchover, run the following procedure right before initiating the Data Guard switchover to a physical or logical standby database:</p>
<pre>DECLARE
  role varchar(30);
BEGIN
  SELECT database_role INTO role FROM v$database;
  IF role = &#39;PRIMARY&#39; THEN
    dbms_service.stop_service(&#39;DBSERV&#39;);
  dbms_lock.sleep(2);
  FOR x IN (SELECT s.sid, s.serial# 
            FROM v$session s, v$process p 
            WHERE s.service_name=&#39;DBSERV&#39; AND s.paddr=p.addr)
    LOOP 
      BEGIN
        EXECUTE IMMEDIATE
            &#39;ALTER SYSTEM DISCONNECT SESSION 
            &#39;&#39;&#39; || x.sid || &#39;,&#39; || x.serial# || &#39;&#39;&#39; IMMEDIATE&#39;; 
        EXCEPTION WHEN OTHERS THEN
        BEGIN
          DBMS_OUTPUT.PUT_LINE(DBMS_UTILITY.FORMAT_ERROR_STACK);
        END;
      END;
    END LOOP;
  ELSE
    dbms_service.start_service(&#39;DBSERV&#39;);
  END IF; 
END;
</pre>
<p>This procedure should be executed first on the physical or logical standby database, and then on the primary database, right before the switchover process. Before executing the procedure for a physical standby database switchover, Active Data Guard must be enabled on the physical standby database.</p>
</li>
</ol>
<p>Before performing a switchover to a logical standby database, stop the Oracle Database service for TimesTen on the primary database and disconnect all sessions connected to that service. Then start the service on the standby database.</p>
<p>At this point, the cache applications try to reconnect to the standby database. If a switchover occurs, there is no wait required to migrate the connections from the primary database to the standby database. This eliminates the performance impact on TimesTen Cache and its applications.</p>
<p>See the <span class="italic">Maximum Availability Architecture, Oracle Best Practices for High Availability</span> white paper for more information.</p>
</div>
<!-- class="sect2" -->
<div id="TTCAC345" class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref771"></a>
<h3 class="sect2">Configuring the TimesTen database</h3>
<p>Configure TimesTen to receive notification of FAN HA events and to avoid reconnecting to a failed Oracle Database instance. Use the Oracle Client shipped with TimesTen Cache.</p>
<ol>
<li>
<p>Create an Oracle Net service name that includes all primary and standby hosts in <code>ADDRESS_LIST</code>. For example:</p>
<pre>DBSERV = 
(DESCRIPTION = 
  (ADDRESS_LIST = 
  (ADDRESS = (PROTOCOL = TCP)(HOST = PRIMARYDB)(PORT = 1521)) 
  (ADDRESS = (PROTOCOL = TCP)(HOST = STANDBYDB)(PORT = 1521)) 
  (LOAD_BALANCE = yes) 
  ) 
  (CONNECT_DATA= (SERVICE_NAME=DBSERV))
)
</pre></li>
<li>
<p>In the client&#39;s sqlnet.ora file, set the <code>SQLNET.OUTBOUND_CONNECT_TIMEOUT</code> parameter to enable clients to quickly traverse an address list in the event of a failure. For example, if a client attempts to connect to a host that is unavailable, the connection attempt is bounded to the time specified by the <code>SQLNET.OUTBOUND_CONNECT_TIMEOUT</code> parameter, after which the client attempts to connect to the next host in the address list. Connection attempts continue for each host in the address list until a connection is made.</p>
<p>Setting the <code>SQLNET.OUTBOUND_CONNECT_TIMEOUT</code> parameter to a value of 3 seconds suffices in most environments. For example, add the following entry to the sqlnet.ora file:</p>
<pre>SQLNET.OUTBOUND_CONNECT_TIMEOUT=3
</pre></li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5343">
<tr>
<td class="cellalignment5350">
<table class="cellalignment5348">
<tr>
<td class="cellalignment5347"><a href="rac.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5347"><a href="summary.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2012, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5352">
<table class="cellalignment5346">
<tr>
<td class="cellalignment5347"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5347"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5347"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5347"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5347"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5347"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>