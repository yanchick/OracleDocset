<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-107391"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Cleaning%20up%20the%20Caching%20Environment"></a><title>Cleaning up the Caching Environment</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 726"/>
<meta name="dcterms.created" content="2014-09-23T15:6:31Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="TimesTen Application-Tier Database Cache User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E21634-12"/>
<meta name="dcterms.isVersionOf" content="TTCAC"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2012, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="perform.htm" title="Previous" type="text/html"/>
<link rel="Next" href="caintro.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E21634-12.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">13/21</span> <!-- End Header -->
<div id="TTCAC328" class="chapter"><a id="BABGBEFI"></a>
<h1 class="chapter"><span class="secnum">9</span> Cleaning up the Caching Environment</h1>
<p>The following sections describe the various tasks that need to be performed in the TimesTen and Oracle databases to destroy a cache grid and drop cache groups. It also includes a recommendation for shutting down all components when using AWT cache groups.</p>
<ul>
<li>
<p><a href="#BABHJBJD">Detaching a TimesTen database from a cache grid</a></p>
</li>
<li>
<p><a href="#BABIAECI">Stopping the replication agent</a></p>
</li>
<li>
<p><a href="#CHDCFGFG">Dropping a cache group</a></p>
</li>
<li>
<p><a href="#BABJAGGD">Destroying a cache grid</a></p>
</li>
<li>
<p><a href="#CHDIFIII">Stopping the cache agent</a></p>
</li>
<li>
<p><a href="#CHDIDBCB">Destroying the TimesTen databases</a></p>
</li>
<li>
<p><a href="#CHDGDHEA">Dropping Oracle Database users and objects</a></p>
</li>
<li>
<p><a href="#BABJBBAF">Recommended method for a scheduled shutdown of an active standby pair with AWT cache groups</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are planning to use Oracle Clusterware to manage active standby pairs in a cache grid, see <a class="olink TTREP700" href="../TTREP/cluster.htm#TTREP700">&#34;Using Oracle Clusterware with a TimesTen cache grid&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Replication Guide</span>.
<p>Also see <a class="olink TTREP263" href="../TTREP/cluster.htm#TTREP263">&#34;Restricted commands and SQL statements&#34;</a> in <span class="italic">Oracle TimesTen In-Memory Database Replication Guide</span>. Use the <code>ttCWAdmin</code> utility to manage the active standby pair grid members instead of the built-in procedures discussed in this chapter.</p>
</div>
<a id="BABHJBJD"></a>
<div id="TTCAC329" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Detaching a TimesTen database from a cache grid<a id="sthref651"></a><a id="sthref652"></a><a id="sthref653"></a></h2>
<p>Call the <code>ttGridDetach</code> built-in procedure to detach a grid member from the cache grid that it is attached to. If the grid member is an active standby pair, the active and standby databases must both be detached, and they must be detached separately. When a grid member has been detached, you can no longer perform operations on its global cache groups or on their cache tables. The grid member also relinquishes ownership of all cache instances that it had owned. The cache agent and replication agent processes cannot be stopped until the database detaches from its cache grid.</p>
<p>From the <code>cachealone1</code> database, call the <code>ttGridDetach</code> built-in procedure as the cache manager user to detach the member from the <code>ttGrid</code> cache grid. For example:</p>
<pre>% ttIsql &#34;DSN=cachealone1;UID=cacheuser;PWD=timesten;OraclePWD=oracle&#34;
Command&gt; CALL ttGridDetach;
</pre>
<p>To make sure that all committed updates on cache tables in the global cache groups in <code>cachealone1</code> have been propagated to the cached Oracle Database tables before the TimesTen database is detached from its cache grid, specify the number of seconds to wait before executing the detach. In this example, the wait is 60 seconds:</p>
<pre>Command&gt; CALL ttGridDetach(,,60);
</pre>
<p>Then after the database has been detached from its grid, the replication agent running on the database can be stopped.</p>
<p>You can force detach a grid member that becomes unavailable but is still attached to the grid. A grid member&#39;s underlying TimesTen database is unavailable, for example, when the TimesTen system is taken offline or the database has been destroyed. Call the <code>ttGridDetach</code> built-in procedure as the cache manager user passing the value 1 to the <code><span class="codeinlineitalic">force</span></code> parameter from any one of the TimesTen databases that are available except from the read-only subscriber databases.</p>
<pre>Command&gt; CALL ttGridDetach(&#39;TTGRID_alone2_2&#39;,1);
</pre>
<p>To determine the names of all attached grid members, call the <code>ttGridNodeStatus</code> built-in procedure.</p>
<p>You can force detach a set of grid members that become unavailable but are still attached to the grid by calling the <code>ttGridDetachList</code> built-in procedure as the cache manager user from any one of the TimesTen databases that are available except from the read-only subscriber databases. Pass the value 1 to the <code><span class="codeinlineitalic">force</span></code> parameter.</p>
<pre>Command&gt; <a id="sthref654"></a><a id="sthref655"></a><a id="sthref656"></a>CALL ttGridDetachList(&#39;TTGRID_cacheact_3A TTGRID_cachestand_3B&#39;,1);
</pre>
<p>You can detach all of the grid members by calling the <a id="sthref657"></a><a id="sthref658"></a><code>ttGridDetachAll</code> built-in procedure. In this example, the detach operation waits 60 seconds:</p>
<pre>Command&gt; CALL ttGridDetachAll(60);
</pre></div>
<!-- class="sect1" -->
<a id="BABIAECI"></a>
<div id="TTCAC330" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Stopping the replication agent<a id="sthref659"></a><a id="sthref660"></a><a id="sthref661"></a></h2>
<p>Call the <code>ttRepStop</code> built-in procedure to stop the replication agent. This must be done on each TimesTen database of the active standby pair including any read-only subscriber databases, and any standalone TimesTen databases that contain AWT cache groups.</p>
<p>From the <code>cachealone1</code>, <code>cachealone2</code>, <code>cacheactive</code>, <code>cachestandby</code> and <code>rosubscriber</code> databases, call the <code>ttRepStop</code> built-in procedure as the cache manager user to stop the replication agent on the database:</p>
<pre>Command&gt; <a id="sthref662"></a><a id="sthref663"></a><a id="sthref664"></a>CALL ttRepStop;
</pre></div>
<!-- class="sect1" -->
<a id="CHDCFGFG"></a>
<div id="TTCAC331" class="sect1">
<h2 class="sect1">Dropping a cache group</h2>
<p>Use the <code>DROP CACHE GROUP</code> statement to drop a cache group and its cache tables. Oracle Database objects used to manage the caching of Oracle Database data are automatically dropped when you use the <code>DROP CACHE GROUP</code> statement to drop a cache group, or an <code>ALTER CACHE GROUP</code> statement to set the autorefresh state to <code>OFF</code> for autorefresh cache groups.</p>
<p>If you issue a <code>DROP CACHE GROUP</code> statement on a cache group that has an autorefresh operation in progress:</p>
<ul>
<li>
<p>The autorefresh operation stops if the <code>LockWait</code> connection attribute setting is greater than 0. The <code>DROP CACHE GROUP</code> statement preempts the autorefresh operation.</p>
</li>
<li>
<p>The autorefresh operation continues if the <code>LockWait</code> connection attribute setting is 0. The <code>DROP CACHE GROUP</code> statement is blocked until the autorefresh operation completes or the statement fails with a lock timeout error.</p>
</li>
</ul>
<p>If cache tables are being replicated in an active standby pair and the cache tables are the only elements that are being replicated, you must drop the active standby pair using a <code>DROP ACTIVE STANDBY PAIR</code> statement before dropping the cache groups. If the active standby pair is a grid member, the grid member must be detached from the grid before dropping the active standby pair.</p>
<p>Execute the following statement as the cache manager user on the <code>cacheactive</code>, <code>cachestandby</code> and <code>rosubscriber</code> databases to drop the active standby pair replication scheme:</p>
<pre>Command&gt; <a id="sthref665"></a>DROP ACTIVE STANDBY PAIR;
Command&gt; exit
</pre>
<p>You must unload the data in a global cache group in all grid members before dropping the cache group. Set the <code>GlobalProcessing</code> optimizer flag to 1 and unload the cache group:</p>
<pre>CALL ttOptSetFlag(&#39;GlobalProcessing&#39;, 1);
UNLOAD CACHE GROUP subscriber_accounts;
</pre>
<p>Before you can drop a cache group, you must grant the <code>DROP ANY TABLE</code> privilege to the cache manager user. Execute the following statement as the instance administrator on the <code>cachealone1</code>, <code>cachealone2</code>, <code>cacheactive</code> and <code>cachestandby</code> databases to grant the <code>DROP ANY TABLE</code> privilege to the cache manager user. The following example shows the SQL statement issued from the <code>cachealone1</code> database:</p>
<pre>% ttIsql cachealone1
Command&gt; GRANT DROP ANY TABLE TO cacheuser;
Command&gt; exit
</pre>
<p>If you are dropping an AWT cache group, use the <code>ttRepSubscriberWait</code> built-in procedure to make sure that all committed updates on its cache tables have been propagated to the cached Oracle Database tables before dropping the cache group.</p>
<pre>% ttIsql &#34;DSN=cachealone1;UID=cacheuser;PWD=timesten;OraclePWD=oracle&#34;
Command&gt; <a id="sthref666"></a><a id="sthref667"></a>CALL ttRepSubscriberWait(&#39;_AWTREPSCHEME&#39;,&#39;TTREP&#39;,&#39;_ORACLE&#39;,&#39;sys1&#39;,-1);
</pre>
<p>The replication scheme that was created for the AWT cache group to enable committed updates on its cache tables to be asynchronously propagated to the cached Oracle tables is automatically dropped when you drop the cache group.</p>
<p>Use a <code>DROP CACHE GROUP</code> statement to drop the cache groups from the standalone TimesTen databases and the active and standby databases.</p>
<p>Execute the following statement as the cache manager user on the <code>cachealone1</code>, <code>cachealone2</code>, <code>cacheactive</code> and <code>cachestandby</code> databases to drop the <code>subscriber_accounts</code> global cache group. The following example shows the SQL statement issued from the <code>cachealone1</code> database:</p>
<pre>% ttIsql &#34;DSN=cachealone1;UID=cacheuser;PWD=timesten;OraclePWD=oracle&#34;
Command&gt; <a id="sthref668"></a>DROP CACHE GROUP subscriber_accounts;
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the cache agent is stopped immediately after dropping a cache group, or altering the cache group&#39;s autorefresh state to <code>OFF</code>, the Oracle Database objects used to manage the caching of Oracle Database data <span class="italic">may</span> not have been dropped. When the cache agent is restarted, it drops the Oracle Database objects that were created for the dropped or altered cache group.</div>
</div>
<!-- class="sect1" -->
<a id="BABJAGGD"></a>
<div id="TTCAC332" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Destroying a cache grid<a id="sthref669"></a><a id="sthref670"></a><a id="sthref671"></a></h2>
<p>Call the <code>ttGridDestroy</code> built-in procedure to destroy a cache grid. By default, a cache grid cannot be destroyed if there are existing cache groups or attached grid members.</p>
<p>From any one of the TimesTen databases, except from the read-only subscriber databases, call the <code>ttGridDestroy</code> built-in procedure as the cache manager user to destroy the <code>ttGrid</code> cache grid:</p>
<pre>Command&gt; CALL ttGridDestroy(&#39;ttGrid&#39;);
</pre>
<p>You can force destroy a cache grid even if a grid member whose TimesTen database becomes unavailable while it contains cache groups or is attached to the grid. A TimesTen database is unavailable, for example, when the TimesTen system is taken offline or the database has been destroyed. Call the <code>ttGridDestroy</code> built-in procedure as the cache manager user passing the value 1 to the <code><span class="codeinlineitalic">force</span></code> parameter from any one of the TimesTen databases except from the read-only subscriber databases.</p>
<pre>Command&gt; CALL ttGridDestroy(&#39;ttGrid&#39;,1);
</pre>
<p>A cache grid should be destroyed only if it is no longer needed and there is no intent to attach to it again.</p>
</div>
<!-- class="sect1" -->
<a id="CHDIFIII"></a>
<div id="TTCAC333" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Stopping the cache agent<a id="sthref672"></a><a id="sthref673"></a><a id="sthref674"></a></h2>
<p>Call the <code>ttCacheStop</code> built-in procedure to stop the cache agent. This must be done on the active and standby databases of the active standby pair, and all standalone TimesTen databases.</p>
<p>From the <code>cachealone1</code>, <code>cachealone2</code>, <code>cacheactive</code> and <code>cachestandby</code> databases, issue the following built-in procedure call to stop the cache agent on the database:</p>
<pre>Command&gt; CALL ttCacheStop;
Command&gt; exit
</pre>
<p>The cache agent cannot be stopped if the TimesTen database is still attached to a cache grid.</p>
</div>
<!-- class="sect1" -->
<a id="CHDIDBCB"></a>
<div id="TTCAC334" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Destroying the TimesTen databases<a id="sthref675"></a></h2>
<p>If the TimesTen databases are no longer needed, you can use the <code>ttDestroy</code> utility to destroy the databases.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If the RAM policy designates that the database stays in memory, then this may prevent you from destroying the database. For example, if the RAM policy is set to <code>always</code>, then you must change the RAM policy to <code>manual</code> and run the <code>ttAdmin -ramunload</code> command to unload the database before destroying the database. For details on the RAM policy settings, see <a class="olink TTOPR728" href="../TTOPR/using.htm#TTOPR728">&#34;Setting the RAM policy&#34;</a> section in the <span class="italic">Oracle TimesTen In-Memory Database Operations Guide</span>.</div>
<p>The following example shows the <code>ttDestroy</code> utility connecting to and then destroying the <code>cachealone1</code> database:</p>
<pre>% ttDestroy cachealone1
</pre></div>
<!-- class="sect1" -->
<a id="CHDGDHEA"></a>
<div id="TTCAC335" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Dropping Oracle Database users and objects</h2>
<p>Use SQL*Plus as the <code>sys</code> user to drop the <code>timesten</code> user, the schema user <code>oratt</code>, and the cache administration user <code>cacheuser</code>, and all objects such as tables and triggers owned by these users. Then drop the <code>TT_CACHE_ADMIN_ROLE</code> role, and the default tablespace <code>cachetblsp</code> used by the timesten user and the cache administration user including the contents of the tablespace and its data file.</p>
<pre>% sqlplus sys as sysdba
Enter password: <span class="italic">password</span>
SQL&gt; <a id="sthref676"></a><a id="sthref677"></a>DROP USER timesten CASCADE;
SQL&gt; DROP USER oratt CASCADE;
SQL&gt; DROP USER cacheuser CASCADE;
SQL&gt; <a id="sthref678"></a>DROP ROLE tt_cache_admin_role;
SQL&gt; <a id="sthref679"></a><a id="sthref680"></a>DROP TABLESPACE cachetblsp INCLUDING CONTENTS AND DATAFILES;
SQL&gt; exit
</pre></div>
<!-- class="sect1" -->
<a id="BABJBBAF"></a>
<div id="TTCAC518" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Recommended method for a scheduled shutdown of an active standby pair with AWT cache groups</h2>
<p>When you are using active standby pairs with AWT cache groups, the environment includes both an active and a standby master, potentially one or more subscribers, and at least one Oracle Database. The following is the recommended method when you initiate a scheduled shutdown of outstanding transactions in this environment. This order of events provides the time needed to finish applying outstanding transactions before shut down and minimizes the time needed to restart all components.</p>
<ol>
<li>
<p>Shut down all applications.</p>
</li>
<li>
<p>Ensure that all transactions have propagated to the Oracle database.</p>
</li>
<li>
<p>Shut down TimesTen.</p>
</li>
<li>
<p>Shut down the Oracle Database.</p>
</li>
</ol>
<p>Then, when you are ready to restart all components:</p>
<ol>
<li>
<p>Restart the Oracle Database.</p>
</li>
<li>
<p>Restart TimesTen.</p>
</li>
<li>
<p>Restart any applications.</p>
</li>
</ol>
<p>You can shut down all of these products in any order without error. The order matters only to maximize performance and reduce the need for preserving unapplied transactions. For example, when you are using AWT cache groups within the active standby pair and if you shut down the Oracle database before TimesTen, then all unapplied transactions accumulate in the TimesTen transaction logs. Thus, when you restart TimesTen and Oracle, you could potentially have a lower throughput while pending transactions are applied to the Oracle database. Thus, shutting down TimesTen before the Oracle database provides the most efficient method for your scheduled shutdown and startup. In addition, shutting down the applications before TimesTen stops any additional requests from being sent to an unavailable TimesTen database.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment5343">
<tr>
<td class="cellalignment5350">
<table class="cellalignment5348">
<tr>
<td class="cellalignment5347"><a href="perform.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5347"><a href="caintro.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2012, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment5352">
<table class="cellalignment5346">
<tr>
<td class="cellalignment5347"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5347"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment5347"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5347"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment5347"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment5347"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>