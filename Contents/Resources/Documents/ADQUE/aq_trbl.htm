<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-963"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Troubleshooting%20Oracle%20Database%20Advanced%20Queuing"></a><title>Troubleshooting Oracle Database Advanced Queuing</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="dcterms.created" content="2014-07-01T0:30:46Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Advanced Queuing User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E17945-14"/>
<meta name="dcterms.isVersionOf" content="ADQUE"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="internet.htm" title="Previous" type="text/html"/>
<link rel="Next" href="aq_admin.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E17945-14.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">14/34</span> <!-- End Header -->
<div id="ADQUE0700" class="chapter"><a id="g1006616"></a> <a id="i1005612"></a>
<h1 class="chapter"><span class="secnum">7</span> Troubleshooting Oracle Database Advanced Queuing</h1>
<p>This chapter describes how to troubleshoot Oracle Database Advanced Queuing (AQ).</p>
<p>The chapter contains these topics:</p>
<ul>
<li>
<p><a href="#CHDCIEGG">Debugging Oracle Database Advanced Queuing Propagation Problems</a></p>
</li>
<li>
<p><a href="#i1005947">Oracle Database Advanced Queuing Error Messages</a></p>
</li>
</ul>
<a id="CHDCIEGG"></a>
<div id="ADQUE2650" class="sect1">
<h2 class="sect1"><a id="sthref573"></a>Debugging Oracle Database Advanced Queuing Propagation Problems</h2>
<p>The following tips should help with debugging propagation problems. This discussion assumes that you have created queue tables and queues in source and target databases and defined a database link for the destination database. The notation assumes that you supply the actual name of the entity (without the brackets).</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="manage.htm#i1006052">&#34;Optimizing Propagation&#34;</a></div>
<p>To begin debugging, do the following:</p>
<ol>
<li>
<p>Check that the propagation schedule has been created and that a job queue process has been assigned.</p>
<p>Look for the entry in the <code>DBA_QUEUE_SCHEDULES</code> view and make sure that the status of the schedule is enabled. <code>SCHEDULE_DISABLED</code> must be set to &#39;<code>N</code>&#39;. Check that it has a nonzero entry for <code>JOBNO</code> in table <code>AQ$_SCHEDULES</code>, and that there is an entry in table <code>JOB$</code> with that <code>JOBNO</code>.</p>
<p>To check if propagation is occurring, monitor the <code>DBA_QUEUE_SCHEDULES</code> view for the number of messages propagated (<code>TOTAL_NUMBER</code>).</p>
<p>If propagation is not occurring, check the view for any errors. Also check the <code>NEXT_RUN_DATE</code> and <code>NEXT_RUN_TIME</code> in <code>DBA_QUEUE_SCHEDULES</code> to see if propagation is scheduled for a later time, perhaps due to errors or the way it is set up.</p>
</li>
<li>
<p>Check if the database link to the destination database has been set up properly. Make sure that the queue owner can use the database link. You can do this with:</p>
<pre>select count(*) from <span class="italic">table_name</span>@d<span class="italic">blink_name</span>;
</pre></li>
<li>
<p>Make sure that at least two job queue processes are running.</p>
</li>
<li>
<p>Check for messages in the source <a href="glossary.htm#CBAHIIAB"><span class="xrefglossterm">queue</span></a> with:</p>
<pre>select count (*) from AQ$&lt;source_queue_table&gt; 
  where q_name = &#39;source_queue_name&#39;;
</pre></li>
<li>
<p>Check for messages in the destination queue with:</p>
<pre>select count (*) from AQ$&lt;destination_queue_table&gt; 
  where q_name = &#39;destination_queue_name&#39;;
</pre></li>
<li>
<p>Check to see who is using job queue processes.</p>
<p>Check which jobs are being run by querying <code>dba_jobs_running</code>. It is possible that other jobs are starving the propagation jobs.</p>
</li>
<li>
<p>Check to see that the queue table <code>sys.aq$_prop_table_</code><code><span class="codeinlineitalic">instno</span></code> exists in <code>DBA_QUEUE_TABLES</code>. The queue <code>sys.aq$_prop_notify_queue_</code><code><span class="codeinlineitalic">instno</span></code> must also exist in <code>DBA_QUEUES</code> and must be enabled for enqueue and dequeue.</p>
<p>In case of Oracle Real Application Clusters (Oracle RAC), this queue table and queue pair must exist for each Oracle RAC node in the system. They are used for communication between job queue processes and are automatically created.</p>
</li>
<li>
<p>Check that the <a href="glossary.htm#CBAJDFJA"><span class="xrefglossterm">consumer</span></a> attempting to <a href="glossary.htm#CBAGEGIF"><span class="xrefglossterm">dequeue</span></a> a <a href="glossary.htm#CBACDHGB"><span class="xrefglossterm">message</span></a> from the destination queue is a recipient of the propagated messages.</p>
<p>For 8.1-style queues, you can do the following:</p>
<pre>select consumer_name, deq_txn_id, deq_time, deq_user_id, 
  propagated_msgid from aq$&lt;destination_queue_table&gt; 
  where queue = &#39;<span class="italic">queue_name</span>&#39;;
</pre>
<p>For 8.0-style queues, you can obtain the same information from the history column of the <a href="glossary.htm#CBAFHDDD"><span class="xrefglossterm">queue table</span></a>:</p>
<pre>select h.consumer, h.transaction_id, h.deq_time, h.deq_user,
  h.propagated_msgid from aq$&lt;destination_queue_table&gt; t, table(t.history) h 
  where t.q_name = &#39;queue_name&#39;; 
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
Queues created in a queue table with <code>compatible</code> set to <code>8.0</code> (referrred to in this guide as 8.0-style queues) are deprecated in Oracle Database Advanced Queuing 10<span class="italic">g</span> Release 2 (10.2). Oracle recommends that any new queues you create be 8.1-style or newer and that you migrate existing 8.0-style queues at your earliest convenience.</div>
</li>
<li>
<p>Turn on <a href="glossary.htm#CBADIFJC"><span class="xrefglossterm">propagation</span></a> tracing at the highest level using event 24040, level 10.</p>
<p>Debugging information is logged to job queue trace files as propagation takes place. You can check the trace file for errors and for statements indicating that messages have been sent.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1005947"></a>
<div id="ADQUE2651" class="sect1">
<h2 class="sect1"><a id="sthref574"></a><a id="sthref575"></a>Oracle Database Advanced Queuing Error Messages</h2>
<p class="subhead2"><a id="ADQUE2652"></a>ORA-1555</p>
<p>You might get this error when using the <code>NEXT_MESSAGE</code> navigation option for dequeue. NEXT_MESSAGE uses the snapshot created during the first dequeue call. After that, undo information may not be retained.</p>
<p>The workaround is to use the <code>FIRST_MESSAGE</code> option to dequeue the message. This reexecutes the cursor and gets a new snapshot. FIRST_MESSAGE does not perform as well as NEXT_MESSAGE, so Oracle recommends that you dequeue messages in batches: <code>FIRST_MESSAGE</code> for one, <code>NEXT_MESSAGE</code> for the next 1000 messages, then <code>FIRST_MESSAGE</code> again, and so on.</p>
<p class="subhead1"><a id="ADQUE2653"></a>ORA-24033</p>
<p>This error is raised if a message is enqueued to a multiconsumer queue with no recipient and the queue has no subscribers (or rule-based subscribers that match this message). This is a warning that the message will be discarded because there are no recipients or subscribers to whom it can be delivered.</p>
<p class="subhead1"><a id="ADQUE2654"></a>ORA-25237</p>
<p>When using the Oracle Database Advanced Queuing navigation option, you must reset the dequeue position by using the <code>FIRST_MESSAGE</code> option if you want to continue dequeuing between services (such as <code>xa_start</code> and <code>xa_end</code> boundaries). This is because XA cancels the cursor fetch state after an <code>xa_end</code>. If you do not reset, then you get an error message stating that the navigation is used out of sequence.</p>
<p class="subhead1"><a id="ADQUE2655"></a>ORA-25307</p>
<p>Flow control has been enabled for the message sender. This means that the fastest subscriber of the sender&#39;s message is not able to keep pace with the rate at which messages are enqueued. The buffered messaging application must handle this error and attempt again to enqueue messages after waiting for some time.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment993">
<tr>
<td class="cellalignment1002">
<table class="cellalignment998">
<tr>
<td class="cellalignment997"><a href="internet.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment997"><a href="aq_admin.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1004">
<table class="cellalignment996">
<tr>
<td class="cellalignment997"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment997"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment997"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment997"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment997"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment997"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>