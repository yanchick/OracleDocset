<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-998"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Managing%20Oracle%20Database%20Advanced%20Queuing"></a><title>Managing Oracle Database Advanced Queuing</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="dcterms.created" content="2014-07-01T0:30:46Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Advanced Queuing User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E17945-14"/>
<meta name="dcterms.isVersionOf" content="ADQUE"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="aq_envir.htm" title="Previous" type="text/html"/>
<link rel="Next" href="perform.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E17945-14.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">11/34</span> <!-- End Header -->
<div id="ADQUE0400" class="chapter"><a id="g1014310"></a> <a id="i1006730"></a>
<h1 class="chapter"><span class="secnum">4</span> Managing Oracle Database Advanced Queuing</h1>
<p>This chapter discusses topics related to managing Oracle Database Advanced Queuing (AQ).</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#BABCGCHJ">Oracle Database Advanced Queuing Compatibility Parameters</a></p>
</li>
<li>
<p><a href="#i1005644">Queue Security and Access Control</a></p>
</li>
<li>
<p><a href="#i1005788">Queue Table Export/Import</a></p>
</li>
<li>
<p><a href="#i1005928">Oracle Enterprise Manager Support</a></p>
</li>
<li>
<p><a href="#i1005941">Using Oracle Database Advanced Queuing with XA</a></p>
</li>
<li>
<p><a href="#i1005949">Restrictions on Queue Management</a></p>
</li>
<li>
<p><a href="#i1006012">Managing Propagation</a></p>
</li>
</ul>
<a id="BABCGCHJ"></a>
<div id="ADQUE2557" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><a id="sthref362"></a><a id="sthref363"></a>Oracle Database Advanced Queuing Compatibility Parameters</h2>
<p>The queues in which buffered messages are stored must be created with compatibility set to 8.1 or higher.</p>
<p>The <code>compatible</code> parameter of <code>init.ora</code> and the <code>compatible</code> parameter of the <a href="glossary.htm#CBAFHDDD"><span class="xrefglossterm">queue table</span></a> should be set to 8.1 or higher to use the following features:</p>
<ul>
<li>
<p>Queue-level access control</p>
</li>
<li>
<p>Support for Oracle Real Application Clusters environments</p>
</li>
<li>
<p>Rule-based subscribers for <a href="glossary.htm#CBAIJICJ"><span class="xrefglossterm">publish/subscribe</span></a></p>
</li>
<li>
<p>Asynchronous notification</p>
</li>
<li>
<p>Sender identification</p>
</li>
<li>
<p>Separate storage of history management information</p>
</li>
<li>
<p>Secure queues</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink STRMS" href="../STRMS/toc.htm"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information on secure queues</div>
</li>
</ul>
<p><a id="sthref364"></a><a id="sthref365"></a><a id="sthref366"></a>Mixed case (upper and lower case together) queue names, queue table names, and subscriber names are supported if database compatibility is 10.0, but the names must be enclosed in double quote marks. So <code>abc.efg</code> means the schema is <code>ABC</code> and the name is <code>EFG</code>, but <code>&#34;abc&#34;.&#34;efg&#34;</code> means the schema is <code>abc</code> and the name is <code>efg</code>.</p>
</div>
<!-- class="sect1" -->
<a id="i1005644"></a>
<div id="ADQUE2558" class="sect1">
<h2 class="sect1">Queue Security and Access Control</h2>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#BABBDECH">Oracle Database Advanced Queuing Security</a></p>
</li>
<li>
<p><a href="#i1005684">Queue Security</a></p>
</li>
<li>
<p><a href="#i1005733">Queue Privileges and Access Control</a></p>
</li>
<li>
<p><a href="#i1005771">OCI Applications and Queue Access</a></p>
</li>
<li>
<p><a href="#i1006641">Security Required for Propagation</a></p>
</li>
</ul>
<a id="BABBDECH"></a>
<div id="ADQUE2559" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><code><a id="sthref367"></a><a id="sthref368"></a><a id="sthref369"></a></code><a id="sthref370"></a>Oracle Database Advanced Queuing Security</h3>
<p>Configuration information can be managed through procedures in the <code>DBMS_AQADM</code> package. Initially, only <code>SYS</code> and <code>SYSTEM</code> have execution privilege for the procedures in <code>DBMS_AQADM</code> and <code>DBMS_AQ</code>. Users who have been granted <code>EXECUTE</code> rights to these two packages are able to create, manage, and use queues in their own schemas. <code>The MANAGE_ANY</code> AQ system privilege is used to create and manage queues in other schemas.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="aq_admin.htm#i1006551">&#34;Granting Oracle Database Advanced Queuing System Privileges&#34;</a> for more information on AQ system privileges</div>
<p>Users of the <a href="glossary.htm#i432286"><span class="xrefglossterm">Java Message Service</span></a> (JMS) <a href="glossary.htm#CBAIGGDE"><span class="xrefglossterm">API</span></a> need <code>EXECUTE</code> privileges on <code>DBMS_AQJMS</code> and <code>DBMS_AQIN</code>.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#BABJCCDE">Administrator Role</a></p>
</li>
<li>
<p><a href="#BABEFGBD">User Role</a></p>
</li>
<li>
<p><a href="#BABCGIDB">Access to Oracle Database Advanced Queuing Object Types</a></p>
</li>
</ul>
<a id="BABJCCDE"></a>
<div id="ADQUE2560" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><a id="sthref371"></a><a id="sthref372"></a>Administrator Role</h4>
<p>The <code>AQ_ADMINISTRATOR_ROLE</code> has all the required privileges to administer queues. The privileges granted to the role let the grantee:</p>
<ul>
<li>
<p>Perform any <a href="glossary.htm#CBAHIIAB"><span class="xrefglossterm">queue</span></a> administrative operation, including create queues and queue tables on any <a href="glossary.htm#CBACBEEF"><span class="xrefglossterm">schema</span></a> in the database</p>
</li>
<li>
<p>Perform <a href="glossary.htm#CBAJCGCH"><span class="xrefglossterm">enqueue</span></a> and <a href="glossary.htm#CBAGEGIF"><span class="xrefglossterm">dequeue</span></a> operations on any queues in the database</p>
</li>
<li>
<p>Access statistics views used for monitoring the queue workload</p>
</li>
<li>
<p>Create transformations using <code>DBMS_TRANSFORM</code></p>
</li>
<li>
<p>Run all procedures in <code>DBMS_AQELM</code></p>
</li>
<li>
<p>Run all procedures in <code>DBMS_AQJMS</code></p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="BABEFGBD"></a>
<div id="ADQUE2561" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><a id="sthref373"></a><a id="sthref374"></a>User Role</h4>
<p>You should avoid granting <code>AQ_USER_ROLE</code>, because this role does not provide sufficient privileges for enqueuing or dequeuing.</p>
<p>Your database administrator has the option of granting the system privileges <code>ENQUEUE_ANY</code> and <code>DEQUEUE_ANY</code>, exercising <code>DBMS_AQADM.GRANT_SYSTEM_PRIVILEGE</code> and <code>DBMS_AQADM.REVOKE_SYSTEM_PRIVILEGE</code> directly to a database user, if you want the user to have this level of control.</p>
<p>You as the application developer give rights to a queue by granting and revoking privileges at the object level by exercising <code>DBMS_AQADM.GRANT_QUEUE_PRIVILEGE</code> and <code>DBMS_AQADM.REVOKE_QUEUE_PRIVILEGE</code>.</p>
<p>As a database user, you do not need any explicit object-level or system-level privileges to enqueue or dequeue to queues in your own schema other than the <code>EXECUTE</code> right on <code>DBMS_AQ</code>.</p>
</div>
<!-- class="sect3" -->
<a id="BABCGIDB"></a>
<div id="ADQUE2562" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><a id="sthref375"></a><a id="sthref376"></a><a id="sthref377"></a>Access to Oracle Database Advanced Queuing Object Types</h4>
<p>All internal Oracle Database Advanced Queuing objects are now accessible to <code>PUBLIC</code>.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1005684"></a>
<div id="ADQUE2563" class="sect2">
<h3 class="sect2"><a id="sthref378"></a><a id="sthref379"></a>Queue Security</h3>
<p>Oracle Database Advanced Queuing administrators of Oracle Database can create queues. When you create queues, the default value of the <code>compatible</code> parameter in <code>DBMS_AQADM.CREATE_QUEUE_TABLE</code> is that of the <code>compatible</code> parameter.</p>
<p>To enqueue or dequeue, users need <code>EXECUTE</code> rights on <code>DBMS_AQ</code> and either enqueue or dequeue privileges on target queues, or <code>ENQUEUE_ANY</code>/<code>DEQUEUE_ANY</code> system privileges.</p>
</div>
<!-- class="sect2" -->
<a id="i1005733"></a>
<div id="ADQUE2564" class="sect2">
<h3 class="sect2"><a id="sthref380"></a><a id="sthref381"></a><a id="sthref382"></a>Queue Privileges and Access Control</h3>
<p>You can grant or revoke privileges at the object level on queues. You can also grant or revoke various system-level privileges. <a href="#g1010210">Table 4-1</a> lists all common Oracle Database Advanced Queuing operations and the privileges needed to perform these operations.</p>
<div id="ADQUE2565" class="tblformal">
<p class="titleintable"><a id="sthref383"></a><a id="g1010210"></a>Table 4-1 Operations and Required Privileges</p>
<table class="cellalignment1005" title="Operations and Required Privileges" summary="Rows are operations. The first column describes the operation, and the second column lists the privileges required for that operation." dir="ltr">
<thead>
<tr class="cellalignment994">
<th class="cellalignment1001" id="r1c1-t4">Operation(s)</th>
<th class="cellalignment1001" id="r1c2-t4">Privileges Required</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment994">
<td class="cellalignment1002" id="r2c1-t4" headers="r1c1-t4">
<p><code>CREATE</code>/<code>DROP</code>/<code>MONITOR</code> own queues</p>
</td>
<td class="cellalignment1002" headers="r2c1-t4 r1c2-t4">
<p>Must be granted <code>EXECUTE</code> rights on <code>DBMS_AQADM</code>. No other privileges needed.</p>
</td>
</tr>
<tr class="cellalignment994">
<td class="cellalignment1002" id="r3c1-t4" headers="r1c1-t4">
<p><code>CREATE</code>/<code>DROP</code>/<code>MONITOR</code> any queues</p>
</td>
<td class="cellalignment1002" headers="r3c1-t4 r1c2-t4">
<p>Must be granted <code>EXECUTE</code> rights on <code>DBMS_AQADM</code> and be granted <code>AQ_ADMINISTRATOR_ROLE</code> by another user who has been granted this role (<code>SYS</code> and <code>SYSTEM</code> are the first granters of <code>AQ_ADMINISTRATOR_ROLE)</code></p>
</td>
</tr>
<tr class="cellalignment994">
<td class="cellalignment1002" id="r4c1-t4" headers="r1c1-t4">
<p><code>ENQUEUE</code>/ <code>DEQUEUE</code> to own queues</p>
</td>
<td class="cellalignment1002" headers="r4c1-t4 r1c2-t4">
<p>Must be granted <code>EXECUTE</code> rights on <code>DBMS_AQ</code>. No other privileges needed.</p>
</td>
</tr>
<tr class="cellalignment994">
<td class="cellalignment1002" id="r5c1-t4" headers="r1c1-t4">
<p><code>ENQUEUE</code>/ <code>DEQUEUE</code> to another&#39;s queues</p>
</td>
<td class="cellalignment1002" headers="r5c1-t4 r1c2-t4">
<p>Must be granted <code>EXECUTE</code> rights on <code>DBMS_AQ</code> and be granted privileges by the owner using <code>DBMS_AQADM</code>.<code>GRANT_QUEUE_PRIVILEGE</code>.</p>
</td>
</tr>
<tr class="cellalignment994">
<td class="cellalignment1002" id="r6c1-t4" headers="r1c1-t4">
<p><code>ENQUEUE</code>/ <code>DEQUEUE</code> to any queues</p>
</td>
<td class="cellalignment1002" headers="r6c1-t4 r1c2-t4">
<p>Must be granted <code>EXECUTE</code> rights on <code>DBMS_AQ</code> and be granted <code>ENQUEUE</code> <code>ANY</code> <code>QUEUE</code> or <code>DEQUEUE</code> <code>ANY</code> <code>QUEUE</code> system privileges by an Oracle Database Advanced Queuing administrator using <code>DBMS_AQADM</code>.<code>GRANT_SYSTEM_PRIVILEGE</code>.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" --></div>
<!-- class="sect2" -->
<a id="i1005771"></a>
<div id="ADQUE2566" class="sect2">
<h3 class="sect2"><a id="sthref384"></a><a id="sthref385"></a><a id="sthref386"></a>OCI Applications and Queue Access</h3>
<p>For an <a href="glossary.htm#CBAFBDDI"><span class="xrefglossterm">Oracle Call Interface</span></a> (OCI) application to access a queue, the session user must be granted either the object privilege of the queue he intends to access or the <code>ENQUEUE</code> <code>ANY</code> <code>QUEUE</code> or <code>DEQUEUE</code> <code>ANY</code> <code>QUEUE</code> system privileges. The <code>EXECUTE</code> right of <code>DBMS_AQ</code> is not checked against the session user&#39;s rights.</p>
</div>
<!-- class="sect2" -->
<a id="i1006641"></a>
<div id="ADQUE2567" class="sect2">
<h3 class="sect2"><a id="sthref387"></a><a id="sthref388"></a>Security Required for Propagation</h3>
<p>Oracle Database Advanced Queuing propagates messages through database links. The <a href="glossary.htm#CBADIFJC"><span class="xrefglossterm">propagation</span></a> driver dequeues from the source queue as owner of the source queue; hence, no explicit access rights need be granted on the source queue. At the destination, the login user in the database link should either be granted <code>ENQUEUE</code> <code>ANY</code> <code>QUEUE</code> privilege or be granted the right to enqueue to the destination queue. However, if the login user in the database link also owns the queue tables at the destination, then no explicit Oracle Database Advanced Queuing privileges must be granted.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="#i1006082">&#34;Propagation from Object Queues&#34;</a></div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1005788"></a>
<div id="ADQUE2568" class="sect1">
<h2 class="sect1"><a id="sthref389"></a><a id="sthref390"></a>Queue Table Export/Import</h2>
<p>When a queue table is exported, the queue table data and anonymous blocks of PL/SQL code are written to the export dump file. When a queue table is imported, the import utility executes these PL/SQL anonymous blocks to write the metadata to the data dictionary.</p>
<p>Oracle AQ does not export registrations with a user export. All applications that make use of client registrations should take this into account as the client may not be present in the imported database.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
You cannot export or import buffered messages.
<p>If there exists a queue table with the same name in the same schema in the database as in the export dump, then ensure that the database queue table is empty before importing a queue table with queues. Failing to do so has a possibility of ruining the metadata for the imported queue.</p>
</div>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#i1005801">Exporting Queue Table Data</a></p>
</li>
<li>
<p><a href="#i1005843">Importing Queue Table Data</a></p>
</li>
<li>
<p><a href="#CHDIACBB">Data Pump Export and Import</a></p>
</li>
</ul>
<a id="i1005801"></a>
<div id="ADQUE2569" class="sect2">
<h3 class="sect2"><a id="sthref391"></a><a id="sthref392"></a>Exporting Queue Table Data</h3>
<p>The export of queues entails the export of the underlying queue tables and related dictionary tables. Export of queues can also be accomplished at queue-table granularity.</p>
<p class="subhead1"><a id="ADQUE2570"></a><a id="sthref393"></a><a id="sthref394"></a>Exporting Queue Tables with Multiple Recipients</p>
<p>A queue table that supports multiple recipients is associated with the following tables:</p>
<ul>
<li>
<p>Dequeue <a href="glossary.htm#CBAFGGGG"><span class="xrefglossterm">index-organized table</span></a> (IOT)</p>
</li>
<li>
<p>Time-management index-organized table</p>
</li>
<li>
<p>Subscriber table</p>
</li>
<li>
<p>A history IOT</p>
</li>
</ul>
<p>These tables are exported automatically during full database mode, user mode and table mode exports. See <a href="#i1005833">&#34;Export Modes&#34;</a>.</p>
<p>Because the metadata tables contain ROWIDs of some rows in the queue table, the import process generates a note about the ROWIDs being made obsolete when importing the metadata tables. This message can be ignored, because the queuing system automatically corrects the obsolete ROWIDs as a part of the import operation. However, if another problem is encountered while doing the import (such as running out of rollback segment space), then you should correct the problem and repeat the import.</p>
<p class="subhead1"><a id="i1005833"></a><a id="ADQUE2571"></a><a id="sthref395"></a><a id="sthref396"></a>Export Modes</p>
<p>Exporting operates in full database mode, user mode, and table mode. Incremental exports on queue tables are not supported.</p>
<p>In full database mode, queue tables, all related tables, system-level grants, and primary and secondary object grants are exported automatically.</p>
<p>In user mode, queue tables, all related tables, and primary object grants are exported automatically. However, doing a user-level export from one schema to another using the <code>FROMUSER</code> <code>TOUSER</code> clause is not supported.</p>
<p>In table mode, queue tables, all related tables, and primary object grants are exported automatically. For example, when exporting a multiconsumer queue table, the following tables are automatically exported:</p>
<ul>
<li>
<p><code>AQ$</code>_<code><span class="codeinlineitalic">queue_table</span></code><code>_I</code> (the dequeue IOT)</p>
</li>
<li>
<p><code>AQ$_</code><code><span class="codeinlineitalic">queue_table</span></code><code>_T</code> (the time-management IOT)</p>
</li>
<li>
<p><code>AQ$_queue_table_S</code> (the subscriber table)</p>
</li>
<li>
<p><code>AQ$_</code><code><span class="codeinlineitalic">queue_table</span></code><code>_H</code> (the history IOT)</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="i1005843"></a>
<div id="ADQUE2572" class="sect2">
<h3 class="sect2"><a id="sthref397"></a><a id="sthref398"></a>Importing Queue Table Data</h3>
<p>Similar to exporting queues, importing queues entails importing the underlying queue tables and related dictionary data. After the queue table data is imported, the import utility executes the PL/SQL anonymous blocks in the dump file to write the metadata to the data dictionary.</p>
<p class="subhead1"><a id="ADQUE2573"></a><a id="sthref399"></a><a id="sthref400"></a>Importing Queue Tables with Multiple Recipients</p>
<p>A queue table that supports multiple recipients is associated with the following tables:</p>
<ul>
<li>
<p>A dequeue IOT</p>
</li>
<li>
<p>A time-management IOT</p>
</li>
<li>
<p>A subscriber table</p>
</li>
<li>
<p>A history IOT</p>
</li>
</ul>
<p>These tables must be imported and, also the queue table itself.</p>
<p class="subhead1"><a id="i1005853"></a><a id="ADQUE2574"></a><a id="sthref401"></a><a id="sthref402"></a>Import IGNORE Parameter</p>
<p>You must not import queue data into a queue table that already contains data. The <code>IGNORE</code> parameter of the import utility must always be set to <code>NO</code> when importing queue tables. If the <code>IGNORE</code> parameter is set to <code>YES</code>, and the queue table that already exists is compatible with the table definition in the dump file, then the rows are loaded from the dump file into the existing table. At the same time, the old queue table definition is lost and re-created. Queue table definition prior to the import is lost and duplicate rows appear in the queue table.</p>
</div>
<!-- class="sect2" -->
<a id="CHDIACBB"></a>
<div id="ADQUE2575" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><a id="sthref403"></a><a id="sthref404"></a><a id="sthref405"></a><a id="sthref406"></a>Data Pump Export and Import</h3>
<p>The Data Pump replace and skip modes are supported for queue tables. In the replace mode an existing queue table is dropped and replaced by the new queue table from the export dump file. In the skip mode, a queue table that already exists is not imported.</p>
<p>The truncate and append modes are not supported for queue tables. The behavior in this case is the same as the replace mode.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SUTIL" href="../SUTIL/toc.htm"><span class="italic">Oracle Database Utilities</span></a> for more information on Data Pump Export and Data Pump Import</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1005928"></a>
<div id="ADQUE2576" class="sect1">
<h2 class="sect1"><a id="sthref407"></a><a id="sthref408"></a>Oracle Enterprise Manager Support</h2>
<p>Oracle Enterprise Manager supports most of the administrative functions of Oracle Database Advanced Queuing. Oracle Database Advanced Queuing functions are found under the Distributed node in the navigation tree of the Enterprise Manager console. Functions available through Oracle Enterprise Manager include:</p>
<ul>
<li>
<p>Using queues as part of the schema manager to view properties</p>
</li>
<li>
<p>Creating, starting, stopping, and dropping queues</p>
</li>
<li>
<p>Scheduling and unscheduling propagation</p>
</li>
<li>
<p>Adding and removing subscribers</p>
</li>
<li>
<p>Viewing propagation schedules for all queues in the database</p>
</li>
<li>
<p>Viewing errors for all queues in the database</p>
</li>
<li>
<p>Viewing the message queue</p>
</li>
<li>
<p>Granting and revoking privileges</p>
</li>
<li>
<p>Creating, modifying, or removing transformations</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="i1005941"></a>
<div id="ADQUE2577" class="sect1">
<h2 class="sect1"><a id="sthref409"></a>Using Oracle Database Advanced Queuing with XA</h2>
<p>You must specify &#34;<code>Objects=T</code>&#34; in the <code>xa_open</code> string if you want to use the Oracle Database Advanced Queuing OCI interface. This forces XA to initialize the client-side cache in Objects mode. You are not required to do this if you plan to use Oracle Database Advanced Queuing through PL/SQL wrappers from OCI or Pro*C.</p>
<p>The <a href="glossary.htm#CBAHJCBG"><span class="xrefglossterm">large object</span></a> (LOB) memory management concepts from the Pro* documentation are not relevant for Oracle Database Advanced Queuing raw messages because Oracle Database Advanced Queuing provides a simple RAW buffer abstraction (although they are stored as LOBs).</p>
<p>When using the Oracle Database Advanced Queuing navigation option, you must reset the dequeue position by using the <code>FIRST_MESSAGE</code> option if you want to continue dequeuing between services (such as <code>xa_start</code> and <code>xa_end</code> boundaries). This is because XA cancels the cursor fetch state after an <code>xa_end</code>. If you do not reset, then you get an error message stating that the navigation is used out of sequence (ORA-25237).</p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<ul>
<li>
<p>&#34;Working with Transaction Monitors with Oracle XA&#34; in <a class="olink ADFNS" href="../ADFNS/toc.htm"><span class="italic">Oracle Database Development Guide</span></a> for more information on XA</p>
</li>
<li>
<p>&#34;Large Objects (LOBs)&#34; in <a class="olink LNPCC" href="../LNPCC/toc.htm"><span class="italic">Pro*C/C++ Programmer&#39;s Guide</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect1" -->
<a id="i1005949"></a>
<div id="ADQUE2578" class="sect1">
<h2 class="sect1"><a id="sthref410"></a><a id="sthref411"></a>Restrictions on Queue Management</h2>
<p>This section discusses restrictions on queue management.</p>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#i1007290">Subscribers</a></p>
</li>
<li>
<p><a href="#i1007295">DML Not Supported on Queue Tables or Associated IOTs</a></p>
</li>
<li>
<p><a href="#i1007300">Propagation from Object Queues with REF Payload Attributes</a></p>
</li>
<li>
<p><a href="#i1005982">Collection Types in Message Payloads</a></p>
</li>
<li>
<p><a href="#i1005996">Synonyms on Queue Tables and Queues</a></p>
</li>
<li>
<p><a href="#CACJFIGA">Synonyms on Object Types</a></p>
</li>
<li>
<p><a href="#i1006000">Tablespace Point-in-Time Recovery</a></p>
</li>
<li>
<p><a href="#CACFBDGD">Virtual Private Database</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Mixed case (upper and lower case together) queue names, queue table names, and subscriber names are supported if database compatibility is 10.0, but the names must be enclosed in double quote marks. So <code>abc.efg</code> means the schema is <code>ABC</code> and the name is <code>EFG</code>, but <code>&#34;abc&#34;.&#34;efg&#34;</code> means the schema is <code>abc</code> and the name is <code>efg</code>.</div>
<a id="i1007290"></a>
<div id="ADQUE2579" class="sect2">
<h3 class="sect2"><a id="sthref412"></a><a id="sthref413"></a><a id="sthref414"></a><a id="sthref415"></a>Subscribers</h3>
<p>You cannot have more than 1,000 local subscribers for each queue. Also, only 32 remote subscribers are allowed for each remote destination database.</p>
</div>
<!-- class="sect2" -->
<a id="i1007295"></a>
<div id="ADQUE2580" class="sect2">
<h3 class="sect2">DML Not Supported on Queue Tables or Associated IOTs</h3>
<p>Oracle Database Advanced Queuing does not support <a href="glossary.htm#CBADHEBI"><span class="xrefglossterm">data manipulation language</span></a> (DML) operations on queue tables or associated index-organized tables (IOTs), if any. The only supported means of modifying queue tables is through the supplied APIs. Queue tables and IOTs can become inconsistent and therefore effectively ruined, if DML operations are performed on them.</p>
</div>
<!-- class="sect2" -->
<a id="i1007300"></a>
<div id="ADQUE2581" class="sect2">
<h3 class="sect2"><a id="sthref416"></a><a id="sthref417"></a><a id="sthref418"></a>Propagation from Object Queues with REF Payload Attributes</h3>
<p>Oracle Database Advanced Queuing does not support propagation from object queues that have REF attributes in the payload.</p>
</div>
<!-- class="sect2" -->
<a id="i1005982"></a>
<div id="ADQUE2582" class="sect2">
<h3 class="sect2"><a id="sthref419"></a><a id="sthref420"></a><a id="sthref421"></a>Collection Types in Message Payloads</h3>
<p>You cannot construct a <a href="glossary.htm#CBACDHGB"><span class="xrefglossterm">message</span></a> payload using a <a href="glossary.htm#CBAHJGCH"><span class="xrefglossterm">VARRAY</span></a> that is not itself contained within an object. You also cannot currently use a NESTED Table even as an embedded object within a message payload. However, you can create an <a href="glossary.htm#CBAGCEHG"><span class="xrefglossterm">object type</span></a> that contains one or more VARRAYs, and create a queue table that is founded on this object type, as shown in <a href="#i1005988">Example 4-1</a>.</p>
<div id="ADQUE2583" class="example">
<p class="titleinexample"><a id="i1005988"></a>Example 4-1 Creating Objects Containing VARRAYs</p>
<pre>CREATE TYPE number_varray AS VARRAY(32) OF NUMBER; 
CREATE TYPE embedded_varray AS OBJECT (col1 number_varray);
EXECUTE DBMS_AQADM.CREATE_QUEUE_TABLE( 
  queue_table           =&gt;     &#39;QT&#39;, 
  queue_payload_type    =&gt;     &#39;embedded_varray&#39;); 
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="i1005996"></a>
<div id="ADQUE2584" class="sect2">
<h3 class="sect2"><a id="sthref422"></a><a id="sthref423"></a><a id="sthref424"></a><a id="sthref425"></a>Synonyms on Queue Tables and Queues</h3>
<p>No Oracle Database Advanced Queuing PL/SQL calls resolve synonyms on queues and queue tables. Although you can create synonyms, you should not apply them to the Oracle Database Advanced Queuing interface.</p>
</div>
<!-- class="sect2" -->
<a id="CACJFIGA"></a>
<div id="ADQUE2585" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><a id="sthref426"></a>Synonyms on Object Types</h3>
<p>If you have created synonyms on object types, you cannot use them in <code>DBMS_AQADM.CREATE_QUEUE_TABLE</code>. Error ORA-24015 results.</p>
</div>
<!-- class="sect2" -->
<a id="i1006000"></a>
<div id="ADQUE2586" class="sect2">
<h3 class="sect2"><a id="sthref427"></a><a id="sthref428"></a>Tablespace Point-in-Time Recovery</h3>
<p>Oracle Database Advanced Queuing currently does not support tablespace point-in-time recovery. Creating a queue table in a tablespace disables that particular tablespace for point-in-time recovery. Oracle Database Advanced Queuing does support regular point-in-time recovery.</p>
</div>
<!-- class="sect2" -->
<a id="CACFBDGD"></a>
<div id="ADQUE2587" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><a id="sthref429"></a><a id="sthref430"></a><a id="sthref431"></a><a id="sthref432"></a>Virtual Private Database</h3>
<p>You can use Oracle Database Advanced Queuing with Virtual Private Database by specifying a security policy with Oracle Database Advanced Queuing queue tables. While dequeuing, use the dequeue condition (<code>deq_cond</code>) or the correlation identifier for the policy to be applied. You can use &#34;1=1&#34; as the dequeue condition. If you do not use a dequeue condition or correlation ID, then the dequeue results in an error.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
When a dequeue condition or correlation identifier is used, the order of the messages dequeued is indeterminate, and the sort order of the queue is not honored.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1006012"></a>
<div id="ADQUE2588" class="sect1">
<h2 class="sect1"><a id="sthref433"></a><a id="sthref434"></a>Managing Propagation</h2>
<p>This section contains these topics:</p>
<ul>
<li>
<p><a href="#i1006046">EXECUTE Privileges Required for Propagation</a></p>
</li>
<li>
<p><a href="#i1006082">Propagation from Object Queues</a></p>
</li>
<li>
<p><a href="#i1006052">Optimizing Propagation</a></p>
</li>
<li>
<p><a href="#CACGEAGD">Handling Failures in Propagation</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Caution:</p>
For propagation to work correctly, the queue <code>aq$_prop_notify_X</code> should never be stopped or dropped and the table <code>aq$_prop_table_X</code> should never be dropped.</div>
<a id="i1006046"></a>
<div id="ADQUE2589" class="sect2">
<h3 class="sect2"><a id="sthref435"></a><a id="sthref436"></a>EXECUTE Privileges Required for Propagation</h3>
<p>Propagation jobs are owned by <code>SYS</code>, but the propagation occurs in the security context of the queue table owner. Previously propagation jobs were owned by the user scheduling propagation, and propagation occurred in the security context of the user setting up the propagation schedule. The queue table owner must be granted <code>EXECUTE</code> privileges on the <code>DBMS_AQADM</code> package. Otherwise, the Oracle Database snapshot processes do not propagate and generate trace files with the error identifier <code>SYS.DBMS_AQADM</code> not defined. Private database links owned by the queue table owner can be used for propagation. The user name specified in the connection string must have <code>EXECUTE</code> access on the <code>DBMS_AQ</code> and <code>DBMS_AQADM</code> packages on the remote database.</p>
</div>
<!-- class="sect2" -->
<a id="i1006082"></a>
<div id="ADQUE2590" class="sect2">
<h3 class="sect2"><a id="sthref437"></a><a id="sthref438"></a>Propagation from Object Queues</h3>
<p>Propagation from object queues with <code>BFILE</code> objects is supported. To be able to propagate object queues with <code>BFILE</code> objects, the source queue owner must have read privileges on the directory object corresponding to the directory in which the <code>BFILE</code> is stored. The database link user must have write privileges on the directory object corresponding to the directory of the <code>BFILE</code> at the destination database.</p>
<p>AQ propagation does not support non-final types. Propagation of <code>BFILE</code> objects from object queues without specifying a database link is not supported.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
&#34;CREATE DIRECTORY&#34; in <a class="olink SQLRF" href="../SQLRF/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information on directory objects</div>
</div>
<!-- class="sect2" -->
<a id="i1006052"></a>
<div id="ADQUE2591" class="sect2">
<h3 class="sect2"><a id="sthref439"></a><a id="sthref440"></a>Optimizing Propagation</h3>
<p>AQ propagation jobs are run by the Oracle Scheduler. Propagation may be scheduled in the following ways:</p>
<ul>
<li>
<p>A dedicated schedule in which the propagation runs forever or for a specified duration. This mode provides the lowest propagation latencies.</p>
</li>
<li>
<p>A periodic schedule in which the propagation runs periodically for a specified interval. This may be used when propagation can be run in a batched mode.</p>
</li>
<li>
<p>An event based system in which propagation is started when there are messages to be propagated. This mode makes more efficient use of available resources, while still providing a fast response time.</p>
</li>
</ul>
<p>The administrator may choose a schedule that best meets the application performance requirements.</p>
<p>Oracle Scheduler will start the required number of job queue processes for the propagation schedules. Since the scheduler optimizes for throughput, if the system is heavily loaded, it may not run some propagation jobs. The resource manager may be used to have better control over the scheduling decisions. In particular, associating propagation jobs with different resource groups can allow for fairness in scheduling which may be important in heavy load situations.</p>
<p><code>In setting the number of JOB_QUEUE_PROCESSES,</code> DBAs should be aware that this number is determined by the number of queues from which the messages must be propagated and the number of destinations (rather than queues) to which messages must be propagated.</p>
<p>A scheduling algorithm handles propagation. The algorithm optimizes available job queue processes and minimizes the time it takes for a message to show up at a destination after it has been enqueued into the source queue, thereby providing near-<a href="glossary.htm#CBABDHFB"><span class="xrefglossterm">OLTP</span></a> action. The algorithm can handle an unlimited number of schedules and various types of failures. While propagation tries to make the optimal use of the available job queue processes, the number of job queue processes to be started also depends on the existence of jobs unrelated to propagation, such as replication jobs. Hence, it is important to use the following guidelines to get the best results from the scheduling algorithm.</p>
<p>The scheduling algorithm uses the job queue processes as follows (for this discussion, an active schedule is one that has a valid current window):</p>
<ul>
<li>
<p>If the number of active schedules is fewer than half the number of job queue processes, then the number of job queue processes acquired corresponds to the number of active schedules.</p>
</li>
<li>
<p>If the number of active schedules is more than half the number of job queue processes, after acquiring half the number of job queue processes, then multiple active schedules are assigned to an acquired job queue process.</p>
</li>
<li>
<p>If the system is overloaded (all schedules are busy propagating), depending on availability, then additional job queue processes are acquired up to one fewer than the total number of job queue processes.</p>
</li>
<li>
<p>If none of the active schedules handled by a process has messages to be propagated, then that job queue process is released.</p>
</li>
<li>
<p>The algorithm performs automatic load balancing by transferring schedules from a heavily loaded process to a lightly load process such that no process is excessively loaded.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="CACGEAGD"></a>
<div id="ADQUE2592" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2">Handling Failures in Propagation</h3>
<p>The scheduling algorithm has robust support for handling failures. Common failures that prevent message propagation include the following:</p>
<ul>
<li>
<p>Database link failed</p>
</li>
<li>
<p>Remote database is not available</p>
</li>
<li>
<p>Remote queue does not exist</p>
</li>
<li>
<p>Remote queue was not started</p>
</li>
<li>
<p>Security violation while trying to enqueue messages into remote queue</p>
</li>
</ul>
<p>Under all these circumstances the appropriate error messages are reported in the <code>DBA_QUEUE_SCHEDULES</code> view.</p>
<p>When an error occurs in a schedule, propagation of messages in that schedule is attempted again after a retry period that is a function of the number of failures. After the retries have exceeded a system defined maximum, the schedule is disabled.</p>
<p>If the problem causing the error is fixed and the schedule is enabled, then the error fields that indicate the last error date, time, and message continue to show the error information. These fields are reset only when messages are successfully propagated in that schedule.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="aq_trbl.htm#g1006616">Chapter 7, &#34;Troubleshooting Oracle Database Advanced Queuing&#34;</a></div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment993">
<tr>
<td class="cellalignment1002">
<table class="cellalignment998">
<tr>
<td class="cellalignment997"><a href="aq_envir.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment997"><a href="perform.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment1004">
<table class="cellalignment996">
<tr>
<td class="cellalignment997"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment997"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment997"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment997"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment997"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment997"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>