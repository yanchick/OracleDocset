<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-46469"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Recovering%20from%20Unscheduled%20Outages"></a><title>Recovering from Unscheduled Outages</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1060"/>
<meta name="dcterms.created" content="2015-07-15T12:40:32Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database High Availability Best Practices"/>
<meta name="dcterms.identifier" content="E40019-02"/>
<meta name="dcterms.isVersionOf" content="HABPT"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2005, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="monitor.htm" title="Previous" type="text/html"/>
<link rel="Next" href="schedule_outage.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E40019-02.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">17/20</span> <!-- End Header -->
<script>
<!-- // <![CDATA[
window.name='outage'
// ]]> -->
</script> <script>
// <![CDATA[
function footdisplay(footnum,footnote) {
    var msg = window.open('', 'NewWindow' + footnum,
        'directories=no,height=120,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');

    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>');
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('');
    msg.document.write('<style> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/body><\/html>');
    msg.document.close();
    msg.focus();
}
// ]]>
</script> <noscript>
<p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
</noscript>
<div id="HABPT004" class="chapter"><a id="CDEGEJJJ"></a> <a id="i1005910"></a>
<h1 class="chapter"><span class="secnum">12</span> Recovering from Unscheduled Outages</h1>
<p>This chapter describes the Oracle operational best practices that can tolerate or manage each unscheduled outage type and minimize downtime.</p>
<p>This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#i1011136">Overview of Unscheduled Outages</a></p>
</li>
<li>
<p><a href="#CACBFBHF">Recovering from Unscheduled Outages</a></p>
</li>
<li>
<p><a href="#CACJGHCF">Restoring Fault Tolerance</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="schedule_outage.htm#BABBGGBG">Chapter 13, &#34;Reducing Downtime for Planned Maintenance&#34;</a> for information about scheduled outages.</div>
<a id="i1011136"></a>
<div id="HABPT4999" class="sect1">
<h2 class="sect1"><span class="secnum">12.1</span> Overview of Unscheduled Outages<a id="ABC3587774"></a></h2>
<p>This section describes <a id="sthref682"></a><a id="sthref683"></a>unscheduled outages that affect the primary or secondary site components, and describes the recommended methods to repair or minimize the downtime associated with each outage.</p>
<p>Unscheduled outages are unanticipated failures in any part of the technology infrastructure that supports the application, including the following components:</p>
<ul>
<li>
<p>Hardware</p>
</li>
<li>
<p>Software</p>
</li>
<li>
<p>Network infrastructure</p>
</li>
<li>
<p>Storage infrastructure</p>
</li>
<li>
<p>Naming services infrastructure</p>
</li>
<li>
<p>Database</p>
</li>
<li>
<p>Data center</p>
</li>
</ul>
<p>Your monitoring and high availability infrastructure should provide rapid detection and recovery from downtime.</p>
<a id="i1011873"></a>
<div id="HABPT5000" class="sect2">
<h3 class="sect2"><span class="secnum">12.1.1</span> Managing Unscheduled Outages on the Primary Site<a id="sthref684"></a> Best Practices</h3>
<p>Solutions for unscheduled outages are critical for maximum availability of the system. <a href="#g1016043">Table 12-1</a> compares the four MAA reference architectures and summarizes the <a id="sthref685"></a>recovery steps for unscheduled outages on the primary site. The MAA reference architectures are described in <a class="olink HAOVW" href="../HAOVW/toc.htm"><span class="italic">Oracle Database High Availability Overview</span></a>. For outages that require multiple recovery steps, the table includes links to the detailed descriptions in <a href="#CACBFBHF">Section 12.2, &#34;Recovering from Unscheduled Outages&#34;</a>.</p>
<div id="HABPT5001" class="tblruleformalwide">
<p class="titleintable"><a id="sthref686"></a><a id="g1016043"></a>Table 12-1 Recovery Times and Steps for Unscheduled Outages on the Primary Site</p>
<table class="cellalignment2589" title="Recovery Times and Steps for Unscheduled Outages on the Primary Site " summary="This table describes recovery steps for various unscheduled outages of a primary site.">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t3">Outage Scope</th>
<th class="cellalignment2590" id="r1c2-t3">Bronze: Single Instance HA + Backup</th>
<th class="cellalignment2590" id="r1c3-t3">Silver: Oracle RAC</th>
<th class="cellalignment2590" id="r1c4-t3">Gold: Oracle RAC and Oracle Active Data Guard<a id="sthref687" href="#sthref687" onclick="footdisplay(1,&#34;While Data Guard physical replication is the most common data protection and availability solution used for Oracle Database, there are cases where active-active logical replication may be preferred, especially when control over the application makes it possible to implement. You may use Oracle GoldenGate in place of Data Guard for these requirements. See the topic, \&#34;Oracle Active Data Guard and Oracle GoldenGate\&#34; for additional discussion of the trade-offs between physical and logical replication at \u003ccode dir=\&#34;ltr\&#34;\u003e\u003ca target=\&#34;outage\&#34; href=\&#34;http://www.oracle.com/technetwork/database/features/availability/dataguardgoldengate-096557.html\&#34;\u003ehttp://www.oracle.com/technetwork/database/features/availability/dataguardgoldengate-096557.html\u003c/a\u003e\u003c/code\u003e&#34;)"><sup class="tablefootnote">Foot&nbsp;1&nbsp;</sup></a></th>
<th class="cellalignment2590" id="r1c5-t3">Platinum: Oracle 12c MAA + Platinum-ready Applications</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t3" headers="r1c1-t3">
<p><a href="glossary.htm#CHDCHHCJ">site failure</a></p>
</td>
<td class="cellalignment2586" headers="r2c1-t3 r1c2-t3">
<p>Hours to days</p>
<ol>
<li>
<p>Restore site.</p>
</li>
<li>
<p>Restore from backups.</p>
</li>
<li>
<p>Recover database.</p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r2c1-t3 r1c3-t3">
<p>Hours to days</p>
<ol>
<li>
<p>Restore site.</p>
</li>
<li>
<p>Restore from backups.</p>
</li>
<li>
<p>Recover database.</p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r2c1-t3 r1c4-t3">
<p>Seconds to minutes<a id="sthref688" href="#sthref688" onclick="footdisplay(2,&#34;Recovery time indicated applies to database and existing connection failover. Network connection changes and other site-specific failover activities may lengthen overall recovery time.&#34;)"><sup class="tablefootnote">Foot&nbsp;2&nbsp;</sup></a></p>
<ol>
<li>
<p><a href="#i1006521">Section 12.2.2, &#34;Database Failover with a Standby Database&#34;</a></p>
</li>
<li>
<p><a href="#BABHCAIA">Section 12.2.1, &#34;Complete Site Failover (Failover to Secondary Site)&#34;</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r2c1-t3 r1c5-t3">
<p>Zero application outage</p>
<ol>
<li>
<p><a href="#i1006521">Section 12.2.2, &#34;Database Failover with a Standby Database&#34;</a></p>
</li>
<li>
<p><a href="#BABHCAIA">Section 12.2.1, &#34;Complete Site Failover (Failover to Secondary Site)&#34;</a></p>
</li>
<li>
<p><a href="#CACCHCDG">Section 12.2.5, &#34;Application Failover with Application Continuity and Transaction Guard&#34;</a></p>
</li>
</ol>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t3" headers="r1c1-t3">
<p><a href="glossary.htm#CHDHIGBH">clusterwide failure</a></p>
</td>
<td class="cellalignment2586" headers="r3c1-t3 r1c2-t3">
<p>Not applicable</p>
</td>
<td class="cellalignment2586" headers="r3c1-t3 r1c3-t3">
<p>Hours to days</p>
<ol>
<li>
<p>Restore cluster or restore at least one node.</p>
</li>
<li>
<p>Optionally restore from backups if the data is lost or corrupted.</p>
</li>
<li>
<p>Recover database.</p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r3c1-t3 r1c4-t3">
<p>Seconds to minutes</p>
<ol>
<li>
<p><a href="#i1006521">Section 12.2.2, &#34;Database Failover with a Standby Database&#34;</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r3c1-t3 r1c5-t3">
<p>Zero application outage</p>
<ol>
<li>
<p><a href="#i1006521">Section 12.2.2, &#34;Database Failover with a Standby Database&#34;</a></p>
</li>
<li>
<p><a href="#CACCHCDG">Section 12.2.5, &#34;Application Failover with Application Continuity and Transaction Guard&#34;</a></p>
</li>
</ol>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t3" headers="r1c1-t3">
<p>recoverable server failure (node)</p>
</td>
<td class="cellalignment2586" headers="r4c1-t3 r1c2-t3">
<p>Minutes to an hour</p>
<ol>
<li>
<p>Restart node and restart database with Oracle Restart. See <a class="olink ADMIN12708" href="../ADMIN/restart.htm#ADMIN12708"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a></p>
</li>
<li>
<p>Reconnect users.</p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r4c1-t3 r1c3-t3">
<p>Seconds<a id="sthref689" href="#sthref689" onclick="footdisplay(3,&#34;Seconds&#34;)"><sup class="footnotenumber">Footref&nbsp;3</sup></a></p>
<ol>
<li>
<p>Manage automatically as described in <a href="#BABIDGFJ">Section 12.2.3, &#34;Oracle RAC Recovery for Unscheduled Outages (for Node or Instance Failures)&#34;</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r4c1-t3 r1c4-t3">
<p>Seconds<a id="sthref690" href="#sthref690" onclick="footdisplay(3,&#34;Seconds&#34;)"><sup class="footnotenumber">Footref&nbsp;3</sup></a></p>
<ol>
<li>
<p>Manage automatically as described in <a href="#BABIDGFJ">Section 12.2.3, &#34;Oracle RAC Recovery for Unscheduled Outages (for Node or Instance Failures)&#34;</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r4c1-t3 r1c5-t3">
<p>Zero application outage</p>
<ol>
<li>
<p>Manage automatically as described in <a href="#BABIDGFJ">Section 12.2.3, &#34;Oracle RAC Recovery for Unscheduled Outages (for Node or Instance Failures)&#34;</a></p>
</li>
<li>
<p><a href="#CACCHCDG">Section 12.2.5, &#34;Application Failover with Application Continuity and Transaction Guard&#34;</a></p>
</li>
</ol>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r5c1-t3" headers="r1c1-t3">
<p>database instance failure</p>
</td>
<td class="cellalignment2586" headers="r5c1-t3 r1c2-t3">
<p>Minutes</p>
<ol>
<li>
<p>Restart instance with Oracle Restart.</p>
</li>
<li>
<p>Reconnect users.</p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r5c1-t3 r1c3-t3">
<p>Seconds<a id="CACJFHCD" href="#CACJFHCD" onclick="footdisplay(3,&#34;Database is still available, but portion of application connected to failed system is temporarily affected resulting in brownout in some cases of seconds to minutes depending if Oracle RAC or Oracle RAC One is utilized.&#34;)"><sup class="tablefootnote">Foot&nbsp;3&nbsp;</sup></a></p>
<ol>
<li>
<p>Manage automatically as described in <a href="#BABIDGFJ">Section 12.2.3, &#34;Oracle RAC Recovery for Unscheduled Outages (for Node or Instance Failures)&#34;</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r5c1-t3 r1c4-t3">
<p>Seconds<a id="sthref691" href="#sthref691" onclick="footdisplay(3,&#34;Database is still available, but portion of application connected to failed system is temporarily affected resulting in brownout in some cases of seconds to minutes depending if Oracle RAC or Oracle RAC One is utilized.&#34;)"><sup class="footnotenumber">Footref&nbsp;3</sup></a></p>
<ol>
<li>
<p>Manage automatically as described in <a href="#BABIDGFJ">Section 12.2.3, &#34;Oracle RAC Recovery for Unscheduled Outages (for Node or Instance Failures)&#34;</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r5c1-t3 r1c5-t3">
<p>Zero application outage</p>
<ol>
<li>
<p>Manage automatically with Oracle RAC</p>
</li>
<li>
<p><a href="#CACCHCDG">Section 12.2.5, &#34;Application Failover with Application Continuity and Transaction Guard&#34;</a></p>
</li>
</ol>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r6c1-t3" headers="r1c1-t3">
<p><a href="glossary.htm#CHDICCFD">storage failure</a></p>
</td>
<td class="cellalignment2586" headers="r6c1-t3 r1c2-t3">
<p>No downtime<a id="CACGFFDA" href="#CACGFFDA" onclick="footdisplay(4,&#34;Storage failures are prevented by using Oracle ASM with mirroring and its automatic rebalance capability.&#34;)"><sup class="tablefootnote">Foot&nbsp;4&nbsp;</sup></a></p>
<p><a href="#BABGGJEG">Section 12.2.6, &#34;Oracle ASM Recovery After Disk and Storage Failures&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r6c1-t3 r1c3-t3">
<p>No downtime<a id="sthref692" href="#sthref692" onclick="footdisplay(4,&#34;Storage failures are prevented by using Oracle ASM with mirroring and its automatic rebalance capability.&#34;)"><sup class="footnotenumber">Footref&nbsp;4</sup></a></p>
<p><a href="#BABGGJEG">Section 12.2.6, &#34;Oracle ASM Recovery After Disk and Storage Failures&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r6c1-t3 r1c4-t3">
<p>No downtime<a id="sthref693" href="#sthref693" onclick="footdisplay(4,&#34;Storage failures are prevented by using Oracle ASM with mirroring and its automatic rebalance capability.&#34;)"><sup class="footnotenumber">Footref&nbsp;4</sup></a></p>
<p><a href="#BABGGJEG">Section 12.2.6, &#34;Oracle ASM Recovery After Disk and Storage Failures&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r6c1-t3 r1c5-t3">
<p>No downtime<a id="sthref694" href="#sthref694" onclick="footdisplay(4,&#34;Storage failures are prevented by using Oracle ASM with mirroring and its automatic rebalance capability.&#34;)"><sup class="footnotenumber">Footref&nbsp;4</sup></a></p>
<p><a href="#BABGGJEG">Section 12.2.6, &#34;Oracle ASM Recovery After Disk and Storage Failures&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r7c1-t3" headers="r1c1-t3">
<p><a href="glossary.htm#CHDEGBIG">data corruption</a></p>
</td>
<td class="cellalignment2586" headers="r7c1-t3 r1c2-t3">
<p>Minutes to hours</p>
<p><a href="#BABECCJH">Section 12.2.7, &#34;Recovering from Data Corruption&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r7c1-t3 r1c3-t3">
<p>Minutes to hours</p>
<p><a href="#BABECCJH">Section 12.2.7, &#34;Recovering from Data Corruption&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r7c1-t3 r1c4-t3">
<p>Possible no downtime with Oracle Active Data Guard: <a href="#BABJGJJH">Section 12.2.7.2, &#34;Use Active Data Guard&#34;</a></p>
<p>Seconds to minutes</p>
<ol>
<li>
<p><a href="#i1006521">Section 12.2.2, &#34;Database Failover with a Standby Database&#34;</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</li>
</ol>
</td>
<td class="cellalignment2586" headers="r7c1-t3 r1c5-t3">
<p>Possible no downtime with Active Data Guard: <a href="#BABJGJJH">Section 12.2.7.2, &#34;Use Active Data Guard&#34;</a></p>
<p>Zero Application outage to or seconds if data loss failover is required.</p>
<ol>
<li>
<p><a href="#i1006521">Section 12.2.2, &#34;Database Failover with a Standby Database&#34;</a></p>
</li>
<li>
<p><a href="#CACCHCDG">Section 12.2.5, &#34;Application Failover with Application Continuity and Transaction Guard&#34;</a></p>
</li>
</ol>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r8c1-t3" headers="r1c1-t3">
<p><a href="glossary.htm#CHDJADJJ">human error</a></p>
</td>
<td class="cellalignment2586" headers="r8c1-t3 r1c2-t3">
<p>&lt; 30 minutes<a id="CACECAEC" href="#CACECAEC" onclick="footdisplay(5,&#34;Recovery times from human errors depend primarily on detection time. If it takes seconds to detect a malicious DML or DLL transaction, then it typically only requires seconds to flash back the appropriate transactions, if properly rehearsed. Referential or integrity constraints must be considered.&#34;)"><sup class="tablefootnote">Foot&nbsp;5&nbsp;</sup></a></p>
<p><a href="#i1010215">Section 12.2.8, &#34;Recovering from Human Error (Recovery with Flashback)&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r8c1-t3 r1c3-t3">
<p>&lt; 30 minutes<a id="sthref695" href="#sthref695" onclick="footdisplay(5,&#34;Recovery times from human errors depend primarily on detection time. If it takes seconds to detect a malicious DML or DLL transaction, then it typically only requires seconds to flash back the appropriate transactions, if properly rehearsed. Referential or integrity constraints must be considered.&#34;)"><sup class="footnotenumber">Footref&nbsp;5</sup></a></p>
<p><a href="#i1010215">Section 12.2.8, &#34;Recovering from Human Error (Recovery with Flashback)&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r8c1-t3 r1c4-t3">
<p>&lt;30 minutes<a id="sthref696" href="#sthref696" onclick="footdisplay(5,&#34;Recovery times from human errors depend primarily on detection time. If it takes seconds to detect a malicious DML or DLL transaction, then it typically only requires seconds to flash back the appropriate transactions, if properly rehearsed. Referential or integrity constraints must be considered.&#34;)"><sup class="footnotenumber">Footref&nbsp;5</sup></a></p>
<p><a href="#i1010215">Section 12.2.8, &#34;Recovering from Human Error (Recovery with Flashback)&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r8c1-t3 r1c5-t3">
<p>&lt; 30 minutes<a id="sthref697" href="#sthref697" onclick="footdisplay(5,&#34;Recovery times from human errors depend primarily on detection time. If it takes seconds to detect a malicious DML or DLL transaction, then it typically only requires seconds to flash back the appropriate transactions, if properly rehearsed. Referential or integrity constraints must be considered.&#34;)"><sup class="footnotenumber">Footref&nbsp;5</sup></a></p>
<p><a href="#i1010215">Section 12.2.8, &#34;Recovering from Human Error (Recovery with Flashback)&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r9c1-t3" headers="r1c1-t3">
<p><a href="glossary.htm#CHDDBJDA">hang or slow down</a></p>
</td>
<td class="cellalignment2586" headers="r9c1-t3 r1c2-t3">
<p>customized and configurable<a id="CACBCEFJ" href="#CACBCEFJ" onclick="footdisplay(6,&#34;Oracle Enterprise Manager or a customized application heartbeat can be configured to detect application or response time slowdown and react to these SLA breaches. For example, you can configure the Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain threshold expires, Enterprise Manager can alert and possibly restart the database.&#34;)"><sup class="tablefootnote">Foot&nbsp;6&nbsp;</sup></a></p>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r9c1-t3 r1c3-t3">
<p>customized and configurable<a id="sthref698" href="#sthref698" onclick="footdisplay(6,&#34;Oracle Enterprise Manager or a customized application heartbeat can be configured to detect application or response time slowdown and react to these SLA breaches. For example, you can configure the Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain threshold expires, Enterprise Manager can alert and possibly restart the database.&#34;)"><sup class="footnotenumber">Footref&nbsp;6</sup></a></p>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r9c1-t3 r1c4-t3">
<p>customized and configurable<a id="CACBACDA" href="#CACBACDA" onclick="footdisplay(7,&#34;Oracle Enterprise Manager or a customized application heartbeat can be configured to detect application or response time slowdown and react to these SLA breaches. For example, you can configure the Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain threshold expires, Enterprise Manager can call the Oracle Data Guard DBMS_DG.INITIATE_FS_FAILOVER PL/SQL procedure to initiate a failover.&#34;)"><sup class="tablefootnote">Foot&nbsp;7&nbsp;</sup></a></p>
<p><a href="#CACFJFEG">Section 12.2.4, &#34;Application Failover&#34;</a></p>
</td>
<td class="cellalignment2586" headers="r9c1-t3 r1c5-t3">
<p>customized and configurable<a id="sthref699" href="#sthref699" onclick="footdisplay(6,&#34;Oracle Enterprise Manager or a customized application heartbeat can be configured to detect application or response time slowdown and react to these SLA breaches. For example, you can configure the Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain threshold expires, Enterprise Manager can alert and possibly restart the database.&#34;)"><sup class="footnotenumber">Footref&nbsp;6</sup></a> and<a id="sthref700" href="#sthref700" onclick="footdisplay(7,&#34;Oracle Enterprise Manager or a customized application heartbeat can be configured to detect application or response time slowdown and react to these SLA breaches. For example, you can configure the Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain threshold expires, Enterprise Manager can call the Oracle Data Guard DBMS_DG.INITIATE_FS_FAILOVER PL/SQL procedure to initiate a failover.&#34;)"><sup class="footnotenumber">Footref&nbsp;7</sup></a></p>
<p><a href="#CACCHCDG">Section 12.2.5, &#34;Application Failover with Application Continuity and Transaction Guard&#34;</a></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;1&nbsp;</sup>While Data Guard physical replication is the most common data protection and availability solution used for Oracle Database, there are cases where active-active logical replication may be preferred, especially when control over the application makes it possible to implement. You may use Oracle GoldenGate in place of Data Guard for these requirements. See the topic, &#34;Oracle Active Data Guard and Oracle GoldenGate&#34; for additional discussion of the trade-offs between physical and logical replication at <code dir="ltr"><a href="http://www.oracle.com/technetwork/database/features/availability/dataguardgoldengate-096557.html">http://www.oracle.com/technetwork/database/features/availability/dataguardgoldengate-096557.html</a></code></p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;2&nbsp;</sup>Recovery time indicated applies to database and existing connection failover. Network connection changes and other site-specific failover activities may lengthen overall recovery time.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;3&nbsp;</sup>Database is still available, but portion of application connected to failed system is temporarily affected resulting in brownout in some cases of seconds to minutes depending if Oracle RAC or Oracle RAC One is utilized.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;4&nbsp;</sup>Storage failures are prevented by using Oracle ASM with mirroring and its automatic rebalance capability.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;5&nbsp;</sup>Recovery times from human errors depend primarily on detection time. If it takes seconds to detect a malicious DML or DLL transaction, then it typically only requires seconds to flash back the appropriate transactions, if properly rehearsed. Referential or integrity constraints must be considered.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;6&nbsp;</sup>Oracle Enterprise Manager or a customized application heartbeat can be configured to detect application or response time slowdown and react to these SLA breaches. For example, you can configure the Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain threshold expires, Enterprise Manager can alert and possibly restart the database.</p>
<p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;7&nbsp;</sup>Oracle Enterprise Manager or a customized application heartbeat can be configured to detect application or response time slowdown and react to these SLA breaches. For example, you can configure the Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain threshold expires, Enterprise Manager can call the Oracle Data Guard DBMS_DG.INITIATE_FS_FAILOVER PL/SQL procedure to initiate a failover.</p>
<div class="infoboxnotealso">
<p class="notep1">See:</p>
<ul>
<li>
<p><a class="olink DGBKR3399" href="../DGBKR/dbresource.htm#DGBKR3399"><span class="italic">Oracle Data Guard Broker</span></a> for more information about &#34;Application Initiated Fast-Start Failover&#34;</p>
</li>
<li>
<p>The topic, &#34;Oracle Active Data Guard and Oracle GoldenGate&#34; for additional discussion of the trade-offs between physical and logical replication at</p>
<p><code dir="ltr"><a href="http://www.oracle.com/technetwork/database/features/availability/dataguardgoldengate-096557.html">http://www.oracle.com/technetwork/database/features/availability/dataguardgoldengate-096557.html</a></code></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i1011878"></a>
<div id="HABPT5002" class="sect2">
<h3 class="sect2"><span class="secnum">12.1.2</span> Managing Unscheduled Outages on the Standby Site Best Practices</h3>
<p>Outages on the standby site do not impact the availability of the primary database when using Data Guard Maximum Availability (synchronous communication with net_timeout) or Maximum Performance (asynchronous communication).</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Outages to a system that uses the Active Data Guard option with the standby database can affect applications that are using the standby database for read activity, but such outages do not impact the availability of the primary database (the availability is based on the mode you specify).</div>
<p>Data Guard Maximum Protection, however, has an impact on availability if the primary database does not receive acknowledgment from a standby database running in SYNC transport mode (net_timeout does not apply to Maximum Protection). For this reason, if you are using Maximum Protection you should follow the MAA best practice of deploying two SYNC standby databases and multiple far sync instances if required. With two standby databases a single standby outage does not impact primary availability or zero data loss protection.</p>
<p>If limited system resources make it impractical to deploy two standby databases, then the availability of the primary database can be restored simply by downgrading the data protection mode to Maximum Availability and restarting the primary database.</p>
<p><a href="#g1016089">Table 12-2</a> summarizes the recovery steps for unscheduled outages of the standby database on the secondary site. For outages that require multiple recovery steps, the table includes links to the detailed descriptions in <a href="#CACBFBHF">Section 12.2, &#34;Recovering from Unscheduled Outages&#34;</a>.<a id="sthref701"></a></p>
<div id="HABPT5003" class="tblruleformalwide">
<p class="titleintable"><a id="sthref702"></a><a id="g1016089"></a>Table 12-2 Recovery Steps for Unscheduled Outages on the Secondary Site or Far Sync Instance Site</p>
<table class="cellalignment2589" title="Recovery Steps for Unscheduled Outages on the Secondary Site or Far Sync Instance Site " summary="Giving several reasons for outages, this table summarizes the recovery steps that can be taken for either Data Guard Only or MAA architecture." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t6">Outage Type</th>
<th class="cellalignment2590" id="r1c2-t6">Recovery Steps for Single-Instance or Oracle RAC Standby Database</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t6" headers="r1c1-t6">
<p>Computer failure (instance or node)</p>
</td>
<td class="cellalignment2586" headers="r2c1-t6 r1c2-t6">
<ol>
<li>
<p>Restart node and standby instance when they are available.</p>
</li>
<li>
<p>Restart recovery.</p>
</li>
</ol>
<p>The broker automatically restarts the log apply services.</p>
<p><span class="bold">Note 1:</span> If there is only one standby database and if Maximum Protection is configured, then the primary database shuts down to ensure that there is no data divergence with the standby database (no unprotected data).</p>
<p><span class="bold">Note 2:</span> If this is an Oracle RAC standby database, then there is no affect on primary database availability if you configured the primary database Oracle Net descriptor to use connect-time failover to an available standby instance. If you are using the broker, connect-time failover is configured automatically.</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t6" headers="r1c1-t6">
<p>Data corruption</p>
</td>
<td class="cellalignment2586" headers="r3c1-t6 r1c2-t6">
<p><a href="#CDECFHID">Section 12.3.5, &#34;Restoring Fault Tolerance After a Standby Database Data Failure&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t6" headers="r1c1-t6">
<p>Primary database opens with <code dir="ltr">RESETLOGS</code> because of Flashback Database operations or point-in-time media recovery</p>
</td>
<td class="cellalignment2586" headers="r4c1-t6 r1c2-t6">
<p><a href="#BABCFGHE">Section 12.3.6, &#34;Restoring Fault Tolerance After the Primary Database Was Opened Resetlogs&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r5c1-t6" headers="r1c1-t6">
<p>Far Sync instance or node failure</p>
</td>
<td class="cellalignment2586" headers="r5c1-t6 r1c2-t6">
<ol>
<li>
<p>If configured as Oracle RAC Far Sync, then fail over to available instance or node.</p>
</li>
<li>
<p>If Oracle RAC instance is not available and <code dir="ltr">ALTERNATE</code> destination is available, then fail over to alternate destination. As the last resort, you can configure <code dir="ltr">ALTERNATE</code> as the terminal standby database.</p>
</li>
</ol>
<p>If Far Sync configuration best practices have been followed, each of these steps will be performed automatically by the database and no manual intervention is necessary.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="config_dg.htm#CEGGAIGI">Section 8.1, &#34;Oracle Data Guard Configuration Best Practices&#34;</a></p>
</li>
<li>
<p><a class="olink SBYDB02000" href="../SBYDB/protection.htm#SBYDB02000"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about &#34;Data Guard Protection Modes&#34;</p>
</li>
<li>
<p><a class="olink SBYDB00101" href="../SBYDB/standby.htm#SBYDB00101"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information about Oracle Active Data Guard option and when Redo Apply can be active while the physical standby database is open</p>
</li>
<li>
<p><a class="olink DGBKR275" href="../DGBKR/dbresource.htm#DGBKR275"><span class="italic">Oracle Data Guard Broker</span></a> for information about &#34;How the Protection Modes Influence Broker Operations&#34;</p>
</li>
<li>
<p>MAA white paper &#34;Oracle Active Data Guard Far Sync Zero Data Loss at Any Distance&#34; at <a href="http://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf"><code dir="ltr">http://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf</code></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CACBFBHF"></a>
<div id="HABPT00405" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">12.2</span> Recovering from Unscheduled Outages<a id="ABC3588576"></a></h2>
<p>This section describes best practices for recovering from various types of unscheduled outages.</p>
<ul>
<li>
<p><a href="#BABHCAIA">Complete Site Failover (Failover to Secondary Site)</a></p>
</li>
<li>
<p><a href="#i1006521">Database Failover with a Standby Database</a></p>
</li>
<li>
<p><a href="#BABIDGFJ">Oracle RAC Recovery for Unscheduled Outages (for Node or Instance Failures)</a></p>
</li>
<li>
<p><a href="#CACFJFEG">Application Failover</a></p>
</li>
<li>
<p><a href="#CACCHCDG">Application Failover with Application Continuity and Transaction Guard</a></p>
</li>
<li>
<p><a href="#BABGGJEG">Oracle ASM Recovery After Disk and Storage Failures</a></p>
</li>
<li>
<p><a href="#BABECCJH">Recovering from Data Corruption</a></p>
</li>
<li>
<p><a href="#i1010215">Recovering from Human Error (Recovery with Flashback)</a></p>
</li>
<li>
<p><a href="#CDEDIGHC">Recovering Databases in a Distributed Environment</a></p>
</li>
</ul>
<a id="BABHCAIA"></a>
<div id="HABPT5004" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.2.1</span> Complete Site Failover<a id="sthref703"></a> (Failover to Secondary Site)</h3>
<p>With complete site failover, the database, the middle-tier application server, and all user connections fail over to a secondary site that is prepared to handle the production load.</p>
<div id="HABPT5005" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref704"></a>
<h4 class="sect3"><span class="secnum">12.2.1.1</span> When to Use Complete Site Failover</h4>
<p>If the standby site meets the prerequisites, then complete site failover is recommended for the following scenarios:</p>
<ul>
<li>
<p>Primary site disaster, such as natural disasters or malicious attacks</p>
</li>
<li>
<p>Primary network-connectivity failures</p>
</li>
<li>
<p>Primary site power failures</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="BABIEICC"></a>
<div id="HABPT5006" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.1.2</span> Best Practices for Complete Site Failover</h4>
<p>To expedite site failover in minutes:</p>
<ul>
<li>
<p>Use the Data Guard configuration best practices in <a href="config_dg.htm#CEGBIAJI">Section 8.3, &#34;General Data Guard Configuration Best Practices&#34;</a></p>
</li>
<li>
<p>Use Data Guard fast-start failover to automatically fail over to the standby database, with a recovery time objective (RTO<a id="sthref705"></a><a id="sthref706"></a>) of less than 30 seconds (described in <a href="config_dg.htm#CEGFEGAB">Section 8.5.2.3, &#34;Fast-Start Failover Best Practices&#34;</a>)</p>
</li>
<li>
<p>Maintain a running middle-tier application server on the secondary site to avoid the startup time, or redirect existing applications to the new primary database using the Fast Connection Failover best practices described in:</p>
<ul>
<li>
<p><a href="config_fcf.htm#BDCFJEHD">Chapter 10, &#34;Client Failover Best Practices for Highly Available Oracle Databases&#34;</a></p>
</li>
<li>
<p>The MAA white paper: &#34;Client Failover Best Practices for Highly Available Oracle Databases - Oracle Database 12c&#34; from the MAA Best Practices area for Oracle Database at</p>
<p><code dir="ltr"><a href="http://www.oracle.com/goto/maa/">http://www.oracle.com/goto/maa</a></code></p>
</li>
</ul>
</li>
<li>
<p>Configure Automatic Domain Name Server (DNS) failover procedure. Automatic DNS failover occurs after a primary site is inaccessible and the wide-area traffic manager at the secondary site returns the virtual IP address of a load balancer at the secondary site and clients are directed automatically on the subsequent reconnect.</p>
</li>
</ul>
<p>The potential for data loss is dependent on the Data Guard protection mode used: Maximum Protection, Maximum Availability, or Maximum Performance. For the Gold and Platinum reference architectures, zero data loss can be achieved over WAN by using Oracle 12<span class="italic">c</span> Far Sync instance. <a href="#CACGIHIH">Figure 12-1</a> is an example configuration with Far Sync.</p>
<div id="HABPT5393" class="figure">
<p class="titleinfigure"><a id="CACGIHIH"></a>Figure 12-1 Example Configuration With Far Sync</p>
<img width="843" height="223" src="img/far_synch.gif" alt="Description of Figure 12-1 follows"/><br/>
<a id="sthref707" href="img_text/far_synch.htm">Description of &#34;Figure 12-1 Example Configuration With Far Sync&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Application continuity can enable zero application outage; however, that is only possible if the application tiers are shared across sites.</p>
</div>
<!-- class="sect3" -->
<a id="BABHDCAJ"></a>
<div id="HABPT5007" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.1.3</span> Complete Site Failover</h4>
<p>A wide-area traffic manager on the primary and secondary sites provides the site failover function. The wide-area traffic manager can redirect traffic automatically if the primary site, or a specific application on the primary site, is not accessible. It can also be triggered manually to switch to the secondary site for switchovers. Traffic is directed to the secondary site only when the primary site cannot provide service due to an outage or after a switchover. If the primary site fails, then user traffic is directed to the secondary site automatically.</p>
<p><a href="#BABIGJDD">Figure 12-2</a> illustrates the possible <a id="sthref708"></a><a id="sthref709"></a>network routes before site failover:</p>
<ol>
<li>
<p>Client requests enter the client tier of the primary site and travel by the WAN traffic manager.</p>
</li>
<li>
<p>Client requests are sent through the firewall into the demilitarized zone (DMZ) to the application server tier.</p>
</li>
<li>
<p>Requests are forwarded through the active load balancer to the application servers.</p>
</li>
<li>
<p>Requests are sent through another firewall and into the database server tier.</p>
</li>
<li>
<p>The application requests, if required, are routed to an Oracle RAC instance.</p>
</li>
<li>
<p>Responses are sent back to the application and clients by a similar path.</p>
</li>
</ol>
<div id="HABPT5008" class="figure">
<p class="titleinfigure"><a id="BABIGJDD"></a>Figure 12-2 Network Routes Before Site Failover</p>
<img width="663" height="636" src="img/habpt005.gif" alt="Description of Figure 12-2 follows"/><br/>
<a id="sthref710" href="img_text/habpt005.htm">Description of &#34;Figure 12-2 Network Routes Before Site Failover&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#BABGAEFD">Figure 12-3</a> illustrates the <a id="sthref711"></a><a id="sthref712"></a>network routes after site failover. Client or application requests enter the secondary site at the client tier and follow the same path on the secondary site that they followed on the primary site.</p>
<div id="HABPT5009" class="figure">
<p class="titleinfigure"><a id="BABGAEFD"></a>Figure 12-3 Network Routes After Site Failover</p>
<img width="663" height="636" src="img/habpt014.gif" alt="Description of Figure 12-3 follows"/><br/>
<a id="sthref713" href="img_text/habpt014.htm">Description of &#34;Figure 12-3 Network Routes After Site Failover&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>The following steps describe the effect of a failover or switchover on network traffic:</p>
<ol>
<li>
<p>The administrator has failed over or switched over the primary database to the secondary site. This is automatic if you are using Data Guard fast-start failover.</p>
</li>
<li>
<p>The administrator starts the middle-tier application servers on the secondary site, if they are not running. In some cases the same middle-tier application servers can be leveraged if they do not reside in the failed site.</p>
</li>
<li>
<p>The wide-area traffic manager selection of the secondary site can be automatic for an entire site failure. The wide-area traffic manager at the secondary site returns the virtual IP address of a load balancer at the secondary site and clients are directed automatically on the subsequent reconnect. In this scenario, the site failover is accomplished by an automatic domain name system (DNS) failover.</p>
<p>Alternatively, a DNS administrator can manually change the wide-area traffic manager selection to the secondary site for the entire site or for specific applications. The following is an example of a manual <a id="sthref714"></a>DNS failover:</p>
<ol>
<li>
<p>Change the DNS to point to the secondary site load balancer:</p>
<p>The master (primary) DNS server is updated with the zone information, and the change is announced with the DNS <code dir="ltr">NOTIFY</code> announcement.</p>
<p>The slave DNS servers are notified of the zone update with a DNS <code dir="ltr">NOTIFY</code> announcement, and the slave DNS servers pull the zone information.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The master and slave servers are authoritative name servers. Therefore, they contain trusted DNS information.</div>
</li>
<li>
<p>Clear affected records from caching DNS servers.</p>
<p>A caching DNS server is used primarily for performance and fast response. The caching server obtains information from an authoritative DNS server in response to a host query and then saves (caches) the data locally. On a second or subsequent request for the same data, the caching DNS server responds with its locally stored data (the cache) until the time-to-live (TTL) value of the response expires. At this time, the server refreshes the data from the zone master. If the DNS record is changed on the primary DNS server, then the caching DNS server does not pick up the change for cached records until TTL expires. Flushing the cache forces the caching DNS server to go to an authoritative DNS server again for the updated DNS information.</p>
<p>Flush the cache if the DNS server being used supports such a capability. The following is the flush capability of common DNS BIND versions:</p>
<p><span class="bold">BIND 9.3.0:</span> The command <code dir="ltr">rndc</code> <code dir="ltr">flushname</code> <code dir="ltr"><span class="codeinlineitalic">name</span></code> flushes individual entries from the cache.</p>
<p><span class="bold">BIND 9.2.0 and 9.2.1:</span> The entire cache can be flushed with the command <code dir="ltr">rndc</code> <code dir="ltr">flush</code>.</p>
<p><span class="bold">BIND 8 and BIND 9 up to 9.1.3:</span> Restarting the named server clears the cache.</p>
</li>
<li>
<p>Refresh local DNS service caching.</p>
<p>Some operating systems might cache DNS information locally in the local name service cache. If so, this cache must also be cleared so that DNS updates are recognized quickly.</p>
<p><span class="bold">Solaris:</span> <code dir="ltr">nscd</code></p>
<p><span class="bold">Linux:</span> <code dir="ltr">/etc/init.d/nscd restart</code></p>
<p><span class="bold">Microsoft Windows:</span> <code dir="ltr">ipconfig /flushdns</code></p>
</li>
<li>
<p>The secondary site load balancer directs traffic to the secondary site middle-tier application server.</p>
</li>
<li>
<p>The secondary site is ready to take client requests.</p>
</li>
</ol>
</li>
</ol>
<p>Failover also depends on the client&#39;s web browser. Most browser applications cache the DNS entry for a period. Consequently, sessions in progress during an outage might not fail over until the cache timeout expires. To resume service to such clients, close the browser and restart it.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1006521"></a>
<div id="HABPT5010" class="sect2">
<h3 class="sect2"><span class="secnum">12.2.2</span> Database Failover with a Standby Database<a id="sthref715"></a></h3>
<p><span class="italic">Failover</span> is the operation of transitioning one standby database to the role of primary database. A failover operation is invoked when an unplanned failure occurs on the primary database and there is no possibility of recovering the primary database in a timely fashion.</p>
<p>With Oracle Data Guard, you can automate the failover process using the broker and fast-start failover, or you can perform the failover manually:</p>
<ul>
<li>
<p><span class="bold">Fast-start failover</span> eliminates the uncertainty of a process that requires manual intervention and automatically executes a zero loss or minimum-loss failover (that you configure using the <code dir="ltr">FastStartFailoverLagLimit</code> property) within seconds of an outage being detected. See <a href="config_dg.htm#CEGFEGAB">Section 8.5.2.3, &#34;Fast-Start Failover Best Practices&#34;</a> for configuration best practices.</p>
</li>
<li>
<p><span class="bold">Manual failover</span> allows for a failover process where decisions are user driven using any of the following methods:</p>
<ul>
<li>
<p>Oracle Enterprise Manager</p>
</li>
<li>
<p>The broker command-line interface (DGMGRL)</p>
</li>
<li>
<p>SQL*Plus statements</p>
<p>See <a href="#CDEGFJIB">Section 12.2.2.3, &#34;Best Practices for Performing Manual Failover&#34;</a>.</p>
</li>
</ul>
</li>
</ul>
<p>A database failover is accompanied by an application failover and, in some cases, preceded by a site failover. For Platinum-ready applications and for zero data loss failover, applications can achieve zero application outage with Application Failover with Application Continuity and Transaction Guard. After the Data Guard failover, the secondary site hosts the primary database. You must reinstate the original primary database as a new standby database to restore fault tolerance of the configuration. See <a href="#BABHHEEE">Section 12.3.2, &#34;Restoring a Standby Database After a Failover.&#34;</a></p>
<p>A failover operation typically occurs in seconds to minutes, and with little or no data loss. With Oracle 12<span class="italic">c</span> Far Sync capability, zero data loss protection to a standby database is possible regardless of the physical distance between primary and standby databases.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SBYDB" href="../SBYDB/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a>.for a complete description of failover processing</p>
</li>
<li>
<p>The &#34;Data Guard Fast-Start Failover&#34; and &#34;Data Guard Switchover and Failover&#34; MAA best practice white papers available from the MAA Best Practices area for Oracle Database at</p>
<p><code dir="ltr"><a href="http://www.oracle.com/goto/maa/">http://www.oracle.com/goto/maa</a></code></p>
</li>
</ul>
</div>
<a id="i1006859"></a>
<div id="HABPT5011" class="sect3">
<h4 class="sect3"><span class="secnum">12.2.2.1</span> When To Perform a Data Guard Failover<a id="sthref716"></a></h4>
<p>When a primary database failure cannot be repaired in time to meet your Recovery Time Objective (RTO) using local backups or Flashback technology, you should perform a failover using Oracle Data Guard.</p>
<p>You should perform a failover m<a id="sthref717"></a><a id="sthref718"></a>anually due to an unplanned outage such as:</p>
<ul>
<li>
<p>A site disaster, which results in the primary database becoming unavailable</p>
</li>
<li>
<p>Damage resulting from user errors that cannot be repaired in a timely fashion</p>
</li>
<li>
<p>Data corruptions that are not automatically resolved by Oracle Active Data Guard, data or media damage, database or cluster failures</p>
</li>
</ul>
<p>A failover requires that you reinstate the initial primary database as a standby database to restore fault tolerance to your environment. You can quickly reinstate the standby database using Flashback Database provided the original primary database has not been damaged. See <a href="#BABHHEEE">Section 12.3.2, &#34;Restoring a Standby Database After a Failover.&#34;</a></p>
</div>
<!-- class="sect3" -->
<a id="BABHFFBG"></a>
<div id="HABPT5012" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.2.2</span> Best Practices for Implementing Fast-Start Failover<a id="sthref719"></a></h4>
<p>A fast-start failover is completely automated and requires no user intervention.</p>
<p><a id="sthref720"></a>There are no procedural best practices to consider when performing a fast-start failover. However, it is important to address all of the configuration best practices described in <a href="config_dg.htm#CEGFEGAB">Section 8.5.2.3, &#34;Fast-Start Failover Best Practices&#34;</a>.</p>
<div class="infoboxnotealso">
<p class="notep1">See also:</p>
<ul>
<li>
<p><a href="config_dg.htm#CEGFEGAB">Section 8.5.2.3, &#34;Fast-Start Failover Best Practices&#34;</a></p>
</li>
<li>
<p>MAA white paper &#34;Oracle Active Data Guard Far Sync Zero Data Loss at Any Distance&#34; at <a href="http://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf"><code dir="ltr">http://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf</code></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="CDEGFJIB"></a>
<div id="HABPT5013" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.2.3</span> Best Practices for Performing Manual <a id="sthref721"></a>Failover</h4>
<p>When performing a manual failover:</p>
<ul>
<li>
<p>Follow the configuration best practices outlined in <a href="config_dg.htm#CEGGDAFD">Section 8.5.2.4, &#34;Manual Failover Best Practices.&#34;</a></p>
</li>
<li>
<p>Choose from the following methods:</p>
<ul>
<li>
<p><span class="bold">Oracle Enterprise Manager</span></p>
<p>See <a class="olink DGBKR575" href="../DGBKR/cli.htm#DGBKR575"><span class="italic">Oracle Data Guard Broker</span></a> for complete information about how to perform a manual failover using Oracle Enterprise Manager. The procedure is the same for both physical and logical standby databases.</p>
</li>
<li>
<p><span class="bold">Oracle Data Guard broker command-line interface (DGMGRL)</span></p>
<p>See <a class="olink DGBKR575" href="../DGBKR/cli.htm#DGBKR575"><span class="italic">Oracle Data Guard Broker</span></a> for complete information about how to perform a manual failover using Oracle Enterprise Manager. The procedure is the same for both physical and logical standby databases.</p>
</li>
<li>
<p><span class="bold">SQL*Plus statements:</span></p>
<ul>
<li>
<p><a class="olink SBYDB00625" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=SBYDB00625"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about Physical standby databas<a id="sthref722"></a><a id="sthref723"></a><a id="sthref724"></a>e steps for &#34;Performing a Failover to a Physical Standby Database&#34;</p>
</li>
<li>
<p><a class="olink SBYDB00635" href="../SBYDB/role_management.htm#SBYDB00635"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about Logical standby database steps<a id="sthref725"></a> for &#34;Performing a Failover to a Logical Standby Database&#34;</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABIDGFJ"></a>
<div id="HABPT5014" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.2.3</span> Oracle RAC Recovery for <a id="sthref726"></a><a id="sthref727"></a>Unscheduled Outages (for Node or Instance Failures)</h3>
<p>Oracle RAC Recovery is performed automatically when there is a node or instance failure. In regular multi instance Oracle RAC environments, surviving instances automatically recover the failed instances and potentially aid in the automatic client failover. Recover times can be bounded by adopting the database and Oracle RAC configuration best practices and can usually lead to instance recovery times of seconds to minutes in very large busy systems, with no data loss. For Oracle RAC One Node configurations recover times are expected to take longer than full Oracle RAC; with Oracle RAC One Node a replacement instance must be started first before it can do the instance recovery.</p>
<p>For instance or node failures with Oracle RAC and Oracle RAC One Node, use the following recovery methods:</p>
<ul>
<li>
<p><a href="#CDEHGCGH">Automatic Instance Recovery for Failed Instances</a></p>
</li>
<li>
<p><a href="#CDEHGJIJ">Automatic Service Relocation</a></p>
</li>
<li>
<p><a href="#CDEGDBHH">Oracle Cluster Registry Recovery</a></p>
</li>
</ul>
<a id="CDEHGCGH"></a>
<div id="HABPT5015" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.3.1</span> Automatic Instance Recovery for Failed Instances</h4>
<p>Instance failure occurs when software or hardware problems cause an instance to shutdown or abort. After instance failure, Oracle automatically uses the online redo log file to perform database recovery.</p>
<p>Instance recovery in Oracle RAC does not include restarting the failed instance or the recovery of applications that were running on the failed instance. Applications will run continuously using service relocation and fast application notification (as described in <a href="#CDEHGJIJ">Section 12.2.3.2, &#34;Automatic Service Relocation&#34;</a>).</p>
<p>When <a id="sthref728"></a>one instance performs recovery for another instance, the recovering instance (and active foreground processes in the case of transaction recovery):</p>
<ul>
<li>
<p>Reads redo log entries generated by the failed instance and uses that information to ensure that committed transactions are recorded in the database. Thus, data from committed transactions is not lost</p>
</li>
<li>
<p>Rolls back uncommitted transactions that were active at the time of the failure and releases resources used by those transactions</p>
</li>
</ul>
<p>When multiple <a id="sthref729"></a>instances fail, if one instance survives Oracle RAC performs instance recovery for any other instances that fail. If all instances of an Oracle RAC database fail, then on subsequent restart of any instance a crash recovery occurs and all committed transactions are recovered. Data Guard is the recommended solution to survive outages when all instances of a cluster fail.</p>
</div>
<!-- class="sect3" -->
<a id="CDEHGJIJ"></a>
<div id="HABPT5016" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.3.2</span> Automatic Service Relocation<a id="sthref730"></a><a id="sthref731"></a><a id="sthref732"></a></h4>
<p>Service reliability is achieved by configuring and failing over among the surviving instances. A service will be made available by multiple database instances to provide a service that is needed. If a hardware failure occurs and the failure adversely affects an Oracle RAC database instance, then depending on the configuration, Oracle Clusterware does one the following:</p>
<ul>
<li>
<p>Oracle Clusterware automatically moves any services on the failed database instance to another available instance, as configured with DBCA or Enterprise Manager. Oracle Clusterware recognizes when a failure affects a service and automatically fails over the service across the surviving instances supporting the service.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
With Oracle RAC One Node the relocation occurs when another instance on a different node is started and enabled for the appropriate services. Thus, Oracle RAC One Node starts a new instance when an instance fails but the new instance is not a &#34;surviving instance.&#34;</div>
</li>
<li>
<p>A service can be made available on multiple instances by default. In this case, when one of those multiple instances is lost the clients continue to use the available services across the surviving instances, but there are less resources to do the work.</p>
</li>
</ul>
<p>In parallel, Oracle Clusterware attempts to restart and integrate the failed instances and dependent resources back into the system and Cluster Ready Services (CRS) will try to restart the database instance three times. Clients can &#34;subscribe&#34; to node failure events, in this way clients can be notified of instance problems quickly and new connections can be setup (Oracle Clusterware does not setup the new connections, the clients setup the new connections). Notification of failures using fast application notification (FAN) events occur at various levels within the Oracle Server architecture. When following Oracle client failover best practices (point to chapter 10) in conjunction with Application Continuity applications will in most cases be able to seamless handle outages without seeing any errors.</p>
</div>
<!-- class="sect3" -->
<a id="CDEGDBHH"></a>
<div id="HABPT5017" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.3.3</span> Oracle Cluster Registry<a id="sthref733"></a><a id="sthref734"></a><a id="sthref735"></a> Recovery</h4>
<p>Loss of the <a id="sthref736"></a>Oracle Cluster Registry (OCR) file affects the availability of Oracle RAC and Oracle Clusterware. The OCR file can be restored from a backup that is automatically created or from an export file that is manually created by using the <code dir="ltr">ocrconfig</code> tool (also use <code dir="ltr">ocrconfig</code> to restore the backup). Additionally, Oracle can optionally mirror the OCR so that a single OCR device failure can be tolerated. Ensure the OCR mirror is on a physically separate device and preferably on a separate controller. For more information, see <a href="config_cw.htm#CEGJFFDG">Section 5.2.7, &#34;Mirror Oracle Cluster Registry (OCR) and Configure Multiple Voting Disks with Oracle ASM&#34;</a>.</p>
<p><a id="sthref737"></a><a id="sthref738"></a>If all of the voting disks are corrupted, then you must restore them. To do this you use the <code dir="ltr">crsctl</code> command. The steps you use depend on where you store your voting files. If the voting disks are stored in Oracle ASM, then run the commands to migrate the voting disks to the Oracle ASM disk group you specify, with: <code dir="ltr">crsctl replace votedisk</code>. If you did not store voting disks in Oracle ASM, then you run the commands to delete and add the voting disks: <code dir="ltr">crsctl delete css votedisk</code> and <code dir="ltr">crsctl add css votedisk</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="config_cw.htm#CEGDFEGD">Section 5.3.2, &#34;Regularly Back Up OCR to Tape or Offsite&#34;</a></p>
</li>
<li>
<p><a class="olink RACAD703" href="../RACAD/GUID-94CBE29D-A3DF-43FE-B15F-C3B9A1AD1A63.htm#RACAD703"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for information about Administering Storage in Real Application Clusters</p>
</li>
<li>
<p><a class="olink CWADD92002" href="../CWADD/GUID-648BB199-AFB9-416A-8438-E0331C255E78.htm#CWADD92002"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for information about Restoring Oracle Cluster Registry</p>
</li>
<li>
<p><a class="olink CWADD90961" href="../CWADD/GUID-D977F7F1-94FB-425C-A284-F45C102CE6C1.htm#CWADD90961"><span class="italic">Oracle Clusterware Administration and Deployment Guide</span></a> for information about Restoring Voting Disks</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CACFJFEG"></a>
<div id="HABPT5018" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.2.4</span> Application Failover<a id="sthref739"></a><a id="sthref740"></a><a id="sthref741"></a><a id="sthref742"></a><a id="sthref743"></a></h3>
<p>With a minimal configuration, applications can receive fast and efficient <a id="sthref744"></a>notification when instances providing services become unavailable. When notified, application reconnects occur transparently to the surviving instances of an Oracle RAC database or to a standby database that has assumed the primary role following a failover.</p>
<p>In an <a id="sthref745"></a>Oracle RAC configuration, services are essential to achieving fast and transparent application failover. Clients are notified of a service relocation through Fast Application Notification (FAN)<a id="sthref746"></a>.</p>
<p>In an <a id="sthref747"></a>Oracle Data Guard configuration, you can configure services for client failover across sites. After a site failure in a Data Guard configuration, the new primary database can automatically publish the production service while notifying affected clients, through FAN events, that the services are no longer available on the failed primary database.</p>
<p>For hangs or situations in which the response time is unacceptable, you can configure Oracle Enterprise Manager or a custom application heartbeat to detect application or response time slowdown and react to these situations. For example, you can configure the <a id="sthref748"></a><a id="sthref749"></a><a id="sthref750"></a><a id="sthref751"></a>Enterprise Manager Beacon to monitor and detect application response times. Then, after a certain time threshold expires, Enterprise Manager can call the Oracle Data Guard <a id="sthref752"></a><a id="sthref753"></a><code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> PL/SQL procedure to initiate a database failover immediately followed by an application failover using FAN notifications and service relocation.</p>
<p><a id="sthref754"></a><a id="sthref755"></a>FAN notifications and service relocation enable automatic and fast redirection of clients if any failure or planned maintenance results in an Oracle RAC or Oracle Data Guard fail over.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="config_fcf.htm#BDCFJEHD">Chapter 10, &#34;Client Failover Best Practices for Highly Available Oracle Databases&#34;</a></p>
</li>
<li>
<p>The MAA white paper &#34;Client Failover for Highly Available Oracle Databases&#34; from the MAA Best Practices area for Oracle Database at</p>
<p><code dir="ltr"><a href="http://www.oracle.com/goto/maa/">http://www.oracle.com/goto/maa</a></code></p>
</li>
<li>
<p><a class="olink DGBKR3399" href="../DGBKR/dbresource.htm#DGBKR3399"><span class="italic">Oracle Data Guard Broker</span></a> for more information about Application Initiated Fast-Start Failover and the <code dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER</code> PL/SQL procedure</p>
</li>
<li>
<p><a class="olink RACAD076" href="../RACAD/GUID-8DC4D5E0-CA9D-47BC-BAD0-8769405AFEC5.htm#RACAD076"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> &#34;Workload Management with Dynamic Database Services&#34;</p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="CACCHCDG"></a>
<div id="HABPT5394" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.2.5</span> Application Failover with Application Continuity and Transaction Guard</h3>
<p>Platinum-ready applications can achieve zero application outage during unplanned outages and planned maintenance activities whenever the following prerequisites are met.</p>
<ul>
<li>
<p>Application has been configured with application continuity and transaction guard AND</p>
</li>
<li>
<p>Zero data loss Oracle RAC failover has occurred OR</p>
</li>
<li>
<p>Zero data loss Data Guard failover has occurred</p>
</li>
</ul>
<p>Following planned and unplanned outages, Application Continuity attempts to mask the outage by rebuilding the database session, and resubmitting the pending work following recoverable errors that make the database session unavailable. Application Continuity does not resubmit work following call failures due to non-recoverable errors. Submission of invalid data values is an example of a non-recoverable error that would not be available for replay.</p>
<p>When Application Continuity is configured, an end-user request is executed at-most once; replay is started if the time has not exceeded the replay timeout attribute specified for the service. When replaying, Application Continuity appears to the user as a slightly delayed execution. When replay succeeds, this feature masks applications from transient outages (such as session failure, instance or node outages, network failures, and so on) and from planned outages such as repairs, configuration changes, and patch application.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="config_fcf.htm#CACJAAJA">Section 10.1.2, &#34;Configuring Application Continuity&#34;</a></div>
</div>
<!-- class="sect2" -->
<a id="BABGGJEG"></a>
<div id="HABPT5019" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.2.6</span> Oracle ASM Recovery After Disk and Storage Failures<a id="sthref756"></a></h3>
<p><a href="#CACJHFHA">Table 12-3</a> summarizes the impacts and recommended repairs for various Oracle ASM failure types.</p>
<div id="HABPT5344" class="tblruleformalwide">
<p class="titleintable"><a id="sthref757"></a><a id="CACJHFHA"></a>Table 12-3 Types of Oracle ASM Failures and Recommended Repair</p>
<table class="cellalignment2589" title="Types of Oracle ASM Failures and Recommended Repair" summary="ASM failure types. The first column names the failure type, the second column is a description, then an impact, and the fourth column is the recommended repair." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t15">Failure</th>
<th class="cellalignment2590" id="r1c2-t15">Description</th>
<th class="cellalignment2590" id="r1c3-t15">Impact</th>
<th class="cellalignment2590" id="r1c4-t15">Recommended Repair</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t15" headers="r1c1-t15">
<p>Oracle ASM instance failure</p>
</td>
<td class="cellalignment2586" headers="r2c1-t15 r1c2-t15">
<p>Oracle ASM instance fails</p>
</td>
<td class="cellalignment2586" headers="r2c1-t15 r1c3-t15">
<p>All database instances accessing Oracle ASM storage from the same node shut down</p>
<p>In Flex ASM configuration, all database instances remain available if another ASM instance is available</p>
</td>
<td class="cellalignment2586" headers="r2c1-t15 r1c4-t15">
<p>Automatic <a href="#BABIDGFJ">Section 12.2.3, &#34;Oracle RAC Recovery for Unscheduled Outages (for Node or Instance Failures)&#34;</a></p>
<p>If Oracle RAC is not used, use Data Guard failover (see <a href="#BABHFFBG">Section 12.2.2.2, &#34;Best Practices for Implementing Fast-Start Failover&#34;</a>)</p>
<p>If Oracle RAC and Data Guard are not used, fix the underlying problem and then restart Oracle ASM and the database instances</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t15" headers="r1c1-t15">
<p>Oracle ASM disk failure</p>
</td>
<td class="cellalignment2586" headers="r3c1-t15 r1c2-t15">
<p>One or more Oracle ASM disks fail, but all disk groups remain online</p>
</td>
<td class="cellalignment2586" headers="r3c1-t15 r1c3-t15">
<p>All data remains accessible. This is possible only with normal or high redundancy disk groups</p>
</td>
<td class="cellalignment2586" headers="r3c1-t15 r1c4-t15">
<p>Oracle ASM automatically rebalances to the remaining disk drives and reestablishes redundancy. There must be enough free disk space in the remaining disk drives to restore the redundancy or the rebalance may fail with an <code dir="ltr">ORA-15041</code>. For more information, see <a href="config_storage.htm#CDEJBGAH">Section 3.6.2, &#34;Oracle Storage Grid Best Practices for Planned Maintenance&#34;</a> <span class="bold">Note:</span> External redundancy disk groups should use mirroring in the storage array to protect from disk failure. Disk failures should not be exposed to Oracle ASM.</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t15" headers="r1c1-t15">
<p>Data area disk-group failure</p>
</td>
<td class="cellalignment2586" headers="r4c1-t15 r1c2-t15">
<p>One or more Oracle ASM disks fail, and data area disk group goes offline</p>
</td>
<td class="cellalignment2586" headers="r4c1-t15 r1c3-t15">
<p>Databases accessing the data area disk group shut down</p>
</td>
<td class="cellalignment2586" headers="r4c1-t15 r1c4-t15">
<p>Perform Data Guard failover or local recovery as described in <a href="#BABEHFGH">Section 12.2.6.3, &#34;Data Area Disk Group Failure&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r5c1-t15" headers="r1c1-t15">
<p>Fast recovery area disk-group failure</p>
</td>
<td class="cellalignment2586" headers="r5c1-t15 r1c2-t15">
<p>One or more Oracle ASM disks fail, and the fast recovery area disk group goes offline</p>
</td>
<td class="cellalignment2586" headers="r5c1-t15 r1c3-t15">
<p>Databases accessing the fast recovery area disk group shut down</p>
</td>
<td class="cellalignment2586" headers="r5c1-t15 r1c4-t15">
<p>Perform local recovery or Data Guard failover as described in <a href="#BABJJHEE">Section 12.2.6.4, &#34;Fast Recovery Area Disk Group Failure&#34;</a></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<div id="HABPT5021" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref758"></a>
<h4 class="sect3"><span class="secnum">12.2.6.1</span> Oracle ASM Instance Failure</h4>
<p>If the Oracle ASM instance fails, then database instances accessing Oracle ASM storage from the same node shut down. The following list describes failover processing:</p>
<ul>
<li>
<p>If the primary database is an Oracle RAC database, then application failover occurs automatically and clients connected to the database instance reconnect to remaining instances. Thus, the service is provided by other instances in the cluster and processing continues. The recovery time typically occurs in seconds.</p>
</li>
<li>
<p>If the primary database is not an Oracle RAC database, then an Oracle ASM instance failure shuts down the entire database.</p>
</li>
<li>
<p>If the configuration uses Oracle Data Guard and fast-start failover is enabled, a database failover is triggered automatically and clients automatically reconnect to the new primary database after the failover completes. The recovery time is the amount of time it takes to complete an automatic Data Guard fast-start failover operation. If fast-start failover is not configured, then you must recover from this outage by either restarting the Oracle ASM and database instances manually, or by performing a manual Data Guard failover.</p>
</li>
<li>
<p>If the configuration includes neither Oracle RAC nor Data Guard, then you must manually restart the Oracle ASM instance and database instances. The recovery time depends on how long it takes to perform these tasks.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<a id="CDEHIEBJ"></a>
<div id="HABPT5022" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.6.2</span> Oracle ASM Disk Failure</h4>
<p>If the <a id="sthref759"></a><a id="sthref760"></a>Oracle ASM disk fails, then failover processing is as follows:</p>
<ul>
<li>
<p><a id="sthref761"></a>External redundancy</p>
<p>If an Oracle ASM disk group is configured as an external redundancy type, then a failure of a single disk is handled by the storage array and should not be seen by the Oracle ASM instance. All Oracle ASM and database operations using the disk group continue normally.</p>
<p>However, if the failure of an external redundancy disk group is seen by the Oracle ASM instance, then the Oracle ASM instance takes the disk group offline immediately, causing Oracle instances accessing the disk group to crash. If the disk failure is temporary, then you can restart Oracle ASM and the database instances and crash recovery occurs after the disk group is brought back online.</p>
</li>
<li>
<p><a id="sthref762"></a><a id="sthref763"></a>Normal or a high-redundancy</p>
<p>If an Oracle ASM disk group is configured as a normal or a high-redundancy type, then disk failure is handled transparently by Oracle ASM and the databases accessing the disk group are not affected.</p>
<p>An Oracle ASM instance automatically starts an <a id="sthref764"></a><a id="sthref765"></a><a id="sthref766"></a>Oracle ASM rebalance operation to distribute the data of one or more failed disks to the remaining, intact disks of the Oracle ASM disk group. While the rebalance operation is in progress, subsequent disk failures may affect disk group availability if the disk contains data that has yet to be remirrored. When the rebalance operation completes successfully, the Oracle ASM disk group is no longer at risk in the event of a subsequent failure. Multiple disk failures are handled similarly, provided the failures affect only one failure group in an Oracle ASM disk group with normal redundancy.</p>
</li>
</ul>
<p>The failure of multiple disks in multiple failure groups where a primary extent and all of its mirrors have been lost causes the disk group to go offline.</p>
<p>When <a id="sthref767"></a><a id="sthref768"></a>Oracle ASM disks fail, use the following recovery methods:</p>
<ul>
<li>
<p><a href="#CDEIAHFG">Using Enterprise Manager to Repair Oracle ASM Disk Failure</a></p>
</li>
<li>
<p><a href="#BABICBHB">Using SQL to Add Replacement Disks Back to the Disk Group</a></p>
</li>
</ul>
<a id="CDEIAHFG"></a>
<div id="HABPT5023" class="sect4">
<h5 class="sect4"><span class="secnum">12.2.6.2.1</span> Using Enterprise Manager to Repair Oracle ASM Disk Failure</h5>
<p><a id="sthref769"></a></p>
<p><a href="#BABIIECB">Figure 12-4</a> shows Enterprise Manager reporting disk failures. Five of 14 alerts are shown. The five alerts shown are Offline messages for Disk RECO2.</p>
<div id="HABPT5345" class="figure">
<p class="titleinfigure"><a id="BABIIECB"></a>Figure 12-4 Enterprise Manager Reports Disk Failures</p>
<img width="1077" height="867" src="img/habpt_asm_disk_failure.png" alt="Description of Figure 12-4 follows"/><br/>
<a id="sthref770" href="img_text/habpt_asm_disk_failure.htm">Description of &#34;Figure 12-4 Enterprise Manager Reports Disk Failures&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#BABEJHHD">Figure 12-5</a> shows Enterprise Manager reporting the status of data area disk group <code dir="ltr">DATA</code>, database Data Guard disk group <code dir="ltr">DBFS_DG</code>, and recovery area disk group <code dir="ltr">RECO</code>.</p>
<div id="HABPT5353" class="figure">
<p class="titleinfigure"><a id="BABEJHHD"></a>Figure 12-5 Enterprise Manager Reports Oracle ASM Disk Groups Status</p>
<img width="1155" height="501" src="img/habpt_asm_fail2.png" alt="Description of Figure 12-5 follows"/><br/>
<a id="sthref771" href="img_text/habpt_asm_fail2.htm">Description of &#34;Figure 12-5 Enterprise Manager Reports Oracle ASM Disk Groups Status&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#BABGIFBJ">Figure 12-6</a> shows Enterprise Manager reporting a pending <code dir="ltr">REBAL</code> operation on the <code dir="ltr">DATA</code> disk group. The operation is almost done, as shown in <span class="bold">% Complete</span>, and the <span class="bold">Remaining Time</span> is estimated to be 0 minutes.</p>
<div id="HABPT5312" class="figure">
<p class="titleinfigure"><a id="BABGIFBJ"></a>Figure 12-6 Enterprise Manager Reports Pending REBAL Operation</p>
<img width="1082" height="278" src="img/habpt_asm_fail3.png" alt="Description of Figure 12-6 follows"/><br/>
<a id="sthref772" href="img_text/habpt_asm_fail3.htm">Description of &#34;Figure 12-6 Enterprise Manager Reports Pending REBAL Operation&#34;</a><br/>
<br/></div>
<!-- class="figure" --></div>
<!-- class="sect4" -->
<a id="BABICBHB"></a>
<div id="HABPT5027" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">12.2.6.2.2</span> Using SQL to Add Replacement Disks Back to the Disk Group</h5>
<p>Perform these steps after one or more failed disks of one specific failure group have been dropped and must be replaced with new disks:</p>
<ol>
<li>
<p>Add the one or more replacement disks to the failed disk group with the following SQL command:</p>
<pre dir="ltr">ALTER DISKGROUP <span class="italic">disk_group</span> 
   ADD FAILGROUP <span class="italic">failure_group</span> 
   DISK &#39;<span class="italic">disk1</span>&#39;,&#39;<span class="italic">disk2</span>&#39;,...;
</pre></li>
<li>
<p>Check the progress of the operation:</p>
<pre dir="ltr">SELECT * FROM V$ASM_OPERATION;
</pre></li>
</ol>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="BABEHFGH"></a>
<div id="HABPT5028" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.6.3</span> Data Area Disk Group Failure</h4>
<p>A data area disk group failure should occur only when there have been multiple failures. For example, if the data area disk group is defined as external redundancy, a single-disk failure should not be exposed to Oracle ASM. However, multiple disk failures in a storage array may be seen by Oracle ASM causing the disk group to go offline. Similarly, multiple disk failures in different failure groups in a normal or high-redundancy disk group may cause the disk group to go offline.</p>
<p>When one or more disks fail in a normal or high redundancy disk group, and the Oracle ASM disk group is accessible, there is no loss of data and no immediate loss of accessibility. An Oracle ASM instance automatically starts an Oracle ASM rebalance operation to distribute the data on the one or more failed disks to the disks that remain intact in the Oracle ASM disk group. When the rebalance operation completes successfully, the Oracle ASM disk group is no longer at risk if a second failure occurs. There must be enough free disk space on the remaining disks in the disk group for the rebalance to complete successfully.</p>
<p><a href="#BABHIFAJ">Table 12-4</a> summarizes the possible solutions for recovering from a data area disk group failure.</p>
<div id="HABPT5029" class="tblruleformal">
<p class="titleintable"><a id="sthref773"></a><a id="BABHIFAJ"></a>Table 12-4 Recovery Options for <a id="sthref774"></a><a id="sthref775"></a>Data Area Disk Group Failure</p>
<table class="cellalignment2589" title="Recovery Options for Data Area Disk Group Failure " summary="Each row is an option when the data area disk group fails. The first column identifies the option, the second column is its RTO, and the third column is its RPO." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t16">Recovery Option</th>
<th class="cellalignment2590" id="r1c2-t16">Recovery Time Objective (RTO<a id="sthref776"></a>)</th>
<th class="cellalignment2590" id="r1c3-t16">Recovery Point Objective (RPO<a id="sthref777"></a>)</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t16" headers="r1c1-t16">
<p>Data Guard failover (see <a href="#BABJJHEE">Section 12.2.6.4, &#34;Fast Recovery Area Disk Group Failure&#34;</a>)</p>
</td>
<td class="cellalignment2586" headers="r2c1-t16 r1c2-t16">
<p>Seconds to minutes</p>
<p>For Platinum: Zero Application Outage</p>
</td>
<td class="cellalignment2586" headers="r2c1-t16 r1c3-t16">
<p>Varies depending on the data protection level chosen</p>
<p>Active Data Guard Far Sync feature can enable more zero data loss configurations</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t16" headers="r1c1-t16">
<p>Local Recovery (see <a href="#CDECHDCJ">&#34;Local Recovery Steps&#34;</a>)</p>
</td>
<td class="cellalignment2586" headers="r3c1-t16 r1c2-t16">
<p>Database restore and recovery time</p>
</td>
<td class="cellalignment2586" headers="r3c1-t16 r1c3-t16">
<p>Zero</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformal" -->
<p>If Data Guard is being used and fast-start failover is configured, then an automatic failover occurs when the database shuts down due to the data area disk group going offline. If fast-start failover is not configured, then perform a manual failover.</p>
<p>If you decide to perform a Data Guard failover then the <a href="glossary.htm#BGBFFACA"><span class="xrefglossterm">recovery time objective (RTO)</span></a> is expressed in terms of minutes or seconds, depending on the presence of the Data Guard observer process and fast-start failover. However, if a manual failover occurs and not all data is available on the standby site, then data loss might result.</p>
<p>After Data Guard failover has completed and the application is available, you must resolve the data area disk group failure. Continue with the following <a href="#CDECHDCJ">&#34;Local Recovery Steps&#34;</a> procedure to resolve the Oracle ASM disk group failure.</p>
<p>The RTO for local recovery only is based on the time required to:</p>
<ol>
<li>
<p>Repair and replace the failed storage components</p>
</li>
<li>
<p>Restore and recover the database</p>
</li>
</ol>
<p>Because the loss affects only the data-area disk group, there is no loss of data. All transactions are recorded in the Oracle redo logs that reside in the fast recovery area, so complete media recovery is possible.</p>
<p>If you are not using Data Guard, then perform the following local recovery steps. The time required to perform local recovery depends on how long it takes to restore and recover the database. There is no data loss when performing local recovery.</p>
<p class="subhead2"><a id="CDECHDCJ"></a><a id="HABPT5030"></a><a id="sthref778"></a>Local Recovery Steps</p>
<p>Perform these steps after one or more failed disks have been replaced and access to the storage has been restored:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you have performed an Oracle Data Guard failover to a new primary database, then you can now use the following procedure to restore and sync the Data Guard setup. Also, see <a href="#BABHHEEE">Section 12.3.2, &#34;Restoring a Standby Database After a Failover&#34;</a>.</div>
<ol>
<li>
<p>Rebuild the Oracle ASM disk group using the new storage location by issuing the following SQL*Plus statement on the Oracle ASM instance:</p>
<pre dir="ltr">SQL&gt; CREATE DISKGROUP DATA NORMAL REDUNDANCY DISK &#39;<span class="italic">path1</span>&#39;,&#39;<span class="italic">path2</span>&#39;,...force;
</pre></li>
<li>
<p>Create a dummy pfile containing the DB_NAME, DB_UNIQUE_NAME and COMPATIBLE parameters to be used to start up the database instance, because the spfile used to startup the database resides in the +DATA diskgroup, which is unavailable.</p>
</li>
<li>
<p>Start the database instance <code dir="ltr">NOMOUNT</code> by issuing the following RMAN command:</p>
<pre dir="ltr">RMAN&gt; STARTUP FORCE NOMOUNT;
</pre></li>
<li>
<p>Restore the spfile from the spfile autobackup, and restore the control file from the surviving copy located in the recovery area:</p>
<pre dir="ltr">RMAN&gt; RESTORE CONTROLFILE FROM &#39;<span class="italic">recovery_area_controlfile</span>&#39;;
</pre>
<p>The absolute path of the controlfile restore location needs to be specified in the restore controlfile command as follows:</p>
<pre dir="ltr">RMAN&gt; RESTORE CONTROLFILE TO &#39;+RECO/dbm/control01.ora&#39; from autobackup db_recovery_file_dest=&#39;+RECO&#39; db_name=&#39;<span class="italic">db_name</span>&#39;;
</pre></li>
<li>
<p>After the spfile is restored to a location in the previous step, the dummy init.ora file created in the first step must be modified to point the restored spfile.</p>
<p>For example, the pfile would look something like:</p>
<pre dir="ltr">$ cat initdbm1.ora
SPFILE=&#39;+RECO/dbm/spfiledbm.ora&#39; ==&gt; spfile restored in the previous step.
</pre></li>
<li>
<p>Restart the database instance with the restored spfile.</p>
</li>
<li>
<p>Modify the control_files parameter in the spfile to point to the restored control files:</p>
<pre dir="ltr">ALTER SYSTEM SET control_files=&#39;&lt;full path and filename of the location of the restored control files&gt;&#39;;
</pre></li>
<li>
<p>Start the database instance <code dir="ltr">MOUNT</code>:</p>
<pre dir="ltr">RMAN&gt; STARTUP FORCE MOUNT;
</pre></li>
<li>
<p>Restore the database:</p>
<pre dir="ltr">RMAN&gt; RESTORE DATABASE
</pre></li>
<li>
<p>Recover the database:</p>
<pre dir="ltr">RMAN&gt; RECOVER DATABASE;
</pre></li>
<li>
<p>If you use block change tracking, then disable and re-enable the block change tracking file using SQL*Plus statements:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE DISABLE BLOCK CHANGE TRACKING;
SQL&gt; ALTER DATABASE ENABLE BLOCK CHANGE TRACKING;
</pre></li>
<li>
<p>Open the database:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE OPEN;
</pre></li>
<li>
<p>Re-create the log file members on the failed Oracle ASM disk group:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE DROP LOGFILE MEMBER &#39;<span class="italic">filename</span>&#39;;
SQL&gt; ALTER DATABASE ADD LOGFILE MEMBER &#39;<span class="italic">disk_group</span>&#39; TO GROUP <span class="italic">group_no</span>;
</pre></li>
<li>
<p>Recreate the temp tablespace as part of cleaning up of the restored database.</p>
<pre dir="ltr">SQL&gt; DROP TABLESPACE TEMP;
SQL&gt; CREATE TEMPORARY TABLESPACE TEMP TEMPFILE &#39;disk_group&#39;; 
</pre></li>
<li>
<p>Perform an incremental level 0 backup using the following RMAN command:</p>
<pre dir="ltr">RMAN&gt; BACKUP INCREMENTAL LEVEL 0 DATABASE;
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="BABJJHEE"></a>
<div id="HABPT5031" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.6.4</span> Fast Recovery Area Disk Group Failure<a id="sthref779"></a><a id="sthref780"></a></h4>
<p>When the fast recovery-area disk group fails, the database crashes because the <a id="sthref781"></a>control file member usually resides in the fast recovery area and Oracle requires that all control file members are accessible. The fast recovery area can also contain the <a id="sthref782"></a>flashback logs, <a id="sthref783"></a>redo log members, and all <a id="sthref784"></a>backup files.</p>
<p>Because the failure affects only the fast recovery-area disk group, there is no loss of data. No database media recovery is required, because the data files and the online redo log files are still present and available in the data area.</p>
<p>A fast recovery area disk group failure typically occurs only when there have been multiple failures. For example, if the fast recovery-area disk group is defined as external redundancy, a single-disk failure should not be exposed to Oracle ASM. However, <a id="sthref785"></a><a id="sthref786"></a><a id="sthref787"></a>multiple disk failures in a storage array may affect Oracle ASM and cause the disk group to go offline. Similarly, <a id="sthref788"></a><a id="sthref789"></a>multiple disk failures in different failure groups in a normal or high-redundancy disk group may cause the disk group to go offline.</p>
<p><a href="#BABGJJFJ">Table 12-5</a> summarizes possible solutions when the fast recovery-area disk group fails.</p>
<div id="HABPT5032" class="tblruleformal">
<p class="titleintable"><a id="sthref790"></a><a id="BABGJJFJ"></a>Table 12-5 <a id="sthref791"></a>Recovery Options for Fast Recovery Area Disk Group Failure</p>
<table class="cellalignment2589" title="Recovery Options for Fast Recovery Area Disk Group Failure " summary="Each row is a Flash Recovery Area failure recovery option. The first column identifies the option, the second column shows its RTO, and the third column shows its RPO." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t18">Recovery Option</th>
<th class="cellalignment2590" id="r1c2-t18"><a id="sthref792"></a>Recovery Time Objective (RTO)</th>
<th class="cellalignment2590" id="r1c3-t18">Recovery Point Objective (RPO)<a id="sthref793"></a></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t18" headers="r1c1-t18">
<p>Local recovery (see <a href="#BABCHJHB">Section 12.2.6.4.1, &#34;Local Recovery for Fast Recovery Area Disk Group Failure&#34;</a>)</p>
</td>
<td class="cellalignment2586" headers="r2c1-t18 r1c2-t18">
<p>Five minutes or less</p>
</td>
<td class="cellalignment2586" headers="r2c1-t18 r1c3-t18">
<p>Zero</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t18" headers="r1c1-t18">
<p>Data Guard failover or switchover (see <a href="#BABDIBBI">Section 12.2.6.4.2, &#34;Data Guard Role Transition for Fast Recovery Area Disk Group Failure&#34;</a>)</p>
</td>
<td class="cellalignment2586" headers="r3c1-t18 r1c2-t18">
<p>Seconds to minutes</p>
</td>
<td class="cellalignment2586" headers="r3c1-t18 r1c3-t18">
<p>Zero</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformal" -->
<a id="BABCHJHB"></a>
<div id="HABPT5258" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">12.2.6.4.1</span> Local Recovery for Fast Recovery Area Disk Group Failure</h5>
<p>If you decide to perform <a id="sthref794"></a>local recovery then you must perform a <a id="sthref795"></a>fast local restart to start the primary database after removing the controlfile member that is located in the fast recovery area from the init.ora and allocate another disk group as the fast recovery area for archiving.</p>
<p>When the Fast Recovery Area is lost, the database LOG_ARCHIVE_DEST_n location and the database DB_RECOVERY_FILE_DEST must be modified to point a surviving disk group; otherwise, the database hangs when the archive log location is unavailable. Also if guaranteed restore points are in place, the database crashes when the DB_RECOVERY_FILE_DEST becomes unavailable.</p>
<p>For a fast local restart, perform the following steps on the primary database:</p>
<ol>
<li>
<p>Change the <a id="sthref796"></a><code dir="ltr">CONTROL_FILES</code> initialization parameter to specify only the members in the Data Area:</p>
<pre dir="ltr">ALTER SYSTEM SET CONTROL_FILES=&#39;+DATA/sales/control1.dbf&#39; SCOPE=spfile;
</pre></li>
<li>
<p>Change local archive destinations and the fast recovery area to the local redundant, scalable destination:</p>
<pre dir="ltr">ALTER SYSTEM SET DB_RECOVERY_FILE_DEST=&#39;+DATA&#39; SCOPE=spfile;
</pre></li>
<li>
<p>Start the database with the new settings:</p>
<pre dir="ltr">STARTUP MOUNT:
</pre></li>
<li>
<p>Drop the redo log members that were in the lost disk group. For example, issue the following command:</p>
<pre dir="ltr">ALTER DATABASE DROP LOGFILE MEMBER &#39;+RECO/dbm/onlinelog/group_2.258.750768395&#39;;
</pre></li>
<li>
<p>If the flashback logs were damaged or lost, it may be necessary to disable and re-enable Flashback Database:</p>
<pre dir="ltr">ALTER DATABASE FLASHBACK OFF;
ALTER DATABASE FLASHBACK ON;
ALTER DATABASE OPEN;
</pre>
<p>However, this is a temporary fix until you create a fast recovery area to replace the failed storage components. Oracle recommends using the Local Recovery Steps.</p>
</li>
<li>
<p>Once the failed Fast Recovery Area disk group comes back up or gets recreated, you must set the LOG_ARCHIVE_DEST_1 and the DB_RECOVERY_FILE_DEST location back to the original Fast Recovery Area disk group and transfer the archive logs and the flashback logs back to the Fast Recovery Area disk group.</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p>My Oracle Support note 1339373.1 &#34;Operational Steps for Recovery after Losing a Disk Group in an Exadata Environment&#34; at <a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1339373.1"><code dir="ltr">https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1339373.1</code></a> for more details and options for avoidance.</p>
</li>
<li>
<p><a href="#BABEBFDF">Section 12.2.6.4.3, &#34;Data Guard Role Transition for Fast Recovery Area Disk Group Failure Local Recovery Steps&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect4" -->
<a id="BABDIBBI"></a>
<div id="HABPT5259" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">12.2.6.4.2</span> Data Guard Role Transition for Fast Recovery Area Disk Group Failure</h5>
<p>If you decide to perform a Data Guard role transition then the recovery time objective (RTO) can be expressed in terms of seconds or minutes, depending on the presence of the Data Guard observer process and fast-start failover.</p>
<p>If the protection level is maximum performance or the standby database is <span class="italic">unsynchronized</span> with the primary database, then:</p>
<ol>
<li>
<p>Temporarily start the primary database by removing the controlfile member and pointing to a temporary fast recovery area (file system) in the SPFILE.</p>
</li>
<li>
<p>Perform a Data Guard switchover to ensure no data loss.</p>
</li>
<li>
<p>After the switchover has completed and the application is available, resolve the fast recovery area disk group failure.</p>
</li>
<li>
<p>Shut down the affected database and continue by using the instructions in the Local Recovery Steps to resolve the Oracle ASM disk group failure. For more information, see <a href="#BABEBFDF">&#34;Data Guard Role Transition for Fast Recovery Area Disk Group Failure Local Recovery Steps&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect4" -->
<a id="BABEBFDF"></a>
<div id="HABPT5260" class="sect4"><!-- infolevel="all" infotype="General" -->
<h5 class="sect4"><span class="secnum">12.2.6.4.3</span> Data Guard Role Transition for Fast Recovery Area Disk Group Failure Local Recovery Steps</h5>
<p class="subhead2"><a id="CDEBHEFF"></a><a id="HABPT5035"></a>Local Recovery Steps<a id="sthref797"></a><a id="sthref798"></a></p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you performed an Oracle Data Guard failover to a new primary database, then you cannot use this procedure to reintroduce the original primary database as a standby database. This is because Flashback Database log files that are required as part of reintroducing the database have been lost. You must perform a full reinstatement of the standby database.</div>
<ol>
<li>
<p>Replace or get access to storage to use for a fast recovery area</p>
</li>
<li>
<p>Rebuild the Oracle ASM disk group using the storage location by issuing the following SQL*Plus statement:</p>
<pre dir="ltr">SQL&gt; CREATE DISKGROUP RECO NORMAL REDUNDANCY DISK &#39;<span class="italic">path1</span>&#39;,&#39;<span class="italic">path2</span>&#39;,...force;
</pre></li>
<li>
<p>Start the database instance <code dir="ltr">NOMOUNT</code> using the following RMAN command:</p>
<pre dir="ltr">RMAN&gt; STARTUP FORCE NOMOUNT;
</pre></li>
<li>
<p>Restore the control file from the surviving copy located in the data area:</p>
<pre dir="ltr">RMAN&gt; RESTORE CONTROLFILE FROM &#39;<span class="italic">data_area_controlfile</span>&#39;;
</pre></li>
<li>
<p>Start the database instance <code dir="ltr">MOUNT</code>:</p>
<pre dir="ltr">RMAN&gt; STARTUP FORCE MOUNT;
</pre></li>
<li>
<p>If you use Flashback Database, then disable it with the following SQL*Plus statement:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE FLASHBACK OFF;
</pre></li>
<li>
<p>Open the database and allow instance recovery to complete:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE OPEN;
</pre></li>
<li>
<p>Issue the following statements only if Flashback Database is required:</p>
<pre dir="ltr">SQL&gt; SHUTDOWN IMMEDIATE;
SQL&gt; STARTUP MOUNT;
SQL&gt; ALTER DATABASE FLASHBACK ON;
SQL&gt; ALTER DATABASE OPEN;
</pre></li>
<li>
<p>Re-create the log file members on the failed Oracle ASM disk group:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE DROP LOGFILE MEMBER &#39;<span class="italic">filename</span>&#39;;
SQL&gt; ALTER DATABASE ADD LOGFILE MEMBER &#39;<span class="italic">disk_group</span>&#39; TO GROUP <span class="italic">group_no</span>;
</pre></li>
<li>
<p>Synchronize the control file and the fast recovery area using the following RMAN commands:</p>
<pre dir="ltr">RMAN&gt; CATALOG RECOVERY AREA;
RMAN&gt; CROSSCHECK ARCHIVELOG ALL;
RMAN&gt; CROSSCHECK BACKUPSET;
RMAN&gt; CROSSCHECK DATAFILECOPY ALL;
RMAN&gt; LIST EXPIRED <span class="italic">type</span>;
RMAN&gt; DELETE EXPIRED <span class="italic">type</span>;
</pre>
<p>In the example, the <code dir="ltr"><span class="codeinlineitalic">type</span></code> variable is a placeholder for both <code dir="ltr">LIST EXPIRED BACKUP</code> and <code dir="ltr">LIST EXPIRED COPY</code> commands, and also for the <code dir="ltr">DELETE EXPIRED BACKUP</code> and <code dir="ltr">DELETE EXPIRED COPY</code> commands. You should run all of these commands now.</p>
</li>
<li>
<p>Assuming that data has been lost, perform a backup:</p>
<pre dir="ltr">RMAN&gt; BACKUP INCREMENTAL LEVEL 0 DATABASE;
</pre></li>
</ol>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABECCJH"></a>
<div id="HABPT5206" class="sect2">
<h3 class="sect2"><span class="secnum">12.2.7</span> Recovering from Data Corruption</h3>
<p>A data block is corrupted when it is not in a recognized Oracle Database format, or its contents are not internally consistent. Data block corruption can damage internal Oracle control information or application and user data, leading to crippling loss of critical data and services. The Oracle Database corruption prevention, detection, and repair capabilities are built on internal knowledge of the data and transactions it protects, and on the intelligent integration of its comprehensive high availability solutions. For more information, see <a href="config_db.htm#BGBHFDFG">Section 4.1.6, &#34;Protect Against Data Corruption&#34;</a>.</p>
<p>The recovery process begins when you either suspect or discover a block corruption (for example: <code dir="ltr">ORA-1578</code>, <code dir="ltr">ORA-752</code>, <code dir="ltr">ORA-600</code> <code dir="ltr">[</code><code dir="ltr">3020</code><code dir="ltr">]</code>, and <code dir="ltr">ORA-753</code>). Once a corrupt block is found, Oracle provides various techniques for recovering from most block corruptions.</p>
<p>There are various techniques for recovering data blocks, including:</p>
<ul>
<li>
<p>Data Recovery Advisor is the easiest way to diagnose and repair most problems. For more information, see <a href="#BABGBDEA">Section 12.2.7.1, &#34;Use Data Recovery Advisor&#34;</a>.</p>
</li>
<li>
<p>Active Data Guard can automatically repair corrupt data blocks in a primary or standby database. For more information, see <a href="#BABJGJJH">Section 12.2.7.2, &#34;Use Active Data Guard&#34;</a>.</p>
</li>
<li>
<p>RMAN block media recovery can repair individual corrupted blocks by retrieving the blocks from good backups. For more information, see <a href="#BABIFCBH">Section 12.2.7.3, &#34;Use RMAN and Block Media Recovery&#34;</a>.</p>
</li>
<li>
<p>Data Guard switchover or failover to a standby database. For more information, see <a href="#BABCHJEB">Section 12.2.7.2.2, &#34;Extracting Data from a Physical Standby Databases&#34;</a>.</p>
</li>
<li>
<p>Data File Media Recovery with RMAN. For more information, see <a href="#BABIFCBH">Section 12.2.7.3, &#34;Use RMAN and Block Media Recovery&#34;</a></p>
</li>
<li>
<p>When encountering lost write corruptions that result in <code dir="ltr">ORA-752</code> or <code dir="ltr">ORA-600 [3020]</code>, follow the guidelines in &#34;Resolving ORA-752 or ORA-600 [3020] During Standby Recovery&#34; in My Oracle Support Note 1265884.1 at</p>
<p><code dir="ltr"><a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1265884.1">https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1265884.1</a></code></p>
</li>
</ul>
<p>Furthermore, Data Guard broker has a new <code dir="ltr">PrimaryLostWriteAction</code> property that helps automate specific actions whenever standby database detects that a lost write has occurred at the primary database. For example, If fast-start failover is enabled (in either maximum performance or maximum availability mode, and the Data Guard broker <code dir="ltr">PrimaryLostWriteAction</code> is set to <code dir="ltr">FORCEFAILOVER</code>, then the observer initiates a failover. This option results in a data loss failover but can reduce downtime significantly. The <code dir="ltr">FORCEFAILOVER</code> option is available only in Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2) and later.</p>
<p>Whatever method you use to recover corrupted blocks, you first must analyze the type and degree of corruption to perform the recovery. Implementing the optimal techniques to prevent and prepare for data corruptions can save time, effort, and stress when dealing with the possible consequences-lost data and downtime.</p>
<p>MAA best practices provide a step-by-step process for resolving most corruptions and stray or lost writes, including the following:</p>
<ol>
<li>
<p><a href="#BABGBDEA">Use Data Recovery Advisor</a></p>
</li>
<li>
<p><a href="#BABJGJJH">Use Active Data Guard</a></p>
</li>
<li>
<p><a href="#BABIFCBH">Use RMAN and Block Media Recovery</a></p>
</li>
<li>
<p><a href="#BABFIHGI">Perform a Data Guard Role Transition</a></p>
</li>
<li>
<p><a href="#BABCDCIC">Use RMAN and Data File Media Recovery</a></p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p>For more information see the &#34;Preventing, Detecting, and Repairing Block Corruption: Database 11g&#34; MAA white paper from the MAA Best Practices area for Oracle Database at</p>
<p><code dir="ltr"><a href="http://www.oracle.com/goto/maa/">http://www.oracle.com/goto/maa</a></code></p>
</li>
<li>
<p>See, &#34;Best Practices for Corruption Detection, Prevention, and Automatic Repair - in a Data Guard Configuration&#34; in My Oracle Support Note 1302539.1 at</p>
<p><code dir="ltr"><a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1302539.1">https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1302539.1</a></code></p>
</li>
</ul>
</div>
<a id="BABGBDEA"></a>
<div id="HABPT5207" class="sect3">
<h4 class="sect3"><span class="secnum">12.2.7.1</span> Use Data Recovery Advisor</h4>
<p>Data Recovery Advisor enables you to perform restore operations and recovery procedures or use Flashback Database as follows:</p>
<ul>
<li>
<p>Perform block media recovery of data files that have corrupted blocks</p>
</li>
<li>
<p>Perform point-in-time recovery of the database or selected tablespaces</p>
</li>
<li>
<p>Rewind the entire database with Flashback Database</p>
</li>
<li>
<p>Completely restore and recover the database from a backup</p>
</li>
</ul>
<p>Data Recovery Advisor has both a command-line and GUI interface. The GUI interface is available when you click Perform Recovery with Oracle Enterprise Manager Database Control (Support Workbench); this allows you use Data Recovery Advisor.</p>
<p>Using the RMAN command-line interface, the Data Recovery Advisor commands include: <code dir="ltr">LIST</code> <code dir="ltr">FAILURE</code>, <code dir="ltr">ADVISE FAILURE</code>, <code dir="ltr">REPAIR FAILURE</code>, and <code dir="ltr">CHANGE FAILURE</code>.</p>
<p>If the Data Recover Advisor fixes the problem, then there is no need to continue with any further recovery methods. However, continue to periodically check the alert log for any ORA- errors and any corruption warnings on the primary and standby databases. While the database is operational and corruption is detected, corruption errors are recorded as <code dir="ltr">ORA-600</code> or <code dir="ltr">ORA-01578</code> in the alert log.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In the current release, Data Recovery Advisor only supports single-instance databases. Oracle RAC databases are not supported. See <a class="olink BRADV89724" href="../BRADV/rcmrepai.htm#BRADV89724"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for more information about Data Recovery Advisor supported database configurations.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="config_db.htm#BGBGEIJF">Section 4.2.2, &#34;Use Data Recovery Adviser to Detect, Analyze and Repair Data Failures&#34;</a></p>
</li>
<li>
<p><a class="olink ADMQS0635" href="../ADMQS/GUID-5801E369-B27D-4DF0-B291-68C37D641C43.htm#ADMQS0635"><span class="italic">Oracle Database 2 Day DBA</span></a> documentation for details on how to use the GUI interface for Data Recovery Advisor</p>
</li>
<li>
<p><a class="olink BRADV246" href="../BRADV/rcmrepai.htm#BRADV246"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for more information about Diagnosing and Repairing Failures with Data Recovery Advisor</p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="BABJGJJH"></a>
<div id="HABPT5208" class="sect3">
<h4 class="sect3"><span class="secnum">12.2.7.2</span> Use Active Data Guard</h4>
<p>There are two options for using a standby database to repair block corruption on the primary database:</p>
<ul>
<li>
<p><a href="#BABHDHBI">Oracle Active Data Guard and Automatic Block Repair</a></p>
</li>
<li>
<p><a href="#BABCHJEB">Extracting Data from a Physical Standby Databases</a></p>
</li>
</ul>
<p>Alternatively, if the corruption is widespread, you may choose to failover or switchover to the standby database while you make repairs to the primary database. For more information, see <a href="#BABFIHGI">Section 12.2.7.4, &#34;Perform a Data Guard Role Transition&#34;</a>.</p>
<a id="BABHDHBI"></a>
<div id="HABPT5209" class="sect4">
<h5 class="sect4"><span class="secnum">12.2.7.2.1</span> Oracle Active Data Guard and Automatic Block Repair</h5>
<p>Starting in Oracle Database 11<span class="italic">g</span> Release 2 (11.2), the primary database automatically attempts to repair a corrupted block in real time by fetching a good version of the same block from a physical standby database. This capability is referred to as Automatic Block Repair; Automatic Block Repair allows corrupt data blocks to be automatically repaired as soon as the corruption is detected. Automatic Block Repair reduces the amount of time that data is inaccessible due to block corruption and reduces block recovery time by using up-to-date good blocks in real-time, as opposed to retrieving blocks from disk or tape backups, or from Flashback logs.</p>
<p>Thus, with Automatic Block Repair you use an Oracle Active Data Guard standby database for automatic repair of data corruptions detected by the primary database. Additionally if the corruption is discovered on an Active Data Guard physical standby database the corruption is automatically repaired with a good block from the Primary. Both of these operations are transparent to the applications.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Automatic Block Repair requires the use of the Oracle Active Data Guard option.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB4782" href="../SBYDB/manage_ps.htm#SBYDB4782"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information about Oracle Active Data Guard option and the Automatic Block Repair feature</div>
</div>
<!-- class="sect4" -->
<a id="BABCHJEB"></a>
<div id="HABPT5210" class="sect4">
<h5 class="sect4"><span class="secnum">12.2.7.2.2</span> Extracting Data from a Physical Standby Databases</h5>
<p>You can use a Data Guard physical standby database to repair data file wide block corruption on the primary database by replacing the corrupted data files with good copies from the standby database. Once the files are restored on the primary database, data file or tablespace recovery makes the data files consistent with the rest of the database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB5060" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=SBYDB5060"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about Recovery from Loss of Data Files on the Primary Database Using Files On a Standby Database</div>
</div>
<!-- class="sect4" -->
<div id="HABPT5395" class="sect4"><!-- infolevel="all" infotype="General" --><a id="sthref799"></a>
<h5 class="sect4"><span class="secnum">12.2.7.2.3</span> Optionally Failing Over to Standby Database Automatically/Manually due to Corruptions</h5>
<p>Wide-spread block corruptions (physical or logical) or lost writes likely indicate a significant hardware issue at the primary site. In this case a failover to a standby database might be the most prudent course of action in order to maintain availability and minimize potential data loss.</p>
<p>Use the Data Guard Broker property PrimaryLostWriteAction to predetermine the action taken in the event a standby database detects a lost write in a fast-start failover configuration.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" -->
<a id="BABIFCBH"></a>
<div id="HABPT5211" class="sect3">
<h4 class="sect3"><span class="secnum">12.2.7.3</span> Use RMAN and Block Media Recovery</h4>
<p>Block media recovery recovers one block or a set of data blocks marked &#34;media corrupt&#34; in a data file by using the RMAN <code dir="ltr">RECOVER</code> <code dir="ltr">BLOCK</code> command. When a small number of data blocks are marked media corrupt and require media recovery, you can selectively restore and recover damaged blocks rather than whole data files. Block media recovery minimizes redo application time and avoids I/O overhead during recovery. Block media recovery also enables affected data files to remain online during recovery of the corrupt blocks. The corrupt blocks, however, remain unavailable until they are completely recovered.</p>
<p>Use block media recovery when:</p>
<ul>
<li>
<p>A small number of blocks require media recovery and you know which blocks need recovery.</p>
</li>
<li>
<p>Blocks are marked corrupt (you can verify this with the RMAN <code dir="ltr">VALIDATE</code> <code dir="ltr">CHECK</code> <code dir="ltr">LOGICAL</code> command).</p>
</li>
<li>
<p>The backup file for the corrupted data file is available locally or can be retrieved from a remote location.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
Do not use block media recovery to recover from user errors or software bugs that cause logical corruption where the data blocks are intact.</div>
<p>If a significant portion of the data file is corrupt or if the amount of corruption is unknown, then use either RMAN to restore the file from a backup or switch to an on disk image copy, or switchover to your Data Guard standby database.</p>
<p>When corruption is detected, recover the block through the Oracle Enterprise Manager Restore and Recovery Wizard or directly with RMAN. For example, to recover a specific corrupt block using RMAN block media recovery:</p>
<pre dir="ltr">RMAN&gt; RECOVER BLOCK DATAFILE 7 BLOCK 3;
</pre>
<p>After a corrupt block is repaired, the row identifying this corrupted block is deleted from the <code dir="ltr">V$DATABASE_BLOCK_CORRUPTION</code> view.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink BRADV" href="../BRADV/toc.htm"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for information about RMAN&#39;s block media recovery</div>
</div>
<!-- class="sect3" -->
<a id="BABFIHGI"></a>
<div id="HABPT5212" class="sect3">
<h4 class="sect3"><span class="secnum">12.2.7.4</span> Perform a Data Guard Role Transition</h4>
<p>If the primary database corruption is widespread due to a bad controller or other hardware or software problem, then you may want to failover or switchover to the standby database while repairs to the primary database server are made. Use Data Guard switchover or failover for data corruption or data failure when:</p>
<ul>
<li>
<p>The database is down or when the database is up but the application is unavailable because of data corruption or failure, and the time to restore and recover locally is long or unknown.</p>
</li>
<li>
<p>Recovering locally takes longer than the business service-level agreement or RTO. (We can automate this with FSFO and Broker attributes for lost writes and triggering on ORA-1578s.)</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB00600" href="../SBYDB/role_management.htm#SBYDB00600"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information about Data Guard failovers and switchovers</div>
</div>
<!-- class="sect3" -->
<a id="BABCDCIC"></a>
<div id="HABPT5213" class="sect3">
<h4 class="sect3"><span class="secnum">12.2.7.5</span> Use RMAN and Data File Media Recovery</h4>
<p>When you cannot use any of the following methods to resolve corruptions and stray or lost writes, then use RMAN traditional media recovery:</p>
<ul>
<li>
<p><a href="#BABGBDEA">Use Data Recovery Advisor</a></p>
</li>
<li>
<p><a href="#BABJGJJH">Use Active Data Guard</a></p>
</li>
<li>
<p><a href="#BABIFCBH">Use RMAN and Block Media Recovery</a></p>
</li>
<li>
<p><a href="#BABFIHGI">Perform a Data Guard Role Transition</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you do not have a Data Guard Physical standby, then you must use traditional media recovery. Using traditional media recovery, a backup copy of one or more files is restored and then data file, tablespace, or database recovery brings the database back to a consistent state.</div>
<p>Data file media recovery affects an entire data file or set of data files for a database by using the RMAN <code dir="ltr">RECOVER</code> command. When a large or unknown number of data blocks are marked &#34;media corrupt&#34; and require media recovery, or when an entire file is lost, you must restore and recover the applicable data files.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink BRADV018" href="../BRADV/osadvsce.htm#BRADV018"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for information about Advanced User-Managed Recovery Scenarios</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1010215"></a>
<div id="HABPT5043" class="sect2">
<h3 class="sect2"><span class="secnum">12.2.8</span> Recovering from Human Error<a id="sthref800"></a> (Recovery with Flashback)</h3>
<p>Oracle Flashback <a id="sthref801"></a><a id="sthref802"></a>technology revolutionizes data recovery. Before Flashback technology, it took seconds to damage a database but from hours to days to recover it. With Flashback technology, the time to correct errors can be as short as the time it took to make the error. Fixing human errors that require rewinding the database, table, transaction, or row level changes to a previous point in time is easy and does not require any database or object restoration. Flashback technology provides fine-grained analysis and repair for localized damage such as erroneous row deletion. Flashback technology also enables correction of more widespread damage such as accidentally running the wrong application batch job. Furthermore, Flashback technology is exponentially faster than a database restoration.</p>
<p>Flashback technologies are applicable only to repairing the following human errors:</p>
<ul>
<li>
<p>Erroneous or malicious update, delete, or insert transactions</p>
</li>
<li>
<p>Erroneous or malicious <code dir="ltr">DROP TABLE</code> statements</p>
</li>
<li>
<p>Erroneous or malicious batch job or wide-spread application errors</p>
</li>
</ul>
<p>Flashback technologies cannot be used for media or data corruption such as block corruption, bad disks, or file deletions. See <a href="#i1006521">Section 12.2.2, &#34;Database Failover with a Standby Database&#34;</a> to repair these outages.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For information about Flashback Database configuration best practices, see <a href="config_db.htm#BGBFJGCI">Section 4.1.4, &#34;Enable Flashback Database&#34;</a></div>
<p><a href="#CDEDIFEH">Table 12-6</a> summarizes the <a id="sthref803"></a>Flashback solutions for outage varying in scope from destroying a row, such as through a bad update, to destroying a whole database (such as by deleting all the underlying files at the operating system level).</p>
<div id="HABPT5044" class="tblruleformalwide">
<p class="titleintable"><a id="sthref804"></a><a id="CDEDIFEH"></a>Table 12-6 Flashback Solutions for Different Outages</p>
<table class="cellalignment2589" title="Flashback Solutions for Different Outages " summary="This table summarizes flashback solutions for types of outages that are appropriate for flashback usage." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t33">Outage Scope</th>
<th class="cellalignment2590" id="r1c2-t33">Examples of Human Errors</th>
<th class="cellalignment2590" id="r1c3-t33">Flashback Solutions</th>
<th class="cellalignment2590" id="r1c4-t33">See Also</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t33" headers="r1c1-t33">
<p>Row or transaction</p>
</td>
<td class="cellalignment2586" headers="r2c1-t33 r1c2-t33">
<p>Accidental deletion of row</p>
<p>Erroneous transaction</p>
</td>
<td class="cellalignment2586" headers="r2c1-t33 r1c3-t33">
<p><a href="#CDEGAIAH">Flashback Query</a></p>
<p><a href="#CDEECBDC">Flashback Version Query</a></p>
<p><a href="#CDEBHAJF">Flashback Transaction Query</a></p>
<p><a href="#CDEHEAJG">Flashback Transaction</a></p>
</td>
<td class="cellalignment2586" headers="r2c1-t33 r1c4-t33">
<p><span class="bold">See Also:</span> <a href="#BABJBCEG">Section 12.2.8.2, &#34;Resolving Row and Transaction Inconsistencies&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t33" headers="r1c1-t33">
<p>Table</p>
</td>
<td class="cellalignment2586" headers="r3c1-t33 r1c2-t33">
<p>Dropped table</p>
<p>Erroneous transactions affecting one table or a set of tables</p>
</td>
<td class="cellalignment2586" headers="r3c1-t33 r1c3-t33">
<p><a href="#CDECIAGJ">Flashback Drop</a></p>
<p><a href="#CDECEAEJ">Flashback Table</a></p>
</td>
<td class="cellalignment2586" headers="r3c1-t33 r1c4-t33">
<p><span class="bold">See Also:</span> <a href="#BABECBBE">Section 12.2.8.1, &#34;Resolving Table Inconsistencies&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t33" headers="r1c1-t33">
<p>Tablespace or database</p>
</td>
<td class="cellalignment2586" headers="r4c1-t33 r1c2-t33">
<p>Erroneous batch job affecting many tables or an unknown set of tables</p>
<p>Series of database-wide malicious transactions</p>
</td>
<td class="cellalignment2586" headers="r4c1-t33 r1c3-t33">
<p><a href="config_db.htm#BGBFJGCI">Enable Flashback Database</a> or use multiple <a href="#CDECEAEJ">Flashback Table</a> commands</p>
</td>
<td class="cellalignment2586" headers="r4c1-t33 r1c4-t33">
<p><span class="bold">See Also:</span> <a href="#CDECIGII">Section 12.2.8.3, &#34;Resolving Database-Wide Inconsistencies&#34;</a></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r5c1-t33" headers="r1c1-t33">
<p>Single tablespace or a subset of tablespaces</p>
</td>
<td class="cellalignment2586" headers="r5c1-t33 r1c2-t33">
<p>Erroneous transactions affecting a small number of tablespaces</p>
</td>
<td class="cellalignment2586" headers="r5c1-t33 r1c3-t33">
<p>RMAN Tablespace Point-in-Time Recovery (TSPITR)</p>
</td>
<td class="cellalignment2586" headers="r5c1-t33 r1c4-t33">
<p><span class="bold">See Also:</span> <a href="#CDEGDCDG">Section 12.2.8.4, &#34;Resolving One or More Tablespace Inconsistencies&#34;</a></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<p><a href="#g1013895">Table 12-7</a> summarizes each Flashback feature.</p>
<div id="HABPT5045" class="tblruleformalwide">
<p class="titleintable"><a id="sthref805"></a><a id="g1013895"></a>Table 12-7 Summary of Flashback Features</p>
<table class="cellalignment2589" title="Summary of Flashback Features " summary="This table summarizes the workings of the various flashback features." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t34">Flashback Feature</th>
<th class="cellalignment2590" id="r1c2-t34">Description</th>
<th class="cellalignment2590" id="r1c3-t34">Changes are propagated to ...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t34" headers="r1c1-t34">
<p><a href="#CDEGAIAH">Flashback Query</a></p>
</td>
<td class="cellalignment2586" headers="r2c1-t34 r1c2-t34">
<p><a id="sthref806"></a>Flashback Query enables you to view data at an earlier point in time. You can use it to view and reconstruct lost data that was deleted or changed by accident. Developers can use this feature to build self-service error correction into their applications, empowering end users to undo and correct their errors.</p>
</td>
<td class="cellalignment2586" headers="r2c1-t34 r1c3-t34">
<p>Physical and logical standby databases</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t34" headers="r1c1-t34">
<p><a href="#CDEECBDC">Flashback Version Query</a></p>
</td>
<td class="cellalignment2586" headers="r3c1-t34 r1c2-t34">
<p><a id="sthref807"></a>Flashback Version Query uses undo data stored in the database to view the changes to one or more rows along with all the metadata of the changes.</p>
</td>
<td class="cellalignment2586" headers="r3c1-t34 r1c3-t34">
<p>Physical and logical standby databases</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t34" headers="r1c1-t34">
<p><a href="#CDEBHAJF">Flashback Transaction Query</a></p>
</td>
<td class="cellalignment2586" headers="r4c1-t34 r1c2-t34">
<p><a id="sthref808"></a>Flashback Transaction Query enables you to examine changes to the database at the transaction level. As a result, you can diagnose problems, perform analysis, and audit transactions.</p>
</td>
<td class="cellalignment2586" headers="r4c1-t34 r1c3-t34">
<p>Physical and logical standby databases</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r5c1-t34" headers="r1c1-t34">
<p><a href="#CDEHEAJG">Flashback Transaction</a></p>
</td>
<td class="cellalignment2586" headers="r5c1-t34 r1c2-t34">
<p><a id="sthref809"></a>Flashback Transaction provides a way to roll back one or more transactions and their dependent transactions, while the database remains online.</p>
</td>
<td class="cellalignment2586" headers="r5c1-t34 r1c3-t34">
<p>Physical and logical standby databases</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r6c1-t34" headers="r1c1-t34">
<p><a href="#CDECIAGJ">Flashback Drop</a></p>
</td>
<td class="cellalignment2586" headers="r6c1-t34 r1c2-t34">
<p><a id="sthref810"></a>Flashback Drop provides a way to restore accidentally dropped tables.</p>
</td>
<td class="cellalignment2586" headers="r6c1-t34 r1c3-t34">
<p>Physical standby databases</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r7c1-t34" headers="r1c1-t34">
<p><a href="#CDECEAEJ">Flashback Table</a></p>
</td>
<td class="cellalignment2586" headers="r7c1-t34 r1c2-t34">
<p><a id="sthref811"></a>Flashback Table enables you to quickly recover a table to an earlier point in time without restoring a backup.</p>
</td>
<td class="cellalignment2586" headers="r7c1-t34 r1c3-t34">
<p>Physical and logical standby databases</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r8c1-t34" headers="r1c1-t34">
<p>Flashback Database</p>
</td>
<td class="cellalignment2586" headers="r8c1-t34 r1c2-t34">
<p><a id="sthref812"></a>Flashback Database enables you to quickly return the database to an earlier point in time by undoing all of the changes that have taken place since that time. This operation is fast because you do not have to restore the backups.</p>
</td>
<td class="cellalignment2586" headers="r8c1-t34 r1c3-t34">
<p>Physical and logical standby databases</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<p>Flashback Database uses the Oracle Database flashback logs, while all other features of flashback technology use the Oracle Database unique undo and multiversion read consistency capabilities. For more information, see the configuration best practices for the database, as documented in <a href="config_db.htm#BGBGJBFI">Section 4.1, &#34;Database Configuration High Availability and Fast Recoverability Best Practices&#34;</a> to configure Flashback technologies to ensure that the resources from these solutions are available at a time of failure.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADMIN01512" href="../ADMIN/tables.htm#ADMIN01512"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about Recovering Tables Using Oracle Flashback Table</p>
</li>
<li>
<p><a class="olink BRADV71000" href="../BRADV/flashdb.htm#BRADV71000"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for information about Using Flashback Database and Restore Points</p>
</li>
<li>
<p><a class="olink CNCPT1439" href="../CNCPT/cncptdba.htm#CNCPT1439"><span class="italic">Oracle Database Concepts</span></a> for information about Oracle Flashback Technology</p>
</li>
</ul>
</div>
<p>In general, the recovery time when using Flashback technologies is equivalent to the time it takes to cause the human error plus the time it takes to detect the human error.</p>
<p>Flashback technologies allow recovery up to the point that the human error occurred.</p>
<p>Use the following recovery methods:</p>
<ul>
<li>
<p><a href="#BABECBBE">Resolving Table Inconsistencies</a></p>
</li>
<li>
<p><a href="#BABJBCEG">Resolving Row and Transaction Inconsistencies</a></p>
</li>
<li>
<p><a href="#CDECIGII">Resolving Database-Wide Inconsistencies</a></p>
</li>
<li>
<p><a href="#CDEGDCDG">Resolving One or More Tablespace Inconsistencies</a></p>
</li>
</ul>
<a id="BABECBBE"></a>
<div id="HABPT5046" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.8.1</span> Resolving <a id="sthref813"></a>Table Inconsistencies</h4>
<p>Dropping or deleting <a id="sthref814"></a>database objects by accident is a common mistake. Users soon realize their mistake, but by then it is too late and there has been no way to easily recover the dropped tables and its indexes, constraints, and triggers. Objects once dropped were dropped forever. Loss of very important tables or other objects (like indexes, partitions or clusters) required DBAs to perform a point-in-time recovery, which can be time-consuming and lead to loss of recent transactions.</p>
<p>Oracle provides the following statements to help resolve table inconsistencies:</p>
<ul>
<li>
<p><code dir="ltr"><a href="#CDECEAEJ">Flashback Table</a></code> statement to restore a table to a previous point in the database</p>
</li>
<li>
<p><code dir="ltr"><a href="#CDECIAGJ">Flashback Drop</a></code> statement to recover from an accidental <code dir="ltr">DROP TABLE</code> statement</p>
</li>
<li>
<p><code dir="ltr"><a href="#CDEHEAJG">Flashback Transaction</a></code> statement to roll back one or more transactions and their dependent transactions, while the database remains online</p>
</li>
</ul>
<p class="subhead2"><a id="CDECEAEJ"></a><a id="HABPT5047"></a>Flashback Table</p>
<p><a id="sthref815"></a>Flashback Table provides the ability to quickly recover a table or a set of tables to a specified point in time. In many cases, Flashback Table alleviates the more complicated point-in-time recovery operations. For example:</p>
<pre dir="ltr">FLASHBACK TABLE orders, order_items 
      TO TIMESTAMP 
      TO_DATE(&#39;28-Jun-11 14.00.00&#39;,&#39;dd-Mon-yy hh24:mi:ss&#39;);
</pre>
<p>This statement rewinds any updates to the <code dir="ltr">ORDERS</code> and <code dir="ltr">ORDER_ITEMS</code> tables that have been done between the current time and a specified timestamp in the past. Flashback Table performs this operation online and in place, and it maintains referential integrity constraints between the tables.</p>
<p class="subhead2"><a id="CDECIAGJ"></a><a id="HABPT5048"></a>Flashback Drop</p>
<p><a id="sthref816"></a>Flashback Drop provides a safety net when dropping objects. When a user drops a table, Oracle places it in a <a id="sthref817"></a>recycle bin. Objects in the recycle bin remain there until the user decides to permanently remove them or until space limitations begin to occur on the tablespace containing the table. The recycle bin is a virtual container where all dropped objects reside. Users view the recycle bin and undrop the dropped table and its dependent objects. For example, the <code dir="ltr">employees</code> table and all its dependent objects would be undropped by the following statement:</p>
<pre dir="ltr">FLASHBACK TABLE employees TO BEFORE DROP;
</pre>
<p class="subhead2"><a id="CDEHEAJG"></a><a id="HABPT5049"></a>Flashback Transaction</p>
<p>Oracle Flashback Transaction increases availability during logical recovery by easily and quickly backing out a specific transaction or set of transactions and their dependent transactions, while the database remains online.</p>
<p>Use the <code dir="ltr"><a id="sthref818"></a><a id="sthref819"></a>DBMS_FLASHBACK.TRANSACTION_BACKOUT()</code> PL/SQL procedure to roll back a transaction and its dependent transactions. This procedure uses undo data to create and execute the compensating transactions that return the affected data to its pre-transaction state.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink ADFNS1010" href="../ADFNS/adfns_flashback.htm#ADFNS1010"><span class="italic">Oracle Database Advanced Application Developer&#39;s Guide</span></a> for information about Using Flashback Transaction</p>
</li>
<li>
<p><code dir="ltr">DBMS_FLASHBACK.TRANSACTION_BACKOUT()</code> in <a class="olink ARPLS142" href="../ARPLS/d_flashb.htm#ARPLS142"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" -->
<a id="BABJBCEG"></a>
<div id="HABPT5050" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.8.2</span> Resolving Row and Transaction Inconsistencie<a id="sthref820"></a>s</h4>
<p>Resolving <a id="sthref821"></a>row and transaction inconsistencies might require a combination of Flashback Query, Flashback Version Query, Flashback Transaction Query, and the compensating SQL statements constructed from undo statements to rectify the problem. This section describes a general approach using a human resources example to resolve row and transaction inconsistencies caused by erroneous or malicious user errors.</p>
<p class="subhead2"><a id="CDEGAIAH"></a><a id="HABPT5051"></a>Flashback Query</p>
<p><a id="sthref822"></a>Flashback Query enables an administrator or user to query any data from some earlier point in time. Use this feature to view and reconstruct data that might have been deleted or changed by accident.</p>
<p>Developers can use Flashback Query to build self-service error correction into their applications, empowering end users to undo and correct their errors without delay, and freeing database administrators from having to perform this task. Flashback Query is easy to manage because the database automatically keeps the necessary information to reconstruct data for a configurable time into the past.</p>
<p>The following partial statement displays rows from the <code dir="ltr">EMPLOYEES</code> table starting from 2:00 p.m. on June 28, 2011.</p>
<pre dir="ltr">SELECT * FROM EMPLOYEES 
       AS OF TIMESTAMP 
       TO_DATE(&#39;28-Jun-11 14:00&#39;,&#39;DD-Mon-YY HH24:MI&#39;)
WHERE ...
</pre>
<p class="subhead2"><a id="CDEECBDC"></a><a id="HABPT5052"></a>Flashback Version Query</p>
<p><a id="sthref823"></a>Flashback Version Query provides a way to view changes made to the database at the row level. Flashback Version Query is an extension to SQL and enables the retrieval of all the different versions of a row across a specified time interval. For example:</p>
<pre dir="ltr">SELECT * FROM EMPLOYEES
       VERSIONS BETWEEN TIMESTAMP
       TO_DATE(&#39;28-Jun-11 14:00&#39;,&#39;dd-Mon-YY hh24:mi&#39;) AND
       TO_DATE(&#39;28-Jun-11 15:00&#39;,&#39;dd-Mon-YY hh24:mi&#39;)
WHERE ...
</pre>
<p>This statement displays each version of the row, each entry changed by a different transaction, between 2 and 3 p.m. on June 28, 2011. A database administrator can use this to pinpoint when and how data is changed and trace it back to the user, application, or transaction. Flashback Version Query enables the database administrator to track down the source of a logical corruption in the database and correct it. It also enables application developers to debug their code.</p>
<p class="subhead2"><a id="CDEBHAJF"></a><a id="HABPT5053"></a>Flashback Transaction Query</p>
<p><a id="sthref824"></a>Flashback Transaction Query provides a way to view changes made to the database at the transaction level. Flashback Transaction Query is an extension to SQL that enables you to see all changes made by a transaction. For example:</p>
<pre dir="ltr">SELECT UNDO_SQL
FROM FLASHBACK_TRANSACTION_QUERY 
WHERE XID = &#39;000200030000002D&#39;;
</pre>
<p>This statement shows all of the changes that resulted from this transaction. In addition, compensating SQL statements are returned and can be used to undo changes made to all rows by this transaction. Using a precision tool like Flashback Transaction Query, the database administrator and application developer can precisely diagnose and correct logical problems in the database or application.</p>
<p>Consider a <a id="sthref825"></a>human resources (HR) example involving the <code dir="ltr">SCOTT</code> schema. The HR manager reports to the database administrator that there is a potential discrepancy in Ward&#39;s salary. Sometime before 9:00 a.m., Ward&#39;s salary was increased to $1875. The HR manager is uncertain how this occurred and wishes to know when the employee&#39;s salary was increased. In addition, he instructed his staff to reset the salary to the previous level of $1250. This was completed around 9:15 a.m.</p>
<p>The following steps show how to approach the problem.</p>
<ol>
<li>
<p>Assess the problem.</p>
<p>Fortunately, the HR manager has provided information about the time when the change occurred. You can query the information as it was at 9:00 a.m. using Flashback Query.</p>
<pre dir="ltr">    SELECT EMPNO, ENAME, SAL
    FROM EMP
    AS OF TIMESTAMP TO_DATE(&#39;28-JUN-11 09:00&#39;,&#39;dd-Mon-yy hh24:mi&#39;)
    WHERE ENAME = &#39;WARD&#39;;

         EMPNO ENAME             SAL
    ---------- ---------- ----------
          7521 WARD             1875
</pre>
<p>You can confirm that you have the correct employee by the fact that Ward&#39;s salary was $1875 at 09:00 a.m. Rather than using Ward&#39;s name, you can now use the employee number for subsequent investigation.</p>
</li>
<li>
<p>Query previous rows or versions of the data to acquire transaction information.</p>
<p>Although it is possible to restrict the row version information to a specific date or SCN range, you might want to query all the row information that is available for the employee WARD using Flashback Version Query.</p>
<pre dir="ltr">SELECT EMPNO, ENAME, SAL, VERSIONS_STARTTIME, VERSIONS_ENDTIME, VERSIONS_XID
    FROM EMP
    VERSIONS BETWEEN TIMESTAMP MINVALUE AND MAXVALUE
    WHERE EMPNO = 7521
    ORDER BY NVL(VERSIONS_STARTSCN,1);

EMPNO ENAME  SAL  VERSIONS_STARTTIME     VERSIONS_ENDTIME      VERSIONS_XID
----- ------ ---  ---------------------- -------------------- ---------------
 7521 WARD  1250  28-JUN-11 08.48.43 AM  28-JUN-11 08.54.49 AM 0006000800000086
 7521 WARD  1875  28-JUN-11 08.54.49 AM  28-JUN-11 09.10.09 AM 0009000500000089
 7521 WARD  1250  28-JUN-11 09.10.09 AM                        000800050000008B
</pre>
<p>You can see that WARD&#39;s salary was increased from $1250 to $1875 at 08:54:49 the same morning and was subsequently reset to $1250 at approximately 09:10:09.</p>
<p>Also, you can see that the ID of the erroneous transaction that increased WARD&#39;s salary to $1875 was &#34;0009000500000089&#34;.</p>
</li>
<li>
<p>Query the erroneous transaction and the scope of its effect.</p>
<p>With the transaction information (<code dir="ltr">VERSIONS_XID</code> pseudocolumn), you can now query the database to determine the scope of the transaction, using Flashback Transaction Query.</p>
<pre dir="ltr">    SELECT UNDO_SQL
    FROM FLASHBACK_TRANSACTION_QUERY
    WHERE XID = HEXTORAW(&#39;0009000500000089&#39;);

    UNDO_SQL                                                                    
    ----------------------------------------------------------------------------
    update &#34;SCOTT&#34;.&#34;EMP&#34; set &#34;SAL&#34; = &#39;950&#39; where ROWID = &#39;AAACV4AAFAAAAKtAAL&#39;;      
    update &#34;SCOTT&#34;.&#34;EMP&#34; set &#34;SAL&#34; = &#39;1500&#39; where ROWID = &#39;AAACV4AAFAAAAKtAAJ&#39;;     
    update &#34;SCOTT&#34;.&#34;EMP&#34; set &#34;SAL&#34; = &#39;2850&#39; where ROWID = &#39;AAACV4AAFAAAAKtAAF&#39;;      
    update &#34;SCOTT&#34;.&#34;EMP&#34; set &#34;SAL&#34; = &#39;1250&#39; where ROWID = &#39;AAACV4AAFAAAAKtAAE&#39;;    
    update &#34;SCOTT&#34;.&#34;EMP&#34; set &#34;SAL&#34; = &#39;1600&#39; where ROWID = &#39;AAACV4AAFAAAAKtAAB&#39;;     
                                                                                
    6 rows selected.
</pre>
<p>You can see that WARD&#39;s salary was not the only change that occurred in the transaction. Now you can send the information that was changed for the other four employees at the same time as employee WARD, back to the HR manager for review.</p>
</li>
<li>
<p>Determine if the corrective statements should be executed.</p>
<p>If the HR manager decides that the corrective changes suggested by the <code dir="ltr">UNDO_SQL</code> column are correct, then the database administrator can execute the statements individually.</p>
</li>
<li>
<p>Query the <code dir="ltr">FLASHBACK_TRANSACTION_QUERY</code> view for additional transaction information. For example, to determine the user that performed the erroneous update, issue the following query:</p>
<pre dir="ltr">SELECT LOGON_USER FROM FLASHBACK_TRANSACTION_QUERY
WHERE XID = HEXTORAW(&#39;0009000500000089&#39;);

LOGON_USER
----------------------------
MSMITH
</pre>
<p>In this example, the query shows that the user MSMITH was responsible for the erroneous transaction.</p>
</li>
</ol>
</div>
<!-- class="sect3" -->
<a id="CDECIGII"></a>
<div id="HABPT5054" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.8.3</span> Resolving Database-Wide Inconsistencies<a id="sthref826"></a><a id="sthref827"></a></h4>
<p>To bring an Oracle database to a previous point in time, the traditional method is point-in-time recovery. However, point-in-time recovery can take hours or even days, because it requires the whole database to be restored from backup and recovered to the point in time just before the error was introduced into the database. With the size of databases constantly growing, it takes hours or even days just to restore the whole database.</p>
<p><a id="sthref828"></a>Flashback Database is a strategy for doing point-in-time recovery. Flashback Database quickly rewinds an Oracle database to a previous time to correct any problems caused by logical data corruption or user error. Flashback logs are used to capture old versions of changed blocks. When recovery must be performed the flashback logs are quickly replayed to restore the database to a point in time before the error and just the changed blocks are restored. Flashback Database is extremely fast and reduces recovery time from hours to minutes. In addition, it is easy to use. A database can be recovered to 2:05 p.m. by issuing a single statement. Before the database can be recovered, all instances of the database must be shut down and one instance subsequently mounted. The following is an example of a <code dir="ltr">FLASHBACK DATABASE</code> statement.</p>
<pre dir="ltr">FLASHBACK DATABASE TO TIMESTAMP SYSDATE-1;
</pre>
<p>No restoration from tape, no lengthy downtime, and no complicated recovery procedures are required to use it. You can also use Flashback Database and then open the database in read-only mode and examine its contents. If you determine that you flashed back too far or not far enough, then you can reissue the <code dir="ltr">FLASHBACK DATABASE</code> statement or continue recovery to a later time to find the proper point in time before the database was damaged. Flashback Database works with a primary database, a physical standby database, or a logical standby database.</p>
<p>These steps are recommended for using Flashback Database:</p>
<ol>
<li>
<p>Determine the time or the SCN to which to flash back the database.</p>
</li>
<li>
<p>Verify that there is sufficient flashback log information.</p>
<pre dir="ltr">     SELECT OLDEST_FLASHBACK_SCN, 
       TO_CHAR(OLDEST_FLASHBACK_TIME, &#39;mon-dd-yyyy HH:MI:SS&#39;) 
       FROM V$FLASHBACK_DATABASE_LOG;
</pre></li>
<li>
<p>Flash back the database to a specific time or SCN. (The database must be mounted to perform a Flashback Database.)</p>
<pre dir="ltr">FLASHBACK DATABASE TO SCN <span class="italic">scn;</span>
</pre>
<p>or</p>
<pre dir="ltr">FLASHBACK DATABASE TO TIMESTAMP TO_DATE <span class="italic">date</span>;
</pre></li>
<li>
<p>Open the database in read-only mode to verify that it is in the correct state.</p>
<pre dir="ltr">ALTER DATABASE OPEN READ ONLY;
</pre>
<p>If more flashback data is required, then issue another <code dir="ltr">FLASHBACK DATABASE</code> statement. (The database must be mounted to perform a Flashback Database.)</p>
<p>If you want to move forward in time, then issue a statement similar to the following:</p>
<pre dir="ltr">RECOVER DATABASE UNTIL [TIME <span class="italic">date</span> | CHANGE <span class="italic">scn</span>];
</pre></li>
<li>
<p>Open the database:</p>
<pre dir="ltr">ALTER DATABASE OPEN RESETLOGS;
</pre></li>
</ol>
<p>Other considerations when using Flashback Database are as follows:</p>
<ul>
<li>
<p>If there are not sufficient flashback logs to flash back to the target time, then use an alternative:</p>
<ul>
<li>
<p>Use Data Guard to recover to the target time if the standby database lags behind the primary database or flash back to the target time if there&#39;s sufficient flashback logs on the standby.</p>
</li>
<li>
<p>Restore from backups.</p>
</li>
</ul>
</li>
<li>
<p>After flashing back a database, any dependent database such as a standby database must be flashed back. See <a href="#CACJGHCF">Section 12.3, &#34;Restoring Fault Tolerance&#34;</a>.</p>
</li>
</ul>
<p>Flashback <a id="sthref829"></a>Database does not automatically fix a dropped tablespace, you can use Flashback Database to significantly reduce the downtime. You can flash back the primary database to a point before the tablespace was dropped and then restore a backup of the corresponding data files using <code dir="ltr">SET NEWNAME</code> from the affected tablespace and recover to a time before the tablespace was dropped.</p>
</div>
<!-- class="sect3" -->
<a id="CDEGDCDG"></a>
<div id="HABPT5055" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.2.8.4</span> Resolving One or More Tablespace Inconsistencie<a id="sthref830"></a><a id="sthref831"></a>s</h4>
<p>Recovery Manager (RMAN) automatic tablespace point-in-time recovery (TSPITR)<a id="sthref832"></a><a id="sthref833"></a><a id="sthref834"></a><a id="sthref835"></a> enables you to quickly recover one or more tablespaces in a database to an earlier time without affecting the rest of the tablespaces and objects in the database. You can only use TSPITR on tablespaces whose data is completely segregated from the rest of the database. This usually means that TSPITR is something for which you must plan in advance.</p>
<p>RMAN TSPITR is most useful for the following situations:</p>
<ul>
<li>
<p>To recover a logical database to a point different from the rest of the physical database, when multiple logical databases exist in separate tablespaces of one physical database. For example, you maintain logical databases in the Orders and Personnel tablespaces. An incorrect batch job or DML statement corrupts the data in only one tablespace.</p>
</li>
<li>
<p>To recover data lost after DDL operations that change the structure of tables. You cannot use Flashback Table to rewind a table to before the point of a structural change such as a truncate table operation.</p>
</li>
<li>
<p>To recover a table after it has been dropped with the <code dir="ltr">PURGE</code> option.</p>
</li>
<li>
<p>To recover from the logical corruption of a table.</p>
</li>
</ul>
<p>You perform TSPITR by using the RMAN <code dir="ltr">RECOVER TABLESPACE</code> command.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink BRADV009" href="../BRADV/rcmtspit.htm#BRADV009"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for detailed information about performing RMAN TSPITR</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CDEDIGHC"></a>
<div id="HABPT5056" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.2.9</span> Recovering Databases in a Distributed Environmen<a id="sthref836"></a><a id="sthref837"></a>t</h3>
<p>Some applications may update multiple databases and participate in distributed transactions. Global consistency between the participating databases may be expected and crucial to the application.</p>
<p>If one database in a distributed database environment requires recovery to an earlier time, it is often necessary to recover all other databases in the configuration to the same point in time when global data consistency is required by the application.</p>
<p>To achieve <a id="sthref838"></a><a id="sthref839"></a>coordinated, time-based, distributed database recovery:</p>
<ol>
<li>
<p>Recover the database that requires the recovery operation using time-based recovery.</p>
<p>For example, if a database must be recovered because of a media failure, then recover this database first using time-based recovery. Do not recover the other databases at this point.</p>
</li>
<li id="CDEDDHIG">
<p>After you have recovered the database and opened it with the <code dir="ltr">RESETLOGS</code> option, search the <code dir="ltr">alert_SID.log</code> of the database for the <code dir="ltr">RESETLOGS</code> message. Your next step depends on the message that you find in the log file, as described in following table:</p>
<div class="inftblruleinformal">
<table class="cellalignment2589" title="Messages Returned After Recovering a Distributed Database" summary="This table describes messages that are returned after you have recovered a distributed database. Your subsequent action is dependent on which of the two messages is returned." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t38">If the message returned is ...</th>
<th class="cellalignment2590" id="r1c2-t38">Then ...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t38" headers="r1c1-t38">&#34;<code dir="ltr">RESETLOGS</code> after complete recovery through change <span class="italic">nnn</span>&#34;</td>
<td class="cellalignment2586" headers="r2c1-t38 r1c2-t38">Recovery is complete. You have applied all the changes in the database and performed complete recovery. Do not recover any of the other databases in the distributed system because this unnecessarily removes database changes.</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t38" headers="r1c1-t38">&#34;<code dir="ltr">RESETLOGS</code> after incomplete recovery <code dir="ltr">UNTIL CHANGE</code> <code dir="ltr"><span class="codeinlineitalic">nnn</span></code>&#34;</td>
<td class="cellalignment2586" headers="r3c1-t38 r1c2-t38">You have successfully performed an incomplete recovery. Record the change number from the message and proceed to the next step.</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="inftblruleinformal" --></li>
<li>
<p>Recover or flash back all other databases in the distributed database system using change-based recovery, specifying the change number (SCN) that you recorded in Step <a href="#CDEDDHIG">2</a><a id="sthref840"></a>.</p>
</li>
</ol>
<div class="infobox-note">
<p class="notep1">Note:</p>
If a database that is participating in distributed transactions fails, in-doubt distributed transactions may exist in the participating databases. If the failed database recovers completely and communications resume between the databases, then the in-doubt transactions is automatically resolved by the Oracle recoverer process (RECO) process. If you cannot wait until the failed database becomes available, you can also manually commit or rollback in-doubt transactions.</div>
<p>Oracle Site Guard orchestrates and automates the coordinated failover of Oracle Fusion Middleware, Oracle Fusion Applications, and Oracle Databases. It is also extensible to include other data center software components. Oracle Site Guard integrates with underlying replication mechanisms that synchronize primary and standby environments and protect mission critical data. It comes with a built-in support for Oracle Data Guard for Oracle database, and Oracle Sun ZFS. Oracle Site Guard can also support other storage replication technologies.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink BRADV90035" href="../BRADV/osrecvry.htm#BRADV90035"><span class="italic">Oracle Database Backup and Recovery User&#39;s Guide</span></a> for more information about performing time-based recovery</p>
</li>
<li>
<p><a class="olink ADMIN12233" href="../ADMIN/ds_txns.htm#ADMIN12233"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about how to handle in-doubt transactions and about recovery from distributed transaction failures</p>
</li>
<li>
<p><a class="olink GUARD107" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=GUARD107"><span class="italic">Oracle Enterprise Manager Oracle Site Guard Administrator&#39;s Guide</span></a></p>
</li>
<li>
<p>For an additional methodology for recovering multiple Oracle databases to a consistent state with local and distributed database transactions, see My Oracle Support Note 1096993.1. The participating databases may be involved in distributed or remote transactions or can be completely independent but are required to be &#34;synchronized&#34; for application consistency. Siebel, Peoplesoft, SAP, and other custom applications that include multiple databases are real world examples that may require global consistency across multiple databases. For more information, see &#34;Recovery for Global Consistency in an Oracle Distributed Database Environment &#34;, in My Oracle Support Note 1096993.1 at</p>
<p><code dir="ltr"><a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1096993.1">https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1096993.1</a></code></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="CACJGHCF"></a>
<div id="HABPT00406" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1"><span class="secnum">12.3</span> Restoring Fault Tolerance<a id="ABC3588592"></a></h2>
<p>Whenever a component in a high availability architecture fails, the full protection, or fault tolerance, of the architecture is compromised and possible single points of failure exist until the component is repaired. Restoring the high availability architecture to full fault tolerance to reestablish full Oracle RAC, Data Guard, or MAA protection requires repairing the failed component. While full fault tolerance might be sacrificed during planned downtime, the method of repair is well understood because it is planned, the risk is controlled, and it ideally occurs at times best suited for continued application availability. However, for unplanned downtime the risk of exposure to a single point of failure must be clearly understood.</p>
<p>This section provides the following topics that describe the steps needed to restore database fault tolerance:</p>
<ul>
<li>
<p>For Oracle Database 11<span class="italic">g</span> with Oracle RAC or Oracle RAC One Node</p>
<ul>
<li>
<p><a href="#i1006353">Restoring Failed Nodes or Instances in Oracle RAC and Oracle RAC One Node</a></p>
</li>
</ul>
</li>
<li>
<p>For Oracle Database 11<span class="italic">g</span> with Data Guard and Oracle Database 11<span class="italic">g</span> with Oracle RAC and Data Guard - MAA</p>
<ul>
<li>
<p><a href="#BABHHEEE">Restoring a Standby Database After a Failover</a></p>
</li>
<li>
<p><a href="#BABFIIFF">Restoring Oracle ASM Disk Groups after a Failure</a></p>
</li>
<li>
<p><a href="#BABHJEJB">Restoring Fault Tolerance After Planned Downtime on Secondary Site or Cluster</a></p>
</li>
<li>
<p><a href="#CDECFHID">Restoring Fault Tolerance After a Standby Database Data Failure</a></p>
</li>
<li>
<p><a href="#BABCFGHE">Restoring Fault Tolerance After the Primary Database Was Opened Resetlogs</a></p>
</li>
<li>
<p><a href="#i1006378">Restoring Fault Tolerance After Dual Failures</a></p>
</li>
</ul>
</li>
</ul>
<a id="i1006353"></a>
<div id="HABPT04406" class="sect2">
<h3 class="sect2"><span class="secnum">12.3.1</span> Restoring Failed Nodes or Instances in Oracle RAC and Oracle RAC One Node</h3>
<p>Ensuring that <a id="sthref841"></a><a id="sthref842"></a><a id="sthref843"></a>application services fail over quickly and automatically in an Oracle RAC cluster&mdash;or between primary and secondary sites&mdash;is important when planning for both scheduled and unscheduled outages. Similarly, using Oracle RAC One Node you must ensure that applications failover to the new instance that starts if an Oracle RAC One Node instance fails. To ensure that the environment is restored to full fault tolerance after any errors or issues are corrected, it is also important to understand the steps and processes for restoring failed instances or nodes within an Oracle RAC cluster or databases between sites.</p>
<p>Adding a failed node back into the cluster or restarting a failed Oracle RAC instance or Oracle RAC One Node instance is easily done after the core problem that caused the specific component to originally fail has been corrected. However, you should also consider:</p>
<ul>
<li>
<p>When to perform these tasks to incur minimal or no effect on the current running environment</p>
</li>
<li>
<p>Failing back or rebalancing existing connections</p>
</li>
</ul>
<p>After the problem that caused the initial node or instance failure has been corrected, a node or instance can be restarted and added back into the Oracle RAC environment at any time. For an Oracle RAC One Node, you can also restart a failed instance and go back to running the instance on the original node. Processing to complete the reconfiguration of a node may require additional system resources.</p>
<p><a href="#g1009540">Table 12-8</a> summarizes additional processing that may be required when adding a node.</p>
<div id="HABPT5057" class="tblruleformalwide">
<p class="titleintable"><a id="sthref844"></a><a id="g1009540"></a>Table 12-8 Additional Processing When Restarting or Rejoining a Node or Instance</p>
<table class="cellalignment2589" title="Additional Processing When Restarting or Rejoining a Node or Instance " summary="This table summarizes the performance impact of rejstarting or rejoining a node or instance after a failure of the node or instance." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t41">Action</th>
<th class="cellalignment2590" id="r1c2-t41">Additional Resources</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t41" headers="r1c1-t41">
<p>Restarting a node or rejoining a node into a cluster</p>
</td>
<td class="cellalignment2586" headers="r2c1-t41 r1c2-t41">
<p>When using only Oracle Clusterware, there is no impact when a node joins the cluster.</p>
<p>When using vendor clusterware, there may be performance degradation while reconfiguration occurs to add a node back into the cluster. The impact on current applications should be evaluated with a full test workload.</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t41" headers="r1c1-t41">
<p>Restarting or rejoining of an Oracle RAC instance</p>
</td>
<td class="cellalignment2586" headers="r3c1-t41 r1c2-t41">
<p>When you restart an Oracle RAC instance, there might be some potential performance impact while lock reconfiguration takes place. The impact on current applications is usually minimal, but it should be evaluated with a full test workload.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<p>Use the following recovery methods:</p>
<ul>
<li>
<p><a href="#BABDJFDE">Recovering Service Availability for Oracle RAC</a></p>
</li>
<li>
<p><a href="#BABJBHAI">Recovering Service Availability for Oracle RAC One Node</a></p>
</li>
<li>
<p><a href="#BABFAGAA">Considerations for Client Connections After Restoring an Oracle RAC Instance</a></p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink RACAD" href="../RACAD/toc.htm"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about restarting an Oracle RAC instance</p>
</li>
<li>
<p>Your vendor-specified cluster management documentation for detailed steps on how to start and join a node back into a cluster</p>
</li>
</ul>
</div>
<a id="BABDJFDE"></a>
<div id="HABPT5058" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.3.1.1</span> <a id="sthref845"></a>Recovering Service Availability for Oracle RAC</h4>
<div class="infobox-note">
<p class="notep1">Note:</p>
These descriptions for recovering service availability are for Oracle RAC and do not apply for Oracle RAC One Node systems.</div>
<p>After a <a id="sthref846"></a><a id="sthref847"></a>failed node has been brought back into the cluster and its instance has been started, <a id="sthref848"></a>Cluster Ready Services (CRS) automatically manages the <a id="sthref849"></a>virtual IP address used for the node and the services supported by that instance automatically. A particular service might or might not be started for the restored instance. The decision by CRS to start a service on the restored instance depends on how the service is configured and whether the proper number of instances are currently providing access for the service. A service is not relocated back to a preferred instance if the service is still being provided by an available instance to which it was moved by CRS when the initial failure occurred.</p>
<p>CRS restarts services on the restored instance if the number of instances that are providing access to a service across the cluster is less than the number of preferred instances defined for the service. After CRS restarts a service on a restored instance, CRS notifies registered applications of the service change.</p>
<p><a id="sthref850"></a><a id="sthref851"></a>For example, suppose the HR service is defined with instances A and B as preferred and instances C and D as available in case of a failure. If instance B fails and CRS starts the HR service on C automatically, then when instance B is restarted, the HR service remains at instance C. CRS does not automatically relocate a service back to a preferred instance.</p>
<p>Suppose a different scenario in which the HR service is defined with instances A, B, C, and D as preferred and no instances defined as available, spreading the service across all nodes in the cluster. If instance B fails, then the HR service remains available on the remaining three nodes. CRS automatically starts the HR service on instance B when it rejoins the cluster because it is running on fewer instances than configured. CRS notifies the applications that the HR service is again available on instance B.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RACAD" href="../RACAD/toc.htm"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a></div>
</div>
<!-- class="sect3" -->
<a id="BABJBHAI"></a>
<div id="HABPT5354" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.3.1.2</span> Recovering Service Availability for Oracle RAC One Node</h4>
<p>Oracle RAC One Node databases are administered slightly differently from Oracle RAC or single-instance databases. For administrator-managed Oracle RAC One Node databases, you must monitor the candidate node list and make sure a server is always available for failover, if possible. Candidate servers reside in the Generic server pool and the database and its services will fail over to one of those servers.</p>
<p>For policy-managed Oracle RAC One Node databases, you must ensure that the server pools are configured such that a server will be available for the database to fail over to in case its current node becomes unavailable. Also, for policy-managed Oracle RAC One Node databases, the destination node for online database relocation must be located in the database&#39;s server pool.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink RACAD7894" href="../RACAD/GUID-C493B4A3-D5C9-48A2-B83A-500D44BD8D2B.htm#RACAD7894"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for information about Administering Oracle RAC One Node</div>
</div>
<!-- class="sect3" -->
<a id="BABFAGAA"></a>
<div id="HABPT5059" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.3.1.3</span> Considerations for Client Connections After Restoring an Oracle RAC Instance</h4>
<p>After an Oracle RAC <a id="sthref852"></a>instance has been restored, additional steps might be required, depending on the current resource usage and system performance, the application configuration, and the network load balancing that has been implemented.</p>
<p>Existing connections, that might have failed over or started as a new session, on the surviving Oracle RAC instances are not automatically redistributed or failed back to an instance that has been restarted. Failing back or redistributing users might or might not be necessary, depending on the current resource utilization and the capability of the surviving instances to adequately handle and provide acceptable response times for the workload. If the surviving Oracle RAC instances do not have adequate resources to run a full workload or to provide acceptable response times, then it might be necessary to move (disconnect and reconnect) some existing user connections to the restarted instance.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
In Oracle RAC One Node there is only one instance for a database (unless you are migrating). Thus an Oracle RAC One Node configuration does not require you to rethink the strategy for &#39;rebalancing&#39; the connections as there is only one. Clients using Oracle RAC One Node must be able to work with FAN and other client and service facilities to be informed about the status of services.</div>
<p>Connections are started as they are needed, on the least-used node, assuming connection load balancing has been configured. Therefore, the connections are automatically load-balanced over time.</p>
<p>An application service can be:</p>
<ul>
<li>
<p>Managed with services running on a subset of Oracle RAC instances</p>
</li>
<li>
<p>Nonpartitioned so that all services run equally across all nodes</p>
</li>
</ul>
<p>This is valuable for modularizing application and database form and function while still maintaining a consolidated data set. For cases where an application is partitioned or has a combination of partitioning and nonpartitioning, you should consider the response time and availability aspects for each service.</p>
<p>If redistribution or failback of connections for a particular service is required, then you can rebalance workloads automatically using Oracle Universal Connection Pool (UCP). If you are using UCP, then connections are automatically redistributed to the new node.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Oracle Universal Connection Pool (UCP) provides fast and automatic detection of connection failures and removes terminated connections for any Java application using, Fast Connection Failover, and FAN events</div>
<p>For <a id="sthref853"></a>load-balancing application services across multiple Oracle RAC instances, Oracle Net <a id="sthref854"></a>connect-time failover and connection load balancing are recommended. This feature does not require changes or modifications for failover or restoration. It is also possible to use hardware-based load balancers. However, there might be limitations in distinguishing separate application services (which is understood by Oracle Net Services) and restoring an instance or a node. For example, when a node or instance is restored and available to start receiving connections, a manual step might be required to include the restored node or instance in the hardware-based load balancer logic, whereas Oracle Net Services does not require manual reconfiguration.</p>
<p><a href="#CFHIAIDG">Table 12-9</a> summarizes the considerations for new and existing connections after an instance has been restored. The considerations differ depending on whether the application services are partitioned, nonpartitioned, or are a combination of both. The actual redistribution of existing connections might or might not be required depending on the resource utilization and response times.</p>
<div id="HABPT5060" class="tblruleformalwide">
<p class="titleintable"><a id="sthref855"></a><a id="CFHIAIDG"></a>Table 12-9 Restoration and Connection Failback</p>
<table class="cellalignment2589" title="Restoration and Connection Failback " summary="This table summarizes the considerations for new and existing connections after an instance has been restored." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t48">Application Services</th>
<th class="cellalignment2590" id="r1c2-t48">Failback or Restore Existing Connections</th>
<th class="cellalignment2590" id="r1c3-t48">Failback or Restore New Connections</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t48" headers="r1c1-t48">
<p>Partitioned</p>
</td>
<td class="cellalignment2586" headers="r2c1-t48 r1c2-t48">
<p>Existing sessions are not automatically relocated back to the restored instance. Use the <code dir="ltr">SRVCTL</code> utility to manually start, stop, and relocate services. See <a class="olink RACAD849" href="../RACAD/GUID-2678C005-1B70-4B88-90E0-174A324F7DAA.htm#RACAD849"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> &#34;Administering Services&#34; for more information.</p>
</td>
<td class="cellalignment2586" headers="r2c1-t48 r1c3-t48">
<p>Automatically routes to the restored instance by using the Oracle Net Services configuration.</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t48" headers="r1c1-t48">
<p>Nonpartitioned</p>
</td>
<td class="cellalignment2586" headers="r3c1-t48 r1c2-t48">
<p>No action is necessary unless the load must be rebalanced, because restoring the instance means that the load there is low. If the load must be rebalanced, then the same problems are encountered as if application services were partitioned.</p>
</td>
<td class="cellalignment2586" headers="r3c1-t48 r1c3-t48">
<p>Automatically routes to the restored instance (because its load should be lowest) by using the Oracle Net Services configuration</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<p><a href="#i1006591">Figure 12-7</a> shows a two-node partitioned Oracle RAC database. Each instance services a different portion of the application (HR and Sales). Client processes connect to the appropriate instance based on the service they require.</p>
<div id="HABPT5061" class="figure">
<p class="titleinfigure"><a id="i1006591"></a>Figure 12-7 Partitioned Two-Node Oracle RAC Database</p>
<img width="314" height="468" src="img/habpt006.gif" alt="Description of Figure 12-7 follows"/><br/>
<a id="sthref856" href="img_text/habpt006.htm">Description of &#34;Figure 12-7 Partitioned Two-Node Oracle RAC Database&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p><a href="#i1006600">Figure 12-8</a> shows what happens when one Oracle RAC instance fails.</p>
<div id="HABPT5062" class="figure">
<p class="titleinfigure"><a id="i1006600"></a>Figure 12-8 Oracle RAC Instance Failover in a Partitioned Database</p>
<img width="321" height="492" src="img/habpt007.gif" alt="Description of Figure 12-8 follows"/><br/>
<a id="sthref857" href="img_text/habpt007.htm">Description of &#34;Figure 12-8 Oracle RAC Instance Failover in a Partitioned Database&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>If one Oracle RAC instance fails, then the service and existing client connections can be automatically failed over to another Oracle RAC instance. In this example, the HR and Sales services are both supported by the remaining Oracle RAC instance. In addition, you can route new client connections for the Sales service to the instance now supporting this service.</p>
<p>After the failed instance has been repaired and restored to the state shown in <a href="#i1006591">Figure 12-7</a> and the Sales service is relocated to the restored instance, then you might need to identify and failback any failed-over clients and any new clients that had connected to the Sales service on the failed-over instance. Client connections that started after the instance has been restored should automatically connect back to the original instance. Therefore, over time, as older connections disconnect, and new sessions connect to the Sales service, the client load migrates back to the restored instance. Rebalancing the load immediately after restoration depends on the resource utilization and application response times.</p>
<p><a href="#i1006637">Figure 12-9</a> shows a nonpartitioned application. Services are evenly distributed across both active instances. Each instance has a mix of client connections for both HR and Sales.</p>
<div id="HABPT5063" class="figure">
<p class="titleinfigure"><a id="i1006637"></a>Figure 12-9 Nonpartitioned Oracle RAC Instances</p>
<img width="347" height="498" src="img/habpt008.gif" alt="Description of Figure 12-9 follows"/><br/>
<a id="sthref858" href="img_text/habpt008.htm">Description of &#34;Figure 12-9 Nonpartitioned Oracle RAC Instances&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>If one Oracle RAC instance fails, then Oracle Clusterware moves the services that were running on the failed instance. If one Oracle RAC instance fails, new client connections are only accepted on the remaining instances that offers that service.</p>
<p>After the failed instance has been repaired and restored to the state shown in <a href="#i1006637">Figure 12-9</a>, some clients might have to be moved back to the restored instance. For nonpartitioned applications, identifying appropriate services is not required for rebalancing the client load among all available instances. Also, this is necessary only if a single-instance database is not able to adequately service the requests.</p>
<p>Client connections that started after the instance has been restored should automatically connect back to the restored instance because it has a smaller load. Therefore, over time, as older connections disconnect and new sessions connect to the restored instance, the client load evenly balances again across all available Oracle RAC instances. Rebalancing the load immediately after restoration depends on the resource usage and application response times.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABHHEEE"></a>
<div id="HABPT5064" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.3.2</span> Restoring a Standby Database After a Failover<a id="sthref859"></a><a id="sthref860"></a></h3>
<p>Following unplanned downtime on a <a id="sthref861"></a>primary database that requires a failover, full fault tolerance is compromised until the standby database is reestablished. Full database protection should be restored as soon as possible. The steps for restoring fault tolerance differ slightly between physical and logical standby databases.</p>
<p>Reinstating databases is automated if you are using Data Guard fast-start failover. After a fast-start failover completes, the observer automatically attempts to <span class="italic">reinstate</span> the original primary database as a standby database. <span class="bold">R<a id="sthref862"></a><a id="sthref863"></a><a id="sthref864"></a>einstatement</span> restores high availability to the broker configuration so that, if the new primary database fails, another fast-start failover can occur. The reinstated database can act as the fast-start failover target for the primary database, making a subsequent fast-start failover possible. The standby database is a viable target of a failover when it begins applying redo data received from the new primary database. If you want to prevent automatic reinstatement (for example, to perform diagnostic or repair work after failover has completed), set the <a id="sthref865"></a><a id="sthref866"></a><code dir="ltr">FastStartFailoverAutoReinstate</code> configuration property to <code dir="ltr">FALSE</code>.</p>
<p>The <code dir="ltr">FastStartFailoverAutoReinstate</code> configuration property controls whether the observer should automatically reinstate the original primary after a fast-start failover occurred because a fast-start failover was initiated due to the primary database being isolated for longer than the number of seconds specified by the <code dir="ltr">FastStartFailoverThreshold</code> property. In some cases, an automatic reinstatement might not be wanted until further diagnostic or recovery work is done.</p>
<p>To reinstate the original primary database, the database must be started and mounted, but it cannot be opened. The broker reinstates the database as a standby database of the same type (physical or logical) as the original standby database.</p>
<p>If the original primary database cannot be reinstated automatically, you can manually reinstate it using either the DGMGRL <code dir="ltr">REINSTATE</code> command or Enterprise Manager. Step-by-step instructions for manual reinstatement are described in <a class="olink DGBKR395" href="../DGBKR/sofo.htm#DGBKR395"><span class="italic">Oracle Data Guard Broker</span></a>.</p>
<p>Standby databases do not have to be re-created if you use the <a id="sthref867"></a>Oracle Flashback Database feature. Flashback Database has the following advantages:</p>
<ul>
<li>
<p>Saves hours of database restoration time</p>
</li>
<li>
<p>Reduces overall complexity in restoring fault tolerance</p>
</li>
<li>
<p>Reduces the time that the system is vulnerable because the standby database is re-created more quickly</p>
</li>
</ul>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink SBYDB4888" href="../SBYDB/scenarios.htm#SBYDB4888"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about Flashing Back a Failed Primary Database into a Physical Standby Database</p>
</li>
<li>
<p><a class="olink SBYDB4889" href="../SBYDB/scenarios.htm#SBYDB4889"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about Flashing Back a Failed Primary Database into a Logical Standby Database</p>
</li>
</ul>
</div>
<p>This section includes the following topics:</p>
<ul>
<li>
<p><a href="#CDEGCCAJ">Reinstating the Original Primary Database After a Fast-Start Failover</a></p>
</li>
<li>
<p><a href="#CDEGBBDG">Reinstating a Standby Database Using Enterprise Manager After a Failover</a></p>
</li>
</ul>
<a id="CDEGCCAJ"></a>
<div id="HABPT5065" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.3.2.1</span> Reinstating the Original Primary Database After a Fast-Start Failover<a id="sthref868"></a></h4>
<p>Following a fast-start failover, the observer periodically attempts to reconnect to the original primary database. When the observer regains network access to the original primary database, it initiates a request for the broker to automatically reinstate it as a standby database to the new primary. This quickly restores disaster protection and high availability for the configuration.</p>
<p>You can enable fast-start failover from any site, including the observer site, in Enterprise Manager while connected to any database in the broker configuration. The broker simplifies switchovers and failovers by allowing you to invoke them using a single key click in Oracle Enterprise Manager.</p>
</div>
<!-- class="sect3" -->
<a id="CDEGBBDG"></a>
<div id="HABPT5067" class="sect3"><!-- infolevel="all" infotype="General" -->
<h4 class="sect3"><span class="secnum">12.3.2.2</span> Reinstating a Standby Database Using Enterprise Manager After a Failover</h4>
<p>Furthermore, you can use Enterprise Manager to reinstate the original primary as the new standby. <a href="#BABHAGGD">Figure 12-10</a> shows an example of the warning message that shows in Enterprise Manager when a reinstatement is needed.</p>
<div id="HABPT5342" class="figure">
<p class="titleinfigure"><a id="BABHAGGD"></a>Figure 12-10 Reinstating the Original Primary Database After a Fast-Start Failover</p>
<img width="1118" height="673" src="img/habpt_dg_reinstate_p.png" alt="Description of Figure 12-10 follows"/><br/>
<a id="sthref869" href="img_text/habpt_dg_reinstate_p.htm">Description of &#34;Figure 12-10 Reinstating the Original Primary Database After a Fast-Start Failover&#34;</a><br/>
<br/></div>
<!-- class="figure" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="BABFIIFF"></a>
<div id="HABPT5069" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.3.3</span> Restoring Oracle ASM Disk Groups after a Failure</h3>
<p>Follow the steps in <a href="#BABEHFGH">Section 12.2.6.3, &#34;Data Area Disk Group Failure&#34;</a> or <a href="#BABJJHEE">Section 12.2.6.4, &#34;Fast Recovery Area Disk Group Failure&#34;</a>.</p>
</div>
<!-- class="sect2" -->
<a id="BABHJEJB"></a>
<div id="HABPT5070" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.3.4</span> Restoring Fault Tolerance After Planned Downtime on Secondary Site or Cluster</h3>
<p>After performing the planned maintenance on the secondary site, the standby database and log apply services must be restarted, and then the Data Guard redo transport services automatically catch up the standby database with the primary database. You can use Enterprise Manager and the broker to monitor the Data Guard state.</p>
<p>The following steps are required to restore full <a id="sthref870"></a><a id="sthref871"></a>fault tolerance after planned downtime on a secondary site or clusterwide outage:</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
The following steps can be accomplished manually (as described below) or automatically using Enterprise Manager.</div>
<ol>
<li>
<p>Start the standby database</p>
<p>You might have to restore the standby database from local backups, local tape backups, or from the primary site backups if the data in the secondary site has been damaged. Re-create the standby database from the new primary database by following the steps for creating a standby database in <a class="olink SBYDB00200" href="../SBYDB/create_ps.htm#SBYDB00200"><span class="italic">Oracle Data Guard Concepts and Administration</span></a>.</p>
<p>After the standby database has been reestablished, start the standby database.</p>
<div id="HABPT5071" class="tblruleformal">
<p class="titleintable"><a id="sthref872"></a><a id="sthref873"></a>Table 12-10 SQL Statements for Starting Standby Databases</p>
<table class="cellalignment2589" title="SQL Statements for Starting Standby Databases" summary="This table describes the SQL statements you use to start a physical standby, a logical standby, or an Active Data Guard standby database." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t51">Type of Standby Database</th>
<th class="cellalignment2590" id="r1c2-t51">SQL Statement</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t51" headers="r1c1-t51">
<p>Physical</p>
</td>
<td class="cellalignment2586" headers="r2c1-t51 r1c2-t51">
<p><code dir="ltr">STARTUP MOUNT;</code></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t51" headers="r1c1-t51">
<p>Logical</p>
</td>
<td class="cellalignment2586" headers="r3c1-t51 r1c2-t51">
<p><code dir="ltr">STARTUP;</code></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t51" headers="r1c1-t51">
<p>Active Data Guard</p>
</td>
<td class="cellalignment2586" headers="r4c1-t51 r1c2-t51">
<p><code dir="ltr">STARTUP;</code></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformal" --></li>
<li>
<p>Start Redo Apply (physical standby) or SQL Apply (logical standby):</p>
<div id="HABPT5072" class="tblruleformal">
<p class="titleintable"><a id="sthref874"></a><a id="sthref875"></a>Table 12-11 SQL Statements to Start Redo Apply and SQL Apply</p>
<table class="cellalignment2589" title="SQL Statements to Start Redo Apply and SQL Apply" summary="This table describes the SQL statements you use to start Redo Apply or SQL Apply." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t52">Type of Standby Database</th>
<th class="cellalignment2590" id="r1c2-t52">SQL Statement</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t52" headers="r1c1-t52">
<p>Physical (or Active Data Guard)</p>
</td>
<td class="cellalignment2586" headers="r2c1-t52 r1c2-t52">
<p><code dir="ltr">RECOVER MANAGED STANDBY DATABASE DISCONNECT;</code></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t52" headers="r1c1-t52">
<p>Logical</p>
</td>
<td class="cellalignment2586" headers="r3c1-t52 r1c2-t52">
<p><code dir="ltr">ALTER DATABASE START LOGICAL STANDBY APPLY;</code></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformal" --></li>
<li id="CDEBDGIA">
<p>Verify redo transport services on the primary database</p>
<p>You might have to reenable the primary database remote archive destination. Query the <code dir="ltr">V$ARCHIVE_DEST_STATUS</code> view first to see the current state of the archive destinations:</p>
<pre dir="ltr">SELECT DEST_ID, DEST_NAME, STATUS, PROTECTION_MODE, DESTINATION, ERROR, SRL 
      FROM V$ARCHIVE_DEST_STATUS;
ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_n=ENABLE; 
ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre>
<p>Verify redo transport services between the primary and standby databases by checking for errors. Query the <code dir="ltr">V$ARCHIVE_DEST</code> and <code dir="ltr">V$ARCHIVE_DEST_STATUS</code> views:</p>
<pre dir="ltr">SELECT STATUS, TARGET, LOG_SEQUENCE, TYPE, PROCESS, REGISTER, ERROR 
    FROM V$ARCHIVE_DEST; 
SELECT * FROM V$ARCHIVE_DEST_STATUS WHERE STATUS!=&#39;INACTIVE&#39;;
</pre></li>
<li>
<p>Verify that recovery is progressing on standby database</p>
<ul>
<li>
<p>For a physical standby database, verify that there are no errors from the managed recovery process and that the recovery has applied the redo from the archived redo log files:</p>
<pre dir="ltr">SELECT MAX(SEQUENCE#), THREAD# FROM V$LOG_HISTORY GROUP BY THREAD;
SELECT PROCESS, STATUS, THREAD#, SEQUENCE#, CLIENT_PROCESS
    FROM V$MANAGED_STANDBY;
</pre></li>
<li>
<p>For a logical standby database, verify that there are no errors from the logical standby process and that the recovery has applied the redo from the archived redo logs:</p>
<pre dir="ltr">SELECT THREAD#, SEQUENCE# SEQ# 
    FROM DBA_LOGSTDBY_LOG LOG, DBA_LOGSTDBY_PROGRESS PROG 
    WHERE PROG.APPLIED_SCN BETWEEN LOG.FIRST_CHANGE# AND LOG.NEXT_CHANGE# 
    ORDER BY NEXT_CHANGE#;
</pre></li>
</ul>
</li>
<li>
<p>Restore primary database protection mode</p>
<p>If you had to change the protection mode of the primary database from maximum protection to either maximum availability or maximum performance because of the standby database outage, then change the primary database protection mode back to maximum protection depending on your business requirements.</p>
<pre dir="ltr">ALTER DATABASE SET STANDBY DATABASE TO MAXIMIZE [PROTECTION | AVAILABILITY];
</pre></li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB" href="../SBYDB/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a></div>
</div>
<!-- class="sect2" -->
<a id="CDECFHID"></a>
<div id="HABPT5073" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.3.5</span> Restoring Fault Tolerance After a Standby Database Data Failure</h3>
<p>Following <a id="sthref876"></a>unplanned downtime on the standby database that requires a full or partial data file restoration (such as data or media failure), full fault tolerance is compromised until the standby database is brought back into service. Full database protection should be restored as soon as possible.</p>
<p>To repair data corruption and data failures on a logical standby database, <span class="bold">you require a backup of the logical standby file and not a backup from the primary database</span>. Otherwise, you must reinstate or re-create the relevant objects affected by the corruption.To repair data corruption or data failures on the standby database, you can use the following repair solutions:</p>
<ul>
<li>
<p><a href="#BABIFCBH">Use RMAN and Block Media Recovery</a> (described in <a href="#BABIFCBH">Section 12.2.7.3, &#34;Use RMAN and Block Media Recovery&#34;</a>)</p>
</li>
<li>
<p><a href="#BABCDCIC">Use RMAN and Data File Media Recovery</a> (described in <a href="#BABCDCIC">Section 12.2.7.5, &#34;Use RMAN and Data File Media Recovery&#34;</a>)</p>
</li>
<li>
<p>Re-Create Objects Manually for logical standby databases only (described in Section&nbsp;14.2.6.7, &#34;Re-Create Objects Manually&#34;)</p>
</li>
</ul>
<p>If you had to change the protection mode of the primary database from maximum protection to either maximum availability or maximum performance because of the standby database outage, then change the primary database protection mode back to maximum protection (depending on your business requirements).</p>
<pre dir="ltr">ALTER DATABASE SET STANDBY DATABASE TO MAXIMIZE [PROTECTION | AVAILABILITY];
</pre></div>
<!-- class="sect2" -->
<a id="BABCFGHE"></a>
<div id="HABPT5074" class="sect2"><!-- infolevel="all" infotype="General" -->
<h3 class="sect2"><span class="secnum">12.3.6</span> Restoring Fault Tolerance After the Primary Database Was Opened Resetlogs<a id="sthref877"></a><a id="sthref878"></a></h3>
<p>If the primary<a id="sthref879"></a> database is activated because it was flashed back to correct a logical error or because it was restored and recovered to a point in time, then the corresponding standby database might require additional maintenance. No additional work is required if the primary database completed recovery with no resetlogs.</p>
<p>After opening the primary database with the <code dir="ltr">RESETLOGS</code> option, execute the queries shown in <a href="#CDEGIIEB">Table 12-12</a>.</p>
<div id="HABPT5075" class="tblruleformal">
<p class="titleintable"><a id="sthref880"></a><a id="CDEGIIEB"></a>Table 12-12 Queries to Determine RESETLOGS SCN and Current SCN OPEN RESETLOGS</p>
<table class="cellalignment2589" title="Queries to Determine RESETLOGS SCN and Current SCN OPEN RESETLOGS" summary="This table shows how to query the primary and standby databases to help restore fault tolerance an OPEN RESETLOGS statement has been issued on the production database." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t54">Database</th>
<th class="cellalignment2590" id="r1c2-t54">Query</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t54" headers="r1c1-t54">
<p>Primary</p>
</td>
<td class="cellalignment2586" headers="r2c1-t54 r1c2-t54">
<p><code dir="ltr">SELECT TO_CHAR(RESETLOGS_CHANGE# - 2) FROM V$DATABASE;</code></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t54" headers="r1c1-t54">
<p>Physical standby</p>
</td>
<td class="cellalignment2586" headers="r3c1-t54 r1c2-t54">
<p><code dir="ltr">SELECT TO_CHAR(CURRENT_SCN) FROM V$DATABASE;</code></p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t54" headers="r1c1-t54">
<p>Logical standby</p>
</td>
<td class="cellalignment2586" headers="r4c1-t54 r1c2-t54">
<p><code dir="ltr">SELECT APPLIED_SCN FROM DBA_LOGSTDBY_PROGRESS;</code></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformal" -->
<p><a href="#CACHABJI">Table 12-13</a> shows the actions you take to restore fault tolerance if the standby database is behind the primary database&#39;s resetlogs SCN.</p>
<div id="HABPT5076" class="tblruleformal">
<p class="titleintable"><a id="sthref881"></a><a id="CACHABJI"></a>Table 12-13 SCN on Standby Database is Behind RESETLOGS SCN on the Primary Database</p>
<table class="cellalignment2589" title="SCN on Standby Database is Behind RESETLOGS SCN on the Primary Database" summary="This table describes the tasks you perform to restore fault tolerance on the physical or logical standby databases." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t55">Database</th>
<th class="cellalignment2590" id="r1c2-t55">Action</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t55" headers="r1c1-t55">
<p>Physical standby</p>
</td>
<td class="cellalignment2586" headers="r2c1-t55 r1c2-t55">
<ol>
<li>
<p>Ensure that the standby database has received an archived redo log file from the primary database.</p>
<p><span class="bold">See Also</span>: <a href="#CDEBDGIA">&#34;Verify redo transport services on the primary database&#34;</a></p>
</li>
<li>
<p>Restart Redo Apply.</p>
</li>
</ol>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t55" headers="r1c1-t55">
<p>Logical standby</p>
</td>
<td class="cellalignment2586" headers="r3c1-t55 r1c2-t55">
<p>Ensure that the standby database has received an archived redo log file from the primary database.</p>
<p><span class="bold">See Also</span>: <a href="#CDEBDGIA">&#34;Verify redo transport services on the primary database&#34;</a></p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformal" -->
<p><a href="#CDEGAIIB">Table 12-14</a> shows the actions you take to restore fault tolerance if the standby database is ahead of the primary database&#39;s resetlogs SCN.</p>
<div id="HABPT5077" class="tblruleformal">
<p class="titleintable"><a id="sthref882"></a><a id="CDEGAIIB"></a>Table 12-14 SCN on the Standby is Ahead of Resetlogs SCN on the Primary Database</p>
<table class="cellalignment2589" title="SCN on the Standby is Ahead of Resetlogs SCN on the Primary Database" summary="This table shows the actions you take when the SCN on the Standby Database is Ahead of Resetlogs SCN on the Production Database" dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t56">Database</th>
<th class="cellalignment2590" id="r1c2-t56">Action</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t56" headers="r1c1-t56">
<p>Physical standby</p>
</td>
<td class="cellalignment2586" headers="r2c1-t56 r1c2-t56">
<ol>
<li>
<p>Ensure that the standby database has received an archived redo log file from the primary database.</p>
<p>See Also: <a href="#CDEBDGIA">&#34;Verify redo transport services on the primary database&#34;</a></p>
</li>
<li>
<p>Issue the <code dir="ltr">SHUTDOWN IMMEDIATE</code> statement, if necessary.</p>
</li>
<li>
<p>Issue the <code dir="ltr">STARTUP MOUNT</code> statement.</p>
</li>
<li>
<p>Issue the <code dir="ltr">FLASHBACK DATABASE TO SCN</code> <code dir="ltr"><span class="codeinlineitalic">flashback_scn</span></code> statement where <code dir="ltr"><span class="codeinlineitalic">flashback_scn</span></code> is the SCN returned from the primary database query in <a href="#CDEGIIEB">Table 12-12</a>. The SCN returned from the primary database query is 2 less than the <code dir="ltr">RESETLOGS_CHANGE#</code>.</p>
<p>Issue the <code dir="ltr">FLASHBACK DATABASE TO SCN resetlogs_change#_minus_2</code> statement.</p>
</li>
<li>
<p>Restart Redo Apply with or without real-time apply:</p>
<p>With real-time apply:</p>
<pre dir="ltr">ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE DISCONNECT;
</pre>
<p>Without real-time apply:</p>
<pre dir="ltr">ALTER DATABASE RECOVER MANAGED STANDBY DATABASE DISCONNECT;
</pre></li>
</ol>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t56" headers="r1c1-t56">
<p>Logical standby</p>
</td>
<td class="cellalignment2586" headers="r3c1-t56 r1c2-t56">
<ol>
<li>
<p>Determine the SCN at the primary database.</p>
<p>On the primary database, use the following query to obtain the value of the system change number (SCN) that is 2 SCNs before the RESETLOGS operation occurred on the primary database:</p>
<pre dir="ltr">SQL&gt; SELECT TO_CHAR(RESETLOGS_CHANGE# - 2) AS FLASHBACK_SCN FROM V$DATABASE;
</pre></li>
<li>
<p>Determine the target SCN for flashback operation at the logical standby:</p>
<pre dir="ltr">SQL&gt; SELECT DBMS_LOGSTDBY.MAP_PRIMARY_SCN (PRIMARY_SCN =&gt; FLASHBACK_SCN)2&gt; AS TARGET_SCN FROM DUAL;
</pre></li>
<li>
<p>Flash back the logical standby to the <code dir="ltr"><span class="codeinlineitalic">TARGET_SCN</span></code> returned.</p>
<p>Issue the following SQL statements to flash back the logical standby database to the specified SCN, and open the logical standby database with the <code dir="ltr">RESETLOGS</code> option:</p>
<pre dir="ltr">SQL&gt; SHUTDOWN;
SQL&gt; STARTUP MOUNT EXCLUSIVE;
SQL&gt; FLASHBACK DATABASE TO SCN <span class="variable">TARGET_SCN</span>;
SQL&gt; ALTER DATABASE OPEN RESETLOGS;
</pre></li>
<li>
<p>Start SQL Apply:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE START LOGICAL STANDBY APPLY IMMEDIATE;
</pre></li>
</ol>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformal" --></div>
<!-- class="sect2" -->
<a id="i1006378"></a>
<div id="HABPT5078" class="sect2">
<h3 class="sect2"><span class="secnum">12.3.7</span> Restoring Fault Tolerance After <a id="sthref883"></a>Dual Failures</h3>
<p>If a dual failure affecting both the standby and primary databases occurs, then you must re-create the primary database first. Because the sites are identical, the primary database can be created wherever the most recent backup resides.</p>
<p><a href="#g1009445">Table 12-15</a> summarizes the recovery strategy depending on the type of backups that are available.<a id="sthref884"></a></p>
<div id="HABPT5079" class="tblruleformalwide">
<p class="titleintable"><a id="sthref885"></a><a id="g1009445"></a>Table 12-15 Re-Creating the Primary and Standby Databases</p>
<table class="cellalignment2589" title="Re-Creating the Primary and Standby Databases " summary="This table summarizes recovery strategy depending upon the type of backups that are available." dir="ltr">
<thead>
<tr class="cellalignment2580">
<th class="cellalignment2590" id="r1c1-t57">Available Backups</th>
<th class="cellalignment2590" id="r1c2-t57">Re-Creating the Primary Database</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r2c1-t57" headers="r1c1-t57">
<p>Backups (including redo) managed by ZDBRA</p>
</td>
<td class="cellalignment2586" headers="r2c1-t57 r1c2-t57">
<p>Restore entire database and associated redo to achieve near zero data loss.</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r3c1-t57" headers="r1c1-t57">
<p>Local backup on primary and standby databases</p>
</td>
<td class="cellalignment2586" headers="r3c1-t57 r1c2-t57">
<p>Restore backup from the primary database. Recover and activate the database as the new primary database.</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r4c1-t57" headers="r1c1-t57">
<p>Local backup only on standby database. Tape backups on standby database.</p>
</td>
<td class="cellalignment2586" headers="r4c1-t57 r1c2-t57">
<p>Restore the local standby backup to the standby database. Recover and activate the database as the new primary database.</p>
</td>
</tr>
<tr class="cellalignment2580">
<td class="cellalignment2586" id="r5c1-t57" headers="r1c1-t57">
<p>Tape backups only</p>
</td>
<td class="cellalignment2586" headers="r5c1-t57 r1c2-t57">
<p>Restore tape backups locally. Recover the database and activate it as the new primary database.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblruleformalwide" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink SBYDB00200" href="../SBYDB/create_ps.htm#SBYDB00200"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for the steps for creating a standby database after the primary database is re-created</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2579">
<tr>
<td class="cellalignment2586">
<table class="cellalignment2584">
<tr>
<td class="cellalignment2583"><a href="monitor.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2583"><a href="schedule_outage.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2005, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2588">
<table class="cellalignment2582">
<tr>
<td class="cellalignment2583"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2583"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2583"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2583"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2583"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2583"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>


</body></html>