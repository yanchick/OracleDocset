<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-106788"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Monitoring%20Database%20Operations"></a><title>Monitoring Database Operations</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="A database operation is a set of database tasks defined by end users or application code, for example, a batch job or Extraction, Transformation, and Loading (ETL) processing. You can define, monitor, and report on database operations."/>
<meta name="keywords" content=", Real-Time SQL Monitoring, database operations, monitoring, real-time SQL, composite operations, simple operations, database operations, definition, simple, composite, purpose, concepts, PL/SQL interface, enabling with initialization parameters, optimizer hints, MONITOR, hints, optimizer, NO_MONITOR, enabling with hints, creating database operations, using Cloud Control"/>
<meta name="dcterms.created" content="2017-07-24T09:35:46Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SQL Tuning Guide"/>
<meta name="dcterms.identifier" content="E49106-14"/>
<meta name="dcterms.isVersionOf" content="TGSQL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="tgsql_pt_mon.htm" title="Previous" type="text/html"/>
<link rel="Next" href="tgsql_stcb.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49106-14.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF"></a> <span id="PAGE" style="display:none;">27/40</span> <!-- End Header -->
<a id="TGSQL789"></a>
<h1 id="TGSQL-GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" class="sect1"><span class="enumeration_chapter">16</span> Monitoring Database Operations</h1>
<div>
<p>A <span class="bold">database operation</span> is a set of database tasks defined by end users or application code, for example, a batch job or Extraction, Transformation, and Loading (ETL) processing. You can define, monitor, and report on database operations.</p>
<p>This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_monit.htm#GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" title="Database operations are either simple or composite.">About Monitoring Database Operations</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" title="Use initialization parameters to enable or disable monitoring.">Enabling and Disabling Monitoring of Database Operations</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444" title="Creating a database operation involves explicitly defining its beginning and end points.">Creating a Database Operation</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-4048D00E-2635-42C8-A37D-71EFAC619062" title="By default, AWR automatically captures SQL monitoring reports in XML format.">Monitoring SQL Executions Using Cloud Control</a></p>
</li>
</ul>
</div>
<a id="TGSQL790"></a>
<div class="props_rev_3"><a id="GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862"></a>
<h2 id="TGSQL-GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" class="sect2">About Monitoring Database Operations</h2>
<div>
<p>Database operations are either simple or composite.</p>
<p>A <a href="glossary.htm#GUID-CAF93F95-6242-4971-AC57-4D9C70EFDCAA"><span class="xrefglossterm">simple database operation</span></a> is a single SQL statement or PL/SQL procedure or function. A <a href="glossary.htm#GUID-0F211600-498F-4862-974A-99C5811C0CBB"><span class="xrefglossterm">composite database operation</span></a> is activity between two points in time in a database session, with each session defining its own beginning and end points. A session can participate in at most one composite database operation at a time.</p>
<p>Real-Time SQL Monitoring, which was introduced in Oracle Database 11<span class="italic">g</span>, enables you to monitor a single SQL statement or PL/SQL procedure. Starting in Oracle Database 12<span class="italic">c</span>, Real-Time Database Operations provides the ability to monitor composite operations automatically. The database automatically monitors parallel queries, DML, and DDL statements as soon as execution begins. By default, Real-Time SQL Monitoring automatically starts when a SQL statement runs in parallel, or when it has consumed at least 5 seconds of CPU or I/O time in a single execution.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_monit.htm#GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7" title="Real-time SQL Monitoring enables you to monitor a single SQL statement or PL/SQL program unit. Database operations extend this functionality by enabling you to treat a set of statements or procedures as a named, uniquely identified, and re-executable unit.">Purpose of Monitoring Database Operations</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-B581E8C5-41AC-4638-978F-80E758AAE2B7" title="This topic provides an overview of the architecture and attributes of database operations.">Database Operation Monitoring Concepts</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" title="The Monitored SQL Executions shows information such as the SQL ID, database time, and I/O requests.The DBMS_SQL_MONITOR package defines the beginning and ending of a database operation, and generates a report of the database operations.You can monitor the statistics for SQL statement execution using the V$SQL_MONITOR, V$SQL_PLAN_MONITOR, and V$SQL_MONITOR_SESSTAT views.">User Interfaces for Database Operations Monitoring</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-A11CCA38-7DD8-4B08-9311-29CC7ED92EE6">Basic Tasks in Database Operations Monitoring</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862__GUID-6DE945D9-2E81-4945-B526-D400CDB87B57">
<p class="notep1">See Also:</p>
<p><a class="olink CNCPT89228" target="_blank" href="../CNCPT/process.htm#CNCPT89228"><span><cite>Oracle Database Concepts</cite></span></a> for a brief conceptual overview of database operations</p>
</div>
</div>
<a id="TGSQL94583"></a>
<div class="props_rev_3"><a id="GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7"></a>
<h3 id="TGSQL-GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7" class="sect3">Purpose of Monitoring Database Operations</h3>
<div>
<p>Real-time SQL Monitoring enables you to monitor a single SQL statement or PL/SQL program unit. Database operations extend this functionality by enabling you to treat a set of statements or procedures as a named, uniquely identified, and re-executable unit.</p>
<p>In general, monitoring database operations is useful for the following users:</p>
<ul style="list-style-type: disc;">
<li>
<p>DBAs whose responsibilities include identifying expensive (high response time) SQL statements and PL/SQL functions</p>
</li>
<li>
<p>DBAs who manage batch jobs in a data warehouse or OLTP system</p>
</li>
<li>
<p>Application or database developers who need to monitor the activities related to particular operations, for example, Oracle Data Pump operations</p>
</li>
</ul>
<p>Monitoring database operations is useful for performing the following tasks:</p>
<ul style="list-style-type: disc;">
<li>
<p>Tracking and reporting</p>
<p>Tracking requires first defining a database operation, for example, though <code class="codeph">DBMS_SQL_MONITOR</code>, OCI, or JDBC APIs. You can define an operation from a different session from the one that you are currently using. The database infrastructure determines what to track on behalf of the defined operation.</p>
<p>You can generate reports on the operation. For example, your tuning task may involve determining which SQL statements run on behalf of a specific batch job, what their execution statistics were, what was occurring in the database when the operation was executing, and so on.</p>
</li>
<li>
<p>Monitoring execution progress</p>
<p>This task involves monitoring a currently executing database operation. The information is particularly useful when you are investigating why an operation is taking a long time to complete.</p>
</li>
<li>
<p>Monitoring resource usage</p>
<p>You may want to detect when a SQL execution uses excessive CPU, issues an excessive amount of I/O, or takes a long time to complete. With Oracle Database Resource Manager (the Resource Manager), you can configure thresholds for each consumer group that specify the maximum resource usage for all SQL executions in the group. When a SQL operation reaches a specified threshold, the Resource Manager can switch the operation into a lower-priority consumer group, terminate the session or call, or log the event. You can then monitor these SQL operations.</p>
</li>
<li>
<p>Tuning for response time</p>
<p>When tuning a database operation, you typically aim to improve the <a href="glossary.htm#GUID-371FCA7E-6CDB-4D4C-9BD6-90944AD21E3A"><span class="xrefglossterm">response time</span></a>. Often the database operation performance issues are mainly SQL performance issues.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7__GUID-3EE1D84A-2F3B-4BC3-A6EE-22F4416FE3BC">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_monit.htm#GUID-4048D00E-2635-42C8-A37D-71EFAC619062" title="By default, AWR automatically captures SQL monitoring reports in XML format.">Monitoring SQL Executions Using Cloud Control</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ADMIN11879" target="_blank" href="../ADMIN/dbrm.htm#ADMIN11879"><span><cite>Oracle Database Administrator&rsquo;s Guide</cite></span></a></p>
</li>
</ul>
</div>
</div>
<a id="TGSQL94584"></a>
<div class="props_rev_3"><a id="GUID-BFD26CCE-4CCA-4FB6-B9FD-ECD82898769E"></a>
<h4 id="TGSQL-GUID-BFD26CCE-4CCA-4FB6-B9FD-ECD82898769E" class="sect4">Simple Database Operation Use Cases</h4>
<div>
<p>For simple operations, Real-Time SQL Monitoring helps determine where a currently executing SQL statement is in its execution plan and where the statement is spending its time. You can also see the breakdown of time and resource usage for recently completed statements. In this way, you can better determine why a particular operation is expensive.</p>
<p>Typical use cases for Real-Time SQL Monitoring include the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>A frequently executed SQL statement is executing more slowly than normal. You must identify the root cause of this problem.</p>
</li>
<li>
<p>A database session is experiencing slow performance.</p>
</li>
<li>
<p>A parallel SQL statement is taking a long time. You want to determine how the server processes are dividing the work.</p>
</li>
</ul>
</div>
</div>
<a id="TGSQL94585"></a>
<div class="props_rev_3"><a id="GUID-0DB2A541-9799-48A6-9668-86C35E6465F3"></a>
<h4 id="TGSQL-GUID-0DB2A541-9799-48A6-9668-86C35E6465F3" class="sect4">Composite Database Operation Use Cases</h4>
<div>
<p>In OLTP and data warehouse environments, a job often logically groups related SQL statements. The job can involve multiple sessions.</p>
<p>Database operation monitoring is useful for digging through a suboptimally performing job to determine where resources are being consumed. Thus, database operations enable you to track related information and improve performance tuning time.</p>
<p>Typical use cases for monitoring composite operations include the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>A periodic batch job containing many SQL statements must complete in a certain number of hours, but took twice as long as expected.</p>
</li>
<li>
<p>After a database upgrade, the execution time of an important batch job doubled. To resolve this problem, you must collect enough relevant statistical data from the batch job before and after the upgrade, compare the two sets of data, and then identify the changes.</p>
</li>
<li>
<p>Packing a <a href="glossary.htm#GUID-52FB0AE5-7346-44E5-BE92-3C09385B1DDC"><span class="xrefglossterm">SQL tuning set (STS)</span></a> took far longer than anticipated. To diagnose the problem, you need to know what was being executed over time. Because this issue cannot be easily reproduced, you need to monitor the process while it is running.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-0DB2A541-9799-48A6-9668-86C35E6465F3__GUID-26B7D903-4119-4B8E-9A09-3860EF955736">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="tgsql_sts.htm#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" title="A SQL tuning set (STS) is a database object that you can use as input to tuning tools.">About SQL Tuning Sets</a>&#34;</span></p>
</div>
</div>
</div>
</div>
<a id="TGSQL94586"></a>
<div class="props_rev_3"><a id="GUID-B581E8C5-41AC-4638-978F-80E758AAE2B7"></a>
<h3 id="TGSQL-GUID-B581E8C5-41AC-4638-978F-80E758AAE2B7" class="sect3">Database Operation Monitoring Concepts</h3>
<div>
<p>This topic provides an overview of the architecture and attributes of database operations.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_monit.htm#GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807" title="Setting the CONTROL_MANAGEMENT_PACK_ACCESS initialization parameter to DIAGNOSTIC+TUNING (default) enables monitoring of database operations. Real-Time SQL Monitoring is a feature of the Oracle Database Tuning Pack.">About the Architecture of Database Operations</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-DAA57D6B-89D4-41BD-A56C-5AD02CAC417E" title="A composite database operation consists of the activity of one session between two points in time. Exactly one session exists for the duration of the database operation.">Composite Database Operations</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859" title="A database operation is uniquely identified by its name and execution ID.">Attributes of Database Operations</a></p>
</li>
</ul>
</div>
<a id="TGSQL94588"></a><a id="TGSQL94587"></a>
<div class="props_rev_3"><a id="GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807"></a>
<h4 id="TGSQL-GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807" class="sect4">About the Architecture of Database Operations</h4>
<div>
<p>Setting the <code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code> initialization parameter to <code class="codeph">DIAGNOSTIC+TUNING</code> (default) enables monitoring of database operations. Real-Time SQL Monitoring is a feature of the Oracle Database Tuning Pack.</p>
<p>The following figure gives an overview of the architecture for database operations.</p>
<div class="figure" id="GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807__CHDIEDBG">
<p class="titleinfigure">Figure 16-1 Architecture for Database Operations</p>
<img width="642" height="572" src="img/GUID-33C79C28-A5A9-4387-9FB9-D6391C1A14A7-default.png" alt="Description of Figure 16-1 follows" title="Description of Figure 16-1 follows"/><br/>
<a href="img_text/GUID-33C79C28-A5A9-4387-9FB9-D6391C1A14A7-print.htm">Description of &#34;Figure 16-1 Architecture for Database Operations&#34;</a></div>
<!-- class="figure" -->
<p>As shown in <a href="tgsql_monit.htm#GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807__CHDIEDBG">Figure 16-1</a>, you can use the <code class="codeph">DBMS_SQL_MONITOR</code> package to define database operations. After monitoring is initiated, the database stores metadata about the database operations in AWR. The database refreshes monitoring statistics in close to real time as each monitored statement executes, typically once every second. The database periodically saves the data to disk.</p>
<p>Every monitored database operation has an entry in the <code class="codeph">V$SQL_MONITOR</code> view. This entry tracks key performance metrics collected for the execution, including the elapsed time, CPU time, number of reads and writes, I/O wait time, and various other wait times. The <code class="codeph">V$SQL_PLAN_MONITOR</code> view includes monitoring statistics for each operation in the execution plan of the SQL statement being monitored. You can access reports by using <code class="codeph">DBMS_SQL_MONITOR.REPORT_SQL_MONITOR</code>, which has an Oracle Enterprise Manager Cloud Control (Cloud Control) interface.</p>
<div class="infoboxnotealso" id="GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807__GUID-9866759A-4792-41B7-ACAE-61886EEAA495">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_monit.htm#GUID-4048D00E-2635-42C8-A37D-71EFAC619062" title="By default, AWR automatically captures SQL monitoring reports in XML format.">Monitoring SQL Executions Using Cloud Control</a>&#34;</span></p>
</li>
<li>
<p><a class="olink GUID-A5CA11BA-AE1F-4A2E-9C59-A98BA1F4E5C2" target="_blank" href="../REFRN/GUID-A5CA11BA-AE1F-4A2E-9C59-A98BA1F4E5C2.htm#GUID-A5CA11BA-AE1F-4A2E-9C59-A98BA1F4E5C2"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code> initialization parameter</p>
</li>
<li><a class="olink GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6" target="_blank" href="../REFRN/GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6.htm#GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">V$SQL_MONITOR</code> and <code class="codeph">V$SQL_PLAN_MONITOR</code> views</li>
<li>
<p><a class="olink ARPLS68375" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68375"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about <code class="codeph">DBMS_SQLTUNE</code> and <code class="codeph">DBMS_SQL_MONITOR</code> packages</p>
</li>
</ul>
</div>
</div>
</div>
<a id="TGSQL94589"></a>
<div class="props_rev_3"><a id="GUID-DAA57D6B-89D4-41BD-A56C-5AD02CAC417E"></a>
<h4 id="TGSQL-GUID-DAA57D6B-89D4-41BD-A56C-5AD02CAC417E" class="sect4">Composite Database Operations</h4>
<div>
<p>A composite database operation consists of the activity of one session between two points in time. Exactly one session exists for the duration of the database operation.</p>
<p>SQL statements or PL/SQL procedures running in this session are part of the composite operation. Composite database operations can also be defined in the database kernel. Typical composite operations include SQL*Plus scripts, batch jobs, and ETL processing.</p>
</div>
</div>
<a id="TGSQL94590"></a>
<div class="props_rev_3"><a id="GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859"></a>
<h4 id="TGSQL-GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859" class="sect4">Attributes of Database Operations</h4>
<div>
<p>A database operation is uniquely identified by its name and execution ID.</p>
<p>The attributes are defined as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>Database operation name</p>
<p>This is a user-created name such as <code class="codeph">daily_sales_report</code>. The name is the same for a job even if it is executed concurrently by different sessions or on different databases. Database operation names do not reside in different namespaces.</p>
</li>
<li>
<p>Database operation execution ID</p>
<p>Two or more occurrences of the same database operation can run at the same time, with the same name but different execution IDs. This numeric ID uniquely identifies different executions of the <span class="italic">same</span> database operation.</p>
<p>The database automatically creates an execution ID when you begin a database operation. You can also specify a user-created execution ID.</p>
</li>
</ul>
<p>The database uses the following triplet of values to identify each SQL and PL/SQL statement monitored in the <code class="codeph">V$SQL_MONITOR</code> view, regardless of whether the statement is included in a database operation:</p>
<ul style="list-style-type: disc;">
<li>
<p>SQL identifier to identify the SQL statement (<code class="codeph">SQL_ID</code>)</p>
</li>
<li>
<p>Start execution timestamp (<code class="codeph">SQL_EXEC_START</code>)</p>
</li>
<li>
<p>An internally generated identifier to ensure that this primary key is truly unique (<code class="codeph">SQL_EXEC_ID</code>)</p>
</li>
</ul>
<p>You can use zero or more additional attributes to describe and identify the characteristics of a DB operation. Each attribute has a name and value. For example, for operation <code class="codeph">daily_sales_report</code>, you might define the attribute <code class="codeph">db_name</code> and assign it the value <code class="codeph">prod</code>.</p>
<div class="infoboxnotealso" id="GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859__GUID-F308114B-4AD4-41CE-A846-652A4A611A29">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN30479" target="_blank" href="../REFRN/GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6.htm#REFRN30479"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">V$SQL_MONITOR</code> view</p>
</li>
<li>
<p><a class="olink ARPLS68375" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68375"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code> function</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="TGSQL94592"></a>
<div class="props_rev_3"><a id="GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690"></a>
<h3 id="TGSQL-GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" class="sect3">User Interfaces for Database Operations Monitoring</h3>
<div>
<div class="section">
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_monit.htm#GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7" title="The Monitored SQL Executions shows information such as the SQL ID, database time, and I/O requests.">Monitored SQL Executions Page in Cloud Control</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218" title="The DBMS_SQL_MONITOR package defines the beginning and ending of a database operation, and generates a report of the database operations.">DBMS_SQL_MONITOR Package</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-E471C229-5713-40E2-A95C-593EACB56AE7" title="You can monitor the statistics for SQL statement execution using the V$SQL_MONITOR, V$SQL_PLAN_MONITOR, and V$SQL_MONITOR_SESSTAT views.">Views for Database Operations Monitoring</a></p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="TGSQL94593"></a>
<div class="props_rev_3"><a id="GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7"></a>
<h4 id="TGSQL-GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7" class="sect4">Monitored SQL Executions Page in Cloud Control</h4>
<div>
<div class="section">
<p><a id="d96163e1344" class="indexterm-anchor"></a>The Monitored SQL Executions page in Cloud Control is the recommended interface for reporting on database operations.</p>
</div>
<!-- class="section" --></div>
<a id="TGSQL94594"></a>
<div class="props_rev_3"><a id="GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530"></a>
<h5 id="TGSQL-GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530" class="sect5">Accessing the Monitored SQL Executions Page</h5>
<div>
<p>The Monitored SQL Executions shows information such as the SQL ID, database time, and I/O requests.</p>
<div class="section">
<p class="subhead3">To access the Monitored SQL Executions page:</p>
<ol>
<li>
<p>Log in to Cloud Control with the appropriate credentials.</p>
</li>
<li>
<p>Under the <span class="bold">Targets</span> menu, select <span class="bold">Databases</span>.</p>
</li>
<li>
<p>In the list of database targets, select the target for the Oracle Database instance that you want to administer.</p>
</li>
<li>
<p>If prompted for database credentials, then enter the minimum credentials necessary for the tasks you intend to perform.</p>
</li>
<li>
<p>From the <span class="bold">Performance</span> menu, select <span class="bold">SQL Monitoring</span>.</p>
<p>The Monitored SQL Executions page appears.</p>
<div class="figure" id="GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530__GUID-055D4E03-F49D-4192-8FFF-37E44818608E">
<p class="titleinfigure">Figure 16-2 Monitored SQL Executions</p>
<img width="833" height="162" src="img/GUID-B2E71C26-0EF8-4166-A91E-FFE5D1AB540D-default.jpg" alt="Description of Figure 16-2 follows" title="Description of Figure 16-2 follows"/><br/>
<a href="img_text/GUID-B2E71C26-0EF8-4166-A91E-FFE5D1AB540D-default.htm">Description of &#34;Figure 16-2 Monitored SQL Executions&#34;</a></div>
<!-- class="figure" --></li>
</ol>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL94596"></a><a id="TGSQL94595"></a>
<div class="props_rev_3"><a id="GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218"></a>
<h4 id="TGSQL-GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218" class="sect4">DBMS_SQL_MONITOR Package</h4>
<div>
<p>The <code class="codeph">DBMS_SQL_MONITOR</code> package defines the beginning and ending of a database operation, and generates a report of the database operations.</p>
<div class="tblformal" id="GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218__GUID-B2677E02-96F7-4C9E-BFDB-7B2AE810BBA6">
<p class="titleintable">Table 16-1 DBMS_SQL_MONITOR</p>
<table class="cellalignment4808" title="DBMS_SQL_MONITOR" summary="This table describes DBMS_SQLTUNE and DBMS_SQL_MONITOR.">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4809" id="d96163e1563">Program Unit</th>
<th class="cellalignment4880" id="d96163e1566">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4811" id="d96163e1571" headers="d96163e1563">
<p><code class="codeph">REPORT_SQL_MONITOR</code></p>
</td>
<td class="cellalignment4881" headers="d96163e1571 d96163e1566">
<p>This function accepts several input parameters to specify the execution, the level of detail in the report, and the report type. If no parameters are specified, then the function generates a text report for the last execution that was monitored.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4811" id="d96163e1579" headers="d96163e1563">
<p><code class="codeph">BEGIN_OPERATION</code></p>
</td>
<td class="cellalignment4881" headers="d96163e1579 d96163e1566">
<p>This function associates a session with a database operation.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4811" id="d96163e1587" headers="d96163e1563">
<p><code class="codeph">END_OPERATION</code></p>
</td>
<td class="cellalignment4881" headers="d96163e1587 d96163e1566">
<p>This function disassociates a session from the specified database operation execution.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218__GUID-F4C2D356-6227-407F-96AA-A552D6AC39BB">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS74779" target="_blank" href="../ARPLS/d_sql_monitor.htm#ARPLS74779"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SQL_MONITOR</code> package</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94598"></a><a id="TGSQL94597"></a>
<div class="props_rev_3"><a id="GUID-E471C229-5713-40E2-A95C-593EACB56AE7"></a>
<h4 id="TGSQL-GUID-E471C229-5713-40E2-A95C-593EACB56AE7" class="sect4">Views for Database Operations Monitoring</h4>
<div>
<p>You can monitor the statistics for SQL statement execution using the <code class="codeph">V$SQL_MONITOR</code>, <code class="codeph">V$SQL_PLAN_MONITOR</code>, and <code class="codeph">V$SQL_MONITOR_SESSTAT</code> views.</p>
<div class="section">
<p><a href="tgsql_monit.htm#GUID-E471C229-5713-40E2-A95C-593EACB56AE7__CHDFEHFI" title="This table describes views that you can use to monitor database operations.">Table 16-2</a> summarizes these views.</p>
<div class="tblformal" id="GUID-E471C229-5713-40E2-A95C-593EACB56AE7__CHDFEHFI">
<p class="titleintable">Table 16-2 Views for Database Operations Monitoring</p>
<table class="cellalignment4808" title="Views for Database Operations Monitoring" summary="This table describes views that you can use to monitor database operations.">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4839" id="d96163e1714">View</th>
<th class="cellalignment4839" id="d96163e1717">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d96163e1722" headers="d96163e1714">
<p><a class="olink GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6" target="_blank" href="../REFRN/GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6.htm#GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6"><code class="codeph">V$SQL_MONITOR</code></a></p>
</td>
<td class="cellalignment4802" headers="d96163e1722 d96163e1717">
<p>This view contains global, high-level information about the top SQL statements in a database operation.</p>
<p>Each monitored SQL statement has an entry in this view. Each row contains a SQL statement whose statistics are accumulated from multiple sessions and all of its executions in the operation. The primary key is the combination of the columns <code class="codeph">DBOP_NAME</code>, <code class="codeph">DBOP_EXEC_ID</code>, and <code class="codeph">SQL_ID</code>.</p>
<p>The <code class="codeph">V$SQL_MONITOR</code> view contains a subset of the statistics available in <code class="codeph">V$SQL</code>. However, unlike <code class="codeph">V$SQL</code>, monitoring statistics are not cumulative over several executions. Instead, one entry in <code class="codeph">V$SQL_MONITOR</code> is dedicated to a single execution of a SQL statement. If the database monitors two executions of the same SQL statement, then each execution has a separate entry in <code class="codeph">V$SQL_MONITOR</code>.</p>
<p><code class="codeph">V$SQL_MONITOR</code> has one entry for the parallel execution coordinator process, and one entry for each parallel execution server process. Each entry has corresponding entries in <code class="codeph">V$SQL_PLAN_MONITOR</code>. Because the processes allocated for the parallel execution of a SQL statement are cooperating for the same execution, these entries share the same execution key (the composite <code class="codeph">SQL_ID</code>, <code class="codeph">SQL_EXEC_START</code> and <code class="codeph">SQL_EXEC_ID</code>). You can aggregate the execution key to determine the overall statistics for a parallel execution.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d96163e1776" headers="d96163e1714">
<p><a class="olink GUID-F1C68683-4048-44FD-8B7A-F30FDCB751CA" target="_blank" href="../REFRN/GUID-F1C68683-4048-44FD-8B7A-F30FDCB751CA.htm#GUID-F1C68683-4048-44FD-8B7A-F30FDCB751CA"><code class="codeph">V$SQL_MONITOR_SESSTAT</code></a></p>
</td>
<td class="cellalignment4802" headers="d96163e1776 d96163e1717">
<p>This view contains the statistics for all sessions involved in the database operation.</p>
<p>Most of the statistics are cumulative. The database stores the statistics in XML format instead of using each column for each statistic. This view is primarily intended for the report generator. Oracle recommends that you use <code class="codeph">V$SESSTAT</code> instead of <code class="codeph">V$SQL_MONITOR_SESSTAT</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d96163e1794" headers="d96163e1714">
<p><a class="olink GUID-85354ECB-7E2E-4D4B-AE78-243A4BB6E523" target="_blank" href="../REFRN/GUID-85354ECB-7E2E-4D4B-AE78-243A4BB6E523.htm#GUID-85354ECB-7E2E-4D4B-AE78-243A4BB6E523"><code class="codeph">V$SQL_PLAN_MONITOR</code></a></p>
</td>
<td class="cellalignment4802" headers="d96163e1794 d96163e1717">
<p>This view contains monitoring statistics for each step in the execution plan of the monitored SQL statement.</p>
<p>The database updates statistics in <code class="codeph">V$SQL_PLAN_MONITOR</code> every second while the SQL statement is executing. Multiple entries exist in <code class="codeph">V$SQL_PLAN_MONITOR</code> for every monitored SQL statement. Each entry corresponds to a step in the execution plan of the statement.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>You can use the preceding views with the following views to get additional information about the monitored execution:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">V$ACTIVE_SESSION_HISTORY</code></p>
</li>
<li>
<p><code class="codeph">V$SESSION</code></p>
</li>
<li>
<p><code class="codeph">V$SESSION_LONGOPS</code></p>
</li>
<li>
<p><code class="codeph">V$SQL</code></p>
</li>
<li>
<p><code class="codeph">V$SQL_PLAN</code></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-E471C229-5713-40E2-A95C-593EACB56AE7__GUID-496AF598-73E7-4D1A-A61C-F6358276E7D7">
<p class="notep1">See Also:</p>
<p><a class="olink GUID-8C5690B0-DE10-4460-86DF-80111869CF4C" target="_blank" href="../REFRN/GUID-8C5690B0-DE10-4460-86DF-80111869CF4C.htm#GUID-8C5690B0-DE10-4460-86DF-80111869CF4C"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">V$</code> views for database operations monitoring</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL94599"></a>
<div class="props_rev_3"><a id="GUID-A11CCA38-7DD8-4B08-9311-29CC7ED92EE6"></a>
<h3 id="TGSQL-GUID-A11CCA38-7DD8-4B08-9311-29CC7ED92EE6" class="sect3">Basic Tasks in Database Operations Monitoring</h3>
<div>
<p>This section explains the basic tasks in database operations monitoring. Basic tasks are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_monit.htm#GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" title="Use initialization parameters to enable or disable monitoring.">Enabling and Disabling Monitoring of Database Operations</a>&#34;</span></p>
<p>This task explains how you can enable automatic monitoring of database operations at the system and statement level.</p>
</li>
<li>
<p><span class="q">&#34;<a href="tgsql_monit.htm#GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444" title="Creating a database operation involves explicitly defining its beginning and end points.">Creating a Database Operation</a>&#34;</span></p>
<p>This section explains how you can define the beginning and end of a database operation using PL/SQL.</p>
</li>
<li>
<p><span class="q">&#34;<a href="tgsql_monit.htm#GUID-4048D00E-2635-42C8-A37D-71EFAC619062" title="By default, AWR automatically captures SQL monitoring reports in XML format.">Reporting on Database Operations Using SQL Monitor</a>&#34;</span></p>
<p>This section explains how you can generate and interpret reports on a database operation.</p>
</li>
</ul>
</div>
</div>
</div>
<a id="TGSQL94600"></a>
<div class="props_rev_3"><a id="GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720"></a>
<h2 id="TGSQL-GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" class="sect2">Enabling and Disabling Monitoring of Database Operations</h2>
<div>
<p>Use initialization parameters to enable or disable monitoring.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_monit.htm#GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7" title="The SQL monitoring feature is enabled by default when the STATISTICS_LEVEL initialization parameter is either set to TYPICAL (the default value) or ALL. SQL monitoring starts automatically for all long-running queries.">Enabling Monitoring of Database Operations at the System Level</a></p>
</li>
<li>
<p><a href="tgsql_monit.htm#GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A" title="When the CONTROL_MANAGEMENT_PACK_ACCESS initialization parameter is set to DIAGNOSTIC+TUNING, you can use hints to enable or disable monitoring of specific SQL statements.">Enabling and Disabling Monitoring of Database Operations at the Statement Level</a></p>
</li>
</ul>
</div>
<a id="TGSQL94954"></a><a id="TGSQL94602"></a><a id="TGSQL94601"></a>
<div class="props_rev_3"><a id="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7"></a>
<h3 id="TGSQL-GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7" class="sect3">Enabling Monitoring of Database Operations at the System Level</h3>
<div>
<p>The SQL monitoring feature is enabled by default when the <code class="codeph">STATISTICS_LEVEL</code> initialization parameter is either set to <code class="codeph">TYPICAL</code> (the default value) or <code class="codeph">ALL</code>. SQL monitoring starts automatically for all long-running queries.</p>
<div class="section">
<p class="subhead3">Prerequisites</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Because SQL monitoring is a feature of the Oracle Database Tuning Pack, the <code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code> initialization parameter must be set to <code class="codeph">DIAGNOSTIC+TUNING</code> (the default value).</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">STATISTICS_LEVEL</code> initialization parameter is set to <code class="codeph">BASIC</code>.</p>
</li>
<li>
<p>You want to enable automatic monitoring of database operations.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To enable monitoring of database operations:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then query the current database operations settings.</p>
<p>For example, run the following SQL*Plus command:</p>
<pre dir="ltr">SQL&gt; SHOW PARAMETER statistics_level
 
NAME                                TYPE        VALUE
----------------------------------- ----------- -----
statistics_level                    string      BASIC
</pre></li>
<li>
<p>Set the statistics level to <code class="codeph">TYPICAL</code>.</p>
<p>For example, run the following SQL statement:</p>
<pre dir="ltr">SQL&gt; ALTER SYSTEM SET STATISTICS_LEVEL=&#39;TYPICAL&#39;;
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7__GUID-7C076BE7-16E9-431B-932E-5E146D8896C7">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN10141" target="_blank" href="../REFRN/GUID-E193EC9E-B642-4C01-99EC-24E04AEA1A2C.htm#REFRN10141"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">STATISTICS_LEVEL</code> and <code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code> initialization parameter</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94604"></a><a id="TGSQL94603"></a>
<div class="props_rev_3"><a id="GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A"></a>
<h3 id="TGSQL-GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A" class="sect3">Enabling and Disabling Monitoring of Database Operations at the Statement Level</h3>
<div>
<p>When the <code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code> initialization parameter is set to <code class="codeph">DIAGNOSTIC+TUNING</code>, you can use hints to enable or disable monitoring of specific SQL statements.</p>
<div class="section">
<p>The <code class="codeph">MONITOR</code> hint enables monitoring, whereas the <code class="codeph">NO_MONITOR</code> hint disables monitoring.</p>
<p>Two statement-level hints are available to force or prevent the database from monitoring a SQL statement. To force SQL monitoring, use the <code class="codeph">MONITOR</code> hint:</p>
<pre dir="ltr">SELECT /*+ MONITOR */ SYSDATE FROM DUAL;
</pre>
<p>This hint is effective only when the <code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code> parameter is set to <code class="codeph">DIAGNOSTIC+TUNING</code>. To prevent the hinted SQL statement from being monitored, use the <code class="codeph">NO_MONITOR</code> reverse hint.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Database monitoring is currently enabled at the system level.</p>
</li>
<li>
<p>You want to disable automatic monitoring for the statement <code class="codeph">SELECT * FROM sales ORDER BY time_id</code>.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To disable monitoring of database operations for a SQL statement:</p>
<ol>
<li>
<p>Execute the query with the <code class="codeph">NO_MONITOR</code> hint.</p>
<p>For example, run the following statement:</p>
<pre dir="ltr">SQL&gt; SELECT * /*+NO_MONITOR*/ FROM sales ORDER BY time_id;
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A__GUID-C701BEE2-D952-4C8F-B133-B98D80CD0A74">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF00219" target="_blank" href="../SQLRF/sql_elements006.htm#SQLRF00219"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for information about using the <code class="codeph">MONITOR</code> and <code class="codeph">NO_MONITOR</code> hints</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL94606"></a><a id="TGSQL94605"></a>
<div class="props_rev_3"><a id="GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444"></a>
<h2 id="TGSQL-GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444" class="sect2">Creating a Database Operation</h2>
<div>
<p>Creating a database operation involves explicitly defining its beginning and end points.</p>
<div class="section">
<p>You can start a database operation by using the <code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code> function and end the operation by using the <code class="codeph">DBMS_SQL_MONITOR.END_OPERATION</code> procedure.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You are an administrator and want to query the number of items in the <code class="codeph">sh.sales</code> table and the number of customers in the <code class="codeph">sh.customers</code> table.</p>
</li>
<li>
<p>You want these two queries to be monitored as a database operation named <code class="codeph">sh_count</code>.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To create a database operation:</p>
<ol>
<li>
<p>Start SQL*Plus and connect as a user with the appropriate privileges.</p>
</li>
<li>
<p>Define a variable to hold the execution ID.</p>
<p>For example, run the following SQL*Plus command:</p>
<pre dir="ltr">VAR eid NUMBER
</pre></li>
<li>
<p>Begin the database operation.</p>
<p>For example, execute the <code class="codeph">BEGIN_OPERATION</code> function as follows:</p>
<pre dir="ltr">EXEC :eid := DBMS_SQL_MONITOR.BEGIN_OPERATION(&#39;sh_count&#39;);
</pre></li>
<li>
<p>Run the queries in the operation.</p>
<p>For example, run the following statements:</p>
<pre dir="ltr">SQL&gt; SELECT count(*) FROM sh.sales;
 
  COUNT(*)
----------
    918843
 
SQL&gt; SELECT COUNT(*) FROM sh.customers;
 
  COUNT(*)
----------
     55500
</pre></li>
<li>
<p>End the database operation.</p>
<p>For example, execute the <code class="codeph">END_OPERATION</code> procedure as follows:</p>
<pre dir="ltr">EXEC DBMS_SQL_MONITOR.END_OPERATION(&#39;sh_count&#39;, :eid);
</pre></li>
<li>
<p>Confirm that the database operation completed.</p>
<p>For example, run the following query (sample output included):</p>
<pre dir="ltr">SELECT SUBSTR(DBOP_NAME, 1, 10), DBOP_EXEC_ID,
       SUBSTR(STATUS, 1, 10)
FROM  V$SQL_MONITOR 
WHERE DBOP_NAME IS NOT NULL
ORDER BY EXEC_ID;

DBOP_NAME     EXEC_ID STATUS
---------- ---------- ----------
sh_count            1 DONE
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444__GUID-166139DA-C9D1-445D-B061-AB1D4CC6A9C1">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68375" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68375"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SQL_MONITOR</code> package</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94608"></a><a id="TGSQL94607"></a>
<div class="props_rev_3"><a id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062"></a>
<h2 id="TGSQL-GUID-4048D00E-2635-42C8-A37D-71EFAC619062" class="sect2">Monitoring SQL Executions Using Cloud Control</h2>
<div>
<p>By default, AWR automatically captures SQL monitoring reports in XML format.</p>
<div class="section">
<p>The reports capture only SQL statements that are not executing or queued and have finished execution since the last capture cycle. AWR captures reports only for the most expensive statements according to elapsed execution time.</p>
<p>The Monitored SQL Executions page in Enterprise Manager Cloud Control (Cloud Control) summarizes the activity for monitored statements. You can use this page to drill down and obtain additional details about particular statements. The Monitored SQL Executions Details page uses data from several views, including the following:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">GV$SQL_MONITOR</code></p>
</li>
<li>
<p><code class="codeph">GV$SQL_PLAN_MONITOR</code></p>
</li>
<li>
<p><code class="codeph">GV$SQL_MONITOR_SESSTAT</code></p>
</li>
<li>
<p><code class="codeph">GV$SQL</code></p>
</li>
<li>
<p><code class="codeph">GV$SQL_PLAN</code></p>
</li>
<li>
<p><code class="codeph">GV$ACTIVE_SESSION_HISTORY</code></p>
</li>
<li>
<p><code class="codeph">GV$SESSION_LONGOPS</code></p>
</li>
<li>
<p><code class="codeph">DBA_HIST_REPORTS</code></p>
</li>
<li>
<p><code class="codeph">DBA_HIST_REPORTS_DETAILS</code></p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The user <code class="codeph">sh</code> is executing the following long-running parallel query of the sales made to each customer:</p>
<pre dir="ltr">SELECT c.cust_id, c.cust_last_name, c.cust_first_name, 
       s.prod_id, p.prod_name, s.time_id
FROM   sales s, customers c, products p
WHERE  s.cust_id = c.cust_id
AND    s.prod_id = p.prod_id
ORDER BY c.cust_id, s.time_id;
</pre></li>
<li>
<p>You want to ensure that the preceding query does not consume excessive resources. While the statement executes, you want to determine basic statistics about the database operation, such as the level of parallelism, the total database time, and number of I/O requests.</p>
</li>
<li>
<p>You use Cloud Control to monitor statement execution.</p>
<div class="infobox-note" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-4FC66F79-AC74-48FD-8C97-79FD7C410096">
<p class="notep1">Note:</p>
<p>To generate the SQL monitor report from the command line, run the <code class="codeph">REPORT_SQL_MONITOR</code> function in the <code class="codeph">DBMS_SQLTUNE</code> package, as in the following sample SQL*Plus script:</p>
<pre dir="ltr">VARIABLE my_rept CLOB
BEGIN
  :my_rept :=DBMS_SQLTUNE.REPORT_SQL_MONITOR();
END;
/
PRINT :my_rept
</pre></div>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To monitor SQL executions:</p>
<ol>
<li>
<p>Access the Monitored SQL Executions page, as described in <span class="q">&#34;<a href="tgsql_monit.htm#GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7" title="The Monitored SQL Executions shows information such as the SQL ID, database time, and I/O requests.">Monitored SQL Executions Page in Cloud Control</a>&#34;</span>.</p>
<p>In the following graphic, the top row shows the parallel query.</p>
<div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-118F05FF-1AEA-4492-8212-FF8747B861EB"><img width="840" height="223" src="img/GUID-7E9C8EE0-104C-48FE-8F12-EBDF303738CE-default.jpg" alt="Description of GUID-7E9C8EE0-104C-48FE-8F12-EBDF303738CE-default.jpg follows" title="Description of GUID-7E9C8EE0-104C-48FE-8F12-EBDF303738CE-default.jpg follows"/><br/>
<a href="img_text/GUID-7E9C8EE0-104C-48FE-8F12-EBDF303738CE-default.htm">Description of the illustration GUID-7E9C8EE0-104C-48FE-8F12-EBDF303738CE-default.jpg</a></div>
<!-- class="figure" -->
<p>In this example, the query has been executing for 1.4 minutes.</p>
</li>
<li>
<p>Click the value in the SQL ID column to see details about the statement.</p>
<p>The Monitored SQL Details page appears.</p>
<div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-046EFC89-FAC0-44C0-B07A-CAFF7B5EC0C0"><img width="1077" height="556" src="img/GUID-6D3990DC-1FD5-42C4-A656-E1CBB6F3260A-default.gif" alt="Description of GUID-6D3990DC-1FD5-42C4-A656-E1CBB6F3260A-default.gif follows" title="Description of GUID-6D3990DC-1FD5-42C4-A656-E1CBB6F3260A-default.gif follows"/><br/>
<a href="img_text/GUID-6D3990DC-1FD5-42C4-A656-E1CBB6F3260A-default.htm">Description of the illustration GUID-6D3990DC-1FD5-42C4-A656-E1CBB6F3260A-default.gif</a></div>
<!-- class="figure" -->
<p>The preceding report shows the execution plan and statistics relating to statement execution. For example, the Timeline column shows when each step of the execution plan was active. Times are shown relative to the beginning and end of the statement execution. The Executions column shows how many times an operation was executed.</p>
</li>
<li>
<p>In the Overview section, click the link next to the SQL text.</p>
<p>A message shows the full text of the SQL statement.</p>
<div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-19D6EE8B-B387-49E7-9FF7-7BE8EEE8E517"><img width="400" height="187" src="img/GUID-2C8B790E-10C8-48FA-A454-0038BBC624A1-default.gif" alt="Description of GUID-2C8B790E-10C8-48FA-A454-0038BBC624A1-default.gif follows" title="Description of GUID-2C8B790E-10C8-48FA-A454-0038BBC624A1-default.gif follows"/><br/>
<a href="img_text/GUID-2C8B790E-10C8-48FA-A454-0038BBC624A1-default.htm">Description of the illustration GUID-2C8B790E-10C8-48FA-A454-0038BBC624A1-default.gif</a></div>
<!-- class="figure" --></li>
<li>
<p>In the Time &amp; Wait Statistics section, next to Database Time, move the cursor over the largest portion on the bar graph.</p>
<p>A message shows that user I/O is consuming over half of database time.</p>
<div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-655F455D-5542-4CE7-9257-9AE2E98D56B7"><img width="286" height="127" src="img/GUID-09AEE7E3-85AE-4180-BBAB-2E75EDC21753-default.gif" alt="Description of GUID-09AEE7E3-85AE-4180-BBAB-2E75EDC21753-default.gif follows" title="Description of GUID-09AEE7E3-85AE-4180-BBAB-2E75EDC21753-default.gif follows"/><br/>
<a href="img_text/GUID-09AEE7E3-85AE-4180-BBAB-2E75EDC21753-default.htm">Description of the illustration GUID-09AEE7E3-85AE-4180-BBAB-2E75EDC21753-default.gif</a></div>
<!-- class="figure" -->
<p>Database Time measures the amount of time the database has spent working on this SQL statement. This value includes CPU and wait times, such as I/O time. The bar graph is divided into several color-coded portions to highlight CPU resources, user I/O resources, and other resources. You can move the cursor over any portion to view the percentage value of the total.</p>
</li>
<li>
<p>In the Details section, in the IO Requests column, move the cursor over the I/O requests bar to view the percentage value of the total.</p>
<p>A message appears.</p>
<div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-81041CAC-A1AC-4A5A-A999-12173E8D95B4"><img width="275" height="148" src="img/GUID-08D1BAD7-1D03-48F3-8EDE-1E9E1632705E-default.gif" alt="Description of GUID-08D1BAD7-1D03-48F3-8EDE-1E9E1632705E-default.gif follows" title="Description of GUID-08D1BAD7-1D03-48F3-8EDE-1E9E1632705E-default.gif follows"/><br/>
<a href="img_text/GUID-08D1BAD7-1D03-48F3-8EDE-1E9E1632705E-default.htm">Description of the illustration GUID-08D1BAD7-1D03-48F3-8EDE-1E9E1632705E-default.gif</a></div>
<!-- class="figure" -->
<p>In the preceding graphic, the IO Requests message shows the total number of read requests issued by the monitored SQL. The message shows that read requests form 80% of the total I/O requests.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-9DC5EB17-AA69-419D-A78D-D50B69A7755F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p>Cloud Control Online Help for descriptions of the elements on the Monitored SQL Executions Details page, and for complete descriptions of all statistics in the report.</p>
</li>
<li>
<p><a class="olink GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6" target="_blank" href="../REFRN/GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6.htm#GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">V$SQL_MONITOR</code> and related views for database operations monitoring</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4801">
<tr>
<td class="cellalignment4834">
<table class="cellalignment4806">
<tr>
<td class="cellalignment4805"><a href="tgsql_pt_mon.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4805"><a href="tgsql_stcb.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4836">
<table class="cellalignment4804">
<tr>
<td class="cellalignment4805"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4805"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4805"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4805"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4805"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4805"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>