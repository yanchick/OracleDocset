<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-106791"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Managing%20SQL%20Profiles"></a><title>Managing SQL Profiles</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-07-24T09:35:46Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SQL Tuning Guide"/>
<meta name="dcterms.identifier" content="E49106-14"/>
<meta name="dcterms.isVersionOf" content="TGSQL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="tgsql_pt_spm.htm" title="Previous" type="text/html"/>
<link rel="Next" href="tgsql_spm.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49106-14.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-C7FE0936-63B8-46EF-A03E-7E59F704606E"></a> <span id="PAGE" style="display:none;">35/40</span> <!-- End Header -->
<a id="TGSQL596"></a>
<h1 id="TGSQL-GUID-C7FE0936-63B8-46EF-A03E-7E59F704606E" class="sect1"><span class="enumeration_chapter">22</span> Managing SQL Profiles</h1>
<div>
<p>This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_profiles.htm#GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220" title="A SQL profile is a database object that contains auxiliary statistics specific to a SQL statement.">About SQL Profiles</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-350D0B3C-881D-4841-A8E8-C5EAF68AFB40" title="As a rule of thumb, implement a SQL profile recommended by SQL Tuning Advisor.">Implementing a SQL Profile</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-A10B0EA8-3215-4F58-9CBF-F23EFF6584EC">Listing SQL Profiles</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-EF674EC7-7C8B-4EDC-A94C-62A4A16BC166">Altering a SQL Profile</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-EE6AA78D-A7BA-4F27-8BE4-FAE4E1C7499C">Dropping a SQL Profile</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D" title="You can export a SQL profile from the SYS schema in one database to a staging table, and then import it from the staging table into another database. You can transport a SQL profile to any Oracle database created in the same release or later.">Transporting a SQL Profile</a></p>
</li>
</ul>
</div>
<a id="TGSQL597"></a>
<div class="props_rev_3"><a id="GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220"></a>
<h2 id="TGSQL-GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220" class="sect2">About SQL Profiles</h2>
<div>
<p>A <strong class="term">SQL profile</strong> is a database object that contains auxiliary statistics specific to a SQL statement.</p>
<p>Conceptually, a SQL profile is to a SQL statement what object-level statistics are to a table or index. SQL profiles are created when a DBA invokes SQL Tuning Advisor.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_profiles.htm#GUID-1197742C-0599-46F4-AFA4-D624CCDC7997" title="When profiling a SQL statement, SQL Tuning Advisor uses a specific set of bind values as input.">Purpose of SQL Profiles</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-41377192-7E26-47E2-9D36-6BAD85ED1367" title="A SQL profile is a collection of auxiliary statistics on a query, including all tables and columns referenced in the query. The profile is stored in the data dictionary. The optimizer uses this information during optimization to determine the most optimal plan.">Concepts for SQL Profiles</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-280110BE-2D94-4174-BA28-8FD731DF6F20">User Interfaces for SQL Profiles</a></p>
</li>
<li>
<p><a href="tgsql_profiles.htm#GUID-93C2D28A-D9D8-43CB-880B-6121E2DEF9E6" title="Basic tasks include accepting (implementing) a SQL profile, altering it, listing it, and dropping it.">Basic Tasks for SQL Profiles</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220__GUID-F5F14D24-9291-41DD-9B3B-B1D7D67C789B">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="tgsql_sqltune.htm#GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458" title="SQL Tuning Advisor is SQL diagnostic software in the Oracle Database Tuning Pack. You can submit one or more SQL statements as input to the advisor and receive advice or recommendations for how to tune the statements, along with a rationale and expected benefit.">About SQL Tuning Advisor</a>&#34;</span></p>
</div>
</div>
<a id="TGSQL598"></a>
<div class="props_rev_3"><a id="GUID-1197742C-0599-46F4-AFA4-D624CCDC7997"></a>
<h3 id="TGSQL-GUID-1197742C-0599-46F4-AFA4-D624CCDC7997" class="sect3">Purpose of SQL Profiles</h3>
<div>
<p>When profiling a SQL statement, SQL Tuning Advisor uses a specific set of bind values as input.</p>
<p>The advisor compares the optimizer estimate with values obtained by executing fragments of the statement on a data sample. When significant variances are found, SQL Tuning Advisor bundles corrective actions together in a SQL profile, and then recommends its acceptance.</p>
<p>The corrected statistics in a SQL profile can improve optimizer <a href="glossary.htm#GUID-FE541AF8-DCAB-4B00-8015-04BDCB295A85"><span class="xrefglossterm">cardinality</span></a> estimates, which in turn leads the optimizer to select better plans. SQL profiles provide the following benefits over other techniques for improving plans:</p>
<ul style="list-style-type: disc;">
<li>
<p>Unlike hints and stored outlines, SQL profiles do not tie the optimizer to a specific plan or subplan. SQL profiles fix incorrect estimates while giving the optimizer the flexibility to pick the best plan in different situations.</p>
</li>
<li>
<p>Unlike hints, no changes to application source code are necessary when using SQL profiles. The use of SQL profiles by the database is transparent to the user.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-1197742C-0599-46F4-AFA4-D624CCDC7997__GUID-581F8665-E013-4E2D-B7F4-0A02BAF3478D">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_influence.htm#GUID-C558F7CF-446E-4078-B045-0B3BB026CB3C">Influencing the Optimizer with Hints</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="tgsql_sqltune.htm#GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1" title="SQL Tuning Advisor is SQL diagnostic software in the Oracle Database Tuning Pack. You can submit one or more SQL statements as input to the advisor and receive advice or recommendations for how to tune the statements, along with a rationale and expected benefit.SQL Tuning Advisor is a mechanism for resolving problems related to suboptimally performing SQL statements. Automatic Tuning Optimizer is the central tool used by SQL Tuning Advisor. The advisor can receive SQL statements as input from multiple sources, analyze these statements using the optimizer, and then make recommendations.Configure SQL Tuning Advisor to run automatically using DBMS_AUTO_SQLTUNE, or on demand using DBMS_SQLTUNE.Input for SQL Tuning Advisor can come from several sources, including ADDM, AWR, the shared SQL area, and SQL tuning sets.After analyzing the SQL statements, SQL Tuning Advisor publishes recommendations.In tuning mode, the optimizer has more time to consider options and gather statistics.The optimizer relies on object statistics to generate execution plans. If these statistics are stale or missing, then the optimizer can generate suboptimal plans. Automatic Tuning Optimizer checks each query object for missing or stale statistics, and recommends gathering fresh statistics if needed.SQL profiling is the verification by the Automatic Tuning Optimizer of its own estimates.The database can profile some DML and DDL statements.If the optimizer generates auxiliary information during statistical analysis or SQL profiling, then the optimizer recommends implementing a SQL profile. An access path is the means by which the database retrieves data.During structural analysis, Automatic Tuning Optimizer tries to identify syntactic, semantic, or design problems that can lead to suboptimal performance. The goal is to identify poorly written SQL statements and to advise you how to restructure them.While tuning a SQL statement, SQL Tuning Advisor searches real-time and historical performance data for alternative execution plans for the statement.By default, the Automatic SQL Tuning task runs for in a nightly maintenance window.Configuring automatic SQL tuning instead of tuning manually decreases cost and increases manageabilityOracle Scheduler uses the automated maintenance tasks infrastructure (known as AutoTask) to schedules tasks to run automatically.This section explains the basic tasks in running SQL Tuning Advisor as an automatic task. You can enable and disable all automatic maintenance tasks, including the Automatic SQL Tuning task, using Cloud Control.If you do not use Cloud Control to enable and disable the Automatic SQL Tuning task, then you must use the command line.You can enable and disable all automatic maintenance tasks, including the Automatic SQL Tuning task, using Cloud Control. You must perform the operation as SYS or have the EXECUTE privilege on the PL/SQL package DBMS_AUTO_SQLTUNE.Automatic Database Diagnostic Monitor (ADDM) automatically identifies high-load SQL statements. If ADDM identifies such statements, then click Schedule/Run SQL Tuning Advisor on the Recommendation Detail page to run SQL Tuning Advisor.This section explains the basic tasks in running SQL Tuning Advisor using the DBMS_SQLTUNE package. To change the parameters of a tuning task after it has been created, execute the DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER function.">Analyzing SQL with SQL Tuning Advisor</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
</div>
<a id="TGSQL600"></a><a id="TGSQL599"></a>
<div class="props_rev_3"><a id="GUID-41377192-7E26-47E2-9D36-6BAD85ED1367"></a>
<h3 id="TGSQL-GUID-41377192-7E26-47E2-9D36-6BAD85ED1367" class="sect3">Concepts for SQL Profiles</h3>
<div>
<p>A SQL profile is a collection of auxiliary statistics on a query, including all tables and columns referenced in the query. The profile is stored in the data dictionary. The optimizer uses this information during optimization to determine the most optimal plan.</p>
<div class="infobox-note" id="GUID-41377192-7E26-47E2-9D36-6BAD85ED1367__GUID-EA4A2209-76CF-48A6-8249-E8748A3DFC63">
<p class="notep1">Note:</p>
<p>The SQL profile contains supplemental statistics for the entire <span class="italic">statement</span>, not individual <span class="italic">plans</span>. The profile does not itself determine a specific plan.</p>
</div>
<p>A SQL profile contains, among other statistics, a set of cardinality adjustments. The cardinality measure is based on sampling the <code class="codeph">WHERE</code> clause rather than on statistical projection. A profile uses parts of the query to determine whether the estimated cardinalities are close to the actual cardinalities and, if a mismatch exists, uses the corrected cardinalities. For example, if a SQL profile exists for <code class="codeph">SELECT * FROM t WHERE x=5 AND y=10</code>, then the profile stores the actual number of rows returned.</p>
<p>When choosing plans, the optimizer has the following sources of information:</p>
<ul style="list-style-type: disc;">
<li>
<p>The environment, which contains the database configuration, <a href="glossary.htm#GUID-CA223D31-C3CC-4037-9BAD-9AB69FDD4212"><span class="xrefglossterm">bind variable</span></a> values, <a href="glossary.htm#GUID-F9E13693-82F8-4FD3-8B9F-C58CA0DAEEB0"><span class="xrefglossterm">optimizer statistics</span></a>, data set, and so on</p>
</li>
<li>
<p>The supplemental statistics in the SQL profile</p>
</li>
</ul>
<p><a href="tgsql_profiles.htm#GUID-41377192-7E26-47E2-9D36-6BAD85ED1367__BABHHGEH">Figure 22-1</a> shows the relationship between a SQL statement and the SQL profile for this statement. The optimizer uses the SQL profile and the environment to generate an execution plan. In this example, the plan is in the <a href="glossary.htm#GUID-A9B279E2-7088-4029-8C94-4E8DD00B7E21"><span class="xrefglossterm">SQL plan baseline</span></a> for the statement.</p>
<div class="figure" id="GUID-41377192-7E26-47E2-9D36-6BAD85ED1367__BABHHGEH">
<p class="titleinfigure">Figure 22-1 SQL Profile</p>
<img width="594" height="221" src="img/GUID-E3FD645C-DEB8-4A66-BCC4-56BCC0289E70-default.gif" alt="Description of Figure 22-1 follows" title="Description of Figure 22-1 follows"/><br/>
<a href="img_text/GUID-E3FD645C-DEB8-4A66-BCC4-56BCC0289E70-print.htm">Description of &#34;Figure 22-1 SQL Profile&#34;</a></div>
<!-- class="figure" -->
<p>If either the optimizer environment or SQL profile changes, then the optimizer can create a new plan. As tables grow, or as indexes are created or dropped, the plan for a SQL profile can change. The profile continues to be relevant even if the data distribution or access path of the corresponding statement changes. In general, you do not need to refresh SQL profiles.</p>
<p>Over time, profile content can become outdated. In this case, performance of the SQL statement may degrade. The statement may appear as high-load or top SQL. In this case, the Automatic SQL Tuning task again captures the statement as high-load SQL. You can implement a new SQL profile for the statement.</p>
<p>Internally, a SQL profile is implemented using hints that address different types of problems. These hints do not specify any particular plan. Rather, the hints correct errors in the optimizer estimation algorithm that lead to suboptimal plans. For example, a profile may use the <code class="codeph">TABLE_STATS</code> hint to set object statistics for tables when the statistics are missing or stale.</p>
<div class="infoboxnotealso" id="GUID-41377192-7E26-47E2-9D36-6BAD85ED1367__GUID-EF3B351A-3C80-4323-B412-50502089F458">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_spm.htm#GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617" title="Both SQL profiles and SQL plan baselines help improve the performance of SQL statements by ensuring that the optimizer uses only optimal plans.">Differences Between SQL Plan Baselines and SQL Profiles</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="tgsql_statscon.htm#GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E" title="The optimizer cost model relies on statistics collected about the objects involved in a query, and the database and host where the query runs.">Introduction to Optimizer Statistics</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<a id="TGSQL602"></a><a id="TGSQL601"></a>
<div class="props_rev_3"><a id="GUID-943DA3BA-BD26-40F8-863E-B5C5AD113969"></a>
<h4 id="TGSQL-GUID-943DA3BA-BD26-40F8-863E-B5C5AD113969" class="sect4">SQL Profile Recommendations</h4>
<div>
<p>As explained in <span class="q">&#34;<a href="tgsql_sqltune.htm#GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF" title="SQL profiling is the verification by the Automatic Tuning Optimizer of its own estimates.">SQL Profiling</a>&#34;</span>, SQL Tuning Advisor invokes Automatic Tuning Optimizer to generate SQL profile recommendations. Recommendations to implement SQL profiles occur in a finding, which appears in a separate section of the SQL Tuning Advisor report.</p>
<p>When you implement (or accept) a SQL profile, the database creates the profile and stores it persistently in the data dictionary. However, the SQL profile information is not exposed through regular dictionary views.</p>
<div class="infoboxnotealso" id="GUID-943DA3BA-BD26-40F8-863E-B5C5AD113969__GUID-AC0B0B8D-4DA9-4E2D-9D70-D41BC17F6724">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink VLDBG0103" target="_blank" href="../VLDBG/GUID-76AC9190-43AC-4529-89AD-1BDA95C6DFBD.htm#VLDBG0103"><span class="italic">Oracle Database VLDB and Partitioning Guide</span></a> to learn more about Auto DOP</p>
</li>
<li>
<p><a class="olink ARPLS68398" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68398"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DBMS_SQLTUNE.ACCEPT_SQL_PROFILE</code> procedure</p>
</li>
</ul>
</div>
<div class="example" id="GUID-943DA3BA-BD26-40F8-863E-B5C5AD113969__GUID-650304C5-05F8-4E3E-9F2F-BB1BBB90C999">
<p class="titleinexample">Example 22-1 SQL Profile Recommendation</p>
<p>In this example, the database found a better plan for a <code class="codeph">SELECT</code> statement that uses several expensive joins. The database recommends running <code class="codeph">DBMS_SQLTUNE.ACCEPT_SQL_PROFILE</code> to implement the profile, which enables the statement to run 98.53% faster.</p>
<pre dir="ltr">-------------------------------------------------------------------------------
FINDINGS SECTION (2 findings)
-------------------------------------------------------------------------------
 
1- SQL Profile Finding (see explain plans section below)
--------------------------------------------------------
  A potentially better execution plan was found for this statement. Choose
  one of the following SQL profiles to implement.
 
  Recommendation (estimated benefit: 99.45%)
  ------------------------------------------
  - Consider accepting the recommended SQL profile.
    execute dbms_sqltune.accept_sql_profile(task_name =&gt; &#39;my_task&#39;,
            object_id =&gt; 3, task_owner =&gt; &#39;SH&#39;, replace =&gt; TRUE);
 
  Validation results
  ------------------
  The SQL profile was tested by executing both its plan and the original plan
  and measuring their respective execution statistics. A plan may have been
  only partially executed if the other could be run to completion in less time.
 
                           Original Plan  With SQL Profile  % Improved
                           -------------  ----------------  ----------
  Completion Status:             PARTIAL          COMPLETE
  Elapsed Time(us):            15467783            226902      98.53 %
  CPU Time(us):                15336668            226965      98.52 %
  User I/O Time(us):                  0                 0
  Buffer Gets:                  3375243             18227      99.45 %
  Disk Reads:                         0                 0
  Direct Writes:                      0                 0
  Rows Processed:                     0               109
  Fetches:                            0               109
  Executions:                         0                 1
 
  Notes
  -----
  1. The SQL profile plan was first executed to warm the buffer cache.
  2. Statistics for the SQL profile plan were averaged over next 3 executions.
</pre>
<p>Sometimes SQL Tuning Advisor may recommend implementing a profile that uses the Automatic Degree of Parallelism (Auto DOP) feature. A parallel query profile is only recommended when the original plan is serial and when parallel execution can significantly reduce the elapsed time for a long-running query.</p>
<p>When it recommends a profile that uses Auto DOP, SQL Tuning Advisor gives details about the performance overhead of using parallel execution for the SQL statement in the report. For parallel execution recommendations, SQL Tuning Advisor may provide two SQL profile recommendations, one using serial execution and one using parallel.</p>
<p>The following example shows a parallel query recommendation. In this example, a degree of parallelism of 7 improves response time significantly at the cost of increasing resource consumption by almost 25%. You must decide whether the reduction in database throughput is worth the increase in response time.</p>
<pre dir="ltr">  Recommendation (estimated benefit: 99.99%)
  ------------------------------------------
  - Consider accepting the recommended SQL profile to use parallel execution
    for this statement.
    execute dbms_sqltune.accept_sql_profile(task_name =&gt; &#39;gfk_task&#39;,
            object_id =&gt; 3, task_owner =&gt; &#39;SH&#39;, replace =&gt; TRUE,
            profile_type =&gt; DBMS_SQLTUNE.PX_PROFILE);
 
  Executing this query parallel with DOP 7 will improve its response time
  82.22% over the SQL profile plan. However, there is some cost in enabling
  parallel execution. It will increase the statement&#39;s resource consumption by
  an estimated 24.43% which may result in a reduction of system throughput.
  Also, because these resources are consumed over a much smaller duration, the
  response time of concurrent statements might be negatively impacted if
  sufficient hardware capacity is not available.
 
  The following data shows some sampled statistics for this SQL from the past
  week and projected weekly values when parallel execution is enabled.
 
                                 Past week sampled statistics for this SQL
                                 -----------------------------------------
  Number of executions                                                   0
  Percent of total activity                                            .29
  Percent of samples with #Active Sessions &gt; 2*CPU                       0
  Weekly DB time (in sec)                                            76.51
 
                              Projected statistics with Parallel Execution
                              --------------------------------------------
  Weekly DB time (in sec)                                            95.21
</pre></div>
<!-- class="example" --></div>
</div>
<a id="TGSQL603"></a>
<div class="props_rev_3"><a id="GUID-D930A2C3-8769-46FB-9B60-E363B98013F6"></a>
<h4 id="TGSQL-GUID-D930A2C3-8769-46FB-9B60-E363B98013F6" class="sect4">SQL Profiles and SQL Plan Baselines</h4>
<div>
<p>You can use SQL profiles with or without <a href="glossary.htm#GUID-7504D0DE-9297-476C-808B-EDCDB1EF43E0"><span class="xrefglossterm">SQL plan management</span></a>. No strict relationship exists between the SQL profile and the plan baseline. If a statement has multiple plans in a SQL plan baseline, then a SQL profile is useful because it enables the optimizer to choose the lowest-cost plan in the baseline.</p>
<div class="infoboxnotealso" id="GUID-D930A2C3-8769-46FB-9B60-E363B98013F6__GUID-23A76F4E-C141-45F5-91E4-AF6240842CD6">
<p class="notep1">See Also:</p>
<p><a href="tgsql_spm.htm#GUID-7024369A-F98D-48E4-921C-C899485C954F" title="You can manage SQL plan baselines using the DBMS_SPM package.">Managing SQL Plan Baselines</a></p>
</div>
</div>
</div>
</div>
<a id="TGSQL604"></a>
<div class="props_rev_3"><a id="GUID-280110BE-2D94-4174-BA28-8FD731DF6F20"></a>
<h3 id="TGSQL-GUID-280110BE-2D94-4174-BA28-8FD731DF6F20" class="sect3">User Interfaces for SQL Profiles</h3>
<div>
<div class="section">
<p>Oracle Enterprise Manager Cloud Control (Cloud Control) usually handles SQL profiles as part of automatic SQL tuning.</p>
<p>On the command line, you can manage SQL profiles with the <code class="codeph">DBMS_SQLTUNE</code> package. To use the APIs, you must have the <code class="codeph">ADMINISTER SQL MANAGEMENT OBJECT</code> privilege.</p>
<div class="infoboxnotealso" id="GUID-280110BE-2D94-4174-BA28-8FD731DF6F20__GUID-2FB91677-BFC0-41B3-9BD5-1A3D0D3BE0BE">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS220" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS220"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code class="codeph">DBMS_SQLTUNE</code> package</p>
</li>
<li>
<p><a class="olink TDPPT163" target="_blank" href="../TDPPT/tdppt_sqltune.htm#TDPPT163"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a> to learn how to manage SQL profiles with Cloud Control</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL606"></a><a id="TGSQL605"></a>
<div class="props_rev_3"><a id="GUID-93C2D28A-D9D8-43CB-880B-6121E2DEF9E6"></a>
<h3 id="TGSQL-GUID-93C2D28A-D9D8-43CB-880B-6121E2DEF9E6" class="sect3">Basic Tasks for SQL Profiles</h3>
<div>
<p>Basic tasks include accepting (implementing) a SQL profile, altering it, listing it, and dropping it.</p>
<p>The following graphic shows the basic workflow.</p>
<div class="figure" id="GUID-93C2D28A-D9D8-43CB-880B-6121E2DEF9E6__BABIJIIH">
<p class="titleinfigure">Figure 22-2 Managing SQL Profiles</p>
<img width="500" height="389" src="img/GUID-C377D299-8CAE-437B-B1E4-2EE696A61807-default.png" alt="Description of Figure 22-2 follows" title="Description of Figure 22-2 follows"/><br/>
<a href="img_text/GUID-C377D299-8CAE-437B-B1E4-2EE696A61807-print.htm">Description of &#34;Figure 22-2 Managing SQL Profiles&#34;</a></div>
<!-- class="figure" -->
<p>Typically, you manage SQL profiles in the following sequence:</p>
<ol>
<li>
<p>Implement a recommended SQL profile.</p>
<p><span class="q">&#34;<a href="tgsql_profiles.htm#GUID-350D0B3C-881D-4841-A8E8-C5EAF68AFB40" title="As a rule of thumb, implement a SQL profile recommended by SQL Tuning Advisor.">Implementing a SQL Profile</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Obtain information about SQL profiles stored in the database.</p>
<p><span class="q">&#34;<a href="tgsql_profiles.htm#GUID-A10B0EA8-3215-4F58-9CBF-F23EFF6584EC">Listing SQL Profiles</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Optionally, modify the implemented SQL profile.</p>
<p><span class="q">&#34;<a href="tgsql_profiles.htm#GUID-EF674EC7-7C8B-4EDC-A94C-62A4A16BC166">Altering a SQL Profile</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Drop the implemented SQL profile when it is no longer needed.</p>
<p><span class="q">&#34;<a href="tgsql_profiles.htm#GUID-EE6AA78D-A7BA-4F27-8BE4-FAE4E1C7499C">Dropping a SQL Profile</a>&#34;</span> describes this task.</p>
</li>
</ol>
<p>To tune SQL statements on another database, you can transport both a SQL tuning set and a SQL profile to a separate database. <span class="q">&#34;<a href="tgsql_profiles.htm#GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D" title="You can export a SQL profile from the SYS schema in one database to a staging table, and then import it from the staging table into another database. You can transport a SQL profile to any Oracle database created in the same release or later.">Transporting a SQL Profile</a>&#34;</span> describes this task.</p>
<div class="infoboxnotealso" id="GUID-93C2D28A-D9D8-43CB-880B-6121E2DEF9E6__GUID-AEB3CD39-84F8-47B8-8CB6-B4525BD36CC4">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS220" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS220"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about the <code class="codeph">DBMS_SQLTUNE</code> package</p>
</div>
</div>
</div>
</div>
<a id="TGSQL607"></a>
<div class="props_rev_3"><a id="GUID-350D0B3C-881D-4841-A8E8-C5EAF68AFB40"></a>
<h2 id="TGSQL-GUID-350D0B3C-881D-4841-A8E8-C5EAF68AFB40" class="sect2">Implementing a SQL Profile</h2>
<div>
<p>Implementing (also known as accepting) a SQL profile means storing it persistently in the database. A profile must be implemented before the optimizer can use it as input when generating plans.</p>
</div>
<a id="TGSQL608"></a>
<div class="props_rev_3"><a id="GUID-5EF6DC38-6118-48B4-8162-56E7C4570C1B"></a>
<h3 id="TGSQL-GUID-5EF6DC38-6118-48B4-8162-56E7C4570C1B" class="sect3">About SQL Profile Implementation</h3>
<div>
<p>As a rule of thumb, implement a SQL profile recommended by SQL Tuning Advisor.</p>
<p>If the database recommends both an index and a SQL profile, then either use both or use the SQL profile only. If you create an index, then the optimizer may need the profile to pick the new index.</p>
<p>In some situations, SQL Tuning Advisor may find an improved serial plan in addition to an even better parallel plan. In this case, the advisor recommends both a standard and a parallel SQL profile, enabling you to choose between the best serial and best parallel plan for the statement. Implement a parallel plan only if the increase in response time is worth the decrease in throughput.</p>
<p>To implement a SQL profile, execute the <code class="codeph">DBMS_SQLTUNE.ACCEPT_SQL_PROFILE</code> procedure. Some important parameters are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">profile_type</code></p>
<p>Set this parameter to <code class="codeph">REGULAR_PROFILE</code> for a SQL profile without a change to parallel execution, or <code class="codeph">PX_PROFLE</code> for a SQL profile with a change to parallel execution.</p>
</li>
<li>
<p><code class="codeph">force_match</code></p>
<p>This parameter controls statement matching. Typically, an accepted SQL profile is associated with the SQL statement through a <a href="glossary.htm#GUID-160EB64E-536F-4313-B7B0-191C2719CF1F"><span class="xrefglossterm">SQL signature</span></a> that is generated using a hash function. This hash function changes the SQL statement to upper case and removes all extra whitespace before generating the signature. Thus, the same SQL profile works for all SQL statements in which the only difference is case and white spaces.</p>
<p>By setting <code class="codeph">force_match</code> to <code class="codeph">true</code>, the SQL profile additionally targets all SQL statements that have the same text after the literal values in the <code class="codeph">WHERE</code> clause have been replaced by bind variables. This setting may be useful for applications that use only literal values because it enables SQL with text differing only in its literal values to share a SQL profile. If both literal values and bind variables are in the SQL text, or if <code class="codeph">force_match</code> is set to <code class="codeph">false</code> (default), then the literal values in the <code class="codeph">WHERE</code> clause are not replaced by bind variables.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-5EF6DC38-6118-48B4-8162-56E7C4570C1B__GUID-E20C9F72-FC97-4C4E-BE01-4D4DB8082F68">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS220" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS220"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about the <code class="codeph">ACCEPT_SQL_PROFILE</code> procedure</p>
</div>
</div>
</div>
<a id="TGSQL94966"></a><a id="TGSQL609"></a>
<div class="props_rev_3"><a id="GUID-B31665FC-A81A-46EE-B04C-39A3AC6C0F47"></a>
<h3 id="TGSQL-GUID-B31665FC-A81A-46EE-B04C-39A3AC6C0F47" class="sect3">Implementing a SQL Profile</h3>
<div>
<div class="section">
<p>This section shows how to use the <code class="codeph">ACCEPT_SQL_PROFILE</code> procedure to implement a SQL profile.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The SQL Tuning Advisor task <code class="codeph">STA_SPECIFIC_EMP_TASK</code> includes a recommendation to create a SQL profile.</p>
</li>
<li>
<p>The name of the SQL profile is <code class="codeph">my_sql_profile</code>.</p>
</li>
<li>
<p>The PL/SQL block accepts a profile that uses parallel execution (<code class="codeph">profile_type</code>).</p>
</li>
<li>
<p>The profile uses force matching.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To implement a SQL profile:</p>
<ul style="list-style-type: disc;">
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then execute the <code class="codeph">ACCEPT_SQL_PROFILE</code> function.</p>
<p>For example, execute the following PL/SQL:</p>
<pre dir="ltr">DECLARE
  my_sqlprofile_name VARCHAR2(30);
BEGIN
  my_sqlprofile_name := DBMS_SQLTUNE.ACCEPT_SQL_PROFILE ( 
    task_name    =&gt; &#39;STA_SPECIFIC_EMP_TASK&#39;
,   name         =&gt; &#39;my_sql_profile&#39;
,   profile_type =&gt; DBMS_SQLTUNE.PX_PROFILE
,   force_match  =&gt; true 
);
END;
/
</pre></li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-B31665FC-A81A-46EE-B04C-39A3AC6C0F47__GUID-87C727FA-76A8-48E3-AE6C-91BDFAE1663F">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68398" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68398"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DBMS_SQLTUNE.ACCEPT_SQL_PROFILE</code> procedure</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL610"></a>
<div class="props_rev_3"><a id="GUID-A10B0EA8-3215-4F58-9CBF-F23EFF6584EC"></a>
<h2 id="TGSQL-GUID-A10B0EA8-3215-4F58-9CBF-F23EFF6584EC" class="sect2">Listing SQL Profiles</h2>
<div>
<div class="section">
<p>The data dictionary view <code class="codeph">DBA_SQL_PROFILES</code> stores SQL profiles persistently in the database. The statistics are in an Oracle internal format, so you cannot query profiles directly. However, you can list profiles.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To list SQL profiles:</p>
<ul style="list-style-type: disc;">
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then query the <code class="codeph">DBA_SQL_PROFILES</code> view.</p>
<p>For example, execute the following query:</p>
<pre dir="ltr">COLUMN category FORMAT a10
COLUMN sql_text FORMAT a20

SELECT NAME, SQL_TEXT, CATEGORY, STATUS
FROM   DBA_SQL_PROFILES;
</pre>
<p>Sample output appears below:</p>
<pre dir="ltr">NAME                           SQL_TEXT             CATEGORY   STATUS
------------------------------ -------------------- ---------- --------
SYS_SQLPROF_01285f6d18eb0000   select promo_name, c DEFAULT    ENABLED
                               ount(*) c from promo
                               tions p, sales s whe
                               re s.promo_id = p.pr
                               omo_id and p.promo_c
                               ategory = &#39;internet&#39;
                                group by p.promo_na
                               me order by c desc
</pre></li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-A10B0EA8-3215-4F58-9CBF-F23EFF6584EC__GUID-5E637819-C7A8-498B-A988-66EAB4F933C1">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN23477" target="_blank" href="../REFRN/GUID-1F27F94F-B567-42E1-8AC4-C015F8327610.htm#REFRN23477"><span class="italic">Oracle Database Reference</span></a> to learn about the <code class="codeph">DBA_SQL_PROFILES</code> view</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL611"></a>
<div class="props_rev_3"><a id="GUID-EF674EC7-7C8B-4EDC-A94C-62A4A16BC166"></a>
<h2 id="TGSQL-GUID-EF674EC7-7C8B-4EDC-A94C-62A4A16BC166" class="sect2">Altering a SQL Profile</h2>
<div>
<div class="section">
<p>You can alter attributes of an existing SQL profile using the <code class="codeph">attribute_name</code> parameter of the <code class="codeph">ALTER_SQL_PROFILE</code> procedure.</p>
<p>The <code class="codeph">CATEGORY</code> attribute determines which sessions can apply a profile. View the <code class="codeph">CATEGORY</code> attribute by querying <code class="codeph">DBA_SQL_PROFILES.CATEGORY</code>. By default, all profiles are in the <code class="codeph">DEFAULT</code> category, which means that all sessions in which the <code class="codeph">SQLTUNE_CATEGORY</code> initialization parameter is set to <code class="codeph">DEFAULT</code> can use the profile.</p>
<p>By altering the category of a SQL profile, you determine which sessions are affected by profile creation. For example, by setting the category to <code class="codeph">DEV</code>, only sessions in which the <code class="codeph">SQLTUNE_CATEGORY</code> initialization parameter is set to <code class="codeph">DEV</code> can use the profile. Other sessions do not have access to the SQL profile and execution plans for SQL statements are not impacted by the SQL profile. This technique enables you to test a profile in a restricted environment before making it available to other sessions.</p>
<p>The example in this section assumes that you want to change the category of the SQL profile so it is used only by sessions with the SQL profile category set to <code class="codeph">TEST</code>, run the SQL statement, and then change the profile category back to <code class="codeph">DEFAULT</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To alter a SQL profile:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then use the <code class="codeph">ALTER_SQL_PROFILE</code> procedure to set the <code class="codeph">attribute_name</code>.</p>
<p>For example, execute the following code to set the attribute <code class="codeph">CATEGORY</code> to <code class="codeph">TEST</code>:</p>
<pre dir="ltr">VARIABLE pname my_sql_profile
BEGIN DBMS_SQLTUNE.ALTER_SQL_PROFILE ( 
   name            =&gt;  :pname
,  attribute_name  =&gt;  &#39;CATEGORY&#39;
,  value           =&gt;  &#39;TEST&#39;      
);
END;
</pre></li>
<li>
<p>Change the initialization parameter setting in the current database session.</p>
<p>For example, execute the following SQL:</p>
<pre dir="ltr">ALTER SESSION SET SQLTUNE_CATEGORY = &#39;TEST&#39;;
</pre></li>
<li>
<p>Test the profiled SQL statement.</p>
</li>
<li>
<p>Use the <code class="codeph">ALTER_SQL_PROFILE</code> procedure to set the <code class="codeph">attribute_name</code>.</p>
<p>For example, execute the following code to set the attribute <code class="codeph">CATEGORY</code> to <code class="codeph">DEFAULT</code>:</p>
<pre dir="ltr">VARIABLE pname my_sql_profile
BEGIN 
  DBMS_SQLTUNE.ALTER_SQL_PROFILE ( 
     name            =&gt;  :pname
,    attribute_name  =&gt;  &#39;CATEGORY&#39;
,    value           =&gt;  &#39;DEFAULT&#39;   
);
END;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-EF674EC7-7C8B-4EDC-A94C-62A4A16BC166__GUID-D1F7E260-32C6-4490-9B61-E0A2DC0ED8E8">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN10257" target="_blank" href="../REFRN/GUID-4467E322-6035-4A06-9BA9-2FF4BC753053.htm#REFRN10257"><span class="italic">Oracle Database Reference</span></a> to learn about the <code class="codeph">SQLTUNE_CATEGORY</code> initialization parameter</p>
</li>
<li>
<p><a class="olink ARPLS68402" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68402"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">ALTER_SQL_PROFILE</code> procedure</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94967"></a><a id="TGSQL612"></a>
<div class="props_rev_3"><a id="GUID-EE6AA78D-A7BA-4F27-8BE4-FAE4E1C7499C"></a>
<h2 id="TGSQL-GUID-EE6AA78D-A7BA-4F27-8BE4-FAE4E1C7499C" class="sect2">Dropping a SQL Profile</h2>
<div>
<div class="section">
<p>You can drop a SQL profile with the <code class="codeph">DROP_SQL_PROFILE</code> procedure.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This section assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You want to drop <code class="codeph">my_sql_profile</code>.</p>
</li>
<li>
<p>You want to ignore errors raised if the name does not exist.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To drop a SQL profile:</p>
<ul style="list-style-type: disc;">
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, call the <code class="codeph">DBMS_SQLTUNE.DROP_SQL_PROFILE</code> procedure.</p>
<p>The following example drops the profile named <code class="codeph">my_sql_profile</code>:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.DROP_SQL_PROFILE ( 
    name =&gt; &#39;my_sql_profile&#39; 
);
END;
/
</pre></li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-EE6AA78D-A7BA-4F27-8BE4-FAE4E1C7499C__GUID-DDE86E81-C28E-45C1-9EC4-19373633AAF7">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS68418" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68418"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DROP_SQL_PROFILE</code> procedure</p>
</li>
<li>
<p><a class="olink REFRN10257" target="_blank" href="../REFRN/GUID-4467E322-6035-4A06-9BA9-2FF4BC753053.htm#REFRN10257"><span class="italic">Oracle Database Reference</span></a> to learn about the <code class="codeph">SQLTUNE_CATEGORY</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL614"></a><a id="TGSQL94968"></a><a id="TGSQL613"></a>
<div class="props_rev_3"><a id="GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D"></a>
<h2 id="TGSQL-GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D" class="sect2">Transporting a SQL Profile</h2>
<div>
<p>You can export a SQL profile from the <code class="codeph">SYS</code> schema in one database to a staging table, and then import it from the staging table into another database. You can transport a SQL profile to any Oracle database created in the same release or later.</p>
<div class="section">
<p><a href="tgsql_profiles.htm#GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D__BABHHJAF" title="SQLTUNE APIs">Table 22-1</a> shows the main procedures and functions for managing SQL profiles.</p>
<div class="tblformal" id="GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D__BABHHJAF">
<p class="titleintable">Table 22-1 APIs for Transporting SQL Profiles</p>
<table class="cellalignment4808" title="APIs for Transporting SQL Profiles" summary="SQLTUNE APIs">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4839" id="d122842e1945">Procedure or Function</th>
<th class="cellalignment4839" id="d122842e1948">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d122842e1953" headers="d122842e1945">
<p><code class="codeph">CREATE_STGTAB_SQLPROF</code></p>
</td>
<td class="cellalignment4802" headers="d122842e1953 d122842e1948">
<p>Creates the staging table used for copying SQL profiles from one system to another.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d122842e1961" headers="d122842e1945">
<p><code class="codeph">PACK_STGTAB_SQLPROF</code></p>
</td>
<td class="cellalignment4802" headers="d122842e1961 d122842e1948">
<p>Moves profile data out of the <code class="codeph">SYS</code> schema into the staging table.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d122842e1972" headers="d122842e1945">
<p><code class="codeph">UNPACK_STGTAB_SQLPROF</code></p>
</td>
<td class="cellalignment4802" headers="d122842e1972 d122842e1948">
<p>Uses the profile data stored in the staging table to create profiles on this system.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The following graphic shows the basic workflow of transporting SQL profiles.</p>
<div class="figure" id="GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D__GUID-834E79B6-7318-48C2-87B2-5B59BF050184">
<p class="titleinfigure">Figure 22-3 Transporting SQL Profiles</p>
<img width="254" height="263" src="img/GUID-992CD1CD-5631-47FF-B735-275D53F8CC9A-default.png" alt="Description of Figure 22-3 follows" title="Description of Figure 22-3 follows"/><br/>
<a href="img_text/GUID-992CD1CD-5631-47FF-B735-275D53F8CC9A-print.htm">Description of &#34;Figure 22-3 Transporting SQL Profiles&#34;</a></div>
<!-- class="figure" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You want to transport <code class="codeph">my_profile</code> from a production database to a test database.</p>
</li>
<li>
<p>You want to create the staging table in the <code class="codeph">dba1</code> schema.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To transport a SQL profile:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then use the <code class="codeph">CREATE_STGTAB_SQLPROF</code> procedure to create a staging table to hold the SQL profiles.</p>
<p>The following example creates <code class="codeph">my_staging_table</code> in the <code class="codeph">dba1</code> schema:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.CREATE_STGTAB_SQLPROF ( 
    table_name  =&gt; &#39;my_staging_table&#39;
,   schema_name =&gt; &#39;dba1&#39; 
);
END;
/
</pre></li>
<li>
<p>Use the <code class="codeph">PACK_STGTAB_SQLPROF</code> procedure to export SQL profiles into the staging table.</p>
<p>The following example populates <code class="codeph">dba1.my_staging_table</code> with the SQL profile <code class="codeph">my_profile</code>:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.PACK_STGTAB_SQLPROF (  
    profile_name         =&gt; &#39;my_profile&#39;
,   staging_table_name   =&gt; &#39;my_staging_table&#39;
,   staging_schema_owner =&gt; &#39;dba1&#39; 
);
END;
/ 
</pre></li>
<li>
<p>Move the staging table to the database where you plan to unpack the SQL profiles.</p>
<p>Move the table using your utility of choice. For example, use Oracle Data Pump or a database link.</p>
</li>
<li>
<p>On the database where you plan to import the SQL profiles, use <code class="codeph">UNPACK_STGTAB_SQLPROF</code> to unpack SQL profiles from the staging table.</p>
<p>The following example shows how to unpack SQL profiles in the staging table:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.UNPACK_STGTAB_SQLPROF(
     replace            =&gt; true
,    staging_table_name =&gt; &#39;my_staging_table&#39;
);
END;
/
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-147E953C-C6BD-4A4A-BAD6-A269DB72CE9D__GUID-C6966ECF-E518-4AD6-8742-79346FCCC4DA">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS220" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS220"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for complete reference information about <code class="codeph">DBMS_SQLTUNE</code></p>
</li>
<li>
<p><a class="olink SUTIL100" target="_blank" href="../SUTIL/GUID-17FAE261-0972-4220-A2E4-44D479F519D4.htm#SUTIL100"><span><cite>Oracle Database Utilities</cite></span></a> to learn how to use Oracle Data Pump</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4801">
<tr>
<td class="cellalignment4834">
<table class="cellalignment4806">
<tr>
<td class="cellalignment4805"><a href="tgsql_pt_spm.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4805"><a href="tgsql_spm.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4836">
<table class="cellalignment4804">
<tr>
<td class="cellalignment4805"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4805"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4805"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4805"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4805"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4805"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>