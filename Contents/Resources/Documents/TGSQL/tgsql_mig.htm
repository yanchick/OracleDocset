<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-106787"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Migrating%20Stored%20Outlines%20to%20SQL%20Plan%20Baselines"></a><title>Migrating Stored Outlines to SQL Plan Baselines</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance."/>
<meta name="keywords" content=", stored outlines, purpose of migrating, categories"/>
<meta name="dcterms.created" content="2017-07-24T09:35:46Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SQL Tuning Guide"/>
<meta name="dcterms.identifier" content="E49106-14"/>
<meta name="dcterms.isVersionOf" content="TGSQL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="tgsql_spm.htm" title="Previous" type="text/html"/>
<link rel="Next" href="tgsql_indc.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49106-14.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A"></a> <span id="PAGE" style="display:none;">37/40</span> <!-- End Header -->
<a id="TGSQL665"></a>
<h1 id="TGSQL-GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" class="sect1"><span class="enumeration_chapter">24</span> Migrating Stored Outlines to SQL Plan Baselines</h1>
<div>
<p><span class="bold">Stored outline migration</span> is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.</p>
<p>This chapter explains the concepts and tasks relating to stored outline migration. This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_mig.htm#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="If you rely on stored outlines to maintain plan stability and prevent performance regressions, then you can safely migrate from stored outlines to SQL plan baselines. After the migration, you can maintain the same plan stability while benefiting from the features provided by the SQL Plan Management framework.To migrate stored outlines, you specify the stores outlines. The database then creates and updates SQL plan baselines.An outline is a set of hints, whereas a SQL plan baseline is a set of plans.You can use the DBMS_SPM package to perform the stored outline migration.">About Stored Outline Migration</a></p>
</li>
<li>
<p><a href="tgsql_mig.htm#GUID-729D65C2-5161-4229-BF71-5419B9FD1F85">Preparing for Stored Outline Migration</a></p>
</li>
<li>
<p><a href="tgsql_mig.htm#GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7">Migrating Outlines to Utilize SQL Plan Management Features</a></p>
</li>
<li>
<p><a href="tgsql_mig.htm#GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" title="You can migrate stored outlines to SQL plan baselines and preserve the original behavior of the stored outlines by creating fixed plan baselines.">Migrating Outlines to Preserve Stored Outline Behavior</a></p>
</li>
<li>
<p><a href="tgsql_mig.htm#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" title="After migrating outlines to SQL plan baselines, you must perform some follow-up work.">Performing Follow-Up Tasks After Stored Outline Migration</a></p>
</li>
</ul>
<div class="infobox-note" id="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A__GUID-18B7AD6D-603D-49F0-91D2-31C2074E6AEB">
<p class="notep1">Note:</p>
<p>Starting in Oracle Database 12<span class="italic">c</span>, stored outlines are deprecated. See <span class="q">&#34;<a href="tgsql_mig.htm#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">Migrating Stored Outlines to SQL Plan Baselines</a>&#34;</span> for an alternative.</p>
</div>
</div>
<a id="TGSQL666"></a>
<div class="props_rev_3"><a id="GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7"></a>
<h2 id="TGSQL-GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" class="sect2">About Stored Outline Migration</h2>
<div>
<p>A <span class="bold">stored outline</span> is a set of hints for a SQL statement. The hints direct the optimizer to choose a specific plan for the statement. A stored outline is a legacy technique for providing plan stability.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_mig.htm#GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91" title="If you rely on stored outlines to maintain plan stability and prevent performance regressions, then you can safely migrate from stored outlines to SQL plan baselines. After the migration, you can maintain the same plan stability while benefiting from the features provided by the SQL Plan Management framework.">Purpose of Stored Outline Migration</a></p>
</li>
<li>
<p><a href="tgsql_mig.htm#GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" title="To migrate stored outlines, you specify the stores outlines. The database then creates and updates SQL plan baselines.An outline is a set of hints, whereas a SQL plan baseline is a set of plans.">How Stored Outline Migration Works</a></p>
</li>
<li>
<p><a href="tgsql_mig.htm#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224" title="You can use the DBMS_SPM package to perform the stored outline migration.">User Interface for Stored Outline Migration</a></p>
</li>
<li>
<p><a href="tgsql_mig.htm#GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8">Basic Steps in Stored Outline Migration</a></p>
</li>
</ul>
</div>
<a id="TGSQL667"></a>
<div class="props_rev_3"><a id="GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91"></a>
<h3 id="TGSQL-GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91" class="sect3">Purpose of Stored Outline Migration</h3>
<div>
<p>If you rely on stored outlines to maintain plan stability and prevent performance regressions, then you can safely migrate from stored outlines to SQL plan baselines. After the migration, you can maintain the same plan stability while benefiting from the features provided by the SQL Plan Management framework.</p>
<p>Stored outlines have the following disadvantages:</p>
<ul style="list-style-type: disc;">
<li>
<p>Stored outlines cannot automatically evolve over time. Consequently, a stored outline may be optimal when you create it, but become a suboptimal plan after a database change, leading to performance degradation.</p>
</li>
<li>
<p>Hints in a stored outline can become invalid, as with an index hint on a dropped index. In such cases, the database still uses the outlines but excludes the invalid hints, producing a plan that is often worse than the original plan or the current best-cost plan generated by the optimizer.</p>
</li>
<li>
<p>For a SQL statement, the optimizer can only choose the plan defined in the stored outline in the currently specified category. The optimizer cannot choose from other stored outlines in different categories or the current cost-based plan even if they improve performance.</p>
</li>
<li>
<p>Stored outlines are a reactive tuning technique, which means that you only use a stored outline to address a performance problem after it has occurred. For example, you may implement a stored outline to correct the plan of a SQL statement that became high-load. In this case, you used stored outlines instead of proactively tuning the statement before it became high-load.</p>
</li>
</ul>
<p>The stored outline migration PL/SQL API helps solve the preceding problems in the following ways:</p>
<ul style="list-style-type: disc;">
<li>
<p>SQL plan baselines enable the optimizer to use the same optimal plan and allow this plan to evolve over time.</p>
<p>For a specified SQL statement, you can add new plans as SQL plan baselines after they are verified not to cause performance regressions.</p>
</li>
<li>
<p>SQL plan baselines prevent plans from becoming unreproducible because of invalid hints.</p>
<p>If hints stored in a plan baseline become invalid, then the plan may not be reproducible by the optimizer. In this case, the optimizer selects an alternative reproducible plan baseline or the current best-cost plan generated by optimizer.</p>
</li>
<li>
<p>For a specific SQL statement, the database can maintain multiple plan baselines.</p>
<p>The optimizer can choose from a set of optimal plans for a specific SQL statement instead of being restricted to a single plan per category, as required by stored outlines.</p>
</li>
</ul>
</div>
</div>
<a id="TGSQL668"></a>
<div class="props_rev_3"><a id="GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E"></a>
<h3 id="TGSQL-GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" class="sect3">How Stored Outline Migration Works</h3>
<div>
<p>This section explains how the database migrates stored outlines to SQL plan baselines. This information is important for performing the task of migrating stored outlines.</p>
</div>
<a id="TGSQL669"></a>
<div class="props_rev_3"><a id="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C"></a>
<h4 id="TGSQL-GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C" class="sect4">Stages of Stored Outline Migration</h4>
<div>
<p>To migrate stored outlines, you specify the stores outlines. The database then creates and updates SQL plan baselines.</p>
<div class="figure" id="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C__GUID-AA907DD4-E803-458E-AD13-03D4A85A47B6">
<p class="titleinfigure">Figure 24-1 Stages of Stored Outline Migration</p>
<img width="506" height="239" src="img/GUID-226461E7-B89A-4EBF-9163-9CA5F379ABC3-default.gif" alt="Description of Figure 24-1 follows" title="Description of Figure 24-1 follows"/><br/>
<a href="img_text/GUID-226461E7-B89A-4EBF-9163-9CA5F379ABC3-print.htm">Description of &#34;Figure 24-1 Stages of Stored Outline Migration&#34;</a></div>
<!-- class="figure" -->
<p>The migration process has the following stages:</p>
<ol>
<li>
<p>The user invokes a function that specifies which outlines to migrate.</p>
</li>
<li>
<p>The database processes the outlines as follows:</p>
<ol>
<li>
<p>The database copies information in the outline needed by the plan baseline.</p>
<p>The database copies it directly or calculates it based on information in the outline. For example, the text of the SQL statement exists in both schemas, so the database can copy the text from outline to baseline.</p>
</li>
<li>
<p>The database reparses the hints to obtain information not in the outline.</p>
<p>The plan hash value and plan cost cannot be derived from the existing information in the outline, which necessitates reparsing the hints.</p>
</li>
<li>
<p>The database creates the baselines.</p>
</li>
</ol>
</li>
<li>
<p>The database obtains missing information when it chooses the SQL plan baseline for the first time to execute the SQL statement.</p>
<p>The compilation environment and execution statistics are only available during execution when the plan baseline is parsed and compiled.</p>
</li>
</ol>
<p>The migration is complete only after the preceding phases complete.</p>
</div>
</div>
<a id="TGSQL671"></a><a id="TGSQL670"></a>
<div class="props_rev_3"><a id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E"></a>
<h4 id="TGSQL-GUID-75F926D8-04DA-4B7F-B750-33BD4505771E" class="sect4">Outline Categories and Baseline Modules</h4>
<div>
<p>An outline is a set of hints, whereas a SQL plan baseline is a set of plans.</p>
<p>Because they are different technologies, some functionality of outlines does not map exactly to functionality of baselines. For example, a single SQL statement can have multiple outlines, each of which is in a different outline <span class="bold">category</span>, but the only category that currently exists for baselines is <code class="codeph">DEFAULT</code>.</p>
<p>The equivalent of a category for an outline is a module for a SQL plan baseline. <a href="tgsql_mig.htm#GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__BHCEJBBI" title="Outline categories">Table 24-1</a> explains how outline categories map to modules.</p>
<div class="tblformal" id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__BHCEJBBI">
<p class="titleintable">Table 24-1 Outline Categories</p>
<table class="cellalignment4808" title="Outline Categories" summary="Outline categories">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4809" id="d131093e662">Concept</th>
<th class="cellalignment4809" id="d131093e665">Description</th>
<th class="cellalignment4810" id="d131093e668">Default Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4811" id="d131093e673" headers="d131093e662">
<p>Outline Category</p>
</td>
<td class="cellalignment4811" headers="d131093e673 d131093e665">
<p>Specifies a user-defined grouping for a set of stored outlines.</p>
<p>You can use categories to maintain different stored outlines for a SQL statement. For example, a single statement can have an outline in the <code class="codeph">OLTP</code> category and the <code class="codeph">DW</code> category.</p>
<p>Each SQL statement can have one or more stored outlines. Each stored outline is in one and only one outline category. A statement can have multiple stored outlines in different categories, but only one stored outline exists for each category of each statement.</p>
<p>During migration, the database maps each outline category to a SQL plan baseline module.</p>
</td>
<td class="cellalignment4812" headers="d131093e673 d131093e668">
<p><code class="codeph">DEFAULT</code></p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4811" id="d131093e696" headers="d131093e662">
<p>Baseline Module</p>
</td>
<td class="cellalignment4811" headers="d131093e696 d131093e665">
<p>Specifies a high-level function being performed.</p>
<p>A SQL plan baseline can belong to one and only one module.</p>
</td>
<td class="cellalignment4812" headers="d131093e696 d131093e668">
<p>After an outline is migrated to a SQL plan baseline, the module name defaults to outline category name.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4811" id="d131093e708" headers="d131093e662">
<p>Baseline Category</p>
</td>
<td class="cellalignment4811" headers="d131093e708 d131093e665">
<p>Only one SQL plan baseline category exists. This category is named <code class="codeph">DEFAULT</code>. During stored outline migration, the module name of the SQL plan baseline is set to the category name of the stored outline.</p>
<p>A statement can have multiple SQL plan baselines in the <code class="codeph">DEFAULT</code> category.</p>
</td>
<td class="cellalignment4812" headers="d131093e708 d131093e668">
<p><code class="codeph">DEFAULT</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>When migrating stored outlines to SQL plan baselines, Oracle Database maps every outline category to a SQL plan baseline module with the same name. As shown in the following diagram, the outline category <code class="codeph">OLTP</code> is mapped to the baseline module <code class="codeph">OLTP</code>. After migration, <code class="codeph">DEFAULT</code> is a super-category that contains all SQL plan baselines.</p>
<div class="figure" id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__GUID-5CBFB8FA-3B90-42C7-A5C6-3E29807A4599">
<p class="titleinfigure">Figure 24-2 DEFAULT Category</p>
<img width="492" height="243" src="img/GUID-FEC345B0-3BED-4432-967A-1FF819685051-default.gif" alt="Description of Figure 24-2 follows" title="Description of Figure 24-2 follows"/><br/>
<a href="img_text/GUID-FEC345B0-3BED-4432-967A-1FF819685051-print.htm">Description of &#34;Figure 24-2 DEFAULT Category&#34;</a></div>
<!-- class="figure" --></div>
</div>
</div>
<a id="TGSQL673"></a><a id="TGSQL674"></a><a id="TGSQL675"></a><a id="TGSQL672"></a>
<div class="props_rev_3"><a id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224"></a>
<h3 id="TGSQL-GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224" class="sect3">User Interface for Stored Outline Migration</h3>
<div>
<p>You can use the <code class="codeph">DBMS_SPM</code> package to perform the stored outline migration.</p>
<div class="tblformalwide" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHCGEH">
<p class="titleintable">Table 24-2 DBMS_SPM Functions Relating to Stored Outline Migration</p>
<table class="cellalignment4813" title="DBMS_SPM Functions Relating to Stored Outline Migration" summary="DBMS_SPM functions">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4814" id="d131093e838">DBMS_SPM Function</th>
<th class="cellalignment4815" id="d131093e841">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4816" id="d131093e846" headers="d131093e838">
<p><code class="codeph">MIGRATE_STORED_OUTLINE</code></p>
</td>
<td class="cellalignment4817" headers="d131093e846 d131093e841">
<p>Migrates existing stored outlines to plan baselines.</p>
<p>Use either of the following formats:</p>
<ul style="list-style-type: disc;">
<li>
<p>Specify outline name, SQL text, outline category, or all stored outlines.</p>
</li>
<li>
<p>Specify a list of outline names.</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4816" id="d131093e863" headers="d131093e838">
<p><code class="codeph">ALTER_SQL_PLAN_BASELINE</code></p>
</td>
<td class="cellalignment4817" headers="d131093e863 d131093e841">
<p>Changes an attribute of a single plan or all plans associated with a SQL statement.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4816" id="d131093e871" headers="d131093e838">
<p><code class="codeph">DROP_MIGRATED_STORED_OUTLINE</code></p>
</td>
<td class="cellalignment4817" headers="d131093e871 d131093e841">
<p>Drops stored outlines that have been migrated to SQL plan baselines.</p>
<p>The function finds stored outlines marked as <code class="codeph">MIGRATED</code> in the <code class="codeph">DBA_OUTLINES</code> view, and then drops these outlines from the database.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<p>You can control stored outline and plan baseline behavior with initialization and session parameters. <a href="tgsql_mig.htm#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHDHGI" title="Initialization parameters">Table 24-3</a> describes the relevant parameters. See <a href="tgsql_mig.htm#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC" title="Explains interaction of parameters">Table 24-5</a> and <a href="tgsql_mig.htm#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ" title="Explains interaction of parameters">Table 24-6</a> for an explanation of how these parameter settings interact.</p>
<div class="tblformalwide" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHDHGI">
<p class="titleintable">Table 24-3 Parameters Relating to Stored Outline Migration</p>
<table class="cellalignment4813" title="Parameters Relating to Stored Outline Migration" summary="Initialization parameters">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4818" id="d131093e915">Initialization or Session Parameter</th>
<th class="cellalignment4819" id="d131093e918">Description</th>
<th class="cellalignment4820" id="d131093e921">Parameter Type</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4821" id="d131093e926" headers="d131093e915">
<p><code class="codeph">CREATE_STORED_OUTLINES</code></p>
</td>
<td class="cellalignment4822" headers="d131093e926 d131093e918">
<p>Determines whether Oracle Database automatically creates and stores an outline for each query submitted during the session.</p>
</td>
<td class="cellalignment4823" headers="d131093e926 d131093e921">
<p>Initialization parameter</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4821" id="d131093e937" headers="d131093e915">
<p><code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code></p>
</td>
<td class="cellalignment4822" headers="d131093e937 d131093e918">
<p>Enables or disables the automatic recognition of repeatable SQL statement and the generation of SQL plan baselines for these statements.</p>
</td>
<td class="cellalignment4823" headers="d131093e937 d131093e921">
<p>Initialization parameter</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4821" id="d131093e948" headers="d131093e915">
<p><code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code></p>
</td>
<td class="cellalignment4822" headers="d131093e948 d131093e918">
<p>Enables or disables the use of SQL plan baselines stored in SQL Management Base.</p>
</td>
<td class="cellalignment4823" headers="d131093e948 d131093e921">
<p>Initialization parameter</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4821" id="d131093e959" headers="d131093e915">
<p><code class="codeph">USE_STORED_OUTLINES</code></p>
</td>
<td class="cellalignment4822" headers="d131093e959 d131093e918">
<p>Determines whether the optimizer uses stored outlines to generate execution plans.</p>
<p><span class="bold">Note:</span> This is a <span class="italic">session</span> parameter, not an initialization parameter.</p>
</td>
<td class="cellalignment4823" headers="d131093e959 d131093e921">
<p>Session</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>You can use database views to access information relating to stored outline migration. <a href="tgsql_mig.htm#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCECCEC" title="Fixed views">Table 24-4</a> describes the following main views.</p>
<div class="tblformal" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCECCEC">
<p class="titleintable">Table 24-4 Views Relating to Stored Outline Migration</p>
<table class="cellalignment4808" title="Views Relating to Stored Outline Migration" summary="Fixed views">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4814" id="d131093e993">View</th>
<th class="cellalignment4815" id="d131093e996">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4816" id="d131093e1001" headers="d131093e993">
<p><code class="codeph">DBA_OUTLINES</code></p>
</td>
<td class="cellalignment4817" headers="d131093e1001 d131093e996">
<p>Describes all stored outlines in the database.</p>
<p>The <code class="codeph">MIGRATED</code> column is important for outline migration and shows one of the following values: <code class="codeph">NOT-MIGRATED</code> and <code class="codeph">MIGRATED</code>. When <code class="codeph">MIGRATED</code>, the stored outline has been migrated to a plan baseline and is not usable.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4816" id="d131093e1023" headers="d131093e993">
<p><code class="codeph">DBA_SQL_PLAN_BASELINES</code></p>
</td>
<td class="cellalignment4817" headers="d131093e1023 d131093e996">
<p>Displays information about the SQL plan baselines currently created for specific SQL statements.</p>
<p>The <code class="codeph">ORIGIN</code> column indicates how the plan baseline was created. The value <code class="codeph">STORED-OUTLINE</code> indicates the baseline was created by migrating an outline.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__GUID-108E32D9-17DB-43D0-87EE-76314DD8D6E7">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS150" target="_blank" href="../ARPLS/d_spm.htm#ARPLS150"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SPM</code> package</p>
</li>
<li>
<p><a class="olink GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5" target="_blank" href="../REFRN/GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5.htm#GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">CREATE_STORED_OUTLINES</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL676"></a>
<div class="props_rev_3"><a id="GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8"></a>
<h3 id="TGSQL-GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8" class="sect3">Basic Steps in Stored Outline Migration</h3>
<div>
<p>This section explains the basic steps in using the PL/SQL API to perform stored outline migration. The basic steps are as follows:</p>
<ol>
<li>
<p>Prepare for stored outline migration.</p>
<p>Review the migration prerequisites and determine how you want the migrated plan baselines to behave.</p>
<p>See <span class="q">&#34;<a href="tgsql_mig.htm#GUID-729D65C2-5161-4229-BF71-5419B9FD1F85">Preparing for Stored Outline Migration</a>&#34;</span>.</p>
</li>
<li>
<p>Do one of the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Migrate to baselines to use SQL Plan Management features.</p>
<p>See <span class="q">&#34;<a href="tgsql_mig.htm#GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7">Migrating Outlines to Utilize SQL Plan Management Features</a>&#34;</span>.</p>
</li>
<li>
<p>Migrate to baselines while exactly preserving the behavior of the stored outlines.</p>
<p>See <span class="q">&#34;<a href="tgsql_mig.htm#GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" title="You can migrate stored outlines to SQL plan baselines and preserve the original behavior of the stored outlines by creating fixed plan baselines.">Migrating Outlines to Preserve Stored Outline Behavior</a>&#34;</span>.</p>
</li>
</ul>
</li>
<li>
<p>Perform post-migration confirmation and cleanup.</p>
<p>See <span class="q">&#34;<a href="tgsql_mig.htm#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" title="After migrating outlines to SQL plan baselines, you must perform some follow-up work.">Performing Follow-Up Tasks After Stored Outline Migration</a>&#34;</span>.</p>
</li>
</ol>
</div>
</div>
</div>
<a id="TGSQL677"></a>
<div class="props_rev_3"><a id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85"></a>
<h2 id="TGSQL-GUID-729D65C2-5161-4229-BF71-5419B9FD1F85" class="sect2">Preparing for Stored Outline Migration</h2>
<div>
<div class="section">
<p>This section explains how to prepare for stored outline migration.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To prepare for stored outline migration:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with <code class="codeph">SYSDBA</code> privileges or the <code class="codeph">EXECUTE</code> privilege on the <code class="codeph">DBMS_SPM</code> package.</p>
<p>For example, do the following to use operating system authentication to log on to a database as <code class="codeph">SYS</code>:</p>
<pre dir="ltr">% sqlplus /nolog
SQL&gt; CONNECT / AS SYSDBA
</pre></li>
<li>
<p>Query the stored outlines in the database.</p>
<p>The following example queries all stored outlines that have not been migrated to SQL plan baselines:</p>
<pre dir="ltr">SELECT NAME, CATEGORY, SQL_TEXT
FROM   DBA_OUTLINES
WHERE  MIGRATED = &#39;NOT-MIGRATED&#39;;
</pre></li>
<li>
<p>Determine which stored outlines meet the following prerequisites for migration eligibility:</p>
<ul style="list-style-type: disc;">
<li>
<p>The statement must <span class="italic">not</span> be a run-time <code class="codeph">INSERT AS SELECT</code> statement.</p>
</li>
<li>
<p>The statement must <span class="italic">not</span> reference a remote object.</p>
</li>
<li>
<p>This statement must <span class="italic">not</span> be a private stored outline.</p>
</li>
</ul>
</li>
<li>
<p>Decide whether to migrate all outlines, specified stored outlines, or outlines belonging to a specified outline category.</p>
<p>If you do not decide to migrate all outlines, then identify the outlines or categories that you intend to migrate.</p>
</li>
<li>
<p>Decide whether the stored outlines migrated to SQL plan baselines use <span class="bold">fixed plans</span> or <span class="bold">nonfixed plans</span>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Fixed plans</p>
<p>A fixed plan is frozen. If a fixed plan is reproducible using the hints stored in plan baseline, then the optimizer always chooses the lowest-cost fixed plan baseline over plan baselines that are not fixed. Essentially, a fixed plan baseline acts as a stored outline with valid hints.</p>
<p>A fixed plan is <span class="bold">reproducible</span> when the database can parse the statement based on the hints stored in the plan baseline and create a plan with the same plan hash value as the one in the plan baseline. If one of more of the hints become invalid, then the database may not be able to create a plan with the same plan hash value. In this case, the plan is <span class="bold">nonreproducible</span>.</p>
<p>If a fixed plan cannot be reproduced when parsed using its hints, then the optimizer chooses a different plan, which can be either of the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Another plan for the SQL plan baseline</p>
</li>
<li>
<p>The current cost-based plan created by the optimizer</p>
</li>
</ul>
<p>In some cases, a performance regression occurs because of the different plan, requiring SQL tuning.</p>
</li>
<li>
<p>Nonfixed plans</p>
<p>If a plan baseline does not contain fixed plans, then SQL Plan Management considers the plans equally when picking a plan for a SQL statement.</p>
</li>
</ul>
</li>
<li>
<p>Before beginning the actual migration, ensure that the Oracle database meets the following prerequisites:</p>
<ul style="list-style-type: disc;">
<li>
<p>The database must be Enterprise Edition.</p>
</li>
<li>
<p>The database must be open and must <span class="italic">not</span> be in a suspended state.</p>
</li>
<li>
<p>The database must <span class="italic">not</span> be in restricted access (DBA), read-only, or migrate mode.</p>
</li>
<li>
<p>Oracle Call Interface (OCI) must be available.</p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85__GUID-96EDF70D-2FBB-42BB-A585-0764ED151837">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADMIN11046" target="_blank" href="../ADMIN/dba.htm#ADMIN11046"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> to learn about administrator privileges</p>
</li>
<li>
<p><a class="olink REFRN23153" target="_blank" href="../REFRN/GUID-D311BC8E-FB08-4990-8DED-C6AB221088F2.htm#REFRN23153"><span class="italic">Oracle Database Reference</span></a> to learn about the <code class="codeph">DBA_OUTLINES</code> views</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94976"></a><a id="TGSQL678"></a>
<div class="props_rev_3"><a id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7"></a>
<h2 id="TGSQL-GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7" class="sect2">Migrating Outlines to Utilize SQL Plan Management Features</h2>
<div>
<div class="section">
<p>The goals of this task are as follows:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>To allow SQL Plan Management to select from all plans in a plan baseline for a SQL statement instead of applying the same fixed plan after migration</p>
</li>
<li>
<p>To allow the SQL plan baseline to evolve in the face of database changes by adding new plans to the baseline</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You migrate all outlines.</p>
<p>To migrate specific outlines, see <a class="olink ARPLS150" target="_blank" href="../ARPLS/d_spm.htm#ARPLS150"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for details about the <code class="codeph">DBMS_SPM.MIGRATE_STORED_OUTLINE</code> function.</p>
</li>
<li>
<p>You want the module names of the baselines to be identical to the category names of the migrated outlines.</p>
</li>
<li>
<p>You do <span class="italic">not</span> want the SQL plans to be fixed.</p>
<p>By default, generated plans are not fixed and SQL Plan Management considers all plans equally when picking a plan for a SQL statement. This situation permits the advanced feature of plan evolution to capture new plans for a SQL statement, verify their performance, and accept these new plans into the plan baseline.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To migrate stored outlines to SQL plan baselines:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges.</p>
</li>
<li>
<p>Call PL/SQL function <code class="codeph">MIGRATE_STORED_OUTLINE</code>.</p>
<p>The following sample PL/SQL block migrates all stored outlines to fixed baselines:</p>
<pre dir="ltr">DECLARE
  my_report CLOB;
BEGIN
  my_outlines := DBMS_SPM.MIGRATE_STORED_OUTLINE( 
                   attribute_name =&gt; &#39;all&#39; );
END;
/
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7__GUID-163A092C-10B5-42E3-A058-632679296367">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS150" target="_blank" href="../ARPLS/d_spm.htm#ARPLS150"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DBMS_SPM</code> package</p>
</li>
<li>
<p><a class="olink SQLRF00902" target="_blank" href="../SQLRF/statements_2017.htm#SQLRF00902"><span class="italic">Oracle Database SQL Language Reference</span></a> to learn about the <code class="codeph">ALTER SYSTEM</code> statement</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94977"></a><a id="TGSQL679"></a>
<div class="props_rev_3"><a id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17"></a>
<h2 id="TGSQL-GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" class="sect2">Migrating Outlines to Preserve Stored Outline Behavior</h2>
<div>
<p>You can migrate stored outlines to SQL plan baselines and preserve the original behavior of the stored outlines by creating fixed plan baselines.</p>
<div class="section">
<p>A fixed plan has higher priority over other plans for the same SQL statement. If a plan is fixed, then the plan baseline cannot be evolved. The database does not add new plans to a plan baseline that contains a fixed plan.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You want to migrate only the stored outlines in the category named <code class="codeph">firstrow</code>.</p>
</li>
<li>
<p>You want the module names of the baselines to be identical to the category names of the migrated outlines.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To migrate stored outlines to plan baselines:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges.</p>
</li>
<li>
<p>Call PL/SQL function <code class="codeph">MIGRATE_STORED_OUTLINE</code>.</p>
<p>The following sample PL/SQL block migrates stored outlines in the category <code class="codeph">firstrow</code> to fixed baselines:</p>
<pre dir="ltr">DECLARE
  my_report CLOB;
BEGIN
  my_outlines := DBMS_SPM.MIGRATE_STORED_OUTLINE( 
    attribute_name =&gt; &#39;category&#39;, 
    attribute_value =&gt; &#39;firstrow&#39;,
    fixed =&gt; &#39;YES&#39; );
END;
/
</pre>
<p>After migration, the SQL plan baselines is in module <code class="codeph">firstrow</code> and category <code class="codeph">DEFAULT</code>.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17__GUID-D51302BF-3786-44A3-898A-C2640025F23F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS150" target="_blank" href="../ARPLS/d_spm.htm#ARPLS150"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for syntax and semantics of the <code class="codeph">DBMS_SPM.MIGRATE_STORED_OUTLINE</code> function</p>
</li>
<li>
<p><a class="olink SQLRF00902" target="_blank" href="../SQLRF/statements_2017.htm#SQLRF00902"><span><cite>Oracle Database SQL Language Reference</cite></span></a> to learn about the <code class="codeph">ALTER SYSTEM</code> statement</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL681"></a><a id="TGSQL682"></a><a id="TGSQL94978"></a><a id="TGSQL680"></a>
<div class="props_rev_3"><a id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B"></a>
<h2 id="TGSQL-GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" class="sect2">Performing Follow-Up Tasks After Stored Outline Migration</h2>
<div>
<p>After migrating outlines to SQL plan baselines, you must perform some follow-up work.</p>
<div class="section">
<p>The goals of this task are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>To configure the database to use plan baselines instead of stored outlines for stored outlines that have been migrated to SQL plan baselines</p>
</li>
<li>
<p>To create SQL plan baselines instead of stored outlines for future SQL statements</p>
</li>
<li>
<p>To drop the stored outlines that have been migrated to SQL plan baselines</p>
</li>
</ul>
<p>This section explains how to set initialization parameters relating to stored outlines and plan baselines. The <code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code> and <code class="codeph">CREATE_STORED_OUTLINES</code> initialization parameters determine how and when the database creates stored outlines and SQL plan baselines. <a href="tgsql_mig.htm#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC" title="Explains interaction of parameters">Table 24-5</a> explains the interaction between these parameters.</p>
<div class="tblformal" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC">
<p class="titleintable">Table 24-5 Creation of Outlines and Baselines</p>
<table class="cellalignment4808" title="Creation of Outlines and Baselines" summary="Explains interaction of parameters">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4824" id="d131093e1845">CREATE_STORED_OUTLINES Initialization Parameter</th>
<th class="cellalignment4825" id="d131093e1848">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES Initialization Parameter</th>
<th class="cellalignment4826" id="d131093e1851">Database Behavior</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4827" id="d131093e1856" headers="d131093e1845">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4828" headers="d131093e1856 d131093e1848">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4829" headers="d131093e1856 d131093e1851">
<p>When executing a SQL statement, the database does not create stored outlines or SQL plan baselines.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4827" id="d131093e1868" headers="d131093e1845">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4828" headers="d131093e1868 d131093e1848">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4829" headers="d131093e1868 d131093e1851">
<p>The automatic recognition of repeatable SQL statements and the generation of SQL plan baselines for these statements is enabled. When executing a SQL statement, the database creates only new SQL plan baselines (if they do not exist) with the category name <code class="codeph">DEFAULT</code> for the statement.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4827" id="d131093e1883" headers="d131093e1845">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4828" headers="d131093e1883 d131093e1848">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4829" headers="d131093e1883 d131093e1851">
<p>Oracle Database automatically creates and stores an outline for each query submitted during the session. When executing a SQL statement, the database creates only new stored outlines (if they do not exist) with the category name <code class="codeph">DEFAULT</code> for the statement.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4827" id="d131093e1898" headers="d131093e1845">
<p><span class="italic"><code class="codeph">category</code></span></p>
</td>
<td class="cellalignment4828" headers="d131093e1898 d131093e1848">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4829" headers="d131093e1898 d131093e1851">
<p>When executing a SQL statement, the database creates only new stored outlines (if they do not exist) with the specified category name for the statement.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4827" id="d131093e1911" headers="d131093e1845">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4828" headers="d131093e1911 d131093e1848">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4829" headers="d131093e1911 d131093e1851">
<p>Oracle Database automatically creates and stores an outline for each query submitted during the session. The automatic recognition of repeatable SQL statements and the generation of SQL plan baselines for these statements is also enabled.</p>
<p>When executing a SQL statement, the database creates both stored outlines and SQL plan baselines with the category name <code class="codeph">DEFAULT</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4827" id="d131093e1928" headers="d131093e1845">
<p><span class="italic"><code class="codeph">category</code></span></p>
</td>
<td class="cellalignment4828" headers="d131093e1928 d131093e1848">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4829" headers="d131093e1928 d131093e1851">
<p>Oracle Database automatically creates and stores an outline for each query submitted during the session. The automatic recognition of repeatable SQL statements and the generation of SQL plan baselines for these statements is also enabled.</p>
<p>When executing a SQL statement, the database creates stored outlines with the specified category name and SQL plan baselines with the category name <code class="codeph">DEFAULT</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The <code class="codeph">USE_STORED_OUTLINES</code> session parameter (it is <span class="italic">not</span> an initialization parameter) and <code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code> initialization parameter determine how the database uses stored outlines and plan baselines. <a href="tgsql_mig.htm#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ" title="Explains interaction of parameters">Table 24-6</a> explains how these parameters interact.</p>
<div class="tblformal" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ">
<p class="titleintable">Table 24-6 Use of Stored Outlines and SQL Plan Baselines</p>
<table class="cellalignment4808" title="Use of Stored Outlines and SQL Plan Baselines" summary="Explains interaction of parameters">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4830" id="d131093e1972">USE_STORED_OUTLINES Session Parameter</th>
<th class="cellalignment4825" id="d131093e1975">OPTIMIZER_USE_SQL_PLAN_BASELINES Initialization Parameter</th>
<th class="cellalignment4831" id="d131093e1978">Database Behavior</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4832" id="d131093e1983" headers="d131093e1972">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4828" headers="d131093e1983 d131093e1975">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4833" headers="d131093e1983 d131093e1978">
<p>When choosing a plan for a SQL statement, the database does not use stored outlines or plan baselines.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4832" id="d131093e1995" headers="d131093e1972">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4828" headers="d131093e1995 d131093e1975">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4833" headers="d131093e1995 d131093e1978">
<p>When choosing a plan for a SQL statement, the database uses only SQL plan baselines.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4832" id="d131093e2007" headers="d131093e1972">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4828" headers="d131093e2007 d131093e1975">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4833" headers="d131093e2007 d131093e1978">
<p>When choosing a plan for a SQL statement, the database uses stored outlines with the category name <code class="codeph">DEFAULT</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4832" id="d131093e2022" headers="d131093e1972">
<p><span class="italic"><code class="codeph">category</code></span></p>
</td>
<td class="cellalignment4828" headers="d131093e2022 d131093e1975">
<p><code class="codeph">false</code></p>
</td>
<td class="cellalignment4833" headers="d131093e2022 d131093e1978">
<p>When choosing a plan for a SQL statement, the database uses stored outlines with the specified category name.</p>
<p>If a stored outline with the specified category name does not exist, then the database uses a stored outline in the <code class="codeph">DEFAULT</code> category if it exists.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4832" id="d131093e2040" headers="d131093e1972">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4828" headers="d131093e2040 d131093e1975">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4833" headers="d131093e2040 d131093e1978">
<p>When choosing a plan for a SQL statement, stored outlines take priority over plan baselines.</p>
<p>If a stored outline with the category name <code class="codeph">DEFAULT</code> exists for the statement and is applicable, then the database applies the stored outline. Otherwise, the database uses SQL plan baselines. However, if the stored outline has the property <code class="codeph">MIGRATED</code>, then the database does not use the outline and uses the corresponding SQL plan baseline instead (if it exists).</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4832" id="d131093e2060" headers="d131093e1972">
<p><span class="italic"><code class="codeph">category</code></span></p>
</td>
<td class="cellalignment4828" headers="d131093e2060 d131093e1975">
<p><code class="codeph">true</code></p>
</td>
<td class="cellalignment4833" headers="d131093e2060 d131093e1978">
<p>When choosing a plan for a SQL statement, stored outlines take priority over plan baselines.</p>
<p>If a stored outline with the specified category name or the <code class="codeph">DEFAULT</code> category exists for the statement and is applicable, then the database applies the stored outline. Otherwise, the database uses SQL plan baselines. However, if the stored outline has the property <code class="codeph">MIGRATED</code>, then the database does not use the outline and uses the corresponding SQL plan baseline instead (if it exists).</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You have completed the basic steps in the stored outline migration.</p>
</li>
<li>
<p>Some stored outlines may have been created before Oracle Database 10<span class="italic">g</span>.</p>
<p>Hints in releases before Oracle Database 10<span class="italic">g</span> use a local hint format. After migration, hints stored in a plan baseline use the global hints format introduced in Oracle Database 10<span class="italic">g</span>.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To place the database in the proper state after the migration:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then check that SQL plan baselines have been created as the result of migration.</p>
<p>Ensure that the plans are enabled and accepted. For example, enter the following query (partial sample output included):</p>
<pre dir="ltr">SELECT SQL_HANDLE, PLAN_NAME, ORIGIN, ENABLED, ACCEPTED, FIXED, MODULE
FROM   DBA_SQL_PLAN_BASELINES;

SQL_HANDLE                PLAN_NAME  ORIGIN         ENA ACC FIX MODULE
------------------------- ---------- -------------- --- --- --- ------
SYS_SQL_f44779f7089c8fab  STMT01     STORED-OUTLINE YES YES NO  DEFAULT
.
.
.
</pre></li>
<li>
<p>Optionally, change the attributes of the SQL plan baselines.</p>
<p>For example, the following statement changes the status of the baseline for the specified SQL statement to <code class="codeph">fixed</code>:</p>
<pre dir="ltr">DECLARE
  v_cnt PLS_INTEGER;
BEGIN 
  v_cnt := DBMS_SPM.ALTER_SQL_PLAN_BASELINE(               
                           sql_handle=&gt;&#39;SYS_SQL_f44779f7089c8fab&#39;, 
                           attribute_name=&gt;&#39;FIXED&#39;, 
                           attribute_value=&gt;&#39;NO&#39;);
  DBMS_OUTPUT.PUT_LINE(&#39;Plans altered: &#39; || v_cnt);
END;
/
</pre></li>
<li>
<p>Check the status of the original stored outlines.</p>
<p>For example, enter the following query (partial sample output included):</p>
<pre dir="ltr">SELECT NAME, OWNER, CATEGORY, USED, MIGRATED 
FROM   DBA_OUTLINES
ORDER BY NAME;

NAME       OWNER      CATEGORY   USED   MIGRATED
---------- ---------- ---------- ------ ------------
STMT01     SYS        DEFAULT    USED   MIGRATED
STMT02     SYS        DEFAULT    USED   MIGRATED
.
.
.
</pre></li>
<li>
<p>Drop all stored outlines that have been migrated to SQL plan baselines.</p>
<p>For example, the following statements drops all stored outlines with status <code class="codeph">MIGRATED</code> in <code class="codeph">DBA_OUTLINES</code>:</p>
<pre dir="ltr">DECLARE
  v_cnt PLS_INTEGER;
BEGIN 
  v_cnt := DBMS_SPM.DROP_MIGRATED_STORED_OUTLINE();
  DBMS_OUTPUT.PUT_LINE(&#39;Migrated stored outlines dropped: &#39; || v_cnt);
END;
/
</pre></li>
<li>
<p>Set initialization parameters so that:</p>
<ul style="list-style-type: disc;">
<li>
<p>When executing a SQL statement, the database creates plan baselines but does not create stored outlines.</p>
</li>
<li>
<p>The database only uses stored outlines when the equivalent SQL plan baselines do not exist.</p>
</li>
</ul>
<p>For example, the following SQL statements instruct the database to create SQL plan baselines instead of stored outlines when a SQL statement is executed. The example also instructs the database to apply a stored outline in category <code class="codeph">allrows</code> or <code class="codeph">DEFAULT</code> only if it exists and has not been migrated to a SQL plan baseline. In other cases, the database applies SQL plan baselines instead.</p>
<pre dir="ltr">ALTER SYSTEM 
  SET CREATE_STORED_OUTLINE = false SCOPE = BOTH;

ALTER SYSTEM 
  SET OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES = true SCOPE = BOTH;

ALTER SYSTEM 
   SET OPTIMIZER_USE_SQL_PLAN_BASELINES = true SCOPE = BOTH;

ALTER SESSION
   SET USE_STORED_OUTLINES = allrows SCOPE = BOTH;
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__GUID-E6FBB485-2D06-4F8F-8CC8-70CEE2554750">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_mig.htm#GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8">Basic Steps in Stored Outline Migration</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ARPLS150" target="_blank" href="../ARPLS/d_spm.htm#ARPLS150"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SPM</code> package</p>
</li>
<li>
<p><a class="olink GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5" target="_blank" href="../REFRN/GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5.htm#GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">CREATE_STORED_OUTLINES</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4801">
<tr>
<td class="cellalignment4834">
<table class="cellalignment4806">
<tr>
<td class="cellalignment4805"><a href="tgsql_spm.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4805"><a href="tgsql_indc.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4836">
<table class="cellalignment4804">
<tr>
<td class="cellalignment4805"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4805"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4805"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4805"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4805"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4805"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>