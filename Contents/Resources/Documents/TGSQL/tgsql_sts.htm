<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-106808"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Managing%20SQL%20Tuning%20Sets"></a><title>Managing SQL Tuning Sets</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="pluggable databases, SQL tuning sets, pluggable databases and, SQL Tuning Sets, managing with APIs"/>
<meta name="dcterms.created" content="2017-07-24T09:35:46Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SQL Tuning Guide"/>
<meta name="dcterms.identifier" content="E49106-14"/>
<meta name="dcterms.isVersionOf" content="TGSQL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="tgsql_pt_sqltune.htm" title="Previous" type="text/html"/>
<link rel="Next" href="tgsql_sqltune.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49106-14.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE"></a> <span id="PAGE" style="display:none;">31/40</span> <!-- End Header -->
<a id="TGSQL516"></a>
<h1 id="TGSQL-GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" class="sect1"><span class="enumeration_chapter">19</span> Managing SQL Tuning Sets</h1>
<div>
<p>This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_sts.htm#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" title="A SQL tuning set (STS) is a database object that you can use as input to tuning tools.">About SQL Tuning Sets</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD">Creating a SQL Tuning Set</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59">Loading a SQL Tuning Set</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-B776D937-29CF-40CA-9D5B-2C427934190E">Displaying the Contents of a SQL Tuning Set</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62" title="Use the DBMS_SQLTUNE.DELETE_SQLSET procedure to delete SQL statements from an STS.">Modifying a SQL Tuning Set</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" title="Transporting SQL tuning sets between databases means copying the SQL tuning sets to and from a staging table, and then using other tools to move the staging table to the destination database. The most common tools are Oracle Data Pump or a database link.Transporting SQL tuning sets requires exporting the STS, transporting the dump file, and then importing the dump file.When transporting an STS, you must remap the con_dbid of each SQL statement in the STS when the con_dbid of the source database and the destination database are different.You can transport SQL tuning sets using three subprograms in the DBMS_SQLTUNE package.">Transporting a SQL Tuning Set</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-493FA794-EF69-464D-BB6F-C8CF06686023" title="To drop an STS from the database, execute the DBMS_SQLTUNE.DROP_SQLSET procedure.">Dropping a SQL Tuning Set</a></p>
</li>
</ul>
</div>
<a id="TGSQL517"></a>
<div class="props_rev_3"><a id="GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5"></a>
<h2 id="TGSQL-GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" class="sect2">About SQL Tuning Sets</h2>
<div>
<p>A <strong class="term">SQL tuning set (STS)</strong> is a database object that you can use as input to tuning tools.</p>
<p>An STS includes:</p>
<ul style="list-style-type: disc;">
<li>
<p>A set of SQL statements</p>
</li>
<li>
<p>Associated execution context, such as user schema, application module name and action, list of bind values, and the environment for <a href="glossary.htm#GUID-F9233BE0-9CB9-4673-A705-174924AE3B18"><span class="xrefglossterm">SQL compilation</span></a> of the cursor</p>
</li>
<li>
<p>Associated basic execution statistics, such as elapsed time, CPU time, buffer gets, disk reads, rows processed, cursor fetches, the number of executions, the number of complete executions, optimizer cost, and the command type</p>
</li>
<li>
<p>Associated execution plans and row source statistics for each SQL statement (optional)</p>
</li>
</ul>
<p>The database stores SQL tuning sets in a database-provided schema.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_sts.htm#GUID-FAFB39D0-13DB-4682-AAEE-6581D71D814C">Purpose of SQL Tuning Sets</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3" title="To create an STS, you must load SQL statements into an STS from a source.">Concepts for SQL Tuning Sets</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030" title="You can use either Oracle Enterprise Manager Cloud Control (Cloud Control) or PL/SQL packages to manage SQL tuning sets. Oracle recommends Cloud Control.">User Interfaces for SQL Tuning Sets</a></p>
</li>
<li>
<p><a href="tgsql_sts.htm#GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7" title="DBMS_SQLTUNE provides the procedures necessary for creating, using, and deleting SQL tuning sets.">Basic Tasks for SQL Tuning Sets</a></p>
</li>
</ul>
<div class="infobox-note" id="GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5__GUID-A187E5CE-55AC-4159-A5BF-98A40B3092E9">
<p class="notep1">Note:</p>
<p>Data visibility and privilege requirements may differ when using an STS with pluggable databases. See <a class="olink ADMIN13885" target="_blank" href="../ADMIN/cdb_admin.htm#ADMIN13885"><span><cite>Oracle Database Administrator&rsquo;s Guide</cite></span></a> for a table that summarizes how manageability features work in a container database (CDB).</p>
</div>
</div>
<a id="TGSQL518"></a>
<div class="props_rev_3"><a id="GUID-FAFB39D0-13DB-4682-AAEE-6581D71D814C"></a>
<h3 id="TGSQL-GUID-FAFB39D0-13DB-4682-AAEE-6581D71D814C" class="sect3">Purpose of SQL Tuning Sets</h3>
<div>
<p>An STS enables you to group SQL statements and related metadata in a single database object, which you can use to meet your tuning goals. Specifically, SQL tuning sets achieve the following goals:</p>
<ul style="list-style-type: disc;">
<li>
<p>Providing input to the performance tuning advisors</p>
<p>You can use an STS as input to multiple database advisors, including SQL Tuning Advisor, SQL Access Advisor, and SQL Performance Analyzer.</p>
</li>
<li>
<p>Transporting SQL between databases</p>
<p>You can export SQL tuning sets from one database to another, enabling transfer of SQL workloads between databases for remote performance diagnostics and tuning. When suboptimally performing SQL statements occur on a production database, developers may not want to investigate and tune directly on the production database. The DBA can transport the problematic SQL statements to a test database where the developers can safely analyze and tune them.</p>
</li>
</ul>
</div>
</div>
<a id="TGSQL520"></a><a id="TGSQL519"></a>
<div class="props_rev_3"><a id="GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3"></a>
<h3 id="TGSQL-GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3" class="sect3">Concepts for SQL Tuning Sets</h3>
<div>
<p>To create an STS, you must load SQL statements into an STS from a source.</p>
<p>As shown in <a href="tgsql_sts.htm#GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3__BEIHEGAG">Figure 19-1</a>, the source can be Automatic Workload Repository (AWR), the <a href="glossary.htm#GUID-577D0DD3-FB98-4B1B-BCFB-95313BB35C01"><span class="xrefglossterm">shared SQL area</span></a>, customized SQL provided by the user, trace files, or another STS.</p>
<div class="figure" id="GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3__BEIHEGAG">
<p class="titleinfigure">Figure 19-1 SQL Tuning Sets</p>
<img width="495" height="642" src="img/GUID-A504F6C7-EA74-4175-9A35-C115A7FCB0A7-default.png" alt="Description of Figure 19-1 follows" title="Description of Figure 19-1 follows"/><br/>
<a href="img_text/GUID-A504F6C7-EA74-4175-9A35-C115A7FCB0A7-print.htm">Description of &#34;Figure 19-1 SQL Tuning Sets&#34;</a></div>
<!-- class="figure" -->
<p>SQL tuning sets can do the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Filter SQL statements using the application module name and action, or any execution statistics</p>
</li>
<li>
<p>Rank SQL statements based on any combination of execution statistics</p>
</li>
<li>
<p>Serve as input to the advisors or transport it to a different database</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3__GUID-B764961A-A69F-4706-ACA9-EAAA4A7F2782">
<p class="notep1">See Also:</p>
<p><a class="olink TGDBA169" target="_blank" href="../TGDBA/gather_stats.htm#TGDBA169"><span><cite>Oracle Database Performance Tuning Guide</cite></span></a> to learn about AWR</p>
</div>
</div>
</div>
<a id="TGSQL521"></a>
<div class="props_rev_3"><a id="GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030"></a>
<h3 id="TGSQL-GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030" class="sect3">User Interfaces for SQL Tuning Sets</h3>
<div>
<p>You can use either Oracle Enterprise Manager Cloud Control (Cloud Control) or PL/SQL packages to manage SQL tuning sets. Oracle recommends Cloud Control.</p>
</div>
<a id="TGSQL95141"></a><a id="TGSQL522"></a>
<div class="props_rev_3"><a id="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094"></a>
<h4 id="TGSQL-GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094" class="sect4">Accessing the SQL Tuning Sets Page in Cloud Control</h4>
<div>
<p>The SQL Tuning Sets page in Cloud Control is the starting page from which you can perform most operations relating to SQL tuning sets.</p>
<div class="section">
<p class="subhead3">To access the SQL Tuning Sets page:</p>
<ol>
<li>
<p>Access the Database Home page, as described in <span class="q">&#34;<a href="tgsql_stats.htm#GUID-15511441-3164-4233-A0F8-54A8DF44AC6D">Accessing the Database Home Page in Cloud Control</a>.&#34;</span></p>
</li>
<li>
<p>From the <span class="bold">Performance</span> menu, select <span class="bold">SQL</span>, then <span class="bold">SQL Tuning Sets</span>.</p>
<p>The SQL Tuning Sets page appears, as shown in <a href="tgsql_sts.htm#GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094__BEIECCAA">Figure 19-2</a>.</p>
<div class="figure" id="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094__BEIECCAA">
<p class="titleinfigure">Figure 19-2 SQL Tuning Sets</p>
<img width="615" height="231" src="img/GUID-0524BE05-5E6D-4445-9762-CA946F2F9309-default.jpg" alt="Description of Figure 19-2 follows" title="Description of Figure 19-2 follows"/><br/>
<a href="img_text/GUID-0524BE05-5E6D-4445-9762-CA946F2F9309-default.htm">Description of &#34;Figure 19-2 SQL Tuning Sets&#34;</a></div>
<!-- class="figure" --></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094__GUID-911AC772-DC4A-4284-9BE8-8EA23C1FECD4">
<p class="notep1">See Also:</p>
<p><a class="olink TDPPT164" target="_blank" href="../TDPPT/tdppt_sqltune.htm#TDPPT164"><span><cite>Oracle Database 2 Day + Performance Tuning Guide</cite></span></a></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL523"></a>
<div class="props_rev_3"><a id="GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1"></a>
<h4 id="TGSQL-GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1" class="sect4">Command-Line Interface to SQL Tuning Sets</h4>
<div>
<div class="section">
<p>On the command line, you can use the <code class="codeph">DBMS_SQLTUNE</code> package to manage SQL tuning sets. You must have the <code class="codeph">ADMINISTER SQL TUNING SET</code> system privilege to manage SQL tuning sets that you own, or the <code class="codeph">ADMINISTER</code> <code class="codeph">ANY</code> <code class="codeph">SQL</code> <code class="codeph">TUNING</code> <code class="codeph">SET</code> system privilege to manage any SQL tuning sets.</p>
<div class="infoboxnotealso" id="GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1__GUID-FC081A68-1935-4C42-98B5-B405642FA5BE">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS150" target="_blank" href="../ARPLS/d_spm.htm#ARPLS150"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about <code class="codeph">DBMS_SQLTUNE</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL525"></a><a id="TGSQL524"></a>
<div class="props_rev_3"><a id="GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7"></a>
<h3 id="TGSQL-GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7" class="sect3">Basic Tasks for SQL Tuning Sets</h3>
<div>
<p><code class="codeph">DBMS_SQLTUNE</code> provides the procedures necessary for creating, using, and deleting SQL tuning sets.</p>
<p>The following graphic shows the basic workflow.</p>
<div class="figure" id="GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7__BEIGEHAA">
<p class="titleinfigure">Figure 19-3 SQL Tuning Sets APIs</p>
<img width="492" height="455" src="img/GUID-26BF068E-13C8-44DE-8626-6414F47807D7-default.png" alt="Description of Figure 19-3 follows" title="Description of Figure 19-3 follows"/><br/>
<a href="img_text/GUID-26BF068E-13C8-44DE-8626-6414F47807D7-print.htm">Description of &#34;Figure 19-3 SQL Tuning Sets APIs&#34;</a></div>
<!-- class="figure" -->
<p>Typically, you perform STS operations in the following sequence:</p>
<ol>
<li>
<p>Create a new STS.</p>
<p><span class="q">&#34;<a href="tgsql_sts.htm#GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD">Creating a SQL Tuning Set</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Load the STS with SQL statements and associated metadata.</p>
<p><span class="q">&#34;<a href="tgsql_sts.htm#GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59">Loading a SQL Tuning Set</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Optionally, display the contents of the STS.</p>
<p><span class="q">&#34;<a href="tgsql_sts.htm#GUID-B776D937-29CF-40CA-9D5B-2C427934190E">Displaying the Contents of a SQL Tuning Set</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Optionally, update or delete the contents of the STS.</p>
<p><span class="q">&#34;<a href="tgsql_sts.htm#GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62" title="Use the DBMS_SQLTUNE.DELETE_SQLSET procedure to delete SQL statements from an STS.">Modifying a SQL Tuning Set</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Create a tuning task with the STS as input.</p>
</li>
<li>
<p>Optionally, transport the STS to another database.</p>
<p><span class="q">&#34;<a href="tgsql_sts.htm#GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" title="Transporting SQL tuning sets between databases means copying the SQL tuning sets to and from a staging table, and then using other tools to move the staging table to the destination database. The most common tools are Oracle Data Pump or a database link.Transporting SQL tuning sets requires exporting the STS, transporting the dump file, and then importing the dump file.When transporting an STS, you must remap the con_dbid of each SQL statement in the STS when the con_dbid of the source database and the destination database are different.You can transport SQL tuning sets using three subprograms in the DBMS_SQLTUNE package.">Transporting a SQL Tuning Set</a>&#34;</span> describes this task.</p>
</li>
<li>
<p>Drop the STS when finished.</p>
<p><span class="q">&#34;<a href="tgsql_sts.htm#GUID-493FA794-EF69-464D-BB6F-C8CF06686023" title="To drop an STS from the database, execute the DBMS_SQLTUNE.DROP_SQLSET procedure.">Dropping a SQL Tuning Set</a>&#34;</span> describes this task.</p>
</li>
</ol>
</div>
</div>
</div>
<a id="TGSQL527"></a><a id="TGSQL94880"></a><a id="TGSQL526"></a>
<div class="props_rev_3"><a id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD"></a>
<h2 id="TGSQL-GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD" class="sect2">Creating a SQL Tuning Set</h2>
<div>
<div class="section">
<p>Execute the <code class="codeph">DBMS_SQLTUNE.CREATE_SQLSET</code> procedure to create an empty STS in the database. Using the function instead of the procedure causes the database to generate a name for the STS.</p>
<p>The following table describes some procedure parameters.</p>
<div class="tblformal" id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD__BEIIHDDJ">
<p class="titleintable">Table 19-1 DBMS_SQLTUNE.CREATE_SQLSET Parameters</p>
<table class="cellalignment4808" title="DBMS_SQLTUNE.CREATE_SQLSET Parameters" summary="This 2 column table lists the parameters for CREATE_SQLSET task. Column 1 is the parameter. Column 2 describes that parameter.">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4839" id="d105757e1070">Parameter</th>
<th class="cellalignment4839" id="d105757e1073">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d105757e1078" headers="d105757e1070">
<p><code class="codeph">sqlset_name</code></p>
</td>
<td class="cellalignment4802" headers="d105757e1078 d105757e1073">
<p>Name of the STS</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d105757e1086" headers="d105757e1070">
<p><code class="codeph">description</code></p>
</td>
<td class="cellalignment4802" headers="d105757e1086 d105757e1073">
<p>Optional description of the STS</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes that you want to create an STS named <code class="codeph">SQLT_WKLD_STS</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To create an STS:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then run the <code class="codeph">DBMS_SQLTUNE.CREATE_SQLSET</code> procedure.</p>
<p>For example, execute the following PL/SQL program:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.CREATE_SQLSET (
    sqlset_name  =&gt; &#39;SQLT_WKLD_STS&#39; 
,   description  =&gt; &#39;STS to store SQL from the private SQL area&#39; 
);
END;
</pre></li>
<li>
<p>Optionally, confirm that the STS was created.</p>
<p>The following example queries the status of all SQL tuning sets owned by the current user:</p>
<pre dir="ltr">COLUMN NAME FORMAT a20
COLUMN COUNT FORMAT 99999
COLUMN DESCRIPTION FORMAT a30

SELECT NAME, STATEMENT_COUNT AS &#34;SQLCNT&#34;, DESCRIPTION
FROM   USER_SQLSET;
</pre>
<p>Sample output appears below:</p>
<pre dir="ltr">NAME                 SQLCNT DESCRIPTION
-------------------- ------ ------------------------------
SQLT_WKLD_STS             2 SQL Cache
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD__GUID-BB302B38-8429-4E61-A7D1-986F7F715CC8">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68408" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68408"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for complete reference information.</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL529"></a><a id="TGSQL94881"></a><a id="TGSQL94882"></a><a id="TGSQL528"></a>
<div class="props_rev_3"><a id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59"></a>
<h2 id="TGSQL-GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59" class="sect2">Loading a SQL Tuning Set</h2>
<div>
<div class="section">
<p>To load an STS with SQL statements, execute the <code class="codeph">DBMS_SQLTUNE.LOAD_SQLSET</code> procedure. The standard sources for populating an STS are AWR, another STS, or the shared SQL area. For both the workload repository and SQL tuning sets, predefined table functions can select columns from the source to populate a new STS.</p>
<p><a href="tgsql_sts.htm#GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59__BEICCIII" title="initialization parameters for task">Table 19-2</a> describes some <code class="codeph">DBMS_SQLTUNE.LOAD_SQLSET</code> procedure parameters. See <a class="olink ARPLS68430" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68430"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for complete reference information.</p>
<div class="tblformal" id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59__BEICCIII">
<p class="titleintable">Table 19-2 DBMS_SQLTUNE.LOAD_SQLSET Parameters</p>
<table class="cellalignment4808" title="DBMS_SQLTUNE.LOAD_SQLSET Parameters" summary="initialization parameters for task">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4839" id="d105757e1246">Parameter</th>
<th class="cellalignment4839" id="d105757e1249">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d105757e1254" headers="d105757e1246">
<p><code class="codeph">populate_cursor</code></p>
</td>
<td class="cellalignment4802" headers="d105757e1254 d105757e1249">
<p>Specifies the cursor reference from which to populate the STS.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4802" id="d105757e1262" headers="d105757e1246">
<p><code class="codeph">load_option</code></p>
</td>
<td class="cellalignment4802" headers="d105757e1262 d105757e1249">
<p>Specifies how the statements are loaded into the STS. The possible values are <code class="codeph">INSERT</code> (default), <code class="codeph">UPDATE</code>, and <code class="codeph">MERGE</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The <code class="codeph">DBMS_SQLTUNE.SELECT_CURSOR_CACHE</code> function collects SQL statements from the shared SQL area according to the specified filter. This function returns one <code class="codeph">SQLSET_ROW</code> per SQL ID or <code class="codeph">PLAN_HASH_VALUE</code> pair found in each data source.</p>
<p>Use the <code class="codeph">CAPTURE_CURSOR_CACHE_SQLSET</code> function to repeatedly poll the shared SQL area over a specified interval. This function is more efficient than repeatedly calling the <code class="codeph">SELECT_CURSOR_CACHE</code> and <code class="codeph">LOAD_SQLSET</code> procedures. This function effectively captures the entire workload, as opposed to the AWR, which only captures the workload of high-load SQL statements, or the <code class="codeph">LOAD_SQLSET</code> procedure, which accesses the data source only once.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Prerequisites</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial has the following prerequisites:</p>
<ul style="list-style-type: disc;">
<li>
<p>Filters provided to the <code class="codeph">SELECT_CURSOR_CACHE</code> function are evaluated as part of SQL statements run by the current user. As such, they are executed with that user&#39;s security privileges and can contain any constructs and subqueries that user can access, but no more.</p>
</li>
<li>
<p>The current user must have privileges on the shared SQL area views.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes that you want to load the SQL tuning set named <code class="codeph">SQLT_WKLD_STS</code> with statements from the shared SQL area.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To load an STS:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database as a user with the appropriate privileges.</p>
</li>
<li>
<p>Run the <code class="codeph">DBMS_SQLTUNE.LOAD_SQLSET</code> procedure.</p>
<p>For example, execute the following PL/SQL program to populate a SQL tuning set with all cursor cache statements that belong to the <code class="codeph">sh</code> schema:</p>
<pre dir="ltr">DECLARE
  c_sqlarea_cursor DBMS_SQLTUNE.SQLSET_CURSOR;
BEGIN
 OPEN c_sqlarea_cursor FOR
   SELECT VALUE(p)
   FROM   TABLE( 
            DBMS_SQLTUNE.SELECT_CURSOR_CACHE(
            &#39; module = &#39;&#39;SQLT_WKLD&#39;&#39; AND parsing_schema_name = &#39;&#39;SH&#39;&#39; &#39;)
          ) p;
-- load the tuning set
  DBMS_SQLTUNE.LOAD_SQLSET (  
    sqlset_name     =&gt; &#39;SQLT_WKLD_STS&#39;
,   populate_cursor =&gt;  c_sqlarea_cursor 
);
END;
/
</pre></li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL531"></a><a id="TGSQL94883"></a><a id="TGSQL94884"></a><a id="TGSQL530"></a>
<div class="props_rev_3"><a id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E"></a>
<h2 id="TGSQL-GUID-B776D937-29CF-40CA-9D5B-2C427934190E" class="sect2">Displaying the Contents of a SQL Tuning Set</h2>
<div>
<div class="section">
<p>After an STS has been created and populated, execute the <code class="codeph">DBMS_SQLTUNE.SELECT_SQLSET</code> function to read the contents of the STS, optionally using filtering criteria.</p>
<p>You select the output of <code class="codeph">SELECT_SQLSET</code> using a PL/SQL <a href="glossary.htm#GUID-BCAC562D-CB30-4A8E-B9F0-CDF34C39D8B8"><span class="xrefglossterm">pipelined table function</span></a>, which accepts a collection of rows as input. You invoke the table function as the operand of the table operator in the <code class="codeph">FROM</code> list of a <code class="codeph">SELECT</code> statement.</p>
<p><a href="tgsql_sts.htm#GUID-B776D937-29CF-40CA-9D5B-2C427934190E__BEICJIFI" title="initialization parameters for task">Table 19-3</a> describes some <code class="codeph">SELECT_SQLSET</code> function parameters. See <a class="olink ARPLS68458" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68458"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for complete reference information.</p>
<div class="tblformal" id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__BEICJIFI">
<p class="titleintable">Table 19-3 DBMS_SQLTUNE.SELECT_SQLSET Parameters</p>
<table class="cellalignment4808" title="DBMS_SQLTUNE.SELECT_SQLSET Parameters" summary="initialization parameters for task">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4874" id="d105757e1473">Parameter</th>
<th class="cellalignment4884" id="d105757e1476">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4878" id="d105757e1481" headers="d105757e1473">
<p><code class="codeph">basic_filter</code></p>
</td>
<td class="cellalignment4885" headers="d105757e1481 d105757e1476">
<p>The SQL predicate to filter the SQL from the STS defined on attributes of the <code class="codeph">SQLSET_ROW</code></p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4878" id="d105757e1491" headers="d105757e1473">
<p><code class="codeph">object_filter</code></p>
</td>
<td class="cellalignment4885" headers="d105757e1491 d105757e1476">
<p>Specifies the objects that exist in the object list of selected SQL from the shared SQL area</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p><a href="tgsql_sts.htm#GUID-B776D937-29CF-40CA-9D5B-2C427934190E__BEIDGICD" title="initialization parameters for task">Table 19-4</a> describes some attributes of the <code class="codeph">SQLSET_ROW</code> object. These attributes appears as columns when you query <code class="codeph">TABLE(DBMS_SQLTUNE.SELECT_SQLSET())</code>.</p>
<div class="tblformal" id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__BEIDGICD">
<p class="titleintable">Table 19-4 SQLSET_ROW Attributes</p>
<table class="cellalignment4808" title="SQLSET_ROW Attributes" summary="initialization parameters for task">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4843" id="d105757e1520">Parameter</th>
<th class="cellalignment4868" id="d105757e1523">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4845" id="d105757e1528" headers="d105757e1520">
<p><code class="codeph">parsing_schema_name</code></p>
</td>
<td class="cellalignment4869" headers="d105757e1528 d105757e1523">
<p>Schema in which the SQL is parsed</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4845" id="d105757e1536" headers="d105757e1520">
<p><code class="codeph">elapsed_time</code></p>
</td>
<td class="cellalignment4869" headers="d105757e1536 d105757e1523">
<p>Sum of the total number of seconds elapsed for this SQL statement</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4845" id="d105757e1544" headers="d105757e1520">
<p><code class="codeph">buffer_gets</code></p>
</td>
<td class="cellalignment4869" headers="d105757e1544 d105757e1523">
<p>Total number of buffer gets (number of times the database accessed a block) for this SQL statement</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes that you want to display the contents of an STS named <code class="codeph">SQLT_WKLD_STS</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To display the contents of an STS:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then query the STS contents using the <code class="codeph">TABLE</code> function.</p>
<p>For example, execute the following query:</p>
<pre dir="ltr">COLUMN SQL_TEXT FORMAT a30   
COLUMN SCH FORMAT a3
COLUMN ELAPSED FORMAT 999999999

SELECT SQL_ID, PARSING_SCHEMA_NAME AS &#34;SCH&#34;, SQL_TEXT, 
       ELAPSED_TIME AS &#34;ELAPSED&#34;, BUFFER_GETS
FROM   TABLE( DBMS_SQLTUNE.SELECT_SQLSET( &#39;SQLT_WKLD_STS&#39; ) );
</pre>
<p>Sample output appears below:</p>
<pre dir="ltr">SQL_ID        SCH SQL_TEXT                          ELAPSED BUFFER_GETS
------------- --- ------------------------------ ---------- -----------
79f8shn041a1f SH  select * from sales where quan    8373148       24016
                  tity_sold &lt; 5 union select * f
                  rom sales where quantity_sold
                  &gt; 500
 
2cqsw036j5u7r SH  select promo_name, count(*) c     3557373         309
                  from promotions p, sales s whe
                  re s.promo_id = p.promo_id and
                   p.promo_category = &#39;internet&#39;
                   group by p.promo_name order b
                  y c desc
 
fudq5z56g642p SH  select sum(quantity_sold) from    4787891       12118
                   sales s, products p where s.p
                  rod_id = p.prod_id and s.amoun
                  t_sold &gt; 20000 and p.prod_name
                   = &#39;Linen Big Shirt&#39;
 
bzmnj0nbvmz8t SH  select * from sales where amou     442355       15281
                  nt_sold = 4
</pre></li>
<li>
<p>Optionally, filter the results based on user-specific criteria.</p>
<p>The following example displays statements with a disk reads to buffer gets ratio greater than or equal to 50%:</p>
<pre dir="ltr">COLUMN SQL_TEXT FORMAT a30   
COLUMN SCH FORMAT a3
COLUMN BUF_GETS FORMAT 99999999
COLUMN DISK_READS FORMAT 99999999
COLUMN %_DISK FORMAT 9999.99
SELECT sql_id, parsing_schema_name as &#34;SCH&#34;, sql_text, 
       buffer_gets as &#34;B_GETS&#34;,
       disk_reads, ROUND(disk_reads/buffer_gets*100,2) &#34;%_DISK&#34;
FROM TABLE( DBMS_SQLTUNE.SELECT_SQLSET( 
            &#39;SQLT_WKLD_STS&#39;,
            &#39;(disk_reads/buffer_gets) &gt;= 0.50&#39; ) );
</pre>
<p>Sample output appears below:</p>
<pre dir="ltr">SQL_ID        SCH SQL_TEXT                       B_GETS DISK_READS %_DISK
------------- --- ------------------------------ ------ ---------- -------
79f8shn041a1f SH  select * from sales where quan  24016      17287  71.98
                  tity_sold &lt; 5 union select * f
                  rom sales where quantity_sold
                  &gt; 500
 
fudq5z56g642p SH  select sum(quantity_sold) from  12118       6355  52.44
                   sales s, products p where s.p
                  rod_id = p.prod_id and s.amoun
                  t_sold &gt; 20000 and p.prod_name
                   = &#39;Linen Big Shirt&#39;
</pre></li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94885"></a><a id="TGSQL532"></a>
<div class="props_rev_3"><a id="GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62"></a>
<h2 id="TGSQL-GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62" class="sect2">Modifying a SQL Tuning Set</h2>
<div>
<p>Use the <code class="codeph">DBMS_SQLTUNE.DELETE_SQLSET</code> procedure to delete SQL statements from an STS.</p>
<div class="section">
<p>You can use the <code class="codeph">UPDATE_SQLSET</code> procedure to update the attributes of SQL statements (such as <code class="codeph">PRIORITY</code> or <code class="codeph">OTHER</code>) in an existing STS identified by STS name and SQL ID.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes that you want to modify <code class="codeph">SQLT_WKLD_STS</code> as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>You want to delete all SQL statements with fetch counts over 100.</p>
</li>
<li>
<p>You want to change the priority of the SQL statement with ID <code class="codeph">fudq5z56g642p</code> to <code class="codeph">1</code>. You can use priority as a ranking criteria when running SQL Tuning Advisor.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To modify the contents of an STS:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then optionally query the STS contents using the <code class="codeph">TABLE</code> function.</p>
<p>For example, execute the following query:</p>
<pre dir="ltr">SELECT SQL_ID, ELAPSED_TIME, FETCHES, EXECUTIONS
FROM   TABLE(DBMS_SQLTUNE.SELECT_SQLSET(&#39;SQLT_WKLD_STS&#39;));
</pre>
<p>Sample output appears below:</p>
<pre dir="ltr">SQL_ID        ELAPSED_TIME    FETCHES EXECUTIONS
------------- ------------ ---------- ----------
2cqsw036j5u7r      3407459          2          1
79f8shn041a1f      9453965      61258          1
bzmnj0nbvmz8t       401869          1          1
fudq5z56g642p      5300264          1          1
</pre></li>
<li>
<p>Delete SQL statements based on user-specified criteria.</p>
<p>Use the <code class="codeph">basic_filter</code> predicate to filter the SQL from the STS defined on attributes of the <code class="codeph">SQLSET_ROW</code>. The following example deletes all statements in the STS with fetch counts over 100:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.DELETE_SQLSET (
      sqlset_name  =&gt; &#39;SQLT_WKLD_STS&#39;
,     basic_filter =&gt; &#39;fetches &gt; 100&#39;
);
END;
/
</pre></li>
<li>
<p>Set attribute values for SQL statements.</p>
<p>The following example sets the priority of statement <code class="codeph">2cqsw036j5u7r</code> to <code class="codeph">1</code>:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.UPDATE_SQLSET ( 
      sqlset_name     =&gt; &#39;SQLT_WKLD_STS&#39;    
,     sql_id          =&gt; &#39;2cqsw036j5u7r&#39;    
,     attribute_name  =&gt; &#39;PRIORITY&#39;         
,     attribute_value =&gt;  1
);
END;
/
</pre></li>
<li>
<p>Optionally, query the STS to confirm that the intended modifications were made.</p>
<p>For example, execute the following query:</p>
<pre dir="ltr">SELECT SQL_ID, ELAPSED_TIME, FETCHES, EXECUTIONS, PRIORITY
FROM   TABLE(DBMS_SQLTUNE.SELECT_SQLSET(&#39;SQLT_WKLD_STS&#39;));
</pre>
<p>Sample output appears below:</p>
<pre dir="ltr">SQL_ID        ELAPSED_TIME    FETCHES EXECUTIONS   PRIORITY
------------- ------------ ---------- ---------- ----------
2cqsw036j5u7r      3407459          2          1          1
bzmnj0nbvmz8t       401869          1          1
fudq5z56g642p      5300264          1          1
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62__GUID-4AB4651D-A6FD-44E0-91BD-F5EDCFFFCBC5">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68416" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68416"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for more information</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL533"></a>
<div class="props_rev_3"><a id="GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C"></a>
<h2 id="TGSQL-GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" class="sect2">Transporting a SQL Tuning Set</h2>
<div>
<p>You can transport an STS to any database created in Oracle Database 10<span class="italic">g</span> Release 2 (10.2) or later. This technique is useful when using SQL Performance Analyzer to tune regressions on a test database.</p>
</div>
<a id="TGSQL534"></a>
<div class="props_rev_3"><a id="GUID-35D138E2-1E24-4911-921E-F73C2478EB96"></a>
<h3 id="TGSQL-GUID-35D138E2-1E24-4911-921E-F73C2478EB96" class="sect3">About Transporting SQL Tuning Sets</h3>
<div>
<p>Transporting SQL tuning sets between databases means copying the SQL tuning sets to and from a staging table, and then using other tools to move the staging table to the destination database. The most common tools are Oracle Data Pump or a database link.</p>
</div>
<a id="TGSQL535"></a><a id="TGSQL95107"></a>
<div class="props_rev_3"><a id="GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C"></a>
<h4 id="TGSQL-GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C" class="sect4">Basic Steps for Transporting SQL Tuning Sets</h4>
<div>
<p>Transporting SQL tuning sets requires exporting the STS, transporting the dump file, and then importing the dump file.</p>
<p>The following graphic shows the process using Oracle Data Pump and <code class="codeph">ftp</code>.</p>
<div class="figure" id="GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C__BEIHAEEG">
<p class="titleinfigure">Figure 19-4 Transporting SQL Tuning Sets</p>
<img width="575" height="302" src="img/GUID-DBEA4EF1-C72D-4F52-9051-4C16DF39C85F-default.png" alt="Description of Figure 19-4 follows" title="Description of Figure 19-4 follows"/><br/>
<a href="img_text/GUID-DBEA4EF1-C72D-4F52-9051-4C16DF39C85F-print.htm">Description of &#34;Figure 19-4 Transporting SQL Tuning Sets&#34;</a></div>
<!-- class="figure" -->
<p>As shown in <a href="tgsql_sts.htm#GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C__BEIHAEEG">Figure 19-4</a>, the steps are as follows:</p>
<ol>
<li>
<p>In the production database, pack the STS into a staging table using <code class="codeph">DBMS_SQLTUNE.PACK_STGTAB_SQLSET</code>.</p>
</li>
<li>
<p>Export the STS from the staging table to a <code class="codeph">.dmp</code> file using Oracle Data Pump.</p>
</li>
<li>
<p>Transfer the <code class="codeph">.dmp</code> file from the production host to the test host using a transfer tool such as <code class="codeph">ftp</code>.</p>
</li>
<li>
<p>In the test database, import the STS from the <code class="codeph">.dmp</code> file to a staging table using Oracle Data Pump.</p>
</li>
<li>
<p>Unpack the STS from the staging table using <code class="codeph">DBMS_SQLTUNE.UNPACK_STGTAB_SQLSET</code>.</p>
</li>
</ol>
</div>
</div>
<a id="TGSQL95108"></a>
<div class="props_rev_3"><a id="GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA"></a>
<h4 id="TGSQL-GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA" class="sect4">Basic Steps for Transporting SQL Tuning Sets When the CON_DBID Values Differ</h4>
<div>
<p>When transporting an STS, you must remap the <code class="codeph">con_dbid</code> of each SQL statement in the STS when the <code class="codeph">con_dbid</code> of the source database and the destination database are different.</p>
<p>Situations that cause the <code class="codeph">con_dbid</code> value to differ include the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>A single-instance database whose instance has been restarted</p>
</li>
<li>
<p>Different instances of an Oracle RAC database</p>
</li>
<li>
<p>Different PDBs</p>
</li>
<li>
<p>A non-CDB and a CDB</p>
</li>
</ul>
<p>The basic steps for remapping are as follows:</p>
<ol>
<li>
<p>Pack the STS into a staging table using <code class="codeph">DBMS_SQLTUNE.PACK_STGTAB_SQLSET</code>.</p>
</li>
<li>
<p>Remap each <code class="codeph">con_dbid</code> in the staging table using <code class="codeph">DBMS_SQLTUNE.REMAP_STGTAB_SQLSET</code>.</p>
</li>
<li>
<p>Export the STS.</p>
</li>
<li>
<p>Unpack the STS in the destination CDB.</p>
</li>
</ol>
<div class="example" id="GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA__GUID-F0D849D0-1F44-42C7-A189-CD70BB61D441">
<p class="titleinexample">Example 19-1 Remapping a CON_DBID When Transporting an STS from a Non-CDB to a CDB</p>
<p>In this example, you intend to transport an STS named <code class="codeph">STS_for_transport</code> from a non-CDB to a CDB. On the source non-CDB, you have already packed the STS into source staging table <code class="codeph">src_stg_tbl</code> using the <code class="codeph">DBMS_SQLTUNE.PACK_STGTAB_SQLSET</code> procedure. The container ID of the destination CDB is <code class="codeph">12345</code>.</p>
<p>In the source non-CDB, you execute the following commands:</p>
<pre dir="ltr">VARIABLE con_dbid_src NUMBER;

EXEC SELECT UNIQUE con_dbid INTO :con_dbid_src FROM src_stg_tbl;

BEGIN
  DBMS_SQLTUNE.REMAP_STGTAB_SQLSET (
    staging_table_name   =&gt; &#39;src_stg_tbl&#39;
,   staging_schema_owner =&gt; &#39;dba1&#39;
,   old_sqlset_name      =&gt; &#39;STS_for_transport&#39;
,   old_con_dbid         =&gt; :con_dbid_src
,   new_con_dbid         =&gt; 12345);
END;
</pre>
<p>You can now export the contents of the staging table, and then continue using the normal transport procedure.</p>
<div class="infoboxnotealso" id="GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA__GUID-497250A0-F8BE-4CDC-B4B5-EB89B2215BB7">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68438" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68438"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about <code class="codeph">REMAP_STGTAB_SQLSET</code></p>
</div>
</div>
<!-- class="example" --></div>
</div>
</div>
<a id="TGSQL537"></a><a id="TGSQL538"></a><a id="TGSQL536"></a>
<div class="props_rev_3"><a id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6"></a>
<h3 id="TGSQL-GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6" class="sect3">Transporting SQL Tuning Sets with DBMS_SQLTUNE</h3>
<div>
<p>You can transport SQL tuning sets using three subprograms in the <code class="codeph">DBMS_SQLTUNE</code> package.</p>
<div class="section">
<p>The following table describes the <code class="codeph">DBMS_SQLTUNE</code> procedures relevant for transporting SQL tuning sets.</p>
<div class="tblformal" id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6__BEIDACDA">
<p class="titleintable">Table 19-5 DBMS_SQLTUNE Procedures for Transporting SQL Tuning Sets</p>
<table class="cellalignment4808" title="DBMS_SQLTUNE Procedures for Transporting SQL Tuning Sets" summary="initialization parameters for task">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4810" id="d105757e2315">Procedure</th>
<th class="cellalignment4837" id="d105757e2318">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d105757e2323" headers="d105757e2315">
<p><code class="codeph">CREATE_STGTAB_SQLSET</code></p>
</td>
<td class="cellalignment4838" headers="d105757e2323 d105757e2318">
<p>Create a staging table to hold the exported SQL tuning sets</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d105757e2331" headers="d105757e2315">
<p><code class="codeph">PACK_STGTAB_SQLSET</code></p>
</td>
<td class="cellalignment4838" headers="d105757e2331 d105757e2318">
<p>Populate a staging table with SQL tuning sets</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d105757e2339" headers="d105757e2315">
<p><code class="codeph">UNPACK_STGTAB_SQLSET</code></p>
</td>
<td class="cellalignment4838" headers="d105757e2339 d105757e2318">
<p>Copy the SQL tuning sets from the staging table into a database</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>An STS with regressed SQL resides in a production database created in the current release.</p>
</li>
<li>
<p>You run SQL Performance Analyzer trials on a remote test database created in Oracle Database 11<span class="italic">g</span> Release 2 (11.2).</p>
</li>
<li>
<p>You want to copy the STS from the production database to the test database and tune the regressions from the SQL Performance Analyzer trials.</p>
</li>
<li>
<p>You want to use Oracle Database Pump to transfer the SQL tuning sets between database hosts.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To transport an STS:</p>
<ol>
<li>
<p>Connect SQL*Plus to the production database with administrator privileges.</p>
</li>
<li>
<p>Use the <code class="codeph">CREATE_STGTAB_SQLSET</code> procedure to create a staging table to hold the exported SQL tuning sets.</p>
<p>The following example creates <code class="codeph">my_11g_staging_table</code> in the <code class="codeph">dba1</code> schema and specifies the format of the staging table as 11.2:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.CREATE_STGTAB_SQLSET ( 
    table_name  =&gt; &#39;my_10g_staging_table&#39;
,   schema_name =&gt; &#39;dba1&#39;
,   db_version  =&gt; DBMS_SQLTUNE.STS_STGTAB_11_2_VERSION 
);
END;
/
</pre></li>
<li>
<p>Use the <code class="codeph">PACK_STGTAB_SQLSET</code> procedure to populate the staging table with SQL tuning sets.</p>
<p>The following example populates <code class="codeph">dba1.my_11g_staging_table</code> with the STS <code class="codeph">my_sts</code> owned by <code class="codeph">hr</code>:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.PACK_STGTAB_SQLSET (      
    sqlset_name         =&gt; &#39;sqlt_wkld_sts&#39;
,   sqlset_owner        =&gt; &#39;sh&#39;
,   staging_table_name  =&gt; &#39;my_11g_staging_table&#39;
,   staging_schema_owner =&gt; &#39;dba1&#39;
,   db_version          =&gt; DBMS_SQLTUNE.STS_STGTAB_11_2_VERSION 
);
END;
/ 
</pre></li>
<li>
<p>If necessary, remap the container ID values for the statements in the STS as described in <span class="q">&#34;<a href="tgsql_sts.htm#GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA" title="When transporting an STS, you must remap the con_dbid of each SQL statement in the STS when the con_dbid of the source database and the destination database are different.">Basic Steps for Transporting SQL Tuning Sets When the CON_DBID Values Differ</a>&#34;</span>.</p>
</li>
<li>
<p>Use Oracle Data Pump to export the contents of the staging table.</p>
<p>For example, run the <code class="codeph">expdp</code> command at the operating system prompt:</p>
<pre dir="ltr">expdp dba1 DIRECTORY=dpump_dir1 DUMPFILE=sts.dmp TABLES=my_11g_staging_table
</pre></li>
<li>
<p>Transfer the dump file to the test database host.</p>
</li>
<li>
<p>Log in to the test host as an administrator, and then use Oracle Data Pump to import the contents of the staging table.</p>
<p>For example, run the <code class="codeph">impdp</code> command at the operating system prompt:</p>
<pre dir="ltr">impdp dba1 DIRECTORY=dpump_dir1 DUMPFILE=sts.dmp TABLES=my_11g_staging_table 
</pre></li>
<li>
<p>On the test database, execute the <code class="codeph">UNPACK_STGTAB_SQLSET</code> procedure to copy the SQL tuning sets from the staging table into the database.</p>
<p>The following example shows how to unpack the SQL tuning sets:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.UNPACK_STGTAB_SQLSET (
    sqlset_name        =&gt; &#39;%&#39;
,   replace            =&gt; true
,   staging_table_name =&gt; &#39;my_11g_staging_table&#39;);
END;
/
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6__GUID-21EAE563-510A-4CA3-9DC0-BA1BFE4CB085">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68412" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68412"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_SQLTUNE.UNPACK_STGTAB_SQLSET</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL94886"></a><a id="TGSQL94887"></a><a id="TGSQL539"></a>
<div class="props_rev_3"><a id="GUID-493FA794-EF69-464D-BB6F-C8CF06686023"></a>
<h2 id="TGSQL-GUID-493FA794-EF69-464D-BB6F-C8CF06686023" class="sect2">Dropping a SQL Tuning Set</h2>
<div>
<p>To drop an STS from the database, execute the <code class="codeph">DBMS_SQLTUNE.DROP_SQLSET</code> procedure.</p>
<div class="section">
<p class="subhead2">Prerequisites</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Ensure that no tuning task is currently using the STS to be dropped. If an existing tuning task is using this STS, then drop the task before dropping the STS. Otherwise, the database issues an <code class="codeph">ORA-13757</code> error.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes that you want to drop an STS named <code class="codeph">SQLT_WKLD_STS</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To drop an STS:</p>
<ol>
<li>
<p>Start SQL*Plus, and then log in to the database with the appropriate privileges.</p>
</li>
<li>
<p>Run the <code class="codeph">DBMS_SQLTUNE.DROP_SQLSET</code> procedure.</p>
<p>For example, execute the following PL/SQL program:</p>
<pre dir="ltr">BEGIN
  DBMS_SQLTUNE.DROP_SQLSET( sqlset_name =&gt; &#39;SQLT_WKLD_STS&#39; );
END;
/
</pre></li>
<li>
<p>Optionally, confirm that the STS was deleted.</p>
<p>The following example counts the number of SQL tuning sets named <code class="codeph">SQLT_WKLD_STS</code> owned by the current user (sample output included):</p>
<pre dir="ltr">SELECT COUNT(*) 
FROM   USER_SQLSET 
WHERE  NAME = &#39;SQLT_WKLD_STS&#39;;

  COUNT(*)
----------
         0
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-493FA794-EF69-464D-BB6F-C8CF06686023__GUID-0D2CC086-518D-43DD-AD9F-FC9AB2E7EAF1">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68420" target="_blank" href="../ARPLS/d_sqltun.htm#ARPLS68420"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the STS procedures in <code class="codeph">DBMS_SQLTUNE</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4801">
<tr>
<td class="cellalignment4834">
<table class="cellalignment4806">
<tr>
<td class="cellalignment4805"><a href="tgsql_pt_sqltune.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4805"><a href="tgsql_sqltune.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4836">
<table class="cellalignment4804">
<tr>
<td class="cellalignment4805"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4805"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4805"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4805"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4805"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4805"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>