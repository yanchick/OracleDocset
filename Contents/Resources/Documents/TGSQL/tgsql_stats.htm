<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-106805"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Managing%20Optimizer%20Statistics%3A%20Basic%20Topics"></a><title>Managing Optimizer Statistics: Basic Topics</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="This chapter explains basic tasks relating to optimizer statistics management."/>
<meta name="keywords" content="optimizer statistics, basic topics, fixed objects, gathering statistics for, optimizer statistics collection, collection, statistics, optimizer, SQL Tuning Advisor, using, high-load SQL, tuning, automatic collection, pluggable databases, automatic optimizer statistics collection, pluggable databases and, manageability features, automatic statistics collection, getting, setting, preferences, manual collection, dynamic statistics, dynamic, gathering concurrently, concurrent statistics gathering, gathering in parallel, parallel execution, gathering statistics, DBA_OPTSTAT_OPERATIONS view, DBA_OPTSTAT_OPERATION_TASKS view, monitoring collection, partitioned objects, gathering incremental statistics, incremental, incremental statistics, maintenance, partition maintenance operations"/>
<meta name="dcterms.created" content="2017-07-24T09:35:46Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database SQL Tuning Guide"/>
<meta name="dcterms.identifier" content="E49106-14"/>
<meta name="dcterms.isVersionOf" content="TGSQL"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="tgsql_histo.htm" title="Previous" type="text/html"/>
<link rel="Next" href="tgsql_astat.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E49106-14.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878"></a> <span id="PAGE" style="display:none;">21/40</span> <!-- End Header -->
<a id="TGSQL389"></a>
<h1 id="TGSQL-GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" class="sect1"><span class="enumeration_chapter">12</span> Managing Optimizer Statistics: Basic Topics</h1>
<div>
<p>This chapter explains basic tasks relating to optimizer statistics management.</p>
<p>This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_stats.htm#GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" title="This topic explains how to set optimizer statistics defaults using DBMS_STATS.SET_*_PREFS procedures.">Setting Optimizer Statistics Preferences</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="This topic explains how to configure Oracle Database to gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="Use the DBMS_STATS package to manipulate optimizer statistics. You can gather statistics on objects and columns at various levels of granularity: object, schema, and database. You can also gather statistics for the physical system.In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.In the context of optimizer statistics, sampling is the gathering of statistics from a random subset of table rows. By enabling the database to avoid full table scans and sorts of entire tables, sampling minimizes the resources necessary to gather statistics.By default, the database gathers statistics with the parallelism degree specified at the table or index level. You can override this setting with the degree argument to the DBMS_STATS gathering procedures.Because the database does not permit data manipulation against external tables, the database never marks statistics on external tables as stale. If new statistics are required for an external table, for example, because the underlying data files change, then regather the statistics. Stale statistics on a table do not accurately reflect its data. The database provides a table monitoring facility to help determine when a database object needs new statistics. Statistics for volatile tables, which are tables modified significantly during the day, go stale quickly. For example, a table may be deleted or truncated, and then rebuilt.Oracle Database enables you to gather statistics on multiple tables or partitions concurrently.By default, each partition of a partition table is gathered sequentially. Oracle Database employs multiple tools and technologies to create and manage multiple statistics gathering jobs concurrently.To enable concurrent statistics gathering, use the DBMS_STATS.SET_GLOBAL_PREFS procedure to set the CONCURRENT preference. When CONCURRENT statistics gathering is enabled, you can execute each statistics gathering job in parallel. This combination is useful when you are analyzing large tables, partitions, or subpartitions. This topic describes the recommended configuration.You can monitor statistics gathering jobs using data dictionary views.Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, Incremental statistics maintenance improves performance.In a typical case, an application loads data into a new partition of a range-partitioned table. As applications add new partitions and load data, the database must gather statistics on the new partition and keep global statistics up to date.When incremental statistics maintenance is enabled, DBMS_STATS gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.Incremental statistics affect how the database gathers and stores table and index statistics.A partition maintenance operation is a partition-related operation such as adding, exchanging, merging, or splitting table partitions.Starting in Oracle Database 12c, incremental statistics can automatically calculate global statistics for a partitioned table even if the partition or subpartition statistics are stale and locked.">Gathering Optimizer Statistics Manually</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="Workload statistics analyze activity in a specified time period.This tutorial explains how to set the workload interval with the INTERVAL parameter of GATHER_SYSTEM_STATS.">Gathering System Statistics Manually</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878__GUID-665B8F0B-5D1A-43E1-ABA3-725E02DF4C33">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_astat.htm#GUID-F1399D77-7E2E-434F-A67C-6ADB4C648D95" title="This chapter explains advanced concepts and tasks relating to optimizer statistics management, including extended statistics.">Managing Optimizer Statistics: Advanced Topics</a>&#34;</span> for advanced concepts and tasks relating to optimizer statistics</p>
</li>
<li>
<p><span class="q">&#34;<a href="tgsql_statscon.htm#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle Database optimizer statistics describe details about the database and its objects.">Optimizer Statistics Concepts</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="tgsql_optcncpt.htm#GUID-06129ACE-36B2-4534-AE68-EDFCAEBB3B5D" title="A solid understanding of the optimizer is essential for SQL tuning.">Query Optimizer Concepts</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<a id="TGSQL390"></a>
<div class="props_rev_3"><a id="GUID-3B795407-2E23-4612-B243-52701799F0B0"></a>
<h2 id="TGSQL-GUID-3B795407-2E23-4612-B243-52701799F0B0" class="sect2">About Optimizer Statistics Collection</h2>
<div>
<p>In Oracle Database, <strong class="term">optimizer statistics collection</strong> is the gathering of optimizer statistics for database objects, including fixed objects.</p>
<p>The database can collect optimizer statistics automatically. You can also collect them manually using the <code class="codeph">DBMS_STATS</code> package.</p>
</div>
<a id="TGSQL94582"></a>
<div class="props_rev_3"><a id="GUID-212B6999-D190-4B00-BE30-D7830B3D8499"></a>
<h3 id="TGSQL-GUID-212B6999-D190-4B00-BE30-D7830B3D8499" class="sect3">Purpose of Optimizer Statistics Collection</h3>
<div>
<p>The contents of tables and associated indexes change frequently, which can lead the optimizer to choose suboptimal execution plan for queries. To avoid potential performance issues, statistics must be kept current.</p>
<p>To minimize DBA involvement, Oracle Database automatically gathers optimizer statistics at various times. Some automatic options are configurable, such enabling AutoTask to run <code class="codeph">DBMS_STATS</code>.</p>
</div>
</div>
<a id="TGSQL391"></a>
<div class="props_rev_3"><a id="GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7"></a>
<h3 id="TGSQL-GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7" class="sect3">User Interfaces for Optimizer Statistics Management</h3>
<div>
<p>You can manage optimizer statistics either through Oracle Enterprise Manager Cloud Control (Cloud Control) or using PL/SQL on the command line.</p>
</div>
<a id="TGSQL392"></a>
<div class="props_rev_3"><a id="GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3"></a>
<h4 id="TGSQL-GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3" class="sect4">Graphical Interface for Optimizer Statistics Management</h4>
<div>
<p>The Manage Optimizer Statistics page in Cloud Control is a GUI that enables you to manage optimizer statistics.</p>
</div>
<a id="TGSQL94917"></a>
<div class="props_rev_3"><a id="GUID-15511441-3164-4233-A0F8-54A8DF44AC6D"></a>
<h5 id="TGSQL-GUID-15511441-3164-4233-A0F8-54A8DF44AC6D" class="sect5">Accessing the Database Home Page in Cloud Control</h5>
<div>
<div class="section">
<p>Oracle Enterprise Manager Cloud Control enables you to manage multiple databases within a single GUI-based framework.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To access a database home page using Cloud Control:</p>
<ol>
<li>
<p>Log in to Cloud Control with the appropriate credentials.</p>
</li>
<li>
<p>Under the <span class="bold">Targets</span> menu, select <span class="bold">Databases</span>.</p>
</li>
<li>
<p>In the list of database targets, select the target for the Oracle Database instance that you want to administer.</p>
</li>
<li>
<p>If prompted for database credentials, then enter the minimum credentials necessary for the tasks you intend to perform.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-15511441-3164-4233-A0F8-54A8DF44AC6D__GUID-2A854074-E945-4F93-8CE8-069D7B990D92">
<p class="notep1">See Also:</p>
<p>Cloud Control online help</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL393"></a>
<div class="props_rev_3"><a id="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830"></a>
<h5 id="TGSQL-GUID-360B47CD-4CE0-4336-8637-FD90A16F2830" class="sect5">Accessing the Optimizer Statistics Console</h5>
<div>
<p>You can perform most necessary tasks relating to optimizer statistics through pages linked to by the Optimizer Statistics Console page.</p>
<div class="section">
<p class="subhead3">To manage optimizer statistics using Cloud Control:</p>
<ol>
<li>
<p>Access the <span>Database Home</span> page.</p>
</li>
<li>
<p>From the <span class="bold">Performance</span> menu, select <span class="bold">SQL</span>, then <span class="bold">Optimizer Statistics</span>.</p>
<p>The Optimizer Statistics Console appears.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830__GUID-7422A963-293D-431A-9B81-735C0F0630F7">
<p class="notep1">See Also:</p>
<p>Online Help for Oracle Enterprise Manager Cloud Control</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL394"></a>
<div class="props_rev_3"><a id="GUID-476BA982-0543-4B4D-84C7-8123D6174E1F"></a>
<h4 id="TGSQL-GUID-476BA982-0543-4B4D-84C7-8123D6174E1F" class="sect4">Command-Line Interface for Optimizer Statistics Management</h4>
<div>
<p>The <code class="codeph">DBMS_STATS</code> package performs most optimizer statistics tasks. To enable and disable automatic statistics gathering, use the <code class="codeph">DBMS_AUTO_TASK_ADMIN</code> PL/SQL package.</p>
<div class="infoboxnotealso" id="GUID-476BA982-0543-4B4D-84C7-8123D6174E1F__GUID-DF378729-C6B6-4695-AD36-A4BB99DD530E">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68486" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68486"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn how to use <code class="codeph">DBMS_STATS</code> and <code class="codeph">DBMS_AUTO_TASK_ADMIN</code></p>
</div>
</div>
</div>
</div>
</div>
<a id="TGSQL395"></a>
<div class="props_rev_3"><a id="GUID-F007E78A-9967-4921-8046-D8F59A9272B4"></a>
<h2 id="TGSQL-GUID-F007E78A-9967-4921-8046-D8F59A9272B4" class="sect2">Configuring Automatic Optimizer Statistics Collection</h2>
<div>
<p>This topic explains how to configure Oracle Database to gather optimizer statistics automatically.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_stats.htm#GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C" title="The automated maintenance tasks infrastructure (known as AutoTask) schedules tasks to run automatically in Oracle Scheduler windows known as maintenance windows.">About Automatic Optimizer Statistics Collection</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-3D546E00-5DC0-4350-80F8-68205008FCEA" title="You can enable and disable all automatic maintenance tasks, including automatic optimizer statistics collection, using Cloud Control.">Configuring Automatic Optimizer Statistics Collection Using Cloud Control</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C" title="If you do not use Cloud Control to configure automatic optimizer statistics collection, then you must use the command line.">Configuring Automatic Optimizer Statistics Collection from the Command Line</a></p>
</li>
</ul>
</div>
<div class="props_rev_3"><a id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C"></a>
<h3 id="TGSQL-GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C" class="sect3">About Automatic Optimizer Statistics Collection</h3>
<div>
<p>The automated maintenance tasks infrastructure (known as AutoTask) schedules tasks to run automatically in Oracle Scheduler windows known as maintenance windows.</p>
<p>By default, one window is scheduled for each day of the week. Automatic optimizer statistics collection runs as part of AutoTask. By default, the collection runs in all predefined maintenance windows.</p>
<div class="infobox-note" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-ACEA21D5-E9D3-4BA2-870D-BE3300013F53">
<p class="notep1">Note:</p>
<p>Data visibility and privilege requirements may differ when using automatic optimizer statistics collection with pluggable databases.</p>
</div>
<p>To collect the optimizer statistics, the database calls an internal procedure that operates similarly to the <code class="codeph">GATHER_DATABASE_STATS</code> procedure with the <code class="codeph">GATHER AUTO</code> option. Automatic statistics collection honors all preferences set in the database.</p>
<p>The principal difference between manual and automatic collection is that the latter prioritizes database objects that need statistics. Before the maintenance window closes, automatic collection assesses all objects and prioritizes objects that have no statistics or very old statistics.</p>
<div class="infobox-note" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-784706EE-7783-448A-B3A6-35D59EF97D6D">
<p class="notep1">Note:</p>
<p>When gathering statistics manually, you can reproduce the object prioritization of automatic collection by using the <code class="codeph">DBMS_AUTO_TASK_IMMEDIATE</code> package. This package runs the same statistics gathering job that is executed during the automatic nightly statistics gathering job.</p>
</div>
<div class="infoboxnotealso" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-5CA45A75-AEBE-4FF1-AA09-D16AD61938F1">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN13885" target="_blank" href="../ADMIN/cdb_admin.htm#ADMIN13885"><span><cite>Oracle Database Administrator&rsquo;s Guide</cite></span></a> for a table that summarizes how manageability features work in a container database (CDB)</p>
</div>
</div>
</div>
<a id="TGSQL396"></a>
<div class="props_rev_3"><a id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA"></a>
<h3 id="TGSQL-GUID-3D546E00-5DC0-4350-80F8-68205008FCEA" class="sect3">Configuring Automatic Optimizer Statistics Collection Using Cloud Control</h3>
<div>
<p>You can enable and disable all automatic maintenance tasks, including automatic optimizer statistics collection, using Cloud Control.</p>
<div class="section">
<p>The default window timing works well for most situations. However, you may have operations such as bulk loads that occur during the window. In such cases, to avoid potential conflicts that result from operations occurring at the same time as automatic statistics collection, Oracle recommends that you change the window accordingly.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To control automatic optimizer statistics collection using Cloud Control:</p>
<ol>
<li>
<p>Access the Database Home page, as described in <span class="q">&#34;<a href="tgsql_stats.htm#GUID-15511441-3164-4233-A0F8-54A8DF44AC6D">Accessing the Database Home Page in Cloud Control</a>.&#34;</span></p>
</li>
<li>
<p>From the <span class="bold">Administration</span> menu, select <span class="bold">Oracle Scheduler</span>, then <span class="bold">Automated Maintenance Tasks</span>.</p>
<p>The Automated Maintenance Tasks page appears.</p>
<p>This page shows the predefined tasks. To retrieve information about each task, click the corresponding link for the task.</p>
</li>
<li>
<p>Click <span class="bold">Configure</span>.</p>
<p>The Automated Maintenance Tasks Configuration page appears.</p>
<p>By default, automatic optimizer statistics collection executes in all predefined maintenance windows in <code class="codeph">MAINTENANCE_WINDOW_GROUP</code>.</p>
</li>
<li>
<p>Perform the following steps:</p>
<ol>
<li>
<p>In the Task Settings section for Optimizer Statistics Gathering, select either <span class="bold">Enabled</span> or <span class="bold">Disabled</span> to enable or disable an automated task.</p>
<div class="infobox-note" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-18208DB9-4038-49A9-BB1D-72CD2F1559F6">
<p class="notep1">Note:</p>
<p>Oracle strongly recommends that you not disable automatic statistics gathering because it is critical for the optimizer to generate optimal plans for queries against dictionary and user objects. If you disable automatic collection, ensure that you have a good manual statistics collection strategy for dictionary and user schemas.</p>
</div>
</li>
<li>
<p>To disable statistics gathering for specific days in the week, check the appropriate box next to the window name.</p>
</li>
<li>
<p>To change the characteristics of a window group, click <span class="bold">Edit Window Group</span>.</p>
</li>
<li>
<p>To change the times for a window, click the name of the window (for example, <span class="bold">MONDAY_WINDOW</span>), and then in the Schedule section, click <span class="bold">Edit</span>.</p>
<p>The Edit Window page appears.</p>
<div class="figure" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-8AE3F5E7-6AE1-433A-A1AA-48DE99791589"><img width="712" height="544" src="img/GUID-69CAAF98-D64D-41D9-94B1-AAF04C51BCF6-default.jpg" alt="Description of GUID-69CAAF98-D64D-41D9-94B1-AAF04C51BCF6-default.jpg follows" title="Description of GUID-69CAAF98-D64D-41D9-94B1-AAF04C51BCF6-default.jpg follows"/><br/>
<a href="img_text/GUID-69CAAF98-D64D-41D9-94B1-AAF04C51BCF6-default.htm">Description of the illustration GUID-69CAAF98-D64D-41D9-94B1-AAF04C51BCF6-default.jpg</a></div>
<!-- class="figure" -->
<p>In this page, you can change the parameters such as duration and start time for window execution.</p>
</li>
<li>
<p>Click <span class="bold">Apply</span>.</p>
</li>
</ol>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-B6D8768F-CE59-4BD3-A5C9-7E1DA6D70FDC">
<p class="notep1">See Also:</p>
<p>Online Help for Oracle Enterprise Manager Cloud Control</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL397"></a>
<div class="props_rev_3"><a id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C"></a>
<h3 id="TGSQL-GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C" class="sect3">Configuring Automatic Optimizer Statistics Collection from the Command Line</h3>
<div>
<p>If you do not use Cloud Control to configure automatic optimizer statistics collection, then you must use the command line.</p>
<div class="section">
<p>You have the following options:</p>
<ul style="list-style-type: disc;">
<li>
<p>Run the <code class="codeph">ENABLE</code> or <code class="codeph">DISABLE</code> procedure in the <code class="codeph">DBMS_AUTO_TASK_ADMIN</code> PL/SQL package.</p>
<p>This package is the recommended command-line technique. For both the <code class="codeph">ENABLE</code> and <code class="codeph">DISABLE</code> procedures, you can specify a particular maintenance window with the <code class="codeph">window_name</code> parameter.</p>
</li>
<li>
<p>Set the <code class="codeph">STATISTICS_LEVEL</code> initialization level to <code class="codeph">BASIC</code> to disable collection of <span class="italic">all</span> advisories and statistics, including Automatic SQL Tuning Advisor.</p>
<div class="infobox-note" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-65EEDF7F-64AC-4C22-9AD7-D4E61E8A5A68">
<p class="notep1">Note:</p>
<p>Because monitoring and many automatic features are disabled, Oracle strongly recommends that you do not set <code class="codeph">STATISTICS_LEVEL</code> to <code class="codeph">BASIC</code>.</p>
</div>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To control automatic statistics collection using DBMS_AUTO_TASK_ADMIN:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with administrator privileges, and then do one of the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>To enable the automated task, execute the following PL/SQL block:</p>
<pre dir="ltr">BEGIN
  DBMS_AUTO_TASK_ADMIN.ENABLE (  
    client_name  =&gt; &#39;auto optimizer stats collection&#39;
,   operation    =&gt; NULL
,   window_name  =&gt; NULL 
);
END;
/
</pre></li>
<li>
<p>To disable the automated task, execute the following PL/SQL block:</p>
<pre dir="ltr">BEGIN
  DBMS_AUTO_TASK_ADMIN.DISABLE (  
    client_name  =&gt; &#39;auto optimizer stats collection&#39;
,   operation    =&gt; NULL
,   window_name  =&gt; NULL 
);
END;
/
</pre></li>
</ul>
</li>
<li>
<p>Query the data dictionary to confirm the change.</p>
<p>For example, query <code class="codeph">DBA_AUTOTASK_CLIENT</code> as follows:</p>
<pre dir="ltr">COL CLIENT_NAME FORMAT a31

SELECT CLIENT_NAME, STATUS
FROM   DBA_AUTOTASK_CLIENT
WHERE  CLIENT_NAME = &#39;auto optimizer stats collection&#39;;
</pre>
<p>Sample output appears as follows:</p>
<pre dir="ltr">CLIENT_NAME                     STATUS
------------------------------- --------
auto optimizer stats collection ENABLED
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To change the window attributes for automatic statistics collection:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with administrator privileges.</p>
</li>
<li>
<p>Change the attributes of the maintenance window as needed.</p>
<p>For example, to change the Monday maintenance window so that it starts at 5 a.m., execute the following PL/SQL program:</p>
<pre dir="ltr">BEGIN 
  DBMS_SCHEDULER.SET_ATTRIBUTE (
    &#39;MONDAY_WINDOW&#39;
,   &#39;repeat_interval&#39;
,   &#39;freq=daily;byday=MON;byhour=05;byminute=0;bysecond=0&#39;
);
END;
/
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-E9901D00-61F9-4F20-B7B2-55E0F6063E76">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS65439" target="_blank" href="../ARPLS/d_autotaskadm.htm#ARPLS65439"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_AUTO_TASK_ADMIN</code> package</p>
</li>
<li>
<p><a class="olink REFRN10214" target="_blank" href="../REFRN/GUID-16B23F95-8644-407A-A6C8-E85CADFA61FF.htm#REFRN10214"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">STATISTICS_LEVEL</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL398"></a>
<div class="props_rev_3"><a id="GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682"></a>
<h2 id="TGSQL-GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" class="sect2">Setting Optimizer Statistics Preferences</h2>
<div>
<p>This topic explains how to set optimizer statistics defaults using <code class="codeph">DBMS_STATS.SET_*_PREFS</code> procedures.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_stats.htm#GUID-E798E1F6-FC85-456E-8F38-99534BE74492" title="The optimizer statistics preferences set the default values of the parameters used by automatic statistics collection and the DBMS_STATS statistics gathering procedures.">About Optimizer Statistics Preferences</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-777704A7-3751-4720-957E-6C916FD36917" title="A global preference applies to any object in the database that does not have an existing table preference. You can set optimizer statistics preferences at the global level using Cloud Control.">Setting Global Optimizer Statistics Preferences Using Cloud Control</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C" title="You can set optimizer statistics preferences at the database, schema, and table level using Cloud Control.">Setting Object-Level Optimizer Statistics Preferences Using Cloud Control</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34">Setting Optimizer Statistics Preferences from the Command Line</a></p>
</li>
</ul>
</div>
<a id="TGSQL399"></a>
<div class="props_rev_3"><a id="GUID-E798E1F6-FC85-456E-8F38-99534BE74492"></a>
<h3 id="TGSQL-GUID-E798E1F6-FC85-456E-8F38-99534BE74492" class="sect3">About Optimizer Statistics Preferences</h3>
<div>
<p>The <span class="bold">optimizer statistics preferences</span> set the default values of the parameters used by automatic statistics collection and the <code class="codeph">DBMS_STATS</code> statistics gathering procedures.</p>
<p>You can set optimizer statistics preferences at the table, schema, database (all tables), and global level. A global preference refers to tables with no preferences and any tables created in the future. The procedure names follow the form <code class="codeph">SET_*_PREFS</code>.</p>
</div>
<a id="TGSQL401"></a><a id="TGSQL95042"></a>
<div class="props_rev_3"><a id="GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545"></a>
<h4 id="TGSQL-GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545" class="sect4">DBMS_STATS Procedures for Setting Statistics Preferences</h4>
<div>
<p>The <code class="codeph">DBMS_STATS.SET_*_PREFS</code> procedures change the defaults of parameters used by the <code class="codeph">DBMS_STATS.GATHER_*_STATS</code> procedures. To query the current preferences, use the <code class="codeph">DBMS_STATS.GET_PREFS</code> function.</p>
<div class="section">
<p>When setting statistics preferences, the order of precedence is:</p>
<ol>
<li>
<p>Table preference (set for a specific table, all tables in a schema, or all tables in the database)</p>
</li>
<li>
<p>Global preference</p>
</li>
<li>
<p>Default preference</p>
</li>
</ol>
<p>The following table summarizes the relevant <code class="codeph">DBMS_STATS</code> procedures.</p>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545__CHDDJJJI">
<p class="titleintable">Table 12-1 DBMS_STATS Procedures for Setting Optimizer Statistics Preferences</p>
<table class="cellalignment4808" title="DBMS_STATS Procedures for Setting Optimizer Statistics Preferences" summary="This 2 column table shows DBMS_STATS Procedures for Setting Optimizer Statistics Preferences. Column 1 is the procedure. Column 2 is the scope.">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4843" id="d74553e1806">Procedure</th>
<th class="cellalignment4868" id="d74553e1809">Scope</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4845" id="d74553e1814" headers="d74553e1806">
<p><code class="codeph">SET_TABLE_PREFS</code></p>
</td>
<td class="cellalignment4869" headers="d74553e1814 d74553e1809">
<p>Specified table only.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4845" id="d74553e1822" headers="d74553e1806">
<p><code class="codeph">SET_SCHEMA_PREFS</code></p>
</td>
<td class="cellalignment4869" headers="d74553e1822 d74553e1809">
<p>All existing tables in the specified schema.</p>
<p>This procedure calls <code class="codeph">SET_TABLE_PREFS</code> for each table in the specified schema. Calling <code class="codeph">SET_SCHEMA_PREFS</code> does not affect any new tables created after it has been run. New tables use the <code class="codeph">GLOBAL_PREF</code> values for all parameters.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4845" id="d74553e1841" headers="d74553e1806">
<p><code class="codeph">SET_DATABASE_PREFS</code></p>
</td>
<td class="cellalignment4869" headers="d74553e1841 d74553e1809">
<p>All user-defined schemas in the database. You can include system-owned schemas such as <code class="codeph">SYS</code> and <code class="codeph">SYSTEM</code> by setting the <code class="codeph">ADD_SYS</code> parameter to <code class="codeph">true</code>.</p>
<p>This procedure calls <code class="codeph">SET_TABLE_PREFS</code> for each table in the specified schema. Calling <code class="codeph">SET_DATABASE_PREFS</code> does not affect any new objects created after it has been run. New objects use the <code class="codeph">GLOBAL_PREF</code> values for all parameters.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4845" id="d74553e1872" headers="d74553e1806">
<p><code class="codeph">SET_GLOBAL_PREFS</code></p>
</td>
<td class="cellalignment4869" headers="d74553e1872 d74553e1809">
<p>Any table that does not have an existing table preference.</p>
<p>All parameters default to the global setting unless a table preference is set or the parameter is explicitly set in the <code class="codeph">DBMS_STATS.GATHER_*_STATS</code> statement. Changes made by <code class="codeph">SET_GLOBAL_PREFS</code> affect any new objects created after it runs. New objects use the <code class="codeph">SET_GLOBAL_PREFS</code> values for all parameters.</p>
<p>With <code class="codeph">SET_GLOBAL_PREFS</code>, you can set a default value for the parameter <code class="codeph">AUTOSTATS_TARGET</code>. This additional parameter controls which objects the automatic statistic gathering job running in the nightly maintenance window affects. Possible values for <code class="codeph">AUTOSTATS_TARGET</code> are <code class="codeph">ALL</code>, <code class="codeph">ORACLE</code>, and <code class="codeph">AUTO</code> (default).</p>
<p>You can only set the <code class="codeph">CONCURRENT</code> preference at the global level. You cannot set the preference <code class="codeph">INCREMENTAL_LEVEL</code> using <code class="codeph">SET_GLOBAL_PREFS</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545__GUID-648043E0-995E-45B8-A969-819467836F11">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_stats.htm#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="By default, each partition of a partition table is gathered sequentially.">About Concurrent Statistics Gathering</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ARPLS68491" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68491"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> procedures for setting optimizer statistics</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL95044"></a><a id="TGSQL95043"></a>
<div class="props_rev_3"><a id="GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C"></a>
<h4 id="TGSQL-GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C" class="sect4">Setting Statistics Preferences: Example</h4>
<div>
<p>This example illustrates the relationship between <code class="codeph">SET_TABLE_PREFS</code>, <code class="codeph">SET_SCHEMA_STATS</code>, and <code class="codeph">SET_DATABASE_PREFS</code>.</p>
<div class="section">
<div class="tblformalwide" id="GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C__CHDFCJBE">
<p class="titleintable">Table 12-2 Changing Preferences for Statistics Gathering Procedures</p>
<table class="cellalignment4813" title="Changing Preferences for Statistics Gathering Procedures" summary="Changing preferences for statistics">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4866" id="d74553e2045">Action</th>
<th class="cellalignment4866" id="d74553e2048">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4867" id="d74553e2053" headers="d74553e2045">
<pre dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS 
(&#39;incremental&#39;, &#39;sh&#39;,&#39;costs&#39;) 
AS &#34;STAT_PREFS&#34; FROM DUAL;
 
STAT_PREFS
----------
TRUE
</pre></td>
<td class="cellalignment4867" headers="d74553e2053 d74553e2048">
<p>You query the <code class="codeph">INCREMENTAL</code> preference for <code class="codeph">costs</code> and determine that it is set to <code class="codeph">true</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4867" id="d74553e2069" headers="d74553e2045">
<pre dir="ltr">SQL&gt; EXEC DBMS_STATS.SET_TABLE_PREFS 
(&#39;sh&#39;, &#39;costs&#39;, &#39;incremental&#39;, &#39;false&#39;);
 
PL/SQL procedure successfully completed.
</pre></td>
<td class="cellalignment4867" headers="d74553e2069 d74553e2048">
<p>You use <code class="codeph">SET_TABLE_PREFS</code> to set the <code class="codeph">INCREMENTAL</code> preference to <code class="codeph">false</code> for the <code class="codeph">costs</code> table only.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4867" id="d74553e2088" headers="d74553e2045">
<pre dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS 
(&#39;incremental&#39;, &#39;sh&#39;, &#39;costs&#39;) 
AS &#34;STAT_PREFS&#34; FROM DUAL;

STAT_PREFS 
----------
FALSE
</pre></td>
<td class="cellalignment4867" headers="d74553e2088 d74553e2048">
<p>You query the <code class="codeph">INCREMENTAL</code> preference for <code class="codeph">costs</code> and confirm that it is set to <code class="codeph">false</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4867" id="d74553e2104" headers="d74553e2045">
<pre dir="ltr">SQL&gt; EXEC DBMS_STATS.SET_SCHEMA_PREFS 
(&#39;sh&#39;, &#39;incremental&#39;, &#39;true&#39;);

PL/SQL procedure successfully completed.
</pre></td>
<td class="cellalignment4867" headers="d74553e2104 d74553e2048">
<p>You use <code class="codeph">SET_SCHEMA_PREFS</code> to set the <code class="codeph">INCREMENTAL</code> preference to <code class="codeph">true</code> for every table in the <code class="codeph">sh</code> schema, including <code class="codeph">costs</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4867" id="d74553e2126" headers="d74553e2045">
<pre dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS 
(&#39;incremental&#39;, &#39;sh&#39;, &#39;costs&#39;) 
AS &#34;STAT_PREFS&#34; FROM DUAL;
 
STAT_PREFS
----------
TRUE
</pre></td>
<td class="cellalignment4867" headers="d74553e2126 d74553e2048">
<p>You query the <code class="codeph">INCREMENTAL</code> preference for <code class="codeph">costs</code> and confirm that it is set to <code class="codeph">true</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4867" id="d74553e2142" headers="d74553e2045">
<pre dir="ltr">SQL&gt; EXEC DBMS_STATS.SET_DATABASE_PREFS 
(&#39;incremental&#39;, &#39;false&#39;);

PL/SQL procedure successfully completed.
</pre></td>
<td class="cellalignment4867" headers="d74553e2142 d74553e2048">
<p>You use <code class="codeph">SET_DATABASE_PREFS</code> to set the <code class="codeph">INCREMENTAL</code> preference for all tables in all user-defined schemas to <code class="codeph">false</code>.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4867" id="d74553e2158" headers="d74553e2045">
<pre dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS 
(&#39;incremental&#39;, &#39;sh&#39;, &#39;costs&#39;) 
AS &#34;STAT_PREFS&#34; FROM DUAL;

STAT_PREFS
----------
FALSE
</pre></td>
<td class="cellalignment4867" headers="d74553e2158 d74553e2048">
<p>You query the <code class="codeph">INCREMENTAL</code> preference for <code class="codeph">costs</code> and confirm that it is set to <code class="codeph">false</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL402"></a>
<div class="props_rev_3"><a id="GUID-777704A7-3751-4720-957E-6C916FD36917"></a>
<h3 id="TGSQL-GUID-777704A7-3751-4720-957E-6C916FD36917" class="sect3">Setting Global Optimizer Statistics Preferences Using Cloud Control</h3>
<div>
<p>A global preference applies to any object in the database that does <span class="italic">not</span> have an existing table preference. You can set optimizer statistics preferences at the global level using Cloud Control.</p>
<div class="section">
<p class="subhead3">To set global optimizer statistics preferences using Cloud Control:</p>
<ol>
<li>
<p>Go to the Optimizer Statistics Console page, as explained in <span class="q">&#34;<a href="tgsql_stats.htm#GUID-360B47CD-4CE0-4336-8637-FD90A16F2830" title="You can perform most necessary tasks relating to optimizer statistics through pages linked to by the Optimizer Statistics Console page.">Accessing the Optimizer Statistics Console</a>&#34;</span>.</p>
</li>
<li>
<p>Click <span class="bold">Global Statistics Gathering Options</span>.</p>
<p>The Global Statistics Gathering Options page appears.</p>
</li>
<li>
<p>Make your desired changes, and click <span class="bold">Apply</span>.</p>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-777704A7-3751-4720-957E-6C916FD36917__GUID-D68AC8C4-FE4D-4616-B4AE-E040037F76BC">
<p class="notep1">See Also:</p>
<p>Online Help for Oracle Enterprise Manager Cloud Control</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL403"></a>
<div class="props_rev_3"><a id="GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C"></a>
<h3 id="TGSQL-GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C" class="sect3">Setting Object-Level Optimizer Statistics Preferences Using Cloud Control</h3>
<div>
<p>You can set optimizer statistics preferences at the database, schema, and table level using Cloud Control.</p>
<div class="section">
<p class="subhead3">To set object-level optimizer statistics preferences using Cloud Control:</p>
<ol>
<li>
<p>Go to the Optimizer Statistics Console, as explained in <span class="q">&#34;<a href="tgsql_stats.htm#GUID-360B47CD-4CE0-4336-8637-FD90A16F2830" title="You can perform most necessary tasks relating to optimizer statistics through pages linked to by the Optimizer Statistics Console page.">Accessing the Optimizer Statistics Console</a>&#34;</span>.</p>
</li>
<li>
<p>Click <span class="bold">Object Level Statistics Gathering Preferences</span>.</p>
<p>The Object Level Statistics Gathering Preferences page appears.</p>
</li>
<li>
<p>To modify table preferences for a table that has preferences set at the table level, do the following (otherwise, skip to the next step):</p>
<ol>
<li>
<p>Enter values in <span class="bold">Schema</span> and <span class="bold">Table Name</span>. Leave <span class="bold">Table Name</span> blank to see all tables in the schema.</p>
<p>The page refreshes with the table names.</p>
</li>
<li>
<p>Select the desired tables and click <span class="bold">Edit Preferences</span>.</p>
<p>The General subpage of the Edit Preferences page appears.</p>
</li>
<li>
<p>Change preferences as needed and click <span class="bold">Apply</span>.</p>
</li>
</ol>
</li>
<li>
<p>To set preferences for a table that does <span class="italic">not</span> have preferences set at the table level, do the following (otherwise, skip to the next step):</p>
<ol>
<li>
<p>Click <span class="bold">Add Table Preferences</span>.</p>
<p>The General subpage of the Add Table Preferences page appears.</p>
</li>
<li>
<p>In <span class="bold">Table Name</span>, enter the schema and table name.</p>
</li>
<li>
<p>Change preferences as needed and click <span class="bold">OK</span>.</p>
</li>
</ol>
</li>
<li>
<p>To set preferences for a schema, do the following:</p>
<ol>
<li>
<p>Click <span class="bold">Set Schema Tables Preferences</span>.</p>
<p>The General subpage of the Edit Schema Preferences page appears.</p>
</li>
<li>
<p>In <span class="bold">Schema</span>, enter the schema name.</p>
</li>
<li>
<p>Change preferences as needed and click <span class="bold">OK</span>.</p>
</li>
</ol>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C__GUID-958A1E85-1B05-4B32-BCEC-C39ABE33884A">
<p class="notep1">See Also:</p>
<p>Online Help for Oracle Enterprise Manager Cloud Control</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL405"></a><a id="TGSQL404"></a>
<div class="props_rev_3"><a id="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34"></a>
<h3 id="TGSQL-GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34" class="sect3">Setting Optimizer Statistics Preferences from the Command Line</h3>
<div>
<div class="section">
<p>If you do not use Cloud Control to set optimizer statistics preferences, then you can invoke the <code class="codeph">DBMS_STATS</code> procedures described in <a href="tgsql_stats.htm#GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545__CHDDJJJI" title="This 2 column table shows DBMS_STATS Procedures for Setting Optimizer Statistics Preferences. Column 1 is the procedure. Column 2 is the scope.">Table 12-1</a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Prerequisites</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This task has the following prerequisites:</p>
<ul style="list-style-type: disc;">
<li>
<p>To set the global or database preferences, you must have <code class="codeph">SYSDBA</code> privileges, or both <code class="codeph">ANALYZE ANY DICTIONARY</code> and <code class="codeph">ANALYZE ANY</code> system privileges.</p>
</li>
<li>
<p>To set schema preferences, you must connect as owner, or have <code class="codeph">SYSDBA</code> privileges, or have the <code class="codeph">ANALYZE ANY</code> system privilege.</p>
</li>
<li>
<p>To set table preferences, you must connect as owner of the table or have the <code class="codeph">ANALYZE ANY</code> system privilege.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To set optimizer statistics preferences from the command line:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the necessary privileges.</p>
</li>
<li>
<p>Optionally, call the <code class="codeph">DBMS_STATS.GET_PREFS</code> procedure to see preferences set at the object level, or at the global level if a specific table is not set.</p>
<p>For example, obtain the <code class="codeph">STALE_PERCENT</code> parameter setting for the <code class="codeph">sh.sales</code> table as follows:</p>
<pre dir="ltr">SELECT DBMS_STATS.GET_PREFS(&#39;STALE_PERCENT&#39;, &#39;SH&#39;, &#39;SALES&#39;) 
FROM   DUAL;
</pre></li>
<li>
<p>Execute the appropriate procedure from <a href="tgsql_stats.htm#GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545__CHDDJJJI" title="This 2 column table shows DBMS_STATS Procedures for Setting Optimizer Statistics Preferences. Column 1 is the procedure. Column 2 is the scope.">Table 12-1</a>, specifying the following parameters:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">ownname</code> - Set schema name (<code class="codeph">SET_TAB_PREFS</code> and <code class="codeph">SET_SCHEMA_PREFS</code> only)</p>
</li>
<li>
<p><code class="codeph">tabname</code> - Set table name (<code class="codeph">SET_TAB_PREFS</code> only)</p>
</li>
<li>
<p><code class="codeph">pname</code> - Set parameter name</p>
</li>
<li>
<p><code class="codeph">pvalue</code> - Set parameter value</p>
</li>
<li>
<p><code class="codeph">add_sys</code> - Include system tables (optional, <code class="codeph">SET_DATABASE_PREFS</code> only)</p>
</li>
</ul>
<p>The following example specifies that 13% of rows in <code class="codeph">sh.sales</code> must change before the statistics on that table are considered stale:</p>
<pre dir="ltr">EXEC DBMS_STATS.SET_TABLE_PREFS(&#39;SH&#39;, &#39;SALES&#39;, &#39;STALE_PERCENT&#39;, &#39;13&#39;);
</pre></li>
<li>
<p>Optionally, query the <code class="codeph">*_TAB_STAT_PREFS</code> view to confirm the change.</p>
<p>For example, query <code class="codeph">DBA_TAB_STAT_PREFS</code> as follows:</p>
<pre dir="ltr">COL OWNER FORMAT a5
COL TABLE_NAME FORMAT a15
COL PREFERENCE_NAME FORMAT a20
COL PREFERENCE_VALUE FORMAT a30
SELECT * FROM DBA_TAB_STAT_PREFS;
</pre>
<p>Sample output appears as follows:</p>
<pre dir="ltr">OWNER TABLE_NAME      PREFERENCE_NAME      PREFERENCE_VALUE
----- --------------- -------------------- ------------------------------
OE    CUSTOMERS       NO_INVALIDATE        DBMS_STATS.AUTO_INVALIDATE
SH    SALES           STALE_PERCENT        13
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34__GUID-B3EB8E62-89A5-4CB7-AC14-DF0BAA1EC25F">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68494" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68494"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for descriptions of the parameter names and values for program units</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL406"></a>
<div class="props_rev_3"><a id="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B"></a>
<h2 id="TGSQL-GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" class="sect2">Gathering Optimizer Statistics Manually</h2>
<div>
<p>As an alternative or supplement to automatic statistics gathering, you can use the <code class="codeph">DBMS_STATS</code> package to gather statistics manually.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_stats.htm#GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001" title="Use the DBMS_STATS package to manipulate optimizer statistics. You can gather statistics on objects and columns at various levels of granularity: object, schema, and database. You can also gather statistics for the physical system.">About Manual Statistics Collection with DBMS_STATS</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.">Guidelines for Gathering Optimizer Statistics Manually</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-33C8239F-53A9-4FCB-969B-4772041317AA" title="Stale statistics on a table do not accurately reflect its data. The database provides a table monitoring facility to help determine when a database object needs new statistics.">Determining When Optimizer Statistics Are Stale</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D">Gathering Schema and Table Statistics</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212">Gathering Statistics for Fixed Objects</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" title="Statistics for volatile tables, which are tables modified significantly during the day, go stale quickly. For example, a table may be deleted or truncated, and then rebuilt.">Gathering Statistics for Volatile Tables Using Dynamic Statistics</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" title="Oracle Database enables you to gather statistics on multiple tables or partitions concurrently.">Gathering Optimizer Statistics Concurrently</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, Incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B__GUID-FAAC7E0D-F492-4210-8041-A1BE10562508">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_stats.htm#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="This topic explains how to configure Oracle Database to gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ARPLS059" target="_blank" href="../ARPLS/d_stats.htm#ARPLS059"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> package</p>
</li>
</ul>
</div>
</div>
<a id="TGSQL94918"></a><a id="TGSQL407"></a>
<div class="props_rev_3"><a id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001"></a>
<h3 id="TGSQL-GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001" class="sect3">About Manual Statistics Collection with DBMS_STATS</h3>
<div>
<p>Use the <code class="codeph">DBMS_STATS</code> package to manipulate optimizer statistics. You can gather statistics on objects and columns at various levels of granularity: object, schema, and database. You can also gather statistics for the physical system.</p>
<p>The following table summarizes the <code class="codeph">DBMS_STATS</code> procedures for gathering optimizer statistics. This package does not gather statistics for table clusters. However, you can gather statistics on individual tables in a <a href="glossary.htm#GUID-631F5681-B73D-4551-A4B2-C69282695030"><span class="xrefglossterm">table cluster</span></a>.</p>
<div class="tblformal" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__CHDCEEJH">
<p class="titleintable">Table 12-3 DBMS_STATS Procedures for Gathering Optimizer Statistics</p>
<table class="cellalignment4808" title="DBMS_STATS Procedures for Gathering Optimizer Statistics" summary="This 2 column table lists the DBMS_STATS Procedures for Setting Preferences. Column 1 is the procedure. Column 2 is the purpose of the procedure.">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4810" id="d74553e2968">Procedure</th>
<th class="cellalignment4837" id="d74553e2971">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d74553e2976" headers="d74553e2968">
<p><code class="codeph">GATHER_INDEX_STATS</code></p>
</td>
<td class="cellalignment4838" headers="d74553e2976 d74553e2971">
<p>Collects index statistics</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d74553e2984" headers="d74553e2968">
<p><code class="codeph">GATHER_TABLE_STATS</code></p>
</td>
<td class="cellalignment4838" headers="d74553e2984 d74553e2971">
<p>Collects table, column, and index statistics</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d74553e2992" headers="d74553e2968">
<p><code class="codeph">GATHER_SCHEMA_STATS</code></p>
</td>
<td class="cellalignment4838" headers="d74553e2992 d74553e2971">
<p>Collects statistics for all objects in a schema</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d74553e3000" headers="d74553e2968">
<p><code class="codeph">GATHER_DICTIONARY_STATS</code></p>
</td>
<td class="cellalignment4838" headers="d74553e3000 d74553e2971">
<p>Collects statistics for all system schemas, including <code class="codeph">SYS</code> and <code class="codeph">SYSTEM</code>, and other optional schemas, such as <code class="codeph">CTXSYS</code> and <code class="codeph">DRSYS</code></p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4812" id="d74553e3019" headers="d74553e2968">
<p><code class="codeph">GATHER_DATABASE_STATS</code></p>
</td>
<td class="cellalignment4838" headers="d74553e3019 d74553e2971">
<p>Collects statistics for all objects in a database</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>When the <code class="codeph">OPTIONS</code> parameter is set to <code class="codeph">GATHER STALE</code> or <code class="codeph">GATHER AUTO</code>, the <code class="codeph">GATHER_SCHEMA_STATS</code> and <code class="codeph">GATHER_DATABASE_STATS</code> procedures gather statistics for any table that has stale statistics and any table that is missing statistics. If a monitored table has been modified more than 10%, then the database considers these statistics stale and gathers them again.</p>
<div class="infobox-note" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__GUID-8CFAD02D-3599-4CF2-9AB9-774F5CAAA3AC">
<p class="notep1">Note:</p>
<p>As explained in <span class="q">&#34;<a href="tgsql_stats.htm#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="This topic explains how to configure Oracle Database to gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a>&#34;</span>, you can configure a nightly job to gather statistics automatically.</p>
</div>
<div class="infoboxnotealso" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__GUID-BF19598F-E808-42C1-9C94-CEF1508BE5D2">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_stats.htm#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="Workload statistics analyze activity in a specified time period.This tutorial explains how to set the workload interval with the INTERVAL parameter of GATHER_SYSTEM_STATS.">Gathering System Statistics Manually</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ARPLS059" target="_blank" href="../ARPLS/d_stats.htm#ARPLS059"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about the <code class="codeph">DBMS_STATS</code> package</p>
</li>
</ul>
</div>
</div>
</div>
<a id="TGSQL415"></a>
<div class="props_rev_3"><a id="GUID-A3E66485-F827-494E-99D7-6E4558E9CC21"></a>
<h3 id="TGSQL-GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" class="sect3">Guidelines for Gathering Optimizer Statistics Manually</h3>
<div>
<p>In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.</p>
<p>Automatic collection may sometimes be inadequate or unavailable, as in the following cases:</p>
<ul style="list-style-type: disc;">
<li>
<p>You perform certain types of <a href="glossary.htm#GUID-FC504237-77A1-49E6-8BA2-4475A1C76553"><span class="xrefglossterm">bulk load</span></a> and cannot wait for the maintenance window to collect statistics because queries must be executed immediately. See <span class="q">&#34;<a href="tgsql_statscon.htm#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="Starting in Oracle Database 12c, the database can gather table statistics automatically during the following types of bulk loads: INSERT INTO ... SELECT into an empty table using a direct path insert, and CREATE TABLE AS SELECT .">Online Statistics Gathering for Bulk Loads</a>&#34;</span>.</p>
</li>
<li>
<p>During a nonrepresentative workload, automatic statistics collection gathers statistics for fixed tables. See <span class="q">&#34;<a href="tgsql_stats.htm#GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212">Gathering Statistics for Fixed Objects</a>&#34;</span>.</p>
</li>
<li>
<p>Automatic statistics collection does not gather system statistics. See <span class="q">&#34;<a href="tgsql_stats.htm#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="Workload statistics analyze activity in a specified time period.This tutorial explains how to set the workload interval with the INTERVAL parameter of GATHER_SYSTEM_STATS.">Gathering System Statistics Manually</a>&#34;</span>.</p>
</li>
<li>
<p>Volatile tables are being deleted or truncated, and then rebuilt during the day. See <span class="q">&#34;<a href="tgsql_stats.htm#GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" title="Statistics for volatile tables, which are tables modified significantly during the day, go stale quickly. For example, a table may be deleted or truncated, and then rebuilt.">Gathering Statistics for Volatile Tables Using Dynamic Statistics</a>&#34;</span>.</p>
</li>
</ul>
<p>This section offers guidelines for typical situations in which you may choose to gather statistically manually:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_stats.htm#GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" title="In the context of optimizer statistics, sampling is the gathering of statistics from a random subset of table rows. By enabling the database to avoid full table scans and sorts of entire tables, sampling minimizes the resources necessary to gather statistics.">Guideline for Setting the Sample Size</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33" title="By default, the database gathers statistics with the parallelism degree specified at the table or index level. You can override this setting with the degree argument to the DBMS_STATS gathering procedures.">Guideline for Gathering Statistics in Parallel</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-5EB2976E-26EF-47A7-8568-7695CA853079">Guideline for Partitioned Objects</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-6236E795-8A03-444B-92EA-52CD76EA332E">Guideline for Frequently Changing Objects</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-47136764-F468-43ED-9FF7-053C90D338B8" title="Because the database does not permit data manipulation against external tables, the database never marks statistics on external tables as stale. If new statistics are required for an external table, for example, because the underlying data files change, then regather the statistics.">Guideline for External Tables</a></p>
</li>
</ul>
</div>
<a id="TGSQL409"></a>
<div class="props_rev_3"><a id="GUID-88E321BF-445E-40BD-83A2-9EA107689B2F"></a>
<h4 id="TGSQL-GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" class="sect4">Guideline for Setting the Sample Size</h4>
<div>
<p>In the context of optimizer statistics, <span class="bold">sampling</span> is the gathering of statistics from a random subset of table rows. By enabling the database to avoid full table scans and sorts of entire tables, sampling minimizes the resources necessary to gather statistics.</p>
<div class="section">
<p>The database gathers the most accurate statistics when it processes all rows in the table, which is a 100% sample. However, larger sample sizes increase the time of statistics gathering operations. The challenge is determining a sample size that provides accurate statistics in a reasonable time.</p>
<p><code class="codeph">DBMS_STATS</code> uses sampling when a user specifies the parameter <code class="codeph">ESTIMATE_PERCENT</code>, which controls the percentage of the rows in the table to sample. To maximize performance gains while achieving necessary statistical accuracy, Oracle recommends that the <code class="codeph">ESTIMATE_PERCENT</code> parameter use the default setting of <code class="codeph">DBMS_STATS.AUTO_SAMPLE_SIZE</code>. In this case, Oracle Database chooses the sample size automatically. This setting enables the use of the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>A hash-based algorithm that is much faster than sampling</p>
<p>This algorithm reads all rows and produces statistics that are nearly as accurate as statistics from a 100% sample. The statistics computed using this technique are deterministic.</p>
</li>
<li>
<p>Incremental statistics</p>
</li>
<li>
<p>Concurrent statistics</p>
</li>
<li>
<p>New histogram types (see <span class="q">&#34;<a href="tgsql_histo.htm#GUID-59C57EDF-E763-436A-9CB2-B59A536A10F7" title="A hybrid histogram combines characteristics of both height-based histograms and frequency histograms. This &#34;best of both worlds&#34; approach enables the optimizer to obtain better selectivity estimates in some situations.">Hybrid Histograms</a>&#34;</span>)</p>
</li>
</ul>
<p>The <code class="codeph">DBA_TABLES.SAMPLE_SIZE</code> column indicates the actual sample size used to gather statistics.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL410"></a>
<div class="props_rev_3"><a id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33"></a>
<h4 id="TGSQL-GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33" class="sect4">Guideline for Gathering Statistics in Parallel</h4>
<div>
<p>By default, the database gathers statistics with the parallelism degree specified at the table or index level. You can override this setting with the <code class="codeph">degree</code> argument to the <code class="codeph">DBMS_STATS</code> gathering procedures.</p>
<div class="section">
<p>Oracle recommends setting <code class="codeph">degree</code> to <code class="codeph">DBMS_STATS.AUTO_DEGREE</code>. This setting enables the database to choose an appropriate degree of parallelism based on the object size and the settings for the parallelism-related initialization parameters.</p>
<p>The database can gather most statistics serially or in parallel. However, the database does not gather some index statistics in parallel, including cluster indexes, domain indexes, and bitmap join indexes. The database can use sampling when gathering parallel statistics.</p>
<div class="infobox-note" id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33__GUID-C21C5D1A-536B-4B0C-9F6B-53B2979F42F3">
<p class="notep1">Note:</p>
<p>Do not confuse gathering statistics in parallel with gathering statistics concurrently. See <span class="q">&#34;<a href="tgsql_stats.htm#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="By default, each partition of a partition table is gathered sequentially.">About Concurrent Statistics Gathering</a>&#34;</span>.</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL411"></a>
<div class="props_rev_3"><a id="GUID-5EB2976E-26EF-47A7-8568-7695CA853079"></a>
<h4 id="TGSQL-GUID-5EB2976E-26EF-47A7-8568-7695CA853079" class="sect4">Guideline for Partitioned Objects</h4>
<div>
<div class="section">
<p>For partitioned tables and indexes, <code class="codeph">DBMS_STATS</code> can gather separate statistics for each partition and global statistics for the entire table or index. Similarly, for composite partitioning, <code class="codeph">DBMS_STATS</code> can gather separate statistics for subpartitions, partitions, and the entire table or index.</p>
<p>Use the <code class="codeph">granularity</code> argument to the <code class="codeph">DBMS_STATS</code> procedures to determine the type of partitioning statistics to be gathered. Oracle recommends setting <code class="codeph">granularity</code> to the default value of <code class="codeph">AUTO</code> to gather subpartition, partition, or global statistics, depending on partition type. The <code class="codeph">ALL</code> setting gathers statistics for all types.</p>
<div class="infoboxnotealso" id="GUID-5EB2976E-26EF-47A7-8568-7695CA853079__GUID-91B43C9E-43CD-4FBB-BF5D-0EDEA7C86C89">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="tgsql_stats.htm#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, Incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL416"></a>
<div class="props_rev_3"><a id="GUID-6236E795-8A03-444B-92EA-52CD76EA332E"></a>
<h4 id="TGSQL-GUID-6236E795-8A03-444B-92EA-52CD76EA332E" class="sect4">Guideline for Frequently Changing Objects</h4>
<div>
<div class="section">
<p>When tables are frequently modified, gather statistics often enough so that they do not go stale, but not so often that collection overhead degrades performance. You may only need to gather new statistics every week or month. The best practice is to use a script or job scheduler to regularly run the <code class="codeph">DBMS_STATS.GATHER_SCHEMA_STATS</code> and <code class="codeph">DBMS_STATS.GATHER_DATABASE_STATS</code> procedures.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL95045"></a>
<div class="props_rev_3"><a id="GUID-47136764-F468-43ED-9FF7-053C90D338B8"></a>
<h4 id="TGSQL-GUID-47136764-F468-43ED-9FF7-053C90D338B8" class="sect4">Guideline for External Tables</h4>
<div>
<p>Because the database does not permit data manipulation against external tables, the database never marks statistics on external tables as stale. If new statistics are required for an external table, for example, because the underlying data files change, then regather the statistics.</p>
<div class="section">
<p>Gather statistics manually for external tables with the same procedures that you use for regular tables.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL425"></a><a id="TGSQL424"></a>
<div class="props_rev_3"><a id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA"></a>
<h3 id="TGSQL-GUID-33C8239F-53A9-4FCB-969B-4772041317AA" class="sect3">Determining When Optimizer Statistics Are Stale</h3>
<div>
<p>Stale statistics on a table do not accurately reflect its data. The database provides a table monitoring facility to help determine when a database object needs new statistics.</p>
<div class="section">
<p>Monitoring tracks the approximate number of DML operations on a table and whether the table has been truncated since the most recent statistics collection. Run <code class="codeph">DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO</code> to immediately reflect the outstanding monitored information stored in memory. After running this procedure, check whether statistics are stale by querying the <code class="codeph">STALE_STATS</code> column in <code class="codeph">DBA_TAB_STATISTICS</code> and <code class="codeph">DBA_IND_STATISTICS</code>. This column is based on data in the <code class="codeph">DBA_TAB_MODIFICATIONS</code> view and the <code class="codeph">STALE_PERCENT</code> preference for <code class="codeph">DBMS_STATS</code>.</p>
<p>The <code class="codeph">STALE_STATS</code> column has the following possible values:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">YES</code></p>
<p>The statistics are stale.</p>
</li>
<li>
<p><code class="codeph">NO</code></p>
<p>The statistics are not stale.</p>
</li>
<li>
<p>null</p>
<p>The statistics are not collected.</p>
</li>
</ul>
<p>Executing <code class="codeph">GATHER_SCHEMA_STATS</code> or <code class="codeph">GATHER_DATABASE_STATS</code> with the <code class="codeph">GATHER AUTO</code> option collects statistics only for objects with no statistics or stale statistics.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Table monitoring is enabled for <code class="codeph">sh.sales</code>. It is enabled by default when the <code class="codeph">STATISTICS_LEVEL</code> initialization parameter is set to <code class="codeph">TYPICAL</code> or <code class="codeph">ALL</code>.</p>
</li>
<li>
<p>You have the <code class="codeph">ANALYZE_ANY</code> system privilege so you can run the <code class="codeph">DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO</code> procedure.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To determine stale statistics:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the necessary privileges.</p>
</li>
<li>
<p>Optionally, write the database monitoring information from memory to disk.</p>
<p>For example, execute the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO;
END;
/
</pre></li>
<li>
<p>Query the data dictionary for stale statistics.</p>
<p>The following example queries stale statistics for the <code class="codeph">sh.sales</code> table (partial output included):</p>
<pre dir="ltr">COL PARTITION_NAME FORMAT a15

SELECT PARTITION_NAME, STALE_STATS
FROM   DBA_TAB_STATISTICS
WHERE  TABLE_NAME = &#39;SALES&#39;
AND    OWNER = &#39;SH&#39;
ORDER BY PARTITION_NAME;
 
PARTITION_NAME  STA
--------------- ---
SALES_1995      NO
SALES_1996      NO
SALES_H1_1997   NO
SALES_H2_1997   NO
SALES_Q1_1998   NO
SALES_Q1_1999   NO
.
.
.
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA__GUID-53B21D5F-CA63-49DB-AE6C-DEFA96EA1CCC">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN23280" target="_blank" href="../REFRN/GUID-05CB1867-44F3-41AB-9D5D-CA43798593FD.htm#REFRN23280"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DBA_TAB_MODIFICATIONS</code> view</p>
</li>
<li>
<p><a class="olink ARPLS68568" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68568"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO</code> procedure</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL427"></a><a id="TGSQL426"></a>
<div class="props_rev_3"><a id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D"></a>
<h3 id="TGSQL-GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" class="sect3">Gathering Schema and Table Statistics</h3>
<div>
<div class="section">
<p>Use <code class="codeph">GATHER_TABLE_STATS</code> to collect table statistics, and <code class="codeph">GATHER_SCHEMA_STATS</code> to collect statistics for all objects in a schema.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To gather schema statistics using DBMS_STATS:</p>
<ol>
<li>
<p>Start SQL*Plus, and connect to the database with the appropriate privileges for the procedure that you intend to run.</p>
</li>
<li>
<p>Run the <code class="codeph">GATHER_TABLE_STATS</code> or <code class="codeph">GATHER_SCHEMA_STATS</code> procedure, specifying the desired parameters.</p>
<p>Typical parameters include:</p>
<ul style="list-style-type: disc;">
<li>
<p>Owner - <code class="codeph">ownname</code></p>
</li>
<li>
<p>Object name - <code class="codeph">tabname</code>, <code class="codeph">indname</code>, <code class="codeph">partname</code></p>
</li>
<li>
<p>Degree of parallelism - <code class="codeph">degree</code></p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-A41357C0-966D-4D13-8F41-1874DB543A74">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68582" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68582"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">GATHER_TABLE_STATS</code> procedure</p>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-725BD3D5-B0FC-4258-8EC5-8C2299538142">
<p class="titleinexample">Example 12-1 Gathering Statistics for a Table</p>
<p>This example uses the <code class="codeph">DBMS_STATS</code> package to gather statistics on the <code class="codeph">sh.customers</code> table with a parallelism setting of <code class="codeph">2</code>.</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.GATHER_TABLE_STATS (  
    ownname =&gt; &#39;sh&#39;
,   tabname =&gt; &#39;customers&#39;
,   degree  =&gt; 2  
);
END;
/
</pre></div>
<!-- class="example" --></div>
</div>
<a id="TGSQL95111"></a><a id="TGSQL95112"></a><a id="TGSQL95110"></a>
<div class="props_rev_3"><a id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212"></a>
<h3 id="TGSQL-GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212" class="sect3">Gathering Statistics for Fixed Objects</h3>
<div>
<div class="section">
<p><a id="d74553e4228" class="indexterm-anchor"></a>Fixed objects are dynamic performance tables and their indexes. These objects record current database activity.</p>
<p>Unlike other database tables, the database does not automatically use dynamic statistics for SQL statement referencing <code class="codeph">X$</code> tables when optimizer statistics are missing. Instead, the optimizer uses predefined default values. These defaults may not be representative and could potentially lead to a suboptimal execution plan. Thus, it is important to keep fixed object statistics current.</p>
<p>Oracle Database automatically gathers fixed object statistics as part of automated statistics gathering if they have not been previously collected (see <span class="q">&#34;<a href="tgsql_stats.htm#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="This topic explains how to configure Oracle Database to gather optimizer statistics automatically.">Controlling Automatic Optimizer Statistics Collection</a>&#34;</span>). You can also manually collect statistics on fixed objects by calling <code class="codeph">DBMS_STATS.GATHER_FIXED_OBJECTS_STATS</code>. Oracle recommends that you gather statistics when the database has representative activity.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Prerequisites</p>
</div>
<!-- class="section" -->
<div class="section">
<p>You must have the <code class="codeph">SYSDBA</code> or <code class="codeph">ANALYZE ANY DICTIONARY</code> system privilege to execute this procedure.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To gather schema statistics using GATHER_FIXED_OBJECTS_STATS:</p>
<ol>
<li>
<p>Start SQL*Plus, and connect to the database with the appropriate privileges for the procedure that you intend to run.</p>
</li>
<li>
<p>Run the <code class="codeph">DBMS_STATS.GATHER_FIXED_OBJECTS_STATS</code> procedure, specifying the desired parameters.</p>
<p>Typical parameters include:</p>
<ul style="list-style-type: disc;">
<li>
<p>Table identifier describing where to save the current statistics - <code class="codeph">stattab</code></p>
</li>
<li>
<p>Identifier to associate with these statistics within <code class="codeph">stattab</code> (optional) - <code class="codeph">statid</code></p>
</li>
<li>
<p>Schema containing <code class="codeph">stattab</code> (if different from current schema) - <code class="codeph">statown</code></p>
</li>
</ul>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-09E0A125-B3DA-42E6-A899-92BCB97FC5CF">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68582" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68582"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">GATHER_TABLE_STATS</code> procedure</p>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-7ACCF448-2110-41EB-8CA6-C274DE61F8BB">
<p class="titleinexample">Example 12-2 Gathering Statistics for a Table</p>
<p>This example uses the <code class="codeph">DBMS_STATS</code> package to gather fixed object statistics.</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.GATHER_FIXED_OBJECTS_STATS;
END;
/
</pre></div>
<!-- class="example" --></div>
</div>
<a id="TGSQL94628"></a><a id="TGSQL420"></a>
<div class="props_rev_3"><a id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5"></a>
<h3 id="TGSQL-GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" class="sect3">Gathering Statistics for Volatile Tables Using Dynamic Statistics</h3>
<div>
<p>Statistics for volatile tables, which are tables modified significantly during the day, go stale quickly. For example, a table may be deleted or truncated, and then rebuilt.</p>
<div class="section">
<p>When you set the statistics of a volatile object to null, Oracle Database dynamically gathers the necessary statistics during optimization using dynamic statistics. The <code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code> initialization parameter controls this feature.</p>
<div class="infobox-note" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-5ECF66C0-CCC3-42B9-B4EF-7F8819A7230C">
<p class="notep1">Note:</p>
<p>As described in <span class="q">&#34;<a href="tgsql_astat.htm#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F">Locking and Unlocking Optimizer Statistics</a>,&#34;</span> gathering representative statistics and then locking them is an alternative technique for preventing statistics for volatile tables from going stale.</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">oe.orders</code> table is extremely volatile.</p>
</li>
<li>
<p>You want to delete and then lock the statistics on the <code class="codeph">orders</code> table to prevent the database from gathering statistics on the table. In this way, the database can dynamically gather necessary statistics as part of query optimization.</p>
</li>
<li>
<p>The <code class="codeph">oe</code> user has the necessary privileges to query <code class="codeph">DBMS_XPLAN.DISPLAY_CURSOR</code>.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To delete and the lock optimizer statistics:</p>
<ol>
<li>
<p>Connect to the database as user <code class="codeph">oe</code>, and then delete the statistics for the <code class="codeph">oe</code> table.</p>
<p>For example, execute the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.DELETE_TABLE_STATS(&#39;OE&#39;,&#39;ORDERS&#39;);
END;
/
</pre></li>
<li>
<p>Lock the statistics for the <code class="codeph">oe</code> table.</p>
<p>For example, execute the following procedure:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.LOCK_TABLE_STATS(&#39;OE&#39;,&#39;ORDERS&#39;);
END;
/
</pre></li>
<li>
<p>You query the <code class="codeph">orders</code> table.</p>
<p>For example, use the following statement:</p>
<pre dir="ltr">SELECT COUNT(order_id) FROM orders;
</pre></li>
<li>
<p>You query the plan in the cursor.</p>
<p>You run the following commands (partial output included):</p>
<pre dir="ltr">SET LINESIZE 150
SET PAGESIZE 0

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

SQL_ID  aut9632fr3358, child number 0
-------------------------------------
SELECT COUNT(order_id) FROM orders
 
Plan hash value: 425895392
 
---------------------------------------------------------------------
| Id  | Operation          | Name   | Rows  | Cost (%CPU)| Time     |
---------------------------------------------------------------------
|   0 | SELECT STATEMENT   |        |       |     2 (100)|          |
|   1 |  SORT AGGREGATE    |        |     1 |            |          |
|   2 |   TABLE ACCESS FULL| ORDERS |   105 |     2   (0)| 00:00:01 |
---------------------------------------------------------------------
 
Note
-----
   -<span class="bold"> dynamic statistics used for this statement (level=2)</span>
</pre>
<p>The Note in the preceding execution plan shows that the database used dynamic statistics for the <code class="codeph">SELECT</code> statement.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-84C8B4AA-A164-4C8C-87B4-904B358ABF92">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="tgsql_astat.htm#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="By default, when optimizer statistics are missing, stale, or insufficient, dynamic statistics automatically run recursive SQL during parsing to scan a small random sample of table blocks.">Controlling Dynamic Statistics</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL428"></a>
<div class="props_rev_3"><a id="GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36"></a>
<h3 id="TGSQL-GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" class="sect3">Gathering Optimizer Statistics Concurrently</h3>
<div>
<p>Oracle Database enables you to gather statistics on multiple tables or partitions concurrently.</p>
<p>Oracle Database enables you to gather statistics on multiple tables or partitions concurrently. This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_stats.htm#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="By default, each partition of a partition table is gathered sequentially.">About Concurrent Statistics Gathering</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" title="To enable concurrent statistics gathering, use the DBMS_STATS.SET_GLOBAL_PREFS procedure to set the CONCURRENT preference.">Enabling Concurrent Statistics Gathering</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-A135D99F-E3A3-4553-8995-C7870069D26F" title="When CONCURRENT statistics gathering is enabled, you can execute each statistics gathering job in parallel. This combination is useful when you are analyzing large tables, partitions, or subpartitions. This topic describes the recommended configuration.">Configuring the System for Parallel Execution and Concurrent Statistics Gathering</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" title="You can monitor statistics gathering jobs using data dictionary views.">Monitoring Statistics Gathering Operations</a></p>
</li>
</ul>
</div>
<a id="TGSQL429"></a>
<div class="props_rev_3"><a id="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9"></a>
<h4 id="TGSQL-GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" class="sect4">About Concurrent Statistics Gathering</h4>
<div>
<p>By default, each partition of a partition table is gathered sequentially.</p>
<p>When <span class="bold">concurrent statistics gathering mode</span> is enabled, the database can simultaneously gather optimizer statistics for multiple tables in a schema, or multiple partitions or subpartitions in a table. Concurrency can reduce the overall time required to gather statistics by enabling the database to fully use multiple processors.</p>
<div class="infobox-note" id="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9__GUID-2CA8B54B-33EC-448D-BEB2-9DAA6D7FFAAF">
<p class="notep1">Note:</p>
<p>Concurrent statistics gathering mode does not rely on parallel query processing, but is usable with it.</p>
</div>
</div>
<a id="TGSQL94629"></a>
<div class="props_rev_3"><a id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95"></a>
<h5 id="TGSQL-GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95" class="sect5">How DBMS_STATS Gathers Statistics Concurrently</h5>
<div>
<p>Oracle Database employs multiple tools and technologies to create and manage multiple statistics gathering jobs concurrently.</p>
<p>The database uses the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Oracle Scheduler</p>
</li>
<li>
<p>Oracle Database Advanced Queuing (AQ)</p>
</li>
<li>
<p>Oracle Database Resource Manager (the Resource Manager)</p>
</li>
</ul>
<p>Enable concurrent statistics gathering by setting the <code class="codeph">CONCURRENT</code> preference with <code class="codeph">DBMS_STATS.SET_GLOBAL_PREF</code>.</p>
<p>The database runs as many concurrent jobs as possible. The Job Scheduler decides how many jobs to execute concurrently and how many to queue. As running jobs complete, the scheduler dequeues and runs more jobs until the database has gathered statistics on all tables, partitions, and subpartitions. The maximum number of jobs is bounded by the <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter and available system resources.</p>
<p>In most cases, the <code class="codeph">DBMS_STATS</code> procedures create a separate job for each table partition or subpartition. However, if the partition or subpartition is empty or very small, then the database may automatically batch the object with other small objects into a single job to reduce the overhead of job maintenance.</p>
<p>The following figure illustrates the creation of jobs at different levels, where Table 3 is a partitioned table, and the other tables are nonpartitioned. Job 3 acts as a coordinator job for Table 3, and creates a job for each partition in that table, and a separate job for the global statistics of Table 3. This example assumes that incremental statistics gathering is disabled; if enabled, then the database derives global statistics from partition-level statistics after jobs for partitions complete.</p>
<div class="figure" id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95__GUID-C4206148-0B55-4801-84F7-8B47C6D102E9">
<p class="titleinfigure">Figure 12-1 Concurrent Statistics Gathering Jobs</p>
<img width="476" height="332" src="img/GUID-5BB393BC-7E04-42E5-9EDE-29BDFA625401-default.png" alt="Description of Figure 12-1 follows" title="Description of Figure 12-1 follows"/><br/>
<a href="img_text/GUID-5BB393BC-7E04-42E5-9EDE-29BDFA625401-print.htm">Description of &#34;Figure 12-1 Concurrent Statistics Gathering Jobs&#34;</a></div>
<!-- class="figure" -->
<div class="infoboxnotealso" id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95__GUID-C4B4C6DC-E76A-48D3-8CD3-BB8B9DECBB38">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_stats.htm#GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" title="To enable concurrent statistics gathering, use the DBMS_STATS.SET_GLOBAL_PREFS procedure to set the CONCURRENT preference.">Enabling Concurrent Statistics Gathering</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ARPLS059" target="_blank" href="../ARPLS/d_stats.htm#ARPLS059"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> package</p>
</li>
<li>
<p><a class="olink REFRN10077" target="_blank" href="../REFRN/GUID-B8B68D16-00A3-43DD-BE39-01F877880955.htm#REFRN10077"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
</div>
<a id="TGSQL94630"></a>
<div class="props_rev_3"><a id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224"></a>
<h5 id="TGSQL-GUID-A07045A4-2A62-4233-AF00-BD98641EB224" class="sect5">Concurrent Statistics Gathering and Resource Management</h5>
<div>
<p>The <code class="codeph">DBMS_STATS</code> package does not explicitly manage resources used by concurrent statistics gathering jobs that are part of a user-initiated statistics gathering call. Thus, the database may use system resources fully during concurrent statistics gathering. To address this situation, use the Resource Manager to cap resources consumed by concurrent statistics gathering jobs. The Resource Manager must be enabled to gather statistics concurrently.</p>
<p>The system-supplied consumer group <code class="codeph">ORA$AUTOTASK</code> registers all statistics gathering jobs. You can create a resource plan with proper resource allocations for <code class="codeph">ORA$AUTOTASK</code> to prevent concurrent statistics gathering from consuming all available resources. If you lack your own resource plan, and if choose not to create one, then consider activating the Resource Manager with the system-supplied <code class="codeph">DEFAULT_PLAN</code>.</p>
<div class="infobox-note" id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224__GUID-E32B7ED8-AE1F-4C73-934C-EC7BF92A53E4">
<p class="notep1">Note:</p>
<p>The <code class="codeph">ORA$AUTOTASK</code> consumer group is shared with the maintenance tasks that automatically run during the maintenance windows. Thus, when concurrency is activated for automatic statistics gathering, the database automatically manages resources, with no extra steps required.</p>
</div>
<div class="infoboxnotealso" id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224__GUID-695BA61B-EEA0-4079-AF51-57CB3585A815">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN11841" target="_blank" href="../ADMIN/dbrm.htm#ADMIN11841"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> to learn about the Resource Manager</p>
</div>
</div>
</div>
</div>
<a id="TGSQL431"></a><a id="TGSQL94632"></a><a id="TGSQL430"></a>
<div class="props_rev_3"><a id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11"></a>
<h4 id="TGSQL-GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" class="sect4">Enabling Concurrent Statistics Gathering</h4>
<div>
<p>To enable concurrent statistics gathering, use the <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> procedure to set the <code class="codeph">CONCURRENT</code> preference.</p>
<div class="section">
<p>Possible values are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">MANUAL</code></p>
<p>Concurrency is enabled only for manual statistics gathering.</p>
</li>
<li>
<p><code class="codeph">AUTOMATIC</code></p>
<p>Concurrency is enabled only for automatic statistics gathering.</p>
</li>
<li>
<p><code class="codeph">ALL</code></p>
<p>Concurrency is enabled for both manual and automatic statistics gathering.</p>
</li>
<li>
<p><code class="codeph">OFF</code></p>
<p>Concurrency is disabled for both manual and automatic statistics gathering. This is the default value.</p>
</li>
</ul>
<p>This tutorial in this section explains how to enable concurrent statistics gathering.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Prerequisites</p>
<p>This tutorial has the following prerequisites:</p>
<ul style="list-style-type: disc;">
<li>
<p>In addition to the standard privileges for gathering statistics, you must have the following privileges:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">CREATE JOB</code></p>
</li>
<li>
<p><code class="codeph">MANAGE SCHEDULER</code></p>
</li>
<li>
<p><code class="codeph">MANAGE ANY QUEUE</code></p>
</li>
</ul>
</li>
<li>
<p>The <code class="codeph">SYSAUX</code> tablespace must be online because the scheduler stores its internal tables and views in this tablespace.</p>
</li>
<li>
<p>The <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter must be set to at least <code class="codeph">4</code>.</p>
</li>
<li>
<p>The Resource Manager must be enabled.</p>
<p>By default, the Resource Manager is disabled. If you do not have a resource plan, then consider enabling the Resource Manager with the system-supplied <code class="codeph">DEFAULT_PLAN</code>.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
<p>This tutorial assumes that you want to do the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Enable concurrent statistics gathering</p>
</li>
<li>
<p>Gather statistics for the <code class="codeph">sh</code> schema</p>
</li>
<li>
<p>Monitor the gathering of the <code class="codeph">sh</code> statistics</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To enable concurrent statistics gathering:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the appropriate privileges, and then enable the Resource Manager.</p>
<p>The following example uses the default plan for the Resource Manager:</p>
<pre dir="ltr">ALTER SYSTEM SET RESOURCE_MANAGER_PLAN = &#39;DEFAULT_PLAN&#39;;
</pre></li>
<li>
<p>Set the <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter to at least twice the number of CPU cores.</p>
<p>In Oracle Real Application Clusters, the <code class="codeph">JOB_QUEUE_PROCESSES</code> setting applies to each node.</p>
<p>Assume that the system has 4 CPU cores. The following example sets the parameter to <code class="codeph">8</code> (twice the number of cores):</p>
<pre dir="ltr">ALTER SYSTEM SET JOB_QUEUE_PROCESSES=8;
</pre></li>
<li>
<p>Confirm that the parameter change took effect.</p>
<p>For example, enter the following command in SQL*Plus (sample output included):</p>
<pre dir="ltr">SHOW PARAMETER PROCESSES;

NAME                             TYPE        VALUE
-------------------------------- ----------- -----
_high_priority_processes         string      VKTM
aq_tm_processes                  integer     1
db_writer_processes              integer     1
gcs_server_processes             integer     0
global_txn_processes             integer     1
job_queue_processes              integer     8
log_archive_max_processes        integer     4
processes                        integer     100
</pre></li>
<li>
<p>Enable concurrent statistics.</p>
<p>For example, execute the following PL/SQL anonymous block:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.SET_GLOBAL_PREFS(&#39;CONCURRENT&#39;,&#39;ALL&#39;);
END;
/
</pre></li>
<li>
<p>Confirm that the statistics were enabled.</p>
<p>For example, execute the following query (sample output included):</p>
<pre dir="ltr">SELECT DBMS_STATS.GET_PREFS(&#39;CONCURRENT&#39;) FROM DUAL;

DBMS_STATS.GET_PREFS(&#39;CONCURRENT&#39;)
----------------------------------
ALL
</pre></li>
<li>
<p>Gather the statistics for the <code class="codeph">SH</code> schema.</p>
<p>For example, execute the following procedure:</p>
<pre dir="ltr">EXEC DBMS_STATS.GATHER_SCHEMA_STATS(&#39;SH&#39;);
</pre></li>
<li>
<p>In a separate session, monitor the job progress by querying <code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code>.</p>
<p>For example, execute the following query (sample output included):</p>
<pre dir="ltr">SET LINESIZE 1000
 
COLUMN TARGET FORMAT a8
COLUMN TARGET_TYPE FORMAT a25
COLUMN JOB_NAME FORMAT a14
COLUMN START_TIME FORMAT a40
 
SELECT TARGET, TARGET_TYPE, JOB_NAME, 
       TO_CHAR(START_TIME, &#39;dd-mon-yyyy hh24:mi:ss&#39;)
FROM   DBA_OPTSTAT_OPERATION_TASKS 
WHERE  STATUS = &#39;IN PROGRESS&#39; 
AND    OPID = (SELECT MAX(ID) 
               FROM   DBA_OPTSTAT_OPERATIONS 
               WHERE  OPERATION = &#39;gather_schema_stats&#39;);

TARGET    TARGET_TYPE               JOB_NAME       TO_CHAR(START_TIME,&#39;
--------- ------------------------- -------------- --------------------
SH.SALES  TABLE (GLOBAL STATS ONLY) ST$T292_1_B29  30-nov-2012 14:22:47
SH.SALES  TABLE (COORDINATOR JOB)   ST$SD290_1_B10 30-nov-2012 14:22:08
</pre></li>
<li>
<p>In the original session, disable concurrent statistics gathering.</p>
<p>For example, execute the following query:</p>
<pre dir="ltr">EXEC DBMS_STATS.SET_GLOBAL_PREFS(&#39;CONCURRENT&#39;,&#39;OFF&#39;);
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-9AFAD145-71AE-4CD8-92EF-3E6D16EF83FB">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="tgsql_stats.htm#GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" title="You can monitor statistics gathering jobs using data dictionary views.">Monitoring Statistics Gathering Operations</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ADMIN11890" target="_blank" href="../ADMIN/dbrm.htm#ADMIN11890"><span><cite>Oracle Database Administrator&rsquo;s Guide</cite></span></a></p>
</li>
<li>
<p><a class="olink ARPLS68664" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68664"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn how to use the <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> procedure</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL432"></a>
<div class="props_rev_3"><a id="GUID-A135D99F-E3A3-4553-8995-C7870069D26F"></a>
<h4 id="TGSQL-GUID-A135D99F-E3A3-4553-8995-C7870069D26F" class="sect4">Configuring the System for Parallel Execution and Concurrent Statistics Gathering</h4>
<div>
<p>When <code class="codeph">CONCURRENT</code> statistics gathering is enabled, you can execute each statistics gathering job in parallel. This combination is useful when you are analyzing large tables, partitions, or subpartitions. This topic describes the recommended configuration.</p>
<div class="section">
<p class="subhead3">To configure the system for parallel execution and concurrent statistics gathering:</p>
<ol>
<li>
<p>Connect SQL*Plus to the database with the administrator privileges.</p>
</li>
<li>
<p>Disable the parallel adaptive multiuser initialization parameter.</p>
<p>For example, use the following SQL statement:</p>
<pre dir="ltr">ALTER SYSTEM SET PARALLEL_ADAPTIVE_MULTI_USER=false;
</pre></li>
<li>
<p>Configure the database to use a resource plan that has parallel queuing enabled.</p>
<p>Perform the following steps:</p>
<ol>
<li>
<p>If Oracle Database Resource Manager (the Resource Manager) is not activated, then activate it. By default, the Resource Manager is activated only during the maintenance windows.</p>
</li>
<li>
<p>Create a temporary resource plan in which the consumer group <code class="codeph">OTHER_GROUPS</code> has queuing enabled.</p>
</li>
</ol>
<p>The following sample script illustrates one way to create a temporary resource plan (<code class="codeph">pqq_test</code>), and enable the Resource Manager with this plan:</p>
<pre dir="ltr">BEGIN
  DBMS_RESOURCE_MANAGER.CREATE_PENDING_AREA();
  DBMS_RESOURCE_MANAGER.CREATE_PLAN(&#39;pqq_test&#39;, &#39;pqq_test&#39;);
  DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
    &#39;pqq_test&#39;
,   &#39;OTHER_GROUPS&#39;
,   &#39;OTHER_GROUPS directive for pqq&#39;
,   parallel_server_limit            =&gt; 90
,   max_utilization_limit            =&gt; 90
);
  DBMS_RESOURCE_MANAGER.SUBMIT_PENDING_AREA();
END;
/
ALTER SYSTEM SET RESOURCE_MANAGER_PLAN = &#39;pqq_test&#39; SID=&#39;*&#39;;
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-A135D99F-E3A3-4553-8995-C7870069D26F__GUID-E6356314-A42B-477F-9601-31DEC73371D8">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADMIN027" target="_blank" href="../ADMIN/dbrm.htm#ADMIN027"><span><cite>Oracle Database Administrator&rsquo;s Guide</cite></span></a> to learn how to manage resources with the Resource Manager</p>
</li>
<li>
<p><a class="olink REFRN10154" target="_blank" href="../REFRN/GUID-6A4F12CA-E6EA-4D13-A725-80B86404ECFA.htm#REFRN10154"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">PARALLEL_ADAPTIVE_MULTI_USER</code> initialization parameter</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL433"></a>
<div class="props_rev_3"><a id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451"></a>
<h4 id="TGSQL-GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" class="sect4">Monitoring Statistics Gathering Operations</h4>
<div>
<p>You can monitor statistics gathering jobs using data dictionary views.</p>
<div class="section">
<p>The following views are relevant:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN23868" target="_blank" href="../REFRN/GUID-D52DB747-6290-4F55-A751-8C946481C70C.htm#REFRN23868"><code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code></a></p>
<p>This view contains the history of tasks that are performed or currently in progress as part of statistics gathering operations (recorded in <code class="codeph">DBA_OPTSTAT_OPERATIONS</code>). Each task represents a target object to be processed in the corresponding parent operation.</p>
</li>
<li>
<p><a class="olink REFRN23463" target="_blank" href="../REFRN/GUID-3D13B3C5-C1D1-47E7-B852-CD1563719402.htm#REFRN23463"><code class="codeph">DBA_OPTSTAT_OPERATIONS</code></a></p>
<p>This view contains a history of statistics operations performed or currently in progress at the table, schema, and database level using the <code class="codeph">DBMS_STATS</code> package.</p>
</li>
</ul>
<p>The <code class="codeph">TARGET</code> column in the preceding views shows the target object for that statistics gathering job in the following form:</p>
<pre dir="ltr"><span class="italic">OWNER</span>.<span class="italic">TABLE_NAME</span>.<span class="italic">PARTITION_OR_SUBPARTITION_NAME</span>
</pre>
<p>All statistics gathering job names start with the string <code class="codeph">ST$</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To display currently running statistics tasks and jobs:</p>
<ul style="list-style-type: disc;">
<li>
<p>To list statistics gathering currently running tasks from all user sessions, use the following SQL statement (sample output included):</p>
<pre dir="ltr">SELECT OPID, TARGET, JOB_NAnME, 
       (SYSTIMESTAMP - START_TIME) AS elapsed_time
FROM   DBA_OPTSTAT_OPERATION_TASKS
WHERE  STATUS = &#39;IN PROGRESS&#39;;

OPID TARGET                    JOB_NAME      ELAPSED_TIME
---- ------------------------- ------------- --------------------------
 981 SH.SALES.SALES_Q4_1998    ST$T82_1_B29  +000000000 00:00:00.596321
 981 SH.SALES                  ST$SD80_1_B10 +000000000 00:00:27.972033
</pre></li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To display completed statistics tasks and jobs:</p>
<ul style="list-style-type: disc;">
<li>
<p>To list only completed tasks and jobs from a particular operation, first identify the operation ID from the <code class="codeph">DBA_OPTSTAT_OPERATIONS</code> view based on the statistics gathering operation name, target, and start time. After you identify the operation ID, you can query the <code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code> view to find the corresponding tasks in that operation</p>
<p>For example, to list operations with the ID 981, use the following commands in SQL*Plus (sample output included):</p>
<pre dir="ltr">VARIABLE id NUMBER
EXEC :id := 981

SELECT TARGET, JOB_NAME, (END_TIME - START_TIME) AS ELAPSED_TIME
FROM   DBA_OPTSTAT_OPERATION_TASKS
WHERE  STATUS &lt;&gt; &#39;IN PROGRESS&#39;
AND    OPID = :id;

TARGET                    JOB_NAME      ELAPSED_TIME
------------------------- ------------- --------------------------
SH.SALES_TRANSACTIONS_EXT               +000000000 00:00:45.479233
SH.CAL_MONTH_SALES_MV     ST$SD88_1_B10 +000000000 00:00:45.382764 
SH.CHANNELS               ST$SD88_1_B10 +000000000 00:00:45.307397
</pre></li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To display statistics gathering tasks and jobs that have failed:</p>
<ul style="list-style-type: disc;">
<li>
<p>Use the following SQL statement (partial sample output included):</p>
<pre dir="ltr">SET LONG 10000

SELECT TARGET, JOB_NAME,
       (END_TIME - START_TIME) AS ELAPSED_TIME, NOTES
FROM   DBA_OPTSTAT_OPERATION_TASKS
WHERE  STATUS = &#39;FAILED&#39;;

TARGET             JOB_NAME ELAPSED_TIME               NOTES
------------------ -------- -------------------------- ----------------------
SYS.OPATCH_XML_INV          +000000007 02:36:31.130314 &lt;error&gt;ORA-20011:
                                                       Approximate NDV failed: 
                                                       ORA-29913: error in
.
.
.
</pre></li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-4032F5C7-07F1-4ABF-BCF4-185BDBDD9E8E">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN23348" target="_blank" href="../REFRN/GUID-2F4DF4A7-D599-4391-87E5-215E07354F0F.htm#REFRN23348"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DBA_SCHEDULER_JOBS</code> view</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL413"></a>
<div class="props_rev_3"><a id="GUID-63E195EB-10F4-428B-9912-3E98C2A957BF"></a>
<h3 id="TGSQL-GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" class="sect3">Gathering Incremental Statistics on Partitioned Objects</h3>
<div>
<p>Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, <span class="bold">Incremental statistics maintenance</span> improves performance.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="tgsql_stats.htm#GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED" title="In a typical case, an application loads data into a new partition of a range-partitioned table. As applications add new partitions and load data, the database must gather statistics on the new partition and keep global statistics up to date.">Purpose of Incremental Statistics</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" title="When incremental statistics maintenance is enabled, DBMS_STATS gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.">How DBMS_STATS Derives Global Statistics for Partitioned tables</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" title="Incremental statistics affect how the database gathers and stores table and index statistics.">Considerations for Incremental Statistics Maintenance</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1" title="A partition maintenance operation is a partition-related operation such as adding, exchanging, merging, or splitting table partitions.">Maintaining Incremental Statistics for Partition Maintenance Operations</a></p>
</li>
<li>
<p><a href="tgsql_stats.htm#GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5" title="Starting in Oracle Database 12c, incremental statistics can automatically calculate global statistics for a partitioned table even if the partition or subpartition statistics are stale and locked.">Maintaining Incremental Statistics for Tables with Stale or Locked Partition Statistics</a></p>
</li>
</ul>
</div>
<a id="TGSQL95046"></a>
<div class="props_rev_3"><a id="GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED"></a>
<h4 id="TGSQL-GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED" class="sect4">Purpose of Incremental Statistics</h4>
<div>
<p>In a typical case, an application loads data into a new partition of a range-partitioned table. As applications add new partitions and load data, the database must gather statistics on the new partition and keep global statistics up to date.</p>
<p>Typically, data warehouse applications access large partitioned tables. Often these tables are partitioned on date columns, with only the recent partitions subject to frequent DML changes. Without incremental statistics, statistics collection typically uses a two-pass approach:</p>
<ol>
<li>
<p>The database scans the table to gather the global statistics.</p>
<p>The full scan of the table for global statistics collection can be very expensive, depending on the size of the table. As the table adds partitions, the longer the execution time for <code class="codeph">GATHER_TABLE_STATS</code> because of the full table scan required for the global statistics. The database must perform the scan of the entire table even if only a small subset of partitions change.</p>
</li>
<li>
<p>The database scans the changed partitions to gather their partition-level statistics.</p>
</li>
</ol>
<p>Incremental maintenance provides a huge performance benefit for data warehouse applications because of the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The database must scan the table only once to gather partition statistics and to derive the global statistics by aggregating partition-level statistics. Thus, the database avoids the <span class="italic">two</span> full scans that are required when not using incremental statistics: one scan for the partition-level statistics, and one scan for the global-level statistics.</p>
</li>
<li>
<p>In subsequent statistics gathering, the database only needs to scan the stale partitions and update their statistics (including synopses). The database can derive global statistics from the fresh partition statistics, which saves a full table scan.</p>
</li>
</ul>
<p>When using incremental statistics, the database must still gather statistics on any partition that will change the global or table-level statistics. Incremental statistics maintenance yields the same statistics as gathering table statistics from scratch, but performs better.</p>
</div>
</div>
<a id="TGSQL95048"></a><a id="TGSQL95047"></a>
<div class="props_rev_3"><a id="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47"></a>
<h4 id="TGSQL-GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" class="sect4">How DBMS_STATS Derives Global Statistics for Partitioned tables</h4>
<div>
<p>When incremental statistics maintenance is enabled, <code class="codeph">DBMS_STATS</code> gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.</p>
<p>The database avoids a full table scan when computing global statistics by deriving some global statistics from the partition-level statistics. For example, the number of rows at the global level is the sum of number of rows of partitions. Even global histograms can be derived from partition histograms.</p>
<p>However, the database cannot derive <span class="italic">all</span> statistics from partition-level statistics, including the <a href="glossary.htm#GUID-34DC46FD-32CE-4242-8ED9-945AE7A9F922"><span class="xrefglossterm">NDV</span></a> of a column. The following example shows the NDV for two partitions in a table:</p>
<div class="tblformal" id="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47__GUID-4DADA3A8-7FC7-4346-A485-EB92D03F5271">
<p class="titleintable">Table 12-4 NDV for Two Partitions</p>
<table class="cellalignment4808" title="NDV for Two Partitions" summary="This 3 column table provides a DV example. Column 1 is the object. Column 2 lists the column values. Column 3 is the NDV.">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4870" id="d74553e6003">Object</th>
<th class="cellalignment4870" id="d74553e6005">Column Values</th>
<th class="cellalignment4870" id="d74553e6007">NDV</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4871" id="d74553e6011" headers="d74553e6003">Partition 1</td>
<td class="cellalignment4871" headers="d74553e6011 d74553e6005">1,3,3,4,5</td>
<td class="cellalignment4871" headers="d74553e6011 d74553e6007">4</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4871" id="d74553e6018" headers="d74553e6003">Partition 2</td>
<td class="cellalignment4871" headers="d74553e6018 d74553e6005">2,3,4,5,6</td>
<td class="cellalignment4871" headers="d74553e6018 d74553e6007">5</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Calculating the NDV in the table by adding the NDV of the individual partitions produces an NDV of 9, which is incorrect. Thus, a more accurate technique is required: synopses.</p>
</div>
</div>
<a id="TGSQL95049"></a>
<div class="props_rev_3"><a id="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B"></a>
<h4 id="TGSQL-GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" class="sect4">Considerations for Incremental Statistics Maintenance</h4>
<div>
<p>Incremental statistics affect how the database gathers and stores table and index statistics.</p>
<p>The most important consequences are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">SYSAUX</code> tablespace consumes additional space to maintain global statistics for partitioned tables.</p>
</li>
<li>
<p>If a table uses composite partitioning, then the database only gathers statistics for modified subpartitions. The database does not gather statistics at the subpartition level for unmodified subpartitions. In this way, the database reduces work by skipping unmodified partitions.</p>
</li>
<li>
<p>If a table uses incremental statistics, and if this table has a locally partitioned index, then the database gathers index statistics at the global level and for modified index partitions. The database does not generate global index statistics from the partition-level index statistics. Rather, the database gathers global index statistics by performing a full index scan.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B__GUID-A03902F0-BB84-4990-8955-FCDA34986679">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS059" target="_blank" href="../ARPLS/d_stats.htm#ARPLS059"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about the <code class="codeph">DBMS_STATS</code> package</p>
</div>
</div>
</div>
<a id="TGSQL94920"></a><a id="TGSQL94860"></a>
<div class="props_rev_3"><a id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1"></a>
<h4 id="TGSQL-GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1" class="sect4">Maintaining Incremental Statistics for Partition Maintenance Operations</h4>
<div>
<p>A <span class="bold">partition maintenance operation</span> is a partition-related operation such as adding, exchanging, merging, or splitting table partitions.</p>
<div class="section">
<p>Oracle Database provides the following support for incremental statistics maintenance:</p>
<ul style="list-style-type: disc;">
<li>
<p>If a partition maintenance operation triggers statistics gathering, then the database can reuse synopses that would previously have been dropped with the old segments.</p>
</li>
<li>
<p><code class="codeph">DBMS_STATS</code> can create a synopsis on a nonpartitioned table. The synopsis enables the database to maintain incremental statistics as part of a partition exchange operation without having to explicitly gather statistics on the partition after the exchange.</p>
</li>
</ul>
<p>When the <code class="codeph">DBMS_STATS</code> preference <code class="codeph">INCREMENTAL</code> is set to <code class="codeph">true</code> on a table, the <code class="codeph">INCREMENTAL_LEVEL</code> preference controls which synopses are collected and when. This preference takes the following values:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">TABLE</code></p>
<p><code class="codeph">DBMS_STATS</code> gathers table-level synopses on this table. You can only set <code class="codeph">INCREMENTAL_LEVEL</code> to <code class="codeph">TABLE</code> at the table level, not at the schema, database, or global level.</p>
</li>
<li>
<p><code class="codeph">PARTITION</code> (default)</p>
<p><code class="codeph">DBMS_STATS</code> only gathers synopsis at the partition level of partitioned tables.</p>
</li>
</ul>
<p>When performing a partition exchange, to have synopses after the exchange for the partition being exchanged, set <code class="codeph">INCREMENTAL</code> to <code class="codeph">true</code> and <code class="codeph">INCREMENTAL_LEVEL</code> to <code class="codeph">TABLE</code> on the table to be exchanged with the partition.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You want to load empty partition <code class="codeph">p_sales_01_2010</code> in a <code class="codeph">sales</code> table.</p>
</li>
<li>
<p>You create a staging table <code class="codeph">t_sales_01_2010</code>, and then populate the table.</p>
</li>
<li>
<p>You want the database to maintain incremental statistics as part of the partition exchange operation without having to explicitly gather statistics on the partition after the exchange.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To maintain incremental statistics as part of a partition exchange operation:</p>
<ol>
<li>
<p>Set incremental statistics preferences for staging table <code class="codeph">t_sales_01_2010</code>.</p>
<p>For example, run the following statement:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.SET_TABLE_PREFS (   
      ownname  =&gt;  &#39;sh&#39;
,     tabname  =&gt;  &#39;t_sales_01_2010&#39;
,     pname    =&gt;  &#39;INCREMENTAL&#39;
,     pvalue   =&gt;  &#39;true&#39;
); 
  DBMS_STATS.SET_TABLE_PREFS (  
      ownname  =&gt;  &#39;sh&#39;
,     tabname  =&gt;  &#39;t_sales_01_2010&#39;
,     pname    =&gt;  &#39;INCREMENTAL_LEVEL&#39;
,     pvalue   =&gt;  &#39;table&#39;
);
END;
</pre></li>
<li>
<p>Gather statistics on staging table <code class="codeph">t_sales_01_2010</code>.</p>
<p>For example, run the following PL/SQL code:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.GATHER_TABLE_STATS ( 
      ownname  =&gt; &#39;SH&#39;
,     tabname  =&gt; &#39;T_SALES_01_2010&#39;
);
END;
/
</pre>
<p><code class="codeph">DBMS_STATS</code> gathers table-level synopses on <code class="codeph">t_sales_01_2010</code>.</p>
</li>
<li>
<p>Ensure that the <code class="codeph">INCREMENTAL</code> preference is <code class="codeph">true</code> on the <code class="codeph">sh.sales</code> table.</p>
<p>For example, run the following PL/SQL code:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.SET_TABLE_PREFS (
      ownname  =&gt;  &#39;sh&#39;
,     tabname  =&gt;  &#39;sales&#39;
,     pname    =&gt;  &#39;INCREMENTAL&#39;
,     pvalue   =&gt;  &#39;true&#39;
);
END;
/
</pre></li>
<li>
<p>If you have never gathered statistics on <code class="codeph">sh.sales</code> before with <code class="codeph">INCREMENTAL</code> set to <code class="codeph">true</code>, then gather statistics on the partition to be exchanged.</p>
<p>For example, run the following PL/SQL code:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.GATHER_TABLE_STATS (
      ownname  =&gt;  &#39;sh&#39;
,     tabname  =&gt;  &#39;sales&#39;
,     pname    =&gt;  &#39;p_sales_01_2010&#39;
,     pvalue   =&gt;  granularity=&gt;&#39;partition&#39;
);
END;
/
</pre></li>
<li>
<p>Perform the partition exchange.</p>
<p>For example, use the following SQL statement:</p>
<pre dir="ltr">ALTER TABLE sales EXCHANGE PARTITION p_sales_01_2010 WITH TABLE t_sales_01_2010;
</pre>
<p>After the exchange, the partitioned table has both statistics and a synopsis for partition <code class="codeph">p_sales_01_2010</code>.</p>
<p>In releases before Oracle Database 12<span class="italic">c</span>, the preceding statement swapped the segment data and statistics of <code class="codeph">p_sales_01_2010</code> with <code class="codeph">t_sales_01_2010</code>. The database did not maintain synopses for nonpartitioned tables such as <code class="codeph">t_sales_01_2010</code>. To gather global statistics on the partitioned table, you needed to rescan the <code class="codeph">p_sales_01_2010</code> partition to obtain its synopses.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1__GUID-7C45B371-5427-4ABA-8F1D-D9ECE840EFC2">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68674" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68674"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94921"></a><a id="TGSQL94863"></a>
<div class="props_rev_3"><a id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5"></a>
<h4 id="TGSQL-GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5" class="sect4">Maintaining Incremental Statistics for Tables with Stale or Locked Partition Statistics</h4>
<div>
<p>Starting in Oracle Database 12<span class="italic">c</span>, incremental statistics can automatically calculate global statistics for a partitioned table even if the partition or subpartition statistics are stale and locked.</p>
<div class="section">
<p>When incremental statistics are enabled in releases before Oracle Database 12<span class="italic">c</span>, if any DML occurs on a partition, then the optimizer considers statistics on this partition to be stale. Thus, <code class="codeph">DBMS_STATS</code> must gather the statistics again to accurately aggregate the global statistics. Furthermore, if DML occurs on a partition whose statistics are locked, then <code class="codeph">DBMS_STATS</code> cannot regather the statistics on the partition, so a full table scan is the only means of gathering global statistics. Regathering statistics creates performance overhead.</p>
<p>In Oracle Database 12<span class="italic">c</span>, the statistics preference <code class="codeph">INCREMENTAL_STALENESS</code> controls how the database determines whether the statistics on a partition or subpartition are stale. This preference takes the following values:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">USE_STALE_PERCENT</code></p>
<p>A partition or subpartition is not considered stale if DML changes are less than the <code class="codeph">STALE_PERCENT</code> preference specified for the table. The default value of <code class="codeph">STALE_PERCENT</code> is <code class="codeph">10</code>, which means that if DML causes more than 10% of row changes, then the table is considered stale.</p>
</li>
<li>
<p><code class="codeph">USE_LOCKED_STATS</code></p>
<p>Locked partition or subpartition statistics are not considered stale, regardless of DML changes.</p>
</li>
<li>
<p><code class="codeph">NULL</code> (default)</p>
<p>A partition or subpartition is considered stale if it has any DML changes. This behavior is identical to the Oracle Database 11<span class="italic">g</span> behavior. When the default value is used, statistics gathered in incremental mode are guaranteed to be the same as statistics gathered in nonincremental mode. When a nondefault value is used, statistics gathered in incremental mode might be less accurate than those gathered in nonincremental mode.</p>
</li>
</ul>
<p>You can specify <code class="codeph">USE_STALE_PERCENT</code> and <code class="codeph">USE_LOCKED_STATS</code> together. For example, you can write the following anonymous block:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.SET_TABLE_PREFS (
    ownname     =&gt; null
,   table_name  =&gt; &#39;t&#39;
,   pname       =&gt; &#39;incremental_staleness&#39;
,   pvalue      =&gt; &#39;use_stale_percent,use_locked_stats&#39;
);
END;
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">STALE_PERCENT</code> for a partitioned table is set to <code class="codeph">10</code>.</p>
</li>
<li>
<p>The <code class="codeph">INCREMENTAL</code> value is set to <code class="codeph">true</code>.</p>
</li>
<li>
<p>The table has had statistics gathered in <code class="codeph">INCREMENTAL</code> mode before.</p>
</li>
<li>
<p>You want to discover how statistics gathering changes depending on the setting for <code class="codeph">INCREMENTAL_STALENESS</code>, whether the statistics are locked, and the percentage of DML changes.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To test for tables with stale or locked partition statistics:</p>
<ol>
<li>
<p>Set <code class="codeph">INCREMENTAL_STALENESS</code> to <code class="codeph">NULL</code>.</p>
<p>Afterward, 5% of the rows in one partition change because of DML activity.</p>
</li>
<li>
<p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.</p>
<p><code class="codeph">DBMS_STATS</code> regathers statistics for the partition that had the 5% DML activity, and incrementally maintains the global statistics.</p>
</li>
<li>
<p>Set <code class="codeph">INCREMENTAL_STALENESS</code> to <code class="codeph">USE_STALE_PERCENT</code>.</p>
<p>Afterward, 5% of the rows in one partition change because of DML activity.</p>
</li>
<li>
<p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.</p>
<p><code class="codeph">DBMS_STATS</code> does <span class="italic">not</span> regather statistics for the partition that had DML activity (because the changes are under the staleness threshold of 10%), and incrementally maintains the global statistics.</p>
</li>
<li>
<p>Lock the partition statistics.</p>
<p>Afterward, 20% of the rows in one partition change because of DML activity.</p>
</li>
<li>
<p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.</p>
<p><code class="codeph">DBMS_STATS</code> does <span class="italic">not</span> regather statistics for the partition because the statistics are locked. The database gathers the global statistics with a full table scan.</p>
<p>Afterward, 5% of the rows in one partition change because of DML activity.</p>
</li>
<li>
<p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.</p>
<p>When you gather statistics on this table, <code class="codeph">DBMS_STATS</code> does not regather statistics for the partition because they are not considered stale. The database maintains global statistics incrementally using the existing statistics for this partition.</p>
</li>
<li>
<p>Set <code class="codeph">INCREMENTAL_STALENESS</code> to <code class="codeph">USE_LOCKED_STATS</code> and <code class="codeph">USE_STALE_PERCENT</code>.</p>
<p>Afterward, 20% of the rows in one partition change because of DML activity.</p>
</li>
<li>
<p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.</p>
<p>Because <code class="codeph">USE_LOCKED_STATS</code> is set, <code class="codeph">DBMS_STATS</code> ignores the fact that the statistics are stale and uses the locked statistics. The database maintains global statistics incrementally using the existing statistics for this partition.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5__GUID-017C8070-4B8D-4790-9CDA-FAC24E409940">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68674" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68674"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<a id="TGSQL434"></a>
<div class="props_rev_3"><a id="GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31"></a>
<h2 id="TGSQL-GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" class="sect2">Gathering System Statistics Manually</h2>
<div>
<p><a id="d74553e6809" class="indexterm-anchor"></a>System statistics describe the system&#39;s hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer. System statistics enable the optimizer to choose a more efficient execution plan. Oracle recommends that you gather system statistics when a physical change occurs in the environment, for example, the server has faster CPUs, more memory, or different disk storage.</p>
</div>
<a id="TGSQL435"></a><a id="TGSQL94865"></a>
<div class="props_rev_3"><a id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23"></a>
<h3 id="TGSQL-GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23" class="sect3">About Gathering System Statistics with DBMS_STATS</h3>
<div>
<p><a id="d74553e6892" class="indexterm-anchor"></a><a id="d74553e6894" class="indexterm-anchor"></a><a id="d74553e6898" class="indexterm-anchor"></a>To gather system statistics, use <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>. When the database gathers system statistics, it analyzes activity in a specified time period (<span class="bold"><a href="glossary.htm#GUID-0E167226-3129-4FAA-BBED-01AD45E6179B"><span class="xrefglossterm">workload statistics</span></a></span>) or simulates a workload (<span class="bold"><a href="glossary.htm#GUID-7DA4B71C-A230-490D-9B18-28C55A63532F"><span class="xrefglossterm">noworkload statistics</span></a></span>). The input arguments to <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> are:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">NOWORKLOAD</code></p>
<p>The optimizer gathers statistics based on system characteristics only, without regard to the workload.</p>
</li>
<li>
<p><code class="codeph">INTERVAL</code></p>
<p>After the specified number of minutes has passed, the optimizer updates system statistics either in the data dictionary, or in an alternative table (specified by <code class="codeph">stattab</code>). Statistics are based on system activity during the specified interval.</p>
</li>
<li>
<p><code class="codeph">START</code> and <code class="codeph">STOP</code></p>
<p><code class="codeph">START</code> initiates gathering statistics. <code class="codeph">STOP</code> calculates statistics for the elapsed period (since <code class="codeph">START</code>) and refreshes the data dictionary or an alternative table (specified by <code class="codeph">stattab</code>). The optimizer ignores <code class="codeph">INTERVAL</code>.</p>
</li>
<li>
<p><code class="codeph">EXADATA</code></p>
<p>The system statistics consider the unique capabilities provided by using Exadata, such as large I/O size and high I/O throughput. The optimizer sets the multiblock read count and I/O throughput statistics along with CPU speed.</p>
</li>
</ul>
<p><a href="tgsql_stats.htm#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG" title="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered.">Table 12-5</a> lists the optimizer system statistics gathered by <code class="codeph">DBMS_STATS</code> and the options for gathering or manually setting specific system statistics.</p>
<div class="tblformal" id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG">
<p class="titleintable">Table 12-5 Optimizer System Statistics in the DBMS_STAT Package</p>
<table class="cellalignment4808" title="Optimizer System Statistics in the DBMS_STAT Package" summary="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered.">
<thead>
<tr class="cellalignment4802">
<th class="cellalignment4872" id="d74553e6986">Parameter Name</th>
<th class="cellalignment4873" id="d74553e6989">Description</th>
<th class="cellalignment4820" id="d74553e6992">Initialization</th>
<th class="cellalignment4874" id="d74553e6995">Options for Gathering or Setting Statistics</th>
<th class="cellalignment4875" id="d74553e6998">Unit</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7003" headers="d74553e6986">
<p><code class="codeph">cpuspeedNW</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7003 d74553e6989">
<p>Represents noworkload CPU speed. CPU speed is the average number of CPU cycles in each second.</p>
</td>
<td class="cellalignment4823" headers="d74553e7003 d74553e6992">
<p>At system startup</p>
</td>
<td class="cellalignment4878" headers="d74553e7003 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7003 d74553e6998">
<p>Millions/sec.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7026" headers="d74553e6986">
<p><code class="codeph">ioseektim</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7026 d74553e6989">
<p>Represents the time it takes to position the disk head to read data. I/O seek time equals seek time + latency time + operating system overhead time.</p>
</td>
<td class="cellalignment4823" headers="d74553e7026 d74553e6992">
<p>At system startup</p>
<p>10 (default)</p>
</td>
<td class="cellalignment4878" headers="d74553e7026 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7026 d74553e6998">
<p>ms</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7051" headers="d74553e6986">
<p><code class="codeph">iotfrspeed</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7051 d74553e6989">
<p>Represents the rate at which an Oracle database can read data in the single read request.</p>
</td>
<td class="cellalignment4823" headers="d74553e7051 d74553e6992">
<p>At system startup</p>
<p>4096 (default)</p>
</td>
<td class="cellalignment4878" headers="d74553e7051 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7051 d74553e6998">
<p>Bytes/ms</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7076" headers="d74553e6986">
<p><code class="codeph">cpuspeed</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7076 d74553e6989">
<p>Represents workload CPU speed. CPU speed is the average number of CPU cycles in each second.</p>
</td>
<td class="cellalignment4823" headers="d74553e7076 d74553e6992">
<p>None</p>
</td>
<td class="cellalignment4878" headers="d74553e7076 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code>, <code class="codeph">INTERVAL</code>, or <code class="codeph">START|STOP</code>, or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7076 d74553e6998">
<p>Millions/sec.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7105" headers="d74553e6986">
<p><code class="codeph">maxthr</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7105 d74553e6989">
<p>Maximum I/O throughput is the maximum throughput that the I/O subsystem can deliver.</p>
</td>
<td class="cellalignment4823" headers="d74553e7105 d74553e6992">
<p>None</p>
</td>
<td class="cellalignment4878" headers="d74553e7105 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code>, <code class="codeph">INTERVAL</code>, or <code class="codeph">START|STOP</code>, or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7105 d74553e6998">
<p>Bytes/sec.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7134" headers="d74553e6986">
<p><code class="codeph">slavethr</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7134 d74553e6989">
<p>Slave I/O throughput is the average parallel execution server I/O throughput.</p>
</td>
<td class="cellalignment4823" headers="d74553e7134 d74553e6992">
<p>None</p>
</td>
<td class="cellalignment4878" headers="d74553e7134 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7134 d74553e6998">
<p>Bytes/sec.</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7160" headers="d74553e6986">
<p><code class="codeph">sreadtim</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7160 d74553e6989">
<p>Single-block read time is the average time to read a single block randomly.</p>
</td>
<td class="cellalignment4823" headers="d74553e7160 d74553e6992">
<p>None</p>
</td>
<td class="cellalignment4878" headers="d74553e7160 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7160 d74553e6998">
<p>ms</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7186" headers="d74553e6986">
<p><code class="codeph">mreadtim</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7186 d74553e6989">
<p>Multiblock read is the average time to read a multiblock sequentially.</p>
</td>
<td class="cellalignment4823" headers="d74553e7186 d74553e6992">
<p>None</p>
</td>
<td class="cellalignment4878" headers="d74553e7186 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7186 d74553e6998">
<p>ms</p>
</td>
</tr>
<tr class="cellalignment4802">
<td class="cellalignment4876" id="d74553e7212" headers="d74553e6986">
<p><code class="codeph">mbrc</code></p>
</td>
<td class="cellalignment4877" headers="d74553e7212 d74553e6989">
<p>Multiblock count is the average multiblock read count sequentially.</p>
</td>
<td class="cellalignment4823" headers="d74553e7212 d74553e6992">
<p>None</p>
</td>
<td class="cellalignment4878" headers="d74553e7212 d74553e6995">
<p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.</p>
</td>
<td class="cellalignment4879" headers="d74553e7212 d74553e6998">
<p>blocks</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__GUID-C33BC8C2-333A-4EF9-AB7E-E27AE65270F0">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS059" target="_blank" href="../ARPLS/d_stats.htm#ARPLS059"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for detailed information on the procedures in the <code class="codeph">DBMS_STATS</code> package for implementing system statistics</p>
</div>
</div>
</div>
<a id="TGSQL436"></a>
<div class="props_rev_3"><a id="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B"></a>
<h3 id="TGSQL-GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B" class="sect3">Guidelines for Gathering System Statistics</h3>
<div>
<div class="section">
<p>The database automatically gathers essential parts of system statistics at startup. CPU and I/O characteristics tend to remain constant over time. Typically, these characteristics only change when some aspect of the configuration is upgraded. For this reason, Oracle recommends that you gather system statistics only when a physical change occurs in your environment, for example, the server gets faster CPUs, more memory, or different disk storage.</p>
<p>Note the following guidelines:</p>
<ul style="list-style-type: disc;">
<li>
<p>Oracle Database initializes noworkload statistics to default values at the first instance startup. Oracle recommends that you gather noworkload statistics after you create new tablespaces on storage that is not used by any other tablespace.</p>
</li>
<li>
<p>The best practice is to capture statistics in the interval of time when the system has the most common workload. Gathering workload statistics does not generate additional overhead.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL437"></a>
<div class="props_rev_3"><a id="GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916"></a>
<h3 id="TGSQL-GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" class="sect3">Gathering Workload Statistics</h3>
<div>
<p>Use <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> to capture statistics when the database has the most typical workload. For example, database applications can process OLTP transactions during the day and generate OLAP reports at night.</p>
</div>
<a id="TGSQL439"></a><a id="TGSQL438"></a>
<div class="props_rev_3"><a id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66"></a>
<h4 id="TGSQL-GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66" class="sect4">About Workload Statistics</h4>
<div>
<p>Workload statistics analyze activity in a specified time period.</p>
<p>Workload statistics include the following statistics listed in <a href="tgsql_stats.htm#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG" title="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered.">Table 12-5</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Single block (<code class="codeph">sreadtim</code>) and multiblock (<code class="codeph">mreadtim</code>) read times</p>
</li>
<li>
<p>Multiblock count (<code class="codeph">mbrc</code>)</p>
</li>
<li>
<p>CPU speed (<code class="codeph">cpuspeed</code>)</p>
</li>
<li>
<p>Maximum system throughput (<code class="codeph">maxthr</code>)</p>
</li>
<li>
<p>Average parallel execution throughput (<code class="codeph">slavethr</code>)</p>
</li>
</ul>
<p>The database computes <code class="codeph">sreadtim</code>, <code class="codeph">mreadtim</code>, and <code class="codeph">mbrc</code> by comparing the number of physical sequential and random reads between two points in time from the beginning to the end of a workload. The database implements these values through counters that change when the buffer cache completes synchronous read requests.</p>
<p>Because the counters are in the buffer cache, they include not only I/O delays, but also waits related to latch contention and task switching. Thus, workload statistics depend on system activity during the workload window. If system is I/O bound (both latch contention and I/O throughput), then the statistics promote a less I/O-intensive plan after the database uses the statistics.</p>
<p>As shown in <a href="tgsql_stats.htm#GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__CHDIGAIC">Figure 12-2</a>, if you gather workload statistics, then the optimizer uses the <code class="codeph">mbrc</code> value gathered for workload statistics to estimate the cost of a full table scan.</p>
<div class="figure" id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__CHDIGAIC">
<p class="titleinfigure">Figure 12-2 Workload Statistics Counters</p>
<img width="504" height="213" src="img/GUID-ED91DCC1-2864-4C17-8859-1B377B6F5029-default.png" alt="Description of Figure 12-2 follows" title="Description of Figure 12-2 follows"/><br/>
<a href="img_text/GUID-ED91DCC1-2864-4C17-8859-1B377B6F5029-print.htm">Description of &#34;Figure 12-2 Workload Statistics Counters&#34;</a></div>
<!-- class="figure" -->
<p>When gathering workload statistics, the database may not gather the <code class="codeph">mbrc</code> and <code class="codeph">mreadtim</code> values if no table scans occur during serial workloads, as is typical of OLTP systems. However, full table scans occur frequently on DSS systems. These scans may run parallel and bypass the buffer cache. In such cases, the database still gathers the <code class="codeph">sreadtim</code> because index lookups use the buffer cache.</p>
<p>If the database cannot gather or validate gathered <code class="codeph">mbrc</code> or <code class="codeph">mreadtim</code> values, but has gathered <code class="codeph">sreadtim</code> and <code class="codeph">cpuspeed</code>, then the database uses only <code class="codeph">sreadtim</code> and <code class="codeph">cpuspeed</code> for costing. In this case, the optimizer uses the value of the initialization parameter <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> to cost a full table scan. However, if <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> is <code class="codeph">0</code> or is not set, then the optimizer uses a value of <code class="codeph">8</code> for calculating cost.</p>
<p>Use the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure to gather workload statistics. The <code class="codeph">GATHER_SYSTEM_STATS</code> procedure refreshes the data dictionary or a staging table with statistics for the elapsed period. To set the duration of the collection, use either of the following techniques:</p>
<ul style="list-style-type: disc;">
<li>
<p>Specify <code class="codeph">START</code> the beginning of the workload window, and then <code class="codeph">STOP</code> at the end of the workload window.</p>
</li>
<li>
<p>Specify <code class="codeph">INTERVAL</code> and the number of minutes before statistics gathering automatically stops. If needed, you can use <code class="codeph">GATHER_SYSTEM_STATS (gathering_mode=&gt;&#39;STOP&#39;)</code> to end gathering earlier than scheduled.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__GUID-8115234C-4B34-45E8-8B30-90013DB63CE1">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN10037" target="_blank" href="../REFRN/GUID-69E45087-14DF-492B-B55A-8F2E936947A5.htm#REFRN10037"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> initialization parameter</p>
</div>
</div>
</div>
<a id="TGSQL441"></a><a id="TGSQL440"></a>
<div class="props_rev_3"><a id="GUID-90149651-4244-483C-93AF-D73387B0AF6F"></a>
<h4 id="TGSQL-GUID-90149651-4244-483C-93AF-D73387B0AF6F" class="sect4">Starting and Stopping System Statistics Gathering</h4>
<div>
<div class="section">
<p>This tutorial explains how to set the workload interval with the <code class="codeph">START</code> and <code class="codeph">STOP</code> parameters of <code class="codeph">GATHER_SYSTEM_STATS</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The hour between 10 a.m. and 11 a.m. is representative of the daily workload.</p>
</li>
<li>
<p>You intend to collect system statistics directly in the data dictionary.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To gather workload statistics using START and STOP:</p>
<ol>
<li>
<p>Start SQL*Plus and connect to the database with administrator privileges.</p>
</li>
<li>
<p>Start statistics collection.</p>
<p>For example, at 10 a.m., execute the following procedure to start collection:</p>
<pre dir="ltr">EXECUTE DBMS_STATS.GATHER_SYSTEM_STATS( gathering_mode =&gt; &#39;START&#39; );
</pre></li>
<li>
<p>Generate the workload.</p>
</li>
<li>
<p>End statistics collection.</p>
<p>For example, at 11 a.m., execute the following procedure to end collection:</p>
<pre dir="ltr">EXECUTE DBMS_STATS.GATHER_SYSTEM_STATS( gathering_mode =&gt; &#39;STOP&#39; );
</pre>
<p>The optimizer can now use the workload statistics to generate execution plans that are effective during the normal daily workload.</p>
</li>
<li>
<p>Optionally, query the system statistics.</p>
<p>For example, run the following query:</p>
<pre dir="ltr">COL PNAME FORMAT a15
SELECT PNAME, PVAL1 
FROM   SYS.AUX_STATS$ 
WHERE  SNAME = &#39;SYSSTATS_MAIN&#39;;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-90149651-4244-483C-93AF-D73387B0AF6F__GUID-46EBADD8-AABF-4511-BAD0-1699E46D1DD7">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68580" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68580"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL94867"></a><a id="TGSQL94866"></a>
<div class="props_rev_3"><a id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712"></a>
<h4 id="TGSQL-GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712" class="sect4">Gathering System Statistics During a Specified Interval</h4>
<div>
<p>This tutorial explains how to set the workload interval with the <code class="codeph">INTERVAL</code> parameter of <code class="codeph">GATHER_SYSTEM_STATS</code>.</p>
<div class="section">
<p class="subhead3">Assumptions</p>
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The database application processes OLTP transactions during the day and runs OLAP reports at night. To gather representative statistics, you collect them during the day for two hours and then at night for two hours.</p>
</li>
<li>
<p>You want to store statistics in a table named <code class="codeph">workload_stats</code>.</p>
</li>
<li>
<p>You intend to switch between the statistics gathered.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To gather workload statistics using INTERVAL:</p>
<ol>
<li>
<p>Start SQL*Plus and connect to the production database as administrator <code class="codeph">dba1</code>.</p>
</li>
<li>
<p>Create a table to hold the production statistics.</p>
<p>For example, execute the following PL/SQL program to create user statistics table <code class="codeph">workload_stats</code>:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.CREATE_STAT_TABLE (
      ownname  =&gt;  &#39;dba1&#39;
,     stattab  =&gt;  &#39;workload_stats&#39;
);
END;
/
</pre></li>
<li>
<p>Ensure that <code class="codeph">JOB_QUEUE_PROCESSES</code> is not <code class="codeph">0</code> so that <code class="codeph">DBMS_JOB</code> jobs and Oracle Scheduler jobs run.</p>
<pre dir="ltr">ALTER SYSTEM SET JOB_QUEUE_PROCESSES = 1;
</pre></li>
<li>
<p>Gather statistics during the day.</p>
<p>For example, gather statistics for two hours with the following program:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.GATHER_SYSTEM_STATS ( 
      interval  =&gt;  120
,     stattab   =&gt; &#39;workload_stats&#39;
,     statid    =&gt; &#39;OLTP&#39; 
);
END;
/
</pre></li>
<li>
<p>Gather statistics during the evening.</p>
<p>For example, gather statistics for two hours with the following program:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.GATHER_SYSTEM_STATS (
      interval  =&gt;  120
,     stattab   =&gt; &#39;workload_stats&#39; 
,     statid    =&gt; &#39;OLAP&#39; 
);
END;
/
</pre></li>
<li>
<p>In the day or evening, import the appropriate statistics into the data dictionary.</p>
<p>For example, during the day you can import the OLTP statistics from the staging table into the dictionary with the following program:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.IMPORT_SYSTEM_STATS (
      stattab  =&gt;  &#39;workload_stats&#39;
,     statid   =&gt;  &#39;OLTP&#39; 
);
END;
/
</pre>
<p>For example, during the night you can import the OLAP statistics from the staging table into the dictionary with the following program:</p>
<pre dir="ltr">BEGIN
  DBMS_STATS.IMPORT_SYSTEM_STATS (
      stattab  =&gt;  &#39;workload_stats&#39;
,     statid   =&gt;  &#39;OLAP&#39; 
);
END;
/
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712__GUID-35BA840C-6FAD-49CA-9F50-DC3C42B7CA6F">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68580" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68580"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="TGSQL94923"></a><a id="TGSQL443"></a>
<div class="props_rev_3"><a id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D"></a>
<h3 id="TGSQL-GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D" class="sect3">Gathering Noworkload Statistics</h3>
<div>
<div class="section">
<p>Noworkload statistics capture characteristics of the I/O system. By default, Oracle Database uses noworkload statistics and the CPU cost model. The values of noworkload statistics are initialized to defaults at the first instance startup. You can also use the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure to gather noworkload statistics manually.</p>
<p>Noworkload statistics include the following system statistics listed in <a href="tgsql_stats.htm#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG" title="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered.">Table 12-5</a>:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>I/O transfer speed (<code class="codeph">iotfrspeed</code>)</p>
</li>
<li>
<p>I/O seek time (<code class="codeph">ioseektim</code>)</p>
</li>
<li>
<p>CPU speed (<code class="codeph">cpuspeednw</code>)</p>
</li>
</ul>
<p>The major difference between workload statistics and noworkload statistics is in the gathering method. Noworkload statistics gather data by submitting random reads against all data files, whereas workload statistics uses counters updated when database activity occurs. If you gather workload statistics, then Oracle Database uses them instead of noworkload statistics.</p>
<p>To gather noworkload statistics, run <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> with no arguments or with the gathering mode set to <code class="codeph">noworkload</code>. There is an overhead on the I/O system during the gathering process of noworkload statistics. The gathering process may take from a few seconds to several minutes, depending on I/O performance and database size.</p>
<p>When you gather noworkload statistics, the database analyzes the information and verifies it for consistency. In some cases, the values of noworkload statistics may retain their default values. You can either gather the statistics again, or use <code class="codeph">SET_SYSTEM_STATS</code> to set the values manually to the I/O system specifications.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes that you want to gather noworkload statistics manually.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To gather noworkload statistics manually:</p>
<ol>
<li>
<p>Start SQL*Plus and connect to the database with administrator privileges.</p>
</li>
<li>
<p>Gather the noworkload statistics.</p>
<p>For example, run the following statement:</p>
<pre dir="ltr">BEGIN 
  DBMS_STATS.GATHER_SYSTEM_STATS ( 
    gathering_mode =&gt; &#39;NOWORKLOAD&#39; 
);
END;
</pre></li>
<li>
<p>Optionally, query the system statistics.</p>
<p>For example, run the following query:</p>
<pre dir="ltr">COL PNAME FORMAT a15

SELECT PNAME, PVAL1 
FROM   SYS.AUX_STATS$
WHERE  SNAME = &#39;SYSSTATS_MAIN&#39;;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D__GUID-1C7D5E35-0067-4EB7-ABE0-7FCD67393FC4">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68580" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68580"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="TGSQL448"></a><a id="TGSQL447"></a>
<div class="props_rev_3"><a id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878"></a>
<h3 id="TGSQL-GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878" class="sect3">Deleting System Statistics</h3>
<div>
<div class="section">
<p>Use the <code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code> function to delete system statistics. This procedure deletes workload statistics collected using the <code class="codeph">INTERVAL</code> or <code class="codeph">START</code> and <code class="codeph">STOP</code> options, and then resets the default to noworkload statistics. However, if the <code class="codeph">stattab</code> parameter specifies a table for storing statistics, then the subprogram deletes all system statistics with the associated <code class="codeph">statid</code> from the statistics table.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Assumptions</p>
</div>
<!-- class="section" -->
<div class="section">
<p>This tutorial assumes the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You gathered statistics for a specific intensive workload, but no longer want the optimizer to use these statistics.</p>
</li>
<li>
<p>You stored workload statistics in the default location, not in a user-specified table.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To delete system statistics:</p>
<ol>
<li>
<p>Start SQL*Plus and connect to the database as a user with administrative privileges.</p>
</li>
<li>
<p>Delete the system statistics.</p>
<p>For example, run the following statement:</p>
<pre dir="ltr">EXEC DBMS_STATS.DELETE_SYSTEM_STATS;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878__GUID-EF6DCCF2-2D0E-466B-B801-2D684CE8A023">
<p class="notep1">See Also:</p>
<p><a class="olink ARPLS68528" target="_blank" href="../ARPLS/d_stats.htm#ARPLS68528"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code> procedure</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4801">
<tr>
<td class="cellalignment4834">
<table class="cellalignment4806">
<tr>
<td class="cellalignment4805"><a href="tgsql_histo.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4805"><a href="tgsql_astat.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4836">
<table class="cellalignment4804">
<tr>
<td class="cellalignment4805"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4805"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4805"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4805"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4805"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4805"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>