<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-92000"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Performing%20Role%20Transitions%20Using%20Old%20Syntax"></a><title>Performing Role Transitions Using Old Syntax</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="troubleshooting, last redo data was not transmitted, archived redo log files, troubleshooting switchover problems, switchovers, seeing if the last archived redo log file was transmitted, switchovers, ORA-01102 message, fails with ORA-01102, ORA-01102 message, causing switchover failures, roll back and start over, starting over, rollback, after switchover failures"/>
<meta name="dcterms.created" content="2017-07-21T12:09:00Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Data Guard Concepts and Administration"/>
<meta name="dcterms.identifier" content="E48552-08"/>
<meta name="dcterms.isVersionOf" content="SBYDB"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1999, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="trace.htm" title="Previous" type="text/html"/>
<link rel="Next" href="index.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E48552-08.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-6E78412B-8E55-4D8B-A318-9F0612376E86"></a> <span id="PAGE" style="display:none;">34/35</span> <!-- End Header -->
<a id="SBYDB5172"></a>
<h1 id="SBYDB-GUID-6E78412B-8E55-4D8B-A318-9F0612376E86" class="sect1"><span class="enumeration_chapter">G</span> Performing Role Transitions Using Old Syntax</h1>
<div>
<p>Prior to<a id="d64883e68" class="indexterm-anchor"></a><a id="d64883e72" class="indexterm-anchor"></a> Oracle Database 12<span class="italic">c</span> Release 1 (12.1), the procedures for performing switchovers and failovers to a physical standby database were different. These procedures are still supported, but Oracle recommends you use the new procedures described in <span class="q">&#34;<a href="role_management.htm#GUID-857F6F45-DC1C-4345-BD39-F3BE7D79F1CD">Role Transitions Involving Physical Standby Databases</a>&#34;</span>.</p>
<p>If you are using a release prior to Oracle Database 12<span class="italic">c</span> Release 1 (12.1), then you must use the old procedures.</p>
<p>The following topics are discussed:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="pre12_role_trans.htm#GUID-EEBC6DA6-E192-470E-8FC9-F507B004406E">SQL Syntax for Role Transitions Involving Physical Standbys</a></p>
</li>
<li>
<p><a href="pre12_role_trans.htm#GUID-F4A18A3A-6308-4580-B1F3-9647E2669BA0">Role Transitions Involving Physical Standby Databases</a></p>
</li>
<li>
<p><a href="pre12_role_trans.htm#GUID-E80C5A58-6D05-4281-81DB-6268EE1757AC">Troubleshooting Switchovers to Physical Standby Databases</a></p>
</li>
</ul>
</div>
<a id="SBYDB5173"></a>
<div class="props_rev_3"><a id="GUID-EEBC6DA6-E192-470E-8FC9-F507B004406E"></a>
<h2 id="SBYDB-GUID-EEBC6DA6-E192-470E-8FC9-F507B004406E" class="sect2"><span class="enumeration_section">G.1</span> SQL Syntax for Role Transitions Involving Physical Standbys</h2>
<div>
<div class="section">
<p>Oracle Database 12<span class="italic">c</span> Release 1 (12.1) introduces new SQL syntax for performing switchover and failover operations to a physical standby database. Do not mix syntax from the old procedures (described in this topic) and the new procedures (described in <a href="role_management.htm#GUID-44F26D5F-E036-4ACD-B8F0-224F5498FBCE">Role Transitions</a>), unless you are specifically directed to do so.</p>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-EEBC6DA6-E192-470E-8FC9-F507B004406E__GUID-349730FC-DE8C-4853-93FD-FE4C7D54F254">
<table class="cellalignment2269" summary="This table describes differences in role transition SQL syntax for physical standby databases between Oracle Database 12c and earlier releases. There are two columns and two rows, excluding the header row.">
<thead>
<tr class="cellalignment2253">
<th class="cellalignment2265" id="d64883e191">Pre-12c Role Transition Syntax for Physical Standby Databases</th>
<th class="cellalignment2284" id="d64883e194">12c Role Transition Syntax for Physical Standby Databases</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2253">
<td class="cellalignment2268" id="d64883e199" headers="d64883e191">
<p>To switchover to a physical standby database, on the primary database:</p>
<p><code class="codeph">SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO PHYSICAL STANDBY;</code></p>
<p>On the physical standby database:</p>
<p><code class="codeph">SQL&gt;ALTER DATABASE COMMIT TO SWITCHOVER TO PRIMARY;</code></p>
</td>
<td class="cellalignment2285" headers="d64883e199 d64883e194">
<p>To switchover to a physical standby database:</p>
<p><code class="codeph">SQL&gt; ALTER DATABASE SWITCHOVER TO</code> <span class="italic"><code class="codeph">target_db_name</code></span> <code class="codeph">[FORCE] [VERIFY]</code>;</p>
</td>
</tr>
<tr class="cellalignment2253">
<td class="cellalignment2268" id="d64883e226" headers="d64883e191">
<p>To failover to a physical standby database, (step 6 and step 8 in <span class="q">&#34;<a href="pre12_role_trans.htm#GUID-AAAA9A3B-7A1A-4044-90EC-F581D87439F4">Performing a Failover to a Physical Standby Database Using Old Syntax</a>&#34;</span>):</p>
<p><code class="codeph">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE FINISH</code>;</p>
<p>and</p>
<p><code class="codeph">SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO PRIMARY</code>;</p>
</td>
<td class="cellalignment2285" headers="d64883e226 d64883e194">
<p>To failover to a physical standby database, the following statement replaces the two statements previously required:</p>
<p><code class="codeph">SQL&gt; ALTER DATABASE FAILOVER TO</code> <span class="italic"><code class="codeph">target_db_name</code></span>;</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-EEBC6DA6-E192-470E-8FC9-F507B004406E__GUID-B2FCFA5C-0E56-4CCF-8F16-796025E17534">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink SQLRF00802" target="_blank" href="../SQLRF/statements_1006.htm#SQLRF00802"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about SQL syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
<a id="SBYDB5212"></a>
<div class="props_rev_3"><a id="GUID-C1E83316-FD7F-4944-8CC8-784A37172B95"></a>
<h3 id="SBYDB-GUID-C1E83316-FD7F-4944-8CC8-784A37172B95" class="sect3"><span class="enumeration_section">G.1.1</span> New Features When Using the Old Syntax</h3>
<div>
<p>As of Oracle Database 12<span class="italic">c</span> Release 1 (12.1), you can issue the following statement without having to include the <code class="codeph">WITH SESSION SHUTDOWN</code> clause:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO PHYSICAL STANDBY;
</pre>
<p>This statement results in active SQL sessions being killed automatically. The <code class="codeph">WITH SESSION SHUTDOWN</code> clause is no longer needed to kill active SQL sessions.</p>
<p>Additionally, when you perform a switchover from an Oracle RAC primary database to a physical standby database, it is no longer necessary to shut down all but one primary database instance. All the instances are shut down automatically after the switchover is complete.</p>
</div>
</div>
</div>
<a id="SBYDB5174"></a>
<div class="props_rev_3"><a id="GUID-F4A18A3A-6308-4580-B1F3-9647E2669BA0"></a>
<h2 id="SBYDB-GUID-F4A18A3A-6308-4580-B1F3-9647E2669BA0" class="sect2"><span class="enumeration_section">G.2</span> Role Transitions Involving Physical Standby Databases</h2>
<div>
<p>The following sections describe how to perform switchovers and failovers to a physical standby database using SQL syntax that was in place in releases prior to Oracle Database 12<span class="italic">c</span> Release 1 (12.1).</p>
<p>These are the procedures that must be used if you are running a release prior to 12.1:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="pre12_role_trans.htm#GUID-65C1BE5E-A2AC-4938-B03F-2495761DE500">Performing a Switchover to a Physical Standby Database Using Old Syntax</a></p>
</li>
<li>
<p><a href="pre12_role_trans.htm#GUID-AAAA9A3B-7A1A-4044-90EC-F581D87439F4">Performing a Failover to a Physical Standby Database Using Old Syntax</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-F4A18A3A-6308-4580-B1F3-9647E2669BA0__GUID-A22A4754-4421-4575-B7FD-63539F50F536">
<p class="notep1">See Also:</p>
<p><a href="role_management.htm#GUID-44F26D5F-E036-4ACD-B8F0-224F5498FBCE">Role Transitions</a> for information about how to prepare for switchovers and failovers</p>
</div>
</div>
<a id="SBYDB5175"></a>
<div class="props_rev_3"><a id="GUID-65C1BE5E-A2AC-4938-B03F-2495761DE500"></a>
<h3 id="SBYDB-GUID-65C1BE5E-A2AC-4938-B03F-2495761DE500" class="sect3"><span class="enumeration_section">G.2.1</span> Performing a Switchover to a Physical Standby Database Using Old Syntax</h3>
<div>
<div class="section">
<p>This section describes how to perform a switchover to a physical standby database. A switchover is initiated on the primary database and is completed on the target standby database.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Verify that the primary database can be switched to the standby role.</span>
<div>
<p>Query the <code class="codeph">SWITCHOVER_STATUS</code> column of the <code class="codeph">V$DATABASE</code> view on the primary database. For example:</p>
<pre dir="ltr">SQL&gt; SELECT SWITCHOVER_STATUS FROM V$DATABASE;

SWITCHOVER_STATUS 
 ----------------- 
 TO STANDBY 
 1 row selected 
</pre>
<p>A value of <code class="codeph">TO STANDBY</code> or <code class="codeph">SESSIONS ACTIVE</code> indicates that the primary database can be switched to the standby role. If neither of these values is returned, a switchover is not possible because redo transport is either misconfigured or is not functioning properly. See <a href="log_transport.htm#GUID-0EC71C7D-A80B-40AA-93E5-28BB7E24ED31">Redo Transport Services</a> for information about configuring and monitoring redo transport.</p>
</div>
</li>
<li class="stepexpand"><span>Issue the following SQL statement on the primary database to switch it to the standby role: Issue the following SQL statement on the primary database to switch it to the standby role:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO PHYSICAL STANDBY;
</pre>
<p>This statement converts the primary database into a physical standby database. The current control file is backed up to the current SQL session trace file before the switchover. This makes it possible to reconstruct a current control file, if necessary.</p>
</div>
</li>
<li class="stepexpand"><span>Mount the former primary database. For example: For example:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP MOUNT;
</pre>
<p>At this point in the switchover process, the original primary database is a physical standby database.</p>
</div>
</li>
<li class="stepexpand"><span>Query the <code class="codeph">SWITCHOVER_STATUS</code> column of the <code class="codeph">V$DATABASE</code> view on the standby database to verify that the switchover target is ready to be switched to the primary role. For example:</span>
<div>
<pre dir="ltr">SQL&gt; SELECT SWITCHOVER_STATUS FROM V$DATABASE;

SWITCHOVER_STATUS 
----------------- 
TO PRIMARY 
1 row selected
</pre>
<p>A value of <code class="codeph">TO PRIMARY</code> or <code class="codeph">SESSIONS ACTIVE</code> indicates that the standby database is ready to be switched to the primary role. If neither of these values is returned, verify that Redo Apply is active and that redo transport is configured and working properly. Continue to query this column until the value returned is either <code class="codeph">TO PRIMARY</code> or <code class="codeph">SESSIONS ACTIVE</code>.</p>
</div>
</li>
<li class="stepexpand"><span>Issue the following SQL statement on the target physical standby database to switch it to the primary role:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO PRIMARY WITH SESSION SHUTDOWN;
</pre>
<div class="infobox-note" id="GUID-65C1BE5E-A2AC-4938-B03F-2495761DE500__GUID-99B34AA8-C099-4292-8BDD-B2E2EA023838">
<p class="notep1">Note:</p>
<p>The <code class="codeph">WITH SESSION SHUTDOWN</code> clause can be omitted from the switchover statement if the query performed in step 4 returned a value of <code class="codeph">TO PRIMARY</code>.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Open the new primary database:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE OPEN;
</pre></div>
</li>
<li class="stepexpand"><span>Start Redo Apply on the new physical standby database:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE -
&gt; DISCONNECT FROM SESSION;
</pre></div>
</li>
<li class="stepexpand"><span>Restart Redo Apply if it has stopped at any of the other physical standby databases in your Oracle Data Guard configuration:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE -
&gt; DISCONNECT FROM SESSION;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="SBYDB5184"></a>
<div class="props_rev_3"><a id="GUID-AAAA9A3B-7A1A-4044-90EC-F581D87439F4"></a>
<h3 id="SBYDB-GUID-AAAA9A3B-7A1A-4044-90EC-F581D87439F4" class="sect3"><span class="enumeration_section">G.2.2</span> Performing a Failover to a Physical Standby Database Using Old Syntax</h3>
<div>
<div class="section">
<p>This section describes how to perform a failover to a physical standby database.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>If possible, mount the primary database and flush any unsent archived and current redo from the primary database to the standby database. If this operation is successful, a zero data loss failover is possible even if the primary database is not in a zero data loss data protection mode.</span>
<div>
<p>Ensure that Redo Apply is active at the target standby database.</p>
<p>Mount, but do not open, the primary database. If the primary database cannot be mounted, go to step 2.</p>
<p>Issue the following SQL statement at the primary database:</p>
<pre dir="ltr">SQL&gt; ALTER SYSTEM FLUSH REDO TO <span class="italic">target_db_name</span>;
</pre>
<p>For <span class="italic"><code class="codeph">target_db_name</code></span>, specify the <code class="codeph">DB_UNIQUE_NAME</code> of the standby database that is to receive the redo flushed from the primary database.</p>
<p>This statement flushes any unsent redo from the primary database to the standby database, and waits for that redo to be applied to the standby database.</p>
<p>If this statement completes without any errors, go to step 5. If the statement completes with any errors, or if it must be stopped because you cannot wait any longer for the statement to complete, continue with step 2.</p>
</div>
</li>
<li class="stepexpand"><span>Verify that the standby database has the most recently archived redo log file for each primary database redo thread.</span>
<div>
<p>To do this, query the <code class="codeph">V$ARCHIVED_LOG</code> view on the target standby database to obtain the highest log sequence number for each redo thread.</p>
<p>For example:</p>
<pre dir="ltr">SQL&gt; SELECT UNIQUE THREAD# AS THREAD, MAX(SEQUENCE#) -
&gt; OVER (PARTITION BY thread#) AS LAST from V$ARCHIVED_LOG;

    THREAD       LAST
---------- ----------
         1        100
</pre>
<p>If possible, copy the most recently archived redo log file for each primary database redo thread to the standby database if it does not exist there, and register it. This must be done for each redo thread.</p>
<p>For example:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE REGISTER PHYSICAL LOGFILE &#39;filespec1&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>Query the <code class="codeph">V$ARCHIVE_GAP</code> view on the target standby database to determine if there are any redo gaps on the target standby database.</span>
<div>
<p>For example:</p>
<pre dir="ltr">SQL&gt; SELECT THREAD#, LOW_SEQUENCE#, HIGH_SEQUENCE# FROM V$ARCHIVE_GAP;

THREAD#    LOW_SEQUENCE# HIGH_SEQUENCE#
---------- ------------- --------------
         1            90             92
</pre>
<p>In this example, the gap comprises archived redo log files with sequence numbers 90, 91, and 92 for thread 1.</p>
<p>If possible, copy any missing archived redo log files to the target standby database from the primary database and register them at the target standby database. This must be done for each redo thread.</p>
<p>For example:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE REGISTER PHYSICAL LOGFILE &#39;filespec1&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>Repeat step 3 until all gaps are resolved. (The query executed in step 3 displays information for the highest gap only, so after resolving a gap, you must repeat the query until no more rows are returned.)</span>
<div>
<p>If, after performing steps 2 through step 4, you are not able to resolve all gaps in the archived redo log files (for example, because you do not have access to the system that hosted the failed primary database), then some data loss will occur during the failover.</p>
</div>
</li>
<li class="stepexpand"><span>Issue the following SQL statement on the target standby database to stop Redo Apply:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE CANCEL;
</pre></div>
</li>
<li class="stepexpand"><span>Finish applying all received redo data:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE FINISH;
</pre>
<p>If this statement completes without any errors, then proceed to step 7.</p>
<p>If an error occurs, some received redo data was not applied. Try to resolve the cause of the error and reissue the statement before proceeding to the next step.</p>
<p>If there is a redo gap that was not resolved in step 3 and step 4, then you receive an error stating that there is a redo gap.</p>
<p>If the error condition cannot be resolved, a failover can still be performed (with some data loss) by issuing the following SQL statement on the target standby database:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE ACTIVATE PHYSICAL STANDBY DATABASE;
</pre>
<p>Proceed to step 9 when the <code class="codeph">ACTIVATE</code> statement completes.</p>
</div>
</li>
<li class="stepexpand"><span>Verify that the target standby database is ready to become a primary database.</span>
<div>
<p>To do this, query the <code class="codeph">SWITCHOVER_STATUS</code> column of the <code class="codeph">V$DATABASE</code> view on the target standby database. For example:</p>
<pre dir="ltr">SQL&gt; SELECT SWITCHOVER_STATUS FROM V$DATABASE;

SWITCHOVER_STATUS
-----------------
TO PRIMARY
1 row selected
</pre>
<p>A value of either <code class="codeph">TO PRIMARY</code> or <code class="codeph">SESSIONS ACTIVE</code> indicates that the standby database is ready to be switched to the primary role. If neither of these values is returned, verify that Redo Apply is active and continue to query this view until either <code class="codeph">TO PRIMARY</code> or <code class="codeph">SESSIONS ACTIVE</code> is returned.</p>
</div>
</li>
<li class="stepexpand"><span>Issue the following SQL statement on the target standby database to switch the physical standby to the primary role:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO PRIMARY WITH SESSION SHUTDOWN;
</pre>
<div class="infobox-note" id="GUID-AAAA9A3B-7A1A-4044-90EC-F581D87439F4__GUID-EC00BDBC-06A6-4AD6-9F3B-C0843A933015">
<p class="notep1">Note:</p>
<p>The <code class="codeph">WITH SESSION SHUTDOWN</code> clause can be omitted from the switchover statement if the query of the <code class="codeph">SWITCHOVER_STATUS</code> column performed in the previous step returned a value of <code class="codeph">TO PRIMARY</code>.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Open the new primary database:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE OPEN;
</pre></div>
</li>
<li class="stepexpand"><span>Oracle recommends that you now back up the new primary database.</span></li>
<li class="stepexpand"><span>Restart Redo Apply if it has stopped at any of the other physical standby databases in your Oracle Data Guard configuration:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE -
&gt; DISCONNECT FROM SESSION;
</pre></div>
</li>
<li class="stepexpand"><span>Optionally, restore the failed primary database.</span>
<div>
<p>After a failover, the original primary database can be converted into a physical standby database of the new primary database using the method described in <a href="scenarios.htm#GUID-1163448F-6B18-4A44-AA8D-7CDF0D1360FB">Converting a Failed Primary Into a Standby Database Using Flashback Database</a> or <a href="scenarios.htm#GUID-B734C79F-A2BB-43A5-89D7-7733089FB577">Converting a Failed Primary into a Standby Database Using RMAN Backups</a>, or it can be re-created as a physical standby database from a backup of the new primary database using the method described in <a href="create_ps.htm#GUID-A86D403B-B3F5-4B05-9255-5BADD513F9CF">Step-by-Step Instructions for Creating a Physical Standby Database</a>.</p>
<p>Once the original primary database is running in the standby role, a switchover can be performed to restore it to the primary role.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="SBYDB5205"></a>
<div class="props_rev_3"><a id="GUID-E80C5A58-6D05-4281-81DB-6268EE1757AC"></a>
<h2 id="SBYDB-GUID-E80C5A58-6D05-4281-81DB-6268EE1757AC" class="sect2"><span class="enumeration_section">G.3</span> Troubleshooting Switchovers to Physical Standby Databases</h2>
<div>
<p>If a switchover is unsuccessful, the following topics may help you to resolve the problem:</p>
<div class="infobox-note" id="GUID-E80C5A58-6D05-4281-81DB-6268EE1757AC__GUID-DBF51E79-DDB2-46AF-BEA8-FD655BE3F528">
<p class="notep1">Note:</p>
<p>The following troubleshooting topics apply only when you are performing switchovers and failovers to a physical standby database using procedures available in releases prior to Oracle Database 12c Release 1 (12.1).</p>
</div>
<ul style="list-style-type: disc;">
<li>
<p><a href="pre12_role_trans.htm#GUID-9D024B1F-54EF-4C95-A810-1FA09B7AE3E4">Switchover Fails Because Redo Data Was Not Transmitted</a></p>
</li>
<li>
<p><a href="pre12_role_trans.htm#GUID-A9CF13FE-3E89-4FB3-B2BF-6536DCAD3ADB">Switchover Fails with the ORA-01102 Error</a></p>
</li>
<li>
<p><a href="pre12_role_trans.htm#GUID-F394098F-8726-45AC-A66F-B91402719D6A">Redo Data Is Not Applied After Switchover</a></p>
</li>
<li>
<p><a href="pre12_role_trans.htm#GUID-2CF7243A-24DA-42CB-86C7-D48E648D9F5D">Roll Back After Unsuccessful Switchover and Start Over</a></p>
</li>
</ul>
</div>
<a id="SBYDB5206"></a>
<div class="props_rev_3"><a id="GUID-9D024B1F-54EF-4C95-A810-1FA09B7AE3E4"></a>
<h3 id="SBYDB-GUID-9D024B1F-54EF-4C95-A810-1FA09B7AE3E4" class="sect3"><span class="enumeration_section">G.3.1</span> Switchover Fails Because Redo Data Was Not Transmitted</h3>
<div>
<div class="section">
<p>If the switchover does not complete successfully, you can query the <code class="codeph">SEQUENCE#</code> column in the <code class="codeph">V$ARCHIVED_LOG</code> view to see if the last redo data transmitted from the original primary database was applied on the standby database. If the last redo data was not transmitted to the standby database, you can manually copy the archived redo log file containing the redo data from the original primary database to the old standby database and register it with the S<a id="d64883e1055" class="indexterm-anchor"></a><a id="d64883e1059" class="indexterm-anchor"></a>QL <code class="codeph">ALTER DATABASE REGISTER LOGFILE</code> <span class="variable">file_specification</span> statement. If you then start apply services, the archived redo log file is applied automatically. Query the <code class="codeph">SWITCHOVER_STATUS</code> column in the <code class="codeph">V$DATABASE</code> view. A switchover to the primary role is now possible if the <code class="codeph">SWITCHOVER_STATUS</code> column returns <code class="codeph">TO PRIMARY</code> or <code class="codeph">SESSIONS ACTIVE</code>:</p>
<pre dir="ltr">SQL&gt; SELECT SWITCHOVER_STATUS FROM V$DATABASE;

SWITCHOVER_STATUS 
----------------- 
TO PRIMARY 
1 row selected 
</pre>
<p>See <a href="views.htm#GUID-FF72163C-78B0-475F-B4CE-135EF288A32A">Views Relevant to Oracle Data Guard</a> for information about other valid values for the <code class="codeph">SWITCHO</code><a id="d64883e1096" class="indexterm-anchor"></a><a id="d64883e1100" class="indexterm-anchor"></a><code class="codeph">VER_STATUS</code> column of the <code class="codeph">V$DATABASE</code> view.</p>
<p>To continue with the switchover, follow the instructions in <a href="pre12_role_trans.htm#GUID-65C1BE5E-A2AC-4938-B03F-2495761DE500">Performing a Switchover to a Physical Standby Database Using Old Syntax</a> and try again to switch the target standby database to the primary role.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="SBYDB5209"></a>
<div class="props_rev_3"><a id="GUID-A9CF13FE-3E89-4FB3-B2BF-6536DCAD3ADB"></a>
<h3 id="SBYDB-GUID-A9CF13FE-3E89-4FB3-B2BF-6536DCAD3ADB" class="sect3"><span class="enumeration_section">G.3.2</span> Switchover Fails with the ORA-01102 Error</h3>
<div>
<div class="section">
<p>Suppose the standby database and the primary database reside on the same site. After both the <a id="d64883e1203" class="indexterm-anchor"></a><a id="d64883e1209" class="indexterm-anchor"></a><code class="codeph">ALTER DATABASE COMMIT TO SWITCHOVER TO PHYSICAL</code> <code class="codeph">STANDBY</code> and the <code class="codeph">ALTER DATABASE COMMIT TO SWITCHOVER TO PRIMARY</code> statements are successfully executed, shut down and restart the physical standby database and the primary database.</p>
<div class="infobox-note" id="GUID-A9CF13FE-3E89-4FB3-B2BF-6536DCAD3ADB__GUID-5C2C8B82-FAE1-40CA-A092-4D530FE8A728">
<p class="notep1">Note:</p>
<p>It is not necessary to shut down and restart the physical standby database if it has not been opened read-only since the instance was started.</p>
</div>
<p>However, the startup of the second database fails with an <code class="codeph">ORA-01102 cannot mount database in EXCLUSIVE mode</code> error.</p>
<p>This could happen during the switchover if you did not set the <code class="codeph">DB_UNIQUE_NAME</code> parameter in the initialization parameter file that is used by the standby database (the original primary database). If the <a id="d64883e1237" class="indexterm-anchor"></a><a id="d64883e1241" class="indexterm-anchor"></a><code class="codeph">DB_UNIQUE_NAME</code> parameter of the standby database is not set, the standby and the primary databases both use the same mount lock and cause the ORA-01102 error during the startup of the second database.</p>
<p>Action: Add <code class="codeph">DB_UNIQUE_NAME=</code><span class="italic"><code class="codeph">unique_database_name</code></span> to the initialization parameter file used by the standby database, and shut down and restart the standby and primary databases.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="SBYDB5210"></a>
<div class="props_rev_3"><a id="GUID-F394098F-8726-45AC-A66F-B91402719D6A"></a>
<h3 id="SBYDB-GUID-F394098F-8726-45AC-A66F-B91402719D6A" class="sect3"><span class="enumeration_section">G.3.3</span> Redo Data Is Not Applied After Switchover</h3>
<div>
<div class="section">
<p>The archived redo log files are not applied to the new standby database after the switchover.</p>
<p>This might happen because some environment or initialization parameters were not properly set after the switchover.</p>
<p>Action:</p>
<ul style="list-style-type: disc;">
<li>
<p>Check the <a id="d64883e1334" class="indexterm-anchor"></a><a id="d64883e1338" class="indexterm-anchor"></a><code class="codeph">tnsnames.ora</code> file at the new primary site and the <code class="codeph">listener.ora</code> file at the new standby site. There should be entries for a listener at the standby site and a corresponding service name at the primary site.</p>
</li>
<li>
<p>Start the listener at the standby site if it has not been started.</p>
</li>
<li>
<p>Check if the <code class="codeph">LOG_ARCHIVE_DEST_</code><span class="italic"><code class="codeph">n</code></span> initialization parameter was set to properly transmit redo data from the primary site to the standby site. For example, query the <code class="codeph">V$ARCHIVE_DEST</code> fixed view at the primary site as follows:</p>
<pre dir="ltr">SQL&gt; SELECT DEST_ID, STATUS, DESTINATION FROM V$ARCHIVE_DEST;
</pre>
<p>If you do not see an entry corresponding to the standby site, you need to set <code class="codeph">LOG_ARCHIVE_DEST_</code><span class="italic"><code class="codeph">n</code></span> and <code class="codeph">LOG_ARCHIVE_DEST_STATE_</code><span class="italic"><code class="codeph">n</code></span> initialization parameters.</p>
</li>
<li>
<p>Set the <code class="codeph">STANDBY_ARCHIVE_DEST</code> and <code class="codeph">LOG_ARCHIVE_FORMAT</code> initialization parameters correctly at the standby site so that the archived redo log files are applied to the desired location. (Note that the <code class="codeph">STANDBY_ARCHIVE_DEST</code> parameter has been deprecated and is supported for backward compatibility only.)</p>
</li>
<li>
<p>At the standby site, set the<a id="d64883e1394" class="indexterm-anchor"></a><a id="d64883e1398" class="indexterm-anchor"></a> <code class="codeph">DB_FILE_NAME_CONVERT</code> and<a id="d64883e1406" class="indexterm-anchor"></a><a id="d64883e1410" class="indexterm-anchor"></a> <code class="codeph">LOG_FILE_NAME_CONVERT</code> initialization parameters. Set the <code class="codeph">STANDBY_FILE_MANAGEMENT</code> initialization parameter to <code class="codeph">AUTO</code> to enable the standby site to automatically add new data files that are created at the primary site.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
<a id="SBYDB5211"></a>
<div class="props_rev_3"><a id="GUID-2CF7243A-24DA-42CB-86C7-D48E648D9F5D"></a>
<h3 id="SBYDB-GUID-2CF7243A-24DA-42CB-86C7-D48E648D9F5D" class="sect3"><span class="enumeration_section">G.3.4</span> Roll Back After Unsuccessful Switchover and Start Over</h3>
<div>
<div class="section">
<p>For physical standby databases in situations where an error occurred and it is not possible to continue with the switchover, it might still be possible to revert the new physical standby database back to the primary role by using the following steps. (This functionality is available starting with Oracle Database 11<span class="italic">g</span> Release 2 (11.2.0.2).)</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Shut down and mount the new standby database (old primary).</span></li>
<li class="stepexpand"><span>Start Redo Apply on the new standby database.</span></li>
<li class="stepexpand"><span>Verify that the new standby database is ready to be switched back to the primary role. Query the <code class="codeph">SWITCHOVER_STATUS</code> column of the <code class="codeph">V$DATABASE</code> view on the new standby database. For example:</span>
<div>
<pre dir="ltr">SQL&gt; SELECT SWITCHOVER_STATUS FROM V$DATABASE;
 
SWITCHOVER_STATUS 
----------------- 
TO_PRIMARY 
1 row selected
</pre>
<p>A value of <code class="codeph">TO PRIMARY</code> or <code class="codeph">SESSIONS ACTIVE</code> indicates that the new standby database is ready to be switched to the primary role. Continue to query this column until the value returned is either <code class="codeph">TO PRIMARY</code> or <code class="codeph">SESSIONS ACTIVE</code>.</p>
</div>
</li>
<li class="stepexpand"><span>Issue the following statement to convert the new standby database back to the primary role:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE COMMIT TO SWITCHOVER TO PRIMARY WITH SESSION SHUTDOWN;
</pre>
<p>If this statement is successful, the database runs in the primary database role, and you do not need to perform any more steps.</p>
<p>If this statement is unsuccessful, then continue with Step 5.</p>
</div>
</li>
<li class="stepexpand"><span>When the switchover to change the role from primary to physical standby was initiated, a trace file was written in the log directory. This trace file contains the SQL statements required to re-create the original primary control file. Locate the trace file and extract the SQL statements into a temporary file. Execute the temporary file from SQL*Plus. This reverts the new standby database back to the primary role.</span></li>
<li class="stepexpand"><span>Shut down the original physical standby database.</span></li>
<li class="stepexpand"><span>Create a new standby control file. This is necessary to resynchronize the primary database and physical standby database. Copy the physical standby control file to the original physical standby system. <a href="create_ps.htm#GUID-B471D788-AFD3-48B3-9709-D63C34DBC269">Create a Control File for the Standby Database</a> describes how to create a physical standby control file.</span></li>
<li class="stepexpand"><span>Restart the original physical standby instance.</span>
<div>
<p>If this procedure is successful and archive gap management is enabled, then the FAL processes start and re-archive any missing archived redo log files to the physical standby database. Force a log switch on the primary database and examine the alert logs on both the primary database and physical standby database to ensure the archived redo log file sequence numbers are correct.</p>
<p>See <a href="log_transport.htm#GUID-97EB433B-4125-4082-9276-2454349BC4F8">Manual Gap Resolution</a> for information about archive gap management and <a href="trace.htm#GUID-515A27B2-5163-42E1-A78D-B6E979BA54EB">Setting Archive Tracing</a> for information about locating the trace files.</p>
</div>
</li>
<li class="stepexpand"><span>Try the switchover again.</span>
<div>
<p>At this point, the Oracle Data Guard configuration has been rolled back to its initial state and you can try the switchover operation again (after correcting any problems that might have led to the initial unsuccessful switchover).</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2252">
<tr>
<td class="cellalignment2259">
<table class="cellalignment2257">
<tr>
<td class="cellalignment2256"><a href="trace.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2256"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1999, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2261">
<table class="cellalignment2255">
<tr>
<td class="cellalignment2256"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2256"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2256"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2256"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2256"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2256"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>