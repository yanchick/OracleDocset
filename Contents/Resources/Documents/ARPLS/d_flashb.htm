<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-2270"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/DBMS_FLASHBACK"></a><title>DBMS_FLASHBACK</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1086"/>
<meta name="dcterms.created" content="2016-09-02T5:36:20Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database PL/SQL Packages and Types Reference"/>
<meta name="dcterms.identifier" content="E41829-07"/>
<meta name="dcterms.isVersionOf" content="ARPLS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2016,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="d_ftran.htm" title="Previous" type="text/html"/>
<link rel="Next" href="d_flashb_archive.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41829-07.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">74/290</span> <!-- End Header -->
<div id="ARPLS142" class="chapter"><a id="CHDFBDCG"></a> <a id="i998870"></a>
<h1 class="chapter"><span class="secnum">70</span> DBMS_FLASHBACK</h1>
<p>Using <a id="sthref4394"></a><code dir="ltr">DBMS_FLASHBACK</code>, you can flash back to a version of the database at a specified time or a specified system change number (SCN).</p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
For detailed information about <code dir="ltr">DBMS_FLASHBACK</code>:
<ul>
<li>
<p><a class="olink ADFNS" href="../ADFNS/toc.htm"><span class="italic">Oracle Database Development Guide</span></a></p>
</li>
<li>
<p><a class="olink SQLRF" href="../SQLRF/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a>.</p>
</li>
</ul>
</div>
<p>This chapter contains the following topics:</p>
<ul>
<li>
<p><a href="#BGBHHJHI">Using DBMS_FLASHBACK</a></p>
<ul>
<li>
<p>Overview</p>
</li>
<li>
<p>Security Model</p>
</li>
<li>
<p>Types</p>
</li>
<li>
<p>Exceptions</p>
</li>
<li>
<p>Operational Notes</p>
</li>
<li>
<p>Examples</p>
</li>
</ul>
</li>
<li>
<p><a href="#i999159">Summary of DBMS_FLASHBACK Subprograms</a></p>
</li>
</ul>
<div class="refentry"><a id="BGBHHJHI"></a>
<div id="ARPLS66390" class="refsect1">
<h2 class="refsect1">Using DBMS_FLASHBACK</h2>
<ul>
<li>
<p><a href="#i999074">Overview</a></p>
</li>
<li>
<p><a href="#BGBCIGEA">Security Model</a></p>
</li>
<li>
<p><a href="#BABCCBCC">Types</a></p>
</li>
<li>
<p><a href="#i999094">Exceptions</a></p>
</li>
<li>
<p><a href="#i999099">Operational Notes</a></p>
</li>
<li>
<p><a href="#i996809">Examples</a></p>
</li>
</ul>
<div id="ARPLS66391" class="refsect2"><a id="i999074"></a>
<h3 class="refsect2">Overview</h3>
<p><code dir="ltr">DBMS_FLASHBACK</code> provides an interface for the user to view the database at a particular time in the past, with the additional capacity provided by transaction back out features that allow for selective removal of the effects of individual transactions. This is different from a flashback database which moves the database back in time.</p>
<p>When <code dir="ltr">DBMS_FLASHBACK</code> is enabled, the user session uses the Flashback version of the database, and applications can execute against the Flashback version of the database.</p>
<p>You may want to use <code dir="ltr">DBMS_FLASHBACK</code> for the following reasons:</p>
<ul>
<li>
<p>Self-service repair: If you accidentally delete rows from a table, you can recover the deleted rows.</p>
</li>
<li>
<p>Packaged applications such as email and voicemail: You can use Flashback to restore deleted email by re-inserting the deleted message into the current message box.</p>
</li>
<li>
<p>Decision support system (DSS) and online analytical processing (OLAP) applications: You can perform data analysis or data modeling to track seasonal demand.</p>
</li>
</ul>
</div>
<!-- class="refsect2" -->
<div id="ARPLS66392" class="refsect2"><a id="BGBCIGEA"></a>
<h3 class="refsect2">Security Model</h3>
<p>To use this package, you must have the <code dir="ltr">EXECUTE</code> privilege on it.</p>
</div>
<!-- class="refsect2" -->
<div id="ARPLS66393" class="refsect2"><a id="BABCCBCC"></a>
<h3 class="refsect2"><a id="sthref4395"></a>Types</h3>
<p>The <code dir="ltr">DBMS_FLASHBACK</code> package uses these types:</p>
<div id="ARPLS66394" class="tblformal">
<p class="titleintable"><a id="sthref4396"></a><a id="sthref4397"></a>Table 70-1 DBMS_FLASHBACK</p>
<table class="cellalignment4330" title="DBMS_FLASHBACK" summary="This table describes Types used by DBMS_FLASHBACK subprograms." dir="ltr">
<thead>
<tr class="cellalignment4321">
<th class="cellalignment4328" id="r1c1-t3">Type</th>
<th class="cellalignment4328" id="r1c2-t3">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r2c1-t3" headers="r1c1-t3">
<p><code dir="ltr">TXNAME_ARRAY</code></p>
</td>
<td class="cellalignment4329" headers="r2c1-t3 r1c2-t3">
<p>Creates a <code dir="ltr">VARRAY</code> for holding Transaction Names or Identifiers (<code dir="ltr">XID</code>s)</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" --></div>
<!-- class="refsect2" -->
<div id="ARPLS66395" class="refsect2"><a id="i999094"></a>
<h3 class="refsect2">Exceptions</h3>
<div id="ARPLS66396" class="tblformal">
<p class="titleintable"><a id="sthref4398"></a><a id="sthref4399"></a>Table 70-2 DBMS_FLASHBACK Error Messages</p>
<table class="cellalignment4330" title="DBMS_FLASHBACK Error Messages" summary="This table describes Exceptions for the DBMS_FLASHBACK package." dir="ltr">
<thead>
<tr class="cellalignment4321">
<th class="cellalignment4328" id="r1c1-t4">Error</th>
<th class="cellalignment4328" id="r1c2-t4">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r2c1-t4" headers="r1c1-t4">
<p><code dir="ltr">ORA-08180</code></p>
</td>
<td class="cellalignment4329" headers="r2c1-t4 r1c2-t4">
<p>Time specified is too old</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r3c1-t4" headers="r1c1-t4">
<p><code dir="ltr">ORA-08181</code></p>
</td>
<td class="cellalignment4329" headers="r3c1-t4 r1c2-t4">
<p>Invalid system change number specified</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r4c1-t4" headers="r1c1-t4">
<p><code dir="ltr">ORA-08182</code></p>
</td>
<td class="cellalignment4329" headers="r4c1-t4 r1c2-t4">
<p>User cannot begin read-only or serializable transactions in Flashback mode</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r5c1-t4" headers="r1c1-t4">
<p><code dir="ltr">ORA-08183</code></p>
</td>
<td class="cellalignment4329" headers="r5c1-t4 r1c2-t4">
<p>User cannot enable Flashback within an uncommitted transaction</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r6c1-t4" headers="r1c1-t4">
<p><code dir="ltr">ORA-08184</code></p>
</td>
<td class="cellalignment4329" headers="r6c1-t4 r1c2-t4">
<p>User cannot enable Flashback within another Flashback session</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r7c1-t4" headers="r1c1-t4">
<p><code dir="ltr">ORA-08185</code></p>
</td>
<td class="cellalignment4329" headers="r7c1-t4 r1c2-t4">
<p><code dir="ltr">SYS</code> cannot enable Flashback mode</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" --></div>
<!-- class="refsect2" -->
<div id="ARPLS66397" class="refsect2"><a id="i999099"></a>
<h3 class="refsect2">Operational Notes</h3>
<p><code dir="ltr">DBMS_FLASHBACK</code> is automatically turned off when the session ends, either by disconnection or by starting another connection.</p>
<p>PL/SQL cursors opened in Flashback mode return rows as of the flashback time or SCN. Different concurrent sessions (connections) in the database can perform Flashback to different wall-clock times or SCNs. DML and DDL operations and distributed operations are not allowed while a session is running in Flashback mode. You can use PL/SQL cursors opened before disabling Flashback to perform DML.</p>
<p>Under Automatic Undo Management (AUM) mode, you can use retention control to control how far back in time to go for the version of the database you need. If you need to perform a Flashback over a 24-hour period, the DBA must set the <code dir="ltr">undo_retention</code> parameter to 24 hours. This way, the system retains enough undo information to regenerate the older versions of the data.</p>
<p>You can set the <code dir="ltr">RETENTION</code> <code dir="ltr">GUARANTEE</code> clause for the undo tablespace to ensure that unexpired undo is not discarded. <code dir="ltr">UNDO_RETENTION</code> is not in itself a guarantee because, if the system is under space pressure, unexpired undo may be overwritten with freshly generated undo. In such cases, <code dir="ltr">RETENTION</code> <code dir="ltr">GUARANTEE</code> prevents this. For more information, see the <a class="olink ADMIN" href="../ADMIN/toc.htm"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a>.</p>
<p>In a Flashback-enabled session, <code dir="ltr">SYSDATE</code> is not affected; it continues to provide the current time.</p>
<p><code dir="ltr">DBMS_FLASHBACK</code> can be used within logon triggers to enable Flashback without changing the application code.</p>
</div>
<!-- class="refsect2" -->
<div id="ARPLS66398" class="refsect2"><a id="i996809"></a>
<h3 class="refsect2">Examples</h3>
<p>The following example illustrates how Flashback can be used when the deletion of a senior employee triggers the deletion of all the personnel reporting to him. Using the Flashback feature, you can recover and re-insert the missing employees.</p>
<pre dir="ltr">DROP TABLE employee;
DROP TABLE keep_scn;

REM -- Keep_scn is a temporary table to store scns that we are interested in

CREATE TABLE keep_scn (scn number); 
SET ECHO ON 
CREATE TABLE employee ( 
   employee_no   number(5) PRIMARY KEY, 
   employee_name varchar2(20), 
   employee_mgr  number(5) 
      CONSTRAINT mgr_fkey REFERENCES EMPLOYEE ON DELETE CASCADE, 
   salary        number, 
   hiredate      date 
); 

REM -- Populate the company with employees
INSERT INTO employee VALUES (1, &#39;John Doe&#39;, null, 1000000, &#39;5-jul-81&#39;); 
INSERT INTO employee VALUES (10, &#39;Joe Johnson&#39;, 1, 500000, &#39;12-aug-84&#39;); 
INSERT INTO employee VALUES (20, &#39;Susie Tiger&#39;, 10, 250000, &#39;13-dec-90&#39;); 
INSERT INTO employee VALUES (100, &#39;Scott Tiger&#39;, 20, 200000, &#39;3-feb-86&#39;); 
INSERT INTO employee VALUES (200, &#39;Charles Smith&#39;, 100, 150000, &#39;22-mar-88&#39;); 
INSERT INTO employee VALUES (210, &#39;Jane Johnson&#39;, 100, 100000, &#39;11-apr-87&#39;); 
INSERT INTO employee VALUES (220, &#39;Nancy Doe&#39;, 100, 100000, &#39;18-sep-93&#39;); 
INSERT INTO employee VALUES (300, &#39;Gary Smith&#39;, 210, 75000, &#39;4-nov-96&#39;); 
INSERT INTO employee VALUES (310, &#39;Bob Smith&#39;, 210, 65000, &#39;3-may-95&#39;); 
COMMIT; 

REM -- Show the entire org
SELECT lpad(&#39; &#39;, 2*(level-1)) || employee_name Name 
FROM employee 
CONNECT BY PRIOR employee_no = employee_mgr 
START WITH employee_no = 1 
ORDER BY LEVEL; 

REM -- Sleep for a short time (approximately 10 to 20  seconds) to avoid 
REM -- querying close to table creation

EXECUTE DBMS_LOCK.SLEEP(10);

REM -- Store this snapshot for later access through Flashback
DECLARE 
I NUMBER; 
BEGIN 
I := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER; 
INSERT INTO keep_scn VALUES (I); 
COMMIT; 
END;
/

REM -- Scott decides to retire but the transaction is done incorrectly
DELETE FROM EMPLOYEE WHERE employee_name = &#39;Scott Tiger&#39;; 
COMMIT; 

REM -- notice that all of scott&#39;s employees are gone 
SELECT lpad(&#39; &#39;, 2*(level-1)) || employee_name Name 
FROM EMPLOYEE 
CONNECT BY PRIOR employee_no = employee_mgr 
START WITH employee_no = 1 
ORDER BY LEVEL; 

REM -- Flashback to see Scott&#39;s organization
DECLARE 
   restore_scn number; 
BEGIN 
   SELECT  scn INTO restore_scn FROM keep_scn; 
   DBMS_FLASHBACK.ENABLE_AT_SYSTEM_CHANGE_NUMBER (restore_scn); 
END; 
/ 

REM -- Show Scott&#39;s org.
SELECT lpad(&#39; &#39;, 2*(level-1)) || employee_name Name 
FROM employee 
CONNECT BY PRIOR employee_no = employee_mgr 
START WITH employee_no = 
   (SELECT employee_no FROM employee WHERE employee_name = &#39;Scott Tiger&#39;) 
ORDER BY LEVEL; 

REM -- Restore scott&#39;s organization.
DECLARE 
   scotts_emp NUMBER; 
   scotts_mgr NUMBER; 
   CURSOR c1 IS 
      SELECT employee_no, employee_name, employee_mgr, salary, hiredate 
      FROM employee 
      CONNECT BY PRIOR employee_no = employee_mgr 
      START WITH employee_no = 
         (SELECT employee_no FROM employee WHERE employee_name = &#39;Scott Tiger&#39;); 
   c1_rec c1 % ROWTYPE; 
BEGIN 
   SELECT employee_no, employee_mgr INTO scotts_emp, scotts_mgr FROM employee 
   WHERE employee_name = &#39;Scott Tiger&#39;; 
   /* Open c1 in flashback mode */
   OPEN c1; 
   /* Disable Flashback */
   DBMS_FLASHBACK.DISABLE; 
 LOOP 
   FETCH c1 INTO c1_rec; 
   EXIT WHEN c1%NOTFOUND; 
   /*
     Note that all the DML operations inside the loop are performed
     with Flashback disabled
   */
   IF (c1_rec.employee_mgr = scotts_emp) then 
      INSERT INTO employee VALUES (c1_rec.employee_no, 
         c1_rec.employee_name, 
         scotts_mgr, 
         c1_rec.salary, 
         c1_rec.hiredate); 
   ELSE 
   IF (c1_rec.employee_no != scotts_emp) THEN 
   INSERT INTO employee VALUES (c1_rec.employee_no, 
         c1_rec.employee_name, 
         c1_rec.employee_mgr, 
         c1_rec.salary, 
         c1_rec.hiredate); 
      END IF; 
    END IF; 
 END LOOP; 
END; 
/ 

REM -- Show the restored organization.
select lpad(&#39; &#39;, 2*(level-1)) || employee_name Name 
FROM employee 
CONNECT BY PRIOR employee_no = employee_mgr 
START WITH employee_no = 1 
ORDER BY LEVEL; 
</pre></div>
<!-- class="refsect2" --></div>
<!-- class="refsect1" -->
<a id="i999159"></a>
<div id="ARPLS66399" class="refsect1">
<h2 class="refsect1">Summary of DBMS_FLASHBACK Subprograms</h2>
<div id="ARPLS66400" class="tblformal">
<p class="titleintable"><a id="sthref4400"></a><a id="sthref4401"></a>Table 70-3 DBMS_FLASHBACK Package Subprograms</p>
<table class="cellalignment4330" title="DBMS_FLASHBACK Package Subprograms" summary="This table lists the DBMS_FLASHBACK subprograms in alphabetical order and briefly describes them." dir="ltr">
<thead>
<tr class="cellalignment4321">
<th class="cellalignment4328" id="r1c1-t5">Subprogram</th>
<th class="cellalignment4328" id="r1c2-t5">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r2c1-t5" headers="r1c1-t5">
<p><a href="#i999219">DISABLE Procedure</a></p>
</td>
<td class="cellalignment4329" headers="r2c1-t5 r1c2-t5">
<p>Disables the Flashback mode for the entire session</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r3c1-t5" headers="r1c1-t5">
<p><a href="#BGBJEJGF">ENABLE_AT_SYSTEM_CHANGE_NUMBER Procedure</a></p>
</td>
<td class="cellalignment4329" headers="r3c1-t5 r1c2-t5">
<p>Enables Flashback for the entire session. Takes an SCN as an Oracle number and sets the session snapshot to the specified number. Inside the Flashback mode, all queries return data consistent as of the specified wall-clock time or SCN</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r4c1-t5" headers="r1c1-t5">
<p><a href="#i999213">ENABLE_AT_TIME Procedure</a></p>
</td>
<td class="cellalignment4329" headers="r4c1-t5 r1c2-t5">
<p>Enables Flashback for the entire session. The snapshot time is set to the SCN that most closely matches the time specified in <code dir="ltr">query_time</code></p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r5c1-t5" headers="r1c1-t5">
<p><a href="#i997043">GET_SYSTEM_CHANGE_NUMBER Function</a></p>
</td>
<td class="cellalignment4329" headers="r5c1-t5 r1c2-t5">
<p>Returns the current SCN as an Oracle number. You can use the SCN to store specific snapshots</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r6c1-t5" headers="r1c1-t5">
<p><a href="#CHDEAIFF">TRANSACTION_BACKOUT Procedures</a></p>
</td>
<td class="cellalignment4329" headers="r6c1-t5 r1c2-t5">
<p>Provides the mechanism to back out a transaction</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" -->
<div id="ARPLS66401" class="refsect2"><a id="i999219"></a>
<h3 class="refsect2"><a id="sthref4402"></a>DISABLE Procedure</h3>
<p>This procedure disables the Flashback mode for the entire session.</p>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4403"></a>Syntax</p>
<pre dir="ltr">DBMS_FLASHBACK.DISABLE;
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4404"></a>Examples</p>
<p>The following example queries the salary of an employee, Joe, on August 30, 2000:</p>
<pre dir="ltr">EXECUTE dbms_flashback.enable_at_time(&#39;30-AUG-2000&#39;);
SELECT salary FROM emp where name = &#39;Joe&#39;
EXECUTE dbms_flashback.disable;
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="ARPLS66402" class="refsect2"><a id="BGBJEJGF"></a>
<h3 class="refsect2"><a id="sthref4405"></a>ENABLE_AT_SYSTEM_CHANGE_NUMBER Procedure</h3>
<p>This procedure takes an SCN as an input parameter and sets the session snapshot to the specified number. In the Flashback mode, all queries return data consistent as of the specified wall-clock time or SCN. It enables Flashback for the entire session.</p>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4406"></a>Syntax</p>
<pre dir="ltr">DBMS_FLASHBACK.ENABLE_AT_SYSTEM_CHANGE_NUMBER (
   query_scn IN NUMBER);
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4407"></a>Parameters</p>
<div id="ARPLS66403" class="tblformal">
<p class="titleintable"><a id="sthref4408"></a><a id="sthref4409"></a>Table 70-4 ENABLE_AT_SYSTEM_CHANGE_NUMBER Procedure Parameters</p>
<table class="cellalignment4330" title="ENABLE_AT_SYSTEM_CHANGE_NUMBER Procedure Parameters" summary="This table describes the parameters of DBMS_FLASHBACK.ENABLE_AT_SYSTEM_CHANGE_NUMBER." dir="ltr">
<thead>
<tr class="cellalignment4321">
<th class="cellalignment4328" id="r1c1-t6">Parameter</th>
<th class="cellalignment4328" id="r1c2-t6">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r2c1-t6" headers="r1c1-t6">
<p><code dir="ltr">query_scn</code></p>
</td>
<td class="cellalignment4329" headers="r2c1-t6 r1c2-t6">
<p>The system change number (SCN), a version number for the database that is incremented on every transaction commit.</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" --></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="ARPLS66404" class="refsect2"><a id="i999213"></a>
<h3 class="refsect2"><a id="sthref4410"></a>ENABLE_AT_TIME Procedure</h3>
<p>This procedure enables Flashback for the entire session. The snapshot time is set to the SCN that most closely matches the time specified in query_time.It enables Flashback for the entire session.</p>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4411"></a>Syntax</p>
<pre dir="ltr">DBMS_FLASHBACK.ENABLE_AT_TIME (
   query_time   IN TIMESTAMP);
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4412"></a>Parameters</p>
<div id="ARPLS66405" class="tblformal">
<p class="titleintable"><a id="sthref4413"></a><a id="sthref4414"></a>Table 70-5 ENABLE_AT_TIME Procedure Parameters</p>
<table class="cellalignment4330" title="ENABLE_AT_TIME Procedure Parameters" summary="This table describes the parameters of DBMS_FLASHBACK.ENABLE_AT_TIME." dir="ltr">
<thead>
<tr class="cellalignment4321">
<th class="cellalignment4328" id="r1c1-t7">Parameter</th>
<th class="cellalignment4328" id="r1c2-t7">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r2c1-t7" headers="r1c1-t7">
<p><code dir="ltr">query_time</code></p>
</td>
<td class="cellalignment4329" headers="r2c1-t7 r1c2-t7">
<p>This is an input parameter of type <code dir="ltr">TIMESTAMP</code>. A time stamp can be specified in the following ways:</p>
<ul>
<li>
<p>Using the <code dir="ltr">TIMESTAMP</code> constructor</p>
<pre dir="ltr">EXECUTE DBMS_FLASHBACK.ENABLE_AT_TIME(TIMESTAMP &#39;2001-01-09 12:31:00&#39;). 
</pre>
<p>Use the Globalization Support (NLS) format and supply a string. The format depends on the Globalization Support settings.</p>
</li>
<li>
<p>Using the <code dir="ltr">TO_TIMESTAMP</code> function:</p>
<pre dir="ltr">EXECUTE DBMS_FLASHBACK.ENABLE_AT_TIME(TO_TIMESTAMP(&#39;12-02-2001 14:35:00&#39;, &#39;DD-MM-YYYY HH24:MI:SS&#39;))
</pre>
<p>You provide the format you want to use. This example shows the <code dir="ltr">TO_TIMESTAMP</code> function for February 12, 2001, 2:35 PM.</p>
</li>
<li>
<p>If the time is omitted from query time, it defaults to the beginning of the day, that is, 12:00 A.M.</p>
</li>
<li>
<p>Note that if the query time contains a time zone, the time zone information is truncated.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" --></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="ARPLS66406" class="refsect2"><a id="i997043"></a>
<h3 class="refsect2">GET_SYSTEM_CHANGE_NUMBER Function</h3>
<p>This function returns the current SCN as an Oracle number datatype. You can obtain the current change number and store it for later use. This helps you retain specific snapshots.</p>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4415"></a>Syntax</p>
<pre dir="ltr">DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER
 RETURN NUMBER;
</pre></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" -->
<div id="ARPLS66407" class="refsect2"><a id="CHDEAIFF"></a>
<h3 class="refsect2"><a id="sthref4416"></a>TRANSACTION_BACKOUT Procedures</h3>
<p>This procedure provides a mechanism to back out a set of transactions. The user can call these procedures with either transaction names or transaction identifiers (<code dir="ltr">XIDS</code>).</p>
<p>The procedure analyzes the transactional dependencies, perform DMLs and generates an extensive report on the operation performed by the subprogram. This procedure does not commit the DMLs performed as part of transaction back out. However it holds all the required locks on rows and tables in the right form, so that no other dependencies can enter the system. To make the changes permanent you must explicitly commit the transaction.</p>
<p>A report is generated in the system tables <code dir="ltr">DBA_FLASHBACK_TRANSACTION_STATE</code> and <code dir="ltr">DBA_FLASHBACK_TRANSACTION_REPORT</code>.</p>
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4417"></a>Syntax</p>
<pre dir="ltr">DBMS_FLASHBACK.TRANSACTION_BACKOUT
   numtxns            NUMBER,
   xids               XID_ARRAY,
   options            NUMBER default NOCASCADE, 
   timeHint           TIMESTAMP default MINTIME);

DBMS_FLASHBACK.TRANSACTION_BACKOUT
   numtxns            NUMBER,  
   xids               XID_ARRAY, 
   options            NUMBER default NOCASCADE,
   scnHint            TIMESTAMP default 0   );

DBMS_FLASHBACK.TRANSACTION_BACKOUT
   numtxns           NUMBER,
   txnnames          TXNAME_ARRAY,
   options           NUMBER default NOCASCADE,
   timehint          TIMESTAMP MINTIME );

DBMS_FLASHBACK.TRANSACTION_BACKOUT
   numtxns           NUMBER, 
   txnNames         TXNAME_ARRAY, 
   options          NUMBER default NOCASCADE,
   scnHint          NUMBER 0);
</pre></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4418"></a>Parameters</p>
<div id="ARPLS66408" class="tblformal">
<p class="titleintable"><a id="sthref4419"></a><a id="sthref4420"></a>Table 70-6 TRANSACTION_BACKOUT Procedure Parameters</p>
<table class="cellalignment4330" title="TRANSACTION_BACKOUT Procedure Parameters" summary="This table describes the parameters of the DBMS_FLASHBACK.TRANSACTION_BACKOUT subprogram." dir="ltr">
<thead>
<tr class="cellalignment4321">
<th class="cellalignment4328" id="r1c1-t8">Parameter</th>
<th class="cellalignment4328" id="r1c2-t8">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r2c1-t8" headers="r1c1-t8">
<p><code dir="ltr">numtxns</code></p>
</td>
<td class="cellalignment4329" headers="r2c1-t8 r1c2-t8">
<p>Number of transactions passed as input</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r3c1-t8" headers="r1c1-t8">
<p><code dir="ltr">xids</code></p>
</td>
<td class="cellalignment4329" headers="r3c1-t8 r1c2-t8">
<p>List of transaction IDs in the form of an array</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r4c1-t8" headers="r1c1-t8">
<p><code dir="ltr">txnnames</code></p>
</td>
<td class="cellalignment4329" headers="r4c1-t8 r1c2-t8">
<p>List of transaction names in the form of an array</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r5c1-t8" headers="r1c1-t8">
<p><code dir="ltr">options</code></p>
</td>
<td class="cellalignment4329" headers="r5c1-t8 r1c2-t8">
<p>Back out dependent transactions:</p>
<ul>
<li>
<p><code dir="ltr">NOCASCADE</code> - No dependency is expected. If a dependency is found, this raises an error, with the first dependent transaction provided in the report.</p>
</li>
<li>
<p><code dir="ltr">NOCASCADE_FORCE</code> - The user forcibly backs out the given transactions without considering the dependent transactions. The RDBMS executes the <code dir="ltr">UNDO</code> <code dir="ltr">SQL</code> for the given transactions in reverse order of their commit times. If no constraints break, and the result is satisfactory, the user can either <code dir="ltr">COMMIT</code> the changes or else <code dir="ltr">ROLL</code> <code dir="ltr">BACK</code>.</p>
</li>
<li>
<p><code dir="ltr">NONCONFLICT_ONLY</code> - This option lets the user back out the changes to the nonconflicting rows of the given transactions. Note that a transaction dependency can happen due to a row conflict through either WAW or primary/unique key constraints. If the user chooses to back out only the nonconflicting rows, this does not cause any problem with database consistency, although transaction atomicity is lost. As this is a recovery operation, the user can correct the data.</p>
</li>
<li>
<p><code dir="ltr">CASCADE</code> - This completely removes the given transactions including their dependents in a post order fashion (reverse order of commit times).</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r6c1-t8" headers="r1c1-t8">
<p><code dir="ltr">timehint</code></p>
</td>
<td class="cellalignment4329" headers="r6c1-t8 r1c2-t8">
<p>Time hint on the start of the transaction</p>
</td>
</tr>
<tr class="cellalignment4321">
<td class="cellalignment4329" id="r7c1-t8" headers="r1c1-t8">
<p><code dir="ltr">scnhint</code></p>
</td>
<td class="cellalignment4329" headers="r7c1-t8 r1c2-t8">
<p>SCN hint on the start of the transaction</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" --></div>
<!-- class="refsubsect" -->
<div class="refsubsect">
<p class="titleinrefsubsect"><a id="sthref4421"></a>Usage Notes</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For information about restrictions in using <code dir="ltr">TRANSACTION_BACKOUT</code>, see <a class="olink ADFNS1010" href="../ADFNS/adfns_flashback.htm#ADFNS1010">&#34;Using Flashback Transaction&#34;</a> in the <span class="italic">Oracle Database Development Guide</span>.</div>
<ul>
<li>
<p>If transaction name is used, a time hint must be provided. The time hint should be a time before the start of all the given transactions to back out.</p>
</li>
<li>
<p>If the SCN hint is provided, it must be before the start of the earliest transaction in the specified input set, or this raises an error and terminates. If it is not provided and the transaction has committed within undo retention, the database system is able to determine the start time.</p>
</li>
</ul>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsect2" --></div>
<!-- class="refsect1" --></div>
<!-- class="refentry" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment4320">
<tr>
<td class="cellalignment4329">
<table class="cellalignment4325">
<tr>
<td class="cellalignment4324"><a href="d_ftran.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment4324"><a href="d_flashb_archive.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2016,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment4332">
<table class="cellalignment4323">
<tr>
<td class="cellalignment4324"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment4324"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment4324"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment4324"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment4324"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment4324"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>