<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-78807"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Managing%20Recovery%20Scenarios"></a><title>Managing Recovery Scenarios</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="dcterms.created" content="2014-08-21T15:13:25Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Services for Microsoft Transaction Server Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E18595-03"/>
<meta name="dcterms.isVersionOf" content="NTMTS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="install.htm" title="Previous" type="text/html"/>
<link rel="Next" href="prog.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E18595-03.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">7/12</span> <!-- End Header -->
<div id="NTMTS003" class="chapter"><a id="CBADHGHH"></a>
<h1 class="chapter"><span class="secnum">3</span> Managing Recovery Scenarios</h1>
<p>This chapter describes how to create and schedule <a href="glossary.htm#CBAIJAFH"><span class="xrefglossterm">Microsoft Transaction Server</span></a>-related Oracle transaction recovery.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i1007073">Microsoft Transaction Server Configuration Requirements</a></p>
</li>
<li>
<p><a href="#i1007174">Microsoft Transaction Server Transaction Recovery Overview</a></p>
</li>
<li>
<p><a href="#i1007223">Scheduling Automatic Microsoft Transaction Server Transaction Recovery</a></p>
</li>
<li>
<p><a href="#i1007501">Viewing Microsoft Transaction Server In-Doubt Transactions</a></p>
</li>
<li>
<p><a href="#i1007525">Modifying Registry Values for Oracle Fail Safe Configurations</a></p>
</li>
</ul>
<a id="i1007073"></a>
<div id="NTMTS134" class="sect1">
<h2 class="sect1">Microsoft Transaction Server Configuration Requirements<a id="sthref47"></a><a id="sthref48"></a><a id="sthref49"></a><a id="sthref50"></a><a id="sthref51"></a></h2>
<p><a id="i1007093"></a>You must configure the Microsoft Transaction Server and Oracle Database environments after installing or migrating <a href="glossary.htm#CBAJACIF"><span class="xrefglossterm">Oracle Services for Microsoft Transaction Server (OraMTS)</span></a>.</p>
<p>Configuration is not required on the Windows computer if a Microsoft Transaction Server is installed on a computer.</p>
<p>To configure the Microsoft Transaction Server, perform the following tasks on the computer where the Oracle Database is installed:</p>
<ol>
<li>
<p>Run the <code>oramtsadmin.sql</code> script against the database to create the Microsoft Transaction Server administrative user account (the default username is <code>mtssys</code>).</p>
</li>
<li>
<p>Schedule automatic transaction recovery.</p>
<p>See <a href="#i1007223">&#34;Scheduling Automatic Microsoft Transaction Server Transaction Recovery&#34;</a></p>
</li>
<li>
<p>If you have an Oracle Fail Safe configuration, modify the registry values before or after running the <code>oramtsadmin.sql</code> script.</p>
<p>See <a href="#i1007525">&#34;Modifying Registry Values for Oracle Fail Safe Configurations&#34;</a>.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1007174"></a>
<div id="NTMTS135" class="sect1">
<h2 class="sect1">Microsoft Transaction Server <a id="sthref52"></a><a id="sthref53"></a><a id="sthref54"></a><a id="sthref55"></a><a id="sthref56"></a>Transaction Recovery Overview</h2>
<p><a id="i1007184"></a>Distributed transaction capabilities are required to use Microsoft Transaction Server with Oracle database. Microsoft Transaction Server-related Oracle transactions become in-doubt transactions when any of the following fail:</p>
<ul>
<li>
<p>Microsoft Transaction Server application</p>
</li>
<li>
<p>Network</p>
</li>
<li>
<p><a href="glossary.htm#i996748"><span class="xrefglossterm">Microsoft Distributed Transaction Coordinator (MS DTC)</span></a></p>
</li>
</ul>
<p>An <a href="glossary.htm#i996808">Oracle MTS Recovery Service</a> resolves in-doubt transactions on the computer that started the failed transaction. An Oracle MTS Recovery Service is automatically installed with Oracle Services For Microsoft Transaction Server. Only one Oracle MTS Recovery Service can be installed for each computer. A scheduled recovery job on each Microsoft Transaction Server-enabled database permits the Oracle MTS Recovery Service to resolve in-doubt transactions.</p>
<p>The Oracle MTS Recovery Service resolves an in-doubt Microsoft Transaction Server transaction in the following order:</p>
<ol>
<li>
<p>The DBMS recovery job detects an in-doubt MTS-related transaction.</p>
</li>
<li>
<p>The DBMS recovery job extracts the recovery service&#39;s endpoint address from the XID of the in-doubt transaction and requests the recovery service for the outcome of the MTS/MS DTC transaction.</p>
</li>
<li>
<p>The recovery service requests its MS DTC for transaction outcome.</p>
</li>
<li>
<p>The recovery service reports transaction outcome to the DBMS job process.</p>
</li>
<li>
<p>The DBMS recovery job commits or terminates the in-doubt transaction.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1007223"></a>
<div id="NTMTS136" class="sect1">
<h2 class="sect1"><a id="sthref57"></a><a id="sthref58"></a><a id="sthref59"></a>Scheduling Automatic Microsoft Transaction Server Transaction Recovery</h2>
<p>OraMTS uses server-based recovery to resolve in-doubt transactions originated by MSDTC. To do this, the OraMTS administrator must be able to access the Windows middle-tier node through <code>UTL_HTTP</code>. <code>oramtsadmin.sql</code> grants execute privileges on <code>UTL_HTTP</code> to the OraMTS administrator, as shown in <a href="#BGBJHACB">&#34;Configuring Automatic Transaction Recovery&#34;</a></p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Starting with Oracle version 11<span class="italic">g</span>, the DBA needs to create an access control list (ACL) as shown in <a href="#BGBCICFA">&#34;Creating an Access Control List (ACL)&#34;</a>.</div>
<a id="BGBCICFA"></a>
<div id="NTMTS304" class="sect2">
<h3 class="sect2">Creating an Access Control List (ACL)</h3>
<p>For Oracle database version 11<span class="italic">g</span> and later, the DBA must create an access control list (ACL) that grants the OraMTS administrator the privilege to make out-bound HTTP connections. <a href="#BGBJBGBF">Example 3-1</a> demonstrates this:</p>
<div id="NTMTS305" class="example">
<p class="titleinexample"><a id="BGBJBGBF"></a>Example 3-1 Creating an ACL List and Adding OraMTS Administrator to it</p>
<pre>BEGIN
   -- Create the new ACL, naming it &#34;OraMTSadmin.xml&#34;, with a description.
   -- This provides the OraMTS administrative user e.g. MTSADMIN user FOO
   -- the privilege to connect
   DBMS_NETWORK_ACL_ADMIN.CREATE_ACL(&#39;OraMTSadmin.xml&#39;,
                                    &#39;Allow usage to the UTL network packages&#39;,
                                    &#39;FOO&#39;, TRUE, &#39;connect&#39;);
   -- Now grant privilege to resolve DNS names to the OraMTS administrative user
   DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE(&#39;OraMTSadmin.xml&#39; ,
                                        &#39;FOO&#39;, TRUE,&#39;resolve&#39;);
  -- Specify which hosts this ACL applies to, in this case we are allowing
  -- access to all hosts. if one knew the list of all Windows middle-tier,
  -- these could be added one by one.
   DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL(&#39;OraMTSadmin.xml&#39;,&#39;*&#39;);
 END;
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="BGBJHACB"></a>
<div id="NTMTS306" class="sect2">
<h3 class="sect2">Configuring Automatic Transaction Recovery</h3>
<p>Automatic transaction recovery is performed by scheduling a database job. A database job for in-doubt transactions must be scheduled for each database participating in Microsoft Transaction Server transactions.</p>
<p>Transaction recovery is configured by running the <code>oramtsadmin.sql</code> script, which triggers <code><a id="sthref60"></a>utl_oramts.sql</code> and <code><a id="sthref61"></a>prvtoramts.plb</code> scripts to create the PL/SQL package <code>utl_oramts</code>. The database view <code>oramts_2pc_pending</code> is also created to show in-doubt transactions related to Microsoft Transaction Server transactions.</p>
<p>The <code>oramtsadmin.sql</code> script:</p>
<ul>
<li>
<p>Creates the Microsoft Transaction Server administrator user account.</p>
</li>
<li>
<p>Automatically schedules database jobs for transaction recovery every one minute.</p>
<p>When the database job is run, it checks for unresolved global transactions in the database that are related to Microsoft Transaction Server. Information in the <a href="glossary.htm#CBAHGIEA"><span class="xrefglossterm">transaction identifiers (XIDs)</span></a> of the in-doubt transactions identifies the computer on which the transaction was started. The Oracle MTS Recovery Service on that computer resolves the transaction.</p>
</li>
<li>
<p>Schedules post-recovery cleanup every half hour.</p>
</li>
</ul>
<p>Schedule automatic transaction recovery in the database by performing these tasks:</p>
<ul>
<li>
<p><a href="#i1007268">Setting and Starting Up Database Job-Queue Processes</a></p>
</li>
<li>
<p><a href="#i1007312">Creating and Scheduling Automatic Transaction Recovery</a></p>
</li>
</ul>
<a id="i1007268"></a>
<div id="NTMTS137" class="sect3">
<h4 class="sect3">Setting and Starting Up <a id="sthref62"></a><a id="sthref63"></a><a id="sthref64"></a>Database Job-Queue Processes</h4>
<p>The <code>JOB_QUEUE_PROCESSES</code> initialization parameter specifies the maximum number of job slaves started on an instance.</p>
<p>To set and start up job-queue processes:</p>
<ol>
<li>
<p>Ensure that you have <code>SYSDBA</code> privileges.</p>
</li>
<li>
<p>Go to the computer on which the Oracle Database is installed.</p>
</li>
<li>
<p>Start SQL*Plus:</p>
<pre>C:\&gt; sqlplus /NOLOG
</pre></li>
<li>
<p>Connect to the database as <code>SYSDBA</code>:</p>
<pre>SQL&gt; CONNECT / AS SYSDBA
</pre></li>
<li>
<p>Set the <code>JOB_QUEUE_PROCESSES</code> initialization parameter:</p>
<pre><a id="sthref65"></a><a id="sthref66"></a><a id="sthref67"></a><a id="sthref68"></a>JOB_QUEUE_PROCESSES = 1
</pre>
<p>The default value for this parameter is <code>0</code>. Set this parameter to a value greater than <code>1</code> if there are many destinations to which to propagate the messages.</p>
</li>
<li>
<p>Shut down the Oracle Database:</p>
<pre>SQL&gt; SHUTDOWN
</pre></li>
<li>
<p>Restart the Oracle Database:</p>
<pre>SQL&gt; STARTUP
</pre></li>
<li>
<p>Exit SQL*Plus:</p>
<pre><a id="i1007310"></a>
SQL&gt; EXIT
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="i1007312"></a>
<div id="NTMTS138" class="sect3">
<h4 class="sect3">Creating and Scheduling Automatic Transaction Recovery <a id="sthref69"></a><a id="sthref70"></a><a id="sthref71"></a><a id="sthref72"></a></h4>
<p>The <code>oramtsadmin.sql</code> script creates the Microsoft Transaction Server administrator user account with the default username <code>mtssys</code>. The Microsoft Transaction Server transaction recovery jobs run under the administrator user account.</p>
<p>The <code>oramtsadmin.sql</code> script runs the <code><a id="sthref73"></a><a id="sthref74"></a>utl_oramts.sql</code> script to grant the following <a id="sthref75"></a>privileges and roles to the administrator user account:</p>
<ul>
<li>
<p><a id="sthref76"></a><a id="sthref77"></a><code>CREATE SESSION</code> role</p>
</li>
<li>
<p><a id="sthref78"></a><a id="sthref79"></a><code>SELECT_CATALOG_ROLE</code> role</p>
</li>
<li>
<p><a id="sthref80"></a><a id="sthref81"></a><code>FORCE_ANY_TRANSACTION</code> privilege</p>
</li>
<li>
<p><a id="sthref82"></a><a id="sthref83"></a><code>DBMS_JOBS</code> package, on which <code>EXECUTE</code> privileges are granted</p>
</li>
<li>
<p><a id="sthref84"></a><a id="sthref85"></a><code>DBMS_TRANSACTION</code> package, on which <code>EXECUTE</code> privileges are granted</p>
</li>
</ul>
<p>To create and schedule automatic transaction recovery:</p>
<ol>
<li>
<p>Ensure that you have <code>SYSDBA</code> privileges.</p>
</li>
<li>
<p>Log on to the computer where the Oracle Database is installed.</p>
</li>
<li>
<p>Start SQL*Plus:</p>
<pre>C:\&gt; sqlplus /NOLOG 
</pre></li>
<li>
<p>Connect to the database as <code>SYSDBA</code>:</p>
<pre>SQL&gt; CONNECT / AS SYSDBA
</pre></li>
<li id="i1007354">
<p>Run the <code>oramtsadmin.sql</code> script:</p>
<pre>SQL&gt; @<span class="italic">ORACLE_BASE</span>\<span class="italic">ORACLE_HOME</span>\oramts\admin\oramtsadmin.sql;<a id="sthref86"></a><a id="sthref87"></a><a id="sthref88"></a>
</pre>
<p>You are prompted for the Microsoft Transaction Server administrator username and password. You can accept the default username of <code>mtssys</code> and password of <code>mtssys</code>, or change them.</p>
</li>
<li>
<p>If you did change the password in step <a href="#i1007354">5</a>, you can change it using this script:<a id="sthref89"></a><a id="sthref90"></a></p>
<pre>SQL&gt; ALTER USER <span class="italic">USERNAME</span> IDENTIFIED BY <span class="italic">new_password</span>;
</pre>
<p>To change the username after completing this task, drop the user, rerun the <code>oramtsadmin.sql</code> script, and specify a different username when prompted.</p>
</li>
<li id="i1007383">
<p>Exit SQL*Plus:</p>
<pre>SQL&gt; EXIT
</pre></li>
</ol>
<p>A single PL/SQL package, <code><a id="sthref91"></a><a id="sthref92"></a>utl_oramts</code>, is created in the Microsoft Transaction Server administrator&#39;s schema. <code>utl_oramts</code> exposes these public procedures and creates this view:</p>
<ul>
<li>
<p><a href="#i1007396">utl_oramts.show_indoubt Procedure</a></p>
</li>
<li>
<p><a href="#i1007434">utl_oramts.recover_automatic Procedure</a></p>
</li>
<li>
<p><a href="#i1007453">utl_oramts.forget_RMs Procedure</a></p>
</li>
<li>
<p><a href="#i1007463">oramts_2pc_pending View</a></p>
</li>
</ul>
<a id="i1007396"></a>
<div id="NTMTS139" class="sect4">
<h5 class="sect4">utl_oramts.show_indoubt <a id="sthref93"></a><a id="sthref94"></a>Procedure</h5>
<p>Use this procedure to view Microsoft Transaction Server in-doubt transactions in the database. This procedure uses the <code>dbms_output</code> package to display results.</p>
<p><a id="NTMTS140"></a><span class="subhead3">Description&nbsp;</span>This procedure requires <code>SERVEROUTPUT</code> set to <code>ON</code>.</p>
<pre>SQL&gt; SET SERVEROUTPUT ON

SQL&gt; EXECUTE utl_oramts.show_indoubt;
</pre>
<p>The following information appears:</p>
<pre>=========================================================
currently indoubt transactions
=========================================================
formatid        : 21255235
gtrid                   : C2229A505904974D81FB7316B147325900000000
bqual           : 5BAB6A6B55CD294AA20335839110829C0100000000901944700050
local txid      : 142.11.202
tx state                   : prepared
protocol        : HTTP
endpoint        : middletier-1@foo.com:2030
=========================================================
formatid        : 21255235
gtrid                   : 259DF9C8DFC5574F8876F0DF4E15CCAD00000000
bqual           : 2C8DCED5B9816244BA2B73CC013EEB870100000000901944700050
local txid      : 2.18.185
tx state        : prepared
protocol        : HTTP
endpoint        : middletier-2@foo.com:2030
</pre></div>
<!-- class="sect4" -->
<a id="i1007434"></a>
<div id="NTMTS141" class="sect4">
<h5 class="sect4">utl_oramts.recover_automatic<a id="sthref95"></a><a id="sthref96"></a> Procedure</h5>
<p>This procedure is run by the transaction recovery job. An automatic database job is scheduled for <code>utl_oramts.recover_automatic</code>. When the job is run, it checks for unresolved global transactions in the database that are related to Microsoft Transaction Server. Information in the XIDs of the in-doubt transactions identifies the computer on which the transaction started. The Oracle MTS Recovery Service is contacted and resolves the transactions.</p>
</div>
<!-- class="sect4" -->
<a id="i1007453"></a>
<div id="NTMTS142" class="sect4">
<h5 class="sect4">utl_oramts.forget_RMs <a id="sthref97"></a><a id="sthref98"></a>Procedure</h5>
<p>Use this procedure to request the transaction manager (MS DTC) to forget resolved transactions. This procedure is run by the post-recovery cleanup job.</p>
</div>
<!-- class="sect4" -->
<a id="i1007463"></a>
<div id="NTMTS143" class="sect4">
<h5 class="sect4">oramts_2pc_pending View<a id="sthref99"></a><a id="sthref100"></a></h5>
<p>The view <code>oramts_2pc_pending</code> is created by executing <code>oramtsadmin.sql</code>. <code>oramts_2pc_pending</code> shows in-doubt transactions in the database. This view consists of the following columns:</p>
<p><a id="NTMTS144"></a><a id="sthref101"></a><span class="subhead3">Formatid &nbsp;</span>This is the <code>formatid</code> of the global transaction in the database.</p>
<p><a id="NTMTS145"></a><a id="sthref102"></a><span class="subhead3">global_transaction_id &nbsp;</span>This is the transaction identifier of the Oracle global transaction corresponding to the Microsoft Transaction Server transaction. In fact, this is the globally unique identifier (GUID) of the Microsoft Transaction Server transaction.</p>
<p><a id="NTMTS146"></a><a id="sthref103"></a><span class="subhead3">branch_id&nbsp;</span>This shows the branch identifier of the Oracle transaction. A single Microsoft Transaction Server transaction can have multiple Oracle global transactions. This depends on the number of Microsoft Transaction Server/COM+ components that span the same Microsoft Transaction Server transaction. All these transactions have the small global transaction identifier, but different branch identifiers.</p>
<p><a id="NTMTS147"></a><a id="sthref104"></a><span class="subhead3">local_tx_id&nbsp;</span>A local Oracle transaction corresponds to each Microsoft Transaction Server transaction. This column shows the identifier corresponding to this local transaction.</p>
<p><a id="NTMTS148"></a><a id="sthref105"></a><span class="subhead3">state&nbsp;</span>This shows the state of the transaction: pending, heuristically committed, heuristically terminated, and so on.</p>
<p><a id="NTMTS149"></a><a id="sthref106"></a><span class="subhead3">protocol&nbsp;</span>This is the protocol that the transaction recovery job in the database uses to communicate with the Oracle MTS Recovery Service.</p>
<p><a id="NTMTS150"></a><a id="sthref107"></a><span class="subhead3">endpoint &nbsp;</span>This is the endpoint of the Windows computer on which the Microsoft Transaction Server transaction originated. For HTTP connections, this translates to a hostname and port number.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1007501"></a>
<div id="NTMTS151" class="sect1">
<h2 class="sect1"><a id="sthref108"></a><a id="sthref109"></a><a id="sthref110"></a>Viewing Microsoft Transaction Server In-Doubt Transactions</h2>
<p>To view Microsoft Transaction Server&ndash;related in-doubt transactions in the database, use SQL*Plus to query the view <code>oramts_2pc_pending</code>:</p>
<ol>
<li>
<p>Start SQL*Plus with the Microsoft Transaction Server administrator user account:</p>
<pre>C:\&gt; sqlplus <span class="italic">mtsadmin_user</span><span class="italic">/ mtsadmin_password</span>
</pre></li>
<li>
<p>Enter the following command:</p>
<pre>SQL&gt; SELECT * FROM oramts_2pc_pending;
</pre>
<p>This displays the computer on which the in-doubt transaction originated.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1007525"></a>
<div id="NTMTS152" class="sect1">
<h2 class="sect1"><a id="sthref111"></a><a id="sthref112"></a>Modifying <a id="sthref113"></a><a id="sthref114"></a>Registry Values for Oracle Fail Safe Configurations</h2>
<p>In typical configurations, the MS DTC and Oracle MTS Recovery Service run on the same computer. This ensures that the required information for transaction recovery is available to the Oracle-Microsoft Transaction Server integration layer.</p>
<p>In configurations where the Microsoft Transaction Server application is part of a Windows cluster (for example, the application can fail over to another node or host in the cluster), the <a id="sthref115"></a>MS DTC runs as a cluster-wide resource. All cluster nodes use a single instance of the MS DTC running on any cluster node.</p>
<p>If you have an Oracle Fail Safe configuration, make sure the following registry information is replicated on all nodes in the cluster participating in Microsoft Transaction Server transactions:</p>
<p>To modify registry values for Oracle Fail Safe configurations:</p>
<ol>
<li>
<p>Go to the computer on which the MS DTC and Oracle MTS Recovery Service are installed.</p>
</li>
<li>
<p>Start the registry from the command prompt:</p>
<pre>C:\&gt; regedt32
</pre>
<p>The Registry Editor window appears.</p>
</li>
<li>
<p>Go to <code>HKEY_LOCAL_MACHINE</code>\<code>Software</code>\<code>Oracle</code>\<code>OracleMTSRecoveryService</code>.</p>
</li>
<li>
<p>Copy the registry information appearing here to all nodes in the cluster.</p>
</li>
<li>
<p>Reboot the computer on which you added the key.</p>
</li>
</ol>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2496">
<tr>
<td class="cellalignment2503">
<table class="cellalignment2501">
<tr>
<td class="cellalignment2500"><a href="install.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2500"><a href="prog.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2505">
<table class="cellalignment2499">
<tr>
<td class="cellalignment2500"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2500"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2500"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2500"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2500"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2500"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>