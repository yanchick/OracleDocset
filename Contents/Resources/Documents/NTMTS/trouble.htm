<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-78811"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Troubleshooting%20Oracle%20Microsoft%20Transaction%20Server"></a><title>Troubleshooting Oracle Microsoft Transaction Server</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023"/>
<meta name="dcterms.created" content="2014-08-21T15:13:25Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Services for Microsoft Transaction Server Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E18595-03"/>
<meta name="dcterms.isVersionOf" content="NTMTS"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="perftune.htm" title="Previous" type="text/html"/>
<link rel="Next" href="glossary.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E18595-03.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">10/12</span> <!-- End Header -->
<div id="NTMTS007" class="chapter"><a id="CACJCBBD"></a>
<h1 class="chapter"><span class="secnum">6</span> Troubleshooting Oracle Microsoft Transaction Server</h1>
<p>This chapter provides information on troubleshooting Oracle Microsoft Transaction Server.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i1006204">Tracking Oracle Services for Microsoft Transaction Server Performance</a></p>
</li>
<li>
<p><a href="#BABCGBHI">Correcting Oracle Net Changes that Impact Connection Pooling</a></p>
</li>
<li>
<p><a href="#CACGCBIA">Designing an Application that Uses Multiple Databases</a></p>
</li>
<li>
<p><a href="#CACFJJDB">Working with Different Types of Connection Pooling</a></p>
</li>
<li>
<p><a href="#CACBCCEC">Working with In-Doubt Transactions</a></p>
</li>
<li>
<p><a href="#i1006464">Dropping the Microsoft Transaction Server Administrative User Account</a></p>
</li>
</ul>
<a id="i1006204"></a>
<div id="NTMTS254" class="sect1">
<h2 class="sect1">Tracking Oracle Services for Microsoft Transaction Server Performance<a id="sthref278"></a><a id="sthref279"></a><a id="sthref280"></a><a id="sthref281"></a><a id="sthref282"></a><a id="sthref283"></a><a id="sthref284"></a></h2>
<p>Trace files record information about Oracle Services for Microsoft Transaction Server performance. This information includes:</p>
<ul>
<li>
<p>Any errors</p>
</li>
<li>
<p>Enlistment requests and outcomes</p>
</li>
<li>
<p>Prepare, commit, and terminate requests and their outcomes</p>
</li>
</ul>
<p>Registry parameters handle tracing within <code>oramts.dll</code>, which performs the following tasks:</p>
<ul>
<li>
<p>It implements the API for integrating the Oracle Database with Microsoft Transaction Server.</p>
</li>
<li>
<p>It works as a resource dispenser to provide pooled <a href="glossary.htm#i996790">Oracle Call Interface (OCI)</a> connections.</p>
</li>
<li>
<p>It enables clients with nonpooled OCI connections to enlist in transactions started by <a href="glossary.htm#i996748">Microsoft Distributed Transaction Coordinator (MS DTC)</a>.</p>
</li>
<li>
<p>It communicates with Oracle Services for Microsoft Transaction Server to enlist the Oracle Database in transactions started by MS DTC.</p>
</li>
</ul>
<p>The MTS-based COM components can acquire connections to both dedicated and shared Oracle servers of a database. The components can then attempt to perform distributed updates, using data manipulation language, on another database using pre-existing database links between these databases. While the distributed updates from shared servers succeed, those from dedicated servers fail.</p>
<p>Registry parameters that handle tracing are automatically set in <code>\\</code><code><span class="codeinlineitalic">HKEY_LOCAL_MACHINE</span></code><code>\SOFTWARE\ORACLE\</code><code><span class="codeinlineitalic">HOMEID</span></code> during the installation of Oracle Services for Microsoft Transaction Server.</p>
<p>Restart all applications using Oracle Services for Microsoft Transaction Server. Further, if you have modified parameters related to the tracing of the <code>OracleMTSRecoveryService</code>, restart the Windows service.</p>
<p><a href="#g1007015">Table 6-1</a> shows the range of <code>ORAMTS_CP_TRACE_LEVEL</code> trace values.</p>
<div id="NTMTS255" class="tblformal">
<p class="titleintable"><a id="sthref285"></a><a id="g1007015"></a>Table 6-1 ORAMTS_CP_TRACE_LEVEL Trace Registry Parameter Values</p>
<table class="cellalignment2506" title="ORAMTS_CP_TRACE_LEVEL Trace Registry Parameter Values" summary="This table lists the trace registry parameter values. Column 1 lists the level. Column 2 contains the description of the value of the parameter." dir="ltr">
<thead>
<tr class="cellalignment2497">
<th class="cellalignment2507" id="r1c1-t2">Level</th>
<th class="cellalignment2507" id="r1c2-t2">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2497">
<td class="cellalignment2503" id="r2c1-t2" headers="r1c1-t2">
<p>0</p>
</td>
<td class="cellalignment2503" headers="r2c1-t2 r1c2-t2">
<p>Disables tracing. If the registry parameter is not set in the registry or as an environment variable, then tracing is disabled. This is equivalent to setting the level to <code>0</code>.</p>
</td>
</tr>
<tr class="cellalignment2497">
<td class="cellalignment2503" id="r3c1-t2" headers="r1c1-t2">
<p>1</p>
</td>
<td class="cellalignment2503" headers="r3c1-t2 r1c2-t2">
<p>Traces errors only</p>
</td>
</tr>
<tr class="cellalignment2497">
<td class="cellalignment2503" id="r4c1-t2" headers="r1c1-t2">
<p>2</p>
</td>
<td class="cellalignment2503" headers="r4c1-t2 r1c2-t2">
<p>Traces important events in addition to errors</p>
</td>
</tr>
<tr class="cellalignment2497">
<td class="cellalignment2503" id="r5c1-t2" headers="r1c1-t2">
<p>3</p>
</td>
<td class="cellalignment2503" headers="r5c1-t2 r1c2-t2">
<p>This level is not supported; if you set this parameter to <code>3</code>, level 2 tracing is enabled.</p>
</td>
</tr>
<tr class="cellalignment2497">
<td class="cellalignment2503" id="r6c1-t2" headers="r1c1-t2">
<p>4</p>
</td>
<td class="cellalignment2503" headers="r6c1-t2 r1c2-t2">
<p>Traces function entry/exit, important events, and errors</p>
</td>
</tr>
<tr class="cellalignment2497">
<td class="cellalignment2503" id="r7c1-t2" headers="r1c1-t2">
<p>5</p>
</td>
<td class="cellalignment2503" headers="r7c1-t2 r1c2-t2">
<p>Traces reference counting function and constructor/destructor entry/exit</p>
</td>
</tr>
</tbody>
</table>
<br/></div>
<!-- class="tblformal" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
The <a href="glossary.htm#i996808">Oracle MTS Recovery Service</a> also generates trace file output in the <code><span class="codeinlineitalic">ORACLE_BASE</span></code><code>\</code><code><span class="codeinlineitalic">ORACLE_HOME</span></code><code>\</code><code>oramts</code><code>\</code><code>trace</code> directory.<a id="sthref286"></a><a id="sthref287"></a></div>
</div>
<!-- class="sect1" -->
<a id="BABCGBHI"></a>
<div id="NTMTS257" class="sect1">
<h2 class="sect1">Correcting Oracle Net Changes that Impact Connection Pooling<a id="sthref288"></a><a id="sthref289"></a><a id="sthref290"></a><a id="sthref291"></a><a id="sthref292"></a></h2>
<p>The connection pool provided by the OraMTS layer, <code>oramts.dll</code>, uses a connection&#39;s <a href="glossary.htm#i996775">net service name</a> to identify pooled connections for an application. If changes are made to the net service name, and pooled connections are available, the application using the connection pool must be stopped and restarted. These changes can include altering the host or the database system identifier (SID) for the net service name in the <code>tnsnames.ora</code> file.</p>
<p>These changes ensure that all currently pooled connections corresponding to the old net service name are destroyed and any new pooled connections use the changes made to the net service name. This includes any application hosting <a href="glossary.htm#i996763">Microsoft Transaction Server</a> components.</p>
<p>To empty connection pools, perform the following:</p>
<ul>
<li>
<p>If the application is an <span class="italic">out-of-process</span> Microsoft Transaction Server component (<span class="italic">server package</span>), run the following application:</p>
<pre>C:\&gt; mtxstop
</pre>
<p>This empties the connection pools.</p>
</li>
<li>
<p>If the application is an <span class="italic">in-process</span> Microsoft Transaction Server component (<span class="italic">library package</span>), terminate the application. This also empties the connection pool.</p>
</li>
</ul>
</div>
<!-- class="sect1" -->
<a id="CACGCBIA"></a>
<div id="NTMTS258" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Designing an Application that Uses Multiple Databases</h2>
<p>Oracle clients can establish connections to a database in two ways:</p>
<ul>
<li>
<p>Typical Oracle clients establish connections to a database using a dedicated server configuration. In a dedicated server configuration, one client corresponds to one Oracle server process.</p>
</li>
<li>
<p>For scalability under heavy loads, Oracle clients have the option of using a shared server configuration. In a shared server configuration, a single Oracle server process can be shared by more than one client connection.</p>
</li>
</ul>
<p>Microsoft Transaction Server communicates with the database through distributed transactions. In a dedicated server configuration, you cannot use distributed updates (<a href="glossary.htm#i996738">data manipulation language</a> statements across database links) from other databases. However, if the original connection to the database is established using shared server configurations, the distributed updates from other databases succeed.</p>
<p>To use data manipulation language statements in shared server configurations, set the following parameter in the <a id="sthref293"></a><a id="sthref294"></a><a id="sthref295"></a><code>tnsnames.ora</code> file:</p>
<pre>SERVER=dedicated
</pre>
<p>This forces the Oracle Net listener to provide a dedicated connection. <a href="#CACFFFCE">Figure 6-1</a> shows this process.</p>
<div id="NTMTS259" class="figure">
<p class="titleinfigure"><a id="CACFFFCE"></a>Figure 6-1 Distributed DML Statements from MTS Applications</p>
<img width="383" height="461" src="img/ntmts012.gif" alt="Description of Figure 6-1 follows"/><br/>
<a id="sthref296" href="img_text/ntmts012.htm">Description of &#34;Figure 6-1 Distributed DML Statements from MTS Applications&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink NETAG" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a></div>
</div>
<!-- class="sect1" -->
<a id="CACFJJDB"></a>
<div id="NTMTS260" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Working with Different Types of Connection Pooling</h2>
<p><a id="NTMTS261"></a><a id="sthref297"></a><span class="subhead3">Oracle Net Connection Pooling&nbsp;</span> Oracle Net connection pooling is a server-side feature that is implemented only if the Oracle Database is configured for shared server support. Oracle Net connection pooling enables you to minimize the number of physical network connections to a shared server. This is achieved by sharing a dispatcher&#39;s set of connections among multiple client processes.</p>
<p><a id="NTMTS262"></a><a id="sthref298"></a><span class="subhead3">Microsoft Transaction Server Connection Pooling&nbsp;</span>Microsoft Transaction Server provides a resource pooling infrastructure that enables certain resources to be pooled, such as memory and database connections.</p>
<p><a id="NTMTS263"></a><a id="sthref299"></a><span class="subhead3">OCI Connection Pooling&nbsp;</span>OCI connection pooling layer works with MTS resource pooling to provide pooled Oracle client/server sessions. The OCI connection pooling layer also caches Oracle Net connections to reduce client/server session setup time.</p>
</div>
<!-- class="sect1" -->
<a id="CACBCCEC"></a>
<div id="NTMTS264" class="sect1"><!-- infolevel="all" infotype="General" -->
<h2 class="sect1">Working with In-Doubt Transactions</h2>
<p>Oracle uses distributed transactions in the following configurations:</p>
<ul>
<li>
<p>Distributed database configurations, such as distributed updates using database links</p>
</li>
<li>
<p>External transaction managers, such as Tuxedo and MS DTC, for coordinating transaction outcome</p>
</li>
</ul>
<p>The <a id="sthref300"></a>two-phase commit protocol completes these transactions. During phase one, the transaction manager (TM) requests the various resource managers involved in the TM&#39;s transaction to prepare the underlying distributed transactions. In phase two, the TM determines whether it commits or terminates the transaction, and requests the resource managers to commit or terminate the underlying transaction. If a resource manager fails to receive the phase two notification, the underlying distributed transaction becomes in-doubt.</p>
<p>To integrate Oracle with Microsoft Transaction Server, <a id="sthref301"></a>distributed transactions are used in the database. Distributed transactions correspond to transactions coordinated by the MS DTC. A distributed transaction can become in-doubt when the transaction cannot commit or terminate (phase two of the two-phase commit). This occurs when the Microsoft Transaction Server application server process, database, or network fails.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="recovery.htm#CBADHGHH">Chapter 3, &#34;Managing Recovery Scenarios&#34;</a></div>
</div>
<!-- class="sect1" -->
<a id="i1006464"></a>
<div id="NTMTS265" class="sect1">
<h2 class="sect1">Dropping the Microsoft Transaction Server Administrative User Account<a id="sthref302"></a><a id="sthref303"></a></h2>
<p>The Microsoft Transaction Server administrative user account is created by running the <code>oramtsadmin.sql</code> script. If you later change the database with which Microsoft Transaction Server is coordinating transactions, you can drop the administrative user account schema from the previous database.</p>
<p>To drop the Microsoft Transaction Server administrative user account:</p>
<ol>
<li>
<p>Start SQL*Plus:</p>
<pre>c:\&gt; sqlplus /NOLOG
</pre></li>
<li>
<p>Connect to the database as <code>SYSDBA</code>:</p>
<pre>SQL&gt; CONNECT / AS SYSDBA
</pre></li>
<li>
<p>Enter the following command to drop administrative user account schema:</p>
<pre>SQL&gt; DROP USER <span class="italic">mtsadmin_username</span> CASCADE;
</pre>
<p>where <code><span class="codeinlineitalic">mtsadmin_username</span></code> is the Microsoft Transaction Server administrative user account (default is <code>mtssys</code>).</p>
</li>
</ol>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
See <a href="recovery.htm#CBADHGHH">Chapter 3, &#34;Managing Recovery Scenarios&#34;</a> for information on creating the Microsoft Transaction Server administrative user account for the new database</div>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment2496">
<tr>
<td class="cellalignment2503">
<table class="cellalignment2501">
<tr>
<td class="cellalignment2500"><a href="perftune.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment2500"><a href="glossary.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment2505">
<table class="cellalignment2499">
<tr>
<td class="cellalignment2500"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment2500"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment2500"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment2500"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment2500"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment2500"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>