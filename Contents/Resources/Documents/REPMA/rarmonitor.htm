<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-91812"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Monitoring%20a%20Replication%20Environment"></a><title>Monitoring a Replication Environment</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1042"/>
<meta name="dcterms.created" content="2015-02-06T10:45:43Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Advanced Replication Management API Reference"/>
<meta name="dcterms.identifier" content="E18896-09"/>
<meta name="dcterms.isVersionOf" content="REPMA"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="rarmanage.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rarpart3.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E18896-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">16/38</span> <!-- End Header -->
<div id="REPMA030" class="chapter"><a id="g60210"></a> <a id="CFAJGBED"></a>
<h1 class="chapter"><span class="secnum">10</span> Monitoring a Replication Environment</h1>
<p><a id="sthref882"></a><a id="sthref883"></a><a id="sthref884"></a><a id="sthref885"></a><a id="sthref886"></a><a id="sthref887"></a>This chapter illustrates how to monitor a replication a replication environment using the data dictionary.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i35958">Monitoring Master Replication Environments</a></p>
</li>
<li>
<p><a href="#i32253">Monitoring Materialized View Sites</a></p>
</li>
<li>
<p><a href="#i32698">Monitoring Administrative Requests</a></p>
</li>
<li>
<p><a href="#i32690">Monitoring the Deferred Transactions Queue</a></p>
</li>
<li>
<p><a href="#i32457">Monitoring the Error Queue</a></p>
</li>
<li>
<p><a href="#i35565">Monitoring Performance in a Replication Environment</a></p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
<a id="sthref888"></a><a id="sthref889"></a><a id="sthref890"></a>The Advanced Replication interface in Oracle Enterprise Manager Cloud Control is also an excellent way to monitor a replication environment. Most of the information obtained by the queries in this chapter can be found by using the Advanced Replication interface. See the Advanced Replication interface online Help for more information.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rarpart4.htm#g998144">Part IV, &#34;Replication Data Dictionary Reference&#34;</a></div>
<a id="i35958"></a>
<div id="REPMA432" class="sect1">
<h2 class="sect1">Monitoring Master Replication Environments<a id="sthref891"></a><a id="sthref892"></a></h2>
<p>This section contains queries that you can run to display information about a master replication environment. The replication environment can be a multimaster environment, a master materialized view environment, or a hybrid environment that includes multiple master sites and materialized views.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i43284">Monitoring Master Sites</a></p>
</li>
<li>
<p><a href="#i43285">Monitoring Master Groups</a></p>
</li>
<li>
<p><a href="#i43294">Monitoring Masters</a></p>
</li>
</ul>
<a id="i43284"></a>
<div id="REPMA433" class="sect2">
<h3 class="sect2">Monitoring Master Sites<a id="sthref893"></a></h3>
<p>This section contains queries that you can run to display information about master sites.</p>
<a id="i43241"></a>
<div id="REPMA434" class="sect3">
<h4 class="sect3">Listing General Information About a Master Site</h4>
<p>You can find the following general information about a master site by running the query in this section:</p>
<ul>
<li>
<p>The number of administrative requests.</p>
</li>
<li>
<p>The number of administrative request errors.</p>
</li>
<li>
<p>The number of unpropagated deferred transaction-destination pairs. Each deferred transaction can have multiple destinations to which it will be propagated, and each destination is a single deferred transaction-destination pair.</p>
</li>
</ul>
<p>For example, if there are ten deferred transactions and each one must be propagated to three sites, then there are 30 deferred transaction-pairs returned by this query. After some time, if the first deferred transaction is propagated to two of the three destination sites, then there are still ten deferred transactions, but there are two fewer deferred-transaction pairs, and this query returns 28 unpropagated deferred transaction-pairs. In this case, the first deferred transaction only has one transaction-pair remaining.</p>
<ul>
<li>
<p>The number of deferred transaction errors (error transactions).</p>
</li>
<li>
<p>The number of successfully propagated transactions that are still in the queue. These transactions should be purged from the queue.</p>
</li>
</ul>
<p>Run the following query to list this information for the current master site:</p>
<pre dir="ltr">COLUMN GLOBAL_NAME HEADING &#39;Database&#39; FORMAT A25
COLUMN ADMIN_REQUESTS HEADING &#39;Admin|Reqests&#39; FORMAT 9999
COLUMN STATUS HEADING &#39;Admin|Errors&#39; FORMAT 9999
COLUMN TRAN HEADING &#39;Def|Trans|Pairs&#39; FORMAT 9999
COLUMN ERRORS HEADING &#39;Def|Trans|Errors&#39; FORMAT 9999
COLUMN COMPLETE HEADING &#39;Propagated|Trans&#39; FORMAT 9999

SELECT G.GLOBAL_NAME, D.ADMIN_REQUESTS, E.STATUS, DT.TRAN, DE.ERRORS, C.COMPLETE  
    FROM (SELECT GLOBAL_NAME FROM GLOBAL_NAME) G, 
      (SELECT COUNT(ID) ADMIN_REQUESTS FROM DBA_REPCATLOG) D, 
      (SELECT COUNT(STATUS) STATUS FROM DBA_REPCATLOG WHERE STATUS = &#39;ERROR&#39;) E,     
      (SELECT COUNT(*) TRAN FROM DEFTRANDEST) DT, 
      (SELECT COUNT(*) ERRORS FROM DEFERROR) DE,      
      (SELECT COUNT(A.DEFERRED_TRAN_ID) COMPLETE FROM DEFTRAN A         
    WHERE A.DEFERRED_TRAN_ID NOT IN (
      SELECT B.DEFERRED_TRAN_ID FROM DEFTRANDEST B)) C; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                                           Def    Def
                            Admin  Admin Trans  Trans Propagated
Database                  Reqests Errors Pairs Errors      Trans
------------------------- ------- ------ ----- ------ ----------
ORC1.EXAMPLE.COM                5      0    37      0         53
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
This query can be expensive if you have a large number of transactions in the deferred transactions queue.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i43285"></a>
<div id="REPMA435" class="sect2">
<h3 class="sect2">Monitoring Master Groups<a id="sthref894"></a></h3>
<p>This section contains queries that you can run to display information about the master groups at a replication site.</p>
<div id="REPMA436" class="sect3"><a id="sthref895"></a>
<h4 class="sect3">Listing the Master Sites Participating in a Master Group</h4>
<p>Run the following query to list the master sites for each master group at a replication site and indicate which master site is the master definition site for each master group:</p>
<pre dir="ltr">COLUMN GNAME HEADING &#39;Master Group&#39; FORMAT A20
COLUMN DBLINK HEADING &#39;Sites&#39; FORMAT A25
COLUMN MASTERDEF HEADING &#39;Master|Definition|Site?&#39; FORMAT A10

SELECT GNAME, DBLINK, MASTERDEF
    FROM DBA_REPSITES 
    WHERE MASTER = &#39;Y&#39; 
    AND GNAME NOT IN (SELECT GNAME FROM DBA_REPSITES WHERE SNAPMASTER = &#39;Y&#39;)    
    ORDER BY GNAME;
</pre>
<p>The subquery in the <code dir="ltr">SELECT</code> statement ensures that materialized view groups do not appear in the output. Your output looks similar to the following:</p>
<pre dir="ltr">                                               Master
                                               Definition
Master Group         Sites                     Site?
-------------------- ------------------------- ----------
HR_REPG              ORC1.EXAMPLE.COM          Y
HR_REPG              ORC2.EXAMPLE.COM          N
HR_REPG              ORC3.EXAMPLE.COM          N
</pre>
<p>This list indicates that <code dir="ltr">orc1.example.com</code> is the master definition site for the <code dir="ltr">hr_repg</code> master group, which also includes the master sites <code dir="ltr">orc2.example.com</code> and <code dir="ltr">orc3.example.com</code>.</p>
</div>
<!-- class="sect3" -->
<div id="REPMA437" class="sect3"><a id="sthref896"></a>
<h4 class="sect3">Listing General Information About Master Groups</h4>
<p>You can use the query in this section to list the following general information about the master groups at a master site:</p>
<ul>
<li>
<p>The name of each master group.</p>
</li>
<li>
<p>The number of unpropagated deferred transaction-destination pairs. Each deferred transaction can have multiple destinations to which it will be propagated, and each destination is a single deferred transaction-destination pair.</p>
</li>
</ul>
<p>For example, if there are ten deferred transactions and each one must be propagated to three sites, then there are 30 deferred transaction-pairs returned by this query. After some time, if the first deferred transaction is propagated to two of the three destination sites, then there are still ten deferred transactions, but there are two fewer deferred-transaction pairs, and this query returns 28 unpropagated deferred transaction-pairs. In this case, the first deferred transaction only has one transaction-pair remaining.</p>
<ul>
<li>
<p>The number of deferred transaction errors (error transactions) for each master group</p>
</li>
<li>
<p>The number of administrative requests for each master group</p>
</li>
<li>
<p>The number of administrative request errors for each master group</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN GNAME HEADING &#39;Master Group&#39; FORMAT A15
COLUMN deftran HEADING &#39;Number of|Deferred|Transaction|Pairs&#39; FORMAT 9999
COLUMN deftranerror HEADING &#39;Number of|Deferred|Transaction|Errors&#39; FORMAT 9999
COLUMN adminreq HEADING &#39;Number of|Administrative|Requests&#39; FORMAT 9999
COLUMN adminreqerror HEADING &#39;Number of|Administrative|Request|Errors&#39; 
COLUMN adminreqerror FORMAT 9999

SELECT G.GNAME, 
       NVL(T.CNT1, 0) deftran, 
       NVL(IE.CNT2, 0) deftranerror, 
       NVL(A.CNT3, 0) adminreq, 
       NVL(B.CNT4, 0) adminreqerror
    FROM 
    (SELECT DISTINCT GNAME FROM DBA_REPGROUP WHERE MASTER=&#39;Y&#39;) G, 
    (SELECT DISTINCT RO.GNAME, COUNT(DISTINCT D.DEFERRED_TRAN_ID) CNT1 
        FROM  DBA_REPOBJECT RO, DEFCALL D, DEFTRANDEST TD   
        WHERE RO.SNAME = D.SCHEMANAME 
        AND RO.ONAME = D.PACKAGENAME 
        AND RO.TYPE IN (&#39;TABLE&#39;, &#39;PACKAGE&#39;, &#39;MATERIALIZED VIEW&#39;)
        AND TD.DEFERRED_TRAN_ID = D.DEFERRED_TRAN_ID    
        GROUP BY RO.GNAME ) T, 
    (SELECT DISTINCT RO.GNAME, COUNT(DISTINCT E.DEFERRED_TRAN_ID) CNT2 
        FROM DBA_REPOBJECT RO, DEFCALL D, DEFERROR E   
        WHERE RO.SNAME = D.SCHEMANAME 
        AND RO.ONAME = D.PACKAGENAME    
        AND RO.TYPE IN (&#39;TABLE&#39;, &#39;PACKAGE&#39;, &#39;MATERIALIZED VIEW&#39;) 
        AND E.DEFERRED_TRAN_ID = D.DEFERRED_TRAN_ID     
        AND E.CALLNO = D.CALLNO   
        GROUP BY RO.GNAME ) IE, 
    (SELECT GNAME, COUNT(*) CNT3 FROM DBA_REPCATLOG GROUP BY GNAME) A, 
    (SELECT GNAME, COUNT(*) CNT4 FROM DBA_REPCATLOG 
        WHERE STATUS = &#39;ERROR&#39;
        GROUP BY GNAME) B WHERE G.GNAME = IE.GNAME (+) 
        AND G.GNAME = T.GNAME (+) 
        AND G.GNAME = A.GNAME (+) 
        AND G.GNAME = B.GNAME (+) ORDER BY G.GNAME; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                  Number of   Number of                     Number of
                   Deferred    Deferred      Number of Administrative
                Transaction Transaction Administrative        Request
Master Group          Pairs      Errors       Requests         Errors
--------------- ----------- ----------- -------------- --------------
HR_REPG                  54           0              0              0
OE_RG                    33           1              5              0
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
This query can be expensive if you have a large number of transactions waiting to be propagated.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i43294"></a>
<div id="REPMA438" class="sect2">
<h3 class="sect2">Monitoring Masters<a id="sthref897"></a><a id="sthref898"></a></h3>
<p>A master can be either a master site or a master materialized view site. This section contains queries that you can run to display information about masters.</p>
<div id="REPMA439" class="sect3"><a id="sthref899"></a>
<h4 class="sect3">Listing Information About Materialized Views Based on a Master</h4>
<p>If you have materialized view sites based on a master, then you can use the query in this section to list the following information about the master:</p>
<ul>
<li>
<p>The number of replication groups at a master. The replication groups can be either master groups or materialized view groups.</p>
</li>
<li>
<p>The number of registered materialized view groups based on the replication groups at the master.</p>
</li>
<li>
<p>The number of registered materialized views based on objects at the master. The objects can be either master tables or master materialized views.</p>
</li>
<li>
<p>The number of materialized view logs at the master.</p>
</li>
<li>
<p>The number of deployment templates at the master.</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN repgroup HEADING &#39;Number of|Replication|Groups&#39; FORMAT 9999
COLUMN mvgroup HEADING &#39;Number of|Registered|MV Groups&#39; FORMAT 9999
COLUMN mv HEADING &#39;Number of|Registered MVs&#39; FORMAT 9999
COLUMN mvlog HEADING &#39;Number of|MV Logs&#39; FORMAT 9999
COLUMN template HEADING &#39;Number of|Templates&#39; FORMAT 9999

SELECT A.REPGROUP repgroup, 
       B.MVGROUP mvgroup, 
       C.MV mv, 
       D.MVLOG mvlog, 
       E.TEMPLATE template
    FROM (SELECT COUNT(G.GNAME) REPGROUP 
             FROM DBA_REPGROUP G, DBA_REPSITES S 
             WHERE G.MASTER = &#39;Y&#39; 
             AND S.MASTER = &#39;Y&#39; 
             AND G.GNAME = S.GNAME 
             AND S.MY_DBLINK = &#39;Y&#39;) A, 
         (SELECT COUNT(*) MVGROUP 
             FROM DBA_REGISTERED_MVIEW_GROUPS) B, 
         (SELECT COUNT(*) MV 
             FROM DBA_REGISTERED_MVIEWS) C,  
         (SELECT COUNT(*) MVLOG 
             FROM (SELECT 1 FROM DBA_MVIEW_LOGS
             GROUP BY LOG_OWNER, LOG_TABLE)) D,
         (SELECT COUNT(*) TEMPLATE FROM DBA_REPCAT_REFRESH_TEMPLATES) E;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">  Number of  Number of
Replication Registered      Number of Number of Number of
     Groups  MV Groups Registered MVs   MV Logs Templates
----------- ---------- -------------- --------- ---------
          1          5             27         6         3
</pre></div>
<!-- class="sect3" -->
<div id="REPMA440" class="sect3"><a id="sthref900"></a>
<h4 class="sect3">Listing Information About the Materialized View Logs at a Master<a id="sthref901"></a></h4>
<p>A materialized view log enables you to perform a fast refresh on materialized views based on a master. A master can be a master table or a master materialized view. If you have materialized view logs based at a master, then you can use the query in this section to list the following information about them:</p>
<ul>
<li>
<p>The name of each log table that stores the materialized view log data</p>
</li>
<li>
<p>The owner of each materialized view log</p>
</li>
<li>
<p>The master on which each materialized view log is based</p>
</li>
<li>
<p>Whether a materialized view log is a row id materialized view log</p>
</li>
<li>
<p>Whether a materialized view log is a primary key materialized view log</p>
</li>
<li>
<p>Whether the materialized view log is an object id materialized view log</p>
</li>
<li>
<p>Whether a materialized view log has filter columns</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN LOG_TABLE HEADING &#39;Log Table&#39; FORMAT A20
COLUMN LOG_OWNER HEADING &#39;Log|Owner&#39; FORMAT A5
COLUMN MASTER HEADING &#39;Master&#39; FORMAT A15
COLUMN ROWIDS HEADING &#39;Row|ID?&#39; FORMAT A3
COLUMN PRIMARY_KEY HEADING &#39;Primary|Key?&#39; FORMAT A7
COLUMN OBJECT_ID HEADING &#39;Object|ID?&#39; FORMAT A6
COLUMN FILTER_COLUMNS HEADING &#39;Filter|Columns?&#39; FORMAT A8

SELECT DISTINCT LOG_TABLE, 
       LOG_OWNER, 
       MASTER, 
       ROWIDS, 
       PRIMARY_KEY, 
       OBJECT_ID,
       FILTER_COLUMNS 
    FROM DBA_MVIEW_LOGS 
    ORDER BY 1;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                     Log                   Row Primary Object Filter
Log Table            Owner Master          ID? Key?    ID?    Columns?
-------------------- ----- --------------- --- ------- ------ --------
MLOG$_COUNTRIES      HR    COUNTRIES       NO  YES     NO     NO
MLOG$_DEPARTMENTS    HR    DEPARTMENTS     NO  YES     NO     NO
MLOG$_EMPLOYEES      HR    EMPLOYEES       NO  YES     NO     NO
MLOG$_JOBS           HR    JOBS            NO  YES     NO     NO
MLOG$_JOB_HISTORY    HR    JOB_HISTORY     NO  YES     NO     NO
MLOG$_LOCATIONS      HR    LOCATIONS       NO  YES     NO     NO
MLOG$_REGIONS        HR    REGIONS         NO  YES     NO     NO
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REPLN107" href="../REPLN/repmview.htm#REPLN107"><span class="italic">Oracle Database Advanced Replication</span></a> for information about materialized view logs</div>
</div>
<!-- class="sect3" -->
<div id="REPMA441" class="sect3"><a id="sthref902"></a>
<h4 class="sect3">Listing the Materialized Views that Use a Materialized View Log</h4>
<p>More than one materialized view can use a materialized view log. If you have materialized view logs based at a master, then you can use the query in this section to list the following the materialized views that use each log:</p>
<ul>
<li>
<p>The name of each log table that stores the materialized view log data</p>
</li>
<li>
<p>The owner of each materialized view log</p>
</li>
<li>
<p>The master on which each materialized view log is based</p>
</li>
<li>
<p>The materialized view identification number of each materialized view that uses the materialized view log</p>
</li>
<li>
<p>The name of each materialized view that uses the materialized view log</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN LOG_TABLE HEADING &#39;Mview|Log Table&#39; FORMAT A20
COLUMN LOG_OWNER HEADING &#39;Mview|Log Owner&#39; FORMAT A10
COLUMN MASTER HEADING &#39;Master&#39; FORMAT A20
COLUMN MVIEW_ID HEADING &#39;Mview|ID&#39; FORMAT 9999
COLUMN NAME HEADING &#39;Mview Name&#39; FORMAT A20

SELECT L.LOG_TABLE, L.LOG_OWNER, B.MASTER, B.MVIEW_ID, R.NAME  
FROM ALL_MVIEW_LOGS L, ALL_BASE_TABLE_MVIEWS B, ALL_REGISTERED_MVIEWS R
WHERE B.MVIEW_ID = R.MVIEW_ID
AND B.OWNER = L.LOG_OWNER
AND B.MASTER = L.MASTER;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Mview                Mview                           Mview
Log Table            Log Owner  Master                  ID Mview Name
-------------------- ---------- -------------------- ----- --------------------
MLOG$_COUNTRIES      HR         COUNTRIES               21 COUNTRIES_MV1
MLOG$_DEPARTMENTS    HR         DEPARTMENTS             22 DEPARTMENTS_MV1
MLOG$_EMPLOYEES      HR         EMPLOYEES               23 EMPLOYEES_MV1
MLOG$_JOBS           HR         JOBS                    24 JOBS_MV1
MLOG$_JOB_HISTORY    HR         JOB_HISTORY             25 JOB_HISTORY_MV1
MLOG$_LOCATIONS      HR         LOCATIONS               26 LOCATIONS_MV1
MLOG$_REGIONS        HR         REGIONS                 27 REGIONS_MV1
</pre></div>
<!-- class="sect3" -->
<div id="REPMA442" class="sect3"><a id="sthref903"></a>
<h4 class="sect3">Listing Information About the Deployment Templates at a Master<a id="sthref904"></a></h4>
<p>Deployment templates enable you to create multiple materialized view environments quickly. They also enable you to use variables to customize each materialized view environment for its individual needs. You can use the query in this section to list the following information about the deployment templates at a master:</p>
<ul>
<li>
<p>The name of each deployment template</p>
</li>
<li>
<p>The owner of each deployment template</p>
</li>
<li>
<p>Whether a deployment template is public</p>
</li>
<li>
<p>The number of instantiated materialized view sites based on each deployment template</p>
</li>
<li>
<p>The comment associated with each deployment template</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN REFRESH_TEMPLATE_NAME HEADING &#39;Template|Name&#39; FORMAT A10
COLUMN OWNER HEADING &#39;Owner&#39; FORMAT A10
COLUMN PUBLIC_TEMPLATE HEADING &#39;Public?&#39; FORMAT A7
COLUMN INSTANTIATED HEADING &#39;Number of|Instantiated|Sites&#39; FORMAT 9999
COLUMN TEMPLATE_COMMENT HEADING &#39;Comment&#39; FORMAT A35

SELECT DISTINCT RT.REFRESH_TEMPLATE_NAME, 
       OWNER,
       PUBLIC_TEMPLATE, 
       RS.INSTANTIATED, 
       RT.TEMPLATE_COMMENT 
    FROM DBA_REPCAT_REFRESH_TEMPLATES RT,  
    (SELECT Y.REFRESH_TEMPLATE_NAME, COUNT(X.STATUS) INSTANTIATED  
        FROM DBA_REPCAT_TEMPLATE_SITES X, DBA_REPCAT_REFRESH_TEMPLATES Y 
        WHERE X.REFRESH_TEMPLATE_NAME(+) = Y.REFRESH_TEMPLATE_NAME 
        GROUP BY Y.REFRESH_TEMPLATE_NAME) RS 
        WHERE RT.REFRESH_TEMPLATE_NAME(+) = RS.REFRESH_TEMPLATE_NAME 
        ORDER BY 1;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                                 Number of
Template                      Instantiated
Name       Owner      Public?        Sites Comment
---------- ---------- ------- ------------ -----------------------------------
HR_REFG_DT HR         N                  2 Human Resources Deployment Template
</pre>
<p>The <code dir="ltr">N</code> in the <code dir="ltr">Public?</code> column means that the deployment template is private. Therefore, it can only be instantiated by authorized users. A <code dir="ltr">Y</code> in this column means that the deployment template is public. Any user can instantiate a public deployment template.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i32253"></a>
<div id="REPMA443" class="sect1">
<h2 class="sect1">Monitoring Materialized View Sites<a id="sthref905"></a><a id="sthref906"></a></h2>
<p>This section contains queries that you can run to display information about the materialized view sites. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i43313">Listing General Information About a Materialized View Site</a></p>
</li>
<li>
<p><a href="#i43314">Listing General Information About Materialized View Groups</a></p>
</li>
<li>
<p><a href="#i43315">Listing Information About Materialized Views</a></p>
</li>
<li>
<p><a href="#i43340">Listing Information About the Refresh Groups at a Materialized View Site</a></p>
</li>
<li>
<p><a href="#i43341">Determining the Job ID for Each Refresh Job at a Materialized View Site</a></p>
</li>
<li>
<p><a href="#i43342">Determining Which Materialized Views Are Currently Refreshing</a></p>
</li>
</ul>
<a id="i43313"></a>
<div id="REPMA444" class="sect2">
<h3 class="sect2">Listing General Information About a Materialized View Site<a id="sthref907"></a></h3>
<p>You can use the query in this section to list the following general information about the current materialized view site:</p>
<ul>
<li>
<p>The number of materialized view groups at the site</p>
</li>
<li>
<p>The number of materialized views at the site</p>
</li>
<li>
<p>The number of refresh groups at the site</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN MVGROUP HEADING &#39;Number of|Materialized|View Groups&#39; FORMAT 9999
COLUMN MV HEADING &#39;Number of|Materialized|Views&#39; FORMAT 9999
COLUMN RGROUP HEADING &#39;Number of|Refresh Groups&#39; FORMAT 9999

SELECT A.MVGROUP, B.MV, C.RGROUP 
    FROM 
    (SELECT COUNT(S.GNAME) MVGROUP 
        FROM DBA_REPSITES S
        WHERE S.SNAPMASTER = &#39;Y&#39;) A, 
     (SELECT COUNT(*) MV 
        FROM DBA_MVIEWS) B, 
     (SELECT COUNT(*) RGROUP 
        FROM DBA_REFRESH) C;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">   Number of    Number of
Materialized Materialized      Number of
 View Groups        Views Refresh Groups
------------ ------------ --------------
           5           25              5
</pre></div>
<!-- class="sect2" -->
<a id="i43314"></a>
<div id="REPMA445" class="sect2">
<h3 class="sect2">Listing General Information About Materialized View Groups<a id="sthref908"></a></h3>
<p>You can use the query in this section to list the following general information about the materialized view groups at the current materialized view site:</p>
<ul>
<li>
<p>The name of each materialized view group</p>
</li>
<li>
<p>The master of each materialized view group</p>
</li>
<li>
<p>The method of propagation to a materialized view group<code dir="ltr">&#39;</code>s master, either asynchronous or synchronous</p>
</li>
<li>
<p>The comment associated with each materialized view group</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN GNAME HEADING &#39;Group Name&#39; FORMAT A10
COLUMN DBLINK HEADING &#39;Master&#39; FORMAT A25
COLUMN Propagation HEADING &#39;Propagation|Method&#39; FORMAT A12
COLUMN SCHEMA_COMMENT HEADING &#39;Comment&#39; FORMAT A30

SELECT S.GNAME, 
       S.DBLINK, 
       DECODE(S.PROP_UPDATES, 
              0, &#39;ASYNCHRONOUS&#39;, 
              1, &#39;SYNCHRONOUS&#39;) Propagation,
       G.SCHEMA_COMMENT 
    FROM DBA_REPSITES S, DBA_REPGROUP G
    WHERE S.GNAME = G.GNAME
    AND S.SNAPMASTER = &#39;Y&#39;;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                                     Propagation
Group Name Master                    Method       Comment
---------- ------------------------- ------------ ------------------------------
HR_REPG    ORC1.EXAMPLE.COM          ASYNCHRONOUS
</pre></div>
<!-- class="sect2" -->
<a id="i43315"></a>
<div id="REPMA446" class="sect2">
<h3 class="sect2">Listing Information About Materialized Views<a id="sthref909"></a></h3>
<p>This section contains queries that you can run to display information about the materialized views at a replication site.</p>
<div id="REPMA447" class="sect3"><a id="sthref910"></a>
<h4 class="sect3">Listing Master Information For Materialized Views</h4>
<p>The following query shows the master for each materialized view at a replication site and whether the materialized view can be fast refreshed:</p>
<pre dir="ltr">COLUMN MVIEW_NAME HEADING &#39;Materialized|View Name&#39; FORMAT A15
COLUMN OWNER HEADING &#39;Owner&#39; FORMAT A10
COLUMN MASTER_LINK HEADING &#39;Master Link&#39; FORMAT A30
COLUMN Fast_Refresh HEADING &#39;Fast|Refreshable?&#39; FORMAT A16

SELECT MVIEW_NAME, 
       OWNER, 
       MASTER_LINK,  
       DECODE(FAST_REFRESHABLE, 
              &#39;NO&#39;, &#39;NO&#39;,
              &#39;DML&#39;, &#39;YES&#39;,    
              &#39;DIRLOAD&#39;, &#39;DIRECT LOAD ONLY&#39;,
              &#39;DIRLOAD_DML&#39;, &#39;YES&#39;,
              &#39;DIRLOAD_LIMITEDDML&#39;, &#39;LIMITED&#39;) Fast_Refresh
    FROM DBA_MVIEWS;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Materialized                                              Fast
View Name       Owner      Master Link                    Refreshable?
--------------- ---------- ------------------------------ ----------------
COUNTRIES_MV1   HR         @ORC1.EXAMPLE.COM              YES
DEPARTMENTS_MV1 HR         @ORC1.EXAMPLE.COM              YES
EMPLOYEES_MV1   HR         @ORC1.EXAMPLE.COM              YES
JOBS_MV1        HR         @ORC1.EXAMPLE.COM              YES
JOB_HISTORY_MV1 HR         @ORC1.EXAMPLE.COM              YES
LOCATIONS_MV1   HR         @ORC1.EXAMPLE.COM              YES
REGIONS_MV1     HR         @ORC1.EXAMPLE.COM              YES
</pre></div>
<!-- class="sect3" -->
<div id="REPMA448" class="sect3"><a id="sthref911"></a>
<h4 class="sect3">Listing the Properties of Materialized Views</h4>
<p>You can use the query in this section to list the following information about the materialized views at the current replication site:</p>
<ul>
<li>
<p>The name of each materialized view</p>
</li>
<li>
<p>The owner of each materialized view</p>
</li>
<li>
<p>The refresh method used by each materialized view: <code dir="ltr">COMPLETE</code>, <code dir="ltr">FORCE</code>, <code dir="ltr">FAST</code>, or <code dir="ltr">NEVER</code></p>
</li>
<li>
<p>Whether a materialized view is updatable</p>
</li>
<li>
<p>The last date on which each materialized view was refreshed</p>
</li>
</ul>
<p>Run the following query to list this information:</p>
<pre dir="ltr">COLUMN MVIEW_NAME HEADING &#39;Materialized|View Name&#39; FORMAT A15
COLUMN OWNER HEADING &#39;Owner&#39; FORMAT A10
COLUMN REFRESH_METHOD HEADING &#39;Refresh|Method&#39; FORMAT A10
COLUMN UPDATABLE HEADING &#39;Updatable?&#39; FORMAT A10
COLUMN LAST_REFRESH_DATE HEADING &#39;Last|Refresh|Date&#39;
COLUMN LAST_REFRESH_TYPE HEADING &#39;Last|Refresh|Type&#39; FORMAT A15

SELECT MVIEW_NAME, 
       OWNER,
       REFRESH_METHOD, 
       UPDATABLE, 
       LAST_REFRESH_DATE, 
       LAST_REFRESH_TYPE
    FROM DBA_MVIEWS; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                                                 Last      Last
Materialized               Refresh               Refresh   Refresh
View Name       Owner      Method     Updatable? Date      Type
--------------- ---------- ---------- ---------- --------- ---------------
COUNTRIES_MV1   HR         FAST       Y          21-OCT-03 FAST
DEPARTMENTS_MV1 HR         FAST       Y          21-OCT-03 FAST
EMPLOYEES_MV1   HR         FAST       Y          21-OCT-03 FAST
JOBS_MV1        HR         FAST       Y          21-OCT-03 FAST
JOB_HISTORY_MV1 HR         FAST       Y          21-OCT-03 FAST
LOCATIONS_MV1   HR         FAST       Y          21-OCT-03 FAST
REGIONS_MV1     HR         FAST       Y          21-OCT-03 FAST
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i43340"></a>
<div id="REPMA449" class="sect2">
<h3 class="sect2">Listing Information About the Refresh Groups at a Materialized View Site<a id="sthref912"></a></h3>
<p>Each refresh group at a materialized view site is associated with a refresh job that refreshes the materialized views in the refresh group at a set interval. You can query the <code dir="ltr">DBA_REFRESH</code> data dictionary view to list the following information about the refresh jobs at a materialized view site:</p>
<ul>
<li>
<p>The name of the refresh group.</p>
</li>
<li>
<p>The owner of the refresh group.</p>
</li>
<li>
<p>Whether the refresh job is broken.</p>
</li>
<li>
<p>The next date and time when the refresh job will run.</p>
</li>
<li>
<p>The current interval setting for the refresh job. The interval setting specifies the amount of time between the start of a job and the next start of the same job.</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">COLUMN RNAME HEADING &#39;Refresh|Group|Name&#39; FORMAT A10
COLUMN ROWNER HEADING &#39;Refresh|Group|Owner&#39; FORMAT A10
COLUMN BROKEN HEADING &#39;Broken?&#39; FORMAT A7
COLUMN next_refresh HEADING &#39;Next Refresh&#39;
COLUMN INTERVAL HEADING &#39;Interval&#39; FORMAT A20

SELECT RNAME, 
               ROWNER, 
       BROKEN, 
       TO_CHAR(NEXT_DATE, &#39;DD-MON-YYYY HH:MI:SS AM&#39;) next_refresh, 
       INTERVAL 
    FROM DBA_REFRESH 
    ORDER BY 1;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Refresh    Refresh
Group      Group
Name       Owner      Broken? Next Refresh            Interval
---------- ---------- ------- ----------------------- --------------------
HR_REFG    MVIEWADMIN N       24-OCT-2003 07:18:44 AM SYSDATE + 1/24
</pre>
<p>The <code dir="ltr">N</code> in the <code dir="ltr">Broken?</code> column means that the job is not broken. Therefore, the refresh job will run at the next start time. A <code dir="ltr">Y</code> in this column means that the job is broken.</p>
</div>
<!-- class="sect2" -->
<a id="i43341"></a>
<div id="REPMA450" class="sect2">
<h3 class="sect2">Determining the Job ID for Each Refresh Job at a Materialized View Site<a id="sthref913"></a></h3>
<p>You can use the query in this section to list the following information about the refresh jobs at a materialized view site:</p>
<ul>
<li>
<p>The job identification number of each refresh job. Each job created by the <code dir="ltr">DBMS_JOB</code> package is assigned a unique identification number.</p>
</li>
<li>
<p>The privilege schema, which is the schema whose default privileges apply to the job.</p>
</li>
<li>
<p>The schema that owns each refresh job. Typically, the materialized view administrator owns a refresh job. A common user name for the materialized view administrator is <code dir="ltr">mviewadmin</code>.</p>
</li>
<li>
<p>The name of the refresh group that the job refreshes.</p>
</li>
<li>
<p>The status of the refresh job, either normal or broken.</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">COLUMN JOB HEADING &#39;Job ID&#39; FORMAT 999999
COLUMN PRIV_USER HEADING &#39;Privilege|Schema&#39; FORMAT A10
COLUMN RNAME HEADING &#39;Refresh|Group|Name&#39; FORMAT A10
COLUMN ROWNER HEADING &#39;Refresh|Group|Owner&#39; FORMAT A10
COLUMN BROKEN HEADING &#39;Broken?&#39; FORMAT A7

SELECT J.JOB, 
       J.PRIV_USER, 
       R.ROWNER, 
       R.RNAME, 
       J.BROKEN
    FROM DBA_REFRESH R, DBA_JOBS J 
    WHERE R.JOB = J.JOB
    ORDER BY 1;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">                   Refresh    Refresh
        Privilege  Group      Group
 Job ID Schema     Owner      Name       Broken?
------- ---------- ---------- ---------- -------
     21 MVIEWADMIN MVIEWADMIN HR_REFG    N
</pre>
<p>The <code dir="ltr">N</code> in the <code dir="ltr">Broken?</code> column means that the job is not broken. Therefore, the job will run at the next start time. A <code dir="ltr">Y</code> in this column means that the job is broken.</p>
</div>
<!-- class="sect2" -->
<a id="i43342"></a>
<div id="REPMA451" class="sect2">
<h3 class="sect2">Determining Which Materialized Views Are Currently Refreshing<a id="sthref914"></a></h3>
<p>The following query shows the materialized views that are currently refreshing:</p>
<pre dir="ltr">COLUMN SID HEADING &#39;Session|Identifier&#39; FORMAT 9999
COLUMN SERIAL# HEADING &#39;Serial|Number&#39; FORMAT 999999
COLUMN CURRMVOWNER HEADING &#39;Owner&#39; FORMAT A15
COLUMN CURRMVNAME HEADING &#39;Materialized|View&#39; FORMAT A25

SELECT * FROM V$MVREFRESH;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">   Session  Serial                 Materialized
Identifier  Number Owner           View
---------- ------- --------------- -------------------------
        19     233 HR              COUNTRIES_MV
         5     647 HR              EMPLOYEES_MV
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
The <code dir="ltr">V$MVREFRESH</code> dynamic performance view does not contain information about updatable materialized views when the materialized views&#39; deferred transactions are being pushed to its master.</div>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i32698"></a>
<div id="REPMA452" class="sect1">
<h2 class="sect1">Monitoring Administrative Requests<a id="sthref915"></a></h2>
<p>This section contains queries that you can run to display information about the administrative requests at a master site. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i43378">Listing General Information About Administrative Requests</a></p>
</li>
<li>
<p><a href="#i43379">Listing General Information About the Job that Executes Administrative Requests</a></p>
</li>
<li>
<p><a href="#i43379">Listing General Information About the Job that Executes Administrative Requests</a></p>
</li>
</ul>
<a id="i43378"></a>
<div id="REPMA453" class="sect2">
<h3 class="sect2">Listing General Information About Administrative Requests</h3>
<p>You can use the query in this section to list the following general information about the administrative requests at a master site:</p>
<ul>
<li>
<p>The identification number of each administrative request</p>
</li>
<li>
<p>The action requested by each administrative request</p>
</li>
<li>
<p>The status of each request</p>
</li>
<li>
<p>The master site where the request is being executed</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">COLUMN ID HEADING &#39;Admin|Request|ID&#39; FORMAT 999999
COLUMN REQUEST HEADING &#39;Request&#39; FORMAT A25
COLUMN STATUS HEADING &#39;Status&#39; FORMAT A15
COLUMN MASTER HEADING &#39;Master|Site&#39; FORMAT A25

SELECT ID, REQUEST, STATUS, MASTER FROM DBA_REPCATLOG;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">  Admin
Request                                           Master
     ID Request                   Status          Site
------- ------------------------- --------------- -------------------------
     44 RESUME_MASTER_ACTIVITY    AWAIT_CALLBACK  ORC3.EXAMPLE.COM
</pre>
<p>You can use the <code dir="ltr">DO_DEFERRED_REPCAT_ADMIN</code> procedure in the <code dir="ltr">DBMS_REPCAT</code> package to execute administrative requests.</p>
</div>
<!-- class="sect2" -->
<div id="REPMA454" class="sect2"><a id="sthref916"></a>
<h3 class="sect2">Determining the Cause of Administrative Request Errors<a id="sthref917"></a></h3>
<p>You can determine the cause of an administrative request error by displaying its error message. The following query displays the error message for each administrative request that resulted in an error:</p>
<pre dir="ltr">COLUMN ID HEADING &#39;Admin|Request|ID&#39; FORMAT 999999
COLUMN REQUEST HEADING &#39;Request&#39; FORMAT A30
COLUMN ERRNUM HEADING &#39;Error|Number&#39; FORMAT 999999
COLUMN MESSAGE HEADING &#39;Error|Message&#39; FORMAT A32

SELECT ID, REQUEST, ERRNUM, MESSAGE 
    FROM DBA_REPCATLOG WHERE STATUS = &#39;ERROR&#39;;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">  Admin
Request                                  Error Error
     ID Request                         Number Message
------- ------------------------------ ------- ------------------------------
     70 CREATE_MASTER_REPOBJECT          -2292 ORA-02292: integrity constrain
                                               t (HR.DEPT_LOC_FK) violated -
                                               child record found
                                               ORA-02266: unique/primary keys
                                                in table referenced by enable
                                               d foreign keys

     71 GENERATE_INTERNAL_PKG_SUPPORT   -23308 ORA-23308: object HR.LOCATIONS
                                                does not exist or is invalid
</pre></div>
<!-- class="sect2" -->
<a id="i43379"></a>
<div id="REPMA455" class="sect2">
<h3 class="sect2">Listing General Information About the Job that Executes Administrative Requests<a id="sthref918"></a></h3>
<p>Each master group is associated with a <code dir="ltr">do_deferred_repcat_admin</code> job that executes administrative requests. You can query the <code dir="ltr">DBA_JOBS</code> data dictionary view to list the following information about this job at a replication site:</p>
<ul>
<li>
<p>The job identification number of each <code dir="ltr">do_deferred_repcat_admin</code> job. Each job created by the <code dir="ltr">DBMS_JOB</code> package is assigned a unique identification number.</p>
</li>
<li>
<p>The privilege schema, which is the schema whose default privileges apply to the job.</p>
</li>
<li>
<p>The status of each <code dir="ltr">do_deferred_repcat_admin</code> job, either normal or broken.</p>
</li>
<li>
<p>The next date and time when each <code dir="ltr">do_deferred_repcat_admin</code> job will run.</p>
</li>
<li>
<p>The current interval setting for each <code dir="ltr">do_deferred_repcat_admin</code> job. The interval setting specifies the amount of time between the start of a job and the next start of the same job.</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">COLUMN JOB HEADING &#39;Job ID&#39; FORMAT 999999
COLUMN PRIV_USER HEADING &#39;Privilege|Schema&#39; FORMAT A10
COLUMN BROKEN HEADING &#39;Broken?&#39; FORMAT A7
COLUMN next_start HEADING &#39;Next Start&#39;
COLUMN INTERVAL HEADING &#39;Interval&#39; FORMAT A20

SELECT JOB, 
       PRIV_USER, 
       BROKEN, 
       TO_CHAR(NEXT_DATE,&#39;DD-MON-YYYY HH:MI:SS AM&#39;) next_start, 
       INTERVAL 
    FROM DBA_JOBS 
    WHERE WHAT LIKE &#39;%dbms_repcat.do_deferred_repcat_admin%&#39; 
    ORDER BY 1; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">        Privilege
 Job ID Schema     Broken? Next Start              Interval
------- ---------- ------- ----------------------- --------------------
     24 REPADMIN   N       24-OCT-2003 07:23:48 AM SYSDATE + (1/144)
</pre>
<p>The <code dir="ltr">N</code> in the <code dir="ltr">Broken?</code> column means that the job is not broken. Therefore, the job will run at the next start time. A <code dir="ltr">Y</code> in this column means that the job is broken.</p>
<div id="REPMA456" class="sect3"><a id="sthref919"></a>
<h4 class="sect3">Checking the Definition of Each do_deferred_repcat_admin Job</h4>
<p>You can query the <code dir="ltr">DBA_JOBS</code> data dictionary view to show the definition of each <code dir="ltr">do_deferred_repcat_admin</code> job at a replication site. The following query shows the definitions:</p>
<pre dir="ltr">COLUMN JOB HEADING &#39;Job ID&#39; FORMAT 999999
COLUMN WHAT HEADING &#39;Definitions of Admin Req Jobs&#39; FORMAT A70

SELECT JOB, WHAT 
  FROM DBA_JOBS 
  WHERE WHAT LIKE &#39;%dbms_repcat.do_deferred_repcat_admin%&#39; 
  ORDER BY 1;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr"> Job ID Definitions of Admin Req Jobs
------- ----------------------------------------------------------------------
    321 dbms_repcat.do_deferred_repcat_admin(&#39;&#34;HR_REPG&#34;&#39;, FALSE);
    342 dbms_repcat.do_deferred_repcat_admin(&#39;&#34;OE_RG&#34;&#39;, FALSE);
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i32690"></a>
<div id="REPMA457" class="sect1">
<h2 class="sect1">Monitoring the Deferred Transactions Queue<a id="sthref920"></a><a id="sthref921"></a></h2>
<p>This section contains queries that you can run to display information about the deferred transactions queue at a replication site. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i43426">Monitoring Transaction Propagation</a></p>
</li>
<li>
<p><a href="#i43427">Monitoring Purges of Successfully Propagated Transactions</a></p>
</li>
</ul>
<a id="i43426"></a>
<div id="REPMA458" class="sect2">
<h3 class="sect2">Monitoring Transaction Propagation</h3>
<p>This section contains queries that you can run to display information about propagation of transactions in the deferred transactions queue.</p>
<div id="REPMA459" class="sect3"><a id="sthref922"></a>
<h4 class="sect3">Listing the Number of Deferred Transactions for Each Destination Master Site</h4>
<p>You can find the number of unpropagated deferred transactions for each destination master site by running the query in this section. This query shows each master site to which the current master site is propagating deferred transactions and the number of deferred transactions to be propagated to each destination site.</p>
<p>Run the following query to see the number of deferred and error transactions:</p>
<pre dir="ltr">COLUMN DEST HEADING &#39;Destination&#39; FORMAT A45
COLUMN TRANS HEADING &#39;Def Trans&#39; FORMAT 9999
      
SELECT DBLINK DEST, COUNT(*) TRANS
    FROM DEFTRANDEST D 
    GROUP BY DBLINK;  
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Destination                                   Def Trans
--------------------------------------------- ---------
ORC2.EXAMPLE.COM                                      1
ORC3.EXAMPLE.COM                                      1
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
This query can be expensive if you have a large number of transactions waiting to be propagated.</div>
</div>
<!-- class="sect3" -->
<div id="REPMA460" class="sect3"><a id="sthref923"></a>
<h4 class="sect3">Listing General Information About the Push Jobs at a Replication Site<a id="sthref924"></a></h4>
<p>Each scheduled link at a replication site is associated with a push job that propagates deferred transactions in the deferred transaction queue to a destination site. You can use the query in this section to list the following information about the push jobs at a replication site:</p>
<ul>
<li>
<p>The job identification number of each push job. Each job created by the <code dir="ltr">DBMS_JOB</code> package is assigned a unique identification number.</p>
</li>
<li>
<p>The privilege schema, which is the schema whose default privileges apply to the job.</p>
</li>
<li>
<p>The destination site where the deferred transactions are pushed.</p>
</li>
<li>
<p>The status of the push job, either normal or broken.</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">COLUMN JOB HEADING &#39;Job ID&#39; FORMAT 999999
COLUMN PRIV_USER HEADING &#39;Privilege|Schema&#39; FORMAT A10
COLUMN DBLINK HEADING &#39;Destination&#39; FORMAT A40
COLUMN BROKEN HEADING &#39;Broken?&#39; FORMAT A7

SELECT J.JOB, 
       J.PRIV_USER, 
       S.DBLINK,
       J.BROKEN      
    FROM DEFSCHEDULE S, DBA_JOBS J 
    WHERE S.DBLINK != (SELECT GLOBAL_NAME FROM GLOBAL_NAME)
    AND S.JOB = J.JOB 
    ORDER BY 1; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">        Privilege
 Job ID Schema     Destination                              Broken?
------- ---------- ---------------------------------------- -------
     22 REPADMIN   ORC2.EXAMPLE.COM                         N
     23 REPADMIN   ORC3.EXAMPLE.COM                         N
</pre>
<p>The <code dir="ltr">N</code> in the <code dir="ltr">Broken?</code> column means that the job is not broken. Therefore, the job will run at the next start time. A <code dir="ltr">Y</code> in this column means that the job is broken.</p>
</div>
<!-- class="sect3" -->
<div id="REPMA461" class="sect3"><a id="sthref925"></a>
<h4 class="sect3">Determining the Next Start Time and Interval for the Push Jobs<a id="sthref926"></a></h4>
<p>Each scheduled link at a replication site is associated with a push job that propagates deferred transactions in the deferred transaction queue to a destination site. You can query the <code dir="ltr">DEFSCHEDULE</code> and <code dir="ltr">DBA_JOBS</code> data dictionary views to list the following information about the push jobs at a replication site:</p>
<ul>
<li>
<p>The job identification number of each push job. Each job created by the <code dir="ltr">DBMS_JOB</code> package is assigned a unique identification number.</p>
</li>
<li>
<p>The destination site where the deferred transactions are pushed.</p>
</li>
<li>
<p>The next date and time when the push job will run.</p>
</li>
<li>
<p>The current interval setting for the push job. The interval setting specifies the amount of time between the start of a job and the next start of the same job.</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">COLUMN JOB HEADING &#39;Job ID&#39; FORMAT 999999
COLUMN DBLINK HEADING &#39;Destination&#39; FORMAT A22
COLUMN next_start HEADING &#39;Next Start&#39;
COLUMN INTERVAL HEADING &#39;Interval&#39; FORMAT A25

SELECT JOB, 
       DBLINK,
       TO_CHAR(NEXT_DATE, &#39;DD-MON-YYYY HH:MI:SS AM&#39;) next_start, 
       INTERVAL       
    FROM DEFSCHEDULE
    WHERE DBLINK != (SELECT GLOBAL_NAME FROM GLOBAL_NAME)
    AND JOB IS NOT NULL 
    ORDER BY 1; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr"> Job ID Destination            Next Start              Interval
------- ---------------------- ----------------------- -------------------------
     22 ORC2.EXAMPLE.COM       24-OCT-2003 07:23:48 AM SYSDATE + (1/144)
     23 ORC3.EXAMPLE.COM       24-OCT-2003 07:23:48 AM SYSDATE + (1/144)
</pre></div>
<!-- class="sect3" -->
<div id="REPMA462" class="sect3"><a id="sthref927"></a>
<h4 class="sect3">Determining the Total Number of Transactions Queued for Propagation</h4>
<p>Run the following query to display the total number of transactions in the deferred transaction queue that are waiting to be propagated:</p>
<pre dir="ltr">SELECT COUNT(DISTINCT DEFERRED_TRAN_ID) &#34;Transactions Queued&#34; 
    FROM DEFTRANDEST;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Transactions Queued
-------------------
                 37
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
This query can be expensive if you have a large number of transactions waiting to be propagated.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i43427"></a>
<div id="REPMA463" class="sect2">
<h3 class="sect2">Monitoring Purges of Successfully Propagated Transactions<a id="sthref928"></a></h3>
<p>This section contains queries that you can run to display information about purges of successfully propagated transactions from the deferred transactions queue.</p>
<div id="REPMA464" class="sect3"><a id="sthref929"></a>
<h4 class="sect3">Listing General Information About the Purge Job<a id="sthref930"></a></h4>
<p>During standard setup of a replication site, you configure a purge job to remove successfully propagated transactions from the deferred transactions queue. You can query the <code dir="ltr">DBA_JOBS</code> data dictionary view to list the following information about the purge job at a replication site:</p>
<ul>
<li>
<p>The job identification number of the purge job. Each job created by the <code dir="ltr">DBMS_JOB</code> package is assigned a unique identification number.</p>
</li>
<li>
<p>The privilege schema, which is the schema whose default privileges apply to the job.</p>
</li>
<li>
<p>The status of the job, either normal or broken.</p>
</li>
<li>
<p>The next date and time when the purge job will run.</p>
</li>
<li>
<p>The current interval setting for the purge job. The interval setting specifies the amount of time between the start of a job and the next start of the same job.</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">COLUMN JOB HEADING &#39;Job ID&#39; FORMAT 999999
COLUMN PRIV_USER HEADING &#39;Privilege|Schema&#39; FORMAT A10
COLUMN BROKEN HEADING &#39;Broken?&#39; FORMAT A7
COLUMN next_start HEADING &#39;Next Start&#39;
COLUMN INTERVAL HEADING &#39;Interval&#39; FORMAT A25

SELECT JOB, 
       PRIV_USER, 
       BROKEN, 
       TO_CHAR(NEXT_DATE, &#39;DD-MON-YYYY HH:MI:SS AM&#39;) next_start, 
       INTERVAL
    FROM DBA_JOBS 
    WHERE WHAT LIKE &#39;%dbms_defer_sys.purge%&#39; 
    ORDER BY 1;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">        Privilege
 Job ID Schema     Broken? Next Start              Interval
------- ---------- ------- ----------------------- -------------------------
     21 REPADMIN   N       24-OCT-2003 07:42:18 AM SYSDATE + 1/24
</pre>
<p>The <code dir="ltr">N</code> in the <code dir="ltr">Broken?</code> column means that the job is not broken. Therefore, the job will run at the next start time. A <code dir="ltr">Y</code> in this column means that the job is broken.</p>
</div>
<!-- class="sect3" -->
<div id="REPMA465" class="sect3"><a id="sthref931"></a>
<h4 class="sect3">Checking the Definition of the Purge Job<a id="sthref932"></a></h4>
<p>You can query the <code dir="ltr">DBA_JOBS</code> data dictionary view to show the definition of the purge job at a replication site. The following query shows the definition:</p>
<pre dir="ltr">SELECT WHAT &#34;Definition of the Purge Job&#34; 
    FROM DBA_JOBS 
    WHERE WHAT LIKE &#39;%dbms_defer_sys.purge%&#39; ORDER BY 1;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Definition of the Purge Job
--------------------------------------------------------------------------------
declare rc binary_integer; begin rc := sys.dbms_defer_sys.purge( delay_seconds=&gt;
0); end;
</pre></div>
<!-- class="sect3" -->
<div id="REPMA466" class="sect3"><a id="sthref933"></a>
<h4 class="sect3">Determining the Amount of Time Since the Last Purge</h4>
<p>The following query shows the total amount of time, in minutes, since the successfully propagated transactions were purged from the deferred transactions queue:</p>
<pre dir="ltr">SELECT ((SYSDATE - LAST_PURGE_TIME) / 60) &#34;Minutes Since Last Purge&#34; 
    FROM V$REPLQUEUE; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Minutes Since Last Purge
------------------------
              13.43333
</pre></div>
<!-- class="sect3" -->
<div id="REPMA467" class="sect3"><a id="sthref934"></a>
<h4 class="sect3">Determining the Total Number of Purged Transactions</h4>
<p>The following query shows the total number of successfully propagated transactions that have been purged from the deferred transaction queue since the instance was last started:</p>
<pre dir="ltr">SELECT TXNS_PURGED &#34;Transactions Purged&#34; 
    FROM V$REPLQUEUE; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Transactions Purged
-------------------
               6541
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i32457"></a>
<div id="REPMA468" class="sect1">
<h2 class="sect1">Monitoring the Error Queue<a id="sthref935"></a><a id="sthref936"></a></h2>
<p>This section contains queries that you can run to display information about the error queue at a replication site. The error queue contains deferred transactions that resulted in an error at the destination site. These error transactions are placed in the error queue at the destination site.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i43445">Listing General Information About the Error Transactions at a Replication Site</a></p>
</li>
<li>
<p><a href="#i43486">Determining the Percentage of Error Transactions</a></p>
</li>
<li>
<p><a href="#i43487">Listing the Number of Error Transactions from Each Origin Master Site</a></p>
</li>
<li>
<p><a href="#i43488">Listing the Error Messages for the Error Transactions at a Replication Site</a></p>
</li>
<li>
<p><a href="#i43489">Determining the Error Operations at a Replication Site</a></p>
</li>
</ul>
<a id="i43445"></a>
<div id="REPMA469" class="sect2">
<h3 class="sect2">Listing General Information About the Error Transactions at a Replication Site</h3>
<p>The following query lists the general information about the error transactions at a replication site:</p>
<pre dir="ltr">COLUMN DEFERRED_TRAN_ID HEADING &#39;Deferred|Transaction|ID&#39; FORMAT A11
COLUMN ORIGIN_TRAN_DB HEADING &#39;Origin|Database&#39; FORMAT A15
COLUMN DESTINATION HEADING &#39;Destination|Database&#39; FORMAT A15
COLUMN TIME_OF_ERROR HEADING &#39;Time of|Error&#39; FORMAT A22
COLUMN ERROR_NUMBER HEADING &#39;Oracle|Error|Number&#39; FORMAT 999999

SELECT DEFERRED_TRAN_ID, 
       ORIGIN_TRAN_DB, 
       DESTINATION,
       TO_CHAR(START_TIME, &#39;DD-Mon-YYYY hh24:mi:ss&#39;) TIME_OF_ERROR,
       ERROR_NUMBER 
    FROM DEFERROR ORDER BY START_TIME;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Deferred                                                            Oracle
Transaction Origin           Destination      Time of                  Error
ID          Database         Database         Error                   Number
----------- ---------------- ---------------- ---------------------- -------
1.8.2470    ORC2.EXAMPLE.COM ORC1.EXAMPLE.COM 22-Oct-2003 07:19:14      1403
</pre>
<p>You can use the deferred transaction ID and the destination database to either attempt to rerun the transaction that caused the error or to delete the error.</p>
<p>For example, to attempt to rerun the transaction in the previous example, enter the following:</p>
<pre dir="ltr">EXECUTE DBMS_DEFER_SYS.EXECUTE_ERROR(&#39;1.8.2470&#39;, &#39;ORC1.EXAMPLE.COM&#39;);
</pre>
<p>To delete the error in the previous example, enter the following:</p>
<pre dir="ltr">EXECUTE DBMS_DEFER_SYS.DELETE_ERROR(&#39;1.8.2470&#39;, &#39;ORC1.EXAMPLE.COM&#39;);
</pre>
<p>Typically, you should delete an error only if you have resolved it manually.</p>
</div>
<!-- class="sect2" -->
<a id="i43486"></a>
<div id="REPMA470" class="sect2">
<h3 class="sect2">Determining the Percentage of Error Transactions</h3>
<p>When propagating transactions to a remote master site, some transactions are propagated and applied successfully while other transactions can result in errors at the remote master site. Transactions that result in errors are called error transactions.</p>
<p>Run the following query to display the percentage of error transactions that resulted from propagation to the remote master site <code dir="ltr">orc2.example.com</code>:</p>
<pre dir="ltr">SELECT DECODE(TOTAL_TXN_COUNT, 0, &#39;No Transactions&#39;, 
       (TOTAL_ERROR_COUNT/TOTAL_TXN_COUNT)*100) &#34;ERROR PERCENTAGE&#34; 
  FROM DEFSCHEDULE 
  WHERE DBLINK = &#39;ORC2.EXAMPLE.COM&#39;;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Error Percentage
----------------
           3.265
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If this query returns <code dir="ltr">&#39;No</code> <code dir="ltr">transactions&#39;</code>, then no transactions have been propagated to the specified remote site since the statistics were last cleared.</div>
</div>
<!-- class="sect2" -->
<a id="i43487"></a>
<div id="REPMA471" class="sect2">
<h3 class="sect2">Listing the Number of Error Transactions from Each Origin Master Site</h3>
<p>You can find the number of transaction errors resulting from pushes by each origin master site by running the query in this section.</p>
<p>Run the following query to see the number of deferred and error transactions:</p>
<pre dir="ltr">COLUMN SOURCE HEADING &#39;Origin&#39; FORMAT A45
COLUMN ERRORS HEADING &#39;Def Trans Errors&#39; FORMAT 9999

SELECT E.ORIGIN_TRAN_DB SOURCE, COUNT(*) ERRORS 
    FROM DEFERROR E 
    GROUP BY E.ORIGIN_TRAN_DB;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Origin                                        Def Trans Errors
--------------------------------------------- ----------------
ORC2.EXAMPLE.COM                                             1
ORC3.EXAMPLE.COM                                             3
</pre></div>
<!-- class="sect2" -->
<a id="i43488"></a>
<div id="REPMA472" class="sect2">
<h3 class="sect2">Listing the Error Messages for the Error Transactions at a Replication Site</h3>
<p>The following query lists the error messages for the error transactions at a replication site:</p>
<pre dir="ltr">COLUMN DEFERRED_TRAN_ID HEADING &#39;Deferred|Transaction|ID&#39; FORMAT A11
COLUMN ERROR_MSG HEADING &#39;Error Messages&#39; FORMAT A68

SELECT DEFERRED_TRAN_ID, ERROR_MSG 
    FROM DEFERROR;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Deferred
Transaction
ID          Error Messages
----------- --------------------------------------------------------------------
1.8.2470    ORA-01403: no data found
</pre></div>
<!-- class="sect2" -->
<a id="i43489"></a>
<div id="REPMA473" class="sect2">
<h3 class="sect2">Determining the Error Operations at a Replication Site</h3>
<p>The following query lists the type of operation that was attempted for each call that caused an error at a replication site:</p>
<pre dir="ltr">COLUMN CALLNO HEADING &#39;Call|Number&#39; FORMAT 9999
COLUMN DEFERRED_TRAN_ID HEADING &#39;Deferred|Transaction|ID&#39; FORMAT A11
COLUMN PACKAGENAME HEADING &#39;Package|Name&#39; FORMAT A20
COLUMN PROCNAME HEADING &#39;Operation&#39; FORMAT A15
COLUMN ORIGIN_TRAN_DB HEADING &#39;Origin|Database&#39; FORMAT A16

SELECT /*+ ORDERED */ 
       C.CALLNO, 
       C.DEFERRED_TRAN_ID, 
       C.PACKAGENAME,
       C.PROCNAME, E.ORIGIN_TRAN_DB
    FROM DEFERROR E, DEFCALL C
    WHERE C.DEFERRED_TRAN_ID = E.DEFERRED_TRAN_ID
    AND C.CALLNO = E.CALLNO
    ORDER BY E.START_TIME;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">       Deferred
  Call Transaction Package                              Origin
Number ID          Name                 Operation       Database
------ ----------- -------------------- --------------- ----------------
     0 1.8.2470    EMPLOYEES$RP         REP_UPDATE      ORC2.EXAMPLE.COM
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i35565"></a>
<div id="REPMA474" class="sect1">
<h2 class="sect1">Monitoring Performance in a Replication Environment<a id="sthref937"></a><a id="sthref938"></a></h2>
<p>This section contains queries that you can run to monitor the performance of your replication environment. This section contains the following topics:</p>
<ul>
<li>
<p><a href="#i43520">Tracking the Average Number of Row Changes in a Replication Transaction</a></p>
</li>
<li>
<p><a href="#i43521">Determining the Average Amount of Time to Apply Transactions at Remote Sites</a></p>
</li>
<li>
<p><a href="#i43522">Determining the Percentage of Time the Parallel Propagation Job Spends Sleeping</a></p>
</li>
<li>
<p><a href="#i43523">Clearing the Statistics for a Remote Master Site in the DEFSCHEDULE View</a></p>
</li>
<li>
<p><a href="#i43524">Monitoring Parallel Propagation of Deferred Transactions Using V$REPLPROP</a></p>
</li>
</ul>
<a id="i43520"></a>
<div id="REPMA475" class="sect2">
<h3 class="sect2">Tracking the Average Number of Row Changes in a Replication Transaction</h3>
<p>The following query shows the average number of row changes in a replication transaction since instance startup:</p>
<pre dir="ltr">SELECT DECODE(TXNS_ENQUEUED, 0, &#39;No Transactions Enqueued&#39;,
       (CALLS_ENQUEUED / TXNS_ENQUEUED)) &#34;Average Number of Row Changes&#34; 
  FROM V$REPLQUEUE;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Average Number of Row Changes
-----------------------------
                        56.16
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If this query returns <code dir="ltr">&#39;No</code> <code dir="ltr">Transactions</code> <code dir="ltr">Enqueued&#39;</code>, then no transactions have been enqueued since the start of the instance.</div>
</div>
<!-- class="sect2" -->
<div id="REPMA476" class="sect2"><a id="sthref939"></a>
<h3 class="sect2">Tracking the Rate of Transactions Entering the Deferred Transactions Queue</h3>
<p>The following query shows the average number of transactions for each second entering at the deferred transactions queue at the current site since instance startup:</p>
<pre dir="ltr">SELECT (R.TXNS_ENQUEUED / ((SYSDATE - I.STARTUP_TIME)*24*60*60)) &#34;Average TPS&#34; 
    FROM V$REPLQUEUE R, V$INSTANCE I;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Average TPS
-----------
        150
</pre></div>
<!-- class="sect2" -->
<div id="REPMA477" class="sect2"><a id="sthref940"></a>
<h3 class="sect2">Determining the Average Network Traffic Created to Propagate a Transaction</h3>
<p>Propagation of deferred transactions creates a certain amount of traffic on your network. Here, the network traffic created by a transaction is the number of bytes being sent and received and the number of network round trips needed to propagate the transaction.</p>
<p>A round trip is one or more consecutively sent messages followed by one or more consecutively received messages. For example, both of the following scenarios constitute only one round trip:</p>
<ul>
<li>
<p>Site A sends one message to site B and then site B sends one message to site A.</p>
</li>
<li>
<p>Site A sends 20 messages to site B and then site B sends one message to site A.</p>
</li>
</ul>
<p>These scenarios illustrate that the number of messages is irrelevant when evaluating the number of round trips, because the number of round trips is the number of back and forth communications between sites.</p>
<p>The following query shows the average network traffic created when propagating a transaction to the <code dir="ltr">orc2.example.com</code> remote master site:</p>
<pre dir="ltr">COLUMN AV_BYTES HEADING &#39;Average Bytes&#39; FORMAT 999999999
COLUMN AV_TRIPS HEADING &#39;Average Round Trips&#39; FORMAT 9999999

SELECT  
 DECODE(TOTAL_TXN_COUNT, 0, &#39;No Transactions&#39;,
 ((TOTAL_BYTES_SENT + TOTAL_BYTES_RECEIVED) / TOTAL_TXN_COUNT)) AV_BYTES, 
 DECODE(TOTAL_TXN_COUNT, 0, &#39;No Transactions&#39;, 
 (TOTAL_ROUND_TRIPS / TOTAL_TXN_COUNT)) AV_TRIPS 
 FROM DEFSCHEDULE WHERE DBLINK = &#39;ORC2.EXAMPLE.COM&#39;;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Average Bytes          Average Round Trips
---------------------- -------------------
69621.5                5
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
<ul>
<li>
<p>If this query returns <code dir="ltr">&#39;No</code> <code dir="ltr">transactions&#39;</code> in both columns, then no transactions have been propagated to the specified remote site since the statistics were last cleared.</p>
</li>
<li>
<p>This query returns results only if parallel propagation is used with the specified database link. To use parallel propagation, set the <code dir="ltr">parallelism</code> parameter to <code dir="ltr">1</code> or greater when you run the <code dir="ltr">SCHEDULE_PUSH</code> procedure in the <code dir="ltr">DBMS_DEFER_SYS</code> package.</p>
</li>
</ul>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a class="olink REPLN112" href="../REPLN/repplan.htm#REPLN112"><span class="italic">Oracle Database Advanced Replication</span></a> for information about parallel propagation</p>
</li>
<li>
<p><a href="rardefsyspac.htm#i94765">&#34;SCHEDULE_PUSH Procedure&#34;</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect2" -->
<a id="i43521"></a>
<div id="REPMA478" class="sect2">
<h3 class="sect2">Determining the Average Amount of Time to Apply Transactions at Remote Sites</h3>
<p>Average latency is the average number of seconds between the first call of a transaction on the current site and the confirmation that the transaction was applied at the remote site. The first call begins when the user makes the first data manipulation language (DML) change, not when the transaction is committed.</p>
<p>The following query shows the average latency for applying transactions at the remote master site <code dir="ltr">orc2.example.com</code>:</p>
<pre dir="ltr">SELECT AVG_LATENCY &#34;Average Latency&#34; 
    FROM DEFSCHEDULE 
    WHERE DBLINK=&#39;ORC2.EXAMPLE.COM&#39;; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Average Latency
---------------
           25.5
</pre></div>
<!-- class="sect2" -->
<a id="i43522"></a>
<div id="REPMA479" class="sect2">
<h3 class="sect2">Determining the Percentage of Time the Parallel Propagation Job Spends Sleeping<a id="sthref941"></a><a id="sthref942"></a><a id="sthref943"></a></h3>
<p>When the parallel propagation coordinator is inactive, it is sleeping. You control the amount of time that the propagation coordinator sleeps using the <code dir="ltr">delay_seconds</code> parameter in the <code dir="ltr">DBMS_DEFER_SYS.PUSH</code> procedure.</p>
<p>The following query shows the percentage of time that the parallel propagation coordinator spends sleeping when propagating transactions to the <code dir="ltr">orc2.example.com</code> remote master site:</p>
<pre dir="ltr">SELECT DECODE(AVG_THROUGHPUT, 0, NULL, 
       ((TOTAL_SLEEP_TIME / (TOTAL_TXN_COUNT / AVG_THROUGHPUT)) * 100)) 
       &#34;Percent Sleep Time&#34; 
  FROM DEFSCHEDULE WHERE DBLINK = &#39;ORC2.EXAMPLE.COM&#39;; 
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Percent Sleep Time
------------------
                 2
</pre>
<p>In this case, the parallel propagation coordinator is active 98% of the time.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If this query returns a <code dir="ltr">NULL</code>, then no transactions have been propagated to the specified remote site since the statistics were last cleared or since the last database startup.</div>
</div>
<!-- class="sect2" -->
<a id="i43523"></a>
<div id="REPMA480" class="sect2">
<h3 class="sect2">Clearing the Statistics for a Remote Master Site in the DEFSCHEDULE View<a id="sthref944"></a><a id="sthref945"></a><a id="sthref946"></a><a id="sthref947"></a><a id="sthref948"></a></h3>
<p>To clear the propagation statistics in the <code dir="ltr">DEFSCHEDULE</code> view for a particular remote master site, use the <code dir="ltr">CLEAR_PROP_STATISTICS</code> procedure in the <code dir="ltr">DBMS_DEFER_SYS</code> package. For example, to clear the propagation statistics for the <code dir="ltr">orc2.example.com</code> remote master site, run the following procedure:</p>
<pre dir="ltr">BEGIN
  <a href="rardefsyspac.htm#i96892">DBMS_DEFER_SYS.CLEAR_PROP_STATISTICS (</a>
   dblink =&gt; &#39;ORC2.EXAMPLE.COM&#39;);
END;
/
</pre></div>
<!-- class="sect2" -->
<a id="i43524"></a>
<div id="REPMA481" class="sect2">
<h3 class="sect2">Monitoring Parallel Propagation of Deferred Transactions Using V$REPLPROP<a id="sthref949"></a><a id="sthref950"></a><a id="sthref951"></a><a id="sthref952"></a></h3>
<p>The <code dir="ltr">V$REPLPROP</code> dynamic performance view provides information about current parallel propagation sessions.</p>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
The <code dir="ltr">V$REPLPROP</code> dynamic performance view is only relevant if you are using parallel propagation of deferred transactions. If you are using serial propagation, then this view is empty.</div>
<div id="REPMA482" class="sect3"><a id="sthref953"></a>
<h4 class="sect3">Determining the Databases to Which You Are Propagating Deferred Transactions</h4>
<p>Run the following query to list the database link of each database to which you are currently propagating deferred transactions using parallel propagation:</p>
<pre dir="ltr">SELECT DBLINK &#34;Database Link&#34;
    FROM V$REPLPROP 
    WHERE NAME LIKE &#39;%Coordinator%&#39;;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Database Link
-----------------
ORC2.EXAMPLE.COM
ORC3.EXAMPLE.COM
</pre></div>
<!-- class="sect3" -->
<div id="REPMA483" class="sect3"><a id="sthref954"></a>
<h4 class="sect3">Determining the Transactions Currently Being Propagated to a Remote Master</h4>
<p>You can list the following information about the transactions that are currently being propagated to a specified remote master site using parallel propagation:</p>
<ul>
<li>
<p>The transaction identification number of each transaction.</p>
</li>
<li>
<p>The number of calls in each transaction.</p>
</li>
<li>
<p>The percentage of processed calls in each transaction. The number in this column becomes larger as the calls in the transaction are processed. When the number reaches 100, all of the calls are processed.</p>
</li>
</ul>
<p>The following query displays this information:</p>
<pre dir="ltr">SELECT /*+ ORDERED */ P.XID &#34;Tran Being Propagated&#34;,
       (MAX(C.CALLNO) + 1) &#34;Number of Calls in Tran&#34;,
       (P.SEQUENCE/MAX(C.CALLNO) + 1) * 100 &#34;% Processed Calls&#34;
   FROM V$REPLPROP P, DEFCALL C
   WHERE P.NAME LIKE &#39;%SLAVE%&#39;
   AND P.DBLINK = &#39;mv4.example.com&#39;
   AND C.DEFERRED_TRAN_ID = P.XID
   GROUP BY P.XID, P.SEQUENCE;
</pre>
<p>Your output looks similar to the following:</p>
<pre dir="ltr">Tran Being Propagated  Number of Calls in Tran % Processed Calls
---------------------- ----------------------- -----------------
1.11.4264                                43357               78
1.15.4256                                23554               49
</pre>
<p>The transaction identification numbers should change as existing transactions are pushed and new transactions are processed. This query can be particularly useful if the any of the following conditions apply to your replication environment:</p>
<ul>
<li>
<p>You push a large number of transactions on a regular basis.</p>
</li>
<li>
<p>You have some transactions that are very large.</p>
</li>
<li>
<p>You are simulating continuous push using asynchronous propagation.</p>
</li>
</ul>
<p>If the first two bullets apply to your replication environment, then you can run this query to check if the processes are pushing the transactions. In this type of environment, the processes do not exist when they are not pushing transactions.</p>
<p>In replication environments that are simulating continuous push, the processes exist whenever there are transactions to push in the deferred transactions queue. When there are no transactions to push, the processes might not exist. So, when there are transactions to push, you can use this query to ensure that the processes exist and are processing the transactions.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REPLN100" href="../REPLN/repplan.htm#REPLN100"><span class="italic">Oracle Database Advanced Replication</span></a> for more information about scheduling continuous push in your replication environment</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment854">
<tr>
<td class="cellalignment863">
<table class="cellalignment859">
<tr>
<td class="cellalignment858"><a href="rarmanage.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment858"><a href="rarpart3.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment865">
<table class="cellalignment857">
<tr>
<td class="cellalignment858"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment858"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment858"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment858"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment858"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment858"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>