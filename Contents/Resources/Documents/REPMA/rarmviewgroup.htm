<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-91823"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Creating%20a%20Materialized%20View%20Group"></a><title>Creating a Materialized View Group</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1042"/>
<meta name="dcterms.created" content="2015-02-06T10:45:42Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Advanced Replication Management API Reference"/>
<meta name="dcterms.identifier" content="E18896-09"/>
<meta name="dcterms.isVersionOf" content="REPMA"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="rardt.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rarconflictres.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E18896-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">10/38</span> <!-- End Header -->
<div id="REPMA005" class="chapter"><a id="g29265"></a> <a id="i18374"></a>
<h1 class="chapter"><span class="secnum">5</span> Creating a Materialized View Group</h1>
<p>This chapter illustrates how to create a materialized view group at a remote materialized view replication site.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i17944">Overview of Creating a Materialized View Group</a></p>
</li>
<li>
<p><a href="#i15751">Creating a Materialized View Group</a></p>
</li>
</ul>
<p>Before you build materialized view environments, you must set up your master site, create a master group, and set up your intended materialized view sites. Also, if conflicts are possible at the master site due to activity at the materialized view sites you are creating, then configure conflict resolution for the master tables of the materialized views before you create the materialized view group.</p>
<div class="infoboxnotealso">
<p class="notep1"><span class="bold">See Also</span>:</p>
<ul>
<li>
<p><a href="rarrepsite.htm#i10539">&#34;Setting Up Master Sites&#34;</a></p>
</li>
<li>
<p><a href="rarmastergroup.htm#i1004580">&#34;Overview of Creating a Master Group&#34;</a></p>
</li>
<li>
<p><a href="rarrepsite.htm#i18551">&#34;Setting Up Materialized View Sites&#34;</a></p>
</li>
<li>
<p><a href="rarconflictres.htm#i21416">Chapter 6, &#34;Configuring Conflict Resolution&#34;</a></p>
</li>
</ul>
</div>
<a id="i17944"></a>
<div id="REPMA348" class="sect1">
<h2 class="sect1">Overview of Creating a Materialized View Group</h2>
<p>After setting up your materialized view site and creating at least one master group, you are ready to create a materialized view group at a remote materialized view site. <a href="#i11776">Figure 5-1</a> illustrates the process of creating a materialized view group.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rarrepsite.htm#g42343">Chapter 2, &#34;Configuring the Replication Sites&#34;</a> for information about setting up a materialized view site, and see <a href="rarmastergroup.htm#i1006038">Chapter 3, &#34;Creating a Master Group&#34;</a> for information about creating a master group.</div>
<div id="REPMA349" class="figure">
<p class="titleinfigure"><a id="i11776"></a>Figure 5-1 Creating a Materialized View Group</p>
<img width="600" height="600" src="img/repma027.gif" alt="Description of Figure 5-1 follows"/><br/>
<a id="sthref232" href="img_text/repma027.htm">Description of &#34;Figure 5-1 Creating a Materialized View Group&#34;</a><br/>
<br/></div>
<!-- class="figure" --></div>
<!-- class="sect1" -->
<a id="i15751"></a>
<div id="REPMA350" class="sect1">
<h2 class="sect1">Creating a Materialized View Group<a id="sthref233"></a><a id="sthref234"></a><a id="sthref235"></a><a id="sthref236"></a></h2>
<p>This chapter guides you through the process of creating two materialized view groups at two different materialized view sites: <code dir="ltr">mv1.example.com</code> and <code dir="ltr">mv2.example.com</code>:</p>
<ul>
<li>
<p>The materialized view group at <code dir="ltr">mv1.example.com</code> is based on the objects in the <code dir="ltr">hr_repg</code> master group at the <code dir="ltr">orc1.example.com</code> master site.</p>
</li>
<li>
<p>The materialized view group at <code dir="ltr">mv2.example.com</code> is based on the objects in the <code dir="ltr">hr_repg</code> materialized view group at the <code dir="ltr">mv1.example.com</code> materialized view site.</p>
</li>
</ul>
<p>Therefore, the examples in this chapter illustrate how to create a multitier materialized view environment, where one or more materialized views are based on other materialized views.</p>
<p>Complete the following steps to create these two materialized view groups.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are viewing this document online, then you can copy the text from the &#34;BEGINNING OF SCRIPT&#34; line after this note to the &#34;END OF SCRIPT&#34; line into a text editor and then edit the text to create a script for your environment.</div>
<pre dir="ltr">/************************* BEGINNING OF SCRIPT ******************************
</pre>
<div id="REPMA351" class="sect2"><a id="sthref237"></a>
<h3 class="sect2">Creating the Materialized View Group at mv1.example.com</h3>
<p>Complete the following steps to create the <code dir="ltr">hr_repg</code> materialized view group at the <code dir="ltr">mv1.example.com</code> materialized view site. This materialized view group is based on the <code dir="ltr">hr_repg</code> master group at the <code dir="ltr">orc1.example.com</code> master site.</p>
<dl>
<dd><a id="REPMA1134"></a><a id="sthref238"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Create materialized view logs at the master site.</dt>
<dd>
<p>If you want one of your master sites to support a materialized view site, then you must create materialized view logs for each master table that is replicated to a materialized view. Recall from <a href="rarrepsite.htm#i12880">Figure 2-1</a> that <code dir="ltr">orc1.example.com</code> serves as the target master site for the <code dir="ltr">mv1.example.com</code> materialized view site. The required materialized view logs must be created at <code dir="ltr">orc1.example.com</code>.</p>
<pre dir="ltr">*/

SET ECHO ON

SPOOL create_mv_group.out

CONNECT hr@orc1.example.com

CREATE MATERIALIZED VIEW LOG ON hr.countries;
CREATE MATERIALIZED VIEW LOG ON hr.departments;
CREATE MATERIALIZED VIEW LOG ON hr.employees;
CREATE MATERIALIZED VIEW LOG ON hr.jobs;
CREATE MATERIALIZED VIEW LOG ON hr.job_history;
CREATE MATERIALIZED VIEW LOG ON hr.locations;
CREATE MATERIALIZED VIEW LOG ON hr.regions;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The <code dir="ltr">CREATE</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code> statement in the <a class="olink SQLRF01303" href="../SQLRF/statements_6003.htm#SQLRF01303"><span class="italic">Oracle Database SQL Language Reference</span></a> for detailed information about this SQL statement</div>
</dd>
<dd><a id="REPMA1135"></a><a id="sthref239"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;If they do not exist, then create the replicated schema and its database link.</dt>
<dd>
<p>Before building your materialized view group, you must ensure that the replicated schema exists at the remote materialized view site and that the necessary database links have been created.</p>
<p>In this example, if the <code dir="ltr">hr</code> schema does not exist, then create the schema. If the <code dir="ltr">hr</code> schema exists at the materialized view site, then grant any necessary privileges and go to the next task in this step.</p>
<pre dir="ltr">*/

CONNECT system@mv1.example.com

CREATE TABLESPACE demo_mv1
 DATAFILE &#39;demo_mv1.dbf&#39; SIZE 10M AUTOEXTEND ON
 EXTENT MANAGEMENT LOCAL AUTOALLOCATE;

CREATE TEMPORARY TABLESPACE temp_mv1
 TEMPFILE &#39;temp_mv1.dbf&#39; SIZE 5M AUTOEXTEND ON;

ACCEPT password PROMPT &#39;Enter password for user: &#39; HIDE

CREATE USER hr IDENTIFIED BY &amp;password;

ALTER USER hr DEFAULT TABLESPACE demo_mv1
              QUOTA UNLIMITED ON demo_mv1;

ALTER USER hr TEMPORARY TABLESPACE temp_mv1;

GRANT 
  CREATE SESSION, 
  CREATE TABLE, 
  CREATE PROCEDURE, 
  CREATE SEQUENCE, 
  CREATE TRIGGER, 
  CREATE VIEW, 
  CREATE SYNONYM, 
  ALTER SESSION,
  CREATE MATERIALIZED VIEW,
  ALTER ANY MATERIALIZED VIEW,
  CREATE DATABASE LINK
 TO hr;

/*
</pre>
<pre dir="ltr"></pre>
<p><a id="i16254"></a>If it does not exist, then create the database link for the replicated schema.<a id="sthref240"></a><a id="sthref241"></a></p>
<p>Before building your materialized view group, you must ensure that the necessary database links exist for the replicated schema. The owner of the materialized views needs a database link pointing to the <code dir="ltr">proxy_refresher</code> that was created when the master site was set up.</p>
<pre dir="ltr">*/

CONNECT hr@mv1.example.com

CREATE DATABASE LINK orc1.example.com 
   CONNECT TO proxy_refresher IDENTIFIED BY &amp;password;

/*
</pre></dd>
<dd><a id="REPMA1136"></a><a id="sthref242"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Create the materialized view group<a class="dashingAutolink" name="autolink-91813"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref243"></a><a class="dashingAutolink" name="autolink-91814"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref244"></a>.</dt>
<dd>
<p>The following procedures must be executed by the materialized view administrator at the remote materialized view site.</p>
<pre dir="ltr">*/

CONNECT mviewadmin@mv1.example.com

/*
</pre>
<p>The master group that you specify in the <code dir="ltr">gname</code> parameter must match the name of the master group that you are replicating at the target master site.</p>
<pre dir="ltr">*/

BEGIN<a id="sthref245"></a><a id="sthref246"></a>
   <a href="rarrcatpac.htm#i106989">DBMS_REPCAT.CREATE_MVIEW_REPGROUP (</a>
      gname =&gt; &#39;hr_repg&#39;,
      master =&gt; &#39;orc1.example.com&#39;,
      propagation_mode =&gt; &#39;ASYNCHRONOUS&#39;);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1137"></a><a id="CHDCICJC"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Create the refresh group<a class="dashingAutolink" name="autolink-91815"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref247"></a><a class="dashingAutolink" name="autolink-91816"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref248"></a>.</dt>
<dd>
<p>All materialized views that are added to a particular refresh group are refreshed at the same time. This ensures transactional consistency between the related materialized views in the refresh group.</p>
<pre dir="ltr">*/

BEGIN<a id="sthref249"></a><a id="sthref250"></a>
   <a href="rarrefreshpac.htm#i94079">DBMS_REFRESH.MAKE (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;&#39;, 
      next_date =&gt; SYSDATE, 
      interval =&gt; &#39;SYSDATE + 1/24&#39;,
      implicit_destroy =&gt; FALSE, 
      rollback_seg =&gt; &#39;&#39;,
      push_deferred_rpc =&gt; TRUE, 
      refresh_after_errors =&gt; FALSE);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1138"></a><a id="sthref251"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Add objects to the materialized view group.</dt>
<dd>
<p>Create the materialized views based on the master tables.</p>
<p>Whenever you create a materialized view, always specify the schema name of the table owner in the query for the materialized view. In the following examples, <code dir="ltr">hr</code> is specified as the owner of the table in each query.</p>
<pre dir="ltr">*/

CREATE MATERIALIZED VIEW hr.countries_mv1 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.countries@orc1.example.com;

CREATE MATERIALIZED VIEW hr.departments_mv1 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.departments@orc1.example.com;

CREATE MATERIALIZED VIEW hr.employees_mv1 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.employees@orc1.example.com;

CREATE MATERIALIZED VIEW hr.jobs_mv1 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.jobs@orc1.example.com;

CREATE MATERIALIZED VIEW hr.job_history_mv1 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.job_history@orc1.example.com;

CREATE MATERIALIZED VIEW hr.locations_mv1 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.locations@orc1.example.com;

CREATE MATERIALIZED VIEW hr.regions_mv1 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.regions@orc1.example.com;

/*
</pre>
<p><a id="i11523"></a>Add the objects to the materialized view group<a id="sthref252"></a>.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;countries_mv1&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref253"></a><a id="sthref254"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;departments_mv1&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref255"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;employees_mv1&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref256"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;jobs_mv1&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref257"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;job_history_mv1&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref258"></a><a id="sthref259"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;locations_mv1&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref260"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;regions_mv1&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1139"></a><a id="CHDGBBJH"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Add objects to the refresh group<a class="dashingAutolink" name="autolink-91817"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref261"></a>.</dt>
<dd>
<p>All of the materialized view group objects that you add to the refresh group are refreshed at the same time to preserve referential integrity between related materialized views.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.countries_mv1&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.departments_mv1&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.employees_mv1&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.jobs_mv1&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.job_history_mv1&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.locations_mv1&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.regions_mv1&#39;,
      lax =&gt; TRUE);
END;
/

/*
</pre></dd>
</dl>
</div>
<!-- class="sect2" -->
<div id="REPMA352" class="sect2"><a id="sthref262"></a>
<h3 class="sect2">Creating the Materialized View Group at mv2.example.com</h3>
<p>Complete the following steps to create the <code dir="ltr">hr_repg</code> materialized view group at the <code dir="ltr">mv2.example.com</code> materialized view site. This materialized view group is based on the <code dir="ltr">hr_repg</code> materialized view group at the <code dir="ltr">mv1.example.com</code> materialized view site.</p>
<dl>
<dd><a id="REPMA1140"></a><a id="sthref263"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Create materialized view logs at the master materialized view site.</dt>
<dd>
<p>If you want one of your master materialized view sites to support another materialized view site, then you must create materialized view logs for each materialized view that is replicated to another materialized view site. Recall from <a href="rarrepsite.htm#i12880">Figure 2-1</a> that <code dir="ltr">mv1.example.com</code> serves as the target master internalized view site for the <code dir="ltr">mv2.example.com</code> materialized view site. The required materialized view logs must be created at <code dir="ltr">mv1.example.com</code>.</p>
<pre dir="ltr">*/

CONNECT hr@mv1.example.com

CREATE MATERIALIZED VIEW LOG ON hr.countries_mv1;
CREATE MATERIALIZED VIEW LOG ON hr.departments_mv1;
CREATE MATERIALIZED VIEW LOG ON hr.employees_mv1;
CREATE MATERIALIZED VIEW LOG ON hr.jobs_mv1;
CREATE MATERIALIZED VIEW LOG ON hr.job_history_mv1;
CREATE MATERIALIZED VIEW LOG ON hr.locations_mv1;
CREATE MATERIALIZED VIEW LOG ON hr.regions_mv1;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
The <code dir="ltr">CREATE</code> <code dir="ltr">MATERIALIZED</code> <code dir="ltr">VIEW</code> <code dir="ltr">LOG</code> statement in the <a class="olink SQLRF01303" href="../SQLRF/statements_6003.htm#SQLRF01303"><span class="italic">Oracle Database SQL Language Reference</span></a> for detailed information about this SQL statement</div>
</dd>
<dd><a id="REPMA1141"></a><a id="sthref264"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;If they do not exist, then create the replicated schema and its database link.</dt>
<dd>
<p>Before building your materialized view group, you must ensure that the replicated schema exists at the remote materialized view site and that the necessary database links have been created.</p>
<p>For this example, if the hr schema does not exist, then create the schema. If the hr schema exists at the materialized view site, then go to the next task in this step.</p>
<pre dir="ltr">*/

CONNECT system@mv2.example.com
CREATE TABLESPACE demo_mv2
 DATAFILE &#39;demo_mv2.dbf&#39; SIZE 10M AUTOEXTEND ON
 EXTENT MANAGEMENT LOCAL AUTOALLOCATE;

CREATE TEMPORARY TABLESPACE temp_mv2
 TEMPFILE &#39;temp_mv2.dbf&#39; SIZE 5M AUTOEXTEND ON;

ACCEPT password PROMPT &#39;Enter password for user: &#39; HIDE

CREATE USER hr IDENTIFIED BY &amp;password;

ALTER USER hr DEFAULT TABLESPACE demo_mv2
              QUOTA UNLIMITED ON demo_mv2;

ALTER USER hr TEMPORARY TABLESPACE temp_mv2;

GRANT 
  CREATE SESSION, 
  CREATE TABLE, 
  CREATE PROCEDURE, 
  CREATE SEQUENCE, 
  CREATE TRIGGER, 
  CREATE VIEW, 
  CREATE SYNONYM, 
  ALTER SESSION,
  CREATE MATERIALIZED VIEW,
  ALTER ANY MATERIALIZED VIEW,
  CREATE DATABASE LINK
 TO hr;

/*
</pre>
<p>If it does not exist, then create the database link for the replicated schema.<a id="sthref265"></a><a id="sthref266"></a></p>
<p>Before building your materialized view group, you must ensure that the necessary database links exist for the replicated schema. The owner of the materialized views needs a database link pointing to the <code dir="ltr">proxy_refresher</code> that was created when the master materialized view site was set up.</p>
<pre dir="ltr">*/

CONNECT hr@mv2.example.com

CREATE DATABASE LINK mv1.example.com 
   CONNECT TO proxy_refresher IDENTIFIED BY &amp;password;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
Step <a href="rarrepsite.htm#CIAJIEFG">6</a> for more information about creating proxy master materialized view site users</div>
</dd>
<dd><a id="REPMA1142"></a><a id="sthref267"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Create the materialized view group<a class="dashingAutolink" name="autolink-91818"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref268"></a><a class="dashingAutolink" name="autolink-91819"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref269"></a>.</dt>
<dd>
<p>The following procedures must be executed by the materialized view administrator at the remote materialized view site.</p>
<pre dir="ltr">*/

CONNECT mviewadmin@mv2.example.com

/*
</pre>
<p>The replication group that you specify in the <code dir="ltr">gname</code> parameter must match the name of the replication group that you are replicating at the target master materialized view site.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatpac.htm#i106989">DBMS_REPCAT.CREATE_MVIEW_REPGROUP (</a>
      gname =&gt; &#39;hr_repg&#39;,
      master =&gt; &#39;mv1.example.com&#39;,
      propagation_mode =&gt; &#39;ASYNCHRONOUS&#39;);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1143"></a><a id="sthref270"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Create the refresh group<a class="dashingAutolink" name="autolink-91820"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref271"></a><a class="dashingAutolink" name="autolink-91821"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref272"></a>.</dt>
<dd>
<p>All materialized views that are added to a particular refresh group are refreshed at the same time. This ensures transactional consistency between the related materialized views in the refresh group.</p>
<pre dir="ltr">*/

BEGIN<a id="sthref273"></a><a id="sthref274"></a>
   <a href="rarrefreshpac.htm#i94079">DBMS_REFRESH.MAKE (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;&#39;, 
      next_date =&gt; SYSDATE, 
      interval =&gt; &#39;SYSDATE + 1/24&#39;,
      implicit_destroy =&gt; FALSE, 
      rollback_seg =&gt; &#39;&#39;,
      push_deferred_rpc =&gt; TRUE, 
      refresh_after_errors =&gt; FALSE);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1144"></a><a id="sthref275"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Add objects to the materialized view group.</dt>
<dd>
<p>Create the materialized views based on the master materialized views.</p>
<p>Whenever you create a materialized view that is based on another materialized view, always specify the schema name of the materialized view owner in the query for the materialized view. In the following examples, <code dir="ltr">hr</code> is specified as the owner of the materialized view in each query.</p>
<pre dir="ltr">*/

CREATE MATERIALIZED VIEW hr.countries_mv2 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.countries_mv1@mv1.example.com;

CREATE MATERIALIZED VIEW hr.departments_mv2 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.departments_mv1@mv1.example.com;

CREATE MATERIALIZED VIEW hr.employees_mv2 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.employees_mv1@mv1.example.com;

CREATE MATERIALIZED VIEW hr.jobs_mv2 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.jobs_mv1@mv1.example.com;

CREATE MATERIALIZED VIEW hr.job_history_mv2 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.job_history_mv1@mv1.example.com;

CREATE MATERIALIZED VIEW hr.locations_mv2 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.locations_mv1@mv1.example.com;

CREATE MATERIALIZED VIEW hr.regions_mv2 
  REFRESH FAST WITH PRIMARY KEY FOR UPDATE 
  AS SELECT * FROM hr.regions_mv1@mv1.example.com;

/*
</pre>
<p>Add the materialized views to the materialized view group<a id="sthref276"></a>.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref277"></a><a id="sthref278"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;countries_mv2&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref279"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;departments_mv2&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref280"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;employees_mv2&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref281"></a><a id="sthref282"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;jobs_mv2&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref283"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;job_history_mv2&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref284"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;locations_mv2&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrcatpac.htm#i107165">DBMS_REPCAT.CREATE_MVIEW_REPOBJECT (</a><a id="sthref285"></a>
      gname =&gt; &#39;hr_repg&#39;,
      sname =&gt; &#39;hr&#39;,
      oname =&gt; &#39;regions_mv2&#39;,
      type =&gt; &#39;SNAPSHOT&#39;,
      min_communication =&gt; TRUE);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1145"></a><a id="sthref286"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Add objects to the refresh group<a class="dashingAutolink" name="autolink-91822"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref287"></a>.</dt>
<dd>
<p>All of the materialized view group objects that you add to the refresh group are refreshed at the same time to preserve referential integrity between related materialized views.</p>
<pre dir="ltr">*/

BEGIN<a id="sthref288"></a><a id="sthref289"></a>
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.countries_mv2&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.departments_mv2&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.employees_mv2&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.jobs_mv2&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.job_history_mv2&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.locations_mv2&#39;,
      lax =&gt; TRUE);
END;
/

BEGIN
   <a href="rarrefreshpac.htm#i93894">DBMS_REFRESH.ADD (</a>
      name =&gt; &#39;mviewadmin.hr_refg&#39;,
      list =&gt; &#39;hr.regions_mv2&#39;,
      lax =&gt; TRUE);
END;
/

SET ECHO OFF

SPOOL OFF

<a id="i16042"></a>/************************* END OF SCRIPT **********************************/
</pre></dd>
</dl>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment854">
<tr>
<td class="cellalignment863">
<table class="cellalignment859">
<tr>
<td class="cellalignment858"><a href="rardt.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment858"><a href="rarconflictres.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment865">
<table class="cellalignment857">
<tr>
<td class="cellalignment858"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment858"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment858"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment858"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment858"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment858"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>