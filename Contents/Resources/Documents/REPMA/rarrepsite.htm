<!DOCTYPE html><html lang="en"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<a class="dashingAutolink" name="autolink-91881"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Configuring%20the%20Replication%20Sites"></a><title>Configuring the Replication Sites</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1042"/>
<meta name="dcterms.created" content="2015-02-06T10:45:41Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Advanced Replication Management API Reference"/>
<meta name="dcterms.identifier" content="E18896-09"/>
<meta name="dcterms.isVersionOf" content="REPMA"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;1996, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="raroverview.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rarmastergroup.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E18896-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">7/38</span> <!-- End Header -->
<div id="REPMA002" class="chapter"><a id="g42343"></a> <a id="i19247"></a>
<h1 class="chapter"><span class="secnum">2</span> Configuring the Replication Sites</h1>
<p>This chapter illustrates how to set up both a master site and a materialized view replication site using the replication management API.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i14525">Overview of Setting Up Replication Sites</a></p>
</li>
<li>
<p><a href="#i10539">Setting Up Master Sites</a></p>
</li>
<li>
<p><a href="#i18551">Setting Up Materialized View Sites</a></p>
</li>
</ul>
<a id="i14525"></a>
<div id="REPMA323" class="sect1">
<h2 class="sect1">Overview of Setting Up Replication Sites<a id="sthref12"></a><a id="sthref13"></a><a id="sthref14"></a></h2>
<p>Before you build your replication environment, you must set up the sites that will participate in the replication environment. As illustrated in <a href="#CIAFGBDJ">Figure 2-2</a> and <a href="#i25796">Figure 2-3</a>, there are separate processes for setting up a master site versus setting up a materialized view site.</p>
<p>The examples in this book use the following databases:</p>
<ul>
<li>
<p><code dir="ltr">orc1.example.com</code></p>
</li>
<li>
<p><code dir="ltr">orc2.example.com</code></p>
</li>
<li>
<p><code dir="ltr">orc3.example.com</code></p>
</li>
<li>
<p><code dir="ltr">orc4.example.com</code></p>
</li>
<li>
<p><code dir="ltr">orc5.example.com</code></p>
</li>
<li>
<p><code dir="ltr">mv1.example.com</code></p>
</li>
<li>
<p><code dir="ltr">mv2.example.com</code></p>
</li>
</ul>
<p>Chapters 2 - 6 work with the replication environment illustrated in <a href="#i12880">Figure 2-1</a>. You start to create this environment using the instructions in this chapter. Notice that <code dir="ltr">mv2.example.com</code> is a materialized view based on the <code dir="ltr">mv1.example.com</code> materialized view, creating a multitier materialized view environment. The arrows in <a href="#i12880">Figure 2-1</a> represent database links.</p>
<div id="REPMA324" class="figure">
<p class="titleinfigure"><a id="i12880"></a>Figure 2-1 Three Master Sites and Two Materialized View Sites</p>
<img width="525" height="254" src="img/repma011.gif" alt="Description of Figure 2-1 follows"/><br/>
<a id="sthref15" href="img_text/repma011.htm">Description of &#34;Figure 2-1 Three Master Sites and Two Materialized View Sites&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<p>Follow the procedures identified in <a href="#CIAFGBDJ">Figure 2-2</a> when you build a new master site or in <a href="#i25796">Figure 2-3</a> when you build a new materialized view site.</p>
<div id="REPMA325" class="figure">
<p class="titleinfigure"><a id="CIAFGBDJ"></a>Figure 2-2 Setting Up Master Sites<a id="sthref16"></a></p>
<img width="600" height="600" src="img/repma014.gif" alt="Description of Figure 2-2 follows"/><br/>
<a id="sthref17" href="img_text/repma014.htm">Description of &#34;Figure 2-2 Setting Up Master Sites&#34;</a><br/>
<br/></div>
<!-- class="figure" --></div>
<!-- class="sect1" -->
<a id="i10539"></a>
<div id="REPMA125" class="sect1">
<h2 class="sect1"><a id="sthref18"></a>Setting Up Master Sites</h2>
<p>The following sections contain step-by-step instructions for setting up the three master sites in our sample replication environment: <code dir="ltr">orc1.example.com</code>, <code dir="ltr">orc2.example.com</code>, and <code dir="ltr">orc3.example.com</code>. Before you set up the master sites, configure your network and Oracle Net so that all three databases can communicate with each other.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are viewing this document online, then you can copy the text from the &#34;BEGINNING OF SCRIPT&#34; line after this note to the &#34;END OF SCRIPT&#34; line into a text editor and then edit the text to create a script for your environment.</div>
<pre dir="ltr">/************************* BEGINNING OF SCRIPT ******************************
</pre>
<a id="i24527"></a>
<div id="REPMA326" class="sect2">
<h3 class="sect2">Setting Up orc1.example.com</h3>
<p>Complete the following steps to set up the <code dir="ltr">orc1.example.com</code> master site.</p>
<dl>
<dd><a id="REPMA1085"></a><a id="CIAJIDDH"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Connect as SYSTEM at a master site at orc1.example.com.</dt>
<dd>
<p>Connect as <code dir="ltr">SYSTEM</code> to the database that you want to set up for replication. After you set up <code dir="ltr">orc1.example.com</code>, begin again with Step <a href="#CIAFHBHE">1</a> for site <code dir="ltr">orc2.example.com</code> and Step <a href="#CIAJAJEF">1</a> for site <code dir="ltr">orc3.example.com</code>.</p>
<pre dir="ltr">*/

SET ECHO ON

SPOOL setup_masters.out

CONNECT system@orc1.example.com

/*
</pre></dd>
<dd><a id="REPMA1086"></a><a id="sthref19"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Create the replication administrator at orc1.example.com.</dt>
<dd>
<p>The replication administrator must be granted the necessary privileges to create and manage a replication environment. The replication administrator must be created at each database that participates in the replication environment.</p>
<pre dir="ltr">*/

ACCEPT password PROMPT &#39;Enter password for user: &#39; HIDE

CREATE USER repadmin IDENTIFIED BY &amp;password;

/*
</pre>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
Enter an appropriate password for the administrative user.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DBSEG33223" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for guidelines for choosing passwords</div>
</dd>
<dd><a id="REPMA1087"></a><a id="sthref20"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Grant privileges to the replication administrator at orc1.example.com.</dt>
<dd>
<p>Execute the <code dir="ltr">GRANT_ADMIN_ANY_SCHEMA</code> procedure to grant the replication administrator powerful privileges to create and manage a replicated environment.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatadminpac.htm#i93879">DBMS_REPCAT_ADMIN.GRANT_ADMIN_ANY_SCHEMA (</a><a id="sthref21"></a><a id="sthref22"></a>
      username =&gt; &#39;repadmin&#39;);
END;
/

/*
</pre>
<p><a id="i24321"></a>If you want your <code dir="ltr">repadmin</code> to be able to create materialized view logs for any replicated table, then grant <code dir="ltr">COMMENT</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> and <code dir="ltr">LOCK</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> to <code dir="ltr">repadmin</code>:</p>
<pre dir="ltr">*/

GRANT COMMENT ANY TABLE TO repadmin;
GRANT LOCK ANY TABLE TO repadmin;

/*
</pre>
<p>If you want your <code dir="ltr">repadmin</code> to be able to connect to the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT</code> <code dir="ltr">ANY</code> <code dir="ltr">DICTIONARY</code> to <code dir="ltr">repadmin</code>:</p>
<pre dir="ltr">*/

GRANT SELECT ANY DICTIONARY TO repadmin;

/*
</pre></dd>
<dd><a id="REPMA1088"></a><a id="sthref23"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Register the propagator at<a class="dashingAutolink" name="autolink-91838"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref24"></a><a class="dashingAutolink" name="autolink-91839"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref25"></a> orc1.example.com.</dt>
<dd>
<p>The propagator is responsible for propagating the deferred transaction queue to other master sites.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rardefsyspac.htm#i94654">DBMS_DEFER_SYS.REGISTER_PROPAGATOR (</a><a id="sthref26"></a><a id="sthref27"></a>
      username =&gt; &#39;repadmin&#39;);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1089"></a><a id="CIADHFDA"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Register the receiver <a class="dashingAutolink" name="autolink-91840"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref28"></a><a class="dashingAutolink" name="autolink-91841"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref29"></a>at<a class="dashingAutolink" name="autolink-91842"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref30"></a><a class="dashingAutolink" name="autolink-91843"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref31"></a> orc1.example.com.</dt>
<dd>
<p>The receiver receives the propagated deferred transactions sent by the propagator from other master sites.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a><a id="sthref32"></a><a id="sthref33"></a>
      username =&gt; &#39;repadmin&#39;,
      privilege_type =&gt; &#39;receiver&#39;,
      list_of_gnames =&gt; NULL);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1090"></a><a id="sthref34"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;<a class="dashingAutolink" name="autolink-91844"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref35"></a><a class="dashingAutolink" name="autolink-91845"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref36"></a><a class="dashingAutolink" name="autolink-91846"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref37"></a>Schedule purge at master site orc1.example.com.</dt>
<dd>
<p>To keep the size of the deferred transaction queue in check, purge successfully completed deferred transactions. The <code dir="ltr">SCHEDULE_PURGE</code> procedure automates the purge process for you. You must execute this procedure as the replication administrator.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
Date expressions are used for the <code dir="ltr">NEXT_DATE</code> and <code dir="ltr">INTERVAL</code> parameters. For example:
<ul>
<li>
<p>Now is specified as: <code dir="ltr">SYSDATE</code></p>
</li>
<li>
<p>An interval of one hour is specified as: <code dir="ltr">SYSDATE + 1/24</code></p>
</li>
<li>
<p>An interval of seven days could be specified as: <code dir="ltr">SYSDATE + 7</code></p>
</li>
</ul>
</div>
<pre dir="ltr">*/

CONNECT repadmin@orc1.example.com

BEGIN
   <a href="rardefsyspac.htm#i94701">DBMS_DEFER_SYS.SCHEDULE_PURGE (</a><a id="sthref38"></a><a id="sthref39"></a>
      next_date =&gt; SYSDATE,
      interval =&gt; &#39;SYSDATE + 1/24&#39;,
      delay_seconds =&gt; 0);
END;
/

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN" href="../ADMIN/toc.htm"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> and <a class="olink SQLRF" href="../SQLRF/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about date expressions</div>
</dd>
<dd><a id="REPMA1091"></a><a id="CIAGHHGJ"></a></dd>
<dt class="seghead">Step 7&nbsp;&nbsp;&nbsp;Create proxy master site users<a class="dashingAutolink" name="autolink-91847"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref40"></a><a class="dashingAutolink" name="autolink-91848"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref41"></a><a class="dashingAutolink" name="autolink-91849"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref42"></a> at orc1.example.com.</dt>
<dd>
<p>If you plan to create materialized view sites based on this master site, then create proxy master site users<a id="sthref43"></a><a id="sthref44"></a><a id="sthref45"></a> at <code dir="ltr">orc1.example.com</code> that correspond to users at the materialized view site.</p>
<p>Create the proxy materialized view administrator.</p>
<p>The proxy materialized view administrator performs tasks at the target master site on behalf of the materialized view administrator at the materialized view site.</p>
<pre dir="ltr">*/

CONNECT system@orc1.example.com

CREATE USER proxy_mviewadmin IDENTIFIED BY &amp;password;

BEGIN
   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a><a id="sthref46"></a><a id="sthref47"></a>
      username =&gt; &#39;proxy_mviewadmin&#39;,
      privilege_type =&gt; &#39;proxy_snapadmin&#39;,
      list_of_gnames =&gt; NULL);
END;
/

-- Place GRANT SELECT_CATALOG_ROLE statement here if necessary.

/*
</pre>
<p>If you want your materialized view administrator at materialized view sites to be able to perform administrative operations using the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT_CATALOG_ROLE</code> to <code dir="ltr">proxy_mviewadmin</code>:</p>
<pre dir="ltr">GRANT SELECT_CATALOG_ROLE TO proxy_mviewadmin;
</pre>
<p>Granting this privilege to the <code dir="ltr">proxy_mviewadmin</code> is not required if you do not plan to use the Advanced Replication interface in Oracle Enterprise Manager Cloud Control. However, if you plan to use the Advanced Replication interface, then move the <code dir="ltr">GRANT</code> statement to the line directly after the previous <code dir="ltr">REGISTER_USER_REPGROUP</code> statement.</p>
<p>Create the proxy refresher.</p>
<p>The proxy refresher performs tasks at the master site on behalf of the refresher at the materialized view site.</p>
<pre dir="ltr">*/

CREATE USER proxy_refresher IDENTIFIED BY &amp;password;

GRANT CREATE SESSION TO proxy_refresher;
GRANT SELECT ANY TABLE TO proxy_refresher;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rarsec.htm#i5477">&#34;Security Setup for Materialized View Replication&#34;</a></div>
</dd>
</dl>
</div>
<!-- class="sect2" -->
<div id="REPMA327" class="sect2"><a id="sthref48"></a>
<h3 class="sect2">Setting Up orc2.example.com</h3>
<p>Complete the following steps to set up the <code dir="ltr">orc2.example.com</code> master site.</p>
<a id="i25309"></a>
<dl>
<dd><a id="REPMA1092"></a><a id="CIAFHBHE"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Connect as SYSTEM at orc2.example.com.</dt>
<dd>
<p>You must connect as <code dir="ltr">SYSTEM</code> to the database that you want to set up for replication. After you set up <code dir="ltr">orc2.example.com</code>, begin with Step <a href="#CIAJAJEF">1</a> for site <code dir="ltr">orc3.example.com</code>.</p>
<pre dir="ltr">*/

CONNECT system@orc2.example.com

/*
</pre></dd>
<dd><a id="REPMA1093"></a><a id="sthref49"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Create the replication administrator at orc2.example.com.</dt>
<dd>
<p>The replication administrator must be granted the necessary privileges to create and manage a replication environment. The replication administrator must be created at each database that participates in the replication environment.</p>
<pre dir="ltr">*/

CREATE USER repadmin IDENTIFIED BY &amp;password;

/*
</pre>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
Enter an appropriate password for the administrative user.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DBSEG33223" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for guidelines for choosing passwords</div>
</dd>
<dd><a id="REPMA1094"></a><a id="sthref50"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Grant privileges to replication administrator at orc2.example.com.</dt>
<dd>
<p>Execute the <code dir="ltr">GRANT_ADMIN_ANY_SCHEMA</code> procedure to grant the replication administrator powerful privileges to create and manage a replicated environment.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatadminpac.htm#i93879">DBMS_REPCAT_ADMIN.GRANT_ADMIN_ANY_SCHEMA (</a>
      username =&gt; &#39;repadmin&#39;);
END;
/

/*
</pre>
<p>If you want your <code dir="ltr">repadmin</code> to be able to create materialized view logs for any replicated table, then grant <code dir="ltr">COMMENT</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> and <code dir="ltr">LOCK</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> privileges to <code dir="ltr">repadmin</code>:</p>
<pre dir="ltr">*/

GRANT COMMENT ANY TABLE TO repadmin;
GRANT LOCK ANY TABLE TO repadmin;

/*
</pre>
<p>If you want your <code dir="ltr">repadmin</code> to be able to connect to the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT</code> <code dir="ltr">ANY</code> <code dir="ltr">DICTIONARY</code> to <code dir="ltr">repadmin</code>:</p>
<pre dir="ltr">*/

GRANT SELECT ANY DICTIONARY TO repadmin;

/*
</pre></dd>
<dd><a id="REPMA1095"></a><a id="sthref51"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Register the propagator at orc2.example.com.</dt>
<dd>
<p>The propagator is responsible for propagating the deferred transaction queue to other master sites.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rardefsyspac.htm#i94654">DBMS_DEFER_SYS.REGISTER_PROPAGATOR (</a>
      username =&gt; &#39;repadmin&#39;);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1096"></a><a id="sthref52"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Register the receiver at orc2.example.com.</dt>
<dd>
<p>The receiver receives the propagated deferred transactions sent by the propagator from the other master sites.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a>
      username =&gt; &#39;repadmin&#39;,
      privilege_type =&gt; &#39;receiver&#39;,
      list_of_gnames =&gt; NULL);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1097"></a><a id="sthref53"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Schedule purge at master site at orc2.example.com.</dt>
<dd>
<p>To keep the size of the deferred transaction queue in check, purge successfully completed deferred transactions. The <code dir="ltr">SCHEDULE_PURGE</code> procedure automates the purge process for you. You must execute this procedure as the replication administrator.</p>
<pre dir="ltr">*/

CONNECT repadmin@orc2.example.com

BEGIN
   <a href="rardefsyspac.htm#i94701">DBMS_DEFER_SYS.SCHEDULE_PURGE (</a>
      next_date =&gt; SYSDATE,
      interval =&gt; &#39;SYSDATE + 1/24&#39;,
      delay_seconds =&gt; 0);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1098"></a><a id="sthref54"></a></dd>
<dt class="seghead">Step 7&nbsp;&nbsp;&nbsp;Create proxy master site users<a class="dashingAutolink" name="autolink-91850"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref55"></a><a class="dashingAutolink" name="autolink-91851"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref56"></a><a class="dashingAutolink" name="autolink-91852"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref57"></a> at orc2.example.com.</dt>
<dd>
<p>If you plan to create materialized view sites based on this master site, then create proxy master site users<a id="sthref58"></a><a id="sthref59"></a><a id="sthref60"></a> at <code dir="ltr">orc2.example.com</code> that correspond to users at the materialized view site.</p>
<p>Create the proxy materialized view administrator.</p>
<p>The proxy materialized view administrator performs tasks at the target master site on behalf of the materialized view administrator at the materialized view site.</p>
<pre dir="ltr">*/

CONNECT system@orc2.example.com

CREATE USER proxy_mviewadmin IDENTIFIED BY &amp;password;

BEGIN
   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a><a id="sthref61"></a><a id="sthref62"></a>
      username =&gt; &#39;proxy_mviewadmin&#39;,
      privilege_type =&gt; &#39;proxy_snapadmin&#39;,
      list_of_gnames =&gt; NULL);
END;
/

-- Place GRANT SELECT_CATALOG_ROLE statement here if necessary.

/*
</pre>
<p>If you want your materialized view administrator at materialized view sites to be able to perform administrative operations using the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT_CATALOG_ROLE</code> to <code dir="ltr">proxy_mviewadmin</code>:</p>
<pre dir="ltr">*/

GRANT SELECT_CATALOG_ROLE TO proxy_mviewadmin;

/*
</pre>
<p>Granting this privilege to the <code dir="ltr">proxy_mviewadmin</code> is not required if you do not plan to use the Advanced Replication interface in Oracle Enterprise Manager Cloud Control. However, if you plan to use the Advanced Replication interface, then move the <code dir="ltr">GRANT</code> statement to the line directly after the previous <code dir="ltr">REGISTER_USER_REPGROUP</code> statement.</p>
<p>Create the proxy refresher.</p>
<p>The proxy refresher performs tasks at the master site on behalf of the refresher at the materialized view site.</p>
<pre dir="ltr">*/

CREATE USER proxy_refresher IDENTIFIED BY &amp;password;

GRANT CREATE SESSION TO proxy_refresher;
GRANT SELECT ANY TABLE TO proxy_refresher;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rarsec.htm#i5477">&#34;Security Setup for Materialized View Replication&#34;</a></div>
</dd>
</dl>
</div>
<!-- class="sect2" -->
<div id="REPMA328" class="sect2"><a id="sthref63"></a>
<h3 class="sect2">Setting Up orc3.example.com</h3>
<p>Complete the following steps to set up the <code dir="ltr">orc3.example.com</code> master site.</p>
<a id="i22887"></a>
<dl>
<dd><a id="REPMA1099"></a><a id="CIAJAJEF"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Connect as SYSTEM at orc3.example.com.</dt>
<dd>
<p>You must connect as <code dir="ltr">SYSTEM</code> to the database that you want to set up for replication.</p>
<pre dir="ltr">*/

CONNECT system@orc3.example.com

/*
</pre></dd>
<dd><a id="REPMA1100"></a><a id="sthref64"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Create the replication administrator at orc3.example.com.</dt>
<dd>
<p>The replication administrator must be granted the necessary privileges to create and manage a replication environment. The replication administrator must be created at each database that participates in the replication environment.</p>
<pre dir="ltr">*/

CREATE USER repadmin IDENTIFIED BY &amp;password;

/*
</pre>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
Enter an appropriate password for the administrative user.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DBSEG33223" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for guidelines for choosing passwords</div>
</dd>
<dd><a id="REPMA1101"></a><a id="sthref65"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Grant privileges to replication administrator at orc3.example.com.</dt>
<dd>
<p>Execute the <code dir="ltr">GRANT_ADMIN_ANY_SCHEMA</code> procedure to grant the replication administrator powerful privileges to create and manage a replicated environment.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatadminpac.htm#i93879">DBMS_REPCAT_ADMIN.GRANT_ADMIN_ANY_SCHEMA (</a>
      username =&gt; &#39;repadmin&#39;);
END;
/

/*
</pre>
<p>If you want your <code dir="ltr">repadmin</code> to be able to create materialized view logs for any replicated table, then grant <code dir="ltr">COMMENT</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> and <code dir="ltr">LOCK</code> <code dir="ltr">ANY</code> <code dir="ltr">TABLE</code> to <code dir="ltr">repadmin</code>:</p>
<pre dir="ltr">*/

GRANT COMMENT ANY TABLE TO repadmin;
GRANT LOCK ANY TABLE TO repadmin;

/*
</pre>
<p>If you want your <code dir="ltr">repadmin</code> to be able to connect to the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT</code> <code dir="ltr">ANY</code> <code dir="ltr">DICTIONARY</code> to <code dir="ltr">repadmin</code>:</p>
<pre dir="ltr">*/

GRANT SELECT ANY DICTIONARY TO repadmin;

/*
</pre></dd>
<dd><a id="REPMA1102"></a><a id="sthref66"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Register the propagator at orc3.example.com.</dt>
<dd>
<p>The propagator is responsible for propagating the deferred transaction queue to other master sites.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rardefsyspac.htm#i94654">DBMS_DEFER_SYS.REGISTER_PROPAGATOR (</a>
      username =&gt; &#39;repadmin&#39;);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1103"></a><a id="sthref67"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Register the receiver at orc3.example.com.</dt>
<dd>
<p>The receiver receives the propagated deferred transactions sent by the propagator from the other master sites.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a>
      username =&gt; &#39;repadmin&#39;,
      privilege_type =&gt; &#39;receiver&#39;,
      list_of_gnames =&gt; NULL);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1104"></a><a id="sthref68"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Schedule purge at master site at orc3.example.com.</dt>
<dd>
<p>To keep the size of the deferred transaction queue in check, purge successfully completed deferred transactions. The <code dir="ltr">SCHEDULE_PURGE</code> API automates the purge process for you. You must execute this procedure as the replication administrator.</p>
<pre dir="ltr">*/

CONNECT repadmin@orc3.example.com

BEGIN
   <a href="rardefsyspac.htm#i94701">DBMS_DEFER_SYS.SCHEDULE_PURGE (</a>
      next_date =&gt; SYSDATE,
      interval =&gt; &#39;SYSDATE + 1/24&#39;,
      delay_seconds =&gt; 0);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1105"></a><a id="CIAJBIFB"></a></dd>
<dt class="seghead">Step 7&nbsp;&nbsp;&nbsp;Create proxy master site users<a class="dashingAutolink" name="autolink-91853"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref69"></a><a class="dashingAutolink" name="autolink-91854"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref70"></a><a class="dashingAutolink" name="autolink-91855"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref71"></a> at orc1.example.com.</dt>
<dd>
<p>If you plan to create materialized view sites based on this master site, then create proxy master site users<a id="sthref72"></a><a id="sthref73"></a><a id="sthref74"></a> at <code dir="ltr">orc1.example.com</code> that correspond to users at the materialized view site.</p>
<p>Create the proxy materialized view administrator.</p>
<p>The proxy materialized view administrator performs tasks at the target master site on behalf of the materialized view administrator at the materialized view site.</p>
<pre dir="ltr">*/

CONNECT system@orc3.example.com

CREATE USER proxy_mviewadmin IDENTIFIED BY &amp;password;

BEGIN
   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a><a id="sthref75"></a><a id="sthref76"></a>
      username =&gt; &#39;proxy_mviewadmin&#39;,
      privilege_type =&gt; &#39;proxy_snapadmin&#39;,
      list_of_gnames =&gt; NULL);
END;
/

-- Place GRANT SELECT_CATALOG_ROLE statement here if necessary.

/*
</pre>
<p>If you want your materialized view administrator at materialized view sites to be able to perform administrative operations using the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT_CATALOG_ROLE</code> to <code dir="ltr">proxy_mviewadmin</code>:</p>
<pre dir="ltr">*/

GRANT SELECT_CATALOG_ROLE TO proxy_mviewadmin;

/*
</pre>
<p>Granting this privilege to the <code dir="ltr">proxy_mviewadmin</code> is not required if you do not plan to use the Advanced Replication interface in Oracle Enterprise Manager Cloud Control. However, if you plan to use the Advanced Replication interface, then move the <code dir="ltr">GRANT</code> statement to the line directly after the previous <code dir="ltr">REGISTER_USER_REPGROUP</code> statement.</p>
<p>Create proxy refresher.</p>
<p>The proxy refresher performs tasks at the master site on behalf of the refresher at the materialized view site.</p>
<pre dir="ltr">*/

CREATE USER proxy_refresher IDENTIFIED BY &amp;password;

GRANT CREATE SESSION TO proxy_refresher;
GRANT SELECT ANY TABLE TO proxy_refresher;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rarsec.htm#i5477">&#34;Security Setup for Materialized View Replication&#34;</a></div>
</dd>
</dl>
</div>
<!-- class="sect2" -->
<a id="i23014"></a>
<div id="REPMA329" class="sect2">
<h3 class="sect2">Creating Scheduled Links Between the Master Sites</h3>
<p>Complete the following steps to create scheduled links between the master sites.</p>
<a id="i11964"></a>
<dl>
<dd><a id="REPMA1106"></a><a id="CIADCJGF"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Create database links between master sites.<a class="dashingAutolink" name="autolink-91856"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref77"></a><a class="dashingAutolink" name="autolink-91857"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref78"></a><a class="dashingAutolink" name="autolink-91858"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref79"></a></dt>
<dd>
<p>The database links provide the necessary distributed mechanisms to allow the different replication sites to replicate data among themselves. Before you create any private database links, you must create the public database links that each private database link will use. You then must create a database link between all replication administrators at each of the master sites that you have set up.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink ADMIN028" href="../ADMIN/ds_concepts.htm#ADMIN028"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for more information about database links</div>
<pre dir="ltr">*/

CONNECT system@orc1.example.com
CREATE PUBLIC DATABASE LINK orc2.example.com USING &#39;orc2.example.com&#39;;
CREATE PUBLIC DATABASE LINK orc3.example.com USING &#39;orc3.example.com&#39;;

CONNECT repadmin@orc1.example.com
CREATE DATABASE LINK orc2.example.com CONNECT TO repadmin 
 IDENTIFIED BY &amp;password;
CREATE DATABASE LINK orc3.example.com CONNECT TO repadmin 
 IDENTIFIED BY &amp;password;

CONNECT system@orc2.example.com
CREATE PUBLIC DATABASE LINK orc1.example.com USING &#39;orc1.example.com&#39;;
CREATE PUBLIC DATABASE LINK orc3.example.com USING &#39;orc3.example.com&#39;;

CONNECT repadmin@orc2.example.com
CREATE DATABASE LINK orc1.example.com CONNECT TO repadmin 
 IDENTIFIED BY &amp;password;
CREATE DATABASE LINK orc3.example.com CONNECT TO repadmin 
 IDENTIFIED BY &amp;password;

CONNECT system@orc3.example.com
CREATE PUBLIC DATABASE LINK orc1.example.com USING &#39;orc1.example.com&#39;;
CREATE PUBLIC DATABASE LINK orc2.example.com USING &#39;orc2.example.com&#39;;

CONNECT repadmin@orc3.example.com
CREATE DATABASE LINK orc1.example.com CONNECT TO repadmin 
 IDENTIFIED BY &amp;password;
CREATE DATABASE LINK orc2.example.com CONNECT TO repadmin 
 IDENTIFIED BY &amp;password;

/*
</pre></dd>
<dd><a id="REPMA1107"></a><a id="sthref80"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Define a schedule for each database link to create scheduled links.<a class="dashingAutolink" name="autolink-91859"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref81"></a><a class="dashingAutolink" name="autolink-91860"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref82"></a><a class="dashingAutolink" name="autolink-91861"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref83"></a></dt>
<dd>
<p>Create a scheduled link by defining a database link when you execute the <code dir="ltr">SCHEDULE_PUSH</code> procedure. The scheduled link determines how often your deferred transaction queue is propagated to each of the other master sites. you must execute the <code dir="ltr">SCHEDULE_PUSH</code> procedure for each database link that you created in Step <a href="#CIADCJGF">1</a>. The database link is specified in the destination parameter of the <code dir="ltr">SCHEDULE_PUSH</code> procedure.</p>
<p>Even when using Oracle&#39;s asynchronous replication mechanisms, you can configure a scheduled link to simulate continuous, real-time replication. The scheduled links in this example simulate continuous replication.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink REPLN100" href="../REPLN/repplan.htm#REPLN100"><span class="italic">Oracle Database Advanced Replication</span></a> for more information about simulating continuous replication</div>
<pre dir="ltr">*/

CONNECT repadmin@orc1.example.com

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a><a id="sthref84"></a><a id="sthref85"></a>
      destination =&gt; &#39;orc2.example.com&#39;,
      interval =&gt; &#39;SYSDATE + (1/144)&#39;,
      next_date =&gt; SYSDATE,
      parallelism =&gt; 1,
      execution_seconds =&gt; 1500,
      delay_seconds =&gt; 1200);
END;
/

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a>
      destination =&gt; &#39;orc3.example.com&#39;,
      interval =&gt; &#39;SYSDATE + (1/144)&#39;,
      next_date =&gt; SYSDATE,
      parallelism =&gt; 1,
      execution_seconds =&gt; 1500,
      delay_seconds =&gt; 1200);
END;
/

CONNECT repadmin@orc2.example.com

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a>
      destination =&gt; &#39;orc1.example.com&#39;,
      interval =&gt; &#39;SYSDATE + (1/144)&#39;,
      next_date =&gt; SYSDATE,
      parallelism =&gt; 1,
      execution_seconds =&gt; 1500,
      delay_seconds =&gt; 1200);
END;
/

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a>
      destination =&gt; &#39;orc3.example.com&#39;,
      interval =&gt; &#39;SYSDATE + (1/144)&#39;,
      next_date =&gt; SYSDATE,
      parallelism =&gt; 1,
      execution_seconds =&gt; 1500,
      delay_seconds =&gt; 1200);
END;
/

CONNECT repadmin@orc3.example.com

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a>
      destination =&gt; &#39;orc1.example.com&#39;,
      interval =&gt; &#39;SYSDATE + (1/144)&#39;,
      next_date =&gt; SYSDATE,
      parallelism =&gt; 1,
      execution_seconds =&gt; 1500,
      delay_seconds =&gt; 1200);
END;
/

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a>
      destination =&gt; &#39;orc2.example.com&#39;,
      interval =&gt; &#39;SYSDATE + (1/144)&#39;,
      next_date =&gt; SYSDATE,
      parallelism =&gt; 1,
      execution_seconds =&gt; 1500,
      delay_seconds =&gt; 1200);
END;
/

SET ECHO OFF

SPOOL OFF

<a id="i22949"></a>/**************************END OF SCRIPT***********************************/
</pre></dd>
</dl>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i18551"></a>
<div id="REPMA119" class="sect1">
<h2 class="sect1">Setting Up Materialized View Sites<a id="sthref86"></a><a id="sthref87"></a><a id="sthref88"></a></h2>
<div id="REPMA330" class="figure">
<p class="titleinfigure"><a id="i25796"></a>Figure 2-3 Setting Up Materialized View Sites</p>
<img width="592" height="520" src="img/repma001.gif" alt="Description of Figure 2-3 follows"/><br/>
<a id="sthref89" href="img_text/repma001.htm">Description of &#34;Figure 2-3 Setting Up Materialized View Sites&#34;</a><br/>
<br/></div>
<!-- class="figure" -->
<div id="REPMA331" class="sect2"><a id="sthref90"></a>
<h3 class="sect2">Setting Up mv1.example.com</h3>
<p>Complete the following steps to set up the <code dir="ltr">mv1.example.com</code> master materialized view site. <code dir="ltr">mv1.example.com</code> is a master materialized view site because <code dir="ltr">mv2.example.com</code> will be based on it. Before you set up the materialized sites, configure your network and Oracle Net so that all <code dir="ltr">mv1.example.com</code> can communicate with <code dir="ltr">orc1.example.com</code> and <code dir="ltr">mv2.example.com</code> can communicate with <code dir="ltr">mv1.example.com</code>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If you are viewing this document online, then you can copy the text from the &#34;BEGINNING OF SCRIPT&#34; line after this note to the &#34;END OF SCRIPT&#34; line into a text editor and then edit the text to create a script for your environment.</div>
<pre dir="ltr">/************************* BEGINNING OF SCRIPT ******************************
</pre>
<a id="i13498"></a>
<dl>
<dd><a id="REPMA1108"></a><a id="sthref91"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Connect as SYSTEM at materialized view site at mv1.example.com.</dt>
<dd>
<p>You must connect as <code dir="ltr">SYSTEM</code> to the database that you want to set up as a materialized view site.</p>
<pre dir="ltr">*/

SET ECHO ON

SPOOL setup_mvs.out

CONNECT system@mv1.example.com

/*
</pre></dd>
<dd><a id="REPMA1109"></a><a id="sthref92"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Create materialized view site users<a class="dashingAutolink" name="autolink-91862"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref93"></a><a class="dashingAutolink" name="autolink-91863"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref94"></a><a class="dashingAutolink" name="autolink-91864"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref95"></a><a class="dashingAutolink" name="autolink-91865"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref96"></a><a class="dashingAutolink" name="autolink-91866"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref97"></a><a class="dashingAutolink" name="autolink-91867"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref98"></a> at mv1.example.com.</dt>
<dd>
<p>Several users must be created at the materialized view site. These users are:</p>
<ul>
<li>
<p>Materialized view administrator</p>
</li>
<li>
<p>Propagator</p>
</li>
<li>
<p>Refresher</p>
</li>
<li>
<p>Receiver (if the site will serve as a master materialized view site for other materialized views, as <code dir="ltr">mv1.example.com</code> is)</p>
</li>
</ul>
<p>Complete the following tasks to create these users.</p>
<p>Create the materialized view administrator.</p>
<p>The materialized view administrator is responsible for creating and managing the materialized view site. Execute the <code dir="ltr">GRANT_ADMIN_ANY_SCHEMA</code> procedure to grant the materialized view administrator the appropriate privileges.</p>
<pre dir="ltr">*/

ACCEPT password PROMPT &#39;Enter password for user: &#39; HIDE

CREATE USER mviewadmin IDENTIFIED BY &amp;password;

BEGIN
   <a href="rarrcatadminpac.htm#i93879">DBMS_REPCAT_ADMIN.GRANT_ADMIN_ANY_SCHEMA (</a><a id="sthref99"></a><a id="sthref100"></a>
      username =&gt; &#39;mviewadmin&#39;);
END;
/

GRANT COMMENT ANY TABLE TO mviewadmin;

GRANT LOCK ANY TABLE TO mviewadmin;

/*
</pre>
<pre dir="ltr"></pre>
<p>If you want your <code dir="ltr">mviewadmin</code> to be able to connect to the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT</code> <code dir="ltr">ANY</code> <code dir="ltr">DICTIONARY</code> to <code dir="ltr">mviewadmin</code>:</p>
<pre dir="ltr">*/

GRANT SELECT ANY DICTIONARY TO mviewadmin;

/*
</pre>
<p>Create the propagator.</p>
<p>The propagator is responsible for propagating the deferred transaction queue to the target master site.</p>
<pre dir="ltr">*/

CREATE USER propagator IDENTIFIED BY &amp;password;

BEGIN
   <a href="rardefsyspac.htm#i94654">DBMS_DEFER_SYS.REGISTER_PROPAGATOR (</a><a id="sthref101"></a><a id="sthref102"></a>
      username =&gt; &#39;propagator&#39;);
END;
/

/*
</pre>
<p>Create the refresher.</p>
<p>The refresher is responsible for &#34;pulling&#34; changes made to the replicated tables at the target master site to the materialized view site. This user refreshes one or more materialized views. If you want the mviewadmin user to be the refresher, then this step is not required.</p>
<pre dir="ltr">*/

CREATE USER refresher IDENTIFIED BY &amp;password;

GRANT CREATE SESSION TO refresher;

GRANT ALTER ANY MATERIALIZED VIEW TO refresher;

/*
</pre>
<p>Register the receiver.</p>
<p>The receiver receives the propagated deferred transactions sent by the propagator from materialized view sites. The receiver is necessary only if the site will function as a master materialized view site for other materialized view sites.</p>
<pre dir="ltr">*/

BEGIN
<a id="i19987"></a>   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a><a id="sthref103"></a><a id="sthref104"></a>
      username =&gt; &#39;mviewadmin&#39;,
      privilege_type =&gt; &#39;receiver&#39;,
      list_of_gnames =&gt; NULL);
END;
/

/*
</pre>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
Enter appropriate passwords for the administrative users.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DBSEG33223" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for guidelines for choosing passwords</div>
</dd>
<dd><a id="REPMA1110"></a><a id="sthref105"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Create database links to the master site.</dt>
<dd>
<p>Create a public database link.</p>
<pre dir="ltr">*/

CONNECT system@mv1.example.com

CREATE PUBLIC DATABASE LINK orc1.example.com USING &#39;orc1.example.com&#39;;

/*
</pre>
<p>Create the materialized view administrator database link.</p>
<p>You must create a database link from the materialized view administrator at the materialized view site to the proxy materialized view administrator at the master site.</p>
<pre dir="ltr">*/

CONNECT mviewadmin@mv1.example.com;

CREATE DATABASE LINK orc1.example.com 
  CONNECT TO proxy_mviewadmin IDENTIFIED BY &amp;password;

/*
</pre>
<p>Create the propagator/receiver database link.</p>
<p>You must create a database link from the propagator at the materialized view site to the receiver at the master site. The receiver was defined when you created the master site.</p>
<pre dir="ltr">*/

CONNECT propagator@mv1.example.com

CREATE DATABASE LINK orc1.example.com 
  CONNECT TO repadmin IDENTIFIED BY &amp;password;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
Step <a href="#CIADHFDA">5</a></div>
</dd>
<dd><a id="REPMA1111"></a><a id="sthref106"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Schedule purge at the mv1.example.com materialized view site<a class="dashingAutolink" name="autolink-91868"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref107"></a><a class="dashingAutolink" name="autolink-91869"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref108"></a><a class="dashingAutolink" name="autolink-91870"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref109"></a>.</dt>
<dd>
<p>To keep the size of the deferred transaction queue in check, purge successfully completed deferred transactions. The <code dir="ltr">SCHEDULE_PURGE</code> procedure automates the purge process for you. If your materialized view site only contains &#34;read-only&#34; materialized views, then you do not need to execute this procedure.</p>
<pre dir="ltr">*/

CONNECT mviewadmin@mv1.example.com

BEGIN
   <a href="rardefsyspac.htm#i94701">DBMS_DEFER_SYS.SCHEDULE_PURGE (</a><a id="sthref110"></a><a id="sthref111"></a>
   next_date =&gt; SYSDATE,
   interval =&gt; &#39;SYSDATE + 1/24&#39;,
   delay_seconds =&gt; 0,
   rollback_segment =&gt; &#39;&#39;);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1112"></a><a id="sthref112"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Schedule push at the mv1.example.com materialized view site (optional).</dt>
<dd>
<p>If the materialized view site has a constant connection to its master site, then you optionally can schedule push at the <code dir="ltr">mv1.example.com</code> materialized view site. If the materialized view site is disconnected from its master site for extended periods of time, then it is typically better not to schedule push and refresh on demand, which pushes changes to the master site.</p>
<p>The <code dir="ltr">SCHEDULE_PUSH</code> procedure schedules when the deferred transaction queue should be propagated to the target master site.</p>
<pre dir="ltr">*/

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a><a id="sthref113"></a><a id="sthref114"></a>
      destination =&gt; &#39;orc1.example.com&#39;,
      interval =&gt; &#39;SYSDATE + 1/24&#39;,
      next_date =&gt; SYSDATE,
      stop_on_error =&gt; FALSE,
      delay_seconds =&gt; 0,
      parallelism =&gt; 0);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1113"></a><a id="CIAJIEFG"></a></dd>
<dt class="seghead">Step 6&nbsp;&nbsp;&nbsp;Create proxy users<a class="dashingAutolink" name="autolink-91871"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref115"></a><a class="dashingAutolink" name="autolink-91872"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref116"></a><a class="dashingAutolink" name="autolink-91873"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref117"></a> at the mv1.example.com materialized view site.</dt>
<dd>
<p>Create the proxy materialized view administrator.</p>
<p>The proxy materialized view administrator performs tasks at the target master materialized view site on behalf of the materialized view administrator at the materialized view sites based on this materialized view site. This user is not required if the site will not function as a master materialized view site for other materialized view sites.</p>
<pre dir="ltr">*/

CONNECT system@mv1.example.com

CREATE USER proxy_mviewadmin IDENTIFIED BY &amp;password;

BEGIN
   <a href="rarrcatadminpac.htm#i93966">DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (</a><a id="sthref118"></a><a id="sthref119"></a>
      username =&gt; &#39;proxy_mviewadmin&#39;,
      privilege_type =&gt; &#39;proxy_snapadmin&#39;,
      list_of_gnames =&gt; NULL);
END;
/

-- Place GRANT SELECT_CATALOG_ROLE statement here if necessary.

/*
</pre>
<p>If you want your materialized view administrator at materialized view sites based on this materialized view site to be able to perform administrative operations using the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT_CATALOG_ROLE</code> to <code dir="ltr">proxy_mviewadmin</code>:</p>
<pre dir="ltr">GRANT SELECT_CATALOG_ROLE TO proxy_mviewadmin;
</pre>
<p>Granting this privilege to the <code dir="ltr">proxy_mviewadmin</code> is not required if you do not plan to use the Advanced Replication interface in Oracle Enterprise Manager Cloud Control. However, if you plan to use the Advanced Replication interface, then move the <code dir="ltr">GRANT</code> statement to the line directly after the previous <code dir="ltr">REGISTER_USER_REPGROUP</code> statement.</p>
<p>Create the proxy refresher.</p>
<p>The proxy refresher performs tasks at the master materialized view site on behalf of the refresher at the materialized view sites based on this materialized view site. This user is not required if the site will not function as a master materialized view site for other materialized view sites.</p>
<pre dir="ltr">*/

CREATE USER proxy_refresher IDENTIFIED BY &amp;password;

GRANT CREATE SESSION TO proxy_refresher;
GRANT SELECT ANY TABLE TO proxy_refresher;

/*
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="rarsec.htm#i5477">&#34;Security Setup for Materialized View Replication&#34;</a></div>
</dd>
</dl>
</div>
<!-- class="sect2" -->
<div id="REPMA332" class="sect2"><a id="sthref120"></a>
<h3 class="sect2">Setting Up mv2.example.com</h3>
<p>Complete the following steps to set up the <code dir="ltr">mv2.example.com</code> materialized view site. <code dir="ltr">mv2.example.com</code> is part of a multitier materialized view configuration because it is based on <code dir="ltr">mv1.example.com</code>, another materialized view.</p>
<dl>
<dd><a id="REPMA1114"></a><a id="sthref121"></a></dd>
<dt class="seghead">Step 1&nbsp;&nbsp;&nbsp;Connect as SYSTEM at level 2 materialized view site mv2.example.com.</dt>
<dd>
<p>You must connect as <code dir="ltr">SYSTEM</code> to the database that you want to set up as a level&nbsp;2 materialized view site. This site, <code dir="ltr">mv2.example.com</code>, will be a materialized view site that is based on <code dir="ltr">mv1.example.com</code>.</p>
<pre dir="ltr">*/

CONNECT system@mv2.example.com

/*
</pre></dd>
<dd><a id="REPMA1115"></a><a id="sthref122"></a></dd>
<dt class="seghead">Step 2&nbsp;&nbsp;&nbsp;Create level 2 materialized view site users<a class="dashingAutolink" name="autolink-91874"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref123"></a><a class="dashingAutolink" name="autolink-91875"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref124"></a> at mv2.example.com.</dt>
<dd>
<p>Several users must be created at the level 2 materialized view site. These users are:</p>
<ul>
<li>
<p>Materialized view administrator</p>
</li>
<li>
<p>Propagator</p>
</li>
<li>
<p>Refresher</p>
</li>
</ul>
<p>Complete the following tasks to create these users.</p>
<p>Create the materialized view administrator.</p>
<p>The materialized view administrator is responsible for creating and managing the level 2 materialized view site. Execute the <code dir="ltr">GRANT_ADMIN_ANY_SCHEMA</code> procedure to grant the materialized view administrator the appropriate privileges.</p>
<pre dir="ltr">*/

CREATE USER mviewadmin IDENTIFIED BY &amp;password;

BEGIN
   <a href="rarrcatadminpac.htm#i93879">DBMS_REPCAT_ADMIN.GRANT_ADMIN_ANY_SCHEMA (</a><a id="sthref125"></a><a id="sthref126"></a>
      username =&gt; &#39;mviewadmin&#39;);
END;
/

/*
</pre>
<p>If you want your <code dir="ltr">mviewadmin</code> to be able to connect to the Advanced Replication interface in Oracle Enterprise Manager Cloud Control, then grant <code dir="ltr">SELECT</code> <code dir="ltr">ANY</code> <code dir="ltr">DICTIONARY</code> to <code dir="ltr">mviewadmin</code>:</p>
<pre dir="ltr">*/

GRANT SELECT ANY DICTIONARY TO mviewadmin;

/*
</pre>
<p>Create the propagator.</p>
<p>The propagator is responsible for propagating the deferred transaction queue to the target master materialized view site.</p>
<pre dir="ltr">*/

CREATE USER propagator IDENTIFIED BY &amp;password;

BEGIN
   <a href="rardefsyspac.htm#i94654">DBMS_DEFER_SYS.REGISTER_PROPAGATOR (</a><a id="sthref127"></a><a id="sthref128"></a>
      username =&gt; &#39;propagator&#39;);
END;
/

/*
</pre>
<p>Create the refresher.</p>
<p>The refresher is responsible for &#34;pulling&#34; changes made to the replicated materialized views at the target master materialized view site to the level 2 materialized view site.</p>
<pre dir="ltr">*/

CREATE USER refresher IDENTIFIED BY &amp;password;

GRANT CREATE SESSION TO refresher;
GRANT ALTER ANY MATERIALIZED VIEW TO refresher;

/*
</pre>
<div class="infobox-note">
<p class="notep1"><span class="bold">Note</span>:</p>
Enter appropriate passwords for the administrative users.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a class="olink DBSEG33223" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for guidelines for choosing passwords</div>
</dd>
<dd><a id="REPMA1116"></a><a id="sthref129"></a></dd>
<dt class="seghead">Step 3&nbsp;&nbsp;&nbsp;Create database links to master materialized view site<a class="dashingAutolink" name="autolink-91876"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref130"></a><a class="dashingAutolink" name="autolink-91877"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref131"></a>.</dt>
<dd>
<p>Create a public database link.</p>
<pre dir="ltr">*/

CONNECT system@mv2.example.com

CREATE PUBLIC DATABASE LINK mv1.example.com USING &#39;mv1.example.com&#39;;

/*
</pre>
<p>Create materialized view administrator database link.</p>
<p>You must create a database link from the materialized view administrator at the level 2 materialized view site to the proxy materialized view administrator at the master materialized view site.</p>
<pre dir="ltr">*/

CONNECT mviewadmin@mv2.example.com;

CREATE DATABASE LINK mv1.example.com 
  CONNECT TO proxy_mviewadmin IDENTIFIED BY &amp;password;

/*
</pre>
<p>Create a propagator/receiver database link.</p>
<p>You must create a database link from the propagator at the level 2 materialized view site to the receiver at the master materialized view site. The receiver was defined when you created the master materialized view site.</p>
<pre dir="ltr">*/

CONNECT propagator@mv2.example.com

CREATE DATABASE LINK mv1.example.com 
  CONNECT TO mviewadmin IDENTIFIED BY &amp;password;

/*
</pre></dd>
<dd><a id="REPMA1117"></a><a id="sthref132"></a></dd>
<dt class="seghead">Step 4&nbsp;&nbsp;&nbsp;Schedule purge at level 2 materialized view site<a class="dashingAutolink" name="autolink-91878"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref133"></a><a class="dashingAutolink" name="autolink-91879"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref134"></a><a class="dashingAutolink" name="autolink-91880"></a><a class="dashAnchor" name="//apple_ref/cpp/Command/"></a><a id="sthref135"></a> at mv2.example.com.</dt>
<dd>
<p>To keep the size of the deferred transaction queue in check, purge successfully completed deferred transactions. The <code dir="ltr">SCHEDULE_PURGE</code> procedure automates the purge process for you. If your level 2 materialized view site only contains &#34;read-only&#34; materialized views, then you do not need to execute this procedure.</p>
<pre dir="ltr">*/

CONNECT mviewadmin@mv2.example.com

BEGIN
   <a href="rardefsyspac.htm#i94701">DBMS_DEFER_SYS.SCHEDULE_PURGE (</a><a id="sthref136"></a><a id="sthref137"></a>
     next_date =&gt; SYSDATE,
     interval =&gt; &#39;SYSDATE + 1/24&#39;,
     delay_seconds =&gt; 0,
     rollback_segment =&gt; &#39;&#39;);
END;
/

/*
</pre></dd>
<dd><a id="REPMA1118"></a><a id="sthref138"></a></dd>
<dt class="seghead">Step 5&nbsp;&nbsp;&nbsp;Schedule push at the mv2.example.com materialized view site (optional).</dt>
<dd>
<p>If the materialized view site has a constant connection to its master materialized view site, then you optionally can schedule push at the <code dir="ltr">mv2.example.com</code> materialized view site. If the materialized view site is disconnected from its master materialized view site for extended periods of time, then it is typically better not to schedule push and refresh on demand, which pushes changes to the master materialized view site.</p>
<p>The <code dir="ltr">SCHEDULE_PUSH</code> procedure schedules when the deferred transaction queue should be propagated to the target master materialized view site.</p>
<pre dir="ltr">*/

CONNECT mviewadmin@mv2.example.com

BEGIN
   <a href="rardefsyspac.htm#BABBGBCC">DBMS_DEFER_SYS.SCHEDULE_PUSH (</a><a id="sthref139"></a><a id="sthref140"></a>
      destination =&gt; &#39;mv1.example.com&#39;,
      interval =&gt; &#39;SYSDATE + 1/24&#39;,
      next_date =&gt; SYSDATE,
      stop_on_error =&gt; FALSE,
      delay_seconds =&gt; 0,
      parallelism =&gt; 0);
END;
/

SET ECHO OFF

SPOOL OFF

<a id="i22974"></a>/************************* END OF SCRIPT **********************************/
</pre></dd>
</dl>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment854">
<tr>
<td class="cellalignment863">
<table class="cellalignment859">
<tr>
<td class="cellalignment858"><a href="raroverview.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment858"><a href="rarmastergroup.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment865">
<table class="cellalignment857">
<tr>
<td class="cellalignment858"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment858"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment858"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment858"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment858"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment858"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>