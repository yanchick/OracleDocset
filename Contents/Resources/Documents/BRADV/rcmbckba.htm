<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2662"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Backing%20Up%20the%20Database"></a><title>Backing Up the Database</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="backing up, database, multisection incremental backups, incremental backups, multisection incremental backups, multisection backups, views, views, for multisection backups, example, example, control files, backups, manual, databases, multitenant container, backups, whole CDB, CDBs, backing up, root, using RMAN, root, using Oracle Enterprise Manager Cloud Control, PDBs, using RMAN, PDBs, backing up, using RMAN, PDBs, using Oracle Enterprise Manager Cloud Control, backing up, using Oracle Enterprise Manager Cloud Control, tablespaces, backups, in PDBs, tablespaces in PDBs, data files, backing up, in PDBs, data files in PDBs, Recovery Manager, archived redo logs, archived redo log files, in CDBs, archived redo log files, backing up, in CDBs, deleting, delete after backups, delete after backups, in CDBs, commands, Recovery Manager, BACKUP, BACKUP command, FOR RECOVER OF COPY option, data file, using RMAN, tablespace"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rcmcncpt.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rcmbckad.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7"></a> <span id="PAGE" style="display:none;">19/48</span> <!-- End Header -->
<a id="BRADV8003"></a>
<h1 id="BRADV-GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" class="sect1"><span class="enumeration_chapter">9</span> Backing Up the Database</h1>
<div>
<p>This chapter explains how to perform the most basic backup tasks and implement backup strategies using RMAN. This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-E31D9EAF-32FE-4599-BEEF-E3C52F116210">Overview of RMAN Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467">Specifying Backup Output Options</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-344F4D14-AC81-4093-B921-6403EE75112C">Backing Up Database Files with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-EB261F93-318D-4EBA-8E26-B0589703CC73">Backing Up CDBs and PDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-4481CA5F-B1B5-4819-9E6B-7184951EC81A">Backing Up Archived Redo Logs with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304" title="To create incremental backups for use in an incrementally updated backup strategy, use the BACKUP ... FOR RECOVER OF COPY WITH TAG form of the BACKUP command. The command is best understood in a sample script that implements the strategy.">Making and Updating RMAN Incremental Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9">Making Database Backups for Long-Term Storage</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-731ADA67-235E-481D-AC17-9F9067AD55BF">Backing Up RMAN Backups</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7__GUID-A354DABE-D5A3-4839-AA95-9480C96DC401">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckad.htm#GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F">Backing Up the Database: Advanced Topics</a> to learn about more advanced topics such as backup optimization, duplexing, backup encryption, and restartable backups</p>
</li>
<li>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to perform RMAN backup and recovery in a Data Guard environment</p>
</li>
</ul>
</div>
</div>
<a id="BRADV8131"></a>
<div class="props_rev_3"><a id="GUID-E31D9EAF-32FE-4599-BEEF-E3C52F116210"></a>
<h2 id="BRADV-GUID-E31D9EAF-32FE-4599-BEEF-E3C52F116210" class="sect2">Overview of RMAN Backups</h2>
<div>
<p>This section provides an overview of RMAN backups.</p>
</div>
<a id="BRADV89506"></a>
<div class="props_rev_3"><a id="GUID-CCFB214A-1334-44B6-862C-F4E2243EE3D2"></a>
<h3 id="BRADV-GUID-CCFB214A-1334-44B6-862C-F4E2243EE3D2" class="sect3">Purpose of RMAN Backups</h3>
<div>
<p>The primary purpose of RMAN backups is to protect your data. If a <a href="glossary.htm#GUID-ABDE7EEF-D4B3-4867-A69C-3B24614AF430"><span class="xrefglossterm">media failure</span></a> or disaster occurs, then you can restore your backups and recover lost changes.</p>
<p>You can also make backups to preserve data for long-time archival, as explained in <span class="q">&#34;<a href="rcmbckba.htm#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9">Making Database Backups for Long-Term Storage</a>&#34;</span>, and to transfer data, as explained in the chapters <a href="rcmdupdb.htm#GUID-94E3F324-33F7-451E-83E1-18523E916CD3" title="RMAN enables you to duplicate PDBs with the DUPLICATE command. You can duplicate a single PDB, a set of PDBs, or a set of tablespaces within a PDB. This example shows how to use a script to automate the process of duplicating a target database.">Duplicating a Database</a> through <a href="rcmxplat.htm#GUID-65AADCB6-CC9A-4229-9AB8-805C37E4471F">Transporting Data Across Platforms</a>.</p>
</div>
</div>
<a id="BRADV89507"></a>
<div class="props_rev_3"><a id="GUID-E8B1FE91-6C75-44AB-986C-3E91AA88FB6B"></a>
<h3 id="BRADV-GUID-E8B1FE91-6C75-44AB-986C-3E91AA88FB6B" class="sect3">Basic Concepts of RMAN Backups</h3>
<div>
<p><a id="d37979e390" class="indexterm-anchor"></a><a id="d37979e394" class="indexterm-anchor"></a>As explained in <a href="rcmcncpt.htm#GUID-B3380142-ABCD-437F-9E06-B219D74E6738">RMAN Backup Concepts</a>, you can back up all or part of your database with <a id="d37979e403" class="indexterm-anchor"></a><a id="d37979e407" class="indexterm-anchor"></a>the <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP</code></a> command from within the RMAN client.</p>
<p>In many cases, after your database has been configured in accordance with your backup strategy, you can back up the database by entering the following command at the RMAN prompt:</p>
<pre dir="ltr">RMAN&gt; BACKUP DATABASE;
</pre>
<p>RMAN uses the configured settings, the records of previous backups, and the control file record of the database structure to determine an efficient set of steps for the backup. RMAN then performs these steps.</p>
<p><a id="d37979e422" class="indexterm-anchor"></a>As explained in <span class="q">&#34;<a href="rcmarchi.htm#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B">About RMAN File Management in a Data Guard Environment</a>&#34;</span>, you can run RMAN backups at any database in a Data Guard environment. Any backup of any database in the environment is usable for recovery of any other database if the backup is accessible. You can offload all backups of database files, including control file backups, to a <a href="glossary.htm#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">physical standby database</span></a> and thereby avoid consuming resources on the primary database.</p>
<div class="infoboxnotealso" id="GUID-E8B1FE91-6C75-44AB-986C-3E91AA88FB6B__GUID-4EA16608-A109-4C06-A0CB-D06F546807B0">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code class="codeph">BACKUP</code> command</p>
</li>
<li>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to back up a standby database with RMAN</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="BRADV89508"></a>
<div class="props_rev_3"><a id="GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467"></a>
<h2 id="BRADV-GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467" class="sect2">Specifying Backup Output Options</h2>
<div>
<p>If you specify only the minimum required options for an RMAN command such as <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP DATABASE</code></a>, then RMAN automatically determines the destination device, locations for backup output, and a backup tag based on your configured environment and built-in RMAN defaults.</p>
<p>You can also provide arguments to <code class="codeph">BACKUP</code> to override these defaults. The most typical options are described in the following sections:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2">Specifying the Device Type for an RMAN Backup</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9">Specifying Backup Set or Copy for an RMAN Backup to Disk</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-A733BDFC-8239-4610-8D26-40B6F2D07091">Specifying a Format for RMAN Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-88BAB25A-FD25-4577-A08A-71B78A91583F">Specifying Tags for an RMAN Backup</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E">Making Compressed Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9">Specifying Multisection Incremental Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8">Making Multisection Backups Using Image Copies</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467__GUID-35365433-9562-4D70-9A60-0B88DC9DBE6F">
<p class="notep1">See Also:</p>
<p><a href="rcmbckad.htm#GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F">Backing Up the Database: Advanced Topics</a> to learn about advanced backup options such as duplexing and restarting backups</p>
</div>
</div>
<a id="BRADV211"></a><a id="BRADV89509"></a>
<div class="props_rev_3"><a id="GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2"></a>
<h3 id="BRADV-GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2" class="sect3">Specifying the Device Type for an RMAN Backup</h3>
<div>
<div class="section">
<p><a id="d37979e648" class="indexterm-anchor"></a><a id="d37979e652" class="indexterm-anchor"></a><a id="d37979e656" class="indexterm-anchor"></a>The <code class="codeph">BACKUP</code> command takes a <code class="codeph">DEVICE TYPE</code> clause that specifies whether to back up to disk or tape device.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2__BGBCIIGJ">
<p class="titleinexample">Example 9-1 Specifying Device Type DISK</p>
<p>This example illustrates a backup to disk.</p>
<pre dir="ltr">BACKUP 
   DEVICE TYPE DISK
   DATABASE;
</pre>
<p>When you run <code class="codeph">BACKUP</code> without a <code class="codeph">DEVICE TYPE</code> clause, RMAN stores the backup on the configured default device (disk or <a href="glossary.htm#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>). You set the default device with the <a class="olink RCMRF113" target="_blank" href="../RCMRF/rcmsynta009.htm#RCMRF113"><code class="codeph">CONFIGURE DEFAULT DEVICE TYPE</code></a> command described in <span class="q">&#34;<a href="rcmconfb.htm#GUID-3845B630-DD47-4147-BA6E-8D677CAF1CC2">Configuring the Default Device for Backups: Disk or SBT</a>&#34;</span>.</p>
</div>
<!-- class="example" --></div>
</div>
<a id="BRADV212"></a><a id="BRADV213"></a><a id="BRADV89510"></a>
<div class="props_rev_3"><a id="GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9"></a>
<h3 id="BRADV-GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9" class="sect3">Specifying Backup Set or Copy for an RMAN Backup to Disk</h3>
<div>
<div class="section">
<p>RMAN can create backups on disk as image copies or as backup sets. <span class="q">&#34;<a href="rcmconfb.htm#GUID-BC37B3E4-3338-4452-A363-DB882F2E9415">Configuring the Default Type for Backups: Backup Sets or Copies</a>&#34;</span> explains how to configure the default disk device. You can override this default with the <code class="codeph">AS</code> <code class="codeph">COPY</code> or <code class="codeph">AS</code> <code class="codeph">BACKUPSET</code> clauses.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9__BGBHDIAG">
<p class="titleinexample">Example 9-2 Making Image Copies</p>
<p>This example uses <code class="codeph">BACKUP</code> <code class="codeph">AS</code> <code class="codeph">COPY</code> to back up to disk as image copies.</p>
<pre dir="ltr">BACKUP AS COPY
  DEVICE TYPE DISK 
  DATABASE;
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9__BGBBHEDE">
<p class="titleinexample">Example 9-3 Making Backup Sets</p>
<p>To back up your data into backup sets, use the <code class="codeph">AS BACKUPSET</code> clause. This example illustrates how you can allow backup sets to be created on the configured default device, or direct them specifically to disk or tape.</p>
<pre dir="ltr">BACKUP AS BACKUPSET 
  DATABASE;

BACKUP AS BACKUPSET 
  DEVICE TYPE DISK 
  DATABASE;

BACKUP AS BACKUPSET 
  DEVICE TYPE SBT 
  DATABASE;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="BRADV89511"></a>
<div class="props_rev_3"><a id="GUID-A733BDFC-8239-4610-8D26-40B6F2D07091"></a>
<h3 id="BRADV-GUID-A733BDFC-8239-4610-8D26-40B6F2D07091" class="sect3">Specifying a Format for RMAN Backups</h3>
<div>
<div class="section">
<p><a id="d37979e883" class="indexterm-anchor"></a>RMAN provides a range of options to name the files generated by the <code class="codeph">BACKUP</code> command. RMAN uses the following set of rules to determine the format of the output files, which are listed in order of precedence:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d37979e892" class="indexterm-anchor"></a>If a <a class="olink RCMRF195" target="_blank" href="../RCMRF/rcmsubcl012.htm#RCMRF195"><code class="codeph">FORMAT</code></a> parameter is specified on the <code class="codeph">BACKUP</code> command, then this setting controls the generated file name.</span>
<div>
<p>For example, you can direct the output to a specific location, as shown in the following command:</p>
<pre dir="ltr">BACKUP DATABASE 
  FORMAT &#34;/disk1/backup_%U&#34;;  # specifies a location on the file system
</pre>
<p>In this case, backups are stored with generated unique file names with the prefix <code class="codeph">/disk1/backup_</code>. The <code class="codeph">%U</code> substitution variable, used to generate a unique string at this point in the file name, is required.</p>
<p><a id="d37979e919" class="indexterm-anchor"></a>You can also use the <code class="codeph">FORMAT</code> parameter to name an ASM disk group as the backup destination, as shown in the following example:</p>
<pre dir="ltr">BACKUP DATABASE 
  FORMAT &#39;+dgroup1&#39;;  # specifies an ASM disk group
</pre>
<p>No <code class="codeph">%U</code> is required in this case because <a href="glossary.htm#GUID-94080845-3FF3-4FB4-91EB-AEA1749411DC"><span class="xrefglossterm">Automatic Storage Management (ASM)</span></a> generates unique file names as needed. However, you can specify <code class="codeph">%U</code> if desired.</p>
<div class="infobox-note" id="GUID-A733BDFC-8239-4610-8D26-40B6F2D07091__GUID-9F997D14-5D45-4034-A2FE-EE9660D43EAE">
<p class="notep1">Note:</p>
<p>If you specify <code class="codeph">FORMAT</code> when a fast recovery area is enabled, then RMAN obeys the <code class="codeph">FORMAT</code> setting. If no location is specified in the <code class="codeph">FORMAT</code> clause, then RMAN creates the backup in a platform-specific location.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>If a <code class="codeph">FORMAT</code> setting is configured for the specific channel used for the backup, then this setting controls the generated file name.</span></li>
<li class="stepexpand"><span>If a <code class="codeph">FORMAT</code> setting is configured for the device type used for the backup, then this setting controls the generated file name.</span></li>
<li class="stepexpand"><span>If a <a href="glossary.htm#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a> is enabled during a disk backup, and if <code class="codeph">FORMAT</code> is not specified, then RMAN creates the backup with an automatically generated name in the fast recovery area.</span></li>
<li class="stepexpand"><span>If no other conditions in this list apply, then the default location and file name format of the backup are platform-specific.</span></li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-A733BDFC-8239-4610-8D26-40B6F2D07091__GUID-29F7F2E5-3406-4BCD-9F8D-DD4667BF374D">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF195" target="_blank" href="../RCMRF/rcmsubcl012.htm#RCMRF195"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code class="codeph">FORMAT</code> clause, and the installation guides in the Oracle Database documentation library to learn about the default file locations for your platform</p>
</div>
</div>
<!-- class="section" --></div>
<a id="BRADV89512"></a>
<div class="props_rev_3"><a id="GUID-D9A1870F-E5E4-48DD-B479-C55C09B59388"></a>
<h4 id="BRADV-GUID-D9A1870F-E5E4-48DD-B479-C55C09B59388" class="sect4">Specifying Multiple Formats for Disk Backups</h4>
<div>
<div class="section">
<p>Typically, you do not need to specify a format when backing up to tape because the default<a id="d37979e1060" class="indexterm-anchor"></a> <code class="codeph">%U</code> variable generates a unique file name for tape backups. When backing up to disk, however, you can specify a format to spread the backup across several drives for improved performance. In this case, allocate one <code class="codeph">DISK</code> channel for each disk drive and specify the format string on <a id="d37979e1069" class="indexterm-anchor"></a><a id="d37979e1071" class="indexterm-anchor"></a>the <a class="olink RCMRF102" target="_blank" href="../RCMRF/rcmsynta004.htm#RCMRF102"><code class="codeph">ALLOCATE CHANNEL</code></a> command so that the file names are on different disks. For example, issue the following command:</p>
<pre dir="ltr">RUN
{ 
  ALLOCATE CHANNEL disk1 DEVICE TYPE DISK FORMAT &#39;/disk1/%d_backups/%U&#39;;
  ALLOCATE CHANNEL disk2 DEVICE TYPE DISK FORMAT &#39;/disk2/%d_backups/%U&#39;;
  ALLOCATE CHANNEL disk3 DEVICE TYPE DISK FORMAT &#39;/disk3/%d_backups/%U&#39;;
  BACKUP AS COPY DATABASE; 
} 
</pre>
<p>You can distribute backups in this manner by default in the future, by configuring channels as follows:</p>
<pre dir="ltr">CONFIGURE DEVICE TYPE DISK PARALLELISM 3;
CONFIGURE DEFAULT DEVICE TYPE TO DISK;
CONFIGURE CHANNEL 1 DEVICE TYPE DISK FORMAT &#39;/disk1/%d_backups/%U&#39;;
CONFIGURE CHANNEL 2 DEVICE TYPE DISK FORMAT &#39;/disk2/%d_backups/%U&#39;;
CONFIGURE CHANNEL 3 DEVICE TYPE DISK FORMAT &#39;/disk3/%d_backups/%U&#39;;
BACKUP AS COPY DATABASE;
</pre></div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV89513"></a>
<div class="props_rev_3"><a id="GUID-88BAB25A-FD25-4577-A08A-71B78A91583F"></a>
<h3 id="BRADV-GUID-88BAB25A-FD25-4577-A08A-71B78A91583F" class="sect3">Specifying Tags for an RMAN Backup</h3>
<div>
<p><a id="d37979e1156" class="indexterm-anchor"></a>RMAN attaches a character string called a <a href="glossary.htm#GUID-7679D8DB-B41A-4DDC-A1DD-20CEDC0BCA8E"><span class="xrefglossterm">tag</span></a> to every backup it creates, as a way of identifying the backup. You can either accept the default tag or specify your own with the <code class="codeph">TAG</code> parameter of the <code class="codeph">BACKUP</code> command.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15">About Backup Tags</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36">Specifying Tags for Backup Sets and Image Copies</a></p>
</li>
</ul>
</div>
<a id="BRADV89514"></a>
<div class="props_rev_3"><a id="GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15"></a>
<h4 id="BRADV-GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15" class="sect4">About Backup Tags</h4>
<div>
<p><a id="d37979e1251" class="indexterm-anchor"></a><a id="d37979e1255" class="indexterm-anchor"></a><a id="d37979e1259" class="indexterm-anchor"></a>User-specified tags are a useful way to indicate the purpose or usage of different classes of backups or copies. You can tag backup sets, proxy copies, data file copies, or control file copies. For example, you can tag data file copies that you intend to use in a <a class="olink RCMRF159" target="_blank" href="../RCMRF/rcmsynta2021.htm#RCMRF159"><code class="codeph">SWITCH</code></a> command as <code class="codeph">for_switch_only</code> and file copies to use only for a <a class="olink RCMRF149" target="_blank" href="../RCMRF/rcmsynta2008.htm#RCMRF149"><code class="codeph">RESTORE</code></a> command as <code class="codeph">for_restore_only</code>.</p>
<p>Tags do not need to be unique, so multiple backup sets or image copies can have the same tag (for example, <code class="codeph">weekly_backup</code>). Assume that you specify that a data file be restored from backups that have a specific tag. If multiple backups of the requested file have the desired tag, then RMAN restores the most recent backup that has the desired tag, within any constraints on the <code class="codeph">RESTORE</code> command.</p>
<p>In practice, tags are often used to distinguish a series of backups created as part of a single strategy, such as an incremental backup strategy. For example, you might create a weekly incremental backup with a tag like <code class="codeph">BACKUP TAG weekly_incremental</code>. Many forms of the <code class="codeph">BACKUP</code> command let you associate a tag with a backup, and many <code class="codeph">RESTORE</code> and <a class="olink RCMRF140" target="_blank" href="../RCMRF/rcmsynta2001.htm#RCMRF140"><code class="codeph">RECOVER</code></a> commands let you specify a tag to restrict which backups to use in the <code class="codeph">RESTORE</code> or <code class="codeph">RECOVER</code> operation.</p>
<p>If you do not explicitly specify a tag with the <code class="codeph">TAG</code> parameter of the <code class="codeph">BACKUP</code> command, then RMAN implicitly creates a default tag for backups (except for control file autobackups). The format of the tag is <code class="codeph">TAG</code><span class="italic"><code class="codeph">YYYYMMDD</code></span><code class="codeph">T</code><span class="italic"><code class="codeph">HHMMSS</code></span>, where <span class="italic"><code class="codeph">YYYY</code></span> is the year, <span class="italic"><code class="codeph">MM</code></span> is the month, <span class="italic"><code class="codeph">DD</code></span> is the day, <span class="italic"><code class="codeph">HH</code></span> is the hour (in 24-hour format), <span class="italic"><code class="codeph">MM</code></span> is the minutes, and <span class="italic"><code class="codeph">SS</code></span> is the seconds. For example, a backup of data file <code class="codeph">1</code> may get the tag <code class="codeph">TAG20070208T133437</code>. The date and time refer to when RMAN started the backup in the time zone of the instance performing the backup. If multiple backup sets are created by one <code class="codeph">BACKUP</code> command, then each backup piece has the same default tag.</p>
<p>Tags are stored in uppercase, regardless of the case used when entering them. The maximum length of a backup tag is 30 bytes. Tags cannot use operating system environment variables or use special formats such as <code class="codeph">%T</code> or <code class="codeph">%D</code>.</p>
<div class="infoboxnotealso" id="GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15__GUID-281FEFA1-06F9-4CE8-B1B1-759674355ED3">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for the default format description in <code class="codeph">BACKUP</code> <code class="codeph">...</code> <code class="codeph">TAG</code></p>
</div>
</div>
</div>
<a id="BRADV214"></a><a id="BRADV609"></a><a id="BRADV610"></a><a id="BRADV89515"></a>
<div class="props_rev_3"><a id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36"></a>
<h4 id="BRADV-GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36" class="sect4">Specifying Tags for Backup Sets and Image Copies</h4>
<div>
<div class="section">
<p>The characters in a tag must be limited to the characters that are legal in file names on the target database file system. For example, <a href="glossary.htm#GUID-94080845-3FF3-4FB4-91EB-AEA1749411DC"><span class="xrefglossterm">Automatic Storage Management (ASM)</span></a> does not support the use of the hyphen (<code class="codeph">-</code>) in the file names it uses internally, so a tag including a hyphen (such as <code class="codeph">weekly-incr</code>) is not a legal tag name for backups in ASM disk groups.</p>
<p>When you tag a backup set, the tag is an attribute of each backup piece in a given copy of a backup set. <a id="d37979e1474" class="indexterm-anchor"></a><a id="d37979e1476" class="indexterm-anchor"></a>If you create a <a href="glossary.htm#GUID-EA6CE3E8-6986-4512-AF66-710D80376093"><span class="xrefglossterm">multiplexed backup set</span></a>, then each copy of the backup set is assigned the same tag.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36__CHDEEGGD">
<p class="titleinexample">Example 9-4 Applying a Tag to a Backup Set</p>
<p>This example creates one backup set with the tag <code class="codeph">MONDAYBKP</code>.</p>
<pre dir="ltr">BACKUP AS BACKUPSET
  COPIES 1 
  DATAFILE 7
  TAG mondaybkp; 
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36__CHDHAABB">
<p class="titleinexample">Example 9-5 Applying Tags to Image Copies</p>
<p>This example shows that copies of data files in tablespaces <code class="codeph">users</code> and <code class="codeph">tools</code> are assigned the tag <code class="codeph">MONDAYCPY</code>. When you specify a tag for image copies, the tag applies to each individual copy.</p>
<pre dir="ltr">BACKUP AS COPY 
  TABLESPACE users, tools
  TAG mondaycpy;
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36__CHDFIDHD">
<p class="titleinexample">Example 9-6 Assigning Tags to Output Copies</p>
<p>This example creates new copies of all image copies of the database that have the tag <code class="codeph">full_cold_copy</code> and gives the new copies the tag <code class="codeph">new_full_cold_copy</code>. You can use <code class="codeph">FROM TAG</code> to copy an image copy with a specific tag, and then use <code class="codeph">TAG</code> to assign the output copy a different tag.</p>
<pre dir="ltr">BACKUP AS COPY
  COPY OF DATABASE
    FROM TAG full_cold_copy
  TAG new_full_cold_copy;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="BRADV218"></a><a id="BRADV8138"></a>
<div class="props_rev_3"><a id="GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E"></a>
<h3 id="BRADV-GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E" class="sect3">Making Compressed Backups</h3>
<div>
<div class="section">
<p><a id="d37979e1601" class="indexterm-anchor"></a><a id="d37979e1605" class="indexterm-anchor"></a><a id="d37979e1607" class="indexterm-anchor"></a>For any use of the <code class="codeph">BACKUP</code> command that creates backup sets, you can take advantage of RMAN support for <a href="glossary.htm#GUID-90E07DCF-D038-4770-8A1A-06AF137C3762"><span class="xrefglossterm">binary compression</span></a> of backup sets. <a id="d37979e1617" class="indexterm-anchor"></a><a id="d37979e1621" class="indexterm-anchor"></a>Specify the <code class="codeph">AS COMPRESSED BACKUPSET</code> option to <a id="d37979e1630" class="indexterm-anchor"></a>the <code class="codeph">BACKUP</code> command.</p>
<p>RMAN compresses the backup set contents before writing them to disk. The details of which binary compression level is used are automatically recorded in the backup set. There is no need to explicitly mention the type of compression used or how to decompress the backup set in the recovery operation.</p>
<p>Binary compression creates some performance overhead during backup and restore operations. Binary compression consumes CPU resources, so do not routinely schedule compressed backups when CPU usage is high. However, the following circumstances may warrant paying the performance penalty:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>You are using disk-based backups when disk space in your fast recovery area or other disk-based backup destination is limited.</p>
</li>
<li>
<p>You are performing your backups to some device over a network when reduced network bandwidth is more important than CPU usage.</p>
</li>
<li>
<p>You are using some archival backup media such as CD or DVD, where reducing backup sizes saves on media costs and archival storage.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E__GUID-AD1CE662-A3FB-48E9-BF25-511746AAB792">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcncpt.htm#GUID-2AFCD551-95CB-4F9F-946E-550E89613974">About Binary Compression for RMAN Backup Sets</a>&#34;</span> and the <code class="codeph">AS COMPRESSED BACKUPSET</code> option of the <code class="codeph">BACKUP</code> command in <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for performance details regarding backup sets</p>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E__CHDHCDFJ">
<p class="titleinexample">Example 9-7 Making Compressed Backups</p>
<p>This example backs up the entire database and archived logs to the configured default backup destination (disk or tape), producing compressed backup sets.</p>
<pre dir="ltr">BACKUP 
  AS COMPRESSED BACKUPSET 
  DATABASE PLUS ARCHIVELOG;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="BRADV711"></a><a id="BRADV728"></a><a id="BRADV659"></a><a id="BRADV380"></a>
<div class="props_rev_3"><a id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9"></a>
<h3 id="BRADV-GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9" class="sect3">Specifying Multisection Incremental Backups</h3>
<div>
<div class="section">
<p>A multisection backup enables large data files to be divided into sections that can be backed up in parallel across multiple channels. This provides faster backup performance and better recovery times. A multisection backup contains multiple backup pieces. During a multisection backup operation, RMAN writes to each backup piece, in parallel, by using a separate channel for each backup piece.</p>
<p>Multisection full backups of databases and data files are supported starting with Oracle Database 11<span class="italic">g</span> Release 1. Starting with Oracle Database 12<span class="italic">c</span> Release 1 (12.1), RMAN supports multisection incremental backups. Wherever applicable, RMAN also uses <span class="bold"><a href="glossary.htm#GUID-0AA7EB43-FEA6-405F-9443-A4A2B43FFF96"><span class="xrefglossterm">unused block compression</span></a></span> and <span class="bold"><a href="glossary.htm#GUID-C80ACD57-9170-4FA5-A61F-81A05E77A1A4"><span class="xrefglossterm">block change tracking</span></a></span> while creating multisection incremental backups. When backup sets are used, you can create multisection full or incremental backups.</p>
<div class="infoboxnotealso" id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9__GUID-184CBFAC-CCED-48B1-85D4-06977F56DF9F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmcncpt.htm#GUID-50F8DBCD-C285-491F-B8E7-E1B2140E1B51">About Unused Block Compression</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmbckba.htm#GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A">Using Block Change Tracking to Improve Incremental Backup Performance</a>&#34;</span></p>
</li>
</ul>
</div>
<p>To create level 0 multisection incremental backups, the <code class="codeph">COMPATIBLE</code> parameter must be set to 11.0 or higher. However, to create multisection incremental backups of level 1 or higher, you must set the <code class="codeph">COMPATIBLE</code> parameter to 12.0.0 or higher. RMAN always creates multisection incremental backups with <code class="codeph">FILESPERSET</code> set to 1.</p>
<p>Use the<a id="d37979e1830" class="indexterm-anchor"></a> <code class="codeph">SECTION SIZE</code> clause of the <code class="codeph">BACKUP</code> command to create multisection backups. The <code class="codeph">SECTION SIZE</code> clause specifies the size of each backup section. If you specify a section size that is larger than the size of the file, then RMAN does not use multisection backups for that file. If you specify a small section size that would produce more than 256 sections, then RMAN increases the section size to a value that results in exactly 256 sections.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Views to Identify Multisection Backups</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Use the <code class="codeph">MULTI_SECTION</code> column of the <code class="codeph">V$BACKUP_SET</code> view or the recovery catalog view <code class="codeph">RC_BACKUP_SET</code> to determine if a backup is a multisection backup. For multisection backups, the <code class="codeph">MULTI_SECTION</code> column contains the value YES.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Views That Contain Metadata for Multisection Backups</p>
</div>
<!-- class="section" -->
<div class="section">
<p>The <code class="codeph">V$BACKUP_DATAFILE</code> and <code class="codeph">RC_BACKUP_DATAFILE</code> views provide information about the number of blocks in each section of a multisection backup. The <code class="codeph">BLOCKS</code> column specifies the number of blocks in each multisection backup.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Example: Multisection Incremental Backup of Database as Backup Sets</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Use the following steps to create a multisection level 1 incremental backup of a data file as backup sets:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Ensure that the initialization parameter <code class="codeph">COMPATIBLE</code> of the target database is set to 12.0.0 or higher.</span></li>
<li class="stepexpand"><span>Start RMAN and connect to a target database as a user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</span>
<div>
<div class="infoboxnotealso" id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9__GUID-34C02194-D9D2-4E01-BCA5-8099182378B8">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>If required, configure <a href="glossary.htm#GUID-57D1A253-9620-4588-82E3-EC2BEC2B1B0C"><span class="xrefglossterm">channel parallelism</span></a> so that RMAN can write to the backup device in parallel.</span>
<div>
<p>The following example configures RMAN to use two disk channels in parallel.</p>
<pre dir="ltr">CONFIGURE DEVICE TYPE disk PARALLELISM 2;
</pre></div>
</li>
<li class="stepexpand"><span>Execute <code class="codeph">BACKUP</code> with <code class="codeph">SECTION SIZE</code> to indicate that a multisection backup must be created.</span>
<div>
<p>The following example creates a multisection section level 1 backup of the data file <code class="codeph">users_df.dbf</code> using backup sets. Each backup piece is 100MB.</p>
<pre dir="ltr">BACKUP 
   INCREMENTAL LEVEL 1
   SECTION SIZE 100M
   DATAFILE &#39;/oradata/datafiles/users_df.dbf&#39;;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV660"></a><a id="BRADV665"></a>
<div class="props_rev_3"><a id="GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8"></a>
<h3 id="BRADV-GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8" class="sect3">Making Multisection Backups Using Image Copies</h3>
<div>
<div class="section">
<p>RMAN enables you to create multisection backups using image copies. Multisection backups provide better performance by using multiple channels to back up large files in parallel. Starting with Oracle Database 12<span class="italic">c</span> Release 1 (12.1), you can create multisection full backups that are stored as image copies. While the image copy is being created, multiple channels are used to write files sections. However, the output of this operation is one copy for each data file.</p>
<p>Use the <code class="codeph">SECTION SIZE</code> clause to create multisection backups. If the section size that you specify is larger than the size of the file, then RMAN does not use multisection backups for that file. If you specify a small section size that would produce more than 256 sections, then RMAN increases the section size to a value that results in exactly 256 sections</p>
<p>See <span class="q">&#34;<a href="rcmbckba.htm#GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9">Specifying Multisection Incremental Backups</a>&#34;</span> for information about the views that contain information about multisection backups.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">Example: Multisection Backup of Data File as Image Copies</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Use the following steps to create a multisection backup of a database as image copies:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Ensure that the <code class="codeph">COMPATIBLE</code> parameter for the target database is set to 12.0.0 or higher.</span></li>
<li class="stepexpand"><span>Start RMAN and connect to a target database as a user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</span>
<div>
<div class="infoboxnotealso" id="GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8__GUID-7D9CD6D1-F5C5-4DD9-9317-613E991957EF">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
<p>The <code class="codeph">sbu</code> user is granted the <code class="codeph">SYSBACKUP</code> privilege in the target database. RMAN prompts you to enter the password.</p>
</div>
</li>
<li class="stepexpand"><span>If required, configure <a href="glossary.htm#GUID-57D1A253-9620-4588-82E3-EC2BEC2B1B0C"><span class="xrefglossterm">channel parallelism</span></a> so that RMAN can perform the backup operation using multiple drives in parallel.</span></li>
<li class="stepexpand"><span>Execute <code class="codeph">BACKUP</code> with <code class="codeph">SECTION SIZE</code> and <code class="codeph">AS COPY</code> to indicate that a multisection backup must be created using image copies.</span>
<div>
<p>The following example creates a multisection incremental backup of the entire database using image copies. Each backup piece is 500MB.</p>
<pre dir="ltr">BACKUP 
   AS COPY
   SECTION SIZE 500M
   DATABASE;
</pre></div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV8132"></a>
<div class="props_rev_3"><a id="GUID-344F4D14-AC81-4093-B921-6403EE75112C"></a>
<h2 id="BRADV-GUID-344F4D14-AC81-4093-B921-6403EE75112C" class="sect2">Backing Up Database Files with RMAN</h2>
<div>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45">Backing Up a Whole Database with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1">Backing Up Tablespaces and Data Files with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD">Backing Up Control Files with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30">Backing Up Server Parameter Files with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E">Backing Up a Database in NOARCHIVELOG Mode</a></p>
</li>
</ul>
</div>
<a id="BRADV220"></a><a id="BRADV8231"></a>
<div class="props_rev_3"><a id="GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45"></a>
<h3 id="BRADV-GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45" class="sect3">Backing Up a Whole Database with RMAN</h3>
<div>
<div class="section">
<p><a id="d37979e2253" class="indexterm-anchor"></a><a id="d37979e2259" class="indexterm-anchor"></a><a id="d37979e2263" class="indexterm-anchor"></a><a id="d37979e2267" class="indexterm-anchor"></a><a id="d37979e2271" class="indexterm-anchor"></a><a id="d37979e2277" class="indexterm-anchor"></a>You can perform a <a href="glossary.htm#GUID-611F9611-06F5-4E68-8EA1-D0210B27B2D0"><span class="xrefglossterm">whole database backup</span></a> with the database mounted or open. To perform a whole database backup, from the RMAN prompt, use <a id="d37979e2286" class="indexterm-anchor"></a><a id="d37979e2290" class="indexterm-anchor"></a>the <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP DATABASE</code></a> command.</p>
<p>You may want to exclude specified tablespaces from a whole database backup. As explained in <span class="q">&#34;<a href="rcmconfa.htm#GUID-9E83A7FF-6D4B-4385-8BF0-D5E65E808078">Configuring Tablespaces for Exclusion from Whole Database Backups</a>&#34;</span>, you can persistently skip tablespaces across RMAN sessions by executing the <a class="olink RCMRF113" target="_blank" href="../RCMRF/rcmsynta009.htm#RCMRF113"><code class="codeph">CONFIGURE EXCLUDE</code></a> command for each tablespace that you always want to skip. You can override the configured setting with <code class="codeph">BACKUP ... NOEXCLUDE</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up the database:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45__GUID-24BF5DFB-EF15-4305-8BE7-D25F8CB5099F">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the database is mounted or open.</span></li>
<li class="stepexpand"><span>Issue the <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP DATABASE</code></a> command at the RMAN prompt.</span>
<div>
<p>The simplest form of the command requires no options or parameters:</p>
<pre dir="ltr">BACKUP DATABASE;
</pre>
<p>For a list of what files are backed up (data files, control file, server parameter file) see the <code class="codeph">BACKUP</code> command keyword <code class="codeph">DATABASE</code> in <a class="olink RCMRF" target="_blank" href="../RCMRF/toc.htm"><span class="italic">Oracle Database Backup and Recovery Reference</span></a>.</p>
<p>The following example backs up the database, switches the online redo logs, and includes archived logs in the backup:</p>
<pre dir="ltr">BACKUP DATABASE PLUS ARCHIVELOG;
</pre>
<p>By archiving the logs immediately after the backup, you ensure that you have a full set of archived logs through the time of the backup. In this way, you guarantee that you can perform media recovery after restoring this backup.</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45__GUID-8B865B1E-D66E-4C3E-A213-CDED2E040DEC">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF" target="_blank" href="../RCMRF/toc.htm"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code class="codeph">BACKUP</code> command and <code class="codeph">CONNECT</code> command</p>
</li>
<li>
<p><a href="rcmbckad.htm#GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12">Skipping Offline, Read-Only, and Inaccessible Files</a> to learn how to use <code class="codeph">BACKUP ... SKIP</code> to skip inaccessible data files or data files that are in offline or read-only tablespaces</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV222"></a><a id="BRADV89516"></a>
<div class="props_rev_3"><a id="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1"></a>
<h3 id="BRADV-GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1" class="sect3">Backing Up Tablespaces and Data Files with RMAN</h3>
<div>
<div class="section">
<p><a id="d37979e2461" class="indexterm-anchor"></a><a id="d37979e2467" class="indexterm-anchor"></a>You can back up one or more tablespaces with <a id="d37979e2472" class="indexterm-anchor"></a><a id="d37979e2476" class="indexterm-anchor"></a>the <code class="codeph">BACKUP TABLESPACE</code> command or one or more data files with the<a id="d37979e2484" class="indexterm-anchor"></a><a id="d37979e2488" class="indexterm-anchor"></a> <code class="codeph">BACKUP DATAFILE</code> command. When you specify tablespaces, RMAN translates the tablespace name internally into a list of data files. The database can be mounted or open. Tablespaces can be read/write or read-only.<a id="d37979e2497" class="indexterm-anchor"></a><a id="d37979e2503" class="indexterm-anchor"></a></p>
<div class="infobox-note" id="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1__GUID-17CBBDAE-D18F-49BC-9EEF-1FB7D6499241">
<p class="notep1">Note:</p>
<p>Transportable tablespaces do not have to be in read/write mode for backup as in previous releases.</p>
</div>
<p>RMAN automatically backs up the control file and the server parameter file (if the instance was started with a server parameter file) when data file <code class="codeph">1</code> is included in the backup. If <a href="glossary.htm#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">control file autobackup</span></a> is enabled, then RMAN writes the current control file and server parameter file to a separate autobackup piece. Otherwise, RMAN includes these files in the backup set that contains data file <code class="codeph">1</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up tablespaces or data files:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1__GUID-65E9AB0A-8BCF-4466-B7F2-862799C57A43">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>If the database instance is not started, then either mount or open the database.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">BACKUP</code> <code class="codeph">TABLESPACE</code> command or <code class="codeph">BACKUP DATAFILE</code> command at the RMAN prompt.</span></li>
</ol>
<div class="section">
<p>The following example backs up the <code class="codeph">users</code> and <code class="codeph">tools</code> tablespaces to tape:</p>
<pre dir="ltr">BACKUP
  DEVICE TYPE sbt
  TABLESPACE users, tools;
</pre>
<p>The following example uses an SBT channel to back up data files <code class="codeph">1</code> through <code class="codeph">4</code> and a data file copy stored at <code class="codeph">/tmp/system01.dbf</code> to tape:</p>
<pre dir="ltr">BACKUP 
  DEVICE TYPE sbt 
  DATAFILE 1,2,3,4 
  DATAFILECOPY &#39;/tmp/system01.dbf&#39;;
</pre></div>
<!-- class="section" --></div>
</div>
<a id="BRADV89517"></a>
<div class="props_rev_3"><a id="GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD"></a>
<h3 id="BRADV-GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD" class="sect3">Backing Up Control Files with RMAN</h3>
<div>
<p><a id="d37979e2646" class="indexterm-anchor"></a><a id="d37979e2652" class="indexterm-anchor"></a>You can back up the control file when the database is mounted or open. RMAN uses a <a href="glossary.htm#GUID-C49B814B-6834-4CC0-911D-60F7CA87669F"><span class="xrefglossterm">snapshot control file</span></a> to ensure a read-consistent version.<a id="d37979e2663" class="indexterm-anchor"></a><a id="d37979e2665" class="indexterm-anchor"></a> If the <a class="olink RCMRF113" target="_blank" href="../RCMRF/rcmsynta009.htm#RCMRF113"><code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP</code></a> command is set to <code class="codeph">ON</code> (by default it is <code class="codeph">OFF</code>), then RMAN automatically backs up the control file and server parameter file after every backup and after database structural changes. The <a href="glossary.htm#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">control file autobackup</span></a> contains metadata about the previous backup, which is crucial for <a href="glossary.htm#GUID-641AA42A-EAFE-449E-99D9-55DCBAE6539D"><span class="xrefglossterm">disaster recovery</span></a>.</p>
<div class="infobox-note" id="GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD__GUID-FB72AC7A-D9BC-401A-8918-7C5F7944D5C9">
<p class="notep1">Note:</p>
<p>You can restore a backup of a control file made on one Data Guard database to any other database in the environment. Primary and standby control file backups are <a id="d37979e2693" class="indexterm-anchor"></a>interchangeable. See <a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to use RMAN to restore files on a standby database.</p>
</div>
<p>If the autobackup feature is not set, then you must manually back up the control file in one of the following ways:</p>
<ul style="list-style-type: disc;">
<li>
<p><a id="d37979e2708" class="indexterm-anchor"></a><a id="d37979e2712" class="indexterm-anchor"></a>Run <code class="codeph">BACKUP</code> <code class="codeph">CURRENT</code> <code class="codeph">CONTROLFILE</code>.</p>
</li>
<li>
<p>Include a backup of the control file within any backup by using the <code class="codeph">INCLUDE</code> <code class="codeph">CURRENT</code> <code class="codeph">CONTROLFILE</code> option of the <code class="codeph">BACKUP</code> command.</p>
</li>
<li>
<p>Back up data file <code class="codeph">1</code>, because RMAN automatically includes the control file and server parameter file in backups of data file <code class="codeph">1</code>.</p>
<div class="infobox-note" id="GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD__GUID-74C12E57-6DC4-4132-8DB3-584EB0D9142A">
<p class="notep1">Note:</p>
<p>If the control file block size is different from the block size for data file <code class="codeph">1</code>, then the control file cannot be written into the same backup set as the data file. RMAN writes the control file into a backup set by itself if the block size is different. <a id="d37979e2756" class="indexterm-anchor"></a>The <code class="codeph">V$CONTROLFILE.BLOCK_SIZE</code> column indicates the control file block size, whereas the <code class="codeph">DB_BLOCK_SIZE</code> initialization parameter indicates the block size of data file <code class="codeph">1</code>.</p>
</div>
</li>
</ul>
</div>
<a id="BRADV729"></a>
<div class="props_rev_3"><a id="GUID-D796580F-B3F0-46BE-A47B-D8130461CF3D"></a>
<h4 id="BRADV-GUID-D796580F-B3F0-46BE-A47B-D8130461CF3D" class="sect4">About Manual Backups of the Control File</h4>
<div>
<p><a id="d37979e2837" class="indexterm-anchor"></a><a id="d37979e2843" class="indexterm-anchor"></a>A manual backup of the control file is different from a control file autobackup. RMAN makes a control file autobackup after the files specified in the <code class="codeph">BACKUP</code> command are backed up. Thus, the autobackup&mdash;unlike a manual control file backup&mdash;contains metadata about the backup that just completed. Also, RMAN can automatically restore autobackups without the use of a recovery catalog.</p>
<p>You can make a manual backup of the current control file either as a <a href="glossary.htm#GUID-6AA43E7D-9946-4C41-A62F-01E5BACEB8A7"><span class="xrefglossterm">backup set</span></a> or as an <a href="glossary.htm#GUID-397CB99E-3F07-4980-96B3-9D0D0ABBABEA"><span class="xrefglossterm">image copy</span></a>. For a backup set, RMAN first creates a snapshot control file for read consistency. You can configure the file name and location of the snapshot control file. A snapshot control file is not needed for an image copy.</p>
<p>In an Oracle Real Application Clusters (Oracle RAC) environment, the following restrictions apply:</p>
<ul style="list-style-type: disc;">
<li>
<p>The snapshot control file location must be on shared storage&mdash;that is, storage that is accessible by all Oracle RAC instances.</p>
</li>
<li>
<p>The destination of an image copy of the current control file must be shared storage.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-D796580F-B3F0-46BE-A47B-D8130461CF3D__GUID-0A0E143A-8CAC-4CE4-8421-3FE2504FAD13">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmconfa.htm#GUID-B7B61600-6DED-413D-B134-1DAE79627A01">Configuring the Snapshot Control File Location</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351">Making a Manual Backup of the Control File</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV226"></a><a id="BRADV89518"></a>
<div class="props_rev_3"><a id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351"></a>
<h4 id="BRADV-GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351" class="sect4">Making a Manual Backup of the Control File</h4>
<div>
<div class="section">
<p>To make a manual backup, you can either specify <code class="codeph">INCLUDE</code> <code class="codeph">CURRENT</code> <code class="codeph">CONTROLFILE</code> when backing up other files or specify <code class="codeph">BACKUP CURRENT CONTROLFILE</code>. You can also back up control file copies on disk by specifying the <code class="codeph">CONTROLFILECOPY</code> parameter.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To manually back up the control file:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-7FA53735-747B-4C42-9C2B-B4B387A13F14">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the target database is mounted or open.</span></li>
<li class="stepexpand"><span><a id="d37979e2997" class="indexterm-anchor"></a><a id="d37979e3001" class="indexterm-anchor"></a>Execute the <code class="codeph">BACKUP</code> command with the desired control file clause.</span>
<div>
<p>The following example backs up tablespace <code class="codeph">users</code> to tape and includes the current control file in the backup:</p>
<pre dir="ltr">BACKUP DEVICE TYPE sbt 
  TABLESPACE users 
  INCLUDE CURRENT CONTROLFILE;
</pre>
<p>The following example backs up the current control file to the fast recovery area as a backup set:</p>
<pre dir="ltr">BACKUP CURRENT CONTROLFILE;
</pre>
<p>RMAN first creates a snapshot control file.</p>
<p><a id="d37979e3024" class="indexterm-anchor"></a><a id="d37979e3028" class="indexterm-anchor"></a>The following example backs up the current control file to the default disk device as an image copy:</p>
<pre dir="ltr">BACKUP AS COPY
  CURRENT CONTROLFILE 
  FORMAT &#39;/tmp/control01.ctl&#39;;
</pre>
<p>The following example backs up the control file copy created in the previous example to tape:</p>
<pre dir="ltr">BACKUP AS COPY 
  CURRENT CONTROLFILE 
  FORMAT &#39;/tmp/control01.ctl&#39;;
BACKUP DEVICE TYPE sbt 
  CONTROLFILECOPY &#39;/tmp/control01.ctl&#39;;
</pre>
<p>A snapshot control file is not needed when backing up a control file copy.</p>
<p>If the control file autobackup feature is enabled, then RMAN makes two control file backups in these examples: the explicit backup of the files specified in the <code class="codeph">BACKUP</code> command and the control file and server parameter file autobackup.</p>
<div class="infoboxnotealso" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-0F793CC9-89D7-43E2-9F18-E030AD452369">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF113" target="_blank" href="../RCMRF/rcmsynta009.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP</code> command</p>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV230"></a><a id="BRADV89519"></a>
<div class="props_rev_3"><a id="GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30"></a>
<h3 id="BRADV-GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30" class="sect3">Backing Up Server Parameter Files with RMAN</h3>
<div>
<div class="section">
<p><a id="d37979e3128" class="indexterm-anchor"></a><a id="d37979e3132" class="indexterm-anchor"></a>As explained in <span class="q">&#34;<a href="rcmbckba.htm#GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD">Backing Up Control Files with RMAN</a>&#34;</span>, RMAN automatically backs up the current server parameter file in certain cases. <a id="d37979e3142" class="indexterm-anchor"></a><a id="d37979e3146" class="indexterm-anchor"></a>The <code class="codeph">BACKUP</code> <code class="codeph">SPFILE</code> command backs up the parameter file explicitly. The server parameter file that is backed up is the one currently in use by the instance.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up the server parameter file:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30__GUID-A8E70398-9BDB-4422-892E-4607AC29BB35">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the target database is mounted or open.</span>
<div>
<p>The database must have been started with a server parameter file. If the instance is started with a client-side initialization parameter file, then RMAN issues an error if you execute <code class="codeph">BACKUP ... SPFILE</code>.</p>
</div>
</li>
<li class="stepexpand"><span>Execute the <code class="codeph">BACKUP ... SPFILE</code> command.</span>
<div>
<p>The following example backs up the server parameter file to tape:</p>
<pre dir="ltr">BACKUP DEVICE TYPE sbt SPFILE;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV231"></a><a id="BRADV89526"></a>
<div class="props_rev_3"><a id="GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E"></a>
<h3 id="BRADV-GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E" class="sect3">Backing Up a Database in NOARCHIVELOG Mode</h3>
<div>
<div class="section">
<p><a id="d37979e3263" class="indexterm-anchor"></a><a id="d37979e3267" class="indexterm-anchor"></a><a id="d37979e3271" class="indexterm-anchor"></a>You can only back up a database in <code class="codeph">NOARCHIVELOG</code> mode when the database is closed and in a consistent state. The script shown in <a href="rcmbckba.htm#GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E__BGBBDDEA">Example 9-8</a> puts the database into the correct mode for a consistent, whole database backup and then backs up the database. The script assumes that <a href="glossary.htm#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">control file autobackup</span></a> is enabled for the database.</p>
<p>You can skip tablespaces, such as read-only tablespaces, but any skipped tablespace that has not been offline or read-only since its last backup is lost if the database has to be restored from a backup.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E__BGBBDDEA">
<p class="titleinexample">Example 9-8 Backing Up a Database in NOARCHIVELOG Mode</p>
<pre dir="ltr">SHUTDOWN IMMEDIATE; 
# Start the database in case it suffered instance failure or was 
# closed with SHUTDOWN ABORT before starting this script. 
STARTUP FORCE DBA; 
SHUTDOWN IMMEDIATE; 
STARTUP MOUNT;
# this example uses automatic channels to make the backup
BACKUP 
  INCREMENTAL LEVEL 0
  MAXSETSIZE 10M
  DATABASE
  TAG &#39;BACKUP_1&#39;;
# Now that the backup is complete, open the database. 
ALTER DATABASE OPEN; 
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="BRADV428"></a>
<div class="props_rev_3"><a id="GUID-EB261F93-318D-4EBA-8E26-B0589703CC73"></a>
<h2 id="BRADV-GUID-EB261F93-318D-4EBA-8E26-B0589703CC73" class="sect2">Backing Up CDBs and PDBs</h2>
<div>
<p>This section explains how to back up multitenant container databases (<a href="glossary.htm#GUID-3D253996-C2C0-449A-AFA2-85A9DA323FD3"><span class="xrefglossterm">CDB</span></a>s) and pluggable databases (<a href="glossary.htm#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>s). It contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37">About Backing Up CDBs and PDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB">Backing Up a Whole CDB</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB">Backing Up the Root with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5">Backing Up the Root with Oracle Enterprise Manager Cloud Control</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382">Backing Up PDBs with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B">Backing Up PDBs with Oracle Enterprise Manager Cloud Control</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-6AD83271-F900-4EA6-B787-865E5DC0678A">Backing Up Tablespaces and Data Files in a PDB</a></p>
</li>
</ul>
<div class="infobox-note" id="GUID-EB261F93-318D-4EBA-8E26-B0589703CC73__GUID-3D62F1DC-06C5-451A-8FED-401F47CB69CD">
<p class="notep1">Note:</p>
<p>Backups of a <a href="glossary.htm#GUID-62A96A52-3B97-455A-A443-75B999DCAC94"><span class="xrefglossterm">non-CDB</span></a> are not usable after the non-CDB is plugged in as a PDB into another CDB.</p>
</div>
<div class="infoboxnotealso" id="GUID-EB261F93-318D-4EBA-8E26-B0589703CC73__GUID-FEFB7343-2E65-49AA-940C-D5F270049444">
<p class="notep1">See Also:</p>
<p><a class="olink CNCPT89233" target="_blank" href="../CNCPT/part_consol.htm#CNCPT89233"><span class="italic">Oracle Database Concepts</span></a> for an introduction to PDBs</p>
</div>
</div>
<a id="BRADV730"></a>
<div class="props_rev_3"><a id="GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37"></a>
<h3 id="BRADV-GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37" class="sect3">About Backing Up CDBs and PDBs</h3>
<div>
<p>RMAN and Oracle Enterprise Manager Cloud Control provide full support for backup and recovery in a multitenant environment. The <a href="glossary.htm#GUID-665B741C-5624-40B5-81FF-93B1EC67FC56"><span class="xrefglossterm">multitenant architecture</span></a> enables an Oracle Database to function as a CDB. You can back up and recover a whole CDB, the <a href="glossary.htm#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a> only, or one or more PDBs. You can also back up and recover individual tablespaces and data files in a PDB.</p>
<p>You might want to perform nightly backups of the whole CDB by using an incremental backup strategy, or you might want to make frequent separate backups of individual PDBs and do less frequent backups of either the whole CDB or of the root.</p>
<p>In terms of the ability to recover from data loss, separately backing up the root and all PDBs is equivalent to backing up the whole CDB. The main difference is in the number of RMAN commands that you must enter and the time to recover. Recovering a whole CDB requires less time than recovering the root plus all PDBs.</p>
</div>
</div>
<a id="BRADV429"></a><a id="BRADV731"></a>
<div class="props_rev_3"><a id="GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB"></a>
<h3 id="BRADV-GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB" class="sect3">Backing Up a Whole CDB</h3>
<div>
<div class="section">
<p>Backing up a whole CDB is similar to backing up a non-CDB. When you back up a whole CDB, RMAN backs up the root, all the PDBs, and the archived redo logs. You can then recover either the whole CDB, the root only, or one or more PDBs from the CDB backup.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up a whole CDB:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Follow the instructions in <span class="q">&#34;<a href="rcmbckba.htm#GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45">Backing Up a Whole Database with RMAN</a>&#34;</span>, connecting to the root as a <a href="glossary.htm#GUID-2B102186-15BD-443C-B375-8CB0D442CF5F"><span class="xrefglossterm">common user</span></a> with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</p>
<div class="infoboxnotealso" id="GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB__GUID-AD35412E-F4FD-40A0-BE51-D085C49368FE">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV733"></a><a id="BRADV732"></a>
<div class="props_rev_3"><a id="GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB"></a>
<h3 id="BRADV-GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB" class="sect3">Backing Up the Root with RMAN</h3>
<div>
<div class="section">
<p>You can use RMAN to make a backup of only the root. Because the root contains critical metadata for the whole CDB, Oracle recommends that you back up the root or back up the whole CDB at regular intervals.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up the root with RMAN:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</span>
<div>
<div class="infoboxnotealso" id="GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB__GUID-B9B674CD-E676-451C-8019-B0E20E6F72D7">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Enter the following command:</span>
<div>
<pre dir="ltr">BACKUP DATABASE ROOT;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV734"></a>
<div class="props_rev_3"><a id="GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5"></a>
<h3 id="BRADV-GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5" class="sect3">Backing Up the Root with Oracle Enterprise Manager Cloud Control</h3>
<div>
<div class="section">
<p>To back up the root with <a href="glossary.htm#GUID-3F77B32A-9297-4D41-A234-E06ECDFFC25F"><span class="xrefglossterm">Oracle Enterprise Manager Cloud Control</span></a> (Cloud Control), complete these steps:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>From the Database Home page, select <span class="bold">Backup &amp; Recovery</span> from the Availability menu, and then select <span class="bold">Schedule Backup</span>.</span></li>
<li class="stepexpand"><span>If you have not logged in to the database previously, then the Database Login page is displayed. Log in to the database using Named or New credentials and then click <span class="bold">Login</span>.</span>
<div>
<p>Cloud Control displays the Schedule Backup page.</p>
</div>
</li>
<li class="stepexpand"><span>From the Customized Backup section, choose <span class="bold">Container Database Root</span>, and then click <span class="bold">Schedule Customized Backup</span>.</span>
<div>
<p>The Schedule Backup Wizard appears and displays the Options page.</p>
</div>
</li>
<li class="stepexpand"><span>Complete the wizard by navigating the remainder of the pages to back up the root. For more information about each page of the wizard, click <span class="bold">Help</span>.</span></li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5__GUID-FE568C63-0C02-4C65-B4E5-72FACAC53A58">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmintro.htm#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705">Accessing the Database Home Page Using Cloud Control</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV542"></a><a id="BRADV736"></a><a id="BRADV735"></a>
<div class="props_rev_3"><a id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382"></a>
<h3 id="BRADV-GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382" class="sect3">Backing Up PDBs with RMAN</h3>
<div>
<div class="section">
<p>RMAN enables you to back up one or more PDBs in a CDB. There are two approaches to backing up a PDB with RMAN:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Connect to the root and then use the <code class="codeph">BACKUP</code> <code class="codeph">PLUGGABLE</code> <code class="codeph">DATABASE</code> command. This approach enables you to back up multiple PDBs with a single command.</p>
<p>When you connect to the root and back up a PDB, this backup is visible to the root and to that particular PDB but not to the other PDBs.</p>
</li>
<li>
<p>Connect to the PDB and use the <code class="codeph">BACKUP</code> <code class="codeph">DATABASE</code> command. This approach backs up only a single PDB and enables you to use the same commands used for backing up non-CDBs.</p>
<p>Backups created when connected to any PDB are visible when connected to the root.</p>
</li>
</ul>
<p>When you back up individual PDBs, the archived redo logs are not backed up.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up one or more PDBs while connected to the root:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</p>
<div class="infoboxnotealso" id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382__GUID-5FDBA756-CA2F-4442-9E13-256DA09DE181">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</div>
</li>
<li>
<p>Issue a <code class="codeph">BACKUP PLUGGABLE DATABASE</code> command at the RMAN prompt.</p>
<p>The following example backs up the PDBs <code class="codeph">sales</code> and <code class="codeph">hr</code>:</p>
<pre dir="ltr">BACKUP PLUGGABLE DATABASE sales, hr;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up one PDB while connected to the PDB:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the PDB as a <a href="glossary.htm#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">local user</span></a> with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</span>
<div>
<div class="infoboxnotealso" id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382__GUID-D827148D-C7A7-42A2-ADFE-7D570E890600">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Issue a <code class="codeph">BACKUP DATABASE</code> command at the RMAN prompt.</span>
<div>
<pre dir="ltr">BACKUP DATABASE;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV737"></a>
<div class="props_rev_3"><a id="GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B"></a>
<h3 id="BRADV-GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B" class="sect3">Backing Up PDBs with Oracle Enterprise Manager Cloud Control</h3>
<div>
<div class="section">
<p>To back up one or more PDBs with Oracle Enterprise Manager Cloud Control (Cloud Control), complete these steps:</p>
<ol>
<li>
<p>From the Database Home page, select <span class="bold">Backup &amp; Recovery</span> from the Availability menu, and then select <span class="bold">Schedule Backup</span>.</p>
</li>
<li>
<p>If you have not logged in to the database previously, then the Database Login page is displayed. Log in to the database using Named or New credentials and then click <span class="bold">Login</span>.</p>
<p>Cloud Control displays the Schedule Backup page.</p>
</li>
<li>
<p>From the Customized Backup section, select <span class="bold">Pluggable Databases</span>, and then click <span class="bold">Schedule Customized Backup</span>.</p>
<p>The Schedule Backup Wizard appears and displays the Pluggable Databases page.</p>
</li>
<li>
<p>Select the PDBs that you want to back up by following these steps:</p>
<ol>
<li>
<p>Click <span class="bold">Add</span> to display the Available Pluggable Databases page.</p>
</li>
<li>
<p>From the list of PDBs shown, click in the <span class="bold">Select</span> column to designate the PDBs you want to back up. Optionally, you can click <span class="bold">Select All</span> to turn on the Select option for all available PDBs. Click <span class="bold">Select None</span> to deselect all PDBs.</p>
</li>
<li>
<p>Click the <span class="bold">Select</span> button to return to the Pluggable Databases page.</p>
</li>
<li>
<p>Optionally, you can remove PDBs from the table by clicking in the <span class="bold">Select</span> column for each PDB that you want to remove and then clicking <span class="bold">Remove</span>.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span> to move to the Options page of the wizard.</p>
</li>
<li>
<p>Complete the wizard by navigating the remainder of the pages to back up the PDBs. For more information about each page of the wizard, click <span class="bold">Help</span>.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B__GUID-CE8E08A1-A4EF-4915-9477-08806EA3888D">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmintro.htm#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705">Accessing the Database Home Page Using Cloud Control</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV545"></a><a id="BRADV739"></a><a id="BRADV738"></a>
<div class="props_rev_3"><a id="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A"></a>
<h3 id="BRADV-GUID-6AD83271-F900-4EA6-B787-865E5DC0678A" class="sect3">Backing Up Tablespaces and Data Files in a PDB</h3>
<div>
<div class="section">
<p>Because tablespaces in different PDBs can have the same name, to eliminate ambiguity you must connect directly to a PDB to back up one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect to either the root or a PDB to back up PDB data files. If you connect to the root, you can back up data files from multiple PDBs with a single command. If you connect to a PDB, you can back up only data files in that PDB.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up tablespaces in a PDB:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Start RMAN and connect to the PDB as a local user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</p>
<div class="infoboxnotealso" id="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A__GUID-6DB40C44-871D-418B-BE96-51E07B28436D">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span></p>
</div>
</li>
<li>
<p>Issue a <code class="codeph">BACKUP TABLESPACE</code> command as described in <span class="q">&#34;<a href="rcmbckba.htm#GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1">Backing Up Tablespaces and Data Files with RMAN</a>&#34;</span>.</p>
<pre dir="ltr">BACKUP TABLESPACE users, examples;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up data files in a PDB:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Do one of the following:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</p>
</li>
<li>
<p>Start RMAN and connect to the PDB as a local user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege.</p>
</li>
</ul>
</div>
</li>
<li class="stepexpand"><span>Issue a <code class="codeph">BACKUP</code> <code class="codeph">DATAFILE</code> command.</span>
<div>
<pre dir="ltr">BACKUP DATAFILE 10, 13;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A__GUID-203C3C03-744A-4841-B3E6-652AE06E04EB">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV81399"></a>
<div class="props_rev_3"><a id="GUID-4481CA5F-B1B5-4819-9E6B-7184951EC81A"></a>
<h2 id="BRADV-GUID-4481CA5F-B1B5-4819-9E6B-7184951EC81A" class="sect2">Backing Up Archived Redo Logs with RMAN</h2>
<div>
<p><a id="d37979e4457" class="indexterm-anchor"></a><a id="d37979e4463" class="indexterm-anchor"></a><a id="d37979e4469" class="indexterm-anchor"></a>Archived redo logs are the key to successful media recovery. You should back them up regularly.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-344774AE-65ED-49CB-A0EE-021E2C60102E">About Backups of Archived Redo Logs for non-CDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9">About Backup of Archived Redo Logs in CDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C">Backing Up Archived Redo Log Files in non-CDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2">Backing Up Only Archived Redo Logs That Need Backups in non-CDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-82593941-EA75-4BB0-A001-3B086C6B72EA">Backing Up Archived Redo Logs in CDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-E99C2A06-868F-458A-88F1-B257EADD63CB">Deleting Archived Redo Logs After Backups in non-CDBs</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853">Deleting Archived Redo Logs After Backups in CDBs</a></p>
</li>
</ul>
</div>
<a id="BRADV89520"></a>
<div class="props_rev_3"><a id="GUID-344774AE-65ED-49CB-A0EE-021E2C60102E"></a>
<h3 id="BRADV-GUID-344774AE-65ED-49CB-A0EE-021E2C60102E" class="sect3">About Backups of Archived Redo Logs for non-CDBs</h3>
<div>
<p>Several features of RMAN backups are specific to archived redo logs. <a id="d37979e4592" class="indexterm-anchor"></a><a id="d37979e4596" class="indexterm-anchor"></a>For example, you can use <code class="codeph">BACKUP ... DELETE</code> to <a id="d37979e4604" class="indexterm-anchor"></a>delete one or all copies of archived redo logs from disk after backing them up to backup sets.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C">About Archived Redo Log Failover</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA">About Online Redo Log Switching</a></p>
</li>
</ul>
</div>
<a id="BRADV232"></a><a id="BRADV89521"></a>
<div class="props_rev_3"><a id="GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C"></a>
<h4 id="BRADV-GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C" class="sect4">About Archived Redo Log Failover</h4>
<div>
<p><a id="d37979e4692" class="indexterm-anchor"></a>Even if your redo logs are being archived to multiple destinations and you use RMAN to back up archived redo logs, RMAN selects only one copy of the archived redo log file to include in the backup set. Because logs with the same log sequence number are identical, RMAN does not need to include more than one log copy.</p>
<p>The <a href="glossary.htm#GUID-DFD7F339-C64C-4FE2-8F89-C88B4A020571"><span class="xrefglossterm">archived redo log failover</span></a> feature enables RMAN to complete a backup even when some archiving destinations are missing logs or contain logs with corrupt blocks. If at least one log corresponding to a given log sequence and thread is available in the fast recovery area or any of the archiving destinations, then RMAN tries to back it up. If RMAN finds a corrupt block in a log file during backup, it searches other destinations for a copy of that log without corrupt blocks.</p>
<p>For example, assume that you archive logs 121 through 124 to two destinations: <code class="codeph">/arch1</code> and <code class="codeph">/arch2</code>. <a href="rcmbckba.htm#GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C__CHDHDGAE" title="Sampled archived redo log records">Table 9-1</a> shows the archived redo log records in the control file.</p>
<div class="tblformal" id="GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C__CHDHDGAE">
<p class="titleintable">Table 9-1 Sample Archived Redo Log Records</p>
<table class="cellalignment515" title="Sample Archived Redo Log Records" summary="Sampled archived redo log records">
<thead>
<tr class="cellalignment501">
<th class="cellalignment531" id="d37979e4727">Sequence</th>
<th class="cellalignment564" id="d37979e4730">File Name in /arch1</th>
<th class="cellalignment564" id="d37979e4733">File Name in /arch2</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment534" id="d37979e4738" headers="d37979e4727">
<p>121</p>
</td>
<td class="cellalignment565" headers="d37979e4738 d37979e4730">
<p><code class="codeph">/arch1/archive1_121.arc</code></p>
</td>
<td class="cellalignment565" headers="d37979e4738 d37979e4733">
<p><code class="codeph">/arch2/archive1_121.arc</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment534" id="d37979e4750" headers="d37979e4727">
<p>122</p>
</td>
<td class="cellalignment565" headers="d37979e4750 d37979e4730">
<p><code class="codeph">/arch1/archive1_122.arc</code></p>
</td>
<td class="cellalignment565" headers="d37979e4750 d37979e4733">
<p><code class="codeph">/arch2/archive1_122.arc</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment534" id="d37979e4762" headers="d37979e4727">
<p>123</p>
</td>
<td class="cellalignment565" headers="d37979e4762 d37979e4730">
<p><code class="codeph">/arch1/archive1_123.arc</code></p>
</td>
<td class="cellalignment565" headers="d37979e4762 d37979e4733">
<p><code class="codeph">/arch2/archive1_123.arc</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment534" id="d37979e4774" headers="d37979e4727">
<p>124</p>
</td>
<td class="cellalignment565" headers="d37979e4774 d37979e4730">
<p><code class="codeph">/arch1/archive1_124.arc</code></p>
</td>
<td class="cellalignment565" headers="d37979e4774 d37979e4733">
<p><code class="codeph">/arch2/archive1_124.arc</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>However, unknown to RMAN, a user deletes logs 122 and 124 from the <code class="codeph">/arch1</code> directory. Afterward, you run the following backup:</p>
<pre dir="ltr">BACKUP ARCHIVELOG
  FROM  SEQUENCE 121 
  UNTIL SEQUENCE 125;
</pre>
<p>With failover, RMAN completes the backup, using logs 122 and 124 in <code class="codeph">/arch2</code>.</p>
</div>
</div>
<a id="BRADV89523"></a>
<div class="props_rev_3"><a id="GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA"></a>
<h4 id="BRADV-GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA" class="sect4">About Online Redo Log Switching</h4>
<div>
<p>Another important RMAN feature is automatic online redo log switching. To make an open database backup of archived redo logs that includes the most recent online redo log, you can execute <a id="d37979e4867" class="indexterm-anchor"></a><a id="d37979e4871" class="indexterm-anchor"></a>the <code class="codeph">BACKUP</code> command with any of the following clauses:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">PLUS ARCHIVELOG</code></p>
</li>
<li>
<p><code class="codeph">ARCHIVELOG ALL</code></p>
</li>
<li>
<p><code class="codeph">ARCHIVELOG FROM ...</code></p>
</li>
</ul>
<p>Before beginning the backup, RMAN switches out of the current redo log group, and archives all online redo logs that have not yet been archived, up to and including the redo log group that was current when the command was issued. This feature ensures that the backup contains all redo generated before the start of the command.</p>
<p><a id="d37979e4895" class="indexterm-anchor"></a><a id="d37979e4901" class="indexterm-anchor"></a>An effective way of backing up archived redo logs is the <code class="codeph">BACKUP</code> <code class="codeph">...</code> <code class="codeph">PLUS</code> <code class="codeph">ARCHIVELOG</code> command, which causes RMAN to do the following:</p>
<ol>
<li>
<p>Run the <a class="olink SQLRF00902" target="_blank" href="../SQLRF/statements_2017.htm#SQLRF00902"><code class="codeph">ALTER SYSTEM</code></a> <code class="codeph">ARCHIVE</code> <code class="codeph">LOG</code> <code class="codeph">CURRENT</code> statement.</p>
</li>
<li>
<p><a id="d37979e4938" class="indexterm-anchor"></a><a id="d37979e4942" class="indexterm-anchor"></a>Run <code class="codeph">BACKUP</code> <code class="codeph">ARCHIVELOG</code> <code class="codeph">ALL</code>. If <a href="glossary.htm#GUID-C75B395F-CA6E-4286-826B-67AABE99606A"><span class="xrefglossterm">backup optimization</span></a> is enabled, then RMAN skips logs that it has already backed up to the specified device.</p>
</li>
<li>
<p>Back up the rest of the files specified in the <code class="codeph">BACKUP</code> command.</p>
</li>
<li>
<p>Run the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">ARCHIVE</code> <code class="codeph">LOG</code> <code class="codeph">CURRENT</code> statement.</p>
</li>
<li>
<p>Back up any remaining archived logs generated during the backup. If backup optimization is not enabled, then RMAN backs up the logs generated in Step 1 plus all the logs generated during the backup.</p>
</li>
</ol>
<p>The preceding steps guarantee that data file backups taken during the command are recoverable to a consistent state. Also, unless the online redo log is archived at the end of the backup, <code class="codeph">DUPLICATE</code> is not possible with the backup.</p>
</div>
</div>
</div>
<a id="BRADV835"></a>
<div class="props_rev_3"><a id="GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9"></a>
<h3 id="BRADV-GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9" class="sect3">About Backup of Archived Redo Logs in CDBs</h3>
<div>
<p>In a CDB, archived redo logs can be backed up only when you connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. When you connect to a PDB as a local user with <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege, you cannot back up or delete archived redo logs.</p>
<p>If your archived redo logs are being copied to multiple destinations, when you connect to the root and backup archived redo log files, RMAN includes only one copy of the archived redo log files in a backup. You can switch archived redo log files when you connect to root of a CDB. Therefore, the information in <span class="q">&#34;<a href="rcmbckba.htm#GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C">About Archived Redo Log Failover</a>&#34;</span> and <span class="q">&#34;<a href="rcmbckba.htm#GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA">About Online Redo Log Switching</a>&#34;</span> is applicable when you connect to the root. However, you cannot backup or switch archived redo log files when connected to a PDB.</p>
<div class="infoboxnotealso" id="GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9__GUID-CDBE0F48-A5A5-4FD4-892D-770DF24C00F8">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmbckba.htm#GUID-82593941-EA75-4BB0-A001-3B086C6B72EA">Backing Up Archived Redo Logs in CDBs</a>&#34;</span></p>
</div>
</div>
</div>
<a id="BRADV611"></a><a id="BRADV89525"></a>
<div class="props_rev_3"><a id="GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C"></a>
<h3 id="BRADV-GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C" class="sect3">Backing Up Archived Redo Log Files in non-CDBs</h3>
<div>
<div class="section">
<p><a id="d37979e5164" class="indexterm-anchor"></a><a id="d37979e5168" class="indexterm-anchor"></a>To back up archived logs, use the <code class="codeph">BACKUP</code> <code class="codeph">ARCHIVELOG</code> command. If <a href="glossary.htm#GUID-C75B395F-CA6E-4286-826B-67AABE99606A"><span class="xrefglossterm">backup optimization</span></a> is enabled, then RMAN skips backups of archived logs that have already been backed up to the specified device.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up archived redo log files:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C__GUID-F979EC7E-923A-45EF-A7D8-D9F9FFFD4DE5">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the target database is mounted or open.</span></li>
<li class="stepexpand"><span>Execute the <code class="codeph">BACKUP ARCHIVELOG</code> or <code class="codeph">BACKUP ... PLUS ARCHIVELOG</code> command.</span>
<div>
<p>The following example backs up the database and all archived redo logs:</p>
<pre dir="ltr">BACKUP DATABASE PLUS ARCHIVELOG;
</pre>
<p>The following example uses a configured disk or SBT channel to back up one copy of each log sequence number for all archived redo logs:</p>
<pre dir="ltr">BACKUP ARCHIVELOG ALL;
</pre>
<p>You can also specify a range of archived redo logs by time, SCN, or log sequence number, as in the following example:</p>
<pre dir="ltr">BACKUP ARCHIVELOG 
  FROM TIME  &#39;SYSDATE-30&#39;
  UNTIL TIME &#39;SYSDATE-7&#39;;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV234"></a><a id="BRADV89522"></a>
<div class="props_rev_3"><a id="GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2"></a>
<h3 id="BRADV-GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2" class="sect3">Backing Up Only Archived Redo Logs That Need Backups in non-CDBs</h3>
<div>
<div class="section">
<p><a id="d37979e5294" class="indexterm-anchor"></a>You can indicate that RMAN should <span class="italic">automatically</span> skip backups of archived redo logs in the following ways:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Configure <a href="glossary.htm#GUID-C75B395F-CA6E-4286-826B-67AABE99606A"><span class="xrefglossterm">backup optimization</span></a>.</p>
<p>As explained in <span class="q">&#34;<a href="rcmconfb.htm#GUID-914A65A7-872E-465B-95E5-0FD5ADAF6A9C">Backup Optimization and the CONFIGURE command</a>&#34;</span>, <a id="d37979e5316" class="indexterm-anchor"></a><a id="d37979e5322" class="indexterm-anchor"></a><a id="d37979e5326" class="indexterm-anchor"></a>if you enable backup optimization, then <a id="d37979e5331" class="indexterm-anchor"></a><a id="d37979e5335" class="indexterm-anchor"></a>the <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP ARCHIVELOG</code></a> command skips backing up files when an identical archived log has been backed up to the specified device type. An archived log is considered identical to another when it has the same DBID, thread, sequence number, and <code class="codeph">RESETLOGS</code> SCN and time.</p>
</li>
<li>
<p><a id="d37979e5349" class="indexterm-anchor"></a>Configure an <a href="glossary.htm#GUID-3492E0C3-F42C-45E6-84E2-63E30A3489A4"><span class="xrefglossterm">archived redo log deletion policy</span></a>.</p>
<p>As explained in <span class="q">&#34;<a href="rcmconfb.htm#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F">Configuring an Archived Redo Log Deletion Policy</a>&#34;</span>, if the deletion policy is configured with the <code class="codeph">BACKED UP</code> <span class="italic"><code class="codeph">integer</code></span> <code class="codeph">TIMES</code> clause, then a <code class="codeph">BACKUP ARCHIVELOG</code> command copies the logs unless <span class="italic"><code class="codeph">integer</code></span> backups exist on the specified device type. If <span class="italic"><code class="codeph">integer</code></span> backups of the logs exist, then the <code class="codeph">BACKUP ARCHIVELOG</code> command skips the logs.</p>
</li>
</ul>
<p>The <code class="codeph">BACKUP ... NOT BACKED UP</code> <span class="italic"><code class="codeph">integer</code></span> <code class="codeph">TIMES</code> command specifies that RMAN backs up only those archived log files that have not been backed up at least <span class="italic"><code class="codeph">integer</code></span> times to the specified device. To determine the number of backups for a file, RMAN only considers backups created on the same device type as the current backup.</p>
<p>The <code class="codeph">BACKED UP</code> clause is a convenient way to back up archived logs to a specified device type. For example, you can specify that RMAN should keep two copies of each archived redo log on tape and skip additional backups.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up archived redo logs that need backups:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2__GUID-4B010BA6-0DFD-463A-B064-C3ED733FEC63">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the target database is mounted or open.</span></li>
<li class="stepexpand"><span>Ensure that appropriate channels are configured for the backup.</span></li>
<li class="stepexpand"><span><a id="d37979e5431" class="indexterm-anchor"></a><a id="d37979e5435" class="indexterm-anchor"></a>Execute the <code class="codeph">BACKUP ARCHIVELOG</code> command with the <code class="codeph">NOT BACKED UP</code> clause.</span>
<div>
<pre dir="ltr">BACKUP ARCHIVELOG ALL NOT BACKED UP 2 TIMES;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2__GUID-798A7CD8-F06B-4EA8-8B66-FA0D140B63D5">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmbckad.htm#GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4">Using Backup Optimization to Skip Files</a>&#34;</span> for scenarios using <code class="codeph">NOT BACKED UP</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV837"></a><a id="BRADV838"></a><a id="BRADV836"></a>
<div class="props_rev_3"><a id="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA"></a>
<h3 id="BRADV-GUID-82593941-EA75-4BB0-A001-3B086C6B72EA" class="sect3">Backing Up Archived Redo Logs in CDBs</h3>
<div>
<div class="section">
<p>You can back up archived redo logs in a CDB by using the <code class="codeph">BACKUP ARCHIVELOG</code> command.</p>
<div class="infoboxnotealso" id="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA__GUID-4AB728C9-496D-45EB-A4FE-DC57172A635A">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmbckba.htm#GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9">About Backup of Archived Redo Logs in CDBs</a>&#34;</span></p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up archived redo logs in a CDB:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Start RMAN and connect to the root as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Follow the instructions in <span class="q">&#34;<a href="rcmbckba.htm#GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C">Backing Up Archived Redo Log Files in non-CDBs</a>&#34;</span>.</p>
<div class="infoboxnotealso" id="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA__GUID-F7F8020F-85B7-4A66-8E58-5093738FCA7B">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up only archived redo logs that need backup in a CDB:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Follow the instructions in <span class="q">&#34;<a href="rcmbckba.htm#GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2">Backing Up Only Archived Redo Logs That Need Backups in non-CDBs</a>&#34;</span>.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV235"></a><a id="BRADV89524"></a>
<div class="props_rev_3"><a id="GUID-E99C2A06-868F-458A-88F1-B257EADD63CB"></a>
<h3 id="BRADV-GUID-E99C2A06-868F-458A-88F1-B257EADD63CB" class="sect3">Deleting Archived Redo Logs After Backups in non-CDBs</h3>
<div>
<div class="section">
<p>The <code class="codeph">BACKUP ARCHIVELOG</code> <code class="codeph">... DELETE INPUT</code> command deletes archived log files after they are backed up. This command eliminates the separate step of manually deleting archived redo logs. <a id="d37979e5680" class="indexterm-anchor"></a></p>
<p>With <code class="codeph">DELETE</code> <code class="codeph">INPUT</code>, RMAN deletes only the specific copy of the archived log chosen for the backup set. With <code class="codeph">DELETE</code> <code class="codeph">ALL</code> <code class="codeph">INPUT</code>, RMAN deletes each backed-up archived redo log file from all log archiving destinations.</p>
<p>As explained in <span class="q">&#34;<a href="rcmconfb.htm#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F">Configuring an Archived Redo Log Deletion Policy</a>&#34;</span>, <a id="d37979e5708" class="indexterm-anchor"></a><a id="d37979e5712" class="indexterm-anchor"></a>the <code class="codeph">BACKUP ... DELETE INPUT</code> and <code class="codeph">DELETE ARCHIVELOG</code> commands obey the <a href="glossary.htm#GUID-3492E0C3-F42C-45E6-84E2-63E30A3489A4"><span class="xrefglossterm">archived redo log deletion policy</span></a> for logs in all archiving locations. For example, if you specify that logs be deleted only when backed up at least twice to tape, then <code class="codeph">BACKUP ... DELETE</code> honors this policy.</p>
<p>For the following procedure, assume that you archive to <code class="codeph">/arc_dest1</code>, <code class="codeph">/arc_dest2</code>, and the fast recovery area.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To delete archived redo logs after a backup:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-E99C2A06-868F-458A-88F1-B257EADD63CB__GUID-8426AC6D-B9A7-4EB1-A6A7-03A8812FB2C1">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span> for information about connecting to a target database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the target database is mounted or open.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">BACKUP</code> command with the <code class="codeph">DELETE INPUT</code> clause.</span>
<div>
<p>Assume that you run the following <code class="codeph">BACKUP</code> command:</p>
<pre dir="ltr">BACKUP DEVICE TYPE sbt 
  ARCHIVELOG ALL 
    DELETE ALL INPUT;
</pre>
<p>In this case, RMAN backs up only one copy of each log sequence number in these archiving locations. RMAN deletes all copies of any log that it backed up from both the fast recovery area and the other archiving destinations.</p>
<p>If you specify <code class="codeph">DELETE</code> <code class="codeph">INPUT</code> rather than <code class="codeph">DELETE</code> <code class="codeph">ALL</code> <code class="codeph">INPUT</code>, then RMAN only deletes the specific archived redo log files that it backed up. For example, RMAN deletes the logs in <code class="codeph">/arc_dest1</code> if these files were used as the source of the backup, but leave the contents of the <code class="codeph">/arc_dest2</code> intact.</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-E99C2A06-868F-458A-88F1-B257EADD63CB__GUID-6A785433-6EC0-407F-8699-161D1A64CCAF">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn about archived redo log management with standby databases</p>
</li>
<li>
<p><a class="olink RCMRF113" target="_blank" href="../RCMRF/rcmsynta009.htm#RCMRF113"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code class="codeph">CONFIGURE ARCHIVELOG DELETION POLICY</code> command</p>
</li>
<li>
<p><a class="olink RCMRF121" target="_blank" href="../RCMRF/rcmsynta015.htm#RCMRF121"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code class="codeph">DELETE ARCHIVELOG</code> command</p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmmaint.htm#GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" title="You can delete backups and recovery catalog records for backups.">Deleting RMAN Backups and Archived Redo Logs</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV840"></a><a id="BRADV839"></a>
<div class="props_rev_3"><a id="GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853"></a>
<h3 id="BRADV-GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853" class="sect3">Deleting Archived Redo Logs After Backups in CDBs</h3>
<div>
<div class="section">
<p>In a CDB, you can delete archived redo logs after they are backed up by using the <code class="codeph">BACKUP ARCHIVELOG ... DELETE INPUT</code> command.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To delete archived redo logs in a CDB after they are backed up:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Start RMAN and connect to the root as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Follow the instructions in <span class="q">&#34;<a href="rcmbckba.htm#GUID-E99C2A06-868F-458A-88F1-B257EADD63CB">Deleting Archived Redo Logs After Backups in non-CDBs</a>&#34;</span>.</p>
<div class="infoboxnotealso" id="GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853__GUID-4352C0B2-E18C-4A8F-B9FD-37D6807776D2">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV8133"></a>
<div class="props_rev_3"><a id="GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304"></a>
<h2 id="BRADV-GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304" class="sect2">Making and Updating RMAN Incremental Backups</h2>
<div>
<p><a id="d37979e6017" class="indexterm-anchor"></a><a id="d37979e6023" class="indexterm-anchor"></a><a id="d37979e6027" class="indexterm-anchor"></a>As <a id="d37979e6030" class="indexterm-anchor"></a>explained in <span class="q">&#34;<a href="rcmcncpt.htm#GUID-C93F3588-BBA9-4AE2-9E47-74C7A9468023">About RMAN Incremental Backups</a>&#34;</span>, an <a href="glossary.htm#GUID-31E3AC05-E73E-4E44-A9AA-915988B9A6A3"><span class="xrefglossterm">incremental backup</span></a> copies only data file blocks that have changed since a specified previous backup. An incremental backup is either a <a href="glossary.htm#GUID-8BABFB51-EA47-4204-9A44-E1695A9F9FBF"><span class="xrefglossterm">cumulative incremental backup</span></a> or a <a href="glossary.htm#GUID-353B6668-6BA5-4815-8F08-1CD5B446FBD6"><span class="xrefglossterm">differential incremental backup</span></a>.</p>
<p>Although the content of the backups is the same,<a id="d37979e6055" class="indexterm-anchor"></a><a id="d37979e6059" class="indexterm-anchor"></a> <code class="codeph">BACKUP DATABASE</code> and <code class="codeph">BACKUP INCREMENTAL LEVEL 0 DATABASE</code> are different. A <a href="glossary.htm#GUID-D47BE9B3-BAE1-4415-B4B4-4D577B6CB493"><span class="xrefglossterm">full backup</span></a> is not usable as part of an incremental strategy, whereas a <a href="glossary.htm#GUID-DF84C185-E97D-4D3C-BF4E-41A9090C5F4C"><span class="xrefglossterm">level 0 incremental backup</span></a> is the basis of an incremental strategy. No RMAN command can change a full backup into a level 0 incremental backup.</p>
<p>As with full backups, RMAN can make incremental backups of an <code class="codeph">ARCHIVELOG</code> mode database that is open. If the database is in <code class="codeph">NOARCHIVELOG</code> mode, then RMAN can make incremental backups only after a consistent shutdown.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE">Purpose of RMAN Incremental Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B">Planning an Incremental Backup Strategy</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E">Making Incremental Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9" title="To create incremental backups for use in an incrementally updated backup strategy, use the BACKUP ... FOR RECOVER OF COPY WITH TAG form of the BACKUP command. The command is best understood in a sample script that implements the strategy.">Incrementally Updating Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A">Using Block Change Tracking to Improve Incremental Backup Performance</a></p>
</li>
</ul>
</div>
<a id="BRADV89527"></a>
<div class="props_rev_3"><a id="GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE"></a>
<h3 id="BRADV-GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE" class="sect3">Purpose of RMAN Incremental Backups</h3>
<div>
<p>The primary reasons for making incremental backups part of your strategy are:</p>
<ul style="list-style-type: disc;">
<li>
<p>Faster daily backups if <a href="glossary.htm#GUID-C80ACD57-9170-4FA5-A61F-81A05E77A1A4"><span class="xrefglossterm">block change tracking</span></a> is enabled (see <span class="q">&#34;<a href="rcmbckba.htm#GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A">Using Block Change Tracking to Improve Incremental Backup Performance</a>&#34;</span>)</p>
</li>
<li>
<p>Ability to roll forward data file image copies, thereby reducing recovery time and avoiding repeated full backups</p>
</li>
<li>
<p>Less bandwidth consumption when backing up over a network</p>
</li>
<li>
<p>Improved performance when the aggregate tape bandwidth for tape write I/Os is much less than the aggregate disk bandwidth for disk read I/Os</p>
</li>
<li>
<p>Possibility of recovering changes to objects created with the <code class="codeph">NOLOGGING</code> option</p>
<p>For example, direct load inserts do not create redo log entries, so their changes cannot be reproduced with media recovery. Direct load inserts do change data blocks, however, and these blocks are captured by incremental backups.</p>
</li>
<li>
<p>Ability to synchronize a physical standby database with the primary database</p>
<p>You can use the RMAN <code class="codeph">BACKUP INCREMENTAL FROM SCN</code> command to create a backup on the primary database that starts at the current SCN of the standby database, which you can then use to roll forward the standby database. See <a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to apply incremental backups to a standby database.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE__GUID-F51FA7D7-450C-4A3E-A7BB-2A57964B7614">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN11374" target="_blank" href="../ADMIN/tspaces.htm#ADMIN11374"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for more information about <code class="codeph">NOLOGGING</code> mode</p>
</div>
</div>
</div>
<a id="BRADV89528"></a>
<div class="props_rev_3"><a id="GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B"></a>
<h3 id="BRADV-GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B" class="sect3">Planning an Incremental Backup Strategy</h3>
<div>
<p>Choose a backup strategy according to an acceptable <a href="glossary.htm#GUID-A3EA33D7-BB93-4179-9BFF-5C0CFBFD26D1"><span class="xrefglossterm">MTTR</span></a> (mean time to recover). For example, you can implement a three-level backup scheme so that a level 0 backup is taken monthly, a cumulative level 1 is taken weekly, and a differential level 1 is taken daily. In this strategy, you never have to apply more than a day of redo for complete recovery.</p>
<p>When deciding how often to take level 0 backups, a general rule is to take a new level 0 backup whenever 20% or more of the data has changed. If the rate of change to your database is predictable, then you can observe the size of your incremental backups to determine when a new level 0 backup is appropriate. The following SQL query determines the number of blocks written to an incremental level 1 backup of each data file with at least 20% of its blocks backed up<a id="d37979e6341" class="indexterm-anchor"></a>:</p>
<pre dir="ltr">SELECT   FILE#, INCREMENTAL_LEVEL, COMPLETION_TIME, 
         BLOCKS, DATAFILE_BLOCKS 
FROM     V$BACKUP_DATAFILE 
WHERE    INCREMENTAL_LEVEL &gt; 0 
AND      BLOCKS / DATAFILE_BLOCKS &gt; .2
ORDER BY COMPLETION_TIME;
</pre>
<p>Compare the number of blocks in level 1 backups to a level 0 backup. For example, if you create only level 1 cumulative backups, then take a new level 0 backup when the most recent level 1 backup is about half the size of the level 0 backup.</p>
<p>An effective way to conserve disk space is to make incremental backups to disk, and then offload the backups to tape with the <code class="codeph">BACKUP</code> <code class="codeph">AS</code> <code class="codeph">BACKUPSET</code> command. Incremental backups are generally smaller than full backups, which limits the space required to store them until they are moved to tape. When the incremental backups on disk are backed up to tape, the tape is more likely to stream because all blocks of the incremental backup are copied to tape. There is no possibility of delay due to time required for RMAN to locate changed blocks in the data files.</p>
<p>Another strategy is to use incrementally updated backups, as explained in <span class="q">&#34;<a href="rcmbckba.htm#GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9" title="To create incremental backups for use in an incrementally updated backup strategy, use the BACKUP ... FOR RECOVER OF COPY WITH TAG form of the BACKUP command. The command is best understood in a sample script that implements the strategy.">Incrementally Updating Backups</a>&#34;</span>. In this strategy, you create an image copy of each data file, and then periodically roll forward this copy by making and then applying a level 1 incremental backup. In this way you avoid the overhead of making repeated full image copies of your data files, but enjoy all of the advantages.</p>
<p>In a Data Guard environment, you can offload incremental backups to a <a href="glossary.htm#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">physical standby database</span></a>. Incremental backups of a standby and primary database are interchangeable. Thus, you can apply an incremental backup of a standby database to a primary database, or apply an incremental backup of a primary database to a standby database.</p>
<div class="infoboxnotealso" id="GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B__GUID-FA4F3605-1AFE-4B31-8A04-20E4BD4676EB">
<p class="notep1">See Also:</p>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to back up a standby database with RMAN. In particular, consult Chapter 10, &#34;Managing Physical and Snapshot Standby Databases&#34;</p>
</div>
</div>
</div>
<a id="BRADV236"></a><a id="BRADV89529"></a>
<div class="props_rev_3"><a id="GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E"></a>
<h3 id="BRADV-GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E" class="sect3">Making Incremental Backups</h3>
<div>
<div class="section">
<p>After starting RMAN, run the<a id="d37979e6480" class="indexterm-anchor"></a><a id="d37979e6484" class="indexterm-anchor"></a> <code class="codeph">BACKUP</code> <code class="codeph">INCREMENTAL</code> command at the RMAN prompt. By default incremental backups are differential.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To make an incremental backup:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and a recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E__GUID-7C100209-BD5A-424A-9E54-532DCB933A82">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the target database is mounted or open.</span></li>
<li class="stepexpand"><span>Execute the <code class="codeph">BACKUP INCREMENTAL</code> command with the desired options.</span>
<div>
<p>Use the <code class="codeph">LEVEL</code> parameter to indicate the incremental level. The following example makes a level 0 incremental database backup.</p>
<pre dir="ltr">BACKUP
  INCREMENTAL LEVEL 0
  DATABASE;
</pre>
<p>The following example makes a <a href="glossary.htm#GUID-353B6668-6BA5-4815-8F08-1CD5B446FBD6"><span class="xrefglossterm">differential incremental backup</span></a> at level 1 of the <code class="codeph">SYSTEM</code> and <code class="codeph">tools</code> tablespaces. It only backs up those data blocks changed since the most recent level 1 or level 0 backup.</p>
<pre dir="ltr">BACKUP
  INCREMENTAL LEVEL 1
  TABLESPACE SYSTEM, tools;
</pre>
<p>The following example makes a <a href="glossary.htm#GUID-8BABFB51-EA47-4204-9A44-E1695A9F9FBF"><span class="xrefglossterm">cumulative incremental backup</span></a> at level 1 of the tablespace <code class="codeph">users</code>, backing up all blocks changed since the most recent level 0 backup.</p>
<pre dir="ltr">BACKUP
  INCREMENTAL LEVEL 1 CUMULATIVE
  TABLESPACE users;
</pre></div>
</li>
</ol>
</div>
<a id="BRADV89530"></a>
<div class="props_rev_3"><a id="GUID-1B709C63-3857-40C6-BB3B-C2F73ED7CBA8"></a>
<h4 id="BRADV-GUID-1B709C63-3857-40C6-BB3B-C2F73ED7CBA8" class="sect4">Making Incremental Backups of a VSS Snapshot</h4>
<div>
<div class="section">
<p>You can use the <a id="d37979e6622" class="indexterm-anchor"></a><a href="glossary.htm#GUID-105781E5-32FB-4702-9248-9041B0EFBED4"><span class="xrefglossterm">Volume Shadow Copy Service (VSS)</span></a> with the Oracle VSS writer to make a <a id="d37979e6628" class="indexterm-anchor"></a><a href="glossary.htm#GUID-46C1286E-925E-4527-AC30-D507316DF304"><span class="xrefglossterm">shadow copy</span></a> or snapshot of files in a database. You must use a third-party backup program other than RMAN to make VSS snapshots with the Oracle VSS writer. In this case, the <a href="glossary.htm#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a> automates management of files that are backed up in a VSS snapshot and deletes them as needed.</p>
<p>You can use the<a id="d37979e6640" class="indexterm-anchor"></a><a id="d37979e6644" class="indexterm-anchor"></a> <code class="codeph">BACKUP INCREMENTAL LEVEL 1 ... FROM SCN</code> command in RMAN to create incremental backups in the fast recovery area. Thus, you can use this command to create an incremental level 1 backup of a VSS shadow copy. RMAN can apply incremental backups during recovery transparently.</p>
<div class="infoboxnotealso" id="GUID-1B709C63-3857-40C6-BB3B-C2F73ED7CBA8__GUID-099B7F37-540A-4862-B0B6-A83C03343E9F">
<p class="notep1">See Also:</p>
<p><a class="olink NTQRF" target="_blank" href="../NTQRF/toc.htm"><span class="italic">Oracle Database Platform Guide for Microsoft Windows</span></a> to learn how to make VSS backups with RMAN</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV237"></a><a id="BRADV8186"></a>
<div class="props_rev_3"><a id="GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9"></a>
<h3 id="BRADV-GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9" class="sect3">Incrementally Updating Backups</h3>
<div>
<div class="section">
<p><a id="d37979e6730" class="indexterm-anchor"></a>By incrementally updating backups, you can avoid the overhead of making full image copy backups of data files, while also minimizing time required for media recovery of your database. For example, if you run a daily backup script, then you never have more than 1 day of redo to apply for media recovery.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To incrementally update data file backups:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Create a full image copy backup of a data file with a specified tag.</span></li>
<li><span>At regular intervals (such as daily), make a level 1 differential incremental backup of the data file and use the same tag as the base data file copy.</span></li>
<li><span>Apply the incremental backup to the most recent backup with the same tag.</span></li>
</ol>
<div class="section">
<p>This technique rolls forward the backup to the time when the level 1 incremental backup was made. RMAN can restore this <a href="glossary.htm#GUID-F879F805-CAD5-4798-B9C1-A9C877D4FBC8"><span class="xrefglossterm">incremental forever</span></a> and apply changes from the redo log. The result equals restoring a data file backup taken at the SCN of the most recently applied incremental level 1 backup.</p>
<div class="infobox-note" id="GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9__GUID-30C611AD-B2A7-486C-9D7A-81910735C64E">
<p class="notep1">Note:</p>
<p>If you run<a id="d37979e6758" class="indexterm-anchor"></a> <code class="codeph">RECOVER COPY</code> daily <span class="italic">without</span> specifying an <code class="codeph">UNTIL TIME</code>, then a continuously updated image copy cannot satisfy a <a href="glossary.htm#GUID-1C595EF7-B8A1-4AA3-8C45-44E9FC8BAB9E"><span class="xrefglossterm">recovery window</span></a> of more than a day. The incrementally updated backup feature is an optimization for fast media recovery.</p>
</div>
</div>
<!-- class="section" --></div>
<a id="BRADV239"></a><a id="BRADV238"></a><a id="BRADV89531"></a>
<div class="props_rev_3"><a id="GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A"></a>
<h4 id="BRADV-GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A" class="sect4">Incrementally Updating Backups: Basic Example</h4>
<div>
<p>To create incremental backups for use in an incrementally updated backup strategy, use the <code class="codeph">BACKUP ...</code> <code class="codeph">FOR</code> <code class="codeph">RECOVER</code> <code class="codeph">OF</code> <code class="codeph">COPY</code> <code class="codeph">WITH</code> <code class="codeph">TAG</code> form of the <code class="codeph">BACKUP</code> command. The command is best understood in a sample script that implements the strategy.</p>
<p>The script in <a href="rcmbckba.htm#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">Example 9-9</a>, run regularly, is all that is required to implement a strategy based on incrementally updated backups.</p>
<div class="example" id="GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">
<p class="titleinexample">Example 9-9 Basic Incremental Update Script</p>
<pre dir="ltr">RUN
{
  RECOVER COPY OF DATABASE 
    WITH TAG &#39;incr_update&#39;;
  BACKUP 
    INCREMENTAL LEVEL 1
    FOR RECOVER OF COPY WITH TAG &#39;incr_update&#39;
    DATABASE;
}
</pre></div>
<!-- class="example" -->
<div class="section">
<p>To understand the script and the strategy, you must understand the effects of these two commands when no data file copies or incremental backups exist. Note two important features:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">BACKUP</code> command in <a href="rcmbckba.htm#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">Example 9-9</a> does not always create a level 1 incremental backup.</p>
</li>
<li>
<p>The <a class="olink RCMRF140" target="_blank" href="../RCMRF/rcmsynta2001.htm#RCMRF140"><code class="codeph">RECOVER</code></a> command in <a href="rcmbckba.htm#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">Example 9-9</a> causes RMAN to apply any available incremental level 1 backups with the specified tag to a set of data file copies with the same tag.</p>
</li>
</ul>
<p><a href="rcmbckba.htm#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__BGBGCEBG" title="This table shows an example incremental update strategy when the basic script is run daily.">Table 9-2</a> shows the effect of the script when it is run once per day starting on Monday.</p>
<div class="tblformalwide" id="GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__BGBGCEBG">
<p class="titleintable">Table 9-2 Effect of Basic Script When Run Daily</p>
<table class="cellalignment553" title="Effect of Basic Script When Run Daily" summary="This table shows an example incremental update strategy when the basic script is run daily.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment570" id="d37979e6933">Command</th>
<th class="cellalignment571" id="d37979e6936">Monday</th>
<th class="cellalignment571" id="d37979e6939">Tuesday</th>
<th class="cellalignment571" id="d37979e6942">Wednesday</th>
<th class="cellalignment571" id="d37979e6945">Thursday Onward</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment572" id="d37979e6950" headers="d37979e6933">
<p><code class="codeph">RECOVER</code></p>
</td>
<td class="cellalignment573" headers="d37979e6950 d37979e6936">
<p>Because no incremental backup or data file copy exists, the command generates a message (but not an error). That is, the command has no effect.</p>
</td>
<td class="cellalignment573" headers="d37979e6950 d37979e6939">
<p>A database copy now exists, but no incremental level 1 backup exists with which to recover it. Thus, the <code class="codeph">RECOVER</code> command has no effect.</p>
</td>
<td class="cellalignment573" headers="d37979e6950 d37979e6942">
<p>The level 1 incremental backup made on Tuesday is applied to the database copy, bringing the copy up to the checkpoint SCN of the level 1 incremental backup.</p>
</td>
<td class="cellalignment573" headers="d37979e6950 d37979e6945">
<p>The level 1 incremental backup made yesterday is applied to the database copy, bringing the copy up to the checkpoint SCN of the level 1 incremental backup.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment572" id="d37979e6970" headers="d37979e6933">
<p><code class="codeph">BACKUP</code></p>
</td>
<td class="cellalignment573" headers="d37979e6970 d37979e6936">
<p>No level 0 image copy exists, so the command creates an image copy of the database and applies the tag <code class="codeph">incr_update</code>. This copy is needed to begin the cycle of incremental updates.</p>
<p><span class="bold">Note:</span> If the script sets <code class="codeph">DEVICE</code> <code class="codeph">TYPE</code> <code class="codeph">sbt</code>, then the first run creates the copy on disk, not on tape. Subsequent runs make level 1 backups on tape.</p>
</td>
<td class="cellalignment573" headers="d37979e6970 d37979e6939">
<p>The command makes an incremental level 1 backup and assigns it the tag <code class="codeph">incr_update</code>. This backup contains blocks that changed between Monday and Tuesday.</p>
</td>
<td class="cellalignment573" headers="d37979e6970 d37979e6942">
<p>The command makes an incremental level 1 backup and assigns it the tag <code class="codeph">incr_update</code>. This backup contains blocks that changed between Tuesday and Wednesday.</p>
</td>
<td class="cellalignment573" headers="d37979e6970 d37979e6945">
<p>The command makes an incremental level 1 backup and assigns it the tag <code class="codeph">incr_update</code>. This backup contains blocks that changed between now and the most recent backup with the tag <code class="codeph">incr_update</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Note the following additional details about <a href="rcmbckba.htm#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">Example 9-9</a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Each time a data file is added to the database, an image copy of the new data file is created the next time the script runs. The next run makes the first level 1 incremental for the added data file. On all subsequent runs the new data file is processed like any other data file.</p>
</li>
<li>
<p>You must use tags to identify the data file copies and incremental backups in this strategy so that they do not interfere with other backup strategies. If you use multiple incremental backup strategies, then RMAN cannot unambiguously create incremental level 1 backups unless you tag level 0 backups.</p>
<p>The incremental level 1 backups to apply to those image copies are selected based upon the tag of the image copy data files and the available incremental level 1 backups. The tag is essential in the selection of the incremental level backups.</p>
</li>
<li>
<p>After the third run of the script, the following files are available for a point-in-time recovery:</p>
<ul style="list-style-type: disc;">
<li>
<p>An image copy of the database, as of the checkpoint SCN of the preceding run of the script, 24 hours earlier</p>
</li>
<li>
<p>An incremental backup for the changes after the checkpoint SCN of the preceding run</p>
</li>
<li>
<p>Archived redo logs including all changes between the checkpoint SCN of the image copy and the current time</p>
</li>
</ul>
<p>If you must restore and recover your database during the following 24 hours, then you can restore the data files from the incrementally updated data file copies. You can then apply changes from the most recent incremental level 1 and the redo logs to reach the desired SCN. At most, you have 24 hours of redo to apply, which limits how long point-in-time recovery takes to finish.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV243"></a><a id="BRADV240"></a><a id="BRADV89532"></a>
<div class="props_rev_3"><a id="GUID-025D990B-4EB0-48FA-A181-13787069E573"></a>
<h4 id="BRADV-GUID-025D990B-4EB0-48FA-A181-13787069E573" class="sect4">Incrementally Updated Backups: Advanced Example</h4>
<div>
<p>You can extend the basic script in <a href="rcmbckba.htm#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">Example 9-9</a> to provide fast recoverability to a window greater than 24 hours. <a href="rcmbckba.htm#GUID-025D990B-4EB0-48FA-A181-13787069E573__CHDCDFDF">Example 9-10</a> shows how to maintain a window of 7 days by specifying the beginning time of your window of recoverability in the <code class="codeph">RECOVER</code> command.</p>
<div class="example" id="GUID-025D990B-4EB0-48FA-A181-13787069E573__CHDCDFDF">
<p class="titleinexample">Example 9-10 Advanced Incremental Update Script</p>
<pre dir="ltr">RUN
{
  RECOVER COPY OF DATABASE 
    WITH TAG &#39;incr_update&#39; 
    UNTIL TIME &#39;SYSDATE - 7&#39;;
  BACKUP
    INCREMENTAL LEVEL 1 
    FOR RECOVER OF COPY WITH TAG &#39;incr_update&#39;
    DATABASE;
}
</pre></div>
<!-- class="example" -->
<div class="section">
<p><a href="rcmbckba.htm#GUID-025D990B-4EB0-48FA-A181-13787069E573__BGBHAIFA" title="This table shows an example incremental update strategy when an advanced script is run.">Table 9-3</a> shows the effect of the script when it is run once per day starting on Monday, January 1.</p>
<div class="tblformalwide" id="GUID-025D990B-4EB0-48FA-A181-13787069E573__BGBHAIFA">
<p class="titleintable">Table 9-3 Effect of Advanced Script When Run Daily</p>
<table class="cellalignment553" title="Effect of Advanced Script When Run Daily" summary="This table shows an example incremental update strategy when an advanced script is run.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment570" id="d37979e7146">Command</th>
<th class="cellalignment571" id="d37979e7149">Monday 1/1</th>
<th class="cellalignment571" id="d37979e7152">Tuesday 1/2 - Monday 1/8</th>
<th class="cellalignment571" id="d37979e7155">Tuesday 1/9</th>
<th class="cellalignment571" id="d37979e7158">Wednesday 1/10 Onward</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment572" id="d37979e7163" headers="d37979e7146">
<p><code class="codeph">RECOVER</code></p>
</td>
<td class="cellalignment573" headers="d37979e7163 d37979e7149">
<p>Because no incremental backup or data file copy exists, the command generates a message (but not an error). That is, the command has no effect.</p>
</td>
<td class="cellalignment573" headers="d37979e7163 d37979e7152">
<p>A database copy exists, but <code class="codeph">SYSDATE-7</code> specifies a time <span class="italic">before</span> the base copy was created. For example, on Wednesday <code class="codeph">SYSDATE-7</code> specifies the Wednesday <span class="italic">before</span> Monday 1/1. Thus, the <code class="codeph">RECOVER</code> command has no effect.</p>
</td>
<td class="cellalignment573" headers="d37979e7163 d37979e7155">
<p><code class="codeph">SYSDATE-7</code> now specifies a date <span class="italic">after</span> the base copy was created. The database copy made on Monday 1/1 is updated with the incremental backup made on Tuesday 1/2, bringing the copy up to the checkpoint SCN of the level 1 incremental backup.</p>
</td>
<td class="cellalignment573" headers="d37979e7163 d37979e7158">
<p>The database copy is updated with the incremental backup made 7 days ago, bringing the copy up to the checkpoint SCN of the level 1 incremental backup.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment572" id="d37979e7200" headers="d37979e7146">
<p><code class="codeph">BACKUP</code></p>
</td>
<td class="cellalignment573" headers="d37979e7200 d37979e7149">
<p>No level 0 image copy exists, so the command creates an image copy of the database and applies the tag <code class="codeph">incr_update</code>. This copy is needed to begin the cycle of incremental updates.</p>
<p><span class="bold">Note:</span> If the script sets <code class="codeph">DEVICE</code> <code class="codeph">TYPE</code> <code class="codeph">sbt</code>, then the first run creates the copy on disk, not on tape. Subsequent runs make level 1 backups on tape.</p>
</td>
<td class="cellalignment573" headers="d37979e7200 d37979e7152">
<p>The command makes an incremental level 1 backup and assigns it the tag <code class="codeph">incr_update</code>. This backup contains blocks that changed between yesterday and today.</p>
</td>
<td class="cellalignment573" headers="d37979e7200 d37979e7155">
<p>The command makes an incremental level 1 backup and assigns it the tag <code class="codeph">incr_update</code>. This backup contains blocks that changed between Monday 1/8 and Tuesday 1/9.</p>
</td>
<td class="cellalignment573" headers="d37979e7200 d37979e7158">
<p>The command makes an incremental level 1 backup and assigns it the tag <code class="codeph">incr_update</code>. This backup contains blocks that changed between yesterday and today.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>As with the basic script in <a href="rcmbckba.htm#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">Example 9-9</a>, you have fast recoverability to any point in time between the SCN of the data file copies and the present. RMAN can use both block changes from the incremental backups and individual changes from the redo logs. Because you have the daily level 1 incremental backups, you never need to apply more than 1 day of redo.</p>
<div class="infoboxnotealso" id="GUID-025D990B-4EB0-48FA-A181-13787069E573__GUID-B91B28B3-63E7-4866-9548-B772F468BC17">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF140" target="_blank" href="../RCMRF/rcmsynta2001.htm#RCMRF140"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> to learn about the <code class="codeph">RECOVER</code> command</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV8125"></a>
<div class="props_rev_3"><a id="GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A"></a>
<h3 id="BRADV-GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A" class="sect3">Using Block Change Tracking to Improve Incremental Backup Performance</h3>
<div>
<p><a id="d37979e7325" class="indexterm-anchor"></a><a id="d37979e7329" class="indexterm-anchor"></a><a id="d37979e7331" class="indexterm-anchor"></a>The <a href="glossary.htm#GUID-C80ACD57-9170-4FA5-A61F-81A05E77A1A4"><span class="xrefglossterm">block change tracking</span></a> feature for incremental backups improves backup performance by recording changed blocks for each data file.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-22A5856C-970A-4DA0-AEB8-41C8F180280B">About Block Change Tracking</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14">Enabling and Disabling Block Change Tracking</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71">Disabling Block Change Tracking</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE">Checking Whether Change Tracking Is Enabled</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-268DD5BF-27DE-4536-8F93-D57431CE4397">Changing the Location of the Block Change Tracking File</a></p>
</li>
</ul>
</div>
<a id="BRADV89533"></a>
<div class="props_rev_3"><a id="GUID-22A5856C-970A-4DA0-AEB8-41C8F180280B"></a>
<h4 id="BRADV-GUID-22A5856C-970A-4DA0-AEB8-41C8F180280B" class="sect4">About Block Change Tracking</h4>
<div>
<p>If block change tracking is enabled on a primary or standby database, then RMAN uses a <a href="glossary.htm#GUID-67A48E71-6A0D-4590-A2BC-C9DE6DAEA3A5"><span class="xrefglossterm">block change tracking file</span></a> to identify changed blocks for incremental backups. By reading this small bitmap file to determine which blocks changed, RMAN avoids having to scan every block in the data file that it is backing up.</p>
<p>Block change tracking is disabled by default. Nevertheless, the benefits of avoiding full data file scans during backup are considerable, especially if only a small percentage of data blocks are changed between backups. If your backup strategy involves incremental backups, then block change tracking is recommended. Block change tracking does not change the commands used to perform incremental backups. The change tracking file requires no maintenance after initial configuration.</p>
<p>You can only enable block change tracking at a physical standby database if a license for the Oracle Active Data Guard option is enabled.</p>
</div>
<a id="BRADV100"></a>
<div class="props_rev_3"><a id="GUID-F4254E7F-1BB6-4BE7-A605-8E28E93703A5"></a>
<h5 id="BRADV-GUID-F4254E7F-1BB6-4BE7-A605-8E28E93703A5" class="sect5">About Space Management in the Block Change Tracking File</h5>
<div>
<p>The change tracking file maintains bitmaps that mark changes in the data files between backups. The database performs a bitmap switch before each backup. Oracle Database automatically manages space in the change tracking file to retain block change data that covers the eight most recent backups. After the maximum of eight bitmaps is reached, the oldest bitmap is overwritten by the bitmap that tracks the current changes.</p>
<p>The first level 0 incremental backup scans the entire data file. Subsequent incremental backups use the block change tracking file to scan only the blocks that have been marked as changed since the last backup. An incremental backup can be optimized only when it is based on a parent backup that was made after the start of the oldest bitmap in the block change tracking file.</p>
<p>Consider the eight-bitmap limit when developing your incremental backup strategy. For example, if you make a level 0 database backup followed by seven differential incremental backups, then the block change tracking file now includes eight bitmaps. If you then make a cumulative level 1 incremental backup, then RMAN cannot optimize the backup, because the bitmap corresponding to the parent level 0 backup is overwritten with the bitmap that tracks the current changes.</p>
</div>
</div>
<a id="BRADV89534"></a>
<div class="props_rev_3"><a id="GUID-68349131-773B-4920-9D04-2FCF9C280257"></a>
<h5 id="BRADV-GUID-68349131-773B-4920-9D04-2FCF9C280257" class="sect5">Location of the Block Change Tracking File</h5>
<div>
<p>One block change tracking file is created for the whole database. By default, the block change tracking file is created as an <a href="glossary.htm#GUID-37F461C5-AAE0-4F82-92E4-7FB822874640"><span class="xrefglossterm">Oracle managed file</span></a> in the destination specified by the <a class="olink REFRN10034" target="_blank" href="../REFRN/GUID-8E6EE3CE-0F39-4A6C-BF3C-F7C07902678D.htm#REFRN10034"><code class="codeph">DB_CREATE_FILE_DEST</code></a> initialization parameter. You can also place the block change tracking file in any location that you choose, by specifying its name when enabling block change tracking. Oracle recommends against using a raw device (that is, a disk without a file system) as a change tracking file.</p>
<div class="infobox-note" id="GUID-68349131-773B-4920-9D04-2FCF9C280257__GUID-C58DD63D-7316-4FB7-9304-B830BAD9CF91">
<p class="notep1">Note:</p>
<p>In an Oracle RAC environment, the change tracking file must be located on shared storage accessible from all nodes in the cluster.</p>
</div>
<p>RMAN does not support backup and recovery of the change tracking file. The database resets the change tracking file when it determines that the change tracking file is invalid. If you restore and recover the whole database or a subset, then the database resets the block change tracking file and starts tracking changes again. After you make a level 0 incremental backup, the next incremental backup can use change tracking data.</p>
</div>
</div>
<a id="BRADV89535"></a>
<div class="props_rev_3"><a id="GUID-FA0A845D-C071-404F-B7CB-3876C5981B0F"></a>
<h5 id="BRADV-GUID-FA0A845D-C071-404F-B7CB-3876C5981B0F" class="sect5">About the Size of the Block Change Tracking File</h5>
<div>
<p><a id="d37979e7672" class="indexterm-anchor"></a>The size of the block change tracking file is proportional to the size of the database and the number of enabled threads of redo. The size of the block change tracking file can increase and decrease as the database changes. The size is not related to the frequency of updates to the database.</p>
<p>Typically, the space required for block change tracking for a single instance is approximately 1/30,000 the size of the data blocks to be tracked. For an Oracle RAC environment, it is 1/30,000 of the size of the database, times the number of enabled threads.</p>
<p>The following factors that may cause the file to be larger than this estimate suggests:</p>
<ul style="list-style-type: disc;">
<li>
<p>To avoid the overhead of allocating space as your database grows, the block change tracking file size starts at 10 megabytes. New space is allocated in 10 MB increments. Thus, for any database up to approximately 300 gigabytes, the file size is no smaller than 10 MB, for up to approximately 600 gigabytes the file size is no smaller than 20 megabytes, and so on.</p>
</li>
<li>
<p>For each data file, a minimum of 320 kilobytes of space is allocated in the block change tracking file, regardless of the size of the data file. Thus, if you have a large number of relatively small data files, the change tracking file is larger than for databases with a smaller number of larger data files containing the same data.</p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV247"></a><a id="BRADV89536"></a>
<div class="props_rev_3"><a id="GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14"></a>
<h4 id="BRADV-GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14" class="sect4">Enabling and Disabling Block Change Tracking</h4>
<div>
<div class="section">
<p><a id="d37979e7759" class="indexterm-anchor"></a><a id="d37979e7763" class="indexterm-anchor"></a>You can enable block change tracking when the database is either open or mounted. This section assumes that you intend to create the block change tracking file as an <a href="glossary.htm#GUID-37F461C5-AAE0-4F82-92E4-7FB822874640"><span class="xrefglossterm">Oracle managed file</span></a> in the <a href="glossary.htm#GUID-B2954743-3455-4045-9200-891927E38048"><span class="xrefglossterm">database area</span></a>, which is where the database maintains active database files such as data files, control files, and online redo log files. See <span class="q">&#34;<a href="rcmconfb.htm#GUID-061CCF1D-2C8D-4460-B469-9C32893A590A">Overview of Files in the Fast Recovery Area</a>&#34;</span> to learn about the database area and <a href="glossary.htm#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To enable block change tracking:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect to a target database with administrator privileges.</span></li>
<li class="stepexpand"><span>Ensure <a id="d37979e7795" class="indexterm-anchor"></a>that the <code class="codeph">DB_CREATE_FILE_DEST</code> initialization parameter is set.</span>
<div>
<pre dir="ltr">SHOW PARAMETER DB_CREATE_FILE_DEST
</pre>
<p>If the parameter is not set, and if the database is open, then you can set the parameter with the following form of the <a class="olink SQLRF00902" target="_blank" href="../SQLRF/statements_2017.htm#SQLRF00902"><code class="codeph">ALTER SYSTEM</code></a> statement:</p>
<pre dir="ltr">ALTER SYSTEM SET 
  DB_CREATE_FILE_DEST = &#39;/disk1/bct/&#39;
  SCOPE=BOTH SID=&#39;*&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>Enable block change tracking.</span>
<div>
<p>Execute the following <code class="codeph">ALTER DATABASE</code> statement:</p>
<pre dir="ltr">ALTER DATABASE ENABLE BLOCK CHANGE TRACKING;
</pre>
<p>You can also create the change tracking file in a location that you choose yourself by using the following form of SQL statement:</p>
<pre dir="ltr">ALTER DATABASE ENABLE BLOCK CHANGE TRACKING 
  USING FILE &#39;/mydir/rman_change_track.f&#39; REUSE;
</pre>
<p>The <code class="codeph">REUSE</code> option tells Oracle Database to overwrite any existing block change tracking file with the specified name.</p>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV248"></a><a id="BRADV89537"></a>
<div class="props_rev_3"><a id="GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71"></a>
<h4 id="BRADV-GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71" class="sect4">Disabling Block Change Tracking</h4>
<div>
<div class="section">
<p><a id="d37979e7905" class="indexterm-anchor"></a><a id="d37979e7909" class="indexterm-anchor"></a>This section assumes that the block change tracking feature is currently enabled. When you disable block change tracking, the database removes the block change tracking file from the operating system.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To disable block change tracking:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect to a target database with administrator privileges.</span></li>
<li class="stepexpand"><span>Ensure that the target database is mounted or open.</span></li>
<li class="stepexpand"><span>Disable block change tracking.</span>
<div>
<p>Execute the following <code class="codeph">ALTER DATABASE</code> statement:</p>
<pre dir="ltr">ALTER DATABASE DISABLE BLOCK CHANGE TRACKING;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV249"></a><a id="BRADV89538"></a>
<div class="props_rev_3"><a id="GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE"></a>
<h4 id="BRADV-GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE" class="sect4">Checking Whether Change Tracking Is Enabled</h4>
<div>
<div class="section">
<p>You can query <a id="d37979e8007" class="indexterm-anchor"></a>the <a class="olink REFRN30030" target="_blank" href="../REFRN/GUID-2F33DAD8-AF4D-45CF-9C28-E1A03C3E6D0D.htm#REFRN30030"><code class="codeph">V$BLOCK_CHANGE_TRACKING</code></a> view to determine whether change tracking is enabled, and if it is, the file name of the block change tracking file.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To determine whether change tracking is enabled:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Enter the following query in SQL*Plus (sample output included):</p>
<pre dir="ltr">COL STATUS   FORMAT A8
COL FILENAME FORMAT A60
 
SELECT STATUS, FILENAME
FROM   V$BLOCK_CHANGE_TRACKING;

STATUS   FILENAME
-------- ------------------------------------------------------------
ENABLED  /disk1/bct/RDBMS/changetracking/o1_mf_2f71np5j_.chg
</pre></div>
<!-- class="section" --></div>
</div>
<a id="BRADV250"></a><a id="BRADV89539"></a>
<div class="props_rev_3"><a id="GUID-268DD5BF-27DE-4536-8F93-D57431CE4397"></a>
<h4 id="BRADV-GUID-268DD5BF-27DE-4536-8F93-D57431CE4397" class="sect4">Changing the Location of the Block Change Tracking File</h4>
<div>
<div class="section">
<p><a id="d37979e8094" class="indexterm-anchor"></a>To move the change tracking file, use the <a class="olink SQLRF00802" target="_blank" href="../SQLRF/statements_1006.htm#SQLRF00802"><code class="codeph">ALTER DATABASE RENAME FILE</code></a> statement. The database must be mounted. The statement updates the control file to refer to the new location and preserves the contents of the change tracking file. If you cannot shut down the database, then you can disable and enable block change tracking. In this case, you lose the contents of the existing block change tracking file.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To change the location of the change tracking file:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect to a target database.</span></li>
<li class="stepexpand"><span>If necessary, determine the current name of the change tracking file:</span>
<div>
<pre dir="ltr">SQL&gt; SELECT FILENAME FROM V$BLOCK_CHANGE_TRACKING;
</pre></div>
</li>
<li class="stepexpand"><span>If possible, shut down the database. For example:</span>
<div>
<pre dir="ltr">SQL&gt; SHUTDOWN IMMEDIATE
</pre>
<p>If you shut down the database, then skip to the next step. If you choose not to shut down the database, then execute the following SQL statements and skip all remaining steps:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE DISABLE BLOCK CHANGE TRACKING;
SQL&gt; ALTER DATABASE ENABLE BLOCK CHANGE TRACKING USING FILE &#39;<span class="italic">new_location</span>&#39;;
</pre>
<p>In this case you lose the contents of the block change tracking file.</p>
</div>
</li>
<li class="stepexpand"><span>Using host operating system commands, move the block change tracking file to its new location.</span></li>
<li class="stepexpand"><span>Mount the database and move the change tracking file to a location that has more space. For example:</span>
<div>
<pre dir="ltr">ALTER DATABASE RENAME FILE
   &#39;/disk1/bct/RDBMS/changetracking/o1_mf_2f71np5j_.chg&#39; TO 
   &#39;/disk2/bct/RDBMS/changetracking/o1_mf_2f71np5j_.chg&#39;;
</pre>
<p>This statement changes the location of the change tracking file while preserving its contents.</p>
</div>
</li>
<li class="stepexpand"><span>Open the database:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE OPEN;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-268DD5BF-27DE-4536-8F93-D57431CE4397__GUID-B6DD290D-32D6-4FF6-80CA-2325F45AD28E">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF" target="_blank" href="../SQLRF/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> to learn about the <a class="olink SQLRF00802" target="_blank" href="../SQLRF/statements_1006.htm#SQLRF00802"><code class="codeph">ALTER DATABASE</code></a> statement and the <a class="olink SQLRF00902" target="_blank" href="../SQLRF/statements_2017.htm#SQLRF00902"><code class="codeph">ALTER SYSTEM</code></a> statement</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<a id="BRADV89551"></a>
<div class="props_rev_3"><a id="GUID-8894680E-8BBA-475D-8815-D789C1A04FD9"></a>
<h2 id="BRADV-GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" class="sect2">Making Database Backups for Long-Term Storage</h2>
<div>
<p>This section explains the basic concepts and tasks involved in making backups for long-term storage.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-8C01CFF7-EE90-4A04-8E27-EA5C725919AC">Purpose of Archival Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390">Basic Concepts of Archival Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-471E69FD-5483-40AD-A598-8BF6F4530287">Making an Archival Backup for Long-Term Storage</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3">Making a Temporary Archival Backup</a></p>
</li>
</ul>
</div>
<a id="BRADV89552"></a>
<div class="props_rev_3"><a id="GUID-8C01CFF7-EE90-4A04-8E27-EA5C725919AC"></a>
<h3 id="BRADV-GUID-8C01CFF7-EE90-4A04-8E27-EA5C725919AC" class="sect3">Purpose of Archival Backups</h3>
<div>
<p><a id="d37979e8329" class="indexterm-anchor"></a>You can <a id="d37979e8332" class="indexterm-anchor"></a><a id="d37979e8336" class="indexterm-anchor"></a>use <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP</code></a> <code class="codeph">... KEEP</code> to create a backup that is both all-inclusive and exempt from the <a href="glossary.htm#GUID-ECF0ADBB-3255-43A2-A425-26850EA598EA"><span class="xrefglossterm">backup retention policy</span></a>. The backup is all-inclusive because every file needed to restore and recover the database is backed up to a single disk or tape location. The <code class="codeph">KEEP</code> option also specifies that the backup is exempt from the retention policy either forever or for a specified period. The general name for a backup created with <code class="codeph">BACKUP ... KEEP</code> is an <a href="glossary.htm#GUID-52B0BB49-8AC2-4C8E-A52F-1908CDE77717"><span class="xrefglossterm">archival backup</span></a>.</p>
<p><a id="d37979e8365" class="indexterm-anchor"></a><a id="d37979e8369" class="indexterm-anchor"></a><a id="d37979e8373" class="indexterm-anchor"></a>As explained in <span class="q">&#34;<a href="rcmintro.htm#GUID-8863FC3F-43B7-43B4-A017-30A90F5DA7D5">About Data Archival</a>&#34;</span>, one purpose of a backup and recovery strategy is to preserve data. You can use <code class="codeph">BACKUP ... KEEP</code> to retain a database backup for longer than the time dictated by the retention policy. For example, you can back up the database on the first day of every year to satisfy a regulatory requirement and store the media off-site. Years after you make the archival backup, you can restore and recover it to query the data as it appeared at the time of the backup.</p>
<p>Another purpose of an archival backup is to create a backup that you want to restore for testing purposes and then delete. For example, you can back up the database, restore the database in a test environment, and then discard the archival backup after the test database is operational. A related purpose is to create a self-contained backup that you can delete after transferring it to another user or host. For example, another user might want a copy of the database for reporting or testing.</p>
</div>
</div>
<a id="BRADV89553"></a>
<div class="props_rev_3"><a id="GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390"></a>
<h3 id="BRADV-GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390" class="sect3">Basic Concepts of Archival Backups</h3>
<div>
<p>You can exempt a backup from the retention policy by using the <code class="codeph">KEEP</code> option with the <code class="codeph">BACKUP</code> command. You can also use the <code class="codeph">KEEP</code> and <code class="codeph">NOKEEP</code> options of the <a class="olink RCMRF110" target="_blank" href="../RCMRF/rcmsynta008.htm#RCMRF110"><code class="codeph">CHANGE</code></a> command to change the status of an existing backup. Backups with <code class="codeph">KEEP</code> attributes are valid backups that can be recovered like any other backups.</p>
<p>You can specify an end date for an archival backup with the <a class="olink RCMRF160" target="_blank" href="../RCMRF/rcmsubcl022.htm#RCMRF160"><code class="codeph">KEEP UNTIL TIME</code></a> clause, or specify that the backup is kept <code class="codeph">FOREVER</code>. If you specify <code class="codeph">UNTIL</code>, then RMAN marks the backup as obsolete when the <code class="codeph">UNTIL</code> time has passed, regardless of any configured retention policy. For example, if you specify <code class="codeph">KEEP UNTIL TIME &#39;01-JAN-13&#39;</code>, then the backup is obsolete one second after midnight on January 1, 2013. If you specify an <code class="codeph">UNTIL TIME</code> of 9:00 p.m, then the backup is obsolete at 9:01 p.m.</p>
<p>When you specify <code class="codeph">KEEP</code> on the <code class="codeph">BACKUP</code> command, RMAN generates multiple backup sets. Note the following characteristics of the <code class="codeph">BACKUP ... KEEP</code> command:</p>
<ul style="list-style-type: disc;">
<li>
<p><a id="d37979e8514" class="indexterm-anchor"></a><a id="d37979e8518" class="indexterm-anchor"></a>It automatically backs up the data files, control file (even if the <a href="glossary.htm#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">control file autobackup</span></a> is disabled), and the server parameter file.</p>
</li>
<li>
<p>It automatically generates an archived redo log backup to ensure that the database backup can be recovered to a consistent state.</p>
</li>
<li>
<p>If the <code class="codeph">FORMAT</code>, <code class="codeph">POOL</code>, or <code class="codeph">TAG</code> parameters are specified, then they are used for all backups. For this reason, the <code class="codeph">FORMAT</code> string must allow for the creation of multiple backup pieces. Specifying the <code class="codeph">%U</code> substitution variable is the easiest way to meet this requirement.</p>
</li>
<li>
<p>It supports an optional <code class="codeph">RESTORE POINT</code> clause that creates a <a href="glossary.htm#GUID-565076C7-1651-4D58-9F8E-9617561A450A"><span class="xrefglossterm">normal restore point</span></a>, which is a label for an SCN to which the backup must be recovered to be made consistent. The SCN is captured just after the data file backups complete. RMAN resynchronizes restore points with the <a href="glossary.htm#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">recovery catalog</span></a> and maintains the restore points while the backup exists. <span class="q">&#34;<a href="flashdb.htm#GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D">Listing Restore Points</a>&#34;</span> explains how to display restore points.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390__GUID-BA7EB7FF-5055-4ADF-B3DE-4A3FF29F33A2">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF110" target="_blank" href="../RCMRF/rcmsynta008.htm#RCMRF110"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">CHANGE</code> syntax and <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">BACKUP ... KEEP</code> syntax</p>
</div>
</div>
</div>
<a id="BRADV89554"></a>
<div class="props_rev_3"><a id="GUID-471E69FD-5483-40AD-A598-8BF6F4530287"></a>
<h3 id="BRADV-GUID-471E69FD-5483-40AD-A598-8BF6F4530287" class="sect3">Making an Archival Backup for Long-Term Storage</h3>
<div>
<p>Typically, you make an archival backup to tape. Because your data protection backups are most likely to be on a set of tapes that remain accessible and are recycled, it is advisable to reserve a set of tapes for the archival backup. You can write the archival backup to this special set of tapes and then place them in off-site storage.</p>
<p><a id="d37979e8655" class="indexterm-anchor"></a>You can vary the procedure for creating an archival backup by creating a <a id="d37979e8660" class="indexterm-anchor"></a><a href="glossary.htm#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">stored script</span></a> or shell script that updates dynamically. When you run the script, you can dynamically set the name of the restore point, backup format, and so on.</p>
<div class="infoboxnotealso" id="GUID-471E69FD-5483-40AD-A598-8BF6F4530287__GUID-673B8EE2-4F4D-4F2D-9E58-A045702C3403">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmdupdb.htm#GUID-46F117F4-E029-4997-A598-92D7E06957A3">Backup-Based Duplication Without a Target Connection: Example</a>&#34;</span> to learn the recommended technique for restoring an archival backup</p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-A9321B2D-6CFF-4616-B629-67960A8F87DD">Using Substitution Variables in Command Files</a>&#34;</span> and <span class="q">&#34;<a href="rcmcatdb.htm#GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C">Creating and Executing Dynamic Stored Scripts</a>&#34;</span> to learn how to make archival backups with RMAN command files</p>
</li>
</ul>
</div>
</div>
<a id="BRADV251"></a><a id="BRADV89555"></a>
<div class="props_rev_3"><a id="GUID-71184821-155F-4540-B2CB-E5126DE10600"></a>
<h4 id="BRADV-GUID-71184821-155F-4540-B2CB-E5126DE10600" class="sect4">Making an Archival Backup</h4>
<div>
<div class="section">
<p>This scenario makes a long-term archival backup with a backup <a href="glossary.htm#GUID-7679D8DB-B41A-4DDC-A1DD-20CEDC0BCA8E"><span class="xrefglossterm">tag</span></a> of <code class="codeph">QUARTERLY</code> and assigns it to a special family of Oracle Secure Backup tapes reserved for long-term storage. Note the following features of this example:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">FOREVER</code> keyword indicates that this backup is never eligible for deletion by the <a href="glossary.htm#GUID-ECF0ADBB-3255-43A2-A425-26850EA598EA"><span class="xrefglossterm">backup retention policy</span></a>.</p>
</li>
<li>
<p>The <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP</code></a> command creates the restore point named <code class="codeph">FY06Q4</code> to match the SCN at which point this backup is consistent.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To make a long-term archival backup:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog.</span>
<div>
<p>The target database can be open or mounted. A recovery catalog is required for <code class="codeph">KEEP FOREVER</code>, but is not required for any other <code class="codeph">KEEP</code> option.</p>
<div class="infoboxnotealso" id="GUID-71184821-155F-4540-B2CB-E5126DE10600__GUID-2880F3BE-5EA8-4F24-B471-4702642288CF">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Run<a id="d37979e8814" class="indexterm-anchor"></a><a id="d37979e8818" class="indexterm-anchor"></a><a id="d37979e8822" class="indexterm-anchor"></a> <code class="codeph">BACKUP ... KEEP</code> to make the backup.</span>
<div>
<p>The following example generates a data file and archived log backup and creates a <a href="glossary.htm#GUID-565076C7-1651-4D58-9F8E-9617561A450A"><span class="xrefglossterm">normal restore point</span></a>. The specified restore point must not already exist.</p>
<p>The log backup contains just those archived logs needed to restore this backup to a consistent state. The database performs an online redo log switch to archive the redo that is in the current online logs and is necessary to make this new backup consistent. The control file autobackup has a copy of the restore point, so it can be referenced as soon as the control file is restored.</p>
<pre dir="ltr">RUN
{
  ALLOCATE CHANNEL c1 
    DEVICE TYPE sbt
    PARMS &#39;ENV=(OB_MEDIA_FAMILY=archival_backup)&#39;;
  BACKUP DATABASE
    TAG quarterly
    KEEP FOREVER
    RESTORE POINT FY06Q4;
}
</pre>
<p>The following variation keeps the backup for 365 days instead of keeping it forever. After a year has passed, the backup becomes obsolete regardless of the backup retention policy settings.</p>
<pre dir="ltr">RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt
    PARMS &#39;ENV=(OB_MEDIA_FAMILY=archival_backup)&#39;;
  BACKUP DATABASE
    TAG quarterly
    KEEP UNTIL TIME &#39;SYSDATE+365&#39;
    RESTORE POINT FY06Q4;
}
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-71184821-155F-4540-B2CB-E5126DE10600__GUID-C441D7B9-010C-41ED-86A9-034DB2E89381">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="flashdb.htm#GUID-FAA04D1F-36E2-4B20-954F-845E42386775">Overview of Flashback Database_ Restore Points and Guaranteed Restore Points</a>&#34;</span> to learn about restore points</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV252"></a><a id="BRADV89556"></a>
<div class="props_rev_3"><a id="GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3"></a>
<h3 id="BRADV-GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3" class="sect3">Making a Temporary Archival Backup</h3>
<div>
<div class="section">
<p>One purpose of an archival backup is to create a test database. The technique for making a test database is essentially the same as the technique described in <span class="q">&#34;<a href="rcmbckba.htm#GUID-471E69FD-5483-40AD-A598-8BF6F4530287">Making an Archival Backup for Long-Term Storage</a>&#34;</span>. The difference is that you intend to delete the backup soon after creating it.</p>
<p>You can specify the temporary status of the backup with the<a id="d37979e8932" class="indexterm-anchor"></a><a id="d37979e8936" class="indexterm-anchor"></a> <code class="codeph">BACKUP ... KEEP UNTIL</code> parameter. Assume that you want to make a backup and then restore it to a new host the same day. In this case, you can specify <code class="codeph">KEEP UNTIL</code> <code class="codeph">TIME SYSDATE+1</code> to indicate that RMAN overrides the retention policy for this backup for only one day. After one day, the backup becomes obsolete, regardless of any configured backup retention policy.</p>
<p>The command in <a href="rcmbckba.htm#GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3__CHDDJHCG">Example 9-11</a> makes an archival backup on a temporary disk with the tag <code class="codeph">TESTDB</code>. The example creates a normal restore point, which is a label for the time to which the backup is recovered. RMAN only backs up the archived redo logs if the database is open during the backup. Archived logs are not needed for offline backups and so are not backed up.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3__CHDDJHCG">
<p class="titleinexample">Example 9-11 Creating a Temporary Archival Backup</p>
<pre dir="ltr">BACKUP DATABASE
  FORMAT &#39;/disk1/oraclebck/%U&#39; 
  TAG TESTDB 
  KEEP UNTIL TIME &#39;SYSDATE+1&#39; 
  RESTORE POINT TESTDB06;
</pre>
<p>The recommended technique for restoring an archival backup is to use the <a class="olink RCMRF126" target="_blank" href="../RCMRF/rcmsynta020.htm#RCMRF126"><code class="codeph">DUPLICATE</code></a> command. See <span class="q">&#34;<a href="rcmdupdb.htm#GUID-46F117F4-E029-4997-A598-92D7E06957A3">Backup-Based Duplication Without a Target Connection: Example</a>&#34;</span>.</p>
</div>
<!-- class="example" --></div>
</div>
</div>
<a id="BRADV89557"></a>
<div class="props_rev_3"><a id="GUID-731ADA67-235E-481D-AC17-9F9067AD55BF"></a>
<h2 id="BRADV-GUID-731ADA67-235E-481D-AC17-9F9067AD55BF" class="sect2">Backing Up RMAN Backups</h2>
<div>
<p>This section explains how to back up backup sets and image copies and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmbckba.htm#GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5">About Backups of RMAN Backups</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78">Backing Up Backup Sets with RMAN</a></p>
</li>
<li>
<p><a href="rcmbckba.htm#GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A">Backing Up Image Copy Backups with RMAN</a></p>
</li>
</ul>
</div>
<a id="BRADV89558"></a>
<div class="props_rev_3"><a id="GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5"></a>
<h3 id="BRADV-GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5" class="sect3">About Backups of RMAN Backups</h3>
<div>
<p>You can use <a id="d37979e9130" class="indexterm-anchor"></a><a id="d37979e9134" class="indexterm-anchor"></a>the <a class="olink RCMRF107" target="_blank" href="../RCMRF/rcmsynta006.htm#RCMRF107"><code class="codeph">BACKUP BACKUPSET</code></a> command to back up backup sets produced by other backup jobs. You can also use<a id="d37979e9144" class="indexterm-anchor"></a><a id="d37979e9148" class="indexterm-anchor"></a> <code class="codeph">BACKUP RECOVERY AREA</code> to back up recovery files created in the current and all previous <a href="glossary.htm#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a> destinations. Recovery files are full and incremental backup sets, control file autobackups, data file copies, and archived redo logs. SBT and disk backups are supported for <code class="codeph">BACKUP RECOVERY AREA</code>. For disk backups of the recovery files, you must use the <code class="codeph">TO DESTINATION</code> option.</p>
<p>The preceding commands are especially useful in the following scenarios:<a id="d37979e9169" class="indexterm-anchor"></a><a id="d37979e9173" class="indexterm-anchor"></a><a id="d37979e9179" class="indexterm-anchor"></a><a id="d37979e9183" class="indexterm-anchor"></a></p>
<ul style="list-style-type: disc;">
<li>
<p>Ensuring that all backups exist both on disk and on tape.</p>
</li>
<li>
<p>Moving backups from disk to tape and then freeing space on disk. This task is especially important when the database uses a fast recovery area so that the space can be reused as needed.</p>
</li>
</ul>
<p>You can also use the<a id="d37979e9196" class="indexterm-anchor"></a><a id="d37979e9200" class="indexterm-anchor"></a> <code class="codeph">BACKUP</code> <code class="codeph">COPY</code> <code class="codeph">OF</code> command to back up image copies of data files, control files, and archived redo logs. The output of this command can be either backup sets or image copies, so you can generate backup sets from image copies. This form of backup is used to back up a database backup created as image copies on disk to tape.</p>
</div>
<a id="BRADV89559"></a>
<div class="props_rev_3"><a id="GUID-99B02CD1-1302-46F7-A354-1CD3BB57BF80"></a>
<h4 id="BRADV-GUID-99B02CD1-1302-46F7-A354-1CD3BB57BF80" class="sect4">About Multiple Copies of RMAN Backup Sets</h4>
<div>
<p>The <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code> command creates additional copies of backup pieces in a backup set, but does not create a new backup set. Thus, <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code> is similar to using the <code class="codeph">DUPLEX</code> or <code class="codeph">MAXCOPIES</code> option of <code class="codeph">BACKUP</code> (see <span class="q">&#34;<a href="rcmbckad.htm#GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54">Duplexing Backup Sets</a>&#34;</span>). The extra copy of a backup set created by <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code> is not a new backup set, just as copies of a backup set produced by other forms of the <code class="codeph">BACKUP</code> command are not separate backup sets.</p>
</div>
</div>
<a id="BRADV253"></a><a id="BRADV89560"></a>
<div class="props_rev_3"><a id="GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6"></a>
<h4 id="BRADV-GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6" class="sect4">Viewing the Effect of a Backup Retention Policy on Backups of Backups</h4>
<div>
<div class="section">
<p>For a <a href="glossary.htm#GUID-ECF0ADBB-3255-43A2-A425-26850EA598EA"><span class="xrefglossterm">backup retention policy</span></a> based on <a href="glossary.htm#GUID-57A71B9A-2353-4669-A152-EFAD9AFF3ED3"><span class="xrefglossterm">redundancy</span></a>, a backup set is counted as one instance of a backup. This statement is true even if there are multiple copies of the backup pieces that form the backup set, such as when a backup set has been backed up from disk to tape.</p>
<p>For a <a href="glossary.htm#GUID-1C595EF7-B8A1-4AA3-8C45-44E9FC8BAB9E"><span class="xrefglossterm">recovery window</span></a> retention policy, either all of the copies of a backup set are obsolete, or none of them are. This point is easiest to grasp when viewing the output of the <a class="olink RCMRF132" target="_blank" href="../RCMRF/rcmsynta027.htm#RCMRF132"><code class="codeph">LIST</code></a> and <a class="olink RCMRF147" target="_blank" href="../RCMRF/rcmsynta2006.htm#RCMRF147"><code class="codeph">REPORT</code></a> commands.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To view the effect of a backup retention policy on backups of backups:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Back up a data file.</span>
<div>
<p>The following example backs up data file 5:</p>
<pre dir="ltr">BACKUP AS BACKUPSET DATAFILE 5;
</pre></div>
</li>
<li class="stepexpand"><span>Run the <code class="codeph">LIST</code> command for the data file backup from Step 1.</span>
<div>
<p>For example, run the following command (sample output included).</p>
<pre dir="ltr">LIST BACKUP OF DATAFILE 5 SUMMARY;
 
List of Backups
===============
Key     TY LV S Device Type Completion Time #Pieces #Copies Compressed Tag
------- -- -- - ----------- --------------- ------- ------- ---------- ---
18      B  F  A DISK        04-AUG-13       1       1       NO         TAG20070804T160 134
</pre></div>
</li>
<li class="stepexpand"><span>Use the backup set key from the previous step to back up the backup set.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">BACKUP BACKUPSET 18;
</pre></div>
</li>
<li class="stepexpand"><span>Run the same <code class="codeph">LIST</code> command that you ran in Step 2.</span>
<div>
<p>For example, run the following command (sample output included).</p>
<pre dir="ltr">LIST BACKUP OF DATAFILE 5 SUMMARY;
 
List of Backups
===============
Key     TY LV S Device Type Completion Time #Pieces #Copies Compressed Tag
------- -- -- - ----------- --------------- ------- ------- ---------- ---
18      B  F  A DISK        04-AUG-13       1       2       NO         TAG20070804T160 134
</pre>
<p>Only one backup set is shown in this output, but there are now two copies of it.</p>
</div>
</li>
<li class="stepexpand"><span>Generate a report to see the effect of these copies under a redundancy-based backup retention policy.</span>
<div>
<p>For example, issue the following command:</p>
<pre dir="ltr">REPORT OBSOLETE REDUNDANCY 1;
 
</pre>
<p>No copy is reported as obsolete because both copies of the backup set have the same values for <code class="codeph">set_stamp</code> and <code class="codeph">set_count</code>.</p>
</div>
</li>
<li class="stepexpand"><span>Generate a report to see the effect of these copies under a recovery window-based backup retention policy.</span>
<div>
<p>For example, issue the following command:</p>
<pre dir="ltr">REPORT OBSOLETE RECOVERY WINDOW OF 1 DAYS;
 
</pre>
<p>No copy of the backup set is reported as obsolete or based on the <code class="codeph">CHECKPOINT_CHANGE#</code> of this backup set, with the current time and the availability of other backups.</p>
<div class="infoboxnotealso" id="GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6__GUID-DC504A2A-1D5D-44F4-8414-AB9A30B39423">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmconfb.htm#GUID-E9AEAC34-6C40-40A1-BAF5-3EAE20417715">Configuring a Redundancy-Based Retention Policy</a>&#34;</span></p>
</li>
<li>
<p><a href="rcmreprt.htm#GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" title="The primary purpose of the LIST command is to list backup and copies. The REPORT command provides various reports of RMAN backups.">Reporting on RMAN Operations</a> to learn how to use the <code class="codeph">LIST</code> and <code class="codeph">REPORT</code> commands</p>
</li>
</ul>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV254"></a><a id="BRADV147"></a>
<div class="props_rev_3"><a id="GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78"></a>
<h3 id="BRADV-GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78" class="sect3">Backing Up Backup Sets with RMAN</h3>
<div>
<div class="section">
<p>This section explains how to use the <code class="codeph">BACKUP BACKUPSET</code> command to copy backup sets from disk to tape. The procedure assumes that you have configured an <a href="glossary.htm#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> device as your default device.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up backup sets from disk to tape:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>If you are backing up a subset of available backup sets, then execute the <code class="codeph">LIST BACKUPSET</code> command to obtain their primary keys.</span>
<div>
<p>The following example lists the backup sets in summary form:</p>
<pre dir="ltr">RMAN&gt; LIST BACKUPSET SUMMARY;

List of Backups
===============
Key TY LV S Device Type Completion Time #Pieces #Copies Comp Tag
--- -- -- - ----------- --------------- ------- ------- ---- ---
1   B  F  A DISK        28-MAY-13       1       1       NO   TAG20070528T132432
2   B  F  A DISK        29-MAY-13       1       1       NO   TAG20070529T132433
3   B  F  A DISK        30-MAY-13       1       1       NO   TAG20070530T132434
</pre>
<p>The following example lists details about backup set 3:</p>
<pre dir="ltr">RMAN&gt; LIST BACKUPSET 3;

List of Backup Sets
===================

BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
3       Full    8.33M      DISK        00:00:01     30-MAY-13
        BP Key: 3   Status: AVAILABLE  Compressed: NO  Tag: TAG20070530T132434
        Piece Name: /disk1/oracle/dbs/c-35764265-20070530-02
  Control File Included: Ckp SCN: 397221       Ckp time: 30-MAY-13
  SPFILE Included: Modification time: 30-MAY-13
  SPFILE db_unique_name: PROD
</pre></div>
</li>
<li class="stepexpand"><span><a id="d37979e9652" class="indexterm-anchor"></a><a id="d37979e9656" class="indexterm-anchor"></a>Execute the <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code> command.</span>
<div>
<p>The following example backs up all disk backup sets to tape and then deletes the input disk backups:</p>
<pre dir="ltr">BACKUP BACKUPSET ALL
  DELETE INPUT;
</pre>
<p>The following example backs up only the backup sets with the primary key 1 and 2 to tape and then deletes the input disk backups:</p>
<pre dir="ltr">BACKUP BACKUPSET 1,2
  DELETE INPUT;
</pre></div>
</li>
<li class="stepexpand"><span>Optionally, execute the <a class="olink RCMRF132" target="_blank" href="../RCMRF/rcmsynta027.htm#RCMRF132"><code class="codeph">LIST</code></a> command to see a listing of backup sets and pieces.</span>
<div>
<p>The output lists all copies, including backup piece copies created by <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV255"></a><a id="BRADV89561"></a>
<div class="props_rev_3"><a id="GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A"></a>
<h3 id="BRADV-GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A" class="sect3">Backing Up Image Copy Backups with RMAN</h3>
<div>
<div class="section">
<p>This section explains how to use the <code class="codeph">BACKUP</code> command to back up image copies to tape. It is assumed that you have configured an <a href="glossary.htm#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> device as your default device.</p>
<p>When you back up image copies that have multiple copies of the data files, specifying tags for the backups makes it easier to identify the input image copy. All image copies of data files have tags. The <a href="glossary.htm#GUID-7679D8DB-B41A-4DDC-A1DD-20CEDC0BCA8E"><span class="xrefglossterm">tag</span></a> of an image copy is inherited by default when the image copy is backed up as a new image copy.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up image copies from disk to tape:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d37979e9819" class="indexterm-anchor"></a><a id="d37979e9823" class="indexterm-anchor"></a>Issue the <code class="codeph">BACKUP</code> <code class="codeph">... COPY OF</code> or <code class="codeph">BACKUP DATAFILECOPY</code> command.</span>
<div>
<p>The following example backs up data file copies that have the tag <code class="codeph">DBCopy</code>:</p>
<pre dir="ltr">BACKUP DATAFILECOPY FROM TAG monDBCopy;
</pre>
<p>The following example backs up the latest image copies of a database to tape, assigns the tag <code class="codeph">QUARTERLY_BACKUP</code>, and deletes the input disk backups:</p>
<pre dir="ltr">BACKUP DEVICE TYPE sbt
  TAG &#34;quarterly_backup&#34;
  COPY OF DATABASE 
  DELETE INPUT;
</pre></div>
</li>
<li class="stepexpand"><span>Optionally, issue the <a class="olink RCMRF132" target="_blank" href="../RCMRF/rcmsynta027.htm#RCMRF132"><code class="codeph">LIST</code></a> command to see a listing of backup sets. The output lists all copies, including backup piece copies created by the <code class="codeph">BACKUP</code> command with the <code class="codeph">BACKUPSET</code> clause.</span></li>
</ol>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="rcmcncpt.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="rcmbckad.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>