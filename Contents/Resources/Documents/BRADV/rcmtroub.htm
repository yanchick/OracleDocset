<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2680"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Troubleshooting%20RMAN%20Operations"></a><title>Troubleshooting RMAN Operations</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="backups, correlating RMAN channels with"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rcmtunin.htm" title="Previous" type="text/html"/>
<link rel="Next" href="part_tra.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-ABFD58BD-5D3B-4A6C-AA46-E085AE234D73"></a> <span id="PAGE" style="display:none;">37/48</span> <!-- End Header -->
<a id="BRADV012"></a>
<h1 id="BRADV-GUID-ABFD58BD-5D3B-4A6C-AA46-E085AE234D73" class="sect1"><span class="enumeration_chapter">24</span> Troubleshooting RMAN Operations</h1>
<div>
<p>This chapter describes how to troubleshoot Recovery Manager. This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtroub.htm#GUID-FC95B894-86E6-414C-A0A7-69D9768CDDFC">Interpreting RMAN Message Output</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB">Using V$ Views for RMAN Troubleshooting</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-B1E9715D-BD07-4B80-8158-33981138E679">Testing the Media Management API</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-772C8583-7763-48AB-B404-747188EC718A">Terminating an RMAN Command</a></p>
</li>
</ul>
</div>
<a id="BRADV174"></a>
<div class="props_rev_3"><a id="GUID-FC95B894-86E6-414C-A0A7-69D9768CDDFC"></a>
<h2 id="BRADV-GUID-FC95B894-86E6-414C-A0A7-69D9768CDDFC" class="sect2">Interpreting RMAN Message Output</h2>
<div>
<p>Re<a id="d94037e159" class="indexterm-anchor"></a><a id="d94037e163" class="indexterm-anchor"></a>covery Manager provides detailed error messages that can aid in troubleshooting problems. Also, Oracle Database and the third-party media vendors generate useful debugging output of their own. The following discussion explains how to identify and interpret the different errors that you may encounter.</p>
</div>
<a id="BRADV411"></a><a id="BRADV89865"></a>
<div class="props_rev_3"><a id="GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8"></a>
<h3 id="BRADV-GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8" class="sect3">Identifying Types of RMAN Message Output</h3>
<div>
<p>Output that is useful for troubleshooting failed or unresponsive RMAN jobs is located in several different places, as explained in <a href="rcmtroub.htm#GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8__BGBBABDH" title="This table lists places to look for different message output useful in troubleshooting RMAN backup problems.">Table 24-1</a>.</p>
<div class="tblformalwide" id="GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8__BGBBABDH">
<p class="titleintable">Table 24-1 Types of Message Output</p>
<table class="cellalignment553" title="Types of Message Output" summary="This table lists places to look for different message output useful in troubleshooting RMAN backup problems.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment554" id="d94037e256">Type of Output</th>
<th class="cellalignment554" id="d94037e260">Produced By</th>
<th class="cellalignment558" id="d94037e263">Location</th>
<th class="cellalignment558" id="d94037e266">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment556" id="d94037e271" headers="d94037e256">
<p>RMAN messages</p>
</td>
<td class="cellalignment556" headers="d94037e271 d94037e260">
<p>RMAN</p>
</td>
<td class="cellalignment559" headers="d94037e271 d94037e263">
<p>Completed job information is <a id="d94037e280" class="indexterm-anchor"></a>in <code class="codeph">V$RMAN_STATUS</code> and <code class="codeph">RC_RMAN_STATUS</code>. Current job information is in <code class="codeph">V$RMAN_OUTPUT</code>.</p>
<p>When running RMAN from the command line, you can direct output to the following places:</p>
<ul style="list-style-type: disc;">
<li>
<p>Standard output</p>
</li>
<li>
<p>A log file specified by <code class="codeph">LOG</code> on the command line or the <code class="codeph">SPOOL</code> <code class="codeph">LOG</code> command</p>
</li>
<li>
<p>A file created by redirecting RMAN output (for example, in UNIX, using the&#39;<code class="codeph">&gt;</code>&#39; operator)</p>
</li>
</ul>
</td>
<td class="cellalignment559" headers="d94037e271 d94037e266">
<p>Contains actions relevant to the RMAN job and error messages generated by RMAN, the database server, and the media vendor. RMAN error messages have an <code class="codeph">RMAN-</code> prefix. Normal action descriptions do not have a prefix.</p>
<p>You can execute the following PL/SQL to remove all entries from <code class="codeph">V$RMAN_STATUS</code>:</p>
<pre dir="ltr">update node set high_rsr_recid=0
where db_key = <span class="italic">our_target_database_db_ke</span>y ;
</pre>
<p>The preceding function removes all job-related entries. No rows are visible until new backup jobs are shown in <code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code>.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment556" id="d94037e338" headers="d94037e256">
<p><code class="codeph">alert_</code><span class="italic">SID</span><code class="codeph">.log</code></p>
</td>
<td class="cellalignment556" headers="d94037e338 d94037e260">
<p>Oracle Database</p>
</td>
<td class="cellalignment559" headers="d94037e338 d94037e263">
<p>The <code class="codeph">alert</code> subdirectory of the <a id="d94037e355" class="indexterm-anchor"></a><a href="glossary.htm#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a> home</p>
</td>
<td class="cellalignment559" headers="d94037e338 d94037e266">
<p>Contains a chronological log of errors, initialization parameter settings, and administration operations. Records values for overwritten control file records.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment556" id="d94037e365" headers="d94037e256">
<p><a id="d94037e367" class="indexterm-anchor"></a>Oracle trace file</p>
</td>
<td class="cellalignment556" headers="d94037e365 d94037e260">
<p>Oracle Database</p>
</td>
<td class="cellalignment559" headers="d94037e365 d94037e263">
<p>The <code class="codeph">trace</code> subdirectory of the ADR home</p>
</td>
<td class="cellalignment559" headers="d94037e365 d94037e266">
<p>Contains detailed output generated by Oracle Database processes. This file is created when an <code class="codeph">ORA-600</code> or <code class="codeph">ORA-3113</code> error message occurs, whenever RMAN cannot allocate a channel, and when the database fails to load the media management library.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment556" id="d94037e389" headers="d94037e256">
<p><code class="codeph">sbtio.log</code></p>
</td>
<td class="cellalignment556" headers="d94037e389 d94037e260">
<p>Third-party media management software</p>
</td>
<td class="cellalignment559" headers="d94037e389 d94037e263">
<p>The <code class="codeph">trace</code> subdirectory of the ADR home</p>
</td>
<td class="cellalignment559" headers="d94037e389 d94037e266">
<p>Contains vendor-specific information written by the media management software. This log does not contain Oracle Database or RMAN errors.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment556" id="d94037e406" headers="d94037e256">
<p>Media manager log file</p>
</td>
<td class="cellalignment556" headers="d94037e406 d94037e260">
<p>Third-party media management software</p>
</td>
<td class="cellalignment559" headers="d94037e406 d94037e263">
<p>The file names for any media manager logs other than <code class="codeph">sbtio.log</code> are determined by the media management software.</p>
</td>
<td class="cellalignment559" headers="d94037e406 d94037e266">
<p>Contains information about the functioning of the media management device</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="BRADV412"></a><a id="BRADV89866"></a>
<div class="props_rev_3"><a id="GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA"></a>
<h3 id="BRADV-GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA" class="sect3">Recognizing RMAN Error Message Stacks</h3>
<div>
<div class="section">
<p>RMAN reports errors as they occur. If an error is not retrievable, that is, if RMAN cannot perform failover to another channel to complete a particular job step, then RMAN also reports a summary of the errors after all job sets complete. This feature is known as deferred error reporting.</p>
<p>One way to determine whether RMAN encountered an error is to examine its return code, as described in <span class="q">&#34;<a href="rcmtroub.htm#GUID-52F92FE9-4C46-4380-97CB-454E5C784E01">Identifying RMAN Return Codes</a>&#34;</span>. A second way is to search the RMAN output for the string <code class="codeph">RMAN-00569</code>, which is the message number for the error stack banner. All RMAN errors are preceded by this error message. If you do not see an <code class="codeph">RMAN-00569</code> message in the output, then there are no errors. <a href="rcmtroub.htm#GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA__BGBIHGBB">Example 24-1</a> shows a syntax error.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA__BGBIHGBB">
<p class="titleinexample">Example 24-1 RMAN Syntax Error</p>
<pre dir="ltr">RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-00558: error encountered while parsing input commands
RMAN-01005: syntax error: found &#34;)&#34;: expecting one of: &#34;archivelog, backup,
 backupset, controlfilecopy, current, database, datafile, datafilecopy, (, plus, ;, tablespace&#34;
RMAN-01007: at line 1 column 18 file: standard input
</pre></div>
<!-- class="example" --></div>
</div>
<a id="BRADV89867"></a>
<div class="props_rev_3"><a id="GUID-86207589-FA0F-4F24-BEEE-A212E0059C7F"></a>
<h3 id="BRADV-GUID-86207589-FA0F-4F24-BEEE-A212E0059C7F" class="sect3">Identifying RMAN Error Codes</h3>
<div>
<p><a id="d94037e583" class="indexterm-anchor"></a><a id="d94037e587" class="indexterm-anchor"></a>Typically, you find the following types of error codes in RMAN message stacks:</p>
<ul style="list-style-type: disc;">
<li>
<p>Errors prefixed with <code class="codeph">RMAN-</code></p>
<p>These are RMAN errors and the error ranges are described in <a href="rcmtroub.htm#GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E">RMAN Error Message Numbers</a> .</p>
</li>
<li>
<p>Errors prefixed with <code class="codeph">ORA-</code></p>
<p>Media manager errors use the <code class="codeph">ORA-</code> prefix. The error ranges for media manager errors are described in <a href="rcmtroub.htm#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020">ORA-19511: Media Manager Errors .</a></p>
</li>
<li>
<p>Errors preceded by the line <code class="codeph">Additional information:</code></p>
<div class="infoboxnotealso" id="GUID-86207589-FA0F-4F24-BEEE-A212E0059C7F__GUID-2F0273F7-25AC-4D6D-AFCE-A5BD4117B9C0">
<p class="notep1">See Also:</p>
<p><a class="olink ERRMG" target="_blank" href="../ERRMG/toc.htm"><span class="italic">Oracle Database Error Messages</span></a> for explanations of <code class="codeph">RMAN</code> and <code class="codeph">ORA</code> error codes</p>
</div>
</li>
</ul>
</div>
<a id="BRADV413"></a><a id="BRADV89868"></a>
<div class="props_rev_3"><a id="GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E"></a>
<h4 id="BRADV-GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E" class="sect4">RMAN Error Message Numbers</h4>
<div>
<p><a id="d94037e706" class="indexterm-anchor"></a><a id="d94037e712" class="indexterm-anchor"></a><a href="rcmtroub.htm#GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E__g1014492" title="This table lists error number ranges associated with RMAN error messages and their likely causes.">Table 24-2</a> indicates the error ranges for common RMAN error messages, all of which are described in <a class="olink ERRMG" target="_blank" href="../ERRMG/toc.htm"><span class="italic">Oracle Database Error Messages</span></a>.</p>
<div class="tblformal" id="GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E__g1014492">
<p class="titleintable">Table 24-2 RMAN Error Message Ranges</p>
<table class="cellalignment515" title="RMAN Error Message Ranges" summary="This table lists error number ranges associated with RMAN error messages and their likely causes.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment527" id="d94037e736">Error Range</th>
<th class="cellalignment528" id="d94037e739">Cause</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e744" headers="d94037e736">
<p>0550-0999</p>
</td>
<td class="cellalignment530" headers="d94037e744 d94037e739">
<p>Command-line interpreter</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e751" headers="d94037e736">
<p>1000-1999</p>
</td>
<td class="cellalignment530" headers="d94037e751 d94037e739">
<p>Keyword analyzer</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e758" headers="d94037e736">
<p>2000-2999</p>
</td>
<td class="cellalignment530" headers="d94037e758 d94037e739">
<p>Syntax analyzer</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e765" headers="d94037e736">
<p>3000-3999</p>
</td>
<td class="cellalignment530" headers="d94037e765 d94037e739">
<p>Main layer</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e772" headers="d94037e736">
<p>4000-4999</p>
</td>
<td class="cellalignment530" headers="d94037e772 d94037e739">
<p>Services layer</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e779" headers="d94037e736">
<p>5000-5499</p>
</td>
<td class="cellalignment530" headers="d94037e779 d94037e739">
<p>Compilation of <code class="codeph">RESTORE</code> or <code class="codeph">RECOVER</code> command</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e792" headers="d94037e736">
<p>5500-5999</p>
</td>
<td class="cellalignment530" headers="d94037e792 d94037e739">
<p>Compilation of <code class="codeph">DUPLICATE</code> command</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e802" headers="d94037e736">
<p>6000-6999</p>
</td>
<td class="cellalignment530" headers="d94037e802 d94037e739">
<p>General compilation</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e809" headers="d94037e736">
<p>7000-7999</p>
</td>
<td class="cellalignment530" headers="d94037e809 d94037e739">
<p>General execution</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e816" headers="d94037e736">
<p>8000-8999</p>
</td>
<td class="cellalignment530" headers="d94037e816 d94037e739">
<p>PL/SQL programs</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e823" headers="d94037e736">
<p>9000-9999</p>
</td>
<td class="cellalignment530" headers="d94037e823 d94037e739">
<p>Low-level keyword analyzer</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e831" headers="d94037e736">
<p>10000-10999</p>
</td>
<td class="cellalignment530" headers="d94037e831 d94037e739">
<p>Server-side execution</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e838" headers="d94037e736">
<p>11000-11999</p>
</td>
<td class="cellalignment530" headers="d94037e838 d94037e739">
<p>Interphase errors between PL/SQL and RMAN</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e845" headers="d94037e736">
<p>12000-12999</p>
</td>
<td class="cellalignment530" headers="d94037e845 d94037e739">
<p>Recovery catalog packages</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="BRADV414"></a><a id="BRADV89869"></a>
<div class="props_rev_3"><a id="GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020"></a>
<h4 id="BRADV-GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020" class="sect4">ORA-19511: Media Manager Errors</h4>
<div>
<p><a id="d94037e921" class="indexterm-anchor"></a><a id="d94037e925" class="indexterm-anchor"></a>If a media manager error occurs, <code class="codeph">ORA-19511</code> is signaled, and the media manager is expected to provide RMAN a descriptive error. RMAN displays the error passed back to it by the media manager. For example, you might see this:</p>
<pre dir="ltr">ORA-19511: Error received from media manager layer, error text:
   sbtpvt_open_input: file .* does not exist or cannot be accessed, errno = 2
</pre>
<p>The message from the media manager should provide you with enough information to let you fix the root problem. If it does not, then refer to the documentation for your media manager or contact your media management vendor support representative for further information. <code class="codeph">ORA-19511</code> errors originate with the media manager, not with Oracle Database. The database just passes on the message from the media manager. The cause can be addressed only by the media management vendor.</p>
<p>If you are still using an <a href="glossary.htm#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> 1.1-compliant media management layer, you may see some additional error message text. Output from an SBT 1.1-compliant media management layer is similar to the following:</p>
<pre dir="ltr">ORA-19507: failed to retrieve sequential file, handle=&#34;c-140148591-20031014-06&#34;, parms=&#34;&#34;
ORA-27007: failed to open file
Additional information: 7000
Additional information: 2
ORA-19511: Error received from media manager layer, error text:
   SBT error = 7000, errno = 0, sbtopen: backup file not found
</pre>
<p>The &#34;Additional information&#34; provided uses error codes specific to SBT 1.1. The values displayed correspond to the media manager message numbers and error text listed in <a href="rcmtroub.htm#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__g1014541" title="This table lists SBT 1.1 error message numbers and corresponding error text..">Table 24-3</a>. RMAN again signals the error, as an ORA-19511 <code class="codeph">Error received from media manager layer</code> error, and a general error message related to the error code returned from the media manager and including the SBT 1.1 error number is then displayed.</p>
<p>The SBT 1.1 error messages are listed here for your reference. <a href="rcmtroub.htm#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__g1014541" title="This table lists SBT 1.1 error message numbers and corresponding error text..">Table 24-3</a> lists media manager message numbers and their corresponding error text. In the error codes, <span class="italic"><code class="codeph">O/S</code></span> stands for <span class="italic">operating system</span>. The errors marked with an asterisk (*) are internal and are not typically seen during normal operation.</p>
<div class="tblformal" id="GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__g1014541">
<p class="titleintable">Table 24-3 Media Manager Error Message Ranges</p>
<table class="cellalignment515" title="Media Manager Error Message Ranges" summary="This table lists SBT 1.1 error message numbers and corresponding error text..">
<thead>
<tr class="cellalignment501">
<th class="cellalignment527" id="d94037e983">Cause</th>
<th class="cellalignment527" id="d94037e986">No.</th>
<th class="cellalignment550" id="d94037e989">Message</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e994" headers="d94037e983">
<p>sbtopen</p>
</td>
<td class="cellalignment529" headers="d94037e994 d94037e986">
<p>7000</p>
<p>7001</p>
<p>7002*</p>
<p>7003</p>
<p>7004</p>
<p>7005</p>
<p>7006</p>
<p>7007</p>
<p>7008</p>
<p>7009</p>
<p>7010</p>
<p>7011</p>
<p>7012*</p>
</td>
<td class="cellalignment552" headers="d94037e994 d94037e989">
<p>Backup file not found (only returned for read)</p>
<p>File exists (only returned for write)</p>
<p>Bad mode specified</p>
<p>Invalid block size specified</p>
<p>No tape device found</p>
<p>Device found, but busy; try again later</p>
<p>Tape volume not found</p>
<p>Tape volume is in-use</p>
<p>I/O Error</p>
<p>Can&#39;t connect with Media Manager</p>
<p>Permission denied</p>
<p>O/S error for example malloc, fork error</p>
<p>Invalid argument(s) to sbtopen</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e1054" headers="d94037e983">
<p>sbtclose</p>
</td>
<td class="cellalignment529" headers="d94037e1054 d94037e986">
<p>7020*</p>
<p>7021*</p>
<p>7022</p>
<p>7023</p>
<p>7024*</p>
<p>7025</p>
</td>
<td class="cellalignment552" headers="d94037e1054 d94037e989">
<p>Invalid file handle or file not open</p>
<p>Invalid flags to sbtclose</p>
<p>I/O error</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtclose</p>
<p>Can&#39;t connect with Media Manager</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e1084" headers="d94037e983">
<p>sbtwrite</p>
</td>
<td class="cellalignment529" headers="d94037e1084 d94037e986">
<p>7040*</p>
<p>7041</p>
<p>7042</p>
<p>7043</p>
<p>7044*</p>
</td>
<td class="cellalignment552" headers="d94037e1084 d94037e989">
<p>Invalid file handle or file not open</p>
<p>End of volume reached</p>
<p>I/O error</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtwrite</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e1110" headers="d94037e983">
<p>sbtread</p>
</td>
<td class="cellalignment529" headers="d94037e1110 d94037e986">
<p>7060*</p>
<p>7061</p>
<p>7062</p>
<p>7063</p>
<p>7064</p>
<p>7065*</p>
</td>
<td class="cellalignment552" headers="d94037e1110 d94037e989">
<p>Invalid file handle or file not open</p>
<p>EOF encountered</p>
<p>End of volume reached</p>
<p>I/O error</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtread</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e1140" headers="d94037e983">
<p>sbtremove</p>
</td>
<td class="cellalignment529" headers="d94037e1140 d94037e986">
<p>7080</p>
<p>7081</p>
<p>7082</p>
<p>7083</p>
<p>7084</p>
<p>7085</p>
<p>7086*</p>
</td>
<td class="cellalignment552" headers="d94037e1140 d94037e989">
<p>Backup file not found</p>
<p>Backup file in use</p>
<p>I/O Error</p>
<p>Can&#39;t connect with Media Manager</p>
<p>Permission denied</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtremove</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e1174" headers="d94037e983">
<p>sbtinfo</p>
</td>
<td class="cellalignment529" headers="d94037e1174 d94037e986">
<p>7090</p>
<p>7091</p>
<p>7092</p>
<p>7093</p>
<p>7094</p>
<p>7095*</p>
</td>
<td class="cellalignment552" headers="d94037e1174 d94037e989">
<p>Backup file not found</p>
<p>I/O Error</p>
<p>Can&#39;t connect with Media Manager</p>
<p>Permission denied</p>
<p>O/S error</p>
<p>Invalid argument(s) to sbtinfo</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d94037e1204" headers="d94037e983">
<p>sbtinit</p>
</td>
<td class="cellalignment529" headers="d94037e1204 d94037e986">
<p>7110*</p>
<p>7111</p>
</td>
<td class="cellalignment552" headers="d94037e1204 d94037e989">
<p>Invalid argument(s) to sbtinit</p>
<p>O/S error</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
</div>
<a id="BRADV89870"></a>
<div class="props_rev_3"><a id="GUID-018EEA85-F7B0-48EC-A688-FDF6B537CE3E"></a>
<h3 id="BRADV-GUID-018EEA85-F7B0-48EC-A688-FDF6B537CE3E" class="sect3">Interpreting RMAN Error Stacks</h3>
<div>
<div class="section">
<p><a id="d94037e1287" class="indexterm-anchor"></a><a id="d94037e1291" class="indexterm-anchor"></a><a id="d94037e1297" class="indexterm-anchor"></a>Sometimes <a id="d94037e1300" class="indexterm-anchor"></a>you may find it difficult to identify the useful messages in the RMAN error stack. Note the following tips and suggestions:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Read the messages from the bottom up, because this is the order in which RMAN issues the messages. The last one or two errors displayed in the stack are often the most informative.</p>
<p>Examples of RMAN error messages are provided in <a href="rcmtroub.htm#GUID-3F0A6F9D-1FD0-4507-8E2B-B1A205690BCC">Interpreting RMAN Errors: Example</a> and <a href="rcmtroub.htm#GUID-1143EB66-0ACB-4E32-9AC4-66031A889095">Interpreting Server Errors: Example</a>.</p>
</li>
<li>
<p>When you are using an SBT 1.1 media management layer and you are presented with SBT 1.1 style error messages containing the &#34;<code class="codeph">Additional information:</code>&#34; numeric error codes, look for the <code class="codeph">ORA-19511</code> message that follows for the text of error messages passed back to RMAN by the media manager. These messages identify the real failure in the media management layer.</p>
<p><a href="rcmtroub.htm#GUID-EB1FDC10-6B32-41DC-A1F5-B4EC149B2337">Interpreting SBT 2.0 Media Management Errors: Example</a> and <a href="rcmtroub.htm#GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87">Interpreting SBT 1.1 Media Management Errors: Example</a> provide examples of interpreting media management errors.</p>
</li>
<li>
<p>Look for the <code class="codeph">RMAN-03002</code> or <code class="codeph">RMAN-03009</code> message (<code class="codeph">RMAN-03009</code> equals <code class="codeph">RMAN-03002</code> but includes the channel ID), immediately following the error banner. These messages indicate which command failed. Syntax errors generate <code class="codeph">RMAN-00558</code>.</p>
</li>
<li>
<p>Identify the basic type of error according to the error range chart in <a href="rcmtroub.htm#GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E__g1014492" title="This table lists error number ranges associated with RMAN error messages and their likely causes.">Table 24-2</a> and then refer to <a class="olink ERRMG" target="_blank" href="../ERRMG/toc.htm"><span class="italic">Oracle Database Error Messages</span></a> for information about the most important messages.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="BRADV89871"></a>
<div class="props_rev_3"><a id="GUID-3F0A6F9D-1FD0-4507-8E2B-B1A205690BCC"></a>
<h4 id="BRADV-GUID-3F0A6F9D-1FD0-4507-8E2B-B1A205690BCC" class="sect4">Interpreting RMAN Errors: Example</h4>
<div>
<p>You attempt a backup of tablespace <code class="codeph">users</code> and receive the following message:</p>
<pre dir="ltr">Starting backup at 29-AUG-13
using channel ORA_DISK_1
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of backup command at 08/29/2013 15:14:03
RMAN-20202: tablespace not found in the recovery catalog
RMAN-06019: could not translate tablespace name &#34;USESR&#34;
</pre>
<p>The <code class="codeph">RMAN-03002</code> error indicates that the <code class="codeph">BACKUP</code> command failed. You read the last two messages in the stack first and immediately see the problem: no tablespace <code class="codeph">users</code> appears in the recovery catalog because you mistyped the name as <code class="codeph">usesr</code>.</p>
</div>
</div>
<a id="BRADV89872"></a>
<div class="props_rev_3"><a id="GUID-1143EB66-0ACB-4E32-9AC4-66031A889095"></a>
<h4 id="BRADV-GUID-1143EB66-0ACB-4E32-9AC4-66031A889095" class="sect4">Interpreting Server Errors: Example</h4>
<div>
<p>Assume that you attempt to recover a tablespace and receive the following errors:</p>
<pre dir="ltr">RMAN&gt; RECOVER TABLESPACE users;

Starting recover at 29-AUG-13
using channel ORA_DISK_1

starting media recovery
media recovery failed
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of recover command at 08/29/2013 15:18:43
RMAN-11003: failure during parse/execution of SQL statement: alter database recover if needed tablespace USERS
ORA-00283: recovery session canceled due to errors
ORA-01124: cannot recover data file 8 - file is in use or recovery
ORA-01110: data file 8: &#39;/oracle/oradata/trgt/users01.dbf&#39;
</pre>
<p>As suggested, you start reading from the bottom up. The <code class="codeph">ORA-01110</code> message explains there was a problem with the recovery of data file <code class="codeph">users01.dbf</code>. The second error indicates that the database cannot recover the data file because it is in use or being recovered. The remaining RMAN errors indicate that the recovery session was canceled due to the server errors. Hence, you conclude that because you were not recovering this data file, the problem must be that the data file is online and you must take it offline and restore a backup.</p>
</div>
</div>
<a id="BRADV89873"></a>
<div class="props_rev_3"><a id="GUID-EB1FDC10-6B32-41DC-A1F5-B4EC149B2337"></a>
<h4 id="BRADV-GUID-EB1FDC10-6B32-41DC-A1F5-B4EC149B2337" class="sect4">Interpreting SBT 2.0 Media Management Errors: Example</h4>
<div>
<p>Assume that you use a tape drive and see the following output during a backup job:</p>
<pre dir="ltr">RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
ORA-19624: operation failed, retry possible
ORA-19507: failed to retrieve sequential file, handle=&#34;/tmp/mydir&#34;, parms=&#34;&#34;
ORA-27029: skgfrtrv: sbtrestore returned error
ORA-19511: Error received from media manager layer, error text:
  sbtpvt_open_input:file /tmp/mydir does not exist or cannot be accessed, errno=2
</pre>
<p>The error text displayed following the <code class="codeph">ORA-19511</code> error is generated by the media manager and describes the real source of the failure. See the media manager documentation to interpret this error.</p>
</div>
</div>
<a id="BRADV89874"></a>
<div class="props_rev_3"><a id="GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87"></a>
<h4 id="BRADV-GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87" class="sect4">Interpreting SBT 1.1 Media Management Errors: Example</h4>
<div>
<p>Assume that you use a tape drive and see the following output during a backup job:</p>
<pre dir="ltr">RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03009: failure of backup command on c1 channel at 09/04/2013 13:18:19
ORA-19506: failed to create sequential file, name=&#34;07d36ecp_1_1&#34;, parms=&#34;&#34;
ORA-27007: failed to open file
SVR4 Error: 2: No such file or directory
Additional information: 7005
Additional information: 1
ORA-19511: Error received from media manager layer, error text:
   SBT error = 7005, errno = 2, sbtopen: system error
</pre>
<p>The main information of interest returned by SBT 1.1 media managers is the error code in the &#34;Additional information&#34; line:</p>
<pre dir="ltr">Additional information: 7005
</pre>
<p>Referring to <a href="rcmtroub.htm#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__g1014541" title="This table lists SBT 1.1 error message numbers and corresponding error text..">Table 24-3</a>, you discover that error <code class="codeph">7005</code> means that the media management device is busy. So, the media management software is not able to write to the device because it is in use or there is a problem with it.</p>
<div class="infobox-note" id="GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87__GUID-1818CCDC-CEC3-48D7-9538-864C5A0B3FDA">
<p class="notep1">Note:</p>
<p>The <code class="codeph">sbtio.log</code> contains information written by the media management software, <span class="italic">not</span> Oracle Database. Thus, you must consult your media vendor documentation to interpret the error codes and messages. If no information is written to the <code class="codeph">sbtio.log</code>, then contact your media manager support to ask whether they are writing error messages in some other location, or whether there are steps you must take to have the media manager errors appear in <code class="codeph">sbtio.log</code>.</p>
</div>
</div>
</div>
</div>
<a id="BRADV89875"></a>
<div class="props_rev_3"><a id="GUID-52F92FE9-4C46-4380-97CB-454E5C784E01"></a>
<h3 id="BRADV-GUID-52F92FE9-4C46-4380-97CB-454E5C784E01" class="sect3">Identifying RMAN Return Codes</h3>
<div>
<div class="section">
<p><a id="d94037e1787" class="indexterm-anchor"></a><a id="d94037e1791" class="indexterm-anchor"></a>One way to determine whether RMAN encountered an error is to examine its return code or exit status. The RMAN client returns 0 to the shell from which it was invoked if no errors occurred, and a nonzero error value otherwise.</p>
<p>How you access this return code depends upon the environment from which you invoked the RMAN client. For example, if you run UNIX with the C shell, then, when RMAN completes, the return code is placed in a shell variable called <code class="codeph">$status</code>. The method of returning exit status is a detail specific to the host operating system rather than the RMAN client.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV415"></a><a id="BRADV177"></a>
<div class="props_rev_3"><a id="GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB"></a>
<h2 id="BRADV-GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB" class="sect2">Using V$ Views for RMAN Troubleshooting</h2>
<div>
<p>When <code class="codeph">LIST</code>, <code class="codeph">REPORT</code>, and <code class="codeph">SHOW</code> do not provide all the information that you need for RMAN operations, some V$ views can provide useful details.</p>
<p><a id="d94037e1882" class="indexterm-anchor"></a><a id="d94037e1886" class="indexterm-anchor"></a><a id="d94037e1890" class="indexterm-anchor"></a><a id="d94037e1892" class="indexterm-anchor"></a>Sometimes it is useful to identify exactly what a server session performing a backup and recovery job is doing. The views described in <a href="rcmtroub.htm#GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB__CHDCJGIE" title="This table describes views that can assist in monitoring or obtaining information about RMAN jobs.">Table 24-4</a> are useful for obtaining information about RMAN jobs.</p>
<div class="tblformal" id="GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB__CHDCJGIE">
<p class="titleintable">Table 24-4 Useful V$ Views for Troubleshooting</p>
<table class="cellalignment515" title="Useful V$ Views for Troubleshooting" summary="This table describes views that can assist in monitoring or obtaining information about RMAN jobs.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment566" id="d94037e1914">View</th>
<th class="cellalignment567" id="d94037e1917">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment568" id="d94037e1922" headers="d94037e1914">
<p><code class="codeph">V$PROCESS</code></p>
</td>
<td class="cellalignment569" headers="d94037e1922 d94037e1917">
<p>Identifies currently active processes</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment568" id="d94037e1930" headers="d94037e1914">
<p><code class="codeph">V$SESSION</code></p>
</td>
<td class="cellalignment569" headers="d94037e1930 d94037e1917">
<p>Identifies currently active sessions. Use this view to determine which database server sessions correspond to which RMAN allocated channels.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment568" id="d94037e1938" headers="d94037e1914">
<p><code class="codeph">V$SESSION_WAIT</code></p>
</td>
<td class="cellalignment569" headers="d94037e1938 d94037e1917">
<p>Lists the events or resources for which sessions are waiting</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>You can use the preceding views to perform the following tasks:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtroub.htm#GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873">Monitoring RMAN Interaction with the Media Manager</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-A73F567C-1F2D-403B-BED9-90B78B4CA7CD">Correlating Server Sessions with RMAN Channels</a></p>
</li>
</ul>
</div>
<a id="BRADV89876"></a>
<div class="props_rev_3"><a id="GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873"></a>
<h3 id="BRADV-GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873" class="sect3">Monitoring RMAN Interaction with the Media Manager</h3>
<div>
<div class="section">
<p>You can use the event names in the dynamic performance event views to monitor RMAN calls to the media management API. The event names have one-to-one correspondence with SBT functions, as shown in the following examples:</p>
<pre dir="ltr">Backup: MML v1 open backup piece
Backup: MML v1 read backup piece
Backup: MML v1 write backup piece
Backup: MML v1 query backup piece
Backup: MML v1 delete backup piece
Backup: MML v1 close backup piece
.
.
.
</pre>
<p><a id="d94037e2032" class="indexterm-anchor"></a>To obtain the complete list of SBT events, you can use the following query:</p>
<pre dir="ltr">SELECT NAME 
FROM   V$EVENT_NAME 
WHERE  NAME LIKE &#39;%MML%&#39;;
</pre>
<p>Before making a call to any of functions in the media management API, the server adds a row in <code class="codeph">V$SESSION_WAIT</code>, with the <code class="codeph">STATE</code> column including the string <code class="codeph">WAITING</code>. <a id="d94037e2048" class="indexterm-anchor"></a>The <code class="codeph">V$SESSION_WAIT.SECONDS_IN_WAIT</code> column shows the number of seconds that the server has been waiting for this call to return. After an SBT function is returned from the media manager, this row disappears.</p>
<p>A row in <code class="codeph">V$SESSION_WAIT</code> corresponding to an SBT event name does not indicate a problem, because the server updates these rows at run time. The rows appear and disappear as calls are made and returned. However, if the <code class="codeph">SECONDS_IN_WAIT</code> column is high, then the media manager may be suspended.</p>
<p>To monitor the SBT events, you can run the following SQL query:</p>
<pre dir="ltr">COLUMN EVENT FORMAT a17
COLUMN SECONDS_IN_WAIT FORMAT 999
COLUMN STATE FORMAT a15
COLUMN CLIENT_INFO FORMAT a30

SELECT p.SPID, s.EVENT, s.SECONDS_IN_WAIT AS SEC_WAIT, 
       sw.STATE, s.CLIENT_INFO
FROM   V$SESSION_WAIT sw, V$SESSION s, V$PROCESS p
WHERE  sw.EVENT LIKE &#39;%MML%&#39;
AND    s.SID=sw.SID
AND    s.PADDR=p.ADDR;
</pre>
<p>Examine the SQL output to determine which SBT functions are waiting. For example, the following output indicates that RMAN has been waiting for the <code class="codeph">sbtbackup</code> function to return for 10 minutes:</p>
<pre dir="ltr">SPID EVENT             SEC_WAIT   STATE           CLIENT_INFO
---- ----------------- ---------- --------------- ------------------------------
8642 Backup: MML creat 600        WAITING         rman channel=ORA_SBT_TAPE_1
</pre>
<div class="infobox-note" id="GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873__GUID-163B8CB1-180E-484A-BE88-B3421F31A3E7">
<p class="notep1">Note:</p>
<p>The <code class="codeph">V$SESSION_WAIT</code> view shows only database events, not media manager events.</p>
</div>
<div class="infoboxnotealso" id="GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873__GUID-9D1639EC-F414-4E6E-8842-7D9C93C288B2">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN30229" target="_blank" href="../REFRN/GUID-4EDAB293-F3FC-40FE-BC75-4FEE6A4D7705.htm#REFRN30229"><span class="italic">Oracle Database Reference</span></a> for descriptions of the <code class="codeph">V$SESSION_WAIT</code> view.</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89877"></a>
<div class="props_rev_3"><a id="GUID-A73F567C-1F2D-403B-BED9-90B78B4CA7CD"></a>
<h3 id="BRADV-GUID-A73F567C-1F2D-403B-BED9-90B78B4CA7CD" class="sect3">Correlating Server Sessions with RMAN Channels</h3>
<div>
<p>To identify which server sessions correspond to which RMAN channels, you can <a id="d94037e2160" class="indexterm-anchor"></a><a id="d94037e2162" class="indexterm-anchor"></a>query <code class="codeph">V$SESSION</code> and <code class="codeph">V$PROCESS</code>. The <code class="codeph">SPID</code> column of <code class="codeph">V$PROCESS</code> identifies the operating system ID number for the process or thread. For example, on UNIX the <code class="codeph">SPID</code> column shows the process ID, whereas on Windows the <code class="codeph">SPID</code> column shows the thread ID. You have two basic methods for obtaining this information, depending on whether you have multiple RMAN sessions active concurrently.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtroub.htm#GUID-3324872D-0863-42B1-89A0-A576CDC8C3CA">Matching Server Sessions with Channels When One RMAN Session Is Active</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-CD0BD414-F561-4518-A2B3-4CCD36B7EBB1">Matching Server Sessions with Channels in Multiple RMAN Sessions</a></p>
</li>
</ul>
</div>
<a id="BRADV89878"></a>
<div class="props_rev_3"><a id="GUID-3324872D-0863-42B1-89A0-A576CDC8C3CA"></a>
<h4 id="BRADV-GUID-3324872D-0863-42B1-89A0-A576CDC8C3CA" class="sect4">Matching Server Sessions with Channels When One RMAN Session Is Active</h4>
<div>
<div class="section">
<p>When only one RMAN session is active, the easiest method for determining the server session ID for an RMAN channel is to execute the following query on the target database while the RMAN job is executing:</p>
<pre dir="ltr">COLUMN CLIENT_INFO FORMAT a30
COLUMN SID FORMAT 999
COLUMN SPID FORMAT 9999

SELECT s.SID, p.SPID, s.CLIENT_INFO
FROM   V$PROCESS p, V$SESSION s
WHERE  p.ADDR = s.PADDR
AND    CLIENT_INFO LIKE &#39;rman%&#39;;
</pre>
<p>The following shows sample output:</p>
<pre dir="ltr"> SID SPID         CLIENT_INFO
---- ------------ ------------------------------
  14 8374         rman channel=ORA_SBT_TAPE_1
</pre>
<p>If you set an ID using the RMAN <code class="codeph">SET COMMAND ID</code> command instead of using the system-generated default ID, then search for that value in the <code class="codeph">CLIENT_INFO</code> column instead of <code class="codeph">&#39;rman%&#39;</code>.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89879"></a>
<div class="props_rev_3"><a id="GUID-CD0BD414-F561-4518-A2B3-4CCD36B7EBB1"></a>
<h4 id="BRADV-GUID-CD0BD414-F561-4518-A2B3-4CCD36B7EBB1" class="sect4">Matching Server Sessions with Channels in Multiple RMAN Sessions</h4>
<div>
<div class="section">
<p>If multiple RMAN sessions are active, then the <code class="codeph">V$SESSION.CLIENT_INFO</code> column can yield the same information for a channel in each session. For example:</p>
<pre dir="ltr"> SID SPID         CLIENT_INFO
---- ------------ ------------------------------
  14 8374         rman channel=ORA_SBT_TAPE_1
   9 8642         rman channel=ORA_SBT_TAPE_1
</pre>
<p>In this case, you have the following methods for determining which channel corresponds to which <code class="codeph">SID</code> value.</p>
</div>
<!-- class="section" --></div>
<a id="BRADV89880"></a>
<div class="props_rev_3"><a id="GUID-B4AD9177-6648-426C-9978-26BEAD00FBB6"></a>
<h5 id="BRADV-GUID-B4AD9177-6648-426C-9978-26BEAD00FBB6" class="sect5">Obtaining the Channel ID from the RMAN Output</h5>
<div>
<div class="section">
<p>In this method, you must first obtain the <code class="codeph">sid</code> values from the RMAN output and then use these values in your SQL query.</p>
<p><span class="bold">To correlate a process with a channel during a backup:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>In an active session, run the RMAN job as usual and examine the output to get the SID for the channel. For example, the output may show:</span>
<div>
<pre dir="ltr">Starting backup at 21-AUG-13
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: sid=14 devtype=SBT_TAPE
</pre></div>
</li>
<li class="stepexpand"><span>Start a SQL*Plus session and then query the joined <code class="codeph">V$SESSION</code> and <code class="codeph">V$PROCESS</code> views <span class="italic">while the RMAN job is executing</span>. For example, enter:</span>
<div>
<pre dir="ltr">COLUMN CLIENT_INFO FORMAT a30
COLUMN SID FORMAT 999
COLUMN SPID FORMAT 9999

SELECT s.SID, p.SPID, s.CLIENT_INFO
FROM   V$PROCESS p, V$SESSION s
WHERE  p.ADDR = s.PADDR
AND    CLIENT_INFO LIKE &#39;rman%&#39;
/
</pre>
<p>Use the <code class="codeph">sid</code> value obtained from the first step to determine which channel corresponds to which server session:</p>
<pre dir="ltr">       SID SPID         CLIENT_INFO
---------- ------------ ------------------------------
        14 2036         rman channel=ORA_SBT_TAPE_1
        12 2066         rman channel=ORA_SBT_TAPE_1
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV89881"></a>
<div class="props_rev_3"><a id="GUID-21C49BC3-2505-481F-83B9-5474948614DF"></a>
<h5 id="BRADV-GUID-21C49BC3-2505-481F-83B9-5474948614DF" class="sect5">Correlating Server Sessions with Channels by Using SET COMMAND ID</h5>
<div>
<div class="section">
<p>In this method, you specify a command ID string in the RMAN backup script. You can then query <code class="codeph">V$SESSION.CLIENT_INFO</code> for this string.</p>
<p><span class="bold">To correlate a process with a channel during a backup:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>In each session, set the <code class="codeph">COMMAND</code> <code class="codeph">ID</code> to a different value <span class="italic">after</span> allocating the channels and then back up the desired object. For example, enter the following in session 1:</span>
<div>
<pre dir="ltr">RUN 
{
  ALLOCATE CHANNEL c1 TYPE disk;
  SET COMMAND ID TO &#39;sess1&#39;;
  BACKUP DATABASE;
}
</pre>
<p>Set the command ID to a string such as <code class="codeph">sess2</code> in the job running in session 2:</p>
<pre dir="ltr">RUN 
{
  ALLOCATE CHANNEL c1 TYPE sbt;
  SET COMMAND ID TO &#39;sess2&#39;;
  BACKUP DATABASE;
}
</pre></div>
</li>
<li class="stepexpand"><span>Start a SQL*Plus session and then query the joined <code class="codeph">V$SESSION</code> and <code class="codeph">V$PROCESS</code> views <span class="italic">while the RMAN job is executing</span>. For example, enter:</span>
<div>
<pre dir="ltr">SELECT SID, SPID, CLIENT_INFO 
FROM   V$PROCESS p, V$SESSION s 
WHERE  p.ADDR = s.PADDR 
AND    CLIENT_INFO LIKE &#39;%id=sess%&#39;;
</pre>
<p>If you run the <code class="codeph">SET</code> <code class="codeph">COMMAND</code> <code class="codeph">ID</code> command in the RMAN job, then the <code class="codeph">CLIENT_INFO</code> column displays in the following format:</p>
<pre dir="ltr">id=<span class="italic">command_id</span>,rman channel=<span class="italic">channel_id</span>
</pre>
<p>For example, the following shows sample output:</p>
<pre dir="ltr"> SID SPID         CLIENT_INFO
---- ------------ ------------------------------
  11 8358         id=sess1
  15 8638         id=sess2
  14 8374         id=sess1,rman channel=c1
   9 8642         id=sess2,rman channel=c1
</pre>
<p>The rows that contain the string <code class="codeph">rman channel</code> show the channel performing the backup. The remaining rows are for the connections to the target database.</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-21C49BC3-2505-481F-83B9-5474948614DF__GUID-80936436-48E3-41A5-AF39-C16A09EDC7BE">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF153" target="_blank" href="../RCMRF/rcmsynta2014.htm#RCMRF153"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">SET</code> <code class="codeph">COMMAND</code> <code class="codeph">ID</code> syntax, and <a class="olink REFRN" target="_blank" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for more information about <code class="codeph">V$SESSION</code> and <code class="codeph">V$PROCESS</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
</div>
<a id="BRADV175"></a>
<div class="props_rev_3"><a id="GUID-B1E9715D-BD07-4B80-8158-33981138E679"></a>
<h2 id="BRADV-GUID-B1E9715D-BD07-4B80-8158-33981138E679" class="sect2">Testing the Media Management API</h2>
<div>
<p><a id="d94037e2748" class="indexterm-anchor"></a><a id="d94037e2752" class="indexterm-anchor"></a>On some platforms, Oracle provides a diagnostic tool called <code class="codeph">sbttest</code>. This utility performs a simple test of the media management software by acting as the Oracle database server and attempting to communicate with the media manager.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtroub.htm#GUID-0780A6E4-4E5A-44CE-B083-F952597E72A7">Obtaining the sbttest Utility</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-E29B9686-2435-47D1-8619-5DA3B6232376">Obtaining Online Documentation for the sbttest Utility</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-9396687F-2BE5-4998-9DB1-BC5F8AB50ECC">Using the sbttest Utility</a></p>
</li>
</ul>
</div>
<a id="BRADV89882"></a>
<div class="props_rev_3"><a id="GUID-0780A6E4-4E5A-44CE-B083-F952597E72A7"></a>
<h3 id="BRADV-GUID-0780A6E4-4E5A-44CE-B083-F952597E72A7" class="sect3">Obtaining the sbttest Utility</h3>
<div>
<div class="section">
<p><a id="d94037e2848" class="indexterm-anchor"></a><a id="d94037e2852" class="indexterm-anchor"></a>On UNIX, the <code class="codeph">sbttest</code> utility is typically located in <code class="codeph">$ORACLE_HOME/bin</code>. If for some reason the utility is not included with your platform, then contact Oracle Support Services to obtain the C version of the program. You can compile this version of the program on all UNIX platforms.</p>
<p>On platforms such as Solaris, you do not have to relink when using <code class="codeph">sbttest</code>. On other platforms, relinking may be necessary.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89883"></a>
<div class="props_rev_3"><a id="GUID-E29B9686-2435-47D1-8619-5DA3B6232376"></a>
<h3 id="BRADV-GUID-E29B9686-2435-47D1-8619-5DA3B6232376" class="sect3">Obtaining Online Documentation for the sbttest Utility</h3>
<div>
<div class="section">
<p>For online documentation of <code class="codeph">sbttest</code>, issue the following on the command line:</p>
<pre dir="ltr">% sbttest
</pre>
<p>The program displays the list of possible arguments for the program:</p>
<pre dir="ltr">Error: backup file name must be specified
Usage: sbttest backup_file_name # this is the only required parameter
               &lt;-dbname database_name&gt;
               &lt;-trace trace_file_name&gt;
               &lt;-remove_before&gt;
               &lt;-no_remove_after&gt; 
               &lt;-read_only&gt;
               &lt;-no_regular_backup_restore&gt;
               &lt;-no_proxy_backup&gt;
               &lt;-no_proxy_restore&gt;
               &lt;-file_type n&gt;
               &lt;-copy_number n&gt;
               &lt;-media_pool n&gt;
               &lt;-os_res_size n&gt;
               &lt;-pl_res_size n&gt;
               &lt;-block_size block_size&gt; 
               &lt;-block_count block_count&gt;
               &lt;-proxy_file os_file_name bk_file_name 
                           [os_res_size pl_res_size block_size block_count]&gt;
               &lt;-libname sbt_library_name&gt;
</pre>
<p>The display also indicates the meaning of each argument. For example, following is the description for two optional parameters:</p>
<pre dir="ltr">Optional parameters:
  -dbname  specifies the database name which will be used by SBT
           to identify the backup file. The default is &#34;sbtdb&#34;
  -trace   specifies the name of a file where the Media Management 
           software will write diagnostic messages.
</pre></div>
<!-- class="section" --></div>
</div>
<a id="BRADV89884"></a>
<div class="props_rev_3"><a id="GUID-9396687F-2BE5-4998-9DB1-BC5F8AB50ECC"></a>
<h3 id="BRADV-GUID-9396687F-2BE5-4998-9DB1-BC5F8AB50ECC" class="sect3">Using the sbttest Utility</h3>
<div>
<div class="section">
<p>Use <code class="codeph">sbttest</code> to perform a quick test of the media manager.</p>
<p>If <code class="codeph">sbttest</code> returns 0, then the test ran without error, which means that the media manager is correctly installed and can accept a data stream and return the same data when requested. If <code class="codeph">sbttest</code> returns a nonzero value, then either the media manager is not installed or it is not configured correctly.</p>
<p><span class="bold">To use sbttest:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Confirm that the program is installed and included in the system path by typing <code class="codeph">sbttest</code> at the command line:</span>
<div>
<pre dir="ltr">% sbttest
</pre>
<p>If the program is operational, then you see a display of the online documentation.</p>
</div>
</li>
<li class="stepexpand"><span>Execute the program, specifying any of the arguments described in the online documentation. For example, enter the following to create test file <code class="codeph">some_file.f</code> and write the output to <code class="codeph">sbtio.log</code>:</span>
<div>
<pre dir="ltr">% sbttest some_file.f -trace sbtio.log
</pre>
<p>You can also test a backup of an existing data file. For example, this command tests data file <code class="codeph">tbs_33.f</code> of database <code class="codeph">prod</code>:</p>
<pre dir="ltr">% sbttest tbs_33.f -dbname prod
</pre></div>
</li>
<li class="stepexpand"><span>Examine the output. If the program encounters an error, then it provides messages describing the failure. For example, if the database cannot find the library, you see:</span>
<div>
<pre dir="ltr">libobk.so could not be loaded. Check that it is installed properly, and that
 LD_LIBRARY_PATH environment variable (or its equivalent on your platform)
 includes the directory where this file can be found. Here is some additional
 information on the cause of this error:
ld.so.1: sbttest: fatal: libobk.so: open failed: No such file or directory
</pre></div>
</li>
</ol>
<div class="section">
<p>In some cases, <code class="codeph">sbttest</code> can work but an RMAN backup does not. The reasons can be the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>The user who starts <code class="codeph">sbttest</code> is not the owner of the Oracle Database processes.</p>
</li>
<li>
<p>If the database server is not linked with the media management library or cannot load it dynamically when needed, then RMAN backups to the media manager fail, but <code class="codeph">sbttest</code> may still work.</p>
</li>
<li>
<p>The <code class="codeph">sbttest</code> program passes all environment parameters from the shell but RMAN does not.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV176"></a>
<div class="props_rev_3"><a id="GUID-772C8583-7763-48AB-B404-747188EC718A"></a>
<h2 id="BRADV-GUID-772C8583-7763-48AB-B404-747188EC718A" class="sect2">Terminating an RMAN Command</h2>
<div>
<div class="section">
<p><a id="d94037e3171" class="indexterm-anchor"></a><a id="d94037e3175" class="indexterm-anchor"></a><a id="d94037e3179" class="indexterm-anchor"></a><a id="d94037e3181" class="indexterm-anchor"></a><a id="d94037e3185" class="indexterm-anchor"></a><a id="d94037e3189" class="indexterm-anchor"></a>There are several ways to terminate an RMAN command in the middle of execution:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The preferred method is to press Ctrl+C (or the equivalent &#34;attention&#34; key combination for your system) in the RMAN interface. This also terminates allocated channels, unless they are suspended in the media management code, as happens when, for example, they are waiting for a tape to be mounted.</p>
</li>
<li>
<p>You can end the server session corresponding to the RMAN channel by running the SQL <code class="codeph">ALTER</code> <code class="codeph">SYSTEM KILL SESSION</code> statement as described in <a href="rcmtroub.htm#GUID-73F87310-9DDF-4775-9049-658E0A06BADC">Terminating the Session with ALTER SYSTEM KILL SESSION</a>.</p>
</li>
<li>
<p>You can terminate the server session corresponding to the RMAN channel on the operating system as described in <a href="rcmtroub.htm#GUID-4C499544-02C9-40AA-94DC-03261D7F2B3E">Terminating the Session at the Operating System Level</a>.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="BRADV89885"></a>
<div class="props_rev_3"><a id="GUID-73F87310-9DDF-4775-9049-658E0A06BADC"></a>
<h3 id="BRADV-GUID-73F87310-9DDF-4775-9049-658E0A06BADC" class="sect3">Terminating the Session with ALTER SYSTEM KILL SESSION</h3>
<div>
<div class="section">
<p>You can identify the Oracle session ID for an RMAN channel by looking in the RMAN log for messages with the format shown in the following example:</p>
<pre dir="ltr">channel ch1: sid=15 devtype=SBT_TAPE
</pre>
<p>The <code class="codeph">sid</code> and <code class="codeph">devtype</code> are displayed for each allocated channel. The Oracle Database <code class="codeph">sid</code> is different from the operating system process ID. You can end the session using a SQL <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">KILL</code> <code class="codeph">SESSION</code> statement.</p>
<p><code class="codeph">ALTER SYSTEM KILL SESSION</code> takes two arguments, the <code class="codeph">sid</code> printed in the RMAN message and a serial number, both of which can be obtained by querying <code class="codeph">V$SESSION</code>. For example, run the following statement, where <span class="italic"><code class="codeph">sid_in_rman_output</code></span> is the number from the RMAN message:</p>
<pre dir="ltr">SELECT SERIAL# 
FROM   V$SESSION 
WHERE  SID=<span class="italic">sid_in_rman_output</span>;
</pre>
<p><a id="d94037e3335" class="indexterm-anchor"></a>Then, run the following statement, substituting the <span class="italic"><code class="codeph">sid_in_rman_output</code></span> and serial number obtained from the query:</p>
<pre dir="ltr">ALTER SYSTEM KILL SESSION &#39;<span class="italic">sid_in_rman_output</span><span class="italic">,</span><span class="italic">serial#</span>&#39;;
</pre>
<p>This statement has no effect on the session if the session stopped in media manager code.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89886"></a>
<div class="props_rev_3"><a id="GUID-4C499544-02C9-40AA-94DC-03261D7F2B3E"></a>
<h3 id="BRADV-GUID-4C499544-02C9-40AA-94DC-03261D7F2B3E" class="sect3">Terminating the Session at the Operating System Level</h3>
<div>
<p>Finding and terminating the processes that are associated with the server sessions is operating system-specific. On some platforms, the server sessions are not associated with any processes at all. See your operating system-specific documentation for more information.</p>
</div>
</div>
<a id="BRADV89887"></a>
<div class="props_rev_3"><a id="GUID-60B8AE45-4484-4926-811F-BBCA23CB19D2"></a>
<h3 id="BRADV-GUID-60B8AE45-4484-4926-811F-BBCA23CB19D2" class="sect3">Terminating an RMAN Session That Is Not Responding in the Media Manager</h3>
<div>
<p>You may sometimes need to terminate an RMAN job that is not responding in the media manager. The best way to terminate RMAN when the channel connections are not responding in the media manager is to terminate the session in the media manager. If this action does not solve the problem, then on some platforms, such as Linux, you may be able to terminate the Oracle Database processes of the connections. (Terminating the Oracle processes may cause problems with the media manager. See your media manager documentation for details.)</p>
<div class="p">This section contains the following topics:
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtroub.htm#GUID-56D3592A-B975-4DAE-A02C-6E6693C3D471">Components of an RMAN Session</a></p>
</li>
<li>
<p><a href="rcmtroub.htm#GUID-4C2B84BF-D7FA-4137-B31C-8D02E5100405">Process Behavior During a Suspended Job</a></p>
</li>
<li><a href="rcmtroub.htm#GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B">Terminating an RMAN Session: Basic Steps</a></li>
</ul>
</div>
</div>
<a id="BRADV89888"></a>
<div class="props_rev_3"><a id="GUID-56D3592A-B975-4DAE-A02C-6E6693C3D471"></a>
<h4 id="BRADV-GUID-56D3592A-B975-4DAE-A02C-6E6693C3D471" class="sect4">Components of an RMAN Session</h4>
<div>
<p>The nature of an RMAN session depends on the operating system. In UNIX, an RMAN session has the following processes associated with it:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <span class="italic">RMAN client process</span> itself</p>
</li>
<li>
<p>The <span class="italic">default channel</span>, the initial connection to the target database</p>
</li>
<li>
<p>One <span class="italic">target connection</span> to the target database corresponding to each allocated channel</p>
</li>
<li>
<p>The <span class="italic">catalog connection</span> to the recovery catalog database, if you use a recovery catalog</p>
</li>
<li>
<p>An <span class="italic">auxiliary connection</span> to an auxiliary instance, during <code class="codeph">DUPLICATE</code> or TSPITR operations</p>
</li>
<li>
<p>A <span class="italic">polling connection</span> to the target database, used for monitoring RMAN command execution on the various allocated channels. By default, RMAN makes one polling connection. RMAN makes additional polling connections if you use different connect strings in the <code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code> or <code class="codeph">CONFIGURE</code> <code class="codeph">CHANNEL</code> commands. One polling connection exists for each distinct connect string used in the <code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code> or <code class="codeph">CONFIGURE</code> <code class="codeph">CHANNEL</code> command.</p>
</li>
</ul>
</div>
</div>
<a id="BRADV89889"></a>
<div class="props_rev_3"><a id="GUID-4C2B84BF-D7FA-4137-B31C-8D02E5100405"></a>
<h4 id="BRADV-GUID-4C2B84BF-D7FA-4137-B31C-8D02E5100405" class="sect4">Process Behavior During a Suspended Job</h4>
<div>
<p>RMAN usually stops responding because a channel connection is waiting in the media manager code for a tape resource. The catalog connection and the default channel appear to suspend, because they are waiting for RMAN to tell them what to do. Polling connections seem to be in an infinite loop while polling the RPC under the control of the RMAN process.</p>
<p>If you terminate the RMAN process itself, then you also terminate the catalog connection, the auxiliary connection, the default channel, and the polling connections. If target and auxiliary connections are suspended but not while executing media manager code, they also terminate. If either the target connection or any of the auxiliary connections are executing in the media management layer, then they do not terminate until the processes are manually terminated at the operating system level.</p>
<p>Not all media managers can detect the termination of the Oracle Database process. Those which cannot may keep resources busy or continue processing. Consult your media manager documentation for details.</p>
<p>Terminating the catalog connection does not cause the RMAN process to terminate because RMAN is not performing catalog operations while the backup or restore is in progress. Removing default channel and polling connections causes the RMAN process to detect that a channel is no longer present and then to exit. In this case, the connections to the unresponsive channels remain active as described previously.</p>
</div>
</div>
<a id="BRADV89890"></a>
<div class="props_rev_3"><a id="GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B"></a>
<h4 id="BRADV-GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B" class="sect4">Terminating an RMAN Session: Basic Steps</h4>
<div>
<div class="section">
<p>After the unresponsive channels in the media manager code are terminated, the RMAN process detects this termination and exits, removing all connections except target connections that are still operative in the media management layer. The warning about the media manager resources still applies in this case.</p>
<p><span class="bold">To terminate an Oracle Database process that is not responding in the media manager:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Query <code class="codeph">V$SESSION</code> and <code class="codeph">V$SESSION_WAIT</code> as described in <span class="q">&#34;<a href="rcmtroub.htm#GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB">Using V$ Views for RMAN Troubleshooting</a>&#34;</span>. For example, execute the following query:</span>
<div>
<pre dir="ltr">COLUMN EVENT FORMAT a17
COLUMN SECONDS_IN_WAIT FORMAT 999
COLUMN STATE FORMAT a10
COLUMN CLIENT_INFO FORMAT a30

SELECT p.SPID, s.EVENT, s.SECONDS_IN_WAIT AS SEC_WAIT, 
       sw.STATE, s.CLIENT_INFO
FROM   V$SESSION_WAIT sw, V$SESSION s, V$PROCESS p
WHERE  sw.EVENT LIKE &#39;%MML%&#39;
AND    s.SID=sw.SID
AND    s.PADDR=p.ADDR;
</pre>
<p>Examine the SQL output to determine which SBT functions are waiting. For example, the output may be as follows:</p>
<pre dir="ltr">SPID EVENT             SEC_WAIT   STATE      CLIENT_INFO
---- -----------------  ---------- ---------- -----------------------------
8642 Backup:MML write   600        WAITING    rman channel=ORA_SBT_TAPE_1
8374 Backup:MML write   600        WAITING    rman channel=ORA_SBT_TAPE_2
</pre></div>
</li>
<li class="stepexpand"><span>Using operating system-level tools appropriate to your platform, end the unresponsive sessions. For example, on Linux execute a <code class="codeph">kill</code> <code class="codeph">-9</code> command:</span>
<div>
<pre dir="ltr">% kill -9 8642 8374
</pre>
<p>Some platforms include a command-line utility called <code class="codeph">orakill</code> that enables you to terminate a specific thread. From a command prompt, run the following command, where <span class="italic"><code class="codeph">sid</code></span> identifies the database instance to target, and the <span class="italic"><code class="codeph">thread_id</code></span> is the <code class="codeph">SPID</code> value from the query in Step 1:</p>
<pre dir="ltr">orakill <span class="italic">sid</span> <span class="italic">thread_id</span>
</pre></div>
</li>
<li class="stepexpand"><span>Check that the media manager also clears its processes. If any remain, the next backup or restore operation may freeze again, due to the previous problems in the backup or restore operation. In some media managers, the only solution is to shut down and restart the media manager. If the documentation from the media manager does not provide the needed information, contact technical support for the media manager.</span>
<div>
<div class="infoboxnotealso" id="GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B__GUID-779D91FE-19C1-4007-9A50-04351F833C75">
<p class="notep1">See Also:</p>
<p>Your operating system-specific documentation for the relevant commands</p>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="rcmtunin.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="part_tra.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>