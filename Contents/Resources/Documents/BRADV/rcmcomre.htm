<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2667"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Performing%20Complete%20Database%20Recovery"></a><title>Performing Complete Database Recovery</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="recovery, database, complete, backup encryption, decrypting backups, encrypted backups, decrypting, CDBs, complete restore, PDBs, root, complete recovery, using RMAN, CDBs using Oracle Enterprise Manager Cloud Control, using Oracle Enterprise Manager Cloud Control, tablespaces in PDBs, tablespaces, data files in PDBs, data files, recovering in PDBs, using Cloud Control, tablespaces in PDBs using Cloud Control, after switching to a copy"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rcmvalid.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rcmflash.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-D908719C-9D46-4084-850C-0F81C25094EB"></a> <span id="PAGE" style="display:none;">29/48</span> <!-- End Header -->
<a id="BRADV8005"></a>
<h1 id="BRADV-GUID-D908719C-9D46-4084-850C-0F81C25094EB" class="sect1"><span class="enumeration_chapter">17</span> Performing Complete Database Recovery</h1>
<div>
<p>This chapter explains how to use RMAN to return your database to normal operation after the loss of one or more data files. This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D">Overview of Complete Database Recovery</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7">Preparing for Complete Database Recovery</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25">Performing Complete Database Recovery</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-1F744C63-2D4C-4F65-8773-1340A85993ED">Performing Complete Recovery of CDBs</a></p>
</li>
</ul>
</div>
<a id="BRADV89759"></a>
<div class="props_rev_3"><a id="GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D"></a>
<h2 id="BRADV-GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D" class="sect2">Overview of Complete Database Recovery</h2>
<div>
<p><a id="d69736e166" class="indexterm-anchor"></a><a id="d69736e170" class="indexterm-anchor"></a>This section explains the purpose of complete restore and recovery of the database and specifies the scope of the chapter.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208">Purpose of Complete Database Recovery</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075">Scope of This Chapter</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED">About Real-Time Redo Transport for Recovery Appliance</a></p>
</li>
</ul>
</div>
<a id="BRADV89760"></a>
<div class="props_rev_3"><a id="GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208"></a>
<h3 id="BRADV-GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208" class="sect3">Purpose of Complete Database Recovery</h3>
<div>
<p>This chapter assumes that some or all of your data files are lost or damaged. Typically, this situation is caused by a media failure or accidental deletion. Your goal is to return the database to normal operation by restoring the damaged files from RMAN backups and recovering all database changes.</p>
</div>
</div>
<a id="BRADV89761"></a>
<div class="props_rev_3"><a id="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075"></a>
<h3 id="BRADV-GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" class="sect3">Scope of This Chapter</h3>
<div>
<p>This chapter explains how to use complete recovery to fix the most common database problems. This chapter makes the following assumptions:</p>
<ul style="list-style-type: disc;">
<li>
<p>You have lost some or all data files and your goal is to recover all changes, but you have not lost all current control files or an entire online redo log group.</p>
<p><a href="rcmflash.htm#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B">Performing Flashback and Database Point-in-Time Recovery</a> explains how to recover some but not all database changes. <a href="osadvsce.htm#GUID-24903185-E2CE-452E-8370-E4A47AD2632B">Performing User-Managed Recovery: Advanced Scenarios</a> explains how to respond when some but not all current control files or members of an online redo log group are lost. <span class="q">&#34;<a href="rcmadvre.htm#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6">Performing Recovery with a Backup Control File</a>&#34;</span> explains how to recover the database when all control files are lost.</p>
</li>
<li>
<p>Your database is using the current server parameter file.</p>
<p>To restore a backup server parameter file, see <span class="q">&#34;<a href="rcmadvre.htm#GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD">Restoring the Server Parameter File</a>&#34;</span>.</p>
</li>
<li>
<p>You have the complete set of archived redo logs and incremental backups needed for recovery of your data file backups. Every data file either has a backup, or a complete set of online and archived redo logs goes back to the creation of a data file with no backup.</p>
<p>RMAN can handle lost data files without user intervention during restore and recovery. When a data file is lost, the possible cases can be classified as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>The control file knows about the data file, that is, you backed up the control file after data file creation, but the data file itself is not backed up. If the data file record is in the control file, then <code class="codeph">RESTORE</code> creates the data file in the original location or in a user-specified location. The <code class="codeph">RECOVER</code> command can then apply the necessary logs to the data file.</p>
</li>
<li>
<p>The control file does not have the data file record, that is, you did not back up the control file after data file creation. During recovery, the database detects the missing data file and reports it to RMAN, which creates a data file and continues recovery by applying the remaining logs. If the data file was created in a parent incarnation, then it is created during the restore or recovery phase as appropriate.</p>
</li>
</ul>
</li>
<li>
<p>You are not restoring and recovering an encrypted tablespace.</p>
<p>If you perform media recovery on an encrypted tablespace, then the Oracle keystore must be open when performing media recovery of this tablespace. See <a class="olink ADMIN12327" target="_blank" href="../ADMIN/tspaces.htm#ADMIN12327"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> to learn about encrypted tablespaces.</p>
</li>
<li>
<p>Your database runs in a single-instance configuration.</p>
<p>Although RMAN can restore and recover databases in Oracle RAC and Data Guard configurations, these scenarios are beyond the scope of this manual.</p>
</li>
<li>
<p>You are using the RMAN client rather than Oracle Enterprise Manager.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075__GUID-D9BB73C3-1D7F-401F-BA2D-A01C561EB90E">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RACAD059" target="_blank" href="../RACAD/GUID-A02120B2-BE62-4172-B402-BF034566E471.htm#RACAD059"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for more information about using RMAN with Oracle RAC</p>
</li>
<li>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for more information about using RMAN with Data Guard</p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmintro.htm#GUID-84BE3AC7-E2E4-4897-A3D8-D4105D033E9C">RMAN and Oracle Enterprise Manager Cloud Control</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV771"></a>
<div class="props_rev_3"><a id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED"></a>
<h3 id="BRADV-GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" class="sect3">About Real-Time Redo Transport for Recovery Appliance</h3>
<div>
<p>With <a href="glossary.htm#GUID-238433D1-4ED8-412E-978F-24197B953D94"><span class="xrefglossterm">Zero Data Loss Recovery Appliance (Recovery Appliance)</span></a>, the window of potential data loss that exists between successive archived log backups can be substantially reduced. Real-time redo transport enables you to recover target databases up to within a few seconds of a database failure.</p>
<div class="infobox-note" id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED__GUID-C6B2C8EB-B044-47B1-AF6B-CB809D07198C">
<p class="notep1">Note:</p>
<p>Real-time redo transport can be used only with Recovery Appliance.</p>
</div>
<p>When real-time redo transport is configured for a target database, redo data from the current redo log groups is written asynchronously to Recovery Appliance as it is generated. As the redo stream is received, it is stored as a complete RMAN archived redo log. If the target database crashes, the redo data received from the current redo log group, until the time of the crash, is used during restore and recovery operations.</p>
<p>You must perform certain configuration steps to enable real-time redo transport for the target database.</p>
<div class="infoboxnotealso" id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED__GUID-A15CCA6C-7FAB-4BA9-8EBE-2C616C0A0D91">
<p class="notep1">See Also:</p>
<p><a class="olink AMPDB732" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=AMPDB732"><span class="italic">Zero Data Loss Recovery Appliance Protected Database Configuration Guide</span></a> for the steps to configure real-time redo transport</p>
</div>
</div>
</div>
</div>
<a id="BRADV89762"></a>
<div class="props_rev_3"><a id="GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7"></a>
<h2 id="BRADV-GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" class="sect2">Preparing for Complete Database Recovery</h2>
<div>
<p>Although RMAN simplifies most database restore and recovery tasks, you must still plan your database restore and recovery strategy based on which database files have been lost and your recovery goal. This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-76EF94C5-605E-4BC2-B710-08B990180223">Identifying the Database Files to Restore or Recover</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865">Determining the DBID of the Database</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-8837082E-3409-4D00-9836-3B9617720349">Previewing Backups Used in Restore Operations</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE">Validating Backups Before Restoring Them</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469">Restoring Archived Redo Logs Needed for Recovery</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-0A087440-D046-4995-9A00-BBA9C5D3750C">Providing the Password Required to Decrypt Encrypted Backups</a></p>
</li>
</ul>
</div>
<a id="BRADV89763"></a>
<div class="props_rev_3"><a id="GUID-76EF94C5-605E-4BC2-B710-08B990180223"></a>
<h3 id="BRADV-GUID-76EF94C5-605E-4BC2-B710-08B990180223" class="sect3">Identifying the Database Files to Restore or Recover</h3>
<div>
<p>The techniques for determining which files require restore or recovery depend upon the type of file that is lost.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE">Identifying a Lost Control File</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8">Identifying Data Files Requiring Media Recovery</a></p>
</li>
</ul>
</div>
<a id="BRADV89764"></a>
<div class="props_rev_3"><a id="GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE"></a>
<h4 id="BRADV-GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE" class="sect4">Identifying a Lost Control File</h4>
<div>
<p>It is usually obvious when the control file of your database is lost. The database shuts down immediately when any of the <a id="d69736e762" class="indexterm-anchor"></a><a id="d69736e766" class="indexterm-anchor"></a>multiplexed control files become inaccessible. Also, the database reports an error if you try to start it without a valid control file at each location specified in the <code class="codeph">CONTROL_FILES</code> initialization parameter.</p>
<p>Loss of some but not all copies of your control file does not require you to restore a control file from backup. If at least one control file remains intact, then you can either copy an intact copy of the control file over the damaged or missing control file, or update the initialization parameter file so that it does not refer to the damaged or missing control file. After the <code class="codeph">CONTROL_FILES</code> parameter references only present, intact copies of the control file, you can restart your database.</p>
<p>If you restore the control file from backup, then you must perform media recovery of the whole database and then open it with the <code class="codeph">OPEN RESETLOGS</code> option, even if no data files must be restored. This technique is described in <span class="q">&#34;<a href="rcmadvre.htm#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6">Performing Recovery with a Backup Control File</a>&#34;</span>.</p>
</div>
</div>
<a id="BRADV89765"></a>
<div class="props_rev_3"><a id="GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8"></a>
<h4 id="BRADV-GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8" class="sect4">Identifying Data Files Requiring Media Recovery</h4>
<div>
<p><a id="d69736e856" class="indexterm-anchor"></a><a id="d69736e860" class="indexterm-anchor"></a><a id="d69736e862" class="indexterm-anchor"></a>When <a id="d69736e867" class="indexterm-anchor"></a>and how to recover depends on the state of the database and the location of its data files.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29">Identifying Data Files with RMAN</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC">Identifying Data Files with SQL</a></p>
</li>
</ul>
</div>
<a id="BRADV350"></a><a id="BRADV89766"></a>
<div class="props_rev_3"><a id="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29"></a>
<h5 id="BRADV-GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29" class="sect5">Identifying Data Files with RMAN</h5>
<div>
<div class="section">
<p>An easy technique for determining which data files are missing is to run <a id="d69736e957" class="indexterm-anchor"></a>a <code class="codeph">VALIDATE DATABASE</code> command, which attempts to read all specified data files. <a href="rcmcomre.htm#GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29__CHDICCBB">Example 17-1</a> validates the database (sample output included).</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29__CHDICCBB">
<p class="titleinexample">Example 17-1 VALIDATE DATABASE</p>
<pre dir="ltr">RMAN&gt; VALIDATE DATABASE;

Starting validate at 20-OCT-13
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=90 device type=DISK
could not read file header for datafile 7 error reason 4
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of backup command at 10/20/2013 13:05:43
RMAN-06056: could not access datafile 7
</pre>
<div class="p">The output of <a href="rcmcomre.htm#GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29__CHDICCBB">Example 17-1</a> indicates that data file 7 is inaccessible. You can then run the <code class="codeph">REPORT SCHEMA</code> command to obtain the tablespace name and file name for data file 7 as follows (sample output included):
<pre dir="ltr">RMAN&gt; REPORT SCHEMA;
 
Report of database schema for database with db_unique_name RDBMS
 
List of Permanent Datafiles
===========================
File Size(MB) Tablespace           RB segs Datafile Name
---- -------- -------------------- ------- ------------------------
1    450      SYSTEM               ***     +DATAFILE/tbs_01.f
2    86       SYSAUX               ***     +DATAFILE/tbs_ax1.f
3    15       UD1                  ***     +DATAFILE/tbs_undo1.f
4    2        SYSTEM               ***     +DATAFILE/tbs_02.f
5    2        TBS_1                ***     +DATAFILE/tbs_11.f
6    2        TBS_1                ***     +DATAFILE/tbs_12.f
7    2        TBS_2                ***     +DATAFILE/tbs_21.f
 
List of Temporary Files
=======================
File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
---- -------- -------------------- ----------- --------------------
1    40       TEMP                 32767       +DATAFILE/tbs_tmp1.f
</pre></div>
</div>
<!-- class="example" --></div>
</div>
<a id="BRADV351"></a><a id="BRADV89767"></a>
<div class="props_rev_3"><a id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC"></a>
<h5 id="BRADV-GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC" class="sect5">Identifying Data Files with SQL</h5>
<div>
<div class="section">
<p>Although <code class="codeph">VALIDATE DATABASE</code> is a good technique for determining whether files are inaccessible, you may want to use SQL queries to obtain more detailed information.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To determine whether data files require media recovery:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect to the target database instance with administrator privileges.</span></li>
<li class="stepexpand"><span>Determine the status of the database by executing the following SQL <a id="d69736e1064" class="indexterm-anchor"></a>query:</span>
<div>
<pre dir="ltr">SELECT STATUS FROM V$INSTANCE;
</pre>
<p>If the status is <code class="codeph">OPEN</code>, then the database is open. Nevertheless, some data files may require media recovery.</p>
</div>
</li>
<li class="stepexpand"><span><a id="d69736e1077" class="indexterm-anchor"></a>Query <code class="codeph">V$DATAFILE_HEADER</code> to determine the status of your data files. Run the following SQL statements to check the data file headers:</span>
<div>
<pre dir="ltr">SELECT FILE#, STATUS, ERROR, RECOVER, TABLESPACE_NAME, NAME 
FROM   V$DATAFILE_HEADER 
WHERE  RECOVER = &#39;YES&#39; 
OR     (RECOVER IS NULL AND ERROR IS NOT NULL);
</pre>
<p>Each row returned represents a data file that either requires media recovery or has an error requiring a restore. Check the <code class="codeph">RECOVER</code> and <code class="codeph">ERROR</code> columns. <code class="codeph">RECOVER</code> indicates whether a file needs media recovery, and <code class="codeph">ERROR</code> indicates whether there was an error reading and validating the data file header.</p>
<p>If <code class="codeph">ERROR</code> is not <code class="codeph">NULL</code>, then the data file header cannot be read and validated. Check for a temporary hardware or operating system problem causing the error. If there is no such problem, then you must restore the file or switch to a copy.</p>
<p>If the <code class="codeph">ERROR</code> column is <code class="codeph">NULL</code> and the <code class="codeph">RECOVER</code> column is <code class="codeph">YES</code>, then the file requires media recovery (and may also require a restore from backup).</p>
<div class="infobox-note" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-76A234C5-4DA5-4CBF-9775-0567B66BF8AA">
<p class="notep1">Note:</p>
<p>Because <code class="codeph">V$DATAFILE_HEADER</code> <a id="d69736e1128" class="indexterm-anchor"></a>only reads the header block of each data file, it does not detect all problems that require the data file to be restored. For example, this view cannot tell whether a data file contains corrupt data blocks.</p>
</div>
</div>
</li>
<li class="stepexpand"><span><a id="d69736e1133" class="indexterm-anchor"></a>Optionally, query <code class="codeph">V$RECOVER_FILE</code> to list data files requiring recovery by data file number with their status and error information. For example, execute the following query:</span>
<div>
<pre dir="ltr">SELECT FILE#, ERROR, ONLINE_STATUS, CHANGE#, TIME 
FROM   V$RECOVER_FILE;
</pre>
<div class="infobox-note" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-E07311E9-881B-4642-839F-22F56276324B">
<p class="notep1">Note:</p>
<p>You cannot use <code class="codeph">V$RECOVER_FILE</code> with a control file restored from backup or a control file that was re-created after the time of the media failure affecting the data files. A restored or re-created control file does not contain the information needed to update <code class="codeph">V$RECOVER_FILE</code> accurately.</p>
</div>
<p>To find data file and tablespace names, you can also perform joins using the data file number and <a id="d69736e1153" class="indexterm-anchor"></a><a id="d69736e1155" class="indexterm-anchor"></a>the <code class="codeph">V$DATAFILE</code> and <code class="codeph">V$TABLESPACE</code> views, as shown in the following example.</p>
<pre dir="ltr">SELECT r.FILE# AS df#, d.NAME AS df_name, t.NAME AS tbsp_name, 
       d.STATUS, r.ERROR, r.CHANGE#, r.TIME
FROM V$RECOVER_FILE r, V$DATAFILE d, V$TABLESPACE t
WHERE t.TS# = d.TS#
AND d.FILE# = r.FILE#;
</pre>
<p>The <code class="codeph">ERROR</code> column identifies the problem for each file requiring recovery.</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-8EBFAF64-9D59-4CA5-BB26-F971BF659B80">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN" target="_blank" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for information about the <code class="codeph">V$</code> views</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<a id="BRADV80002"></a>
<div class="props_rev_3"><a id="GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865"></a>
<h3 id="BRADV-GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" class="sect3">Determining the DBID of the Database</h3>
<div>
<div class="section">
<p><a id="d69736e1252" class="indexterm-anchor"></a>In situations requiring the recovery of your server parameter file or control file from autobackup, you must know the DBID. Be sure to record the DBID along with other basic information about your database.</p>
<p>If you do not have a record of the DBID of your database, then you can find it in the following places without opening your database:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The DBID is used in forming the file name for the control file autobackup. Locate this file, and then refer to <span class="q">&#34;<a href="rcmconfb.htm#GUID-C64AE090-0749-43EA-92C4-69DC6201A15F">Configuring the Control File Autobackup Format</a>&#34;</span> to determine where the DBID appears in the file name.</p>
</li>
<li>
<p>If you have any text files that preserve the output from an RMAN session, then the DBID is displayed by the RMAN client when it starts up and connects to your database. Typical output follows:</p>
<pre dir="ltr">% rman TARGET /

Recovery Manager: Release 12.1.0.1.0 - Production on Wed Jan 16 17:51:30 2013
 
Copyright (c) 1982, 2013, Oracle and/or its affiliates.  All rights reserved.
 
connected to target database: PROD (<span class="bold">DBID=36508508</span>)
</pre></li>
</ul>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV352"></a><a id="BRADV8140"></a>
<div class="props_rev_3"><a id="GUID-8837082E-3409-4D00-9836-3B9617720349"></a>
<h3 id="BRADV-GUID-8837082E-3409-4D00-9836-3B9617720349" class="sect3">Previewing Backups Used in Restore Operations</h3>
<div>
<div class="section">
<p><a id="d69736e1349" class="indexterm-anchor"></a><a id="d69736e1353" class="indexterm-anchor"></a><a id="d69736e1357" class="indexterm-anchor"></a><a id="d69736e1359" class="indexterm-anchor"></a>You can apply <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> to any <code class="codeph">RESTORE</code> operation to create a detailed list of every backup to be used in the requested <code class="codeph">RESTORE</code> operation, and the necessary target SCN for recovery after the <code class="codeph">RESTORE</code> operation is complete. This command accesses the RMAN repository to query the backup metadata, but does not actually read the backup files to ensure that they can be restored.</p>
<p>As an alternative to <code class="codeph">RESTORE ... PREVIEW</code>, you can use the <code class="codeph">RESTORE ... VALIDATE HEADER</code> command. In addition to listing the files needed for restore and recovery, the <code class="codeph">RESTORE ... VALIDATE HEADER</code> command validates the backup file headers to determine whether the files on disk or in the media management catalog correspond to the metadata in the RMAN repository.</p>
<p>When planning your restore and recovery operation, use <code class="codeph">RESTORE ...</code> <code class="codeph">PREVIEW</code> or <code class="codeph">RESTORE ... VALIDATE HEADER</code> to ensure that all required backups are available or to identify situations in which you may want to direct RMAN to use or avoid specific backups.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To preview backups to be used in a restore operation:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Run a <code class="codeph">RESTORE</code> command with the <code class="codeph">PREVIEW</code> option.</span>
<div>
<p>For example, run one of the following commands:</p>
<pre dir="ltr">RESTORE DATABASE PREVIEW;
RESTORE ARCHIVELOG FROM TIME &#39;SYSDATE-7&#39; PREVIEW;
</pre>
<p>If the report produced by <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> provides too much information, then specify the <code class="codeph">SUMMARY</code> option as shown in the following example:</p>
<pre dir="ltr">RESTORE DATABASE PREVIEW SUMMARY;
</pre>
<p>If you are satisfied with the output, then stop here. If the output indicates that RMAN will request a backup from a tape that you know is temporarily unavailable, then continue with this procedure. If the output indicates that a backup is stored off-site, then skip to <span class="q">&#34;<a href="rcmcomre.htm#GUID-34B3312D-B577-4692-8730-1243CB3EC326">Recalling Off-site Backups</a>&#34;</span>.</p>
</div>
</li>
<li class="stepexpand"><span>If needed, use the <code class="codeph">CHANGE</code> command to set the backup status of any temporarily unavailable backups to <code class="codeph">UNAVAILABLE</code>.</span>
<div>
<p><span class="q">&#34;<a href="rcmmaint.htm#GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC">Updating a Backup to Status AVAILABLE or UNAVAILABLE</a>&#34;</span> explains how to perform this task.</p>
</div>
</li>
<li class="stepexpand"><span>Optionally, run <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> again to confirm that the restore operation does not attempt to use unavailable backups.</span></li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-8837082E-3409-4D00-9836-3B9617720349__GUID-FC6F3739-53AC-4BC6-B932-210CF52BEB27">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF132" target="_blank" href="../RCMRF/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details on interpreting <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> output, which is in the same format as the output of the <code class="codeph">LIST</code> command</p>
</div>
</div>
<!-- class="section" --></div>
<a id="BRADV354"></a><a id="BRADV353"></a><a id="BRADV89768"></a>
<div class="props_rev_3"><a id="GUID-34B3312D-B577-4692-8730-1243CB3EC326"></a>
<h4 id="BRADV-GUID-34B3312D-B577-4692-8730-1243CB3EC326" class="sect4">Recalling Off-site Backups</h4>
<div>
<div class="section">
<p>Some media managers provide status information to RMAN about which backups are off-site. An <a id="d69736e1565" class="indexterm-anchor"></a><a id="d69736e1567" class="indexterm-anchor"></a><a href="glossary.htm#GUID-D9B8D2F8-A997-41F4-8E24-65FC7A686CD9"><span class="xrefglossterm">offsite backup</span></a> is stored in a remote location, such as a secure storage facility, and cannot be restored unless the media manager retrieves the media.</p>
<p>Off-site backups are marked as <code class="codeph">AVAILABLE</code> in the RMAN repository even though the media must be retrieved from storage before the backup can be restored. If RMAN attempts to restore an off-site backup, then the restore job fails.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recall offsite backups:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>(Optional) Identify the off-site backups using the <code class="codeph">RESTORE ... PREVIEW</code> command. The command output indicates whether backups are stored off-site, as shown by the text after the sample output in the following example.</span>
<div>
<pre dir="ltr">List of Backup Sets
===================


BS Key  Size       Device Type Elapsed Time Completion Time
------- ---------- ----------- ------------ ---------------
9       2.25M      SBT_TAPE    00:00:00     21-MAY-13
        BP Key: 9   Status: AVAILABLE  Compressed: NO  Tag: TAG20130521T144258
        Handle: 0aii9k7i_1_1   Media: 0aii9k7i_1_1
 
  List of Archived Logs in backup set 9
  Thrd Seq     Low SCN    Low Time  Next SCN   Next Time
  ---- ------- ---------- --------- ---------- ---------
  1    1       392314     21-MAY-13 392541     21-MAY-13
  1    2       392541     21-MAY-13 392545     21-MAY-13
  1    3       392545     21-MAY-13 392548     21-MAY-13
  1    4       392548     21-MAY-13 395066     21-MAY-13
  1    5       395066     21-MAY-13 395095     21-MAY-13
  1    6       395095     21-MAY-13 395355     21-MAY-13
 
List of remote backup files
============================
        Handle: aii9k7i_1_1   Media: 0aii9k7i_1_1
validation succeeded for backup piece
Finished restore at 21-MAY-13
released channel: dev1
</pre>
<p>You can use <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> <code class="codeph">RECALL</code> to instruct the media manager to make off-site backups available.</p>
</div>
</li>
<li class="stepexpand"><span>If backups are stored offsite, then execute a <code class="codeph">RESTORE ... PREVIEW</code> command with the <code class="codeph">RECALL</code> option.</span>
<div>
<p>The following example initiates recall for the off-site archived log backups shown in the previous step (sample output included):</p>
<pre dir="ltr">RESTORE ARCHIVELOG ALL PREVIEW RECALL;
</pre>
<p>The following sample output indicates that RMAN initiated a recall:</p>
<pre dir="ltr">List of Backup Sets
===================
 
 
BS Key  Size       Device Type Elapsed Time Completion Time
------- ---------- ----------- ------------ ---------------
9       2.25M      SBT_TAPE    00:00:00     21-MAY-13
        BP Key: 9   Status: AVAILABLE  Compressed: NO  Tag: TAG20130521T144258
        Handle: VAULT0aii9k7i_1_1   Media: /tmp,VAULT0aii9k7i_1_1
 
  List of Archived Logs in backup set 9
  Thrd Seq     Low SCN    Low Time  Next SCN   Next Time
  ---- ------- ---------- --------- ---------- ---------
  1    1       392314     21-MAY-13 392541     21-MAY-13
  1    2       392541     21-MAY-13 392545     21-MAY-13
  1    3       392545     21-MAY-13 392548     21-MAY-13
  1    4       392548     21-MAY-13 395066     21-MAY-13
  1    5       395066     21-MAY-13 395095     21-MAY-13
  1    6       395095     21-MAY-13 395355     21-MAY-13
 
Initiated recall for the following list of remote backup files
==========================================================
        Handle: VAULT0aii9k7i_1_1   Media: /tmp,VAULT0aii9k7i_1_1
validation succeeded for backup piece
Finished restore at 21-MAY-13
released channel: dev1
</pre></div>
</li>
<li class="stepexpand"><span>Run the <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> command. If necessary, return to the previous step until no backups needed for the restore operation are reported as off-site.</span></li>
</ol>
</div>
</div>
</div>
<a id="BRADV90066"></a>
<div class="props_rev_3"><a id="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE"></a>
<h3 id="BRADV-GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE" class="sect3">Validating Backups Before Restoring Them</h3>
<div>
<div class="section">
<p>Although the procedures in <span class="q">&#34;<a href="rcmcomre.htm#GUID-8837082E-3409-4D00-9836-3B9617720349">Previewing Backups Used in Restore Operations</a>&#34;</span> indicate which backups will be restored, they do not verify that the backups are actually usable. <a id="d69736e1712" class="indexterm-anchor"></a><a id="d69736e1714" class="indexterm-anchor"></a><a id="d69736e1718" class="indexterm-anchor"></a><a id="d69736e1722" class="indexterm-anchor"></a><a id="d69736e1726" class="indexterm-anchor"></a>You can run RMAN commands to test the availability of usable backups for any <code class="codeph">RESTORE</code> operation, or test the contents of a specific backup for use in <code class="codeph">RESTORE</code> operations. The contents of the backups are actually read and checked for corruption. You have the following validation options:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">VALIDATE</code> tests whether RMAN can restore a specific object from a backup. RMAN chooses which backups to use.</p>
</li>
<li>
<p><code class="codeph">VALIDATE BACKUPSET</code> tests the validity of a backup set that you specify.</p>
<div class="infoboxnotealso" id="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE__GUID-6EE59D47-26C6-4ECC-9E0A-E39835670C68">
<p class="notep1">See Also:</p>
<p><a href="rcmvalid.htm#GUID-CC967929-9610-410D-B881-66E71353D84C">Validating Database Files and Backups</a></p>
</div>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89778"></a>
<div class="props_rev_3"><a id="GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469"></a>
<h3 id="BRADV-GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469" class="sect3">Restoring Archived Redo Logs Needed for Recovery</h3>
<div>
<p>RMAN restores archived redo log files from backup automatically as needed to perform recovery. You can also restore archived redo logs manually to save the time needed to restore these files later during the <code class="codeph">RECOVER</code> command, or if you want to store the restored archived redo log files in some new location. RMAN also gives you the flexibility of restoring all archive redo log files, the current ones, or archive redo log files from a specified previous incarnation of the database.</p>
<p><a id="d69736e1835" class="indexterm-anchor"></a><a id="d69736e1841" class="indexterm-anchor"></a>By default, RMAN restores archived redo logs with names constructed using the <code class="codeph">LOG_ARCHIVE_FORMAT</code> and <a id="d69736e1849" class="indexterm-anchor"></a>the highest <code class="codeph">LOG_ARCHIVE_DEST_</code><span class="italic"><code class="codeph">n</code></span> parameters of the target database. These parameters are combined in a platform-specific fashion to form the name of the restored archived log.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D">Restoring Archived Redo Logs to a New Location</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-83FE5D57-3F48-45EE-B782-564DF00685E7">Restoring Archived Redo Logs to Multiple Locations</a></p>
</li>
</ul>
</div>
<a id="BRADV89779"></a>
<div class="props_rev_3"><a id="GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D"></a>
<h4 id="BRADV-GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D" class="sect4">Restoring Archived Redo Logs to a New Location</h4>
<div>
<div class="section">
<p>You can override the default location for restored archived redo logs with the <code class="codeph">SET</code> <code class="codeph">ARCHIVELOG</code> <code class="codeph">DESTINATION</code> command. This command manually stages archived logs to different locations while a database restore operation is occurring. During recovery, RMAN knows where to find the newly restored archived logs; it does not require them to be in the location specified in the initialization parameter file.</p>
<p><span class="bold">To restore archived redo logs to a new location:</span></p>
<ol>
<li>
<p>Start RMAN and connect to a target database.</p>
<div class="infoboxnotealso" id="GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D__GUID-68F5A079-614C-4B7C-AEDD-1657BAB40735">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</li>
<li>
<p>Ensure that the database is mounted or open.</p>
</li>
<li>
<p>Perform the following operations within a <code class="codeph">RUN</code> command:</p>
<ol>
<li>
<p>Specify the new location for the restored archived redo logs using <code class="codeph">SET</code> <code class="codeph">ARCHIVELOG</code> <code class="codeph">DESTINATION</code>.</p>
</li>
<li>
<p>Either explicitly restore the archived redo logs or execute commands that automatically restore the logs.</p>
</li>
</ol>
<p>The following sample <code class="codeph">RUN</code> command explicitly restores all backup archived logs to a new location:</p>
<pre dir="ltr">RUN
{ 
  SET ARCHIVELOG DESTINATION TO &#39;/oracle/temp_restore&#39;;
  RESTORE ARCHIVELOG ALL;
  # restore and recover data files as needed
  .
  .
  .
}
</pre>
<p>The following example sets the archived log destination and then uses <code class="codeph">RECOVER DATABASE</code> to restore archived logs from this destination automatically:</p>
<pre dir="ltr">RUN
{ 
  SET ARCHIVELOG DESTINATION TO &#39;/oracle/temp_restore&#39;;
  RESTORE DATABASE;
  RECOVER DATABASE; # restores and recovers logs automatically
}
</pre></li>
</ol>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89780"></a>
<div class="props_rev_3"><a id="GUID-83FE5D57-3F48-45EE-B782-564DF00685E7"></a>
<h4 id="BRADV-GUID-83FE5D57-3F48-45EE-B782-564DF00685E7" class="sect4">Restoring Archived Redo Logs to Multiple Locations</h4>
<div>
<div class="section">
<p>You can specify restore destinations for archived logs multiple times in one <a href="glossary.htm#GUID-661754CF-031C-49CC-BC7B-F2E771540167"><span class="xrefglossterm">RUN block</span></a>, to distribute restored logs among several destinations. (You cannot, however specify multiple destinations simultaneously to produce multiple copies of the same log during the restore operation.) You can use this feature to manage disk space used to contain the restored logs.</p>
<p>This example restores 300 archived redo logs from backup, distributing them across the directories <code class="codeph">/fs1/tmp</code>, <code class="codeph">/fs2/tmp</code>, and <code class="codeph">/fs3/tmp</code>:</p>
<pre dir="ltr">RUN 
{ 
  # Set a new location for logs 1 through 100.
  SET ARCHIVELOG DESTINATION TO &#39;/fs1/tmp&#39;;
  RESTORE ARCHIVELOG FROM SEQUENCE 1 UNTIL SEQUENCE 100;
  # Set a new location for logs 101 through 200.
  SET ARCHIVELOG DESTINATION TO &#39;/fs2/tmp&#39;;
  RESTORE ARCHIVELOG FROM SEQUENCE 101 UNTIL SEQUENCE 200;
  # Set a new location for logs 201 through 300.
  SET ARCHIVELOG DESTINATION TO &#39;/fs3/tmp&#39;;
  RESTORE ARCHIVELOG FROM SEQUENCE 201 UNTIL SEQUENCE 300;
  # restore and recover data files as needed
  .
  .
  .
}
</pre>
<p>When you issue a <code class="codeph">RECOVER</code> command, RMAN finds the needed restored archived logs automatically across the destinations to which they were restored, and applies them to the data files.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV854"></a>
<div class="props_rev_3"><a id="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C"></a>
<h3 id="BRADV-GUID-0A087440-D046-4995-9A00-BBA9C5D3750C" class="sect3">Providing the Password Required to Decrypt Encrypted Backups</h3>
<div>
<div class="section">
<p>If backups are encrypted, then RMAN automatically decrypts these backups while restoring their contents. Depending on the encryption mode used to create encrypted backups, you may need to perform additional steps before restoring encrypted backups.</p>
<p>Backups that were encrypted using transparent encryption with an auto-login keystore require no intervention to restore, if the keystore is available. For backups encrypted with a password-based software keystore, in addition to requiring the keystore to be available, the keystore password to be provided. The keystore password is used to open the keystore and must be provided before the restore operation is performed. Use the <code class="codeph">SET</code> command with the <code class="codeph">DECRYPTION WALLET OPEN IDENTIFIED BY</code> option to specify the password that must be used to open the keystore.</p>
<p>The following command sets the keystore password for a password-based software keystore to <code class="codeph">my_wallet_pswd</code>:</p>
<pre dir="ltr">SET DECRYPTION WALLET OPEN IDENTIFIED BY my_wallet_pswd;
</pre>
<p>Backups created using password-mode encryption require the correct password to be entered before they can be restored. Use the <code class="codeph">SET DECRYPTION</code> command to specify the password used to decrypt the backups. If you are restoring from a group of backups that were created with different passwords, then specify all of the required passwords on the <code class="codeph">SET DECRYPTION</code> command. RMAN automatically uses the correct password with each backup set. The <code class="codeph">SET</code> command must be used before executing the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands.</p>
<p>The following command sets the password used to decrypt backups to <code class="codeph">my_pswd</code>:</p>
<pre dir="ltr">SET DECRYPTION IDENTIFIED BY my_pswd;
</pre>
<div class="infoboxnotealso" id="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C__GUID-1B317E10-A18E-4037-B63A-7131DCBAEDFA">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF149" target="_blank" href="../RCMRF/rcmsynta2008.htm#RCMRF149"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for additional information about performing restore operations using encrypted backups</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV8152"></a>
<div class="props_rev_3"><a id="GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25"></a>
<h2 id="BRADV-GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" class="sect2">Performing Complete Database Recovery</h2>
<div>
<p>This section assumes that you have performed the tasks in <span class="q">&#34;<a href="rcmcomre.htm#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7">Preparing for Complete Database Recovery</a>&#34;</span>. This section describes the basic outline of complete database recovery, which is intended to encompass a wide range of different scenarios.</p>
<p><a href="rcmcomre.htm#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075">Scope of This Chapter</a> describes some of the assumptions used in the recovery procedures.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA">About Complete Database Recovery</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-C605DF51-5348-46BB-AC18-B928F62991C3">Performing Complete Recovery of the Whole Database</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-4EBD9D56-9700-45A1-B233-1F5506A04532">Performing Complete Recovery of a Tablespace</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137">Performing Complete Recovery After Switching to a Copy</a></p>
</li>
</ul>
</div>
<a id="BRADV89771"></a>
<div class="props_rev_3"><a id="GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA"></a>
<h3 id="BRADV-GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA" class="sect3">About Complete Database Recovery</h3>
<div>
<p>You use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to restore and recover the database. During the recovery, RMAN automatically restores backups of any needed archived redo logs. If backups are stored on a media manager, then channels must be configured in advance or a <code class="codeph">RUN</code> block with <code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code> commands must be used to enable access to backups stored there.</p>
<p>If RMAN restores archived redo logs to the fast recovery area during a recovery, then it automatically deletes the restored logs after applying them to the data files. Otherwise, you can use the <code class="codeph">DELETE ARCHIVELOG</code> command to delete restored archived redo logs from disk when they are no longer needed for recovery. For example, you can enter the following command:</p>
<pre dir="ltr">RECOVER DATABASE DELETE ARCHIVELOG;
</pre></div>
<a id="BRADV89776"></a>
<div class="props_rev_3"><a id="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681"></a>
<h4 id="BRADV-GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" class="sect4">About Restoring Data Files to a Nondefault Location</h4>
<div>
<p>If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files. Use the RMAN <code class="codeph">SET NEWNAME</code> command within a <code class="codeph">RUN</code> command to specify the new file name. Afterward, use a <code class="codeph">SWITCH</code> command, which is equivalent to using the SQL statement <code class="codeph">ALTER DATABASE RENAME FILE</code>, to update the names of the data files in the control file. <code class="codeph">SWITCH</code> <code class="codeph">DATAFILE</code> <code class="codeph">ALL</code> updates the control file to reflect the new names for all data files for which a <code class="codeph">SET</code> <code class="codeph">NEWNAME</code> has been issued in a <code class="codeph">RUN</code> command.</p>
<div class="infoboxnotealso" id="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681__GUID-BFDFFD89-5205-4FE8-A9EA-B5A958E16DFE">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF159" target="_blank" href="../RCMRF/rcmsynta2021.htm#RCMRF159"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">SWITCH</code> syntax</p>
</div>
</div>
</div>
</div>
<a id="BRADV355"></a><a id="BRADV89772"></a>
<div class="props_rev_3"><a id="GUID-C605DF51-5348-46BB-AC18-B928F62991C3"></a>
<h3 id="BRADV-GUID-C605DF51-5348-46BB-AC18-B928F62991C3" class="sect3">Performing Complete Recovery of the Whole Database</h3>
<div>
<div class="section">
<p>This scenario assumes that database <code class="codeph">trgt</code> has lost most or all of its data files. It also assumes that the database uses a fast recovery area.</p>
<p>After restore and recovery of a whole database, when the database is open, missing temporary tablespaces that were recorded in the control file are re-created with their previous creation size, <code class="codeph">AUTOEXTEND</code>, and <code class="codeph">MAXSIZE</code> attributes. Only temporary tablespaces that are missing are re-created. If a temp file exists at the location recorded in the RMAN repository but has an invalid header, then RMAN does not re-create the temp file.</p>
<p>If the temp files were created as Oracle-managed files, then they are re-created in the <a id="d69736e2616" class="indexterm-anchor"></a>current <code class="codeph">DB_CREATE_FILE_DEST</code> location. Otherwise, they are re-created at their previous locations. If RMAN cannot re-create the file due to an I/O error or some other cause, then the error is reported in the alert log and the database open operation continues.</p>
<div class="infoboxnotealso" id="GUID-C605DF51-5348-46BB-AC18-B928F62991C3__GUID-2E85197D-B951-4FAF-B3A8-A812FD6FE3FD">
<p class="notep1">See Also:</p>
<p><a href="rcmcomre.htm#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075">Scope of This Chapter</a> for some of the assumptions used in the recovery procedures</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To restore and recover the whole database:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database.</span>
<div>
<div class="infoboxnotealso" id="GUID-C605DF51-5348-46BB-AC18-B928F62991C3__GUID-0E8C29B2-1196-4F48-9276-3FC3D0EAEAA9">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
<p>RMAN displays the database status when it connects: <code class="codeph">not started</code>, <code class="codeph">not mounted</code>, <code class="codeph">not open</code> (when the database is mounted but not open), or none (when the database is open).</p>
</div>
</li>
<li class="stepexpand"><span>If the database is not mounted, then mount but do not open the database.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">STARTUP MOUNT;
</pre></div>
</li>
<li class="stepexpand"><span>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.</span>
<div>
<p>For example, enter the following command (sample output is included):</p>
<pre dir="ltr">SHOW ALL;

 
RMAN configuration parameters for database with db_unique_name PROD1 are:
.
.
.
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DEVICE TYPE SBT_TAPE PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE CHANNEL DEVICE TYPE &#39;SBT_TAPE&#39; PARMS &#34;SBT_
LIBRARY=/usr/local/oracle/backup/lib/libobk.so&#34;;
</pre>
<p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.</p>
</div>
</li>
<li class="stepexpand"><span>If you are restoring password-protected encrypted backups, then specify the password.</span>
<div>
<p>Use the <code class="codeph">SET DECRYPTION IDENTIFIED BY</code> command to specify a password for password-protected backups, as shown in the following example (where <span class="italic">password</span> represents the actual password that you enter):</p>
<pre dir="ltr">SET DECRYPTION IDENTIFIED BY <span class="italic">password</span>;
</pre>
<p>If you created backups with different passwords, then you can run the <code class="codeph">SET DECRYPTION IDENTIFIED BY</code> <span class="italic"><code class="codeph">password</code></span> command multiple times, specifying all of the possible passwords that might be required to restore the backups.</p>
</div>
</li>
<li class="stepexpand"><span>Restore and recover the database. Do one of the following:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>If you are restoring all data files to their original locations, then execute <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> sequentially at the RMAN prompt.</p>
<p>For example, enter the following commands if automatic channels are configured (sample output included):</p>
<pre dir="ltr">RMAN&gt; <span class="bold">RESTORE DATABASE;</span>

Starting restore at 20-JUN-13
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=35 device type=DISK
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: SID=34 device type=SBT_TAPE
channel ORA_SBT_TAPE_1: Oracle Secure Backup
 
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00001 to /disk1/oracle/dbs/tbs_01.f
channel ORA_DISK_1: restoring datafile 00002 to /disk1/oracle/dbs/tbs_ax1.f
.
.
.
Finished restore at 20-JUN-13
</pre>
<pre dir="ltr">RMAN&gt; <span class="bold">RECOVER DATABASE;</span>

Starting recover at 20-JUN-13
using channel ORA_DISK_1
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: SID=34 device type=SBT_TAPE
channel ORA_SBT_TAPE_1: Oracle Secure Backup
 
starting media recovery
 
channel ORA_DISK_1: starting archived log restore to default destination
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=5
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=6
.
.
.
channel ORA_DISK_1: reading from backup piece
 /disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp
channel ORA_DISK_1: piece
 handle=/disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp tag=TAG20130620T113128
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:02
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_5_29jhv47k_.arc thread=1 sequence=5
channel default: deleting archived log(s)
.
.
.
media recovery complete, elapsed time: 00:00:15
Finished recover at 20-JUN-13
 
</pre>
<p>If you manually allocate channels, then you must issue the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands together within a <code class="codeph">RUN</code> block as shown in the following example:</p>
<pre dir="ltr">RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt;
  RESTORE DATABASE;
  RECOVER DATABASE;
}
</pre></li>
<li>
<p>If you are restoring some data files to new locations, then execute <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> sequentially in a <code class="codeph">RUN</code> command. Use the <code class="codeph">SET NEWNAME</code> command to rename data files, as described in <span class="q">&#34;<a href="rcmcomre.htm#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681">About Restoring Data Files to a Nondefault Location</a>&#34;</span>.</p>
<p>The following example restores the database, specifying new names for three of the data files, and then recovers the database:</p>
<pre dir="ltr">RUN
{  
  SET NEWNAME FOR DATAFILE 2 TO &#39;/disk2/df2.dbf&#39;;
  SET NEWNAME FOR DATAFILE 3 TO &#39;/disk2/df3.dbf&#39;;
  SET NEWNAME FOR DATAFILE 4 TO &#39;/disk2/df4.dbf&#39;;
  RESTORE DATABASE;
  SWITCH DATAFILE ALL;
  RECOVER DATABASE;
}
</pre></li>
</ul>
</div>
</li>
<li class="stepexpand"><span>Examine the output to see if media recovery was successful. If so, open the database.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">ALTER DATABASE OPEN;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV356"></a><a id="BRADV89773"></a>
<div class="props_rev_3"><a id="GUID-4EBD9D56-9700-45A1-B233-1F5506A04532"></a>
<h3 id="BRADV-GUID-4EBD9D56-9700-45A1-B233-1F5506A04532" class="sect3">Performing Complete Recovery of a Tablespace</h3>
<div>
<div class="section">
<p><a id="d69736e2852" class="indexterm-anchor"></a>In the basic scenario, the database is open, and some but not all of the data files are damaged. You want to restore and recover the damaged tablespace while leaving the database open so that the rest of the database remains available. This scenario assumes that database <code class="codeph">TRGT</code> has lost tablespace <code class="codeph">USERS</code>.</p>
<div class="infoboxnotealso" id="GUID-4EBD9D56-9700-45A1-B233-1F5506A04532__GUID-A7E4B12C-036C-4530-AF3A-9F7D587B7FC4">
<p class="notep1">See Also:</p>
<p><a href="rcmcomre.htm#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075">Scope of This Chapter</a> for some of the assumptions used in the recovery procedures</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To restore and recover a tablespace:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database.</span>
<div>
<div class="infoboxnotealso" id="GUID-4EBD9D56-9700-45A1-B233-1F5506A04532__GUID-9C01E21E-5126-4201-A745-15425A26420B">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>If the database is open, then take the tablespace requiring recovery offline.</span>
<div>
<p>For example, enter the following command to take <code class="codeph">USERS</code> offline:</p>
<pre dir="ltr">ALTER TABLESPACE users OFFLINE IMMEDIATE;
</pre></div>
</li>
<li class="stepexpand"><span>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.</span>
<div>
<p>For example, enter the following command (sample output is included):</p>
<pre dir="ltr">SHOW ALL;

RMAN configuration parameters for database with db_unique_name PROD1 are:
.
.
.
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DEVICE TYPE SBT_TAPE PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE CHANNEL DEVICE TYPE &#39;SBT_TAPE&#39; PARMS  &#34;SBT_
LIBRARY=/usr/local/oracle/backup/lib/libobk.so&#34;;
</pre>
<p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.</p>
</div>
</li>
<li class="stepexpand"><span>If restoring password-protected encrypted backups, then specify the password.</span>
<div>
<p>Use the <code class="codeph">SET DECRYPTION IDENTIFIED BY</code> command to specify a password for password-protected backups, as shown in the following example (where <span class="italic">password</span> represents the actual password that you enter):</p>
<pre dir="ltr">SET DECRYPTION IDENTIFIED BY <span class="italic">password</span>;
</pre></div>
</li>
<li class="stepexpand"><span>Restore and recover the tablespace. Do one of the following:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>If you are restoring data files to their original locations, then run the <code class="codeph">RESTORE TABLESPACE</code> and <code class="codeph">RECOVER TABLESPACE</code> commands at the RMAN prompt.</p>
<p>For example, enter the following command if automatic channels are configured (sample output included):</p>
<pre dir="ltr">RMAN&gt; <span class="bold">RESTORE TABLESPACE users;</span>
 
Starting restore at 20-JUN-13
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=37 device type=DISK
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: SID=38 device type=SBT_TAPE
channel ORA_SBT_TAPE_1: Oracle Secure Backup
 
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00012 to /disk1/oracle/dbs/users01.f
channel ORA_DISK_1: restoring datafile 00013 to /disk1/oracle/dbs/users02.f
channel ORA_DISK_1: restoring datafile 00021 to /disk1/oracle/dbs/users03.f
channel ORA_DISK_1: reading from backup piece
 /disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_nnndf_
TAG20130620T105435_29jflwor_.bkp
channel ORA_DISK_1: piece
 handle=/disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_nnndf_
TAG20130620T105435_29jflwor_.bkp tag=TAG20130620T105435
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01
Finished restore at 20-JUN-13
</pre>
<pre dir="ltr">RMAN&gt; <span class="bold">RECOVER TABLESPACE users;</span>
 
Starting recover at 20-JUN-13
using channel ORA_DISK_1
using channel ORA_SBT_TAPE_1
 
starting media recovery
 
archived log for thread 1 with sequence 27 is on disk as file
 /disk1/oracle/work/orcva/TKRM/archivelog/2013_06_20/o1_mf_1_27_29jjmtc9_.arc
archived log for thread 1 with sequence 28 is on disk as file
 /disk1/oracle/work/orcva/TKRM/archivelog/2013_06_20/o1_mf_1_28_29jjnc5x_.arc
.
.
.
channel ORA_DISK_1: starting archived log restore to default destination
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=5
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=6
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=7
.
.
.
channel ORA_DISK_1: reading from backup piece
 /disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp
channel ORA_DISK_1: piece
 handle=/disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp tag=TAG20130620T113128
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:02
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_5_29jkdvjq_.arc thread=1 sequence=5
channel default: deleting archived log(s)
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_5_29jkdvjq_.arc RECID=91 STAMP=593611179
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_6_29jkdvbz_.arc thread=1 sequence=6
channel default: deleting archived log(s)
.
.
.
media recovery complete, elapsed time: 00:00:01
Finished recover at 20-JUN-13
</pre></li>
<li>
<p>If you are restoring some data files to new locations, then execute <code class="codeph">RESTORE TABLESPACE</code> and <code class="codeph">RECOVER TABLESPACE</code> in a <code class="codeph">RUN</code> command. Use the <code class="codeph">SET NEWNAME</code> command to rename data files, as described in <span class="q">&#34;<a href="rcmcomre.htm#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681">About Restoring Data Files to a Nondefault Location</a>&#34;</span>.</p>
<p>The following example restores the data files in tablespace <code class="codeph">users</code> to a new location, and then performs recovery. Assume that the old data files were stored in the <code class="codeph">/disk1</code> path and the new ones will be stored in the <code class="codeph">/disk2</code> path.</p>
<pre dir="ltr">RUN
{
  # specify the new location for each datafile
  SET NEWNAME FOR DATAFILE &#39;/disk1/oracle/dbs/users01.f&#39; TO 
                           &#39;/disk2/users01.f&#39;;
  SET NEWNAME FOR DATAFILE &#39;/disk1/oracle/dbs/users02.f&#39; TO 
                           &#39;/disk2/users02.f&#39;;
  SET NEWNAME FOR DATAFILE &#39;/disk1/oracle/dbs/users03.f&#39; TO 
                           &#39;/disk2/users03.f&#39;;
  RESTORE TABLESPACE users;
  SWITCH DATAFILE ALL;   # update control file with new file names
  RECOVER TABLESPACE users;
}
</pre></li>
</ul>
</div>
</li>
<li class="stepexpand"><span>Examine the output to see if recovery was successful. If so, bring the recovered tablespace back online.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">ALTER TABLESPACE users ONLINE;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV89774"></a>
<div class="props_rev_3"><a id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137"></a>
<h3 id="BRADV-GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" class="sect3">Performing Complete Recovery After Switching to a Copy</h3>
<div>
<p>If you have image copies of the inaccessible data files in the fast recovery area, then you can use the<a id="d69736e3072" class="indexterm-anchor"></a><a id="d69736e3074" class="indexterm-anchor"></a> <code class="codeph">SWITCH DATAFILE ... TO COPY</code> command to point the control file at the data file copy and then use <code class="codeph">RECOVER</code> to recover lost changes. You can also use the <code class="codeph">SWITCH DATABASE TO COPY</code> command to point the control file at a copy of the whole database. Because you do not need to restore backups, this recovery technique takes less time than traditional restore and recovery.</p>
<div class="infobox-note" id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137__GUID-32D4DB6B-B3DF-46F9-9223-26EA7F7B6CBD">
<p class="notep1">Note:</p>
<p>A <code class="codeph">SWITCH TABLESPACE ... TO COPY</code> command is also supported for cases when all data files in a tablespace are lost and copies of all data files exist. The same restriction exists for <code class="codeph">SWITCH DATABASE TO COPY</code>.</p>
</div>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572">Switching to a Data File Copy</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A">Switching to a Database Copy</a></p>
</li>
</ul>
</div>
<a id="BRADV357"></a><a id="BRADV996"></a>
<div class="props_rev_3"><a id="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572"></a>
<h4 id="BRADV-GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" class="sect4">Switching to a Data File Copy</h4>
<div>
<div class="section">
<p>In the basic scenario, the database is open, and some but not all of the data files are damaged. During the course of the day, a data file goes missing due to storage failure. You must repair this file, but cannot afford the time to do a restore and recovery from a backup. You decide to use a recent image copy backup as the new file, thus eliminating restore time. This scenario assumes that database <code class="codeph">trgt</code> has lost data file 4.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To switch to a data file copy and perform recovery:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database.</span>
<div>
<div class="infoboxnotealso" id="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572__GUID-03FBFA38-7AA1-472E-9CDF-AD39648901F9">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>If the database is open, then take the tablespace requiring recovery offline.</span>
<div>
<p>Enter the following command to take data file 4 offline:</p>
<pre dir="ltr">ALTER DATABASE DATAFILE 4 OFFLINE;
</pre></div>
</li>
<li class="stepexpand"><span>Switch the offline data file to the latest copy.</span>
<div>
<p>Enter the following command to point the control file to the latest image copy of data file 4:</p>
<pre dir="ltr">SWITCH DATAFILE 4 TO COPY;
</pre></div>
</li>
<li class="stepexpand"><span>Recover the data file with the <code class="codeph">RECOVER DATAFILE</code> command.</span>
<div>
<p>Enter the following command:</p>
<pre dir="ltr">RECOVER DATAFILE 4;
 
</pre>
<p>RMAN automatically restores archived redo logs and incremental backups. Because the database uses a fast recovery area, RMAN automatically deletes them after they have been applied.</p>
</div>
</li>
<li class="stepexpand"><span>Examine the output to see if recovery was successful. If so, bring the recovered data file back online.</span>
<div>
<p>Enter the following command to bring data file 4 online:</p>
<pre dir="ltr">ALTER DATABASE DATAFILE 4 ONLINE;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV358"></a><a id="BRADV999"></a>
<div class="props_rev_3"><a id="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A"></a>
<h4 id="BRADV-GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A" class="sect4">Switching to a Database Copy</h4>
<div>
<div class="section">
<p>In this scenario, the database is shut down, and all of the data files are damaged. You have image copies of all the damaged data files. You decide to use the existing image copies as the new data files, thus eliminating restore time.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To switch to a database copy and perform recovery:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database.</span>
<div>
<div class="infoboxnotealso" id="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A__GUID-13477E49-1AB4-4FE0-A966-64024D0A2105">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Mount the database.</span></li>
<li class="stepexpand"><span>Switch the database to the latest copy.</span>
<div>
<p>Enter the following command to point the control file to the latest image copy of the database:</p>
<pre dir="ltr">SWITCH DATABASE TO COPY;
</pre></div>
</li>
<li class="stepexpand"><span>Recover the database with the <code class="codeph">RECOVER DATABASE</code> command.</span>
<div>
<p>Enter the following command:</p>
<pre dir="ltr">RECOVER DATABASE;
 
</pre>
<p>RMAN automatically restores archived redo logs and incremental backups. Because the database uses a fast recovery area, RMAN automatically deletes them after they have been applied.</p>
</div>
</li>
<li class="stepexpand"><span>Examine the output to see if recovery was successful. If so, open the database.</span>
<div>
<p>Enter the following command to open the database:</p>
<pre dir="ltr">ALTER DATABASE OPEN;
</pre></div>
</li>
</ol>
</div>
</div>
</div>
</div>
<a id="BRADV636"></a>
<div class="props_rev_3"><a id="GUID-1F744C63-2D4C-4F65-8773-1340A85993ED"></a>
<h2 id="BRADV-GUID-1F744C63-2D4C-4F65-8773-1340A85993ED" class="sect2">Performing Complete Recovery of CDBs</h2>
<div>
<p>RMAN and Oracle Enterprise Manager Cloud Control (Cloud Control) provide full support for backup and recovery in a multitenant environment. You can back up and recover a whole <a href="glossary.htm#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">multitenant container database (CDB)</span></a>, <a href="glossary.htm#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a> only, or one or more pluggable databases (<a href="glossary.htm#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>s).</p>
<p>The section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcomre.htm#GUID-50186233-ADCE-4566-8D82-B41A566A0E3B">Performing Complete Recovery of a Whole CDB</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B">Performing Complete Recovery of the Root</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44">Performing Complete Recovery of PDBs with RMAN</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451">Performing Complete Recovery of PDBs with Cloud Control</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F">Performing Complete Recovery of Tablespaces in a PDB with Cloud Control</a></p>
</li>
<li>
<p><a href="rcmcomre.htm#GUID-9A824454-8577-4899-BD69-E631B573021F">Performing Complete Recovering of CDBs After Switching to a Copy</a></p>
</li>
</ul>
</div>
<a id="BRADV637"></a><a id="BRADV746"></a>
<div class="props_rev_3"><a id="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B"></a>
<h3 id="BRADV-GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" class="sect3">Performing Complete Recovery of a Whole CDB</h3>
<div>
<div class="section">
<p>When you recover a whole CDB, you recover the root and all PDBs in a single operation.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover a whole CDB:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Follow the instructions in <span class="q">&#34;<a href="rcmcomre.htm#GUID-C605DF51-5348-46BB-AC18-B928F62991C3">Performing Complete Recovery of the Whole Database</a>&#34;</span>, connecting to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</p>
<p>When recovering a whole CDB, you use the <a href="glossary.htm#GUID-62A96A52-3B97-455A-A443-75B999DCAC94"><span class="xrefglossterm">non-CDB</span></a> syntax for the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands.</p>
<pre dir="ltr">RESTORE DATABASE;
RECOVER DATABASE;
</pre>
<div class="infoboxnotealso" id="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B__GUID-385EF231-6A39-4769-9057-720878957ACE">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV748"></a><a id="BRADV747"></a>
<div class="props_rev_3"><a id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B"></a>
<h3 id="BRADV-GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B" class="sect3">Performing Complete Recovery of the Root</h3>
<div>
<div class="section">
<p>You might consider recovering only the root if a data corruption or user error occurs that affects only the root. However, Oracle strongly recommends that you recover all PDBs after recovering the root to prevent metadata inconsistencies among the root and the PDBs. In this case, it might be preferable to perform a complete recovery of the whole CDB.</p>
<div class="infoboxnotealso" id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B__GUID-A55FFDE4-7020-425E-827B-BB400ECD5456">
<p class="notep1">See Also:</p>
<p><a href="rcmcomre.htm#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075">Scope of This Chapter</a> for some of the assumptions used in the recovery procedures</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover the root:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</p>
<div class="infoboxnotealso" id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B__GUID-DC4FE7F5-1982-47DC-A93D-0D138EDC04FA">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD">Making RMAN Connections to a CDB</a>&#34;</span></p>
</div>
</li>
<li>
<p>Place the CDB in mounted mode.</p>
<pre dir="ltr">SHUTDOWN IMMEDIATE
STARTUP MOUNT
</pre></li>
<li>
<p>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</p>
</li>
<li>
<p>Restore and recover the root with the following commands:</p>
<pre dir="ltr">RESTORE DATABASE ROOT;
RECOVER DATABASE ROOT;
</pre></li>
<li>
<p>Examine the output to see if media recovery was successful. If so, proceed to the next step.</p>
</li>
<li>
<p>(Strongly recommended) Recover all PDBs, including the seed PDB.</p>
<ol>
<li>
<p>Issue the <code class="codeph">RESTORE</code> <code class="codeph">PLUGGABLE</code> <code class="codeph">DATABASE</code> and <code class="codeph">RECOVER</code> <code class="codeph">PLUGGABLE</code> <code class="codeph">DATABASE</code> commands.</p>
<p>The following example recovers the PDBs <code class="codeph">sales</code> and <code class="codeph">hr</code>:</p>
<pre dir="ltr">RESTORE PLUGGABLE DATABASE &#39;PDB$SEED&#39;, sales, hr;
RECOVER PLUGGABLE DATABASE &#39;PDB$SEED&#39;, sales, hr;
</pre></li>
<li>
<p>Examine the output to see if media recovery was successful. If so, proceed to the next step.</p>
</li>
</ol>
</li>
<li>
<p>Open the CDB and all PDBs.</p>
<pre dir="ltr">ALTER DATABASE OPEN;
ALTER PLUGGABLE DATABASE ALL OPEN;
</pre></li>
</ol>
<div class="infoboxnotealso" id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B__GUID-71C950E2-FE92-477E-AFB8-BF44B36C045E">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmcomre.htm#GUID-50186233-ADCE-4566-8D82-B41A566A0E3B">Performing Complete Recovery of a Whole CDB</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmcomre.htm#GUID-C605DF51-5348-46BB-AC18-B928F62991C3">Performing Complete Recovery of the Whole Database</a>&#34;</span> for more options when recovering</p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV750"></a><a id="BRADV751"></a><a id="BRADV749"></a>
<div class="props_rev_3"><a id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44"></a>
<h3 id="BRADV-GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44" class="sect3">Performing Complete Recovery of PDBs with RMAN</h3>
<div>
<div class="section">
<p>You can perform complete recovery of one or more PDBs without affecting operations of other open PDBs.</p>
<div class="infoboxnotealso" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-C837E782-277A-4976-B971-86FA059546A0">
<p class="notep1">See Also:</p>
<p><a href="rcmcomre.htm#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075">Scope of This Chapter</a> for some of the assumptions used in the recovery procedures</p>
</div>
<p>There are two approaches to recovering a PDB with RMAN:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Connect to the root and then use the <code class="codeph">RESTORE</code> <code class="codeph">PLUGGABLE</code> <code class="codeph">DATABASE</code> and <code class="codeph">RECOVER</code> <code class="codeph">PLUGGABLE</code> <code class="codeph">DATABASE</code> commands. This approach enables you to recover multiple PDBs with a single command.</p>
</li>
<li>
<p>Connect to the PDB and use the <code class="codeph">RESTORE</code> <code class="codeph">DATABASE</code> and <code class="codeph">RECOVER</code> <code class="codeph">DATABASE</code> commands. This approach recovers only a single PDB and enables you to use the same commands used for recovering non-CDB databases.</p>
</li>
</ul>
<div class="infobox-note" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-1DA489AB-D3AA-4AE1-8DF4-4E4C8C881277">
<p class="notep1">Video:</p>
<p><a class="olink vid_dbbackup_recoverpdb" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=vid_dbbackup_recoverpdb">Recovering a Pluggable Database</a></p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover one or more PDBs while connected to the root:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</p>
<div class="infoboxnotealso" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-6AE75EE6-B083-4343-86DD-FED91990734F">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD">Making RMAN Connections to a CDB</a>&#34;</span></p>
</div>
</li>
<li>
<p>Close the PDBs that you want to recover.</p>
<pre dir="ltr">ALTER PLUGGABLE DATABASE sales, hr CLOSE;
</pre>
<p>If any data files are missing, an error occurs and you cannot close a PDB. You must then connect to the PDB to which the missing data file belongs, take the missing data file offline, and then close the PDB.</p>
<p>The following command takes the data file 12 offline:</p>
<pre dir="ltr">ALTER PLUGGABLE DATABASE DATAFILE 12 OFFLINE;
</pre>
<div class="infobox-note" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-BC3A98D5-DE8A-41FC-8558-750A70A8A5F1">
<p class="notep1">Note:</p>
<p>If the data files that store the <code class="codeph">SYSTEM</code> tablespace of a PDB are missing, then follow the recovery steps described in <a href="rcmcomre.htm#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a>.</p>
</div>
</li>
<li>
<p>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</p>
</li>
<li>
<p>Issue the <code class="codeph">RESTORE</code> <code class="codeph">PLUGGABLE</code> <code class="codeph">DATABASE</code> and <code class="codeph">RECOVER</code> <code class="codeph">PLUGGABLE</code> <code class="codeph">DATABASE</code> commands.</p>
<p>The following example recovers the seed database <code class="codeph">PDB$SEED</code> and the PDBs <code class="codeph">sales</code> and <code class="codeph">hr</code>:</p>
<pre dir="ltr">RESTORE PLUGGABLE DATABASE &#39;pdb$seed&#39;, sales, hr;
RECOVER PLUGGABLE DATABASE &#39;pdb$seed&#39;, sales, hr;
</pre></li>
<li>
<p>If any data files were taken offline in Step 2, make these data files online.</p>
<p>Connect to the PDB to which the missing data file belongs and then make the data file online. The following command makes the data file 12 online:</p>
<pre dir="ltr">ALTER DATABASE DATAFILE 12 ONLINE;
</pre></li>
<li>
<p>Examine the output to see if media recovery was successful. If so, open the PDBs.</p>
<pre dir="ltr">ALTER PLUGGABLE DATABASE sales, hr OPEN;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To connect to and recover one PDB:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the PDB as a <a href="glossary.htm#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">local user</span></a> with <code class="codeph">SYSDBA</code> system privilege.</span>
<div>
<div class="infoboxnotealso" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-F2CD72AC-29D1-4464-A5F9-E55357AB5864">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD">Making RMAN Connections to a CDB</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Close the PDB.</span>
<div>
<pre dir="ltr">ALTER PLUGGABLE DATABASE CLOSE;
</pre>
<p>If any data files are missing, an error occurs and you cannot close the PDB. You must take the missing data file offline and then close the PDB.</p>
<p>The following command takes the data file 12 offline:</p>
<pre dir="ltr">ALTER DATABASE DATAFILE 12 OFFLINE;
</pre>
<div class="infobox-note" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-4AAF369F-0C9E-4319-BD15-A6BB51DDB0EC">
<p class="notep1">Note:</p>
<p>If the data files that store the <code class="codeph">SYSTEM</code> tablespace of a PDB are missing, then follow the recovery steps described in <a href="rcmcomre.htm#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a>.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</span></li>
<li class="stepexpand"><span>Issue the <code class="codeph">RESTORE</code> <code class="codeph">DATABASE</code> and <code class="codeph">RECOVER</code> <code class="codeph">DATABASE</code> commands.</span>
<div>
<pre dir="ltr">RESTORE DATABASE;
RECOVER DATABASE;
</pre></div>
</li>
<li class="stepexpand"><span>If any data files were taken offline in Step 2, make these data files online.</span>
<div>
<p>The following command makes the data file 12 online:</p>
<pre dir="ltr">ALTER DATABASE DATAFILE 12 ONLINE;
</pre></div>
</li>
<li class="stepexpand"><span>Open the PDB.</span>
<div>
<pre dir="ltr">ALTER PLUGGABLE DATABASE OPEN;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-CAB9DA96-3C5A-43C6-AB45-62B32C1DA085">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV752"></a>
<div class="props_rev_3"><a id="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451"></a>
<h3 id="BRADV-GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451" class="sect3">Performing Complete Recovery of PDBs with Cloud Control</h3>
<div>
<div class="section">
<p>To recover one or more PDBs with Oracle Enterprise Manager Cloud Control (Cloud Control), complete these steps:</p>
<ol>
<li>
<p>From the Database Home page, select <span class="bold">Backup &amp; Recovery</span> from the Availability menu, and then select <span class="bold">Perform Recovery</span>.</p>
</li>
<li>
<p>If you have not logged in to the database previously, the Database Login page is displayed. Log in to the database using Named or New credentials and then click <span class="bold">Login</span>.</p>
<p>Cloud Control displays the Perform Recovery page.</p>
</li>
<li>
<p>From the User Directed Recovery section, select <span class="bold">Pluggable Databases</span> from the Recovery Scope drop-down list, and then click <span class="bold">Recover</span>.</p>
<p>The Perform Pluggable Database Recovery Wizard appears and displays the Pluggable Databases page.</p>
</li>
<li>
<p>Select the PDBs that you want to recover by following these steps:</p>
<ol>
<li>
<p>Click <span class="bold">Add</span> to display the Available Pluggable Databases page.</p>
</li>
<li>
<p>From the list of PDBs shown, click in the <span class="bold">Select</span> column to designate the PDBs that you want to recover. Optionally, you can click <span class="bold">Select All</span> to turn on the Select option for all available PDBs. Click <span class="bold">Select None</span> to deselect all PDBs.</p>
</li>
<li>
<p>Click the <span class="bold">Select</span> button to return to the Pluggable Databases page.</p>
</li>
<li>
<p>Optionally, you can remove PDBs from the table by clicking in the <span class="bold">Select</span> column for each PDB that you want to remove and then clicking <span class="bold">Remove</span>.</p>
</li>
</ol>
</li>
<li>
<p>Complete the wizard by navigating through the remainder of the pages to recover the PDBs. For more information about each page of the wizard, click <span class="bold">Help</span>.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451__GUID-600E1F3D-0F41-4C9A-975C-5C9D05163644">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmintro.htm#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705">Accessing the Database Home Page Using Cloud Control</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV754"></a><a id="BRADV755"></a><a id="BRADV753"></a>
<div class="props_rev_3"><a id="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934"></a>
<h3 id="BRADV-GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" class="sect3">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</h3>
<div>
<div class="section">
<p>Because tablespaces in different PDBs can have the same name, to eliminate ambiguity you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect to either the root or a PDB to recover PDB data files. If you connect to the root, you can recover data files from multiple PDBs with a single command. If you connect to a PDB, you can recover only data files in that PDB.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover a non-SYSTEM tablespace in a PDB:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Follow the instructions in <span class="q">&#34;<a href="rcmcomre.htm#GUID-4EBD9D56-9700-45A1-B233-1F5506A04532">Performing Complete Recovery of a Tablespace</a>&#34;</span>, connecting as target to the PDB as a local user with the <code class="codeph">SYSDBA</code> privilege.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover the SYSTEM tablespace in a PDB:</p>
<ol>
<li>Start RMAN and
<p>connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</p>
</li>
<li>
<p>Shut down the CDB and restart it in mount mode.</p>
<pre dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre></li>
<li>
<p>Restore and recover the data files that store the <code class="codeph">SYSTEM</code> tablespace of the affected PDB.</p>
<pre dir="ltr">RESTORE DATAFILE 2,3;
RECOVER DATAFILE 2,3;
</pre></li>
<li>
<p>Open all the PDBs in the CDB.</p>
<pre dir="ltr">ALTER PLUGGABLE DATABASE ALL OPEN READ WRITE;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover non-SYSTEM data files in a PDB:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Do one of the following:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>Start RMAN and connect to the root as a <a href="glossary.htm#GUID-2B102186-15BD-443C-B375-8CB0D442CF5F"><span class="xrefglossterm">common user</span></a> with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</p>
</li>
<li>
<p>Start RMAN and connect to the PDB as a local user with the <code class="codeph">SYSDBA</code> privilege.</p>
</li>
</ul>
</div>
</li>
<li class="stepexpand"><span>Issue the <code class="codeph">RESTORE</code> <code class="codeph">DATAFILE</code> and <code class="codeph">RECOVER</code> <code class="codeph">DATAFILE</code> commands.</span>
<div>
<pre dir="ltr">RESTORE DATAFILE 10, 13;
RECOVER DATAFILE 10, 13;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934__GUID-DFF0BBD1-2174-4245-A6DB-8A12BE84A62F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span></p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV756"></a>
<div class="props_rev_3"><a id="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F"></a>
<h3 id="BRADV-GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F" class="sect3">Performing Complete Recovery of Tablespaces in a PDB with Cloud Control</h3>
<div>
<div class="section">
<p>To perform complete recovery of tablespaces in a PDB with Oracle Enterprise Manager Cloud Control (Cloud Control), complete these steps:</p>
<ol>
<li>
<p>From the Database Home page, select <span class="bold">Backup &amp; Recovery</span> from the Availability menu, and then select <span class="bold">Perform Recovery</span>.</p>
</li>
<li>
<p>If you have not logged in to the database previously, the Database Login page is displayed. Log in to the database using Named or New credentials and then click <span class="bold">Login</span>.</p>
<p>Cloud Control displays the Perform Recovery page.</p>
</li>
<li>
<p>From the User Directed Recovery section, select <span class="bold">Tablespaces</span> from the Recovery Scope drop-down list, and then click <span class="bold">Recover</span>.</p>
</li>
<li>
<p>On the Perform Object Level Recovery:Point-in-time page, ensure that <span class="bold">Recover to the current time</span> is selected, and click <span class="bold">Next</span>.</p>
</li>
<li>
<p>On the Perform Object Level Recovery: Tablespaces page, select the tablespaces that you want to recover by completing these steps:</p>
<ol>
<li>
<p>Click <span class="bold">Add</span> to display the Available Tablespaces page.</p>
<p>The Search Results table shows all available tablespaces and includes the name of the PDB to which each tablespace belongs.</p>
</li>
<li>
<p>Click <span class="bold">Select</span> to designate the tablespaces that you want to recover. Optionally, you can click <span class="bold">Select All</span> to turn on the Select option for all available tablespaces. Click <span class="bold">Select None</span> to deselect all tablespaces.</p>
</li>
<li>
<p>Click the <span class="bold">Select</span> button to return to the Perform Object Level Recovery: Tablespaces page.</p>
</li>
<li>
<p>Optionally, you can remove tablespaces from the table by turning on the Select option for each tablespace that you want to remove and then clicking <span class="bold">Remove</span>.</p>
</li>
</ol>
</li>
<li>
<p>Click <span class="bold">Next</span> to move to the next step in the wizard.</p>
</li>
<li>
<p>Complete the wizard by navigating through the remainder of the pages to recover the PDB tablespace. For more information about each page of the wizard, click <span class="bold">Help</span>.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F__GUID-1A8A7785-7DCC-4E66-BEFD-982544C71CF6">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmintro.htm#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705">Accessing the Database Home Page Using Cloud Control</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV757"></a>
<div class="props_rev_3"><a id="GUID-9A824454-8577-4899-BD69-E631B573021F"></a>
<h3 id="BRADV-GUID-9A824454-8577-4899-BD69-E631B573021F" class="sect3">Performing Complete Recovering of CDBs After Switching to a Copy</h3>
<div>
<div class="section">
<p>If you have image copies of the inaccessible data files in your CDB or PDB, then you can recover lost changes by using the <code class="codeph">SWITCH</code> command to point the control file at the data file copies. The information in <span class="q">&#34;<a href="rcmcomre.htm#GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137">Performing Complete Recovery After Switching to a Copy</a>&#34;</span> applies to CDBs and PDBs with the following differences.</p>
<div class="infoboxnotealso" id="GUID-9A824454-8577-4899-BD69-E631B573021F__GUID-F782D35A-1964-44D6-9D59-666BB05E7A56">
<p class="notep1">See Also:</p>
<p><a href="rcmcomre.htm#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075">Scope of This Chapter</a> for some of the assumptions used in the recovery procedures</p>
</div>
<p>To switch a data file in a CDB, connect to the root and use the same steps that you would use for a non-CDB as described in <a href="rcmcomre.htm#GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572">Switching to a Data File Copy</a>.</p>
<p>To switch a data file in a PDB, use one of the following techniques:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Connect to the root and use the <code class="codeph">SWITCH ... PLUGGABLE DATABASE</code> or <code class="codeph">SWITCH DATAFILE</code> command. This enables you to switch the data files for one or more PDBs.</p>
</li>
<li>
<p>Connect to the PDB and use the <code class="codeph">SWITCH DATABASE</code> or <code class="codeph">SWITCH DATAFILE</code> command to switch data files in that PDB.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-9A824454-8577-4899-BD69-E631B573021F__GUID-E0C04B57-7431-4B20-96C6-E2CD46FD7675">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD">Making RMAN Connections to a CDB</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="rcmvalid.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="rcmflash.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>