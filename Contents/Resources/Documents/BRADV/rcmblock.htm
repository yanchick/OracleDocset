<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2663"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Performing%20Block%20Media%20Recovery"></a><title>Performing Block Media Recovery</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rcmflash.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rcmadvre.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-1E226393-17D0-4AB0-A05D-91210255D8FF"></a> <span id="PAGE" style="display:none;">31/48</span> <!-- End Header -->
<a id="BRADV89781"></a>
<h1 id="BRADV-GUID-1E226393-17D0-4AB0-A05D-91210255D8FF" class="sect1"><span class="enumeration_chapter">19</span> Performing Block Media Recovery</h1>
<div>
<p>This chapter explains how to restore and recover individual data blocks within a data file. This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmblock.htm#GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216">Overview of Block Media Recovery</a></p>
</li>
<li>
<p><a href="rcmblock.htm#GUID-C1164158-496C-4D8A-8A06-D343935FC3B9">Prerequisites for Block Media Recovery</a></p>
</li>
<li>
<p><a href="rcmblock.htm#GUID-21EFB177-2AC7-457C-80A0-63B11A80CD0B">Recovering Individual Blocks</a></p>
</li>
<li>
<p><a href="rcmblock.htm#GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB">Recovering All Blocks in V$DATABASE_BLOCK_CORRUPTION</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-1E226393-17D0-4AB0-A05D-91210255D8FF__GUID-CF62875B-819F-4CE6-B87A-5A137FA6EFB1">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF140" target="_blank" href="../RCMRF/rcmsynta2001.htm#RCMRF140"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">RECOVER</code> syntax</p>
</li>
<li>
<p><a class="olink REFRN30048" target="_blank" href="../REFRN/GUID-6CA088AF-B7B0-4CA1-8DC6-95372368BACC.htm#REFRN30048"><span class="italic">Oracle Database Reference</span></a> for details about <a id="d77933e108" class="indexterm-anchor"></a>the <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view</p>
</li>
</ul>
</div>
</div>
<a id="BRADV157"></a>
<div class="props_rev_3"><a id="GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216"></a>
<h2 id="BRADV-GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216" class="sect2">Overview of Block Media Recovery</h2>
<div>
<p>This section explains the purpose and basic concepts of block media recovery and contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmblock.htm#GUID-83CB3821-DCA8-459E-8038-CBD4D581A225">Purpose of Block Media Recovery</a></p>
</li>
<li>
<p><a href="rcmblock.htm#GUID-69B1C218-A199-4993-AC71-C87FE0376E32">Basic Concepts of Block Media Recovery</a></p>
</li>
</ul>
</div>
<a id="BRADV89782"></a>
<div class="props_rev_3"><a id="GUID-83CB3821-DCA8-459E-8038-CBD4D581A225"></a>
<h3 id="BRADV-GUID-83CB3821-DCA8-459E-8038-CBD4D581A225" class="sect3">Purpose of Block Media Recovery</h3>
<div>
<p>You can use <a href="glossary.htm#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">block media recovery</span></a> to recover one or more corrupt <a id="d77933e269" class="indexterm-anchor"></a>data blocks within a data file. Block media recovery provides the following advantages over <a href="glossary.htm#GUID-01B3A956-DA97-4B47-9600-FA5549B7E868"><span class="xrefglossterm">data file media recovery</span></a>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Lowers the <a href="glossary.htm#GUID-93551250-2FC8-4C64-92EF-492C40F74D85"><span class="xrefglossterm">mean time to recover (MTTR)</span></a> because only blocks needing recovery are restored and recovered</p>
</li>
<li>
<p>Enables affected data files to remain online during recovery</p>
<p>Without block media recovery, if even a single block is corrupt, then you must take the data file offline and restore a backup of the data file. You must apply all redo generated for the data file after the backup was created. The entire file is unavailable until media recovery completes. With block media recovery, only the blocks actually being recovered are unavailable during the recovery.</p>
</li>
</ul>
<p>Block media recovery is most useful for <a href="glossary.htm#GUID-6035D1EA-C660-4F45-B1AC-FE6B15810C54"><span class="xrefglossterm">physical corruption</span></a> problems that involve a small, well-known number of blocks. Block-level data loss usually results from intermittent, random I/O errors that do not cause widespread data loss, and memory corruptions that are written to disk. Block media recovery is not intended for cases where the extent of data loss or corruption is unknown and the entire data file requires recovery. In such cases, data file media recovery is the best solution.</p>
</div>
</div>
<a id="BRADV118"></a>
<div class="props_rev_3"><a id="GUID-69B1C218-A199-4993-AC71-C87FE0376E32"></a>
<h3 id="BRADV-GUID-69B1C218-A199-4993-AC71-C87FE0376E32" class="sect3">Basic Concepts of Block Media Recovery</h3>
<div>
<p>Usually, the database marks a block as media corrupt and then writes it to disk when the corruption is first encountered. No subsequent read of the block is successful until the block is recovered. You can perform block recovery only on blocks that are marked corrupt or that fail a corruption check.</p>
<p><a id="d77933e366" class="indexterm-anchor"></a>If the database on which the corruption occurs is associated with a real-time query physical standby database, then the database <span class="italic">automatically</span> attempts to perform block media recovery. The primary database searches for good copies of blocks on the standby database and, if they are found, repairs the blocks with no impact to the query that encountered the corrupt block. The Oracle Database physical block corruption message (<code class="codeph">ORA-1578</code>) is displayed only if the database cannot repair the corruption.</p>
<p>Whenever block corruption has been automatically detected, you can perform block media recovery manually with the <code class="codeph">RECOVER ... BLOCK</code> command. By default, RMAN first searches for good blocks in the real-time query physical standby database, then flashback logs and then blocks in full or level 0 incremental backups.</p>
<div class="infobox-note" id="GUID-69B1C218-A199-4993-AC71-C87FE0376E32__GUID-B08FB1C2-D7EF-4516-8F6B-A15DC08BB1BC">
<p class="notep1">Note:</p>
<p>For block media recovery to work automatically, the physical standby database must be in real-time query mode. An Oracle Active Data Guard license is required.</p>
</div>
<p>If a corrupt data block is discovered on a real-time query physical standby database, the server attempts to repair the corruption by obtaining a copy of the block from the primary database. The repair is performed in the background, enabling subsequent queries to succeed if the repair is successful. Automatic block repair is attempted if the following database initialization parameters are configured on the standby database as described:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">LOG_ARCHIVE_CONFIG</code> parameter is configured with a <code class="codeph">DG_CONFIG</code> list and a <code class="codeph">LOG_ARCHIVE_DEST_n</code> parameter is configured for the primary database with the <code class="codeph">DB_UNIQUE_NAME</code> attribute</p>
<p><span class="bold">or</span></p>
</li>
<li>
<p>The <code class="codeph">FAL_SERVER</code> parameter is configured and its value contains an Oracle Net service name for the primary database</p>
</li>
</ul>
<div class="infobox-note" id="GUID-69B1C218-A199-4993-AC71-C87FE0376E32__GUID-8905AFFC-0DFF-4C4F-9541-2B46AFF4AA5F">
<p class="notep1">Note:</p>
<p>If a corrupt block is detected during validation, such as by the RMAN <code class="codeph">VALIDATE</code> command, then recovery is <span class="italic">not</span> initiated automatically.</p>
</div>
<div class="infoboxnotealso" id="GUID-69B1C218-A199-4993-AC71-C87FE0376E32__GUID-C12E2D4C-A61E-43B4-8CD6-B0DA08301076">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF140" target="_blank" href="../RCMRF/rcmsynta2001.htm#RCMRF140"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">RECOVER ... BLOCK</code> syntax</p>
</li>
<li>
<p><a class="olink SBYDB00707" target="_blank" href="../SBYDB/manage_ps.htm#SBYDB00707"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn about the real-time query option for standby databases</p>
</li>
</ul>
</div>
</div>
<a id="BRADV89783"></a>
<div class="props_rev_3"><a id="GUID-BBD0093C-AC8D-490C-868C-FB5F83CB0870"></a>
<h4 id="BRADV-GUID-BBD0093C-AC8D-490C-868C-FB5F83CB0870" class="sect4">About Identifying Corrupt Blocks</h4>
<div>
<p><a id="d77933e509" class="indexterm-anchor"></a>The <a id="d77933e512" class="indexterm-anchor"></a><code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view displays blocks marked corrupt by database components such as RMAN, <code class="codeph">ANALYZE</code>, and SQL queries. The following types of corruption result in the addition of rows to this view:</p>
<ul style="list-style-type: disc;">
<li>
<p>Physical corruption (sometimes called media corruption)</p>
<p>The database does not recognize the block: the <a href="glossary.htm#GUID-36837841-FB21-45C7-A99A-FFC35D04FB0B"><span class="xrefglossterm">checksum</span></a> is invalid, the block contains all zeros, or the block header is corrupt.</p>
<p>Physical corruption checking is enabled by default. You can turn off checksum checking by specifying the <code class="codeph">NOCHECKSUM</code> option of the <code class="codeph">BACKUP</code> command, but other physical consistency checks, such as checks of the block headers and footers, cannot be disabled.</p>
</li>
<li>
<p>Logical corruption</p>
<p>The block has a valid checksum, the header and footer match, and so on, but the contents are logically inconsistent. Block media recovery may not be able to repair all logical block corruptions. In these cases, alternate recovery methods, such as tablespace point-in-time recovery, or dropping and re-creating the affected objects, may repair the corruption.</p>
<p>Logical corruption checking is disabled by default. You can turn it on by specifying the <code class="codeph">CHECK</code> <code class="codeph">LOGICAL</code> option of the <code class="codeph">BACKUP</code>, <code class="codeph">RESTORE</code>, <code class="codeph">RECOVER</code>, and <code class="codeph">VALIDATE</code> commands.</p>
</li>
</ul>
<p>The database can detect some corruptions by validating relationships between blocks and segments, but cannot detect them by a check of an individual block. The <a id="d77933e568" class="indexterm-anchor"></a><a id="d77933e572" class="indexterm-anchor"></a><code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view does not record at this level of granularity.</p>
</div>
</div>
<a id="BRADV359"></a><a id="BRADV89784"></a>
<div class="props_rev_3"><a id="GUID-EE0CBA84-C782-4DF1-981B-81003B040291"></a>
<h4 id="BRADV-GUID-EE0CBA84-C782-4DF1-981B-81003B040291" class="sect4">About Missing Redo During Block Recovery</h4>
<div>
<p>Like data file media recovery, block media recovery cannot generally survive a missing or inaccessible archived log, although it attempts restore failover when looking for usable copies of archived redo log files, as described in <span class="q">&#34;<a href="rcmrvcon.htm#GUID-D76CD1E8-2B9E-40F6-A13F-3264D6BA2B8C">About RMAN Restore Failover</a>&#34;</span>. Also, block media recovery cannot survive physical redo corruptions that result in <a href="glossary.htm#GUID-36837841-FB21-45C7-A99A-FFC35D04FB0B"><span class="xrefglossterm">checksum</span></a> failure. However, block media recovery can survive gaps in the redo stream if the missing or corrupt redo records do not affect the blocks being recovered. Whereas data file recovery requires an unbroken series of redo changes from the beginning of recovery to the end, block media recovery only requires an unbroken set of redo changes for the blocks being recovered.</p>
<div class="infobox-note" id="GUID-EE0CBA84-C782-4DF1-981B-81003B040291__GUID-7862473B-3D50-4203-8B2B-1689604A3489">
<p class="notep1">Note:</p>
<p>Each block is recovered independently during block media recovery, so recovery may be successful for a subset of blocks.</p>
</div>
<p>When RMAN first detects missing or corrupt redo records during block media recovery, it does not immediately signal an error because the block undergoing recovery may create one later in the redo stream. When a block is re-created, all previous redo for that block becomes irrelevant because the redo applies to an old incarnation of the block. For example, the database creates a new a block when users drop or truncate a table and then use the block for other data.</p>
<p>Assume that media recovery is performed on block 13 as depicted in <a href="rcmblock.htm#GUID-EE0CBA84-C782-4DF1-981B-81003B040291__CIHHCEFH">Figure 19-1</a>.</p>
<div class="figure" id="GUID-EE0CBA84-C782-4DF1-981B-81003B040291__CIHHCEFH">
<p class="titleinfigure">Figure 19-1 Performing RMAN Media Recovery</p>
<img width="496" height="131" src="img/GUID-0DB35F9A-8522-4AE2-889F-D84114613A29-default.gif" alt="Description of Figure 19-1 follows" title="Description of Figure 19-1 follows"/><br/>
<a href="img_text/GUID-0DB35F9A-8522-4AE2-889F-D84114613A29-print.htm">Description of &#34;Figure 19-1 Performing RMAN Media Recovery&#34;</a></div>
<!-- class="figure" -->
<p>After block recovery begins, RMAN discovers that change 120 is missing from the redo stream, either because the log block is corrupt or because the log cannot be found. RMAN continues recovery if block 13 is re-created later in the redo stream. Assume that in change 140 a user drops the table <code class="codeph">employees</code> stored in block 13, allocates a new table in this block, and inserts data into the new table. At this point, the database formats block 13 as a new block. Recovery can now proceed with this block even though some redo preceding the recreation operation was missing.</p>
</div>
</div>
</div>
</div>
<a id="BRADV89785"></a>
<div class="props_rev_3"><a id="GUID-C1164158-496C-4D8A-8A06-D343935FC3B9"></a>
<h2 id="BRADV-GUID-C1164158-496C-4D8A-8A06-D343935FC3B9" class="sect2">Prerequisites for Block Media Recovery</h2>
<div>
<p>The following prerequisites apply to the <code class="codeph">RECOVER ... BLOCK</code> command:</p>
<ul style="list-style-type: disc;">
<li>
<p>The target database must run in <code class="codeph">ARCHIVELOG</code> mode and be open or mounted with a current control file.</p>
</li>
<li>
<p>If the target database is a standby database, then it must be in a consistent state, recovery cannot be in session, and the backup must be older than the corrupted file.</p>
</li>
<li>
<p>The backups of the data files containing the corrupt blocks must be full or level 0 backups. They cannot be proxy copies or incremental backups.</p>
<p>If only <a href="glossary.htm#GUID-C4A7D804-0F77-4FA3-AA77-85D3C7E78E2B"><span class="xrefglossterm">proxy copy</span></a> backups exist, then you can restore them to a nondefault location on disk, in which case RMAN considers them data file copies and searches them for blocks during block media recovery.</p>
</li>
<li>
<p>RMAN can use only archived redo logs for the recovery.</p>
<p>RMAN cannot use level 1 incremental backups. Block media recovery cannot survive a missing or inaccessible archived redo log, although it can sometimes survive missing redo records.</p>
</li>
<li>
<p>Flashback Database must be enabled on the target database for RMAN to search the flashback logs for good copies of corrupt blocks.</p>
<p>If flashback logging is enabled and contains older, uncorrupted versions of the corrupt blocks, then RMAN can use these blocks, possibly speeding up the recovery.</p>
</li>
<li>
<p>The target database must be associated with a real-time query physical standby database for RMAN to search the database for good copies of corrupt blocks.</p>
</li>
</ul>
</div>
</div>
<a id="BRADV89786"></a>
<div class="props_rev_3"><a id="GUID-21EFB177-2AC7-457C-80A0-63B11A80CD0B"></a>
<h2 id="BRADV-GUID-21EFB177-2AC7-457C-80A0-63B11A80CD0B" class="sect2">Recovering Individual Blocks</h2>
<div>
<p>Typically, block corruption is reported in the following locations:</p>
<ul style="list-style-type: disc;">
<li>
<p>Results of the <code class="codeph">LIST FAILURE</code>, <code class="codeph">VALIDATE</code>, or <code class="codeph">BACKUP ... VALIDATE</code> command</p>
</li>
<li>
<p><a id="d77933e867" class="indexterm-anchor"></a>The <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view</p>
</li>
<li>
<p>Error messages in standard output</p>
</li>
<li>
<p>The alert log</p>
</li>
<li>
<p>User trace files</p>
</li>
<li>
<p>Results of the SQL commands <code class="codeph">ANALYZE</code> <code class="codeph">TABLE</code> and <code class="codeph">ANALYZE</code> <code class="codeph">INDEX</code></p>
</li>
<li>
<p>Results of the DBVERIFY utility</p>
</li>
<li>
<p>Third-party media management output</p>
</li>
</ul>
<p>For example, you may discover the following messages in a user trace file:</p>
<pre dir="ltr">ORA-01578: ORACLE data block corrupted (file # 7, block # 3)
ORA-01110: data file 7: &#39;/oracle/oradata/trgt/tools01.dbf&#39;
ORA-01578: ORACLE data block corrupted (file # 2, block # 235)
ORA-01110: data file 2: &#39;/oracle/oradata/trgt/undotbs01.dbf&#39;
</pre>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmblock.htm#GUID-B2CB58B5-C50E-41BC-8D4E-51C0F18D7D3F">Recovering Individual Blocks Using the RECOVER...BLOCK Command</a></p>
</li>
<li>
<p><a href="rcmblock.htm#GUID-3471570C-A181-403D-A4DE-66F1E400D310">Example: Recovering Individual Blocks Using the Data Recovery Advisor</a></p>
</li>
</ul>
</div>
<a id="BRADV360"></a><a id="BRADV856"></a>
<div class="props_rev_3"><a id="GUID-B2CB58B5-C50E-41BC-8D4E-51C0F18D7D3F"></a>
<h3 id="BRADV-GUID-B2CB58B5-C50E-41BC-8D4E-51C0F18D7D3F" class="sect3">Recovering Individual Blocks Using the RECOVER...BLOCK Command</h3>
<div>
<div class="section">
<p>In the following procedure, you identify the blocks that require recovery and then use any available backup to restore and recover these blocks.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover specific data blocks using the RECOVER...BLOCK command:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Obtain the data file numbers and block numbers of the corrupted blocks.</span>
<div>
<p>The easiest way to locate trace files and the alert log is to connect SQL*Plus to the target database and execute the following <a id="d77933e1001" class="indexterm-anchor"></a>query:</p>
<pre dir="ltr">SELECT NAME, VALUE 
FROM   V$DIAG_INFO;
</pre></div>
</li>
<li class="stepexpand"><span>Start RMAN and connect to the target database, which must be mounted or open.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">SHOW ALL</code> command to confirm that the appropriate channels are preconfigured.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">RECOVER ... BLOCK</code> command at the RMAN prompt, specifying the file and block numbers for the corrupted blocks.</span>
<div>
<p>The following example recovers two blocks.</p>
<pre dir="ltr">RECOVER 
  DATAFILE 8 BLOCK 13 
  DATAFILE 2 BLOCK 19;
</pre>
<p>You can also specify various options to control RMAN behavior. The following example indicates that only backups with the tag <code class="codeph">mondayam</code> are used when searching for blocks. You could use the <code class="codeph">FROM BACKUPSET</code> option to restrict the type of backup that RMAN searches, or the <code class="codeph">EXCLUDE FLASHBACK LOG</code> option to restrict RMAN from searching the flashback logs.</p>
<pre dir="ltr">RECOVER 
  DATAFILE 8 BLOCK 13 
  DATAFILE 2 BLOCK 199
  FROM TAG mondayam;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV857"></a>
<div class="props_rev_3"><a id="GUID-3471570C-A181-403D-A4DE-66F1E400D310"></a>
<h3 id="BRADV-GUID-3471570C-A181-403D-A4DE-66F1E400D310" class="sect3">Example: Recovering Individual Blocks Using the Data Recovery Advisor</h3>
<div>
<div class="section">
<p>You can use the Data Recovery Advisor to diagnose and repair failures caused by data block corruptions. In this example, corrupt data blocks were discovered when the <code class="codeph">VALIDATE DATABASE</code> command was run as described in <span class="q">&#34;<a href="rcmrepai.htm#GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271">Checking for Block Corruptions by Validating the Database</a>&#34;</span>.</p>
<p>To generate automated repair options and repair the failure using the Data Recovery Advisor:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the target database.</span>
<div>
<div class="infoboxnotealso" id="GUID-3471570C-A181-403D-A4DE-66F1E400D310__GUID-0449A261-2687-4789-887C-6FD141DB4218">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand" id="GUID-3471570C-A181-403D-A4DE-66F1E400D310__CHDFJHAD"><span>List the failures recorded by the Data Recovery Advisor using the following command:</span>
<div>
<pre dir="ltr">LIST FAILURE;

Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
5720       HIGH     OPEN      24-APR-14     Datafile 14:
 &#39;/home1/oracle/dbs/tbs_32.f&#39; contains one or more corrupt blocks
</pre></div>
</li>
<li class="stepexpand"><span>Generate repair options for the failure listed Step <a href="rcmblock.htm#GUID-3471570C-A181-403D-A4DE-66F1E400D310__CHDFJHAD">2</a>.</span>
<div>
<p>The following command generates repair options and creates a repair script to perform the automated repair tasks.</p>
<pre dir="ltr">ADVISE FAILURE;

Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
5720       HIGH     OPEN      24-APR-14     Datafile 14:
 &#39;/home1/oracle/dbs/tbs_32.f&#39; contains one or more corrupt blocks

analyzing automatic repair options; this may take some time
using channel ORA_DISK_1
analyzing automatic repair options complete

Mandatory Manual Actions
========================
no manual actions available

Optional Manual Actions
=======================
no manual actions available

Automated Repair Options
========================
Option Repair Description
------ ------------------
1      Perform block media recovery of block 20 in file 14  
  Strategy: The repair includes complete media recovery with no data loss
  Repair script: /home1/oracle/log/diag/rdbms/db12/hm/reco_287949467.hm

</pre></div>
</li>
<li class="stepexpand"><span>Perform the automated repairs recommended by Data Recovery Advisor.</span>
<div>
<p>RMAN uses the repair script generated by the <code class="codeph">ADVISE FAILURE</code> command to perform the required repairs.</p>
<pre dir="ltr">REPAIR FAILURE;

Strategy: The repair includes complete media recovery with no data loss
Repair script: /home1/oracle/log/diag/rdbms/db12/hm/reco_287949467.hm
contents of repair script:   
# block media recovery   recover datafile 14 block 20;
Do you really want to execute the above repair (enter YES or NO)? 
yes
executing repair script
Starting recover at 24-APR-14
using channel ORA_DISK_1
channel ORA_DISK_1: restoring block(s)channel 
ORA_DISK_1: specifying block(s) to restore from backup setrestoring blocks of datafile 00014
channel ORA_DISK_1: reading from backup piece /backups/DB121/backupset/2014_04_24/o1_mf_nnndf_TAG20140424T213309_9omsd7vb_.bkp
channel ORA_DISK_1: piece handle=/backups/DB121/backupset/2014_04_24/o1_mf_nnndf_TAG20140424T213309_9omsd7vb_.bkp tag=TAG20140424T213309
channel ORA_DISK_1: restored block(s) from backup piece 1
channel ORA_DISK_1: block restore complete, elapsed time: 00:00:01
starting media recovery
media recovery complete, elapsed time: 00:00:03
Finished recover at 24-APR-14repair failure complete
</pre>
<p>When the <code class="codeph">LIST FAILURE</code> command displays more than one failures, you can perform repair actions only for a particular failure. Use the option number displayed in the Automated Repair Options section of the <code class="codeph">ADVISE FAILURE</code> command output to perform specific repair actions.</p>
<p>The following command performs only the repair actions listed under Option 2 of the Automated Repair Options section.</p>
<pre dir="ltr">REPAIR FAILURE USING ADVISE OPTION 2;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-3471570C-A181-403D-A4DE-66F1E400D310__GUID-883EEEA6-6BB7-4607-ACA7-8367C8CFA3F3">
<p class="notep1">See Also:</p>
<p><a href="rcmrepai.htm#GUID-8C219B50-1F7F-4F7A-95EE-5F029AE7EB2A">Diagnosing and Repairing Failures with Data Recovery Advisor</a></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV361"></a><a id="BRADV200"></a>
<div class="props_rev_3"><a id="GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB"></a>
<h2 id="BRADV-GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB" class="sect2">Recovering All Blocks in V$DATABASE_BLOCK_CORRUPTION</h2>
<div>
<div class="section">
<p>In this scenario, RMAN automatically recovers all blocks listed in <a id="d77933e1249" class="indexterm-anchor"></a>the <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To recover all blocks logged in V$DATABASE_BLOCK_CORRUPTION:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect to the target database.</span></li>
<li class="stepexpand"><span>Query <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> to determine whether corrupt blocks exist. For example, execute the following statement:</span>
<div>
<pre dir="ltr">SQL&gt; SELECT * FROM V$DATABASE_BLOCK_CORRUPTION;
</pre></div>
</li>
<li class="stepexpand"><span>Start RMAN and connect to the target database.</span>
<div>
<div class="infoboxnotealso" id="GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB__GUID-115BD32F-63FA-433F-966B-42F9ADBDD6C0">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Recover all blocks marked corrupt in <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code>.</span>
<div>
<p>The following command repairs all physically corrupted blocks recorded in the view:</p>
<pre dir="ltr">RMAN&gt; RECOVER CORRUPTION LIST;
</pre>
<p>After the blocks are recovered, the database removes them from <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code>.</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB__GUID-DCB86457-6A4A-4B82-BB2C-42030CE78FA0">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF140" target="_blank" href="../RCMRF/rcmsynta2001.htm#RCMRF140"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> to learn about the <code class="codeph">RECOVER ... BLOCK</code> command</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="rcmflash.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="rcmadvre.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>