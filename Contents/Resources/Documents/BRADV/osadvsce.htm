<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2647"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Performing%20User-Managed%20Recovery%3A%20Advanced%20Scenarios"></a><title>Performing User-Managed Recovery: Advanced Scenarios</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="control files, restoring, to default location, to nondefault location, creating after loss of all copies, online redo logs, replacing damaged member, clearing inactive logs, archived, unarchived, tables, recovery of dropped, recovery, dropped table"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="osrecvry.htm" title="Previous" type="text/html"/>
<link rel="Next" href="glossary.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-24903185-E2CE-452E-8370-E4A47AD2632B"></a> <span id="PAGE" style="display:none;">46/48</span> <!-- End Header -->
<a id="BRADV018"></a>
<h1 id="BRADV-GUID-24903185-E2CE-452E-8370-E4A47AD2632B" class="sect1"><span class="enumeration_chapter">31</span> Performing User-Managed Recovery: Advanced Scenarios</h1>
<div>
<p><a id="d127551e67" class="indexterm-anchor"></a><a id="d127551e71" class="indexterm-anchor"></a>This <a id="d127551e76" class="indexterm-anchor"></a>chapter describes several common media failure scenarios. It shows how to recover from each failure when using a user-managed backup and recovery strategy, that is, a strategy that does not depend on Recovery Manager. This chapter contains the following topics:<a id="d127551e81" class="indexterm-anchor"></a><a id="d127551e85" class="indexterm-anchor"></a></p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osadvsce.htm#GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0">Responding to the Loss of a Subset of the Current Control Files</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0">Recovering After the Loss of All Current Control Files</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">Re-Creating a Control File</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-E0032019-E245-4EBD-B275-1343AA175239">Re-Creating Data Files When Backups Are Unavailable</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-617A3664-A605-4570-B22B-FE6793C469DF">Recovering NOLOGGING Tables and Indexes</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-22FCD8A3-128E-4BFA-8744-5969695034E9">Recovering Transportable Tablespaces</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2">Recovering After the Loss of Online Redo Log Files</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA">Recovering from a Dropped Table Without Using Flashback Features</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1">Dropping a Database with SQL*Plus</a></p>
</li>
</ul>
</div>
<a id="BRADV90039"></a>
<div class="props_rev_3"><a id="GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0"></a>
<h2 id="BRADV-GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0" class="sect2">Responding to the Loss of a Subset of the Current Control Files</h2>
<div>
<p><a id="d127551e204" class="indexterm-anchor"></a><a id="d127551e210" class="indexterm-anchor"></a>Use the following procedures to recover a database if a permanent media failure has damaged one or more control files of a database and at least one current control file has <span class="italic">not</span> been damaged by the media failure.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osadvsce.htm#GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC">Copying a Multiplexed Control File to a Default Location</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3">Copying a Multiplexed Control File to a Nondefault Location</a></p>
</li>
</ul>
</div>
<a id="BRADV508"></a><a id="BRADV90040"></a>
<div class="props_rev_3"><a id="GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC"></a>
<h3 id="BRADV-GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC" class="sect3">Copying a Multiplexed Control File to a Default Location</h3>
<div>
<div class="section">
<p><a id="d127551e316" class="indexterm-anchor"></a><a id="d127551e320" class="indexterm-anchor"></a>If the disk and file system containing the lost control file are intact, then you can simply copy an intact control file to the location of the missing control file. In this case, you do not have to edit the <code class="codeph">CONTROL_FILES</code> initialization parameter.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To replace a damaged control file by copying a multiplexed control file:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d127551e332" class="indexterm-anchor"></a><a id="d127551e336" class="indexterm-anchor"></a><a id="d127551e342" class="indexterm-anchor"></a><a id="d127551e346" class="indexterm-anchor"></a>If the instance is still running, then shut it down:</span>
<div>
<pre dir="ltr">SQL&gt; SHUTDOWN ABORT
</pre></div>
</li>
<li class="stepexpand"><span>Correct the hardware problem that caused the media failure. If you cannot repair the hardware problem quickly, then proceed with database recovery by restoring damaged control files to an alternative storage device, as described in <span class="q">&#34;<a href="osadvsce.htm#GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3">Copying a Multiplexed Control File to a Nondefault Location</a>&#34;</span>.</span></li>
<li class="stepexpand"><span>Use an intact multiplexed copy of the database&#39;s current control file to copy over the damaged control files. For example, to replace <code class="codeph">bad_cf.f</code> with <code class="codeph">good_cf.f</code>, you might enter:</span>
<div>
<pre dir="ltr">% cp /oracle/good_cf.f /oracle/dbs/bad_cf.f
</pre></div>
</li>
<li class="stepexpand"><span>Start a new instance and mount and open the database. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV509"></a><a id="BRADV90041"></a>
<div class="props_rev_3"><a id="GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3"></a>
<h3 id="BRADV-GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3" class="sect3">Copying a Multiplexed Control File to a Nondefault Location</h3>
<div>
<div class="section">
<p>If the disk and file system containing the lost control file are not intact, then you cannot copy a good control file to the location of the missing control file. In this case, you must alter the <code class="codeph">CONTROL_FILES</code> initialization parameter to indicate a new location for the missing control file.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To restore a control file to a nondefault location:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d127551e473" class="indexterm-anchor"></a><a id="d127551e477" class="indexterm-anchor"></a><a id="d127551e483" class="indexterm-anchor"></a><a id="d127551e487" class="indexterm-anchor"></a>If the instance is still running, then shut it down:</span>
<div>
<pre dir="ltr">SQL&gt; SHUTDOWN ABORT
</pre></div>
</li>
<li class="stepexpand"><span>If you cannot correct the hardware problem that caused the media failure, then copy the intact control file to alternative location.</span>
<div>
<p>For example, to copy a good version of <code class="codeph">control01.dbf</code> to a new disk location you might issue the following commands:</p>
<pre dir="ltr">% cp /disk1/oradata/trgt/control01.dbf /new_disk/control01.dbf
</pre></div>
</li>
<li class="stepexpand"><span>Edit the parameter file of the database so that the <a id="d127551e509" class="indexterm-anchor"></a><a id="d127551e513" class="indexterm-anchor"></a><code class="codeph">CONTROL_FILES</code> parameter reflects the current locations of all control files and excludes all control files that were not restored.</span>
<div>
<p>Assume that the initialization parameter file contains the following setting:</p>
<pre dir="ltr">CONTROL_FILES=&#39;/disk1/oradata/trgt/control01.dbf&#39;,&#39;/bad_disk/control02.dbf&#39;
</pre>
<p>You can edit the <code class="codeph">CONTROL_FILES</code> initialization parameter as follows:</p>
<pre dir="ltr">CONTROL_FILES=&#39;/disk1/oradata/trgt/control01.dbf&#39;,&#39;/new_disk/control02.dbf&#39;
</pre></div>
</li>
<li class="stepexpand"><span>Start a new instance and mount and open the database. For example:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP
</pre></div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV510"></a><a id="BRADV90042"></a>
<div class="props_rev_3"><a id="GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0"></a>
<h2 id="BRADV-GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0" class="sect2">Recovering After the Loss of All Current Control Files</h2>
<div>
<p>Use the following procedures to restore a backup control file if a permanent media failure has damaged all control files of a database and you have a backup of the control file. When a control file is inaccessible, you can start the instance, but not mount the database. If you attempt to mount the database when the control file is unavailable, then you receive the following error message:</p>
<pre dir="ltr">ORA-00205: error in identifying control file, check alert log for more info 
</pre>
<div class="infobox-note" id="GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0__GUID-57E684EC-3EB5-4A93-9DA9-7372ECBB8C89">
<p class="notep1">Note:</p>
<p>The easiest way to locate trace files and the alert log is to run the following SQL query: <code class="codeph">SELECT NAME, VALUE FROM V$DIAG_INFO</code>.</p>
</div>
<p>You cannot mount and open the database until the control file is accessible again. If you restore a backup control file, then you must open the database with the <code class="codeph">RESETLOGS</code> option.</p>
<p>As indicated in <a href="osadvsce.htm#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0__CHDHFGEI" title="This table lists restore procedures for several scenarios in which the control files are lost, depending upon the status of the online logs and datafiles.">Table 31-1</a>, the procedure for restoring the control file depends on whether the online redo logs are available.</p>
<div class="tblformal" id="GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0__CHDHFGEI">
<p class="titleintable">Table 31-1 Scenarios When Control Files Are Lost</p>
<table class="cellalignment515" title="Scenarios When Control Files Are Lost" summary="This table lists restore procedures for several scenarios in which the control files are lost, depending upon the status of the online logs and datafiles.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment516" id="d127551e638">Status of Online Logs</th>
<th class="cellalignment516" id="d127551e641">Status of Data Files</th>
<th class="cellalignment517" id="d127551e644">Restore Procedure</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment518" id="d127551e649" headers="d127551e638">
<p>Available</p>
</td>
<td class="cellalignment518" headers="d127551e649 d127551e641">
<p>Current</p>
</td>
<td class="cellalignment519" headers="d127551e649 d127551e644">
<p>If the online logs contain redo necessary for recovery, then restore a backup control file and apply the logs during recovery. You must specify the file name of the online logs containing the changes to open the database. After recovery, open the database with the <code class="codeph">RESETLOGS</code> option.</p>
<p><span class="bold">Note:</span> If you re-create a control file, then it is not necessary to use the <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code> option after recovery when the online redo logs are accessible.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment518" id="d127551e672" headers="d127551e638">
<p>Unavailable</p>
</td>
<td class="cellalignment518" headers="d127551e672 d127551e641">
<p>Current</p>
</td>
<td class="cellalignment519" headers="d127551e672 d127551e644">
<p>If the online logs contain redo necessary for recovery, then re-create the control file. Because the online redo logs are inaccessible, open <code class="codeph">RESETLOGS</code>.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment518" id="d127551e685" headers="d127551e638">
<p>Available</p>
</td>
<td class="cellalignment518" headers="d127551e685 d127551e641">
<p>Backup</p>
</td>
<td class="cellalignment519" headers="d127551e685 d127551e644">
<p>Restore a backup control file, perform complete recovery, and then open the database with the <code class="codeph">RESETLOGS</code> option.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment518" id="d127551e698" headers="d127551e638">
<p>Unavailable</p>
</td>
<td class="cellalignment518" headers="d127551e698 d127551e641">
<p>Backup</p>
</td>
<td class="cellalignment519" headers="d127551e698 d127551e644">
<p>Restore a backup control file, perform incomplete recovery, and then open <code class="codeph">RESETLOGS</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osadvsce.htm#GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE">Recovering with a Backup Control File in the Default Location</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF">Recovering with a Backup Control File in a Nondefault Location</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-88CAB555-C409-4805-B6A4-C92401422EF7">Recovering Through an Added Data File with a Backup Control File</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-CEF04736-4A56-4560-AD8E-948300F6C80F">Recovering Read-Only Tablespaces with a Backup Control File</a></p>
</li>
</ul>
</div>
<a id="BRADV511"></a><a id="BRADV90043"></a>
<div class="props_rev_3"><a id="GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE"></a>
<h3 id="BRADV-GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE" class="sect3">Recovering with a Backup Control File in the Default Location</h3>
<div>
<div class="section">
<p>If possible, restore the control file to its original location. In this way, you avoid having to specify new control file locations in the initialization parameter file.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To restore a backup control file to its default location:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>If the instance is still running, shut it down:</span>
<div>
<pre dir="ltr">SQL&gt; SHUTDOWN ABORT
</pre></div>
</li>
<li class="stepexpand"><span>Correct the hardware problem that caused the media failure.</span></li>
<li class="stepexpand"><span>Restore the backup control file to all locations specified in the <code class="codeph">CONTROL_FILES</code> parameter in the server parameter file or initialization parameter file. For example, if <code class="codeph">/disk1/oradata/trgt/control01.dbf</code> and <code class="codeph">/disk2/oradata/trgt/control02.dbf</code> are the control file locations listed in the server parameter file, then use an operating system utility to restore the backup control file to these locations:</span>
<div>
<pre dir="ltr">% cp /backup/control01.dbf /disk1/oradata/trgt/control01.dbf
% cp /backup/control02.dbf /disk2/oradata/trgt/control02.dbf
</pre></div>
</li>
<li class="stepexpand"><span>Start a new instance and mount the database. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP MOUNT 
</pre></div>
</li>
<li class="stepexpand"><span>Begin recovery by executing the <code class="codeph">RECOVER</code> command with the <code class="codeph">USING</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> clause. Specify <code class="codeph">UNTIL</code> <code class="codeph">CANCEL</code> if you are performing incomplete recovery. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; RECOVER DATABASE USING BACKUP CONTROLFILE UNTIL CANCEL
</pre></div>
</li>
<li class="stepexpand"><span>Apply the prompted archived logs. If you then receive another message saying that the required archived log is missing, then it probably means that a necessary redo record is located in the online redo logs. This situation can occur when unarchived changes were located in the online logs when the instance failed.</span>
<div>
<p>For example, assume that you see the following:</p>
<pre dir="ltr">ORA-00279: change 55636 generated at 11/08/2002 16:59:47 needed for thread 1
ORA-00289: suggestion : /oracle/work/arc_dest/arcr_1_111.arc
ORA-00280: change 55636 for thread 1 is in sequence #111
Specify log: {&lt;RET&gt;=suggested | filename | AUTO | CANCEL}
</pre>
<p>You can specify the name of an online redo log and press Enter (you may have to try this a few times until you find the correct log):</p>
<pre dir="ltr"><span class="italic">ORACLE_HOME</span>/oradata/redo01.dbf
Log applied.
Media recovery complete.
</pre>
<p>If the online logs are inaccessible, then you can cancel recovery without applying them. If all data files are current, and if redo in the online logs is required for recovery, then you cannot open the database without applying the online logs. If the online logs are inaccessible, then you must re-create the control file, using the procedure described in <span class="q">&#34;<a href="osadvsce.htm#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">Re-Creating a Control File</a>&#34;</span>.</p>
</div>
</li>
<li class="stepexpand"><span>Open the database with the <code class="codeph">RESETLOGS</code> option after finishing recovery:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE OPEN RESETLOGS;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV512"></a><a id="BRADV90044"></a>
<div class="props_rev_3"><a id="GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF"></a>
<h3 id="BRADV-GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF" class="sect3">Recovering with a Backup Control File in a Nondefault Location</h3>
<div>
<div class="section">
<p>If you cannot restore the control file to its original place because the media damage is too severe, then you must specify new control file locations in the server parameter file. A valid control file must be available in all locations specified by the <code class="codeph">CONTROL_FILES</code> initialization parameter. If not, then the database prevents you from the mounting the database.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To restore a control file to a nondefault location:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Follow the steps in <span class="q">&#34;<a href="osadvsce.htm#GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE">Recovering with a Backup Control File in the Default Location</a> &#34;</span>, except after Step 2 add the following step:</p>
<p>Edit all locations specified in the <code class="codeph">CONTROL_FILES</code> initialization parameter to reflect the new control file locations. Assume that the control file locations listed in the server parameter file are as follows, and both disks are inaccessible:</p>
<pre dir="ltr">CONTROL_FILES=&#39;/disk1/oradata/trgt/control01.dbf&#39;,
              &#39;/disk2/oradata/trgt/control02.dbf&#39;
</pre>
<p>You can edit the initialization parameter file and specify accessible locations, as shown in the following example:</p>
<pre dir="ltr">CONTROL_FILES=&#39;/disk3/cf/control01.dbf&#39;,&#39;/disk4/cf/control02.dbf&#39;
</pre></div>
<!-- class="section" --></div>
</div>
<a id="BRADV513"></a><a id="BRADV223"></a>
<div class="props_rev_3"><a id="GUID-88CAB555-C409-4805-B6A4-C92401422EF7"></a>
<h3 id="BRADV-GUID-88CAB555-C409-4805-B6A4-C92401422EF7" class="sect3">Recovering Through an Added Data File with a Backup Control File</h3>
<div>
<div class="section">
<p><a id="d127551e1063" class="indexterm-anchor"></a><a id="d127551e1067" class="indexterm-anchor"></a><a id="d127551e1071" class="indexterm-anchor"></a>If database recovery with a backup control file rolls forward through a <code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code> or an <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">ADD</code> <code class="codeph">DATAFILE</code> operation, then the database stops recovery when applying the redo record for the added files and lets you confirm the file names.</p>
<p>For example, suppose that the following sequence of events occurs:</p>
<ol>
<li>
<p>You back up the database.</p>
</li>
<li>
<p>You create a tablespace containing the following data files: <code class="codeph">/disk1/oradata/trgt/test01.dbf</code> and <code class="codeph">/disk1/oradata/trgt/test02.dbf</code>.</p>
</li>
<li>
<p><a id="d127551e1112" class="indexterm-anchor"></a>You restore a backup control file and perform media recovery through the <code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code> operation.</p>
</li>
</ol>
<p>You may see the following error when applying the <code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code> redo data:</p>
<pre dir="ltr">ORA-00283: recovery session canceled due to errors 
ORA-01244: unnamed datafile(s) added to control file by media recovery
ORA-01110: data file 11: &#39;/disk1/oradata/trgt/test02.dbf&#39;
ORA-01110: data file 10: &#39;/disk1/oradata/trgt/test01.dbf&#39;
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover through an ADD DATAFILE operation:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>View the files added by querying <code class="codeph">V$DATAFILE</code>., as in the following example:</span>
<div>
<pre dir="ltr">SELECT FILE#,NAME 
FROM V$DATAFILE;

FILE#           NAME
--------------- ----------------------
1               /disk1/oradata/trgt/system01.dbf
.
.
.
10               /disk1/oradata/trgt/UNNAMED00001
11               /disk1/oradata/trgt/UNNAMED00002
</pre></div>
</li>
<li class="stepexpand"><span>If multiple unnamed files exist, then determine which unnamed file corresponds to which data file by using one of these methods:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>Open the <code class="codeph">alert_</code><span class="italic"><code class="codeph">SID</code></span><code class="codeph">.log</code>, which contains messages about the original file location for each unnamed file.</p>
</li>
<li>
<p>Derive the original file location of each unnamed file from the error message and <code class="codeph">V$DATAFILE</code>: each unnamed file corresponds to the file in the error message with the same file number.</p>
</li>
</ul>
</div>
</li>
<li class="stepexpand"><span>Issue the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code> statement to rename the data files. For example, enter:</span>
<div>
<pre dir="ltr">ALTER DATABASE RENAME FILE &#39;/db/UNNAMED00001&#39; TO
                           &#39;/disk1/oradata/trgt/test01.dbf&#39;;
ALTER DATABASE RENAME FILE &#39;/db/UNNAMED00002&#39; TO
                           &#39;/disk1/oradata/trgt/test02.dbf&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>Continue recovery by issuing the recovery statement. For example:</span>
<div>
<pre dir="ltr">RECOVER AUTOMATIC DATABASE USING BACKUP CONTROLFILE UNTIL CANCEL
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV227"></a>
<div class="props_rev_3"><a id="GUID-CEF04736-4A56-4560-AD8E-948300F6C80F"></a>
<h3 id="BRADV-GUID-CEF04736-4A56-4560-AD8E-948300F6C80F" class="sect3">Recovering Read-Only Tablespaces with a Backup Control File</h3>
<div>
<div class="section">
<p>If you have a read-only tablespace on read-only or slow media, then you may encounter errors or poor performance when recovering with the <a id="d127551e1261" class="indexterm-anchor"></a><code class="codeph">USING</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> option. This situation occurs when the backup control file indicates that a tablespace was read/write when the control file was backed up. In this case, media recovery may attempt to write to the files. For read-only media, the database issues an error saying that it cannot write to the files. For slow media, such as a hierarchical storage system backed up by tapes, performance may suffer.</p>
<p>To avoid these problems, use current control files rather than backups to recover the database. If you must use a backup control file, then you can also avoid this problem if the read-only tablespace has not suffered a media failure. You have the following alternatives for recovering read-only and slow media when using a backup control file:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Take data files from read-only tablespaces offline before doing recovery with a backup control file, and then bring the files online after media recovery.</p>
</li>
<li>
<p>Use the correct version of the control file for the recovery. If the tablespace is read-only when recovery completes, then the control file backup must be from a time when the tablespace was read-only. Similarly, if the tablespace is read/write after recovery, then the control file must be from a time when the tablespace was read/write.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV514"></a><a id="BRADV515"></a><a id="BRADV657"></a><a id="BRADV90045"></a>
<div class="props_rev_3"><a id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D"></a>
<h2 id="BRADV-GUID-9152B9A8-308A-4871-B835-53AF7593E65D" class="sect2">Re-Creating a Control File</h2>
<div>
<div class="section">
<p><a id="d127551e1364" class="indexterm-anchor"></a><a id="d127551e1368" class="indexterm-anchor"></a><a id="d127551e1372" class="indexterm-anchor"></a>If all control files have been lost in a permanent media failure, but all online redo log members remain intact, then you can recover the database after creating a new control file. You are <span class="italic">not</span> required to open the database with the <code class="codeph">RESETLOGS</code> option after the recovery.</p>
<p>Depending on the existence and currency of a control file backup, you have the options listed in <a href="osadvsce.htm#GUID-9152B9A8-308A-4871-B835-53AF7593E65D__CHDJJGII" title="This table details different options for recreating your control file, depending upon available resources.">Table 31-2</a> for generating the text of the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement. The changes to the database are recorded in the <span class="italic">alert_SID.log</span>, so check this log when you are deciding which option to choose.</p>
<div class="tblformal" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__CHDJJGII">
<p class="titleintable">Table 31-2 Options for Creating the Control File</p>
<table class="cellalignment515" title="Options for Creating the Control File" summary="This table details different options for recreating your control file, depending upon available resources.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment517" id="d127551e1409">If you...</th>
<th class="cellalignment517" id="d127551e1412">Then...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment519" id="d127551e1417" headers="d127551e1409">
<p>Executed <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> <code class="codeph">NORESETLOGS</code> after you made the last structural change to the database, and if you have saved the SQL command trace output</p>
</td>
<td class="cellalignment519" headers="d127551e1417 d127551e1412">
<p>Use the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement from the trace output as-is.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment519" id="d127551e1452" headers="d127551e1409">
<p>Performed your most recent execution of <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> before you made a structural change to the database</p>
</td>
<td class="cellalignment519" headers="d127551e1452 d127551e1412">
<p>Edit the output of <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> to reflect the change. For example, if you recently added a data file to the database, then add this data file to the <code class="codeph">DATAFILE</code> clause of the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment519" id="d127551e1506" headers="d127551e1409">
<p>Backed up the control file with the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <span class="italic"><code class="codeph">filename</code></span> statement (not the <code class="codeph">TO</code> <code class="codeph">TRACE</code> option)</p>
</td>
<td class="cellalignment519" headers="d127551e1506 d127551e1412">
<p>Use the control file copy to obtain SQL output. Create a temporary database instance, mount the backup control file, and then run <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> <code class="codeph">NORESETLOGS</code>. If the control file copy predated a recent structural change, then edit the trace option to reflect the change.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment519" id="d127551e1561" headers="d127551e1409">
<p>Do not have a control file backup in either <code class="codeph">TO</code> <code class="codeph">TRACE</code> format or <code class="codeph">TO</code> <span class="italic"><code class="codeph">filename</code></span> format</p>
</td>
<td class="cellalignment519" headers="d127551e1561 d127551e1412">
<p>Execute the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement manually (See <a class="olink SQLRF01203" target="_blank" href="../SQLRF/statements_5004.htm#SQLRF01203"><span class="italic">Oracle Database SQL Language Reference</span></a>).</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infobox-note" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__GUID-B53F9FE3-6505-4B59-AC76-0B18995DFA00">
<p class="notep1">Note:</p>
<p>If your character set is not the default US7ASCII, then you must specify the character set as an argument to the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement. The database character set is written to the alert log at startup. The character set information is also recorded in the <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> output.</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To create a control file and recover the database:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Start the database in <code class="codeph">NOMOUNT</code> mode. For example, enter:</p>
<pre dir="ltr">STARTUP NOMOUNT
</pre></li>
<li>
<p>Create the control file with the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement, specifying the <code class="codeph">NORESETLOGS</code> option (See to <a href="osadvsce.htm#GUID-9152B9A8-308A-4871-B835-53AF7593E65D__CHDJJGII" title="This table details different options for recreating your control file, depending upon available resources.">Table 31-2</a> for options). The following example assumes that the character set is the default US7ASCII:</p>
<pre dir="ltr">CREATE CONTROLFILE REUSE DATABASE SALES NORESETLOGS ARCHIVELOG
     MAXLOGFILES 32
     MAXLOGMEMBERS 2
     MAXDATAFILES 32
     MAXINSTANCES 16
     MAXLOGHISTORY 1600
LOGFILE
     GROUP 1 (
       &#39;/diska/prod/sales/db/log1t1.dbf&#39;,
       &#39;/diskb/prod/sales/db/log1t2.dbf&#39;
     )  SIZE 100K,
     GROUP 2 (
       &#39;/diska/prod/sales/db/log2t1.dbf&#39;,
       &#39;/diskb/prod/sales/db/log2t2.dbf&#39;
     )  SIZE 100K
DATAFILE
     &#39;/diska/prod/sales/db/database1.dbf&#39;,
     &#39;/diskb/prod/sales/db/filea.dbf&#39;;
</pre>
<p>After creating the control file, the instance mounts the database.</p>
</li>
<li>
<p>Recover the database as usual (<span class="italic">without</span> specifying the <code class="codeph">USING</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> clause):</p>
<pre dir="ltr">RECOVER DATABASE
</pre></li>
<li>
<p>Open the database after recovery completes (the <code class="codeph">RESETLOGS</code> option is not required):</p>
<pre dir="ltr">ALTER DATABASE OPEN;
</pre></li>
<li>
<p>Immediately back up the control file. The following SQL statement backs up a database&#39;s control file to <code class="codeph">/backup/control01.dbf</code>:</p>
<pre dir="ltr">ALTER DATABASE BACKUP CONTROLFILE TO &#39;/backup/control01.dbf&#39; REUSE;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To create a control file for a multitenant container database:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Ensure that the <a href="glossary.htm#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">multitenant container database (CDB)</span></a> is not mounted in any instance.</span></li>
<li><span>Open SQL*Plus.</span></li>
<li><span>Connect to the <a href="glossary.htm#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a> as a user with the <code class="codeph">SYSDBA</code> privilege.</span></li>
<li><span>Follow the previous procedure for creating a control file and recovering the database.</span></li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__GUID-B0994BAA-93B1-4E4D-9499-C183AB4EEE98">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="osbackup.htm#GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD">Backing Up the Control File to a Trace File</a>&#34;</span>, and <span class="q">&#34;<a href="osadvsce.htm#GUID-E0032019-E245-4EBD-B275-1343AA175239">Re-Creating Data Files When Backups Are Unavailable</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
<a id="BRADV225"></a>
<div class="props_rev_3"><a id="GUID-FFEB9655-0049-4AF5-9412-2C3F97375100"></a>
<h3 id="BRADV-GUID-FFEB9655-0049-4AF5-9412-2C3F97375100" class="sect3">Recovering Through a RESETLOGS with a Created Control File</h3>
<div>
<div class="section">
<p>You can recover backups through an <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code> operation so long as:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>You have a current, backup, or created control file that detects prior incarnations</p>
</li>
<li>
<p>You have all available archived redo logs</p>
</li>
</ul>
<p>If you must re-create the control file, then the trace file generated by <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> contains the necessary commands to reconstruct the complete incarnation history. The <code class="codeph">V$DATABASE_INCARNATION</code> view displays the <code class="codeph">RESETLOGS</code> history of the control file, and the <code class="codeph">V$LOG_HISTORY</code> view displays the archived log history.</p>
<p>It is possible for the incarnation history to be incomplete in the in re-created control file. For example, archived logs necessary for recovery may be missing. In this case, it is possible to create incarnation records explicitly with the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">REGISTER</code> <code class="codeph">LOGFILE</code> statement.</p>
<p>In the following example, you register four logs that are necessary for recovery but are not recorded in the re-created control file, and then recover the database:</p>
<pre dir="ltr">ALTER DATABASE REGISTER LOGFILE &#39;/disk1/oradata/trgt/arch/arcr_1_1_42343523.arc&#39;;
ALTER DATABASE REGISTER LOGFILE &#39;/disk1/oradata/trgt/arch/arcr_1_1_34546466.arc&#39;;
ALTER DATABASE REGISTER LOGFILE &#39;/disk1/oradata/trgt/arch/arcr_1_1_23435466.arc&#39;;
ALTER DATABASE REGISTER LOGFILE &#39;/disk1/oradata/trgt/arch/arcr_1_1_12343533.arc&#39;;
RECOVER AUTOMATIC DATABASE;
</pre></div>
<!-- class="section" --></div>
</div>
<a id="BRADV516"></a><a id="BRADV90046"></a>
<div class="props_rev_3"><a id="GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6"></a>
<h3 id="BRADV-GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6" class="sect3">Recovery of Read-Only Files with a Re-Created Control File</h3>
<div>
<div class="section">
<p>If a current or backup control file is unavailable for recovery, then you can execute a <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement. Do not list read-only files in the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement so recovery can skip them. No recovery is required for read-only data files unless you restored backups of these files when the data files were read/write.</p>
<p>After you create a control file and attempt to mount and open the database, the database performs a data dictionary check against the files listed in the control file. For each file that is not listed in the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement but is present in the data dictionary, an entry is created for them in the control file. These files are named as <code class="codeph">MISSING</code><span class="italic"><code class="codeph">nnnnn</code></span>, where <span class="italic"><code class="codeph">nnnnn</code></span> is a 5-digit number starting with <code class="codeph">0</code>.</p>
<p>After the database is open, rename the read-only files to their correct file names by executing the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code> statement for all the files whose names are prefixed with <code class="codeph">MISSING</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To prepare for a scenario in which you might have to re-create the control file:</p>
</div>
<!-- class="section" -->
<div class="section">
<p>Run the following statement when the database is mounted or open to obtain the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> syntax:</p>
<pre dir="ltr">ALTER DATABASE BACKUP CONTROLFILE TO TRACE;
</pre>
<p>The preceding SQL statement produces a trace file that you can edit and use as a script to re-create the control file. You can specify either the <code class="codeph">RESETLOGS</code> or <code class="codeph">NORESETLOGS</code> (default) keywords to generate <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">...</code> <code class="codeph">RESETLOGS</code> or <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">...</code> <code class="codeph">NORESETLOGS</code> versions of the script.</p>
<p>All the restrictions related to read-only files in <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statements also apply to offline normal tablespaces, except that you must to bring the tablespace online after the database is open. Omit temp files from the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement and add them after opening the database.</p>
<div class="infoboxnotealso" id="GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6__GUID-1AD30680-DCDF-428B-A8D7-A43A757868B9">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="osbackup.htm#GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD">Backing Up the Control File to a Trace File</a>&#34;</span> to learn how to make trace backups of the control file</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV517"></a><a id="BRADV224"></a>
<div class="props_rev_3"><a id="GUID-E0032019-E245-4EBD-B275-1343AA175239"></a>
<h2 id="BRADV-GUID-E0032019-E245-4EBD-B275-1343AA175239" class="sect2">Re-Creating Data Files When Backups Are Unavailable</h2>
<div>
<div class="section">
<p>If a data file is damaged and no backup of the file is available, then you can still recover the data file if:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>All archived log files written after the creation of the original data file are available</p>
</li>
<li>
<p>The control file contains the name of the damaged file (that is, the control file is current, or is a backup taken after the damaged data file was added to the database)</p>
<div class="infobox-note" id="GUID-E0032019-E245-4EBD-B275-1343AA175239__GUID-42FEA55F-0769-4936-98E4-B5F24E420C5D">
<p class="notep1">Note:</p>
<p>You cannot re-create any of the data files for the <code class="codeph">SYSTEM</code> tablespace by using the <code class="codeph">CREATE</code> <code class="codeph">DATAFILE</code> clause of the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> statement because the necessary redo is not available.</p>
</div>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To re-create a data file for recovery:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d127551e2146" class="indexterm-anchor"></a>Create an empty data file to replace a damaged data file that has no corresponding backup. For example, assume that data file <code class="codeph">/disk1/oradata/trgt/users01.dbf</code> is damaged, and no backup is available. The following statement re-creates the original data file (same size) on <code class="codeph">disk2</code>:</span>
<div>
<pre dir="ltr">ALTER DATABASE CREATE DATAFILE &#39;/disk1/oradata/trgt/users01.dbf&#39; AS
                               &#39;/disk2/users01.dbf&#39;;
</pre>
<p>This statement creates an empty file that is the same size as the lost file. The database looks at information in the control file and the data dictionary to obtain size information. The old data file is renamed as the new data file.</p>
</div>
</li>
<li class="stepexpand"><span>Perform media recovery on the empty data file. For example, enter:</span>
<div>
<pre dir="ltr">RECOVER DATAFILE &#39;/disk2/users01.dbf&#39;
</pre></div>
</li>
<li class="stepexpand"><span>All archived logs written after the original data file was created must be applied to the new, empty version of the lost data file during recovery.</span></li>
</ol>
</div>
</div>
<a id="BRADV90047"></a>
<div class="props_rev_3"><a id="GUID-617A3664-A605-4570-B22B-FE6793C469DF"></a>
<h2 id="BRADV-GUID-617A3664-A605-4570-B22B-FE6793C469DF" class="sect2">Recovering NOLOGGING Tables and Indexes</h2>
<div>
<div class="section">
<p>You can create tables and indexes with the <a id="d127551e2240" class="indexterm-anchor"></a><a id="d127551e2244" class="indexterm-anchor"></a><a id="d127551e2248" class="indexterm-anchor"></a><code class="codeph">CREATE</code> <code class="codeph">TABLE</code> <code class="codeph">AS</code> <code class="codeph">SELECT</code> statement. You can also specify that the database create them with the <code class="codeph">NOLOGGING</code> option. When you create a table or index as <code class="codeph">NOLOGGING</code>, the database does not generate redo log records for the operation. Thus, you cannot recover objects created with <code class="codeph">NOLOGGING</code>, even if you run in <code class="codeph">ARCHIVELOG</code> mode.</p>
<div class="infobox-note" id="GUID-617A3664-A605-4570-B22B-FE6793C469DF__GUID-20BD200D-F92D-43EA-80E4-2A7AB347A4B8">
<p class="notep1">Note:</p>
<p>If you cannot afford to lose tables or indexes created with <code class="codeph">NOLOGGING</code>, then make a backup after the unrecoverable table or index is created.</p>
</div>
<p>Be aware that when you perform media recovery, and some tables or indexes are created normally whereas others are created with the <code class="codeph">NOLOGGING</code> option, the <code class="codeph">NOLOGGING</code> objects are marked logically corrupt by the <code class="codeph">RECOVER</code> operation. Any attempt to access the unrecoverable objects returns an <a id="d127551e2294" class="indexterm-anchor"></a><a id="d127551e2298" class="indexterm-anchor"></a><a id="d127551e2302" class="indexterm-anchor"></a><code class="codeph">ORA-01578</code> error message. Drop the <code class="codeph">NOLOGGING</code> objects and re-create them if needed.</p>
<p>Because it is possible to create a table with the <code class="codeph">NOLOGGING</code> option and then create an index with the <code class="codeph">LOGGING</code> option on that table, the index is not marked as logically corrupt after you perform media recovery. The table was unrecoverable (and thus marked as corrupt after recovery), however, so the index points to corrupt blocks. The index must be dropped, and the table and index must be re-created if necessary.</p>
<div class="infoboxnotealso" id="GUID-617A3664-A605-4570-B22B-FE6793C469DF__GUID-2FAA8975-53CD-4BE8-8281-533CBFF84F2E">
<p class="notep1">See Also:</p>
<p><a class="olink SBYDB00920" target="_blank" href="../SBYDB/scenarios.htm#SBYDB00920"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for information about the effect of <code class="codeph">NOLOGGING</code> on a database</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV518"></a><a id="BRADV228"></a>
<div class="props_rev_3"><a id="GUID-22FCD8A3-128E-4BFA-8744-5969695034E9"></a>
<h2 id="BRADV-GUID-22FCD8A3-128E-4BFA-8744-5969695034E9" class="sect2">Recovering Transportable Tablespaces</h2>
<div>
<div class="section">
<p><a id="d127551e2401" class="indexterm-anchor"></a><a id="d127551e2405" class="indexterm-anchor"></a><a id="d127551e2409" class="indexterm-anchor"></a>The <a href="glossary.htm#GUID-E843F9DE-6FCC-4614-BA56-486F6D9BBD25"><span class="xrefglossterm">transportable tablespace</span></a> feature of Oracle Database enables a user to transport a set of tablespaces from one database to another. Transporting a tablespace into a database is like creating a tablespace with loaded data. Using this feature is often an advantage for the following reasons:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>It is faster than using the Data Pump Export or SQL*Loader utilities because it involves only copying data files and integrating metadata</p>
</li>
<li>
<p>You can use it to move index data, hence avoiding the necessity of rebuilding indexes</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-22FCD8A3-128E-4BFA-8744-5969695034E9__GUID-60223743-B8B0-4F92-A37A-F7FC3940DAAA">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN011" target="_blank" href="../ADMIN/tspaces.htm#ADMIN011"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for detailed information about using the transportable tablespace feature</p>
</div>
<p>Like normal tablespaces, transportable tablespaces are recoverable. However, even though you can recover normal tablespaces without a backup, you must have a consistent version of the transported data files to recover a transported tablespace.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To recover a transportable tablespace, use the following procedure:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>If the database is open, then take the transported tablespace offline. For example, if you want to recover the <code class="codeph">users</code> tablespace, then issue the following statement:</span>
<div>
<pre dir="ltr">ALTER TABLESPACE users OFFLINE IMMEDIATE;
</pre></div>
</li>
<li class="stepexpand"><span>Restore a backup of the transported data files with an operating system utility. The backup can be the initial version of the transported data files or any backup taken after the tablespace is transported. For example, enter:</span>
<div>
<pre dir="ltr">% cp /backup/users.dbf $ORACLE_HOME/oradata/trgt/users01.dbf
</pre></div>
</li>
<li class="stepexpand"><span>Recover the tablespace as usual. For example, enter:</span>
<div>
<pre dir="ltr">RECOVER TABLESPACE users
</pre></div>
</li>
</ol>
<div class="section">
<p>You may see the error <code class="codeph">ORA-01244</code> when recovering through a transportable tablespace operation just as when recovering through a <code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code> operation. In this case, rename the unnamed files to the correct locations using the procedure in <span class="q">&#34;<a href="osadvsce.htm#GUID-88CAB555-C409-4805-B6A4-C92401422EF7">Recovering Through an Added Data File with a Backup Control File</a>&#34;</span>.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV519"></a><a id="BRADV229"></a>
<div class="props_rev_3"><a id="GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2"></a>
<h2 id="BRADV-GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2" class="sect2">Recovering After the Loss of Online Redo Log Files</h2>
<div>
<p><a id="d127551e2547" class="indexterm-anchor"></a><a id="d127551e2551" class="indexterm-anchor"></a><a id="d127551e2557" class="indexterm-anchor"></a>If a media failure has affected the online redo logs of a database, then the appropriate recovery procedure depends on the following considerations:</p>
<ul style="list-style-type: disc;">
<li>
<p>The configuration of the online redo log: mirrored or non-mirrored</p>
</li>
<li>
<p>The type of media failure: temporary or permanent</p>
</li>
<li>
<p>The types of online redo log files affected by the media failure: current, active, unarchived, or inactive</p>
</li>
</ul>
<p>The following table displays <code class="codeph">V$LOG</code> status information that can be crucial in a recovery situation involving online redo logs.</p>
<div class="tblformal" id="GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2__G1010854">
<p class="titleintable">Table 31-3 STATUS Column of V$LOG</p>
<table class="cellalignment515" title="STATUS Column of V$LOG " summary="This table explains possible values for V$LOG.STATUS and their meaning.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment520" id="d127551e2587">Status</th>
<th class="cellalignment520" id="d127551e2590">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment501" id="d127551e2595" headers="d127551e2587">
<p><code class="codeph">UNUSED</code></p>
</td>
<td class="cellalignment501" headers="d127551e2595 d127551e2590">
<p>The online redo log has never been written to.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment501" id="d127551e2603" headers="d127551e2587">
<p><code class="codeph">CURRENT</code></p>
</td>
<td class="cellalignment501" headers="d127551e2603 d127551e2590">
<p>The online redo log is active, that is, needed for instance recovery, and it is the log to which the database is currently writing. The redo log can be open or closed.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment501" id="d127551e2611" headers="d127551e2587">
<p><code class="codeph">ACTIVE</code></p>
</td>
<td class="cellalignment501" headers="d127551e2611 d127551e2590">
<p>The online redo log is active, that is, needed for instance recovery, but is not the log to which the database is currently writing. It may be in use for block recovery, and may or may not be archived.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment501" id="d127551e2619" headers="d127551e2587">
<p><code class="codeph">CLEARING</code></p>
</td>
<td class="cellalignment501" headers="d127551e2619 d127551e2590">
<p>The log is being re-created as an empty log after an <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code> statement. After the log is cleared, then the status changes to <code class="codeph">UNUSED</code>.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment501" id="d127551e2642" headers="d127551e2587">
<p><code class="codeph">CLEARING_CURRENT</code></p>
</td>
<td class="cellalignment501" headers="d127551e2642 d127551e2590">
<p>The current log is being cleared of a closed thread. The log can stay in this status if there is some failure in the switch such as an I/O error writing the new log header.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment501" id="d127551e2651" headers="d127551e2587">
<p><code class="codeph">INACTIVE</code></p>
</td>
<td class="cellalignment501" headers="d127551e2651 d127551e2590">
<p>The log is no longer needed for instance recovery. It may be in use for media recovery, and may or may not be archived.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osadvsce.htm#GUID-7E300605-16F5-41FA-A368-927C00C79782">Recovering After Losing a Member of a Multiplexed Online Redo Log Group</a></p>
</li>
<li>
<p><a href="osadvsce.htm#GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344">Recovering After Losing All Members of an Online Redo Log Group</a></p>
</li>
</ul>
</div>
<a id="BRADV90048"></a>
<div class="props_rev_3"><a id="GUID-7E300605-16F5-41FA-A368-927C00C79782"></a>
<h3 id="BRADV-GUID-7E300605-16F5-41FA-A368-927C00C79782" class="sect3">Recovering After Losing a Member of a Multiplexed Online Redo Log Group</h3>
<div>
<div class="section">
<p>You can recover after losing a member of a multiplexed online redo log group. The database continues to function as usual during the following conditions:</p>
<p>If the online redo log of a database is multiplexed, and if at least one member of each online redo log group is not affected by the media failure, then the database continues functioning as usual, but error messages are written to the log writer trace file and the <code class="codeph">alert_</code><span class="italic"><code class="codeph">SID</code></span><code class="codeph">.log</code> of the database.</p>
<p>You can resolve the problem of a missing member of a multiplexed online redo log group by taking one of the following actions:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>If the hardware problem is temporary, then correct it. The log writer process accesses the previously unavailable online redo log files as if the problem never existed.</p>
</li>
<li>
<p>If the hardware problem is permanent, then drop the damaged member and add a new member by using the following procedure.</p>
<div class="infobox-note" id="GUID-7E300605-16F5-41FA-A368-927C00C79782__GUID-CAFE15AC-8B76-4B66-89F8-A6ADFDAACC56">
<p class="notep1">Note:</p>
<p>The newly added member provides no redundancy until the log group is reused.</p>
</div>
</li>
</ul>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Locate the file name of the damaged member in <a id="d127551e2776" class="indexterm-anchor"></a><code class="codeph">V$LOGFILE</code>. The status is <code class="codeph">INVALID</code> if the file is inaccessible:<a id="d127551e2784" class="indexterm-anchor"></a><a id="d127551e2786" class="indexterm-anchor"></a><a id="d127551e2788" class="indexterm-anchor"></a><a id="d127551e2792" class="indexterm-anchor"></a><a id="d127551e2796" class="indexterm-anchor"></a><a id="d127551e2801" class="indexterm-anchor"></a><a id="d127551e2805" class="indexterm-anchor"></a></span>
<div>
<pre dir="ltr">SELECT GROUP#, STATUS, MEMBER 
FROM V$LOGFILE
WHERE STATUS=&#39;INVALID&#39;;

GROUP#    STATUS       MEMBER
-------   -----------  ---------------------
0002      INVALID      /disk1/oradata/trgt/redo02.log
</pre></div>
</li>
<li class="stepexpand"><span>Drop the damaged member. For example, to drop member <code class="codeph">redo02.log</code> from group <code class="codeph">2</code>, issue the following statement:</span>
<div>
<pre dir="ltr">ALTER DATABASE DROP LOGFILE MEMBER &#39;/disk1/oradata/trgt/redo02.log&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>Add a new member to the group. For example, to add <code class="codeph">redo02.log</code> to group <code class="codeph">2</code>, issue the following statement:</span>
<div>
<pre dir="ltr">ALTER DATABASE ADD LOGFILE MEMBER &#39;/disk1/oradata/trgt/redo02b.log&#39; 
  TO GROUP 2;
</pre>
<p>If the file to add already exists, then it must be the same size as the other group members, and you must specify the <code class="codeph">REUSE</code> option. For example:</p>
<pre dir="ltr">ALTER DATABASE ADD LOGFILE MEMBER &#39;/disk1/oradata/trgt/redo02b.log&#39;
  REUSE TO GROUP 2;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV520"></a><a id="BRADV605"></a><a id="BRADV90049"></a>
<div class="props_rev_3"><a id="GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344"></a>
<h3 id="BRADV-GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344" class="sect3">Recovering After Losing All Members of an Online Redo Log Group</h3>
<div>
<div class="section">
<p><a id="d127551e2915" class="indexterm-anchor"></a><a id="d127551e2919" class="indexterm-anchor"></a><a id="d127551e2925" class="indexterm-anchor"></a><a id="d127551e2931" class="indexterm-anchor"></a>If a media failure damages all members of an online redo log group, then different scenarios can occur depending on the type of online redo log group affected by the failure and the archiving mode of the database.</p>
<p>If the damaged online redo log group is current and active, then it is needed for crash recovery; otherwise, it is not. <a href="osadvsce.htm#GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344__CACFJDBG" title="This table describes scenarios and responses for the loss of all members of an online log group.">Table 31-4</a> outlines the various recovery scenarios.</p>
<div class="tblformal" id="GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344__CACFJDBG">
<p class="titleintable">Table 31-4 Recovering After the Loss of an Online Redo Log Group</p>
<table class="cellalignment515" title="Recovering After the Loss of an Online Redo Log Group" summary="This table describes scenarios and responses for the loss of all members of an online log group.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment521" id="d127551e2956">If the Group Is...</th>
<th class="cellalignment522" id="d127551e2959">Then...</th>
<th class="cellalignment517" id="d127551e2962">And You Can...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment523" id="d127551e2967" headers="d127551e2956">
<p>Inactive</p>
</td>
<td class="cellalignment524" headers="d127551e2967 d127551e2959">
<p>It is not needed for crash recovery</p>
</td>
<td class="cellalignment519" headers="d127551e2967 d127551e2962">
<p>Clear the archived or unarchived group.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment523" id="d127551e2977" headers="d127551e2956">
<p>Active</p>
</td>
<td class="cellalignment524" headers="d127551e2977 d127551e2959">
<p>It is needed for crash recovery</p>
</td>
<td class="cellalignment519" headers="d127551e2977 d127551e2962">
<p>Attempt to issue a checkpoint and clear the log; if impossible, then you must either use Flashback Database or restore a backup and perform incomplete recovery up to the most recent available redo log.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment523" id="d127551e2987" headers="d127551e2956">
<p>Current</p>
</td>
<td class="cellalignment524" headers="d127551e2987 d127551e2959">
<p>It is the redo log that the database is currently writing to</p>
</td>
<td class="cellalignment519" headers="d127551e2987 d127551e2962">
<p>Attempt to clear the log; if impossible, then you must either use Flashback Database or restore a backup and perform incomplete recovery up to the most recent available redo log.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To determine whether the damaged group is active or inactive.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Locate the file name of the lost redo log in <a id="d127551e3003" class="indexterm-anchor"></a><code class="codeph">V$LOGFILE</code> and then look for the group number corresponding to it.<a id="d127551e3008" class="indexterm-anchor"></a><a id="d127551e3010" class="indexterm-anchor"></a><a id="d127551e3014" class="indexterm-anchor"></a><a id="d127551e3018" class="indexterm-anchor"></a><a id="d127551e3022" class="indexterm-anchor"></a><a id="d127551e3026" class="indexterm-anchor"></a><a id="d127551e3030" class="indexterm-anchor"></a> For example, enter:</span>
<div>
<pre dir="ltr">SELECT GROUP#, STATUS, MEMBER FROM V$LOGFILE;

GROUP#    STATUS       MEMBER
-------   -----------  ---------------------
0001                    /oracle/dbs/log1a.f
0001                    /oracle/dbs/log1b.f
0002      INVALID       /oracle/dbs/log2a.f
0002      INVALID       /oracle/dbs/log2b.f
0003                    /oracle/dbs/log3a.f
0003                    /oracle/dbs/log3b.f
</pre></div>
</li>
<li class="stepexpand"><span>Determine which groups are active.</span>
<div>
<p>For example, execute the following SQL query (sample output included):</p>
<pre dir="ltr">SELECT GROUP#, MEMBERS, STATUS, ARCHIVED 
FROM V$LOG;

GROUP#  MEMBERS           STATUS     ARCHIVED
------  -------           ---------  -----------
 0001   2                 INACTIVE   YES
 0002   2                 ACTIVE     NO
 0003   2                 CURRENT    NO
</pre></div>
</li>
<li class="stepexpand"><span>Perform one of the following actions:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>If the affected group is inactive, then follow the procedure in <span class="q">&#34;<a href="osadvsce.htm#GUID-C006356E-662D-4C51-B11F-16DDACC8EE76">Losing an Inactive Online Redo Log Group</a>&#34;</span>.</p>
</li>
<li>
<p>If the affected group is active (as in the preceding example), then follow the procedure in <span class="q">&#34;<a href="osadvsce.htm#GUID-D19E8220-E774-401F-8CD8-6F2FCC125608">Losing an Active Online Redo Log Group</a> &#34;</span>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<a id="BRADV90050"></a>
<div class="props_rev_3"><a id="GUID-C006356E-662D-4C51-B11F-16DDACC8EE76"></a>
<h4 id="BRADV-GUID-C006356E-662D-4C51-B11F-16DDACC8EE76" class="sect4">Losing an Inactive Online Redo Log Group</h4>
<div>
<p><a id="d127551e3134" class="indexterm-anchor"></a><a id="d127551e3138" class="indexterm-anchor"></a><a id="d127551e3142" class="indexterm-anchor"></a>If all members of an online redo log group with <code class="codeph">INACTIVE</code> status are damaged, then the procedure depends on whether you can fix the media problem that damaged the inactive redo log group. If the failure is temporary, then fix the problem. The log writer can reuse the redo log group when required. If the failure is permanent, then the damaged inactive online redo log group eventually halts normal database operation. Reinitialize the damaged group manually by issuing the <code class="codeph">ALTER DATABASE CLEAR LOGFILE</code> statement as described in this section.</p>
</div>
<a id="BRADV521"></a><a id="BRADV90051"></a>
<div class="props_rev_3"><a id="GUID-96583130-3C77-44DB-B88D-387DE6B03A70"></a>
<h5 id="BRADV-GUID-96583130-3C77-44DB-B88D-387DE6B03A70" class="sect5">Clearing Inactive, Archived Redo</h5>
<div>
<div class="section">
<p>You can clear an inactive redo log group when the database is open or closed. The procedure depends on whether the damaged group has been archived.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To clear an inactive, online redo log group that has been archived:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>If the database is shut down, then start a new instance and mount the database:</span>
<div>
<pre dir="ltr">STARTUP MOUNT
</pre></div>
</li>
<li class="stepexpand"><span>Reinitialize the damaged log group. For example, to clear redo log group <code class="codeph">2</code>, issue the following statement:</span>
<div>
<pre dir="ltr">ALTER DATABASE CLEAR LOGFILE GROUP 2;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV522"></a><a id="BRADV90052"></a>
<div class="props_rev_3"><a id="GUID-4DE6BAEB-17E3-4DE0-AFC0-DECAE51996B1"></a>
<h5 id="BRADV-GUID-4DE6BAEB-17E3-4DE0-AFC0-DECAE51996B1" class="sect5">Clearing Inactive, Unarchived Redo</h5>
<div>
<div class="section">
<p>Clearing a not-yet-archived redo log allows it to be reused without archiving it. This action makes backups unusable if they were started before the last change in the log, unless the file was taken offline before the first change in the log. Hence, if you need the cleared log file for recovery of a backup, then you cannot recover that backup. Clearing a not-yet-archived-redo-log, prevents complete recovery from backups due to the missing log.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To clear an inactive, online redo log group that has not been archived:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>If the database is shut down, then start a new instance and mount the database:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP MOUNT
</pre></div>
</li>
<li class="stepexpand"><span>Clear the log using the <code class="codeph">UNARCHIVED</code> keyword.</span>
<div>
<p>For example, to clear log group <code class="codeph">2</code>, issue the following SQL statement:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE CLEAR UNARCHIVED LOGFILE GROUP 2;
</pre>
<p>If there is an offline data file that requires the cleared log to bring it online, then the keywords <code class="codeph">UNRECOVERABLE</code> <code class="codeph">DATAFILE</code> are required. The data file must be dropped because the redo logs necessary to bring the data file online are being cleared, and there is no copy of it. For example, enter:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE CLEAR UNARCHIVED LOGFILE GROUP 2 UNRECOVERABLE DATAFILE;
</pre></div>
</li>
<li class="stepexpand"><span>Immediately back up all data files in the database with an operating system utility, so that you have a backup you can use for complete recovery without relying on the cleared log group. For example, enter:</span>
<div>
<pre dir="ltr">% cp /disk1/oracle/dbs/*.dbf /disk2/backup
</pre></div>
</li>
<li class="stepexpand"><span>Back up the database&#39;s control file with the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> statement. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE BACKUP CONTROLFILE TO &#39;/oracle/dbs/cf_backup.f&#39;;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV90053"></a>
<div class="props_rev_3"><a id="GUID-3F21CA05-FAE8-4179-91A1-6CCEB67C0A23"></a>
<h5 id="BRADV-GUID-3F21CA05-FAE8-4179-91A1-6CCEB67C0A23" class="sect5">Failure of CLEAR LOGFILE Operation</h5>
<div>
<p><a id="d127551e3452" class="indexterm-anchor"></a><a id="d127551e3456" class="indexterm-anchor"></a><a id="d127551e3462" class="indexterm-anchor"></a>The <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code> statement can fail with an I/O error due to media failure when it is not possible to:</p>
<ul style="list-style-type: disc;">
<li>
<p>Relocate the redo log file onto alternative media by re-creating it under the currently configured redo log file name</p>
</li>
<li>
<p>Reuse the currently configured log file name to re-create the redo log file because the name itself is invalid or unusable (for example, due to media failure)</p>
</li>
</ul>
<p>In these cases, the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code> statement (before receiving the I/O error) successfully informs the control file that the log is being cleared and does not require archiving. The I/O error occurs at the step in which the <code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code> statement attempts to create the new redo log file and write zeros to it. This fact is reflected in <code class="codeph">V$LOG.CLEARING_CURRENT</code>.</p>
</div>
</div>
</div>
<a id="BRADV90054"></a>
<div class="props_rev_3"><a id="GUID-D19E8220-E774-401F-8CD8-6F2FCC125608"></a>
<h4 id="BRADV-GUID-D19E8220-E774-401F-8CD8-6F2FCC125608" class="sect4">Losing an Active Online Redo Log Group</h4>
<div>
<p>If the database is still running and the lost active redo log is <span class="italic">not</span> the current log, then issue the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">CHECKPOINT</code> statement. If the operation is successful, then the active redo log becomes inactive, and you can follow the procedure in <span class="q">&#34;<a href="osadvsce.htm#GUID-C006356E-662D-4C51-B11F-16DDACC8EE76">Losing an Inactive Online Redo Log Group</a>&#34;</span>. If the operation is unsuccessful, or if your database has halted, then perform one of procedures in this section, depending on the archiving mode.</p>
<p>The current log is the one <code class="codeph">LGWR</code> is currently writing to. If a <code class="codeph">LGWR</code> I/O operation fails, then LGWR terminates and the instance fails. In this case, you must restore a backup, perform incomplete recovery, and open the database with the <code class="codeph">RESETLOGS</code> option.</p>
</div>
<a id="BRADV523"></a><a id="BRADV90055"></a>
<div class="props_rev_3"><a id="GUID-2D31AAD0-E337-4B17-9ACB-54B00BFC0E4C"></a>
<h5 id="BRADV-GUID-2D31AAD0-E337-4B17-9ACB-54B00BFC0E4C" class="sect5">Recovering from the Loss of Active Logs in NOARCHIVELOG Mode</h5>
<div>
<div class="section">
<p>In this scenario, the database archiving mode is <code class="codeph">NOARCHIVELOG</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover from the loss of an active online log group in NOARCHIVELOG mode:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d127551e3689" class="indexterm-anchor"></a><a id="d127551e3693" class="indexterm-anchor"></a>If the media failure is temporary, then correct the problem so that the database can reuse the group when required.</span></li>
<li class="stepexpand"><span>Restore the database from a consistent, whole database backup (data files and control files). For example, enter:</span>
<div>
<pre dir="ltr">% cp /disk2/backup/*.dbf $ORACLE_HOME/oradata/trgt/
</pre></div>
</li>
<li class="stepexpand"><span>Mount the database:</span>
<div>
<pre dir="ltr">STARTUP MOUNT
</pre></div>
</li>
<li class="stepexpand"><span>Because online redo logs are not backed up, you cannot restore them with the data files and control files. To allow the database to reset the online redo logs, you must first mimic incomplete recovery:</span>
<div>
<pre dir="ltr">RECOVER DATABASE UNTIL CANCEL
CANCEL
</pre></div>
</li>
<li class="stepexpand"><span>Open the database using the <code class="codeph">RESETLOGS</code> option:</span>
<div>
<pre dir="ltr">ALTER DATABASE OPEN RESETLOGS;
</pre></div>
</li>
<li class="stepexpand"><span>Shut down the database consistently. For example, enter:</span>
<div>
<pre dir="ltr">SHUTDOWN IMMEDIATE
</pre></div>
</li>
<li class="stepexpand"><span>Make a whole database backup.</span></li>
</ol>
<div class="section">
<p><a id="d127551e3738" class="indexterm-anchor"></a><a id="d127551e3742" class="indexterm-anchor"></a>If the media failure is temporary, then correct the problem so that the database can reuse the group when required. If the media failure is not temporary, then use the following procedure.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV524"></a><a id="BRADV90056"></a>
<div class="props_rev_3"><a id="GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66"></a>
<h5 id="BRADV-GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66" class="sect5">Recovering from Loss of Active Logs in ARCHIVELOG Mode</h5>
<div>
<div class="section">
<p>In this scenario, the database archiving mode is <code class="codeph">ARCHIVELOG</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To recover from loss of an active online redo log group in ARCHIVELOG mode:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Begin incomplete media recovery, recovering up through the log before the damaged log.</span></li>
<li class="stepexpand"><span>Ensure that the current name of the lost redo log can be used for a newly created file. If not, then rename the members of the damaged online redo log group to a new location. For example, enter:</span>
<div>
<pre dir="ltr">ALTER DATABASE RENAME FILE &#34;/disk1/oradata/trgt/redo01.log&#34; TO &#34;/tmp/redo01.log&#34;;
ALTER DATABASE RENAME FILE &#34;/disk1/oradata/trgt/redo02.log&#34; TO &#34;/tmp/redo02.log&#34;;
</pre></div>
</li>
<li class="stepexpand"><span>Open the database using the <code class="codeph">RESETLOGS</code> option:</span>
<div>
<pre dir="ltr">ALTER DATABASE OPEN RESETLOGS;
</pre>
<div class="infobox-note" id="GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66__GUID-02A49855-3B97-41F9-86CA-C0BEDD0ED759">
<p class="notep1">Note:</p>
<p>All updates executed from the end point of the incomplete recovery to the present must be reexecuted.</p>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV90057"></a>
<div class="props_rev_3"><a id="GUID-C9590C93-758D-46FF-B6FA-1FD934545377"></a>
<h4 id="BRADV-GUID-C9590C93-758D-46FF-B6FA-1FD934545377" class="sect4">Loss of Multiple Redo Log Groups</h4>
<div>
<p><a id="d127551e3919" class="indexterm-anchor"></a>If you have lost multiple groups of the online redo log, then use the recovery method for the most difficult log to recover. The order of difficulty, from most difficult to least difficult, is as follows:</p>
<ol>
<li>
<p>The current online redo log</p>
</li>
<li>
<p>An active online redo log</p>
</li>
<li>
<p>An unarchived online redo log</p>
</li>
<li>
<p>An inactive online redo log</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<a id="BRADV525"></a><a id="BRADV99985"></a>
<div class="props_rev_3"><a id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA"></a>
<h2 id="BRADV-GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA" class="sect2">Recovering from a Dropped Table Without Using Flashback Features</h2>
<div>
<div class="section">
<p><a id="d127551e4016" class="indexterm-anchor"></a><a id="d127551e4020" class="indexterm-anchor"></a>One common error is the accidental dropping of a table from your database. In general, the fastest and simplest solution is to use the Flashback Drop feature to reverse the dropping of the table. If you cannot use Flashback Table (for example, because Flashback Drop is disabled or the table was dropped with the <code class="codeph">PURGE</code> option), then you can perform the procedure in this section.</p>
<p>In this scenario, assume that you do not have the Flashback Database functionality enabled, so the <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> command is not an option. However, you do have physical backups of the database. If possible, keep the database that experienced the user error online and available for use.</p>
<div class="infobox-note" id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA__GUID-DB4D6812-F3C5-4343-8A9C-845A167A9A12">
<p class="notep1">Note:</p>
<p>Grant powerful privileges only to appropriate users to minimize user errors that require recovery.</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To recover a table that has been accidentally dropped:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Back up all data files of the existing database in case an error is made during the remaining steps of this procedure.</span></li>
<li class="stepexpand"><span>Restore a partial backup of the database to an alternative location. At minimum, restore the following:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">SYSTEM</code> and <code class="codeph">SYSAUX</code> tablespaces</p>
</li>
<li>
<p>Tablespaces containing undo or rollback segments</p>
</li>
<li>
<p>Self-contained tablespaces that contain the data to be retrieved</p>
</li>
</ul>
</div>
</li>
<li class="stepexpand"><span>Perform incomplete recovery of this backup using a restored backup control file, to the point just before the table was dropped.</span></li>
<li class="stepexpand"><span>Export the lost data from the temporary, restored version of the database using Data Pump Export. In this case, export the accidentally dropped table.</span>
<div>
<div class="infobox-note" id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA__GUID-49C06018-C485-440B-B2C0-70F2097220B2">
<p class="notep1">Note:</p>
<p>System audit options are exported.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Use the Data Pump Import utility to import the data back into the production database.</span></li>
<li class="stepexpand"><span>Delete the files of the temporary copy of the database to conserve space.</span></li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA__GUID-BDBEA9E9-E3ED-4D11-AB65-60CA08BD0A15">
<p class="notep1">See Also:</p>
<p><a class="olink SUTIL100" target="_blank" href="../SUTIL/GUID-17FAE261-0972-4220-A2E4-44D479F519D4.htm#SUTIL100"><span class="italic">Oracle Database Utilities</span></a> for more information about Oracle Data Pump</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV606"></a><a id="BRADV233"></a>
<div class="props_rev_3"><a id="GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1"></a>
<h2 id="BRADV-GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1" class="sect2">Dropping a Database with SQL*Plus</h2>
<div>
<div class="section">
<p>You may need to remove a database, that is, the database files that form the database, from the operating system. For example, this scenario can occur when you create a test database and then no longer have a use for it. The SQL statement <code class="codeph">DROP</code> <code class="codeph">DATABASE</code> can perform this function.</p>
<div class="infoboxnotealso" id="GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1__GUID-1A6B050E-D323-42E5-A4E4-4A59770E53BD">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmmaint.htm#GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F">Dropping a Database</a>&#34;</span> to learn how to use the equivalent RMAN command <code class="codeph">DROP</code> <code class="codeph">DATABASE</code></p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To drop a database with SQL*Plus:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>After connecting to the database with administrator privileges, ensure that the database is either mounted or open in restricted mode with no users connected.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">SQL&gt; STARTUP RESTRICT FORCE MOUNT
</pre></div>
</li>
<li class="stepexpand"><span>Remove the data files and control files from the operating system.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">SQL&gt; DROP DATABASE; # deletes all database files, both ASM and non-ASM
</pre>
<p>If the database is on raw disk, then the command does not delete the actual raw disk special files.</p>
</div>
</li>
<li class="stepexpand"><span>Use an operating system utility to delete all backups and archived logs associated with the database.</span>
<div>
<p>For example, on Linux and UNIX enter the following command:</p>
<pre dir="ltr">% rm /backup/* /disk1/oradata/trgt/arch/*
</pre></div>
</li>
</ol>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="osrecvry.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="glossary.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>