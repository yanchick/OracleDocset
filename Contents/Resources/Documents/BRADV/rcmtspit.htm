<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2681"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Performing%20RMAN%20Tablespace%20Point-in-Time%20Recovery%20%28TSPITR%29"></a><title>Performing RMAN Tablespace Point-in-Time Recovery (TSPITR)</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="tablespace point-in-time recovery, restrictions"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rcmadvre.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rcmresind.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571"></a> <span id="PAGE" style="display:none;">33/48</span> <!-- End Header -->
<a id="BRADV009"></a>
<h1 id="BRADV-GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571" class="sect1"><span class="enumeration_chapter">21</span> Performing RMAN Tablespace Point-in-Time Recovery (TSPITR)</h1>
<div>
<p>This chapter explains how to perform RMAN tablespace point-in-time recovery. This chapter contains the following sections:</p>
<ul style="list-style-type: disc;">
<li>
<p><span><a href="rcmtspit.htm#GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1">Overview of RMAN TSPITR</a></span></p>
</li>
<li>
<p><span><a href="rcmtspit.htm#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3">TSPITR Restrictions, Special Cases, and Limitations</a></span></p>
</li>
<li>
<p><span><a href="rcmtspit.htm#GUID-EDF19841-06BC-4542-BD91-DC6699B3932A">Planning and Preparing for TSPITR</a></span></p>
</li>
<li>
<p>Running RMAN TSPITR:</p>
<ul style="list-style-type: disc;">
<li>
<p><span><a href="rcmtspit.htm#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA">Performing Fully Automated RMAN TSPITR</a></span></p>
</li>
<li>
<p><span><a href="rcmtspit.htm#GUID-6252E21A-E6C5-4269-8666-B5C652558A47">Overriding Defaults for RMAN TSPITR with an RMAN-Managed Auxiliary Database</a></span></p>
</li>
<li>
<p><span><a href="rcmtspit.htm#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0">Performing RMAN TSPITR Using Your Own Auxiliary Database</a></span></p>
</li>
</ul>
</li>
<li>
<p><span><a href="rcmtspit.htm#GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96">Troubleshooting RMAN TSPITR</a></span></p>
</li>
</ul>
</div>
<a id="BRADV89787"></a>
<div class="props_rev_3"><a id="GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1"></a>
<h2 id="BRADV-GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1" class="sect2">Overview of RMAN TSPITR</h2>
<div>
<p>To use RMAN <a href="glossary.htm#GUID-8A257409-B3DC-41FD-A2AF-D47560FF9F18"><span class="xrefglossterm">tablespace point-in-time recovery (TSPITR)</span></a> effectively, it is helpful to understand what types of problems it can resolve, its components, what RMAN does during TSPITR, and the various limitations and restrictions on when and how it can be run.</p>
<p>To perform TSPITR for CDBs and PDBs, you must connect to the root as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. To perform TSPITR of one more more PDBs, you must have a backup of the root and the seed database (<code class="codeph">PDB$SEED</code>) of the CDB that contains the PDBs.</p>
</div>
<a id="BRADV89788"></a>
<div class="props_rev_3"><a id="GUID-4ADE81D7-CB75-4C39-AD08-589637C5E750"></a>
<h3 id="BRADV-GUID-4ADE81D7-CB75-4C39-AD08-589637C5E750" class="sect3">Purpose of RMAN TSPITR</h3>
<div>
<p>Recovery Manager (RMAN) TSPITR enables quick recovery of one or more tablespaces in a database to an earlier time without affecting the rest of the tablespaces and objects in the database.</p>
<p><a id="d82616e270" class="indexterm-anchor"></a>RMAN TSPITR is most useful for the following situations:</p>
<ul style="list-style-type: disc;">
<li>
<p>To recover a logical database to a point different from the rest of the physical database, when multiple logical databases exist in separate tablespaces of one physical database. For example, you maintain logical databases in the <code class="codeph">orders</code> and <code class="codeph">personnel</code> tablespaces. An incorrect batch job or data manipulation language (DML) statement corrupts the data in only one tablespace.</p>
</li>
<li>
<p>To recover data lost after data definition language (DDL) operations that change the structure of tables. You cannot use Flashback Table to rewind a table to before the point of a structural change such as a truncate table operation.</p>
</li>
<li>
<p>To recover a table after it has been dropped with the <code class="codeph">PURGE</code> option.</p>
</li>
<li>
<p>To recover from the logical corruption of a table.</p>
</li>
<li>
<p><a id="d82616e299" class="indexterm-anchor"></a>To recover dropped tablespaces. In fact, RMAN can perform TSPITR on dropped tablespaces even when a recovery catalog is not used.</p>
</li>
</ul>
<p>You can also use Flashback Database to rewind data, but you must rewind the entire database rather than just a subset. Also, unlike TSPITR, the Flashback Database feature necessitates the overhead of maintaining flashback logs. The point in time to which you can flash back the database is more limited than the TSPITR window, which extends back to your earliest recoverable backup.</p>
</div>
</div>
<a id="BRADV160"></a>
<div class="props_rev_3"><a id="GUID-635E6A2B-A2AE-4179-9CFE-9E4BA9DAA6C7"></a>
<h3 id="BRADV-GUID-635E6A2B-A2AE-4179-9CFE-9E4BA9DAA6C7" class="sect3">Basic Concepts of RMAN TSPITR</h3>
<div>
<p>The following sections explain RMAN TSPITR fundamentals:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtspit.htm#GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0">Common Terms for RMAN TSPITR</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E">Modes of RMAN TSPITR</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-40A9A54A-8742-42D9-AB47-F0B61439A100">How RMAN TSPITR Works With an RMAN-Managed Auxiliary Database</a></p>
</li>
</ul>
</div>
<a id="BRADV372"></a><a id="BRADV371"></a>
<div class="props_rev_3"><a id="GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0"></a>
<h4 id="BRADV-GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0" class="sect4">Common Terms for RMAN TSPITR</h4>
<div>
<p><a href="rcmtspit.htm#GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0__CIHEAFBF" title="TSPITR terms">Table 21-1</a> defines some common entities that are used by RMAN TSPITR.</p>
<div class="tblformal" id="GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0__CIHEAFBF">
<p class="titleintable">Table 21-1 RMAN TSPITR Entities</p>
<table class="cellalignment515" title="RMAN TSPITR Entities" summary="TSPITR terms">
<thead>
<tr class="cellalignment501">
<th class="cellalignment545" id="d82616e477">Name</th>
<th class="cellalignment546" id="d82616e480">Explanation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment547" id="d82616e485" headers="d82616e477">
<p>Target instance</p>
</td>
<td class="cellalignment548" headers="d82616e485 d82616e480">
<p>Contains the tablespace to be recovered to the target time</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d82616e492" headers="d82616e477">
<p>Target time</p>
</td>
<td class="cellalignment548" headers="d82616e492 d82616e480">
<p>Point in time or SCN of the tablespace after TSPITR completes</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d82616e499" headers="d82616e477">
<p>Auxiliary database</p>
</td>
<td class="cellalignment548" headers="d82616e499 d82616e480">
<p>A database used in the recovery process to perform the work of recovery. The auxiliary database has other files associated with it. See auxiliary set for a complete list.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d82616e506" headers="d82616e477">
<p>Auxiliary destination</p>
</td>
<td class="cellalignment548" headers="d82616e506 d82616e480">
<p>An optional disk location that RMAN uses to temporarily store the auxiliary set files. The auxiliary destination is used only with an RMAN-managed auxiliary database. Specifying an auxiliary destination with a user-managed auxiliary database results in an error.</p>
<p>All references to auxiliary destination in this chapter assume use of an RMAN-managed auxiliary database.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d82616e515" headers="d82616e477">
<p>Recovery set</p>
</td>
<td class="cellalignment548" headers="d82616e515 d82616e480">
<p>Data files in the tablespaces that you intend to recover</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d82616e522" headers="d82616e477">
<p>Auxiliary set</p>
</td>
<td class="cellalignment548" headers="d82616e522 d82616e480">
<p>Data files required for TSPITR that are not part of the recovery set. The auxiliary set typically includes:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code class="codeph">SYSTEM</code> and <code class="codeph">SYSAUX</code> tablespaces.</p>
</li>
<li>
<p>Data files containing rollback or undo segments from the target database instance.</p>
</li>
<li>
<p>Temporary tablespaces.</p>
</li>
<li>
<p>Control file from source database.</p>
</li>
<li>
<p>Archived redo logs that must be restored to recover the auxiliary database to specified point in time.</p>
</li>
<li>
<p>Online redo logs of the auxiliary database. These logs are different from the online redo logs of the source database. They are created when the auxiliary database is opened with the <code class="codeph">RESETLOGS</code> option.</p>
</li>
</ul>
<p>The auxiliary set does not include the parameter file, password file, or associated network files.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="BRADV373"></a>
<div class="props_rev_3"><a id="GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E"></a>
<h4 id="BRADV-GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E" class="sect4">Modes of RMAN TSPITR</h4>
<div>
<p>You start RMAN TSPITR with the RMAN <code class="codeph">RECOVER TABLESPACE</code> command. You have several options for running RMAN TSPITR. The difference between the various modes of operation corresponds to how much automation versus customization you require in your environment. There are three ways to run the utility:</p>
<ul style="list-style-type: disc;">
<li>
<p>Fully Automated (the default)</p>
<p>In this mode, RMAN manages the entire TSPITR process including the auxiliary database. You specify the tablespaces of the recovery set, an auxiliary destination, the target time, and you allow RMAN to manage all other aspects of TSPITR.</p>
<p>The default mode is recommended unless you specifically need more control over the location of recovery set files after TSPITR, auxiliary set files during TSPITR, channel settings and parameters or some other aspect of your auxiliary database. For more information, see <span class="q">&#34;<a href="rcmtspit.htm#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA">Performing Fully Automated RMAN TSPITR</a>&#34;</span>.</p>
</li>
<li>
<p>Automated: RMAN-Managed Auxiliary Database with User Settings</p>
<p>You can override some defaults of RMAN TSPITR while still using an RMAN-managed auxiliary database and destination. This variation of the default mode enables you to benefit from some built-in management that RMAN TSITR provides while being able to specify:</p>
<ul style="list-style-type: disc;">
<li>
<p>Location of auxiliary set or recovery set files</p>
</li>
<li>
<p>Initialization parameters</p>
</li>
</ul>
<p>For more information, see <span class="q">&#34;<a href="rcmtspit.htm#GUID-6252E21A-E6C5-4269-8666-B5C652558A47">Overriding Defaults for RMAN TSPITR with an RMAN-Managed Auxiliary Database</a>&#34;</span>.</p>
</li>
<li>
<p>Non-Automated: TSPITR and User-Managed Auxiliary Database</p>
<p>This mode of RMAN TSPITR requires you to set up and manage all aspects of the auxiliary database and some aspects of the TSPITR process. This mode may be appropriate if, for example, you must allocate a different number of channels or change the channel parameters for your user-managed auxiliary database.</p>
<p>For more information, see <span class="q">&#34;<a href="rcmtspit.htm#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0">Performing RMAN TSPITR Using Your Own Auxiliary Database</a>&#34;</span>.</p>
</li>
</ul>
</div>
</div>
<a id="BRADV374"></a>
<div class="props_rev_3"><a id="GUID-40A9A54A-8742-42D9-AB47-F0B61439A100"></a>
<h4 id="BRADV-GUID-40A9A54A-8742-42D9-AB47-F0B61439A100" class="sect4">How RMAN TSPITR Works With an RMAN-Managed Auxiliary Database</h4>
<div>
<p>Having selected tablespaces from the recovery set, an auxiliary destination and a target time, you are now ready to perform Fully Automated RMAN TSPITR (default). The automated mode of RMAN TSPITR shares many of these high-level processing steps.</p>
<p>RMAN TSPITR automatically performs the following actions:</p>
<ol>
<li>
<p>If the tablespaces in the recovery set have not been dropped, checks to see if they are self-contained by executing the <code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code> for the recovery set tablespaces and then checking that the view <code class="codeph">TRANSPORT_SET_VIOLATIONS</code> is empty. If the query returns rows, RMAN stops TSPITR processing. You must resolve any tablespace containment violations before TSPITR can proceed. <a href="rcmtspit.htm#GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__CHDFCCFH">Example 21-1</a> shows you how to set up and run the query before invoking RMAN TSPITR.</p>
</li>
<li>
<p>Checks to see if a connection to a user-managed auxiliary database was provided. If it is, then RMAN TSPITR uses it. If not, RMAN TSPITR creates the auxiliary database, starts it, and connects to it.</p>
</li>
<li>
<p>Takes the tablespaces to be recovered offline in the target database, if the tablespaces in the recovery set have not been dropped.</p>
</li>
<li>
<p>Restores a backup control file from a point in time before the target time to the auxiliary database.</p>
</li>
<li>
<p>Restores the data files from the recovery set and the auxiliary set to the auxiliary database.</p>
<p>Files are restored either in the:</p>
<ul style="list-style-type: disc;">
<li>
<p>Locations that you specify for each file</p>
</li>
<li>
<p>Original location of the file (for recovery set data files)</p>
</li>
<li>
<p>Auxiliary destination (if you used the <code class="codeph">AUXILIARY DESTINATION</code> argument of <code class="codeph">RECOVER TABLESPACE</code> and an RMAN-managed auxiliary database)</p>
</li>
</ul>
</li>
<li>
<p>Recovers the restored data files in the auxiliary database to the specified time.</p>
</li>
<li>
<p>Opens the auxiliary database with the <code class="codeph">RESETLOGS</code> option.</p>
</li>
<li>
<p>Makes the recovery set tablespaces read-only in the auxiliary database.</p>
</li>
<li>
<p>Exports the recovery set tablespaces from the auxiliary database using the Data Pump utility to produce a transportable tablespace dump file.</p>
</li>
<li>
<p>Shuts down the auxiliary database.</p>
</li>
<li>
<p>Drops the recovery set tablespaces from the target.</p>
</li>
<li>
<p>Data Pump utility reads the transportable tablespace dump file and plugs the recovery set tablespaces into the target.</p>
</li>
<li>
<p>Makes the tablespaces that were put in the target database read/write and immediately takes them offline.</p>
</li>
<li>
<p>Deletes all auxiliary set files.</p>
</li>
</ol>
<p>At this point, RMAN TSPITR has finished. The recovery set data files are returned to their contents at the specified point in time, and belong to the target database.</p>
<p>The recovery set tablespaces are left offline for you to back up and then bring back online. These last steps follow Oracle&#39;s recommendation and best practice of backing up recovered tablespaces as soon as TSPITR completes.</p>
</div>
</div>
</div>
</div>
<a id="BRADV89790"></a>
<div class="props_rev_3"><a id="GUID-26A140F5-652B-4F58-900A-C10AE2780BC3"></a>
<h2 id="BRADV-GUID-26A140F5-652B-4F58-900A-C10AE2780BC3" class="sect2">TSPITR Restrictions, Special Cases, and Limitations</h2>
<div>
<p>Some database problems cannot be resolved with TSPITR. The following list explains when you <span class="italic">cannot</span> perform TSPITR:</p>
<ul style="list-style-type: disc;">
<li>
<p>If there are no archived redo logs or if the database runs in <code class="codeph">NOARCHIVELOG</code> mode.</p>
</li>
<li>
<p>If TSPITR is used to recover a renamed tablespace to a point in time before it was renamed, you must use the previous name of the tablespace to perform the recovery operation.</p>
<p>In this case when TSPITR completes, the target database contains two copies of the same tablespace, the original tablespace with the new name and the TSPITR tablespace with the old name. If this is not your goal, then you can drop the new tablespace with the new name.</p>
</li>
<li>
<p>If constraints for the tables in tablespace <code class="codeph">tbs1</code> are contained in tablespace <code class="codeph">tbs2</code>, then you cannot recover <code class="codeph">tbs1</code> without also recovering <code class="codeph">tbs2</code>.</p>
</li>
<li>
<p>If a table and its indexes are stored in different tablespaces, then the indexes must be dropped before performing TSPITR.</p>
</li>
<li>
<p>You cannot use TSPITR to recover the current default tablespace.</p>
</li>
<li>
<p>You cannot use TSPITR to recover tablespaces containing any of the following objects:</p>
<ul style="list-style-type: disc;">
<li>
<p>Objects with underlying objects (such as materialized views) or contained objects (such as partitioned tables) unless all of the underlying or contained objects are in the recovery set. Additionally, if the partitions of a partitioned table are stored in different tablespaces, then you must either drop the table before performing TSPITR or move all the partitions to the same tablespace before performing TSPITR.</p>
</li>
<li>
<p>Undo or rollback segments</p>
</li>
<li>
<p>Oracle8-compatible advanced queues with multiple recipients</p>
</li>
<li>
<p>Objects owned by the user <code class="codeph">SYS</code>. Examples of these types of objects are: PL/SQL, Java classes, callout programs, views, synonyms, users, privileges, dimensions, directories, and sequences.</p>
</li>
</ul>
</li>
</ul>
</div>
<a id="BRADV89791"></a>
<div class="props_rev_3"><a id="GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D"></a>
<h3 id="BRADV-GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D" class="sect3">Limitations of TSPITR</h3>
<div>
<p>After TSPITR completes, RMAN recovers the data files in the recovery set to the target time. Note the following special cases:</p>
<ul style="list-style-type: disc;">
<li>
<p>TSPITR does not recover query optimizer statistics for recovered objects.You must gather new statistics after TSPITR completes.</p>
</li>
<li>
<p>If you run TSPITR on a tablespace and bring the tablespace online at time <span class="italic">t</span>, then backups of the tablespace created before time <span class="italic">t</span> are no longer usable for recovery with a current control file. You cannot use the current control file to recover the database to any time less than or equal to <span class="italic">t</span>.</p>
</li>
<li>
<p>If one or more data files in the recovery set have Oracle Managed File (OMF) names and the compatibility in the target database is set to version 10.1 or earlier, RMAN cannot reuse the data file. This restriction is true even if no SET NEWNAME command is provided for the data file. A new OMF name is created for the recovery set data file. This action temporarily doubles the space requirements for the data file. This is because <code class="codeph">DB_CREATE_FILE_DEST</code> has two copies of the data file (the original data file and the one used by TSPITR) until the tablespace is dropped in the target and the original data file is deleted.</p>
</li>
</ul>
<p>RMAN uses the transportable tablespaces functionality to perform TSPITR. Therefore, any limitations on transportable tablespaces are also applicable to TSPITR.</p>
<div class="infoboxnotealso" id="GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D__GUID-74D09E41-B50D-46AE-8C7A-599DF8A0E674">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN13896" target="_blank" href="../ADMIN/transport.htm#ADMIN13896"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about limitations on transportable tablespaces</p>
</div>
</div>
</div>
<a id="BRADV89792"></a>
<div class="props_rev_3"><a id="GUID-AB95A6DD-C28E-4788-9B2E-916541F38119"></a>
<h3 id="BRADV-GUID-AB95A6DD-C28E-4788-9B2E-916541F38119" class="sect3">About Special Considerations When Not Using a Recovery Catalog</h3>
<div>
<p>You must be aware of following precautions:</p>
<ul style="list-style-type: disc;">
<li>
<p>Because RMAN has no historical record of the undo in the control file, RMAN assumes that the current set of tablespaces with rollback or undo segments were the same set present at the time when recovery was performed. If the tablespace set has changed since that time, then the current rollback or undo segments were the same segments present at the time to which recovery is performed. If the undo segments have changed since that time, then you can use <code class="codeph">UNDO TABLESPACE</code> to indicate the correct set of tablespaces with undo at the point in time where the tablespaces are being recovered.</p>
</li>
<li>
<p>TSPITR to a time that is too old may not succeed if Oracle Database has reused the control file records for needed backups. (In planning your database, set the <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter to a value large enough to ensure that control file records needed for TSPITR are kept.)</p>
</li>
<li>
<p>To rerun TSPITR when you are not using a recovery catalog, you must first drop the tablespace to be used by TSPITR from the target database.</p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV161"></a>
<div class="props_rev_3"><a id="GUID-EDF19841-06BC-4542-BD91-DC6699B3932A"></a>
<h2 id="BRADV-GUID-EDF19841-06BC-4542-BD91-DC6699B3932A" class="sect2">Planning and Preparing for TSPITR</h2>
<div>
<div class="section">
<p><a id="d82616e1214" class="indexterm-anchor"></a>This section assumes that you have read <span class="q">&#34;<a href="rcmtspit.htm#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3">TSPITR Restrictions, Special Cases, and Limitations</a>&#34;</span>. You must complete the following steps when preparing for TSPITR:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtspit.htm#GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366">Step 1: Select the Right Target Time for TSPITR</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66">Step 2: Determine the Recovery Set</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-9276F56B-D7A7-4583-9011-9743365AAF38">Step 3: Identify and Preserve Objects That Are Lost After TSPITR</a></p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="BRADV910"></a>
<div class="props_rev_3"><a id="GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366"></a>
<h3 id="BRADV-GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366" class="sect3">Step 1: Select the Right Target Time for TSPITR</h3>
<div>
<div class="section">
<p>It is extremely important that you choose the right target time or SCN for your TSPITR. As noted in <span class="q">&#34;<a href="rcmtspit.htm#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3">TSPITR Restrictions, Special Cases, and Limitations</a>&#34;</span>, after you bring a tablespace online after TSPITR, you cannot use any backup from a time earlier than the moment you brought the tablespace online.</p>
<p>If you have a recovery catalog, then you can perform repeated TSPITR operations to different target times because the catalog contains tablespace history information. If RMAN uses only a control file, however, repeated TSPITR is only possible after dropping the tablespace because the control file does not have the tablespace history. In this case, RMAN only knows about the current set of tablespaces. The tablespace on which TSPITR was performed has a creation time equal to the time it was brought online.</p>
<p>To investigate past states of your data to identify the target time for TSPITR, you can use Flashback Query, Oracle Transaction Query, and Flashback Version Query to find the point in time when unwanted database changes occurred.</p>
<div class="infoboxnotealso" id="GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366__GUID-373E7070-F660-45B8-BF1A-814809AC09C6">
<p class="notep1">See Also:</p>
<p><a class="olink ADFNS1008" target="_blank" href="../ADFNS/adfns_flashback.htm#ADFNS1008"><span class="italic">Oracle Database Development Guide</span></a> for more information on Flashback Query, Flashback Transaction Query, and Flashback Version Query</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89793"></a>
<div class="props_rev_3"><a id="GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66"></a>
<h3 id="BRADV-GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66" class="sect3">Step 2: Determine the Recovery Set</h3>
<div>
<div class="section">
<p>Initially, your recovery set includes the data files for the tablespaces that you intend to recover. However, if objects in the tablespaces that you need have relationships (such as constraints) to objects in other tablespaces, then you must account for these relationships before you can perform TSPITR as described in <a href="rcmtspit.htm#GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425">Identify and Resolve Dependencies on the Primary Database.</a></p>
<p>You have the following choices when faced with such a relationship:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Add the tablespace including the related objects to your recovery set</p>
</li>
<li>
<p>Remove the relationship</p>
</li>
<li>
<p>Suspend the relationship for the duration of TSPITR</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="BRADV375"></a><a id="BRADV89794"></a>
<div class="props_rev_3"><a id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425"></a>
<h4 id="BRADV-GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425" class="sect4">Identify and Resolve Dependencies on the Primary Database</h4>
<div>
<div class="section">
<p>RMAN TSPITR requires that the tablespace be self-contained and that no SYS -owned objects reside in the tablespace. You can use the <code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code> procedure to locate objects outside the tablespace and identify relationships between objects that span the recovery set boundaries. If the <code class="codeph">TRANSPORT_SET_VIOLATIONS</code> view returns rows, you must investigate and correct the problem according to the choices mentioned earlier in this step.</p>
<div class="infobox-note" id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__GUID-AC28A0EE-8DFF-46AD-9BCC-8549B851C4C2">
<p class="notep1">Note:</p>
<p>If one or more of the tablespaces in the recovery set have been dropped, RMAN TSPITR cannot run the procedure <code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code>. In this case, <code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code> is run when the Data Pump export of the auxiliary database occurs. Just like RMAN TSPITR, if the export operation encounters any tablespaces that are not self-contained, it fails.</p>
</div>
<p>Record all actions performed during this step so that you can re-create any suspended or removed relationships after completing TSPITR. Proceed with TSPITR <span class="italic">only</span> when the <code class="codeph">TRANSPORT_SET_VIOLATIONS</code> view is empty for the tablespaces in the recovery set.</p>
<p>The query in <a href="rcmtspit.htm#GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__CHDFCCFH">Example 21-1</a> illustrates how to use the <code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code> procedure for an initial recovery set consisting of tablespaces <code class="codeph">tools</code> and <code class="codeph">users</code>. It queries the transportable tablespace violations table to manage any dependencies. No rows are returned from this query when all dependencies are managed.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__CHDFCCFH">
<p class="titleinexample">Example 21-1 Querying DBMS_TTS.TRANSPORT_SET_CHECK for a Subset of Tablespaces</p>
<pre dir="ltr">BEGIN
   DBMS_TTS.TRANSPORT_SET_CHECK(&#39;USERS,TOOLS&#39;, TRUE,TRUE);
END;
/
SELECT * FROM  TRANSPORT_SET_VIOLATIONS;
</pre>
<div class="infoboxnotealso" id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__GUID-35ACE992-C02B-498D-AAC9-E6E4CBBC91BC">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN" target="_blank" href="../REFRN/toc.htm"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code> procedure and corresponding view</p>
</div>
</div>
<!-- class="example" --></div>
</div>
</div>
<a id="BRADV376"></a><a id="BRADV377"></a><a id="BRADV378"></a><a id="BRADV89795"></a>
<div class="props_rev_3"><a id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38"></a>
<h3 id="BRADV-GUID-9276F56B-D7A7-4583-9011-9743365AAF38" class="sect3">Step 3: Identify and Preserve Objects That Are Lost After TSPITR</h3>
<div>
<div class="section">
<p>When you perform RMAN TSPITR on a tablespace, objects created after the target recovery time are lost. You can preserve such objects after they are identified by exporting them before TSPITR with the Data Pump Export utility and reimporting them afterward with Data Pump Import.</p>
<p>To determine which objects are lost in TSPITR, query the <code class="codeph">TS_PITR_OBJECTS_TO_BE_DROPPED</code> view on the primary database. <a href="rcmtspit.htm#GUID-9276F56B-D7A7-4583-9011-9743365AAF38__g1040808" title="This table describes columns in the TS_PITR_OBJECTS_TO_BE_DROPPED view.">Table 21-2</a> describes the contents of the view.</p>
<div class="tblformal" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__g1040808">
<p class="titleintable">Table 21-2 TS_PITR_OBJECTS_TO_BE_DROPPED View</p>
<table class="cellalignment515" title="TS_PITR_OBJECTS_TO_BE_DROPPED View " summary="This table describes columns in the TS_PITR_OBJECTS_TO_BE_DROPPED view.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment522" id="d82616e1631">Column Name</th>
<th class="cellalignment525" id="d82616e1634">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e1639" headers="d82616e1631">
<p><code class="codeph">OWNER</code></p>
</td>
<td class="cellalignment526" headers="d82616e1639 d82616e1634">
<p>Owner of the object to be dropped</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e1647" headers="d82616e1631">
<p><code class="codeph">NAME</code></p>
</td>
<td class="cellalignment526" headers="d82616e1647 d82616e1634">
<p>The name of the object that is lost by undergoing TSPITR</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e1655" headers="d82616e1631">
<p><code class="codeph">CREATION_TIME</code></p>
</td>
<td class="cellalignment526" headers="d82616e1655 d82616e1634">
<p>Creation time stamp for the object</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e1663" headers="d82616e1631">
<p><code class="codeph">TABLESPACE_NAME</code></p>
</td>
<td class="cellalignment526" headers="d82616e1663 d82616e1634">
<p>Name of the tablespace containing the object</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Filter the view for objects whose <code class="codeph">CREATION_TIME</code> is after the target time for TSPITR. For example, with a recovery set consisting of <code class="codeph">users</code> and <code class="codeph">tools</code>, and a recovery point in time of November 2, 2013, 7:03:11 am, issue the statement shown in <a href="rcmtspit.htm#GUID-9276F56B-D7A7-4583-9011-9743365AAF38__CHDJAEFG">Example 21-2</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__CHDJAEFG">
<p class="titleinexample">Example 21-2 Querying TS_PITR_OBJECTS_TO_BE_DROPPED</p>
<pre dir="ltr">SELECT OWNER, NAME, TABLESPACE_NAME, 
       TO_CHAR(CREATION_TIME, &#39;YYYY-MM-DD:HH24:MI:SS&#39;) 
       FROM TS_PITR_OBJECTS_TO_BE_DROPPED 
WHERE TABLESPACE_NAME IN (&#39;USERS&#39;,&#39;TOOLS&#39;) 
AND CREATION_TIME &gt; TO_DATE(&#39;02-NOV-13:07:03:11&#39;,&#39;YY-MON-DD:HH24:MI:SS&#39;)
ORDER BY TABLESPACE_NAME, CREATION_TIME;
</pre>
<p>The <code class="codeph">TO_CHAR</code> and <code class="codeph">TO_DATE</code> functions are used to avoid issues with different national date formats. Of course, you can use local date formats in your own work.</p>
<p>Alternatively, if you have the SCN of the tablespaces, you can use conversion functions to determine the time stamp associated with the SCN and the objects that are dropped. For example, if the SCN to recover tablespaces <code class="codeph">USERS</code> and <code class="codeph">TOOLS</code> is 1645870, use the statement in <a href="rcmtspit.htm#GUID-9276F56B-D7A7-4583-9011-9743365AAF38__CIHJBAFB">Example 21-3</a> to determine the objects that are dropped.</p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__CIHJBAFB">
<p class="titleinexample">Example 21-3 Using SCN and TS_PITR_OBJECTS_TO_BE_DROPPED</p>
<pre dir="ltr">SELECT OWNER, NAME, TABLESPACE_NAME,
       TO_CHAR(CREATION_TIME,&#39;YYYY-MM-DD:HH24:MI:SS&#39;)
       FROM TS_PITR_OBJECTS_TO_BE_DROPPED
WHERE TABLESPACE_NAME IN (&#39;USERS&#39;,&#39;TOOLS&#39;)
AND CREATION_TIME &gt; TO_DATE(TO_CHAR(SCN_TO_TIMESTAMP(1645870),
&#39;MM/DD/YYYY HH24:MI:SS&#39;),
&#39;MM/DD/YYYY HH24:MI:SS&#39;)
ORDER BY TABLESPACE_NAME, CREATION_TIME;
</pre>
<div class="infoboxnotealso" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__GUID-F6E456DF-1C35-4152-9A39-231167BA8776">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN" target="_blank" href="../REFRN/toc.htm"><span class="italic">Oracle Database Reference</span></a> for more information about the <code class="codeph">TS_PITR_OBJECTS_TO_BE_DROPPED</code> view</p>
</div>
</div>
<!-- class="example" --></div>
</div>
</div>
<a id="BRADV379"></a><a id="BRADV89796"></a>
<div class="props_rev_3"><a id="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA"></a>
<h2 id="BRADV-GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA" class="sect2">Performing Fully Automated RMAN TSPITR</h2>
<div>
<div class="section">
<p>In the default mode, RMAN bases as much of the configuration for TSPITR as possible on the target database. During TSPITR, the recovery set data files are written in their current locations on the target database (For OMF files, see <span class="q">&#34;<a href="rcmtspit.htm#GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D">Limitations of TSPITR</a>&#34;</span>). The same channel configurations for the target database are used on the auxiliary database when restoring files from backup. Auxiliary set data files and other auxiliary database files, however, are stored in the auxiliary destination.</p>
<p>Use the <code class="codeph">AUXILIARY DESTINATION</code> parameter to set a location for RMAN to use for the auxiliary set data files. The auxiliary destination must be a location on disk with enough space to hold auxiliary set data files. Even if you use other techniques to rename some or all of the auxiliary set data files, specifying an <code class="codeph">AUXILIARY DESTINATION</code> parameter provides a default location for auxiliary set data files for which names are not specified. TSPITR does not fail if you inadvertently do not provide names for all auxiliary set data files.</p>
<p>To perform fully automated RMAN TSPITR, the user performing TSPITR must be able to connect with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege using operating system authentication.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To perform fully automated RMAN TSPITR:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Review the information in <span class="q">&#34;<a href="rcmtspit.htm#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3">TSPITR Restrictions, Special Cases, and Limitations</a>&#34;</span>.</span></li>
<li class="stepexpand"><span>Perform the tasks in <span class="q">&#34;<a href="rcmtspit.htm#GUID-EDF19841-06BC-4542-BD91-DC6699B3932A">Planning and Preparing for TSPITR</a>&#34;</span>.</span></li>
<li class="stepexpand"><span>Start an RMAN session on the target database and, if applicable, connect to a recovery catalog.</span>
<div>
<div class="infoboxnotealso" id="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA__GUID-F6435847-EAD1-4E5D-A6D7-9E904E17067A">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
<div class="infobox-note" id="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA__GUID-6815E5FF-3DFF-4760-B06D-09208680E111">
<p class="notep1">Note:</p>
<p>Do not connect to an auxiliary database when starting the RMAN client for automated TSPITR. If RMAN is connected to an auxiliary database when you run <code class="codeph">RECOVER TABLESPACE</code>, then RMAN assumes that you are managing your own auxiliary database, as described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0">Performing RMAN TSPITR Using Your Own Auxiliary Database</a>&#34;</span>, and tries to use the connected auxiliary for TSPITR.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Configure any channels required for TSPITR on the target instance.</span>
<div>
<p>The auxiliary database uses the same channel configuration as the target instance when performing TSPITR.</p>
</div>
</li>
<li class="stepexpand"><span>Run the <code class="codeph">RECOVER TABLESPACE</code> command, specifying both the <code class="codeph">UNTIL</code> clause and the <code class="codeph">AUXILIARY DESTINATION</code> parameter.</span>
<div>
<p>This example returns the <code class="codeph">USERS</code> and <code class="codeph">TOOLS</code> tablespaces to the end of log sequence number 1299, and stores the auxiliary set files in the <code class="codeph">/disk1/auxdest</code> directory.</p>
<pre dir="ltr">RECOVER TABLESPACE users, tools 
  UNTIL LOGSEQ 1300 THREAD 1
  AUXILIARY DESTINATION &#39;/disk1/auxdest&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>View the results of the <code class="codeph">RECOVER</code> command to decide which step to take:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>If no error occurs during TSPITR, then proceed to Step 7.</p>
<p>The tablespaces are taken offline by RMAN, restored from backup and recovered to the desired point in time on the auxiliary database, and then reimported to the target database. The tablespaces are left offline. All auxiliary set data files and other auxiliary database files are cleaned up from the auxiliary destination.</p>
</li>
<li>
<p>If an error occurs during TSPITR, then proceed to <span class="q">&#34;<a href="rcmtspit.htm#GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96">Troubleshooting RMAN TSPITR</a>&#34;</span>.</p>
</li>
</ul>
</div>
</li>
<li class="stepexpand" id="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA__CHDCGEEF"><span>If TSPITR completes successfully, then back up the recovered tablespaces before bringing them online.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">BACKUP TABLESPACE users, tools;
</pre>
<p>After you perform TSPITR on a tablespace, you can no longer use previous backups of that tablespace after TSPITR successfully completes. If you use the recovered tablespaces without taking a backup, then you run your database without a usable backup of these tablespaces.</p>
</div>
</li>
<li class="stepexpand"><span>Bring the tablespaces back online.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">RMAN&gt; ALTER TABLESPACE users, tools ONLINE;
</pre>
<p>Your recovered tablespaces are now ready for use.</p>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV89797"></a>
<div class="props_rev_3"><a id="GUID-6252E21A-E6C5-4269-8666-B5C652558A47"></a>
<h2 id="BRADV-GUID-6252E21A-E6C5-4269-8666-B5C652558A47" class="sect2">Overriding Defaults for RMAN TSPITR with an RMAN-Managed Auxiliary Database</h2>
<div>
<p>You can customize the following aspects of RMAN TSPITR while still mostly following the procedure described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA">Performing Fully Automated RMAN TSPITR</a>&#34;</span>:</p>
<ul style="list-style-type: disc;">
<li>
<p>Rename or relocate your recovery set data files so that the data files making up the recovered tablespaces are not stored in the original locations after TSPITR. This may be necessary if the disk that originally contained the tablespace is not usable.</p>
<p>This task is described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49">Renaming TSPITR Recovery Set Data Files with SET NEWNAME</a>&#34;</span>.</p>
</li>
<li>
<p>Specify a location other than the auxiliary destination for some or all auxiliary set data files. You might choose this option if no single location on disk has enough space for all auxiliary set files.</p>
<p>This task is described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70">Naming TSPITR Auxiliary Set Data Files</a>&#34;</span>.</p>
</li>
<li>
<p>Rename files in an Oracle Managed Files format.</p>
<p>This task is described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419">Considerations When Renaming OMF Auxiliary Set Files in TSPITR</a>&#34;</span>.</p>
</li>
<li>
<p>Set up image copy backups of your auxiliary set data files in advance to avoid having to restore data files during TSPITR.</p>
<p>This task is described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4">Using Image Copies for Faster RMAN TSPITR Performance</a>&#34;</span>.</p>
</li>
<li>
<p>Customize initialization parameters for your RMAN-managed auxiliary database.</p>
<p>This task is described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6">Customizing Initialization Parameters for the Automatic Auxiliary Database in TSPITR</a>&#34;</span>.</p>
</li>
</ul>
</div>
<a id="BRADV381"></a><a id="BRADV89799"></a>
<div class="props_rev_3"><a id="GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49"></a>
<h3 id="BRADV-GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49" class="sect3">Renaming TSPITR Recovery Set Data Files with SET NEWNAME</h3>
<div>
<div class="section">
<p>You may not want the recovery set data files restored and recovered in their original locations. The <code class="codeph">SET NEWNAME</code> command enables you to specify a new destination. When you specify a new destination for the recovery set, RMAN does not remove the original data files of the tablespaces.</p>
<p>To specify new recovery set file names, create a <code class="codeph">RUN</code> block and use <code class="codeph">SET NEWNAME</code> commands within it. Be sure to assign names that do not conflict with each other or with the names of your current data files. <a href="rcmtspit.htm#GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49__CHDBDCCA">Example 21-4</a> illustrates the basic technique.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49__CHDBDCCA">
<p class="titleinexample">Example 21-4 Renaming Recovery Set Files</p>
<pre dir="ltr">RUN
{
   .
   .
   .
   SET NEWNAME FOR DATAFILE &#39;<span class="italic">ORACLE_HOME</span>/oradata/trgt/users01.dbf&#39;
     TO &#39;/newfs/users01.dbf&#39;;
<span class="italic">   ...other SET NEWNAME commands...</span>
   RECOVER TABLESPACE users, tools UNTIL SEQUENCE 1300 THREAD 1;
}
</pre>
<p>In this example, RMAN takes the following actions:</p>
<ul style="list-style-type: disc;">
<li>
<p>Restores each specified data file to the new location during TSPITR.</p>
</li>
<li>
<p>Uses the image copy if one exists at the specified location and its checkpoint is before the specified point in time. If this criteria is not met, then RMAN overwrites the image copy.</p>
</li>
<li>
<p>Plugs the newly recovered data file into the target control file.</p>
</li>
</ul>
<p>RMAN does not detect conflicts between names set with <code class="codeph">SET NEWNAME</code> and current data file names on the target database until the actual recovery. If RMAN detects a conflict, then TSPITR fails and RMAN reports an error. The valid data file is not overwritten.</p>
</div>
<!-- class="example" --></div>
</div>
<a id="BRADV382"></a><a id="BRADV89800"></a>
<div class="props_rev_3"><a id="GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70"></a>
<h3 id="BRADV-GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70" class="sect3">Naming TSPITR Auxiliary Set Data Files</h3>
<div>
<div class="section">
<p>Unlike recovery set data files, which are usually stored in their original locations, auxiliary set data files must not overwrite the corresponding original files in the target database. If you do not specify an auxiliary set file location that is different from its original location, then TSPITR fails. The failure occurs when RMAN attempts to overwrite the corresponding file in the original database and discovers the file in use.</p>
<p>The simplest way to provide locations for auxiliary set data files is to specify an auxiliary destination for TSPITR. However, RMAN supports the following alternatives for controlling the location of auxiliary set data files, which are listed in order of precedence shown in <a href="rcmtspit.htm#GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70__CHDGAFGB" title="Describes order of precedence: set newname, configure auxname, db_file_name_convert, and auxiliary destination">Table 21-3</a>.</p>
<div class="tblformal" id="GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70__CHDGAFGB">
<p class="titleintable">Table 21-3 Order of Precedence for Naming Files</p>
<table class="cellalignment515" title="Order of Precedence for Naming Files" summary="Describes order of precedence: set newname, configure auxname, db_file_name_convert, and auxiliary destination">
<thead>
<tr class="cellalignment501">
<th class="cellalignment554" id="d82616e2256">Order</th>
<th class="cellalignment558" id="d82616e2259">Technique</th>
<th class="cellalignment517" id="d82616e2262">Section</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment556" id="d82616e2267" headers="d82616e2256">
<p>1</p>
</td>
<td class="cellalignment559" headers="d82616e2267 d82616e2259">
<p><code class="codeph">SET</code> <code class="codeph">NEWNAME</code></p>
</td>
<td class="cellalignment519" headers="d82616e2267 d82616e2262">
<p><span class="q">&#34;<a href="rcmtspit.htm#GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9">Using SET NEWNAME to Name Auxiliary Set Data Files During TSPITR</a>&#34;</span></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment556" id="d82616e2284" headers="d82616e2256">
<p>2</p>
</td>
<td class="cellalignment559" headers="d82616e2284 d82616e2259">
<p><code class="codeph">CONFIGURE</code> <code class="codeph">AUXNAME</code></p>
</td>
<td class="cellalignment519" headers="d82616e2284 d82616e2262">
<p><span class="q">&#34;<a href="rcmtspit.htm#GUID-FC741E8C-D422-4856-A3E3-709F91547914">Using SET NEWNAME and CONFIGURE AUXNAME with Auxiliary Set Image Copies</a>&#34;</span></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment556" id="d82616e2301" headers="d82616e2256">
<p>3</p>
</td>
<td class="cellalignment559" headers="d82616e2301 d82616e2259">
<p><code class="codeph">DB_FILE_NAME_CONVERT</code></p>
</td>
<td class="cellalignment519" headers="d82616e2301 d82616e2262">
<p><span class="q">&#34;<a href="rcmtspit.htm#GUID-310586B1-F08C-456C-8398-62CB6930DD4C">Using DB_FILE_NAME_CONVERT to Name Auxiliary Set Data Files During TSPITR</a>&#34;</span>. If the target database uses OMF names for auxiliary set, then you cannot use <code class="codeph">DB_FILE_NAME_CONVERT.</code> See <span class="q">&#34;<a href="rcmtspit.htm#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419">Considerations When Renaming OMF Auxiliary Set Files in TSPITR</a>&#34;</span>.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment556" id="d82616e2324" headers="d82616e2256">
<p>4</p>
</td>
<td class="cellalignment559" headers="d82616e2324 d82616e2259">
<p><code class="codeph">AUXILIARY DESTINATION</code> argument to <code class="codeph">RECOVER TABLESPACE</code> when using an RMAN-managed auxiliary database</p>
</td>
<td class="cellalignment519" headers="d82616e2324 d82616e2262">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Settings higher on the list override settings lower on the list in situations where both have been applied. For example, you might run <code class="codeph">RECOVER TABLESPACE... AUXILIARY DESTINATION</code> on a target database when some auxiliary set data files have auxiliary names configured with <code class="codeph">CONFIGURE AUXNAME</code>.</p>
<p>Even if you intend to use either of the preceding techniques to provide locations for specific files, Oracle recommends that you provide an <code class="codeph">AUXILIARY DESTINATION</code> argument to <code class="codeph">RECOVER TABLESPACE</code> when using an RMAN-managed auxiliary database. If you overlook renaming some auxiliary set data files, then TSPITR still succeeds. Any files not otherwise renamed are placed in the auxiliary destination.</p>
<div class="infobox-note" id="GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70__GUID-D54D44CF-E0BC-484D-B3B8-A4256B985D82">
<p class="notep1">Note:</p>
<p>You can view any current <code class="codeph">CONFIGURE</code> <code class="codeph">AUXNAME</code> settings by running the <code class="codeph">SHOW</code> <code class="codeph">AUXNAME</code> command, which is described in <a class="olink RCMRF154" target="_blank" href="../RCMRF/rcmsynta2015.htm#RCMRF154"><span class="italic">Oracle Database Backup and Recovery Reference</span></a>.</p>
</div>
</div>
<!-- class="section" --></div>
<a id="BRADV383"></a>
<div class="props_rev_3"><a id="GUID-1E3933FC-9FA4-4012-B59D-A27406A86419"></a>
<h4 id="BRADV-GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" class="sect4">Considerations When Renaming OMF Auxiliary Set Files in TSPITR</h4>
<div>
<p>Auxiliary set data files can have Oracle Managed Files (OMF) in the target and can use Automatic Storage Management (ASM) or non-ASM storage. TSPITR performs name conversion differently when the <code class="codeph">DB_FILE_NAME_CONVERT</code> initialization parameter is set and the OMF files are in ASM or non-ASM storage.</p>
</div>
<a id="BRADV385"></a><a id="BRADV384"></a>
<div class="props_rev_3"><a id="GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74"></a>
<h5 id="BRADV-GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74" class="sect5">Using ASM Storage</h5>
<div>
<div class="section">
<p>For Oracle Managed Files (OMF) that use ASM storage, the database converts only disk group names as in: +DISK1 to +DISK2.</p>
<p>You can use <code class="codeph">DB_FILE_NAME_CONVERT</code> and <code class="codeph">LOG_FILE_NAME_CONVERT</code> initialization parameters for the auxiliary database to specify the conversion of the disk group. RMAN uses the pattern to convert the ASM disk group name and generates a valid OMF file name in the converted disk group. The following command demonstrates this point:</p>
<pre dir="ltr">LOG_FILE_NAME_CONVERT=&#39;+onlinelogs&#39;,&#39;+tmpasm&#39;
</pre>
<p>If the <code class="codeph">DB_FILE_NAME_CONVERT</code> and <code class="codeph">LOG_FILE_NAME_CONVERT</code> parameters change a substring other than the disk group name, the conversion is ignored and the resulting disk group name is used, for example:</p>
<pre dir="ltr">DB_FILE_NAME_CONVERT=&#39;+DATAFILE/prod&#39;,&#39;+DATAFILE/tspitr&#39;
</pre>
<p>The preceding command results in an invalid ASM OMF file name and the change is ignored. Instead, the files are created in disk group name +DATAFILE and the following message is issued:</p>
<pre dir="ltr">WARNING: DB_FILE_NAME_CONVERT resulted in invalid ASM names; names changed to disk group only 
</pre>
<p>If auxiliary set data files are stored in ASM disk groups, then you can use the <code class="codeph">SET</code> <code class="codeph">NEWNAME</code> command to redirect individual files to a specific disk group accessible from the auxiliary database (and allow the database to generate the file name within the disk group). <a href="rcmtspit.htm#GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74__CIHHGCGF">Example 21-5</a> shows how to do this.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74__CIHHGCGF">
<p class="titleinexample">Example 21-5 Redirecting ASM files</p>
<pre dir="ltr">RUN
{
  SET NEWNAME FOR DATAFILE 1 TO &#34;+DISK2&#34;;
  SET NEWNAME FOR DATAFILE 2 TO &#34;+DISK3&#34;;
  RECOVER TABLESPACE users, tools 
    UNTIL LOGSEQ 1300 THREAD 1
    AUXILIARY DESTINATION &#39;/disk1/auxdest&#39;;
}
</pre></div>
<!-- class="example" --></div>
</div>
<a id="BRADV386"></a>
<div class="props_rev_3"><a id="GUID-AEA2C5F4-214B-4795-86DE-69BC307832EE"></a>
<h5 id="BRADV-GUID-AEA2C5F4-214B-4795-86DE-69BC307832EE" class="sect5">Using Non-ASM Storage</h5>
<div>
<div class="section">
<p>The initialization parameters <code class="codeph">DB_FILE_NAME_CONVERT</code> and <code class="codeph">LOG_FILE_NAME_CONVERT</code> cannot be used to rename OMF (non-ASM) file names for the auxiliary database because this method generates invalid OMF file names. If you must control the generation of new OMF file names that do not use ASM storage, you must rename them using one of the following alternate techniques. The various naming options are listed in order from most recommended to least recommended.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Use an auxiliary destination, as described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA">Performing Fully Automated RMAN TSPITR</a>&#34;</span>.</span></li>
<li class="stepexpand"><span>Specify locations for new OMF files with one or more of the OMF initialization parameters for the auxiliary database so that all of the necessary OMF files are handled:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">DB_CREATE_FILE_DEST</code> for the auxiliary set data files</p>
</li>
<li>
<p><code class="codeph">DB_CREATE_ONLINE_LOG_DEST_</code><span class="italic"><code class="codeph">n</code></span> with <code class="codeph">DB_CREATE_FILE_DEST</code> for the online redo logs of the auxiliary database if the online logs are not created in the <code class="codeph">DB_CREATE_FILE_DEST</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV387"></a><a id="BRADV89801"></a>
<div class="props_rev_3"><a id="GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9"></a>
<h4 id="BRADV-GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9" class="sect4">Using SET NEWNAME to Name Auxiliary Set Data Files During TSPITR</h4>
<div>
<div class="section">
<p>To specify a new name for an auxiliary set data file, you can enclose <code class="codeph">RECOVER TABLESPACE</code> in a <code class="codeph">RUN</code> command and use a <code class="codeph">SET NEWNAME</code> command within the <code class="codeph">RUN</code> block to rename the file. <a href="rcmtspit.htm#GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9__CHDIAAAJ">Example 21-6</a> illustrates the basic technique.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9__CHDIAAAJ">
<p class="titleinexample">Example 21-6 Renaming Auxiliary Set Oracle Managed Files (OMF) in TSPITR</p>
<pre dir="ltr">RUN
{
  SET NEWNAME FOR DATAFILE &#39;?/oradata/prod/system01.dbf&#39;
    TO &#39;/disk1/auxdest/system01.dbf&#39;;
  SET NEWNAME FOR DATAFILE &#39;?/oradata/prod/sysaux01.dbf&#39;
    TO &#39;/disk1/auxdest/sysaux01.dbf&#39;;
  SET NEWNAME FOR DATAFILE &#39;?/oradata/prod/undotbs01.dbf&#39;
    TO &#39;/disk1/auxdest/undotbs01.dbf&#39;;
  RECOVER TABLESPACE users, tools 
    UNTIL LOGSEQ 1300 THREAD 1
    AUXILIARY DESTINATION &#39;/disk1/auxdest&#39;;
}
</pre>
<p>The result depends on whether <code class="codeph">/disk1/auxdest/system01.dbf</code> exists when <code class="codeph">RECOVER TABLESPACE</code> is executed. If <code class="codeph">?/oradata/system01.dbf</code> exists at the specified location and was created at an SCN before the <code class="codeph">UNTIL</code> time for TSPITR, then the <code class="codeph">DATAFILECOPY</code> is used and the restore operation is not necessary. For more information, see <span class="q">&#34;<a href="rcmtspit.htm#GUID-FC741E8C-D422-4856-A3E3-709F91547914">Using SET NEWNAME and CONFIGURE AUXNAME with Auxiliary Set Image Copies</a>&#34;</span>. Otherwise, RMAN restores the auxiliary set data file to the <code class="codeph">NEWNAME</code> instead of the default location. If your intention is to control where the auxiliary set data files are stored, then ensure that no file is stored at the location specified by <code class="codeph">SET NEWNAME</code> before performing TSPITR.</p>
</div>
<!-- class="example" --></div>
</div>
<a id="BRADV89802"></a>
<div class="props_rev_3"><a id="GUID-310586B1-F08C-456C-8398-62CB6930DD4C"></a>
<h4 id="BRADV-GUID-310586B1-F08C-456C-8398-62CB6930DD4C" class="sect4">Using DB_FILE_NAME_CONVERT to Name Auxiliary Set Data Files During TSPITR</h4>
<div>
<div class="section">
<p>Assume that you do not want to use an auxiliary destination for all of your auxiliary set data files, but you also do not want to name every file individually. In this case, you can include a <code class="codeph">DB_FILE_NAME_CONVERT</code> initialization parameter in the initialization parameter file used by the auxiliary database. You can use this technique only in the following circumstances:</p>
<p>One of the following situations exists:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>You create your own initialization parameter file for an automatically managed auxiliary database, as described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6">Customizing Initialization Parameters for the Automatic Auxiliary Database in TSPITR</a>&#34;</span></p>
</li>
<li>
<p>You create your own auxiliary database, as described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0">Performing RMAN TSPITR Using Your Own Auxiliary Database</a>&#34;</span></p>
</li>
</ul>
<p>The <code class="codeph">DB_FILE_NAME_CONVERT</code> initialization parameter in the auxiliary database specifies how to derive names for files in the auxiliary database from the original names of the corresponding files in the target database instance. The parameter consists of a list of pairs of strings. For any file name that contains the first string of a pair as a substring, the name of the corresponding file in the auxiliary database is generated by substituting the second string of the pair into the original file name.</p>
<p>For example, assume that the target instance contains the following files:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">?/oradata/trgt/system01.dbf</code> of the <code class="codeph">SYSTEM</code> tablespace</p>
</li>
<li>
<p><code class="codeph">?/oradata/trgt/sysaux01.dbf</code> of the <code class="codeph">SYSAUX</code> tablespace</p>
</li>
<li>
<p><code class="codeph">?/oradata/trgt/undotbs01.dbf</code> of the <code class="codeph">undotbs</code> tablespace</p>
</li>
</ul>
<p>To place the corresponding files of the auxiliary database in <code class="codeph">/bigtmp</code>, you add the following line to the auxiliary database parameter file:</p>
<pre dir="ltr">DB_FILE_NAME_CONVERT=(&#39;?/oradata/trgt&#39;, &#39;/bigtmp&#39;)
</pre>
<p>New file names for the corresponding auxiliary database files are <code class="codeph">/bigtmp/trgt/system01.dbf</code>, <code class="codeph">/bigtmp/trgt/sysaux01.dbf</code>, and <code class="codeph">/bigtmp/trgt/undotbs01.dbf</code>.</p>
<p>The most important point to remember is that <code class="codeph">DB_FILE_NAME_CONVERT</code> <span class="italic">must</span> be present in the auxiliary database parameter file. If the auxiliary database was manually created, then add <code class="codeph">DB_FILE_NAME_CONVERT</code> to the auxiliary database parameter file.</p>
<p>You can still rename individual auxiliary set data files with the <code class="codeph">SET NEWNAME</code> or <code class="codeph">CONFIGURE AUXNAME</code> command. Also, files that do not match the patterns provided in <code class="codeph">DB_FILE_NAME_CONVERT</code> are not renamed. When using RMAN-managed auxiliary database, you can use the <code class="codeph">AUXILIARY DESTINATION</code> parameter of <code class="codeph">RECOVER TABLESPACE</code> command to ensure that all auxiliary set data files are sent to some destination. If the renaming methods do not provide a new name for a file at the auxiliary database, then TSPITR fails.</p>
</div>
<!-- class="section" --></div>
<a id="BRADV89804"></a>
<div class="props_rev_3"><a id="GUID-CA2BABC5-F8BF-40B1-943B-5C5E92A82325"></a>
<h5 id="BRADV-GUID-CA2BABC5-F8BF-40B1-943B-5C5E92A82325" class="sect5">Renaming Temp Files During TSPITR</h5>
<div>
<div class="section">
<p>Temp files are considered part of the auxiliary set for your database. When the auxiliary database is instantiated, RMAN re-creates the temporary tablespaces of the target database and generates their names with the regular rules for the auxiliary data file names.</p>
<p>To rename temp files, you can use one of the following:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">SET</code> <code class="codeph">NEWNAME</code> <code class="codeph">FOR</code> <code class="codeph">TEMPFILE</code> command</p>
</li>
<li>
<p><code class="codeph">DB_FILE_NAME_CONVERT</code> initialization parameter of the auxiliary database. See the previous example. If the temporary files have non-ASM Oracle Managed File names, you cannot use this parameter option. See <span class="q">&#34;<a href="rcmtspit.htm#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419">Considerations When Renaming OMF Auxiliary Set Files in TSPITR</a>&#34;</span>.</p>
</li>
<li>
<p><code class="codeph">AUXILIARY DESTINATION</code> clause of the <code class="codeph">RECOVER</code> command when using an RMAN-managed auxiliary database</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<a id="BRADV89805"></a>
<div class="props_rev_3"><a id="GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4"></a>
<h3 id="BRADV-GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4" class="sect3">Using Image Copies for Faster RMAN TSPITR Performance</h3>
<div>
<p>You can enhance TSPITR performance by redirecting RMAN to use existing image copies of the recovery set and auxiliary set data files. In this case, RMAN does not need to restore the data files from backup.</p>
<p>In general, if a suitable image copy is available in the specified location, then RMAN uses the image copy to perform TSPITR, and the data file copy is uncataloged from the target control file.</p>
<p>You can use the following techniques to tell RMAN about the possible existence of an image copy of a data file:</p>
<ul style="list-style-type: disc;">
<li>
<p>Use the <code class="codeph">CONFIGURE AUXNAME</code> command with image copies of auxiliary set data files</p>
</li>
<li>
<p>Use the <code class="codeph">SET NEWNAME</code> command with image copies of recovery set data files or auxiliary set data files</p>
</li>
</ul>
<p>The following topics describe how to use these techniques:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtspit.htm#GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF">Using SET NEWNAME with Recovery Set Image Copies</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-FC741E8C-D422-4856-A3E3-709F91547914">Using SET NEWNAME and CONFIGURE AUXNAME with Auxiliary Set Image Copies</a></p>
</li>
</ul>
</div>
<a id="BRADV388"></a><a id="BRADV89806"></a>
<div class="props_rev_3"><a id="GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF"></a>
<h4 id="BRADV-GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF" class="sect4">Using SET NEWNAME with Recovery Set Image Copies</h4>
<div>
<div class="section">
<p>During TSPITR, RMAN looks in the specified <code class="codeph">NEWNAME</code> location for the data file. RMAN checks whether an image copy backup of the data file exists with a <a href="glossary.htm#GUID-22212AAE-6F3C-4E84-B940-5AB2261A7EDA"><span class="xrefglossterm">data file checkpoint</span></a> SCN early enough that it can be recovered to the target time. If RMAN finds a usable image copy, then RMAN uses it in TSPITR. Otherwise, RMAN restores the data file to the <code class="codeph">NEWNAME</code> location. Any file in the location specified by the <code class="codeph">NEWNAME</code> is overwritten. The specified <code class="codeph">NEWNAME</code> becomes the name of the data file in the target database after TSPITR completes. <a href="rcmtspit.htm#GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF__CHDFHFCJ">Example 21-7</a> illustrates this technique.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF__CHDFHFCJ">
<p class="titleinexample">Example 21-7 Using SET NEWNAME</p>
<pre dir="ltr">RUN
{
SET NEWNAME FOR DATAFILE &#39;<span class="italic">ORACLE_HOME</span>/oradata/trgt/users01.dbf&#39; 
  TO &#39;/newfs/users1.dbf&#39;;
<span class="italic">...other RMAN commands, if any...</span>
RECOVER TABLESPACE users, tools UNTIL SEQUENCE 1300 THREAD 1;
}
</pre></div>
<!-- class="example" --></div>
</div>
<a id="BRADV89807"></a>
<div class="props_rev_3"><a id="GUID-FC741E8C-D422-4856-A3E3-709F91547914"></a>
<h4 id="BRADV-GUID-FC741E8C-D422-4856-A3E3-709F91547914" class="sect4">Using SET NEWNAME and CONFIGURE AUXNAME with Auxiliary Set Image Copies</h4>
<div>
<div class="section">
<p>The <code class="codeph">CONFIGURE AUXNAME</code> command sets a persistent alternative location for an auxiliary set data file image copy, whereas the <code class="codeph">SET NEWNAME</code> command sets an alternative location for the duration of a <code class="codeph">RUN</code> command.</p>
<p>Assume that you use <code class="codeph">SET NEWNAME</code> or <code class="codeph">CONFIGURE AUXNAME</code> to specify a new location for an auxiliary set data file. Also assume that there is an image copy at that location with an SCN that can be used in TSPITR. In this case, RMAN uses the image copy. If there is no usable image copy at that location, however, then RMAN restores a usable copy from backup. (If an image copy is present but the SCN is after the target time for TSPITR, then the data file is overwritten by the restored file.)</p>
<p>As with all auxiliary set files, the file is deleted after TSPITR. This behavior occurs regardless of whether it was an image copy created before TSPITR or restored by RMAN during TSPITR.</p>
<p>The primary use of <code class="codeph">CONFIGURE AUXNAME</code> is to make TSPITR faster by eliminating restore times. If you anticipate performing TSPITR, then you can include in your backup routine the maintenance of a set of image copies of the auxiliary set data files, and update these periodically to the earliest point to which you expect to perform TSPITR. The recommended usage model is:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Configure the <code class="codeph">AUXNAME</code> for the files once when setting up this strategy.</span></li>
<li><span>Perform <code class="codeph">BACKUP AS COPY DATAFILE</code> <span class="italic"><code class="codeph">n</code></span> <code class="codeph">FORMAT</code> <span class="italic"><code class="codeph">auxname</code></span> regularly to maintain the updated image copy. For better performance, use an incrementally updated backup strategy to keep the image copies up-to-date without performing full backups of the data files.</span></li>
<li><span>When TSPITR is needed, specify a target time after the last update of the image copy.</span></li>
</ol>
</div>
</div>
<a id="BRADV89808"></a>
<div class="props_rev_3"><a id="GUID-BA6F7010-407B-4E16-8F53-597FD49B64E3"></a>
<h4 id="BRADV-GUID-BA6F7010-407B-4E16-8F53-597FD49B64E3" class="sect4">Performing TSPITR with CONFIGURE AUXNAME and Image Copies: Scenario</h4>
<div>
<div class="section">
<p>Assume that you have enough disk space to save image copies of your entire database for use in TSPITR. In preparation for the possibility of TSPITR, you do the following:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Configure an <code class="codeph">AUXNAME</code> for each data file in the auxiliary set by using a command of the following form:</p>
<pre dir="ltr">CONFIGURE AUXNAME FOR DATAFILE <span class="italic">n</span> TO <span class="italic">auxname_n</span>;
</pre></li>
<li>
<p>Take an image copy of the auxiliary set every Sunday by using a command of the following form:</p>
<pre dir="ltr">BACKUP AS COPY DATAFILE <span class="italic">n</span> FORMAT <span class="italic">auxname_n</span>
</pre>
<p>If the image copies are all in the same location on disk, and if they are named similarly to the original data files, then you can avoid performing backups of every data file. Instead, you can use the <code class="codeph">FORMAT</code> or <code class="codeph">DB_FILE_NAME_CONVERT</code> options of the <code class="codeph">BACKUP</code> command and use <code class="codeph">BACKUP AS COPY DATABASE</code>. For example, if the configured auxiliary names are a translation of the location <code class="codeph">maindisk</code> to <code class="codeph">auxdisk</code>, then you use the following command:</p>
<pre dir="ltr">BACKUP AS COPY 
  DATABASE 
  DB_FILE_NAME_CONVERT (maindisk, auxdisk);
</pre>
<div class="infobox-note" id="GUID-BA6F7010-407B-4E16-8F53-597FD49B64E3__GUID-FAA5F005-6949-43B6-A772-6BD9EDE0BD74">
<p class="notep1">Note:</p>
<p>Because Oracle managed file names cannot generally be translated using a simple substitution, you cannot typically use <code class="codeph">DB_FILE_NAME_CONVERT</code> to generate names for image copies stored in OMF.</p>
</div>
</li>
</ul>
<p>After these steps, you are prepared for TSPITR without restoring the auxiliary set from backup. For example, if an erroneous batch job, started on November 15, 2013, at 19:00:00, incorrectly updates the tables in the tablespace <code class="codeph">parts</code>, you use the following command to perform TSPITR on tablespace <code class="codeph">parts</code>:</p>
<pre dir="ltr">RECOVER TABLESPACE parts UNTIL TIME &#39;November 15 2013, 19:00:00&#39;;
</pre>
<p>Because <code class="codeph">AUXNAME</code> locations are configured and refer to data file copies from an SCN before the TSPITR target time, the auxiliary set is not restored from backup. Instead, the data file copies are used in recovery, which reduces the restore overhead.</p>
<p>You can also prevent the recovery set from being restored. You must take frequent image copies of the tablespaces and use <code class="codeph">SET NEWNAME</code> to specify the location of these copies. This method ensures that the recovery set is not restored and the tablespace changes location after TSPITR successfully completes.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV389"></a><a id="BRADV89809"></a>
<div class="props_rev_3"><a id="GUID-A86E8164-690C-49B7-B978-85E460DA2AC6"></a>
<h3 id="BRADV-GUID-A86E8164-690C-49B7-B978-85E460DA2AC6" class="sect3">Customizing Initialization Parameters for the Automatic Auxiliary Database in TSPITR</h3>
<div>
<p>The automatic auxiliary database uses a set of default initialization parameters as shown in <a href="rcmtspit.htm#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6__CHDJIJAF" title="Default initialization parameters">Table 21-4</a>. It also looks for additional initialization parameters to complement the default parameters in a location that is operating system-dependent. For example, in UNIX this location is: <code class="codeph">?/rdbms/admin/params_auxinst.ora</code>. RMAN always looks for this additional parameter file for an RMAN-automatic auxiliary database when performing TSPITR. If the file is not found, then RMAN does not generate an error. Instead, RMAN uses the default parameters in <a href="rcmtspit.htm#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6__CHDJIJAF" title="Default initialization parameters">Table 21-4</a> for the RMAN-managed automatic auxiliary database.</p>
<div class="tblformal" id="GUID-A86E8164-690C-49B7-B978-85E460DA2AC6__CHDJIJAF">
<p class="titleintable">Table 21-4 Default Initialization Parameters for the RMAN-Managed Auxiliary Database</p>
<table class="cellalignment515" title="Default Initialization Parameters for the RMAN-Managed Auxiliary Database" summary="Default initialization parameters">
<thead>
<tr class="cellalignment501">
<th class="cellalignment522" id="d82616e3633">Initialization Parameter</th>
<th class="cellalignment525" id="d82616e3636">Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3641" headers="d82616e3633">
<p><code class="codeph">DB_NAME</code></p>
</td>
<td class="cellalignment526" headers="d82616e3641 d82616e3636">
<p>Same as <code class="codeph">DB_NAME</code> of the source database</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3653" headers="d82616e3633">
<p><code class="codeph">COMPATIBLE</code></p>
</td>
<td class="cellalignment526" headers="d82616e3653 d82616e3636">
<p>Same as the <code class="codeph">COMPATIBLE</code> setting of the target database</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3664" headers="d82616e3633">
<p><code class="codeph">DB_UNIQUE_NAME</code></p>
</td>
<td class="cellalignment526" headers="d82616e3664 d82616e3636">
<p>RMAN auto-generated unique value based on <code class="codeph">DB_NAME</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3674" headers="d82616e3633">
<p><code class="codeph">DB_BLOCK_SIZE</code></p>
</td>
<td class="cellalignment526" headers="d82616e3674 d82616e3636">
<p>Same as the <code class="codeph">DB_BLOCK_SIZE</code> of the target database</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3685" headers="d82616e3633">
<p><code class="codeph">DB_CREATE_FILE_DEST</code></p>
</td>
<td class="cellalignment526" headers="d82616e3685 d82616e3636">
<p>Auxiliary destination (only if the <code class="codeph">AUXILIARY DESTINATION</code> argument is specified when using an RMAN-managed auxiliary database). RMAN creates Oracle Managed Files for the auxiliary set files in this location.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3696" headers="d82616e3633">
<p><code class="codeph">LOG_ARCHIVE_DEST_1</code></p>
</td>
<td class="cellalignment526" headers="d82616e3696 d82616e3636">
<p>Auxiliary destination (only if the <code class="codeph">AUXILIARY DESTINATION</code> clause is specified when using an RMAN-managed auxiliary database). Archived logs needed for recovery are restored to this location.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3707" headers="d82616e3633">
<p><code class="codeph">SGA_TARGET</code></p>
</td>
<td class="cellalignment526" headers="d82616e3707 d82616e3636">
<p><code class="codeph">280M</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3716" headers="d82616e3633">
<p><code class="codeph">DB_FILES</code></p>
</td>
<td class="cellalignment526" headers="d82616e3716 d82616e3636">
<p>Same as <code class="codeph">DB_FILES</code> of the target database</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d82616e3727" headers="d82616e3633">
<p><code class="codeph">PROCESSES</code></p>
</td>
<td class="cellalignment526" headers="d82616e3727 d82616e3636">
<p><code class="codeph">50</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Usually it is not necessary to alter or add to the values of these initialization parameters, especially if you provide an <code class="codeph">AUXILIARY DESTINATION</code> clause to the <code class="codeph">RECOVER TABLESPACE</code> command when using a RMAN-managed auxiliary database. If you override an initialization parameter in <a href="rcmtspit.htm#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6__CHDJIJAF" title="Default initialization parameters">Table 21-4</a> with an inappropriate value, then TSPITR may fail due to problems with the auxiliary database. Nevertheless, you can add other parameters besides these basic parameters if needed. For example, you can use <code class="codeph">DB_FILE_NAME_CONVERT</code> to specify the names of the data files in the auxiliary and recovery sets.</p>
<p>To override or specify parameters for the automatic auxiliary database, you can do either of the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Place the initialization parameters in the operating system specific default auxiliary parameter file name. For example, in UNIX, the file name is: <code class="codeph">?/rdbms/admin/params_auxinst.ora</code>.</p>
</li>
<li>
<p>Perform these steps:</p>
<ol>
<li>
<p>Place the initialization parameters in a file.</p>
</li>
<li>
<p>Specify the location of this file with the <code class="codeph">SET AUXILIARY INSTANCE PARAMETER FILE</code> command before executing TSPITR.</p>
</li>
</ol>
</li>
</ul>
<p>Regardless of the method that you choose, the parameters that you specify take precedence over defaults and can override the value of an <code class="codeph">AUXILIARY DESTINATION</code> clause.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtspit.htm#GUID-E3EDE63E-79D4-4FEC-9AB4-6ADBE28FA7A9">Specifying the Auxiliary Database Archived Logs in TSPITR</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-9561F2D0-D174-4571-8D4F-4249FA12AFED">Specifying the Auxiliary Database Control File Location in TSPITR</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-19B9240A-6158-4353-939C-BB6DB1F02984">Specifying the Auxiliary Database Online Log Location in TSPITR</a></p>
</li>
</ul>
</div>
<a id="BRADV89810"></a>
<div class="props_rev_3"><a id="GUID-9561F2D0-D174-4571-8D4F-4249FA12AFED"></a>
<h4 id="BRADV-GUID-9561F2D0-D174-4571-8D4F-4249FA12AFED" class="sect4">Specifying the Auxiliary Database Control File Location in TSPITR</h4>
<div>
<div class="section">
<p>If you use an initialization parameter file, then you can specify your own location for the control file of your auxiliary database. Set the <code class="codeph">CONTROL_FILES</code> initialization parameter to specify a location for the control files.</p>
<p>If you do not explicitly specify a control file location, and if you use the <code class="codeph">AUXILIARY DESTINATION</code> clause, then RMAN locates the control file in the auxiliary destination. If you do not use the <code class="codeph">AUXILIARY DESTINATION</code> clause, then the auxiliary database control files are stored in an operating system-specific location.</p>
<p>No matter where you store your auxiliary database control file, it is removed at the end of the TSPITR operation. Because control files are relatively small, it is rare that RMAN encounters a problem creating an auxiliary control file. If there is not enough space to create the control file, however, then TSPITR fails.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV390"></a>
<div class="props_rev_3"><a id="GUID-E3EDE63E-79D4-4FEC-9AB4-6ADBE28FA7A9"></a>
<h4 id="BRADV-GUID-E3EDE63E-79D4-4FEC-9AB4-6ADBE28FA7A9" class="sect4">Specifying the Auxiliary Database Archived Logs in TSPITR</h4>
<div>
<div class="section">
<p>To perform recovery on the auxiliary and recovery sets after restoring them at the auxiliary database, RMAN may need to restore archived logs. When an auxiliary destination is being used, the archived logs are restored to that location. In the absence of an auxiliary destination and any other initialization parameters, the archived logs are restored to an operating system specific location. For details, consult your operating system specific documentation. You can use the <code class="codeph">LOG_ARCHIVE_DEST_1</code> initialization parameter to specify an alternative location where the archived logs are restored.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89811"></a>
<div class="props_rev_3"><a id="GUID-19B9240A-6158-4353-939C-BB6DB1F02984"></a>
<h4 id="BRADV-GUID-19B9240A-6158-4353-939C-BB6DB1F02984" class="sect4">Specifying the Auxiliary Database Online Log Location in TSPITR</h4>
<div>
<div class="section">
<p>If you specify the <code class="codeph">LOG_FILE_NAME_CONVERT</code> initialization parameter in your auxiliary database parameter file and the parameter successfully converts the names of the online redo logs of the target, then this parameter determines the online redo log location. The same restrictions that apply to OMF data files, apply to OMF online redo logs. For more information, see <span class="q">&#34;<a href="rcmtspit.htm#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419">Considerations When Renaming OMF Auxiliary Set Files in TSPITR</a>&#34;</span>. If RMAN is managing the auxiliary database and an auxiliary destination is specified, RMAN creates the online redo log in the auxiliary destination.</p>
<p>Alternatively, you can use <code class="codeph">DB_CREATE_FILE_DEST</code> or <code class="codeph">DB_CREATE_FILE_DEST</code> and <code class="codeph">DB_CREATE_ONLINE_LOG_1</code> to specify the location where the auxiliary database redo logs are created. If you choose the latter option, you must use <code class="codeph">DB_CREATE_ONLINE_LOG_1</code> with <code class="codeph">DB_CREATE_FILE_DEST</code>.</p>
<p>TSPITR fails to create the online redo logs if you do not specify a location for them by using one of the following:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">LOG_FILE_NAME_CONVERT</code></p>
</li>
<li>
<p><code class="codeph">DB_CREATE_FILE_DEST</code></p>
</li>
<li>
<p><code class="codeph">DB_CREATE_FILE_DEST</code> and <code class="codeph">DB_CREATE_ONLINE_LOG_1</code></p>
</li>
<li>
<p><code class="codeph">AUXILIARY DESTINATION</code></p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<a id="BRADV89812"></a>
<div class="props_rev_3"><a id="GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0"></a>
<h2 id="BRADV-GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0" class="sect2">Performing RMAN TSPITR Using Your Own Auxiliary Database</h2>
<div>
<p>Although Oracle recommends that you let RMAN manage all aspects of the auxiliary database, there may be times when you must create and manage your own auxiliary database. If you select this mode, you are responsible for setting up, starting, stopping and cleaning up the auxiliary database used in TSPITR.</p>
<p>One reason that you might want to create your own instance is to exercise control of channels used in TSPITR. The automatic auxiliary database uses the configured channels of the target database as the basis for the channels to configure on the auxiliary database and to use during the restore operation. You may need different channel settings and may not want to use the <code class="codeph">CONFIGURE</code> command to change the settings on the target database. In this case, you can operate your own auxiliary database. By connecting to the auxiliary database before invoking <code class="codeph">RECOVER</code>, a run block can provide specific channel allocations using <code class="codeph">the ALLOCATE AUXILIARY CHANNEL</code> command.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtspit.htm#GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F">Preparing Your Own Auxiliary Database for RMAN TSPITR</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-41F8F223-E065-445C-AF4B-2343F13813AD">Preparing RMAN Commands for TSPITR with Your Own Auxiliary Database</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9">Executing TSPITR with Your Own Auxiliary Database</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC">Performing TSPITR with Your Own Auxiliary Database: Scenario</a></p>
</li>
</ul>
</div>
<a id="BRADV89813"></a>
<div class="props_rev_3"><a id="GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F"></a>
<h3 id="BRADV-GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F" class="sect3">Preparing Your Own Auxiliary Database for RMAN TSPITR</h3>
<div>
<div class="section">
<p><a id="d82616e4250" class="indexterm-anchor"></a>Creating an Oracle instance suitable for use as an auxiliary database requires that you complete all of the following steps:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtspit.htm#GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052">Step 1: Create an Oracle Password File for the Auxiliary Database</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB">Step 2: Create an Initialization Parameter File for the Auxiliary Database</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E">Step 3: Check Oracle Net Connectivity to the Auxiliary Database</a></p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="BRADV89814"></a>
<div class="props_rev_3"><a id="GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052"></a>
<h4 id="BRADV-GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052" class="sect4">Step 1: Create an Oracle Password File for the Auxiliary Database</h4>
<div>
<div class="section">
<p>For instructions on how to create and maintain Oracle password files, refer to <a class="olink ADMIN10241" target="_blank" href="../ADMIN/dba.htm#ADMIN10241"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a>.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV391"></a><a id="BRADV89815"></a>
<div class="props_rev_3"><a id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB"></a>
<h4 id="BRADV-GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB" class="sect4">Step 2: Create an Initialization Parameter File for the Auxiliary Database</h4>
<div>
<div class="section">
<p>Use a text editor to create an initialization parameter file for the auxiliary database on the target database host. For this example, assume that your parameter file is placed at <code class="codeph">/tmp/initAux.ora</code>. Set the parameters described in <a href="rcmtspit.htm#GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB__CHDFJCCF" title="This table is described in the preceding text.">Table 21-5</a>.</p>
<div class="infobox-note" id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB__GUID-2EDC3F15-B6D8-4EE6-9622-99CE6241ADC9">
<p class="notep1">Note:</p>
<p>For TSPITR, the target and auxiliary database instances must be on the same host.</p>
</div>
<div class="tblformalwide" id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB__CHDFJCCF">
<p class="titleintable">Table 21-5 Initialization Parameters in a User-Managed Auxiliary Database</p>
<table class="cellalignment553" title="Initialization Parameters in a User-Managed Auxiliary Database" summary="This table is described in the preceding text.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment564" id="d82616e4442">Initialization Parameter</th>
<th class="cellalignment531" id="d82616e4445">Mandatory?</th>
<th class="cellalignment564" id="d82616e4448">Value</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4453" headers="d82616e4442">
<p><a id="d82616e4455" class="indexterm-anchor"></a><a id="d82616e4459" class="indexterm-anchor"></a><code class="codeph">DB_NAME</code></p>
</td>
<td class="cellalignment534" headers="d82616e4453 d82616e4445">
<p>YES</p>
</td>
<td class="cellalignment565" headers="d82616e4453 d82616e4448">
<p>The same name as the target database</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4470" headers="d82616e4442">
<p><code class="codeph">DB_UNIQUE_NAME</code></p>
</td>
<td class="cellalignment534" headers="d82616e4470 d82616e4445">
<p>YES</p>
</td>
<td class="cellalignment565" headers="d82616e4470 d82616e4448">
<p>A value different from any database in the same Oracle home. For simplicity, specify <code class="codeph">_</code><span class="italic"><code class="codeph">dbname</code></span>. For example, if the target database name is <code class="codeph">trgt</code>, then specify <code class="codeph">_trgt</code>.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4493" headers="d82616e4442">
<p><code class="codeph">REMOTE_LOGIN_PASSWORDFILE</code></p>
</td>
<td class="cellalignment534" headers="d82616e4493 d82616e4445">
<p>YES</p>
</td>
<td class="cellalignment565" headers="d82616e4493 d82616e4448">
<p>Set to <code class="codeph">EXCLUSIVE</code> when connecting to the auxiliary database with a password file. Otherwise, set to <code class="codeph">NONE</code>.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4510" headers="d82616e4442">
<p><code class="codeph">COMPATIBLE</code></p>
</td>
<td class="cellalignment534" headers="d82616e4510 d82616e4445">
<p>YES</p>
</td>
<td class="cellalignment565" headers="d82616e4510 d82616e4448">
<p>The same value as the parameter in the target database</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4521" headers="d82616e4442">
<p><code class="codeph">DB_BLOCK_SIZE</code></p>
</td>
<td class="cellalignment534" headers="d82616e4521 d82616e4445">
<p>YES</p>
</td>
<td class="cellalignment565" headers="d82616e4521 d82616e4448">
<p>If this initialization parameter is set in the target database, then it must be set to the same value in the auxiliary database.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4532" headers="d82616e4442">
<p><a id="d82616e4534" class="indexterm-anchor"></a><a id="d82616e4538" class="indexterm-anchor"></a><code class="codeph">LOG_FILE_NAME_CONVERT</code></p>
</td>
<td class="cellalignment534" headers="d82616e4532 d82616e4445">
<p>NO</p>
</td>
<td class="cellalignment565" headers="d82616e4532 d82616e4448">
<p>Patterns to generate file names for the online redo logs of the auxiliary database based on the online redo log names of the target database. <a id="d82616e4548" class="indexterm-anchor"></a>Query <code class="codeph">V$LOGFILE.MEMBER</code>to obtain target instance online redo log file names, and ensure that the conversion pattern matches the format of the file name shown in the view.</p>
<p><span class="bold">Note:</span> Some platforms do not support ending patterns in a forward or backward slash (<code class="codeph">\</code> or <code class="codeph">/</code>).</p>
<p><span class="bold">See Also:</span> <span class="q">&#34;<a href="rcmtspit.htm#GUID-19B9240A-6158-4353-939C-BB6DB1F02984">Specifying the Auxiliary Database Online Log Location in TSPITR</a>&#34;</span> for restrictions on possible values for <code class="codeph">LOG_FILE_NAME_CONVERT</code> with OMF file names and <span class="q">&#34;<a href="rcmtspit.htm#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419">Considerations When Renaming OMF Auxiliary Set Files in TSPITR</a>&#34;</span></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4581" headers="d82616e4442">
<p><a id="d82616e4583" class="indexterm-anchor"></a><a id="d82616e4587" class="indexterm-anchor"></a><code class="codeph">DB_FILE_NAME_CONVERT</code></p>
</td>
<td class="cellalignment534" headers="d82616e4581 d82616e4445">
<p>NO</p>
</td>
<td class="cellalignment565" headers="d82616e4581 d82616e4448">
<p>Patterns to convert file names for the data files of the auxiliary database. You can use this parameter to generate file names for those files that you did not name with <code class="codeph">SET</code> <code class="codeph">NEWNAME</code> or <code class="codeph">CONFIGURE</code> <code class="codeph">AUXNAME</code>. Obtain the data file names by querying<a id="d82616e4609" class="indexterm-anchor"></a> <code class="codeph">V$DATAFILE.NAME</code>, and ensure that the conversion pattern matches the format of the file name displayed in the view.</p>
<p><span class="bold">Note:</span> Some platforms do not support ending patterns in a forward or backward slash (<code class="codeph">\</code> or <code class="codeph">/</code>).</p>
<p><span class="bold">See Also:</span> <span class="q">&#34;<a href="rcmtspit.htm#GUID-310586B1-F08C-456C-8398-62CB6930DD4C">Using DB_FILE_NAME_CONVERT to Name Auxiliary Set Data Files During TSPITR</a>&#34;</span> and <span class="q">&#34;<a href="rcmtspit.htm#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419">Considerations When Renaming OMF Auxiliary Set Files in TSPITR</a>&#34;</span>.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4641" headers="d82616e4442">
<p><code class="codeph">DB_CREATE_FILE_DEST</code></p>
</td>
<td class="cellalignment534" headers="d82616e4641 d82616e4445">
<p>NO</p>
</td>
<td class="cellalignment565" headers="d82616e4641 d82616e4448">
<p>Identifies a location for all auxiliary set files.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4652" headers="d82616e4442">
<p><code class="codeph">LOG_ARCHIVE_DEST_</code><span class="italic"><code class="codeph">n</code></span></p>
</td>
<td class="cellalignment534" headers="d82616e4652 d82616e4445">
<p>NO</p>
</td>
<td class="cellalignment565" headers="d82616e4652 d82616e4448">
<p>Identifies where archived logs required for recover are created.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4666" headers="d82616e4442">
<p><code class="codeph">DB_CREATE_ONLINE_LOG_</code><span class="italic"><code class="codeph">n</code></span></p>
</td>
<td class="cellalignment534" headers="d82616e4666 d82616e4445">
<p>NO</p>
</td>
<td class="cellalignment565" headers="d82616e4666 d82616e4448">
<p>With <code class="codeph">DB_CREATE_FILE_DEST</code> identifies a different location where online redo logs are created.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4683" headers="d82616e4442">
<p><a id="d82616e4685" class="indexterm-anchor"></a><code class="codeph">CONTROL_FILES</code></p>
</td>
<td class="cellalignment534" headers="d82616e4683 d82616e4445">
<p>NO</p>
</td>
<td class="cellalignment565" headers="d82616e4683 d82616e4448">
<p>File names that do not conflict with the control file names of the target instance (or any other existing file).</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4697" headers="d82616e4442">
<p><code class="codeph">SGA_TARGET</code></p>
</td>
<td class="cellalignment534" headers="d82616e4697 d82616e4445">
<p>NO (Recommended)</p>
</td>
<td class="cellalignment565" headers="d82616e4697 d82616e4448">
<p><code class="codeph">280M</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment565" id="d82616e4709" headers="d82616e4442">
<p><code class="codeph">STREAMS_POOL_SIZE</code></p>
</td>
<td class="cellalignment534" headers="d82616e4709 d82616e4445">
<p>NO</p>
<p>YES</p>
</td>
<td class="cellalignment565" headers="d82616e4709 d82616e4448">
<p>If <code class="codeph">SGA_TARGET</code> is set</p>
<p>If <code class="codeph">SGA_TARGET</code> is not set</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Set other parameters as needed, including the parameters to specify how much memory the auxiliary database uses.</p>
<p>The following example shows possible initialization parameter settings for an auxiliary database for TSPITR:</p>
<pre dir="ltr">DB_NAME=trgt
DB_UNIQUE_NAME=_trgt
CONTROL_FILES=/tmp/control01.ctl
DB_FILE_NAME_CONVERT=(&#39;/oracle/oradata/trgt/&#39;,&#39;/tmp/&#39;)
LOG_FILE_NAME_CONVERT=(&#39;/oracle/oradata/trgt/redo&#39;,&#39;/tmp/redo&#39;)
REMOTE_LOGIN_PASSWORDFILE=exclusive
COMPATIBLE =11.0.0
DB_BLOCK_SIZE=8192
</pre>
<div class="infobox-note" id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB__GUID-A7F17125-27C6-499E-884E-FB6E0CE2A29E">
<p class="notep1">Note:</p>
<p>After setting these initialization parameters, ensure that you do not overwrite the initialization settings for the production files at the target database.</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89816"></a>
<div class="props_rev_3"><a id="GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E"></a>
<h4 id="BRADV-GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E" class="sect4">Step 3: Check Oracle Net Connectivity to the Auxiliary Database</h4>
<div>
<div class="section">
<p>The auxiliary database must have a valid net service name. Before proceeding, use SQL*Plus to ensure that you can establish a <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> connection to the auxiliary database.</p>
<div class="infoboxnotealso" id="GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E__GUID-BD7A9395-B62A-4FBF-8B5A-3E8B17A75FB3">
<p class="notep1">See Also:</p>
<p><a class="olink NETAG" target="_blank" href="../NETAG/toc.htm"><span class="italic">Oracle Database Net Services Administrator&#39;s Guide</span></a> for more information about Oracle Net</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV89817"></a>
<div class="props_rev_3"><a id="GUID-41F8F223-E065-445C-AF4B-2343F13813AD"></a>
<h3 id="BRADV-GUID-41F8F223-E065-445C-AF4B-2343F13813AD" class="sect3">Preparing RMAN Commands for TSPITR with Your Own Auxiliary Database</h3>
<div>
<p>If you run your own auxiliary database, then it is possible for the sequence of commands required for TSPITR to be long. This situation can occur when you allocate a complex channel configuration for restoring from backup and you are not using <code class="codeph">DB_CREATE_FILE_DEST</code> to determine file naming of auxiliary set files.</p>
<p>You may want to store the series of commands for TSPITR in an RMAN command file. Review the command file carefully to catch any errors. To read the command file into RMAN, use the <code class="codeph">@</code> command (or the <code class="codeph">CMDFILE</code> command-line argument when starting RMAN).</p>
<p>The following example runs the command file named <code class="codeph">/tmp/tspitr.rman</code>:</p>
<pre dir="ltr">@/tmp/tspitr.rman;
</pre>
<div class="infoboxnotealso" id="GUID-41F8F223-E065-445C-AF4B-2343F13813AD__GUID-AAB70C5F-E819-4CB9-9027-15E31F1D624D">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-5FF51A4E-BC27-41A9-AA83-FF6E761C2535">Using Command Files with RMAN</a>&#34;</span></p>
</div>
</div>
<a id="BRADV89818"></a>
<div class="sect4"><a id="GUID-DA6FD63F-4E85-4550-A49F-C6E793BD5FC9"></a>
<h4 id="BRADV-GUID-DA6FD63F-4E85-4550-A49F-C6E793BD5FC9" class="sect4">Planning Channels for TSPITR with Your Own Auxiliary Database</h4>
<div>
<p>When you run your own auxiliary database, the default behavior is to use the automatic channel configuration of the target database. If you decide to allocate your own channels with a different configuration (changing the number of channels or channel parameters), you can include <code class="codeph">ALLOCATE AUXILIARY CHANNEL</code> commands in a <code class="codeph">RUN</code> block along with the <code class="codeph">RECOVER TABLESPACE</code> command for TSPITR. Plan these commands, if necessary, and add them to the sequence of commands you run for TSPITR.</p>
<div class="infoboxnotealso" id="GUID-DA6FD63F-4E85-4550-A49F-C6E793BD5FC9__GUID-8CB9DE45-B9EA-421B-A579-ACD876C22E26">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmtspit.htm#GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC">Performing TSPITR with Your Own Auxiliary Database: Scenario</a>&#34;</span> to learn how to include channel allocation in your TSPITR script</p>
</div>
</div>
</div>
<a id="BRADV89819"></a>
<div class="props_rev_3"><a id="GUID-56BC4D66-320B-4607-8443-64F577CE28C5"></a>
<h4 id="BRADV-GUID-56BC4D66-320B-4607-8443-64F577CE28C5" class="sect4">Planning Data File Names with Your Own Auxiliary Database: SET NEWNAME</h4>
<div>
<p>You may want to use <code class="codeph">SET NEWNAME</code> commands to refer to existing image copies of auxiliary set files to improve TSPITR performance, or to assign new names to the recovery set files for after TSPITR. Plan these commands, if necessary, and add them to the sequence of commands that you run for TSPITR. For more information, see <span class="q">&#34;<a href="rcmtspit.htm#GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49">Renaming TSPITR Recovery Set Data Files with SET NEWNAME</a>&#34;</span>.</p>
</div>
</div>
</div>
<a id="BRADV89820"></a>
<div class="props_rev_3"><a id="GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9"></a>
<h3 id="BRADV-GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9" class="sect3">Executing TSPITR with Your Own Auxiliary Database</h3>
<div>
<div class="section">
<p>With the preparations described in <a href="rcmtspit.htm#GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F">Preparing Your Own Auxiliary Database for RMAN TSPITR</a> and <a href="rcmtspit.htm#GUID-41F8F223-E065-445C-AF4B-2343F13813AD">Preparing RMAN Commands for TSPITR with Your Own Auxiliary Database</a> complete and your TSPITR commands completely planned, you are now ready to perform TSPITR. The following steps are required:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmtspit.htm#GUID-B11C4436-C191-4C77-983C-A2C76C4E94D2">Step 1: Start the Auxiliary Database in NOMOUNT Mode</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79">Step 2: Connect the RMAN Client to Target and Auxiliary Databases</a></p>
</li>
<li>
<p><a href="rcmtspit.htm#GUID-17B6A748-6DDF-42C1-B171-86AB8151AA4B">Step 3: Execute the RECOVER TABLESPACE Command</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9__GUID-62B85911-23FC-4115-9CBF-27CEB9FFBCEF">
<p class="notep1">See Also:</p>
<p><a href="rcmtspit.htm#GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC">Performing TSPITR with Your Own Auxiliary Database: Scenario</a></p>
</div>
</div>
<!-- class="section" --></div>
<a id="BRADV89821"></a>
<div class="props_rev_3"><a id="GUID-B11C4436-C191-4C77-983C-A2C76C4E94D2"></a>
<h4 id="BRADV-GUID-B11C4436-C191-4C77-983C-A2C76C4E94D2" class="sect4">Step 1: Start the Auxiliary Database in NOMOUNT Mode</h4>
<div>
<div class="section">
<p>Before beginning RMAN TSPITR, start SQL*Plus and connect to the auxiliary database with <code class="codeph">SYSOPER</code> privileges.</p>
<p>Start the auxiliary database in <code class="codeph">NOMOUNT</code> mode, specifying a parameter file if necessary. For example, enter the following SQL*Plus command:</p>
<pre dir="ltr">SQL&gt; STARTUP NOMOUNT PFILE=&#39;/tmp/initAux.ora&#39;
</pre>
<p>Remember that if you specify <code class="codeph">PFILE</code>, then the path for the <code class="codeph">PFILE</code> is a client-side path on the host from which you run SQL*Plus.</p>
<p>Because the auxiliary database does not yet have a control file, you can only start the instance in <code class="codeph">NOMOUNT</code> mode. Do not create a control file or try to mount or open the auxiliary database for TSPITR.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89822"></a>
<div class="props_rev_3"><a id="GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79"></a>
<h4 id="BRADV-GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79" class="sect4">Step 2: Connect the RMAN Client to Target and Auxiliary Databases</h4>
<div>
<div class="section">
<p>Start RMAN and connect to the target database and the manually created auxiliary database.</p>
<pre dir="ltr">rman target dba AUXILIARY auxusr@aux
</pre>
<div class="infoboxnotealso" id="GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79__GUID-C6A327B7-49F9-4183-9648-0DB15C9B7BAA">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89823"></a>
<div class="props_rev_3"><a id="GUID-17B6A748-6DDF-42C1-B171-86AB8151AA4B"></a>
<h4 id="BRADV-GUID-17B6A748-6DDF-42C1-B171-86AB8151AA4B" class="sect4">Step 3: Execute the RECOVER TABLESPACE Command</h4>
<div>
<div class="section">
<p>In the simplest case, execute the <code class="codeph">RECOVER TABLESPACE... UNTIL</code> command at the RMAN prompt:</p>
<pre dir="ltr">RECOVER TABLESPACE <span class="italic">ts1, ts2...</span> UNTIL TIME &#39;<span class="italic">time</span>&#39;;
</pre>
<p>If you want to use the <code class="codeph">ALLOCATE AUXILIARY CHANNEL</code> or <code class="codeph">SET NEWNAME</code> commands, then include these commands before the <code class="codeph">RECOVER TABLESPACE</code> command within a <code class="codeph">RUN</code> command. The following example illustrates this technique:</p>
<pre dir="ltr">RUN
{
   ALLOCATE AUXILIARY CHANNEL c1 DEVICE TYPE DISK;
   ALLOCATE AUXILIARY CHANNEL c2 DEVICE TYPE sbt;
  # and so on...
   RECOVER TABLESPACE <span class="italic">ts1, ts2</span> UNTIL TIME &#39;time&#39;;
}
</pre></div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV89825"></a>
<div class="props_rev_3"><a id="GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC"></a>
<h3 id="BRADV-GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC" class="sect3">Performing TSPITR with Your Own Auxiliary Database: Scenario</h3>
<div>
<div class="section">
<p>This scenario shows the execution of a <code class="codeph">RECOVER TABLESPACE... UNTIL</code> operation. This scenario illustrates the following features of RMAN TSPITR:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Managing your own auxiliary database</p>
</li>
<li>
<p>Configuring channels for restore of backups from disk and <a href="glossary.htm#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> devices</p>
</li>
<li>
<p>Using recoverable image copies for some auxiliary set data files using <code class="codeph">SET NEWNAME</code></p>
</li>
<li>
<p>Specifying new names for recovery set data files using <code class="codeph">SET NEWNAME</code></p>
</li>
</ul>
<p><span class="bold">To use TSPITR with your own auxiliary database:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Prepare the auxiliary database as described in <span class="q">&#34;<a href="rcmtspit.htm#GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F">Preparing Your Own Auxiliary Database for RMAN TSPITR</a>&#34;</span>. Specify a password for the auxiliary database in the password file, and set up the auxiliary database parameter file <code class="codeph">/bigtmp/init_tspitr_prod.ora</code> with the following settings:</span>
<div>
<pre dir="ltr">DB_NAME=PROD
DB_UNIQUE_NAME=tspitr_PROD
CONTROL_FILES=/bigtmp/tspitr_cntrl.dbf
DB_CREATE_FILE_DEST=/bigtmp
COMPATIBLE=11.0.0
BLOCK_SIZE=8192
REMOTE_LOGIN_PASSWORD=exclusive
</pre></div>
</li>
<li class="stepexpand"><span>Create service name <code class="codeph">pitprod</code> for the auxiliary database, and check for connectivity.</span></li>
<li class="stepexpand"><span>Using SQL*Plus, connect to the auxiliary database with <code class="codeph">SYSOPER</code> privileges. Start the instance in <code class="codeph">NOMOUNT</code> mode:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP NOMOUNT PFILE=/bigtmp/init_tspitr_prod.ora
</pre></div>
</li>
<li class="stepexpand"><span>Start RMAN and connect to the target and auxiliary database instances.</span>
<div>
<pre dir="ltr">rman target / auxiliary &#39;&#34;sbu@pitprod AS SYSBACKUP&#34;&#39;
</pre>
<div class="infoboxnotealso" id="GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC__GUID-BB091EC9-A7D6-4157-B169-CFE9E966F89F">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span>Enter the following commands in a <code class="codeph">RUN</code> block to set up and execute TSPITR:</span>
<div>
<pre dir="ltr">RUN 
{
# Specify NEWNAME for recovery set data files
  SET NEWNAME FOR TABLESPACE clients
                        TO &#39;?/oradata/prod/rec/%b&#39;;

# Specify NEWNAMES for some auxiliary set 
# data files that have a valid image copy to avoid restores:
  SET NEWNAME FOR DATAFILE &#39;?/oradata/prod/system01.dbf&#39;
                        TO &#39;/backups/prod/system01_monday_noon.dbf&#39;;
  SET NEWNAME FOR DATAFILE &#39;?/oradata/prod/system02.dbf&#39;
                        TO &#39;/backups/prod/system02_monday_noon.dbf&#39;;
  SET NEWNAME FOR DATAFILE &#39;?/oradata/prod/sysaux01.dbf&#39;
                        TO &#39;/backups/prod/sysaux01_monday_noon.dbf&#39;;
  SET NEWNAME FOR DATAFILE &#39;?/oradata/prod/undo01.dbf&#39;
                        TO &#39;/backups/prod/undo01_monday_noon.dbf&#39;;

# Specify the types of channels to use
  ALLOCATE AUXILIARY CHANNEL c1 DEVICE TYPE DISK;
  ALLOCATE AUXILIARY CHANNEL t1 DEVICE TYPE sbt;

# Recover the clients tablespace to 24 hours ago:
  RECOVER TABLESPACE clients UNTIL TIME &#39;sysdate-1&#39;;
}
</pre></div>
</li>
</ol>
<div class="section">
<p>Consider storing this command sequence in a command file and executing the command file.</p>
<p>If the TSPITR operation is successful, then the results are:</p>
<ul style="list-style-type: disc;">
<li>
<p>The recovery set data files are registered in the target database control file under the names specified with <code class="codeph">SET NEWNAME</code>, with their contents as of the time specified time for TSPITR.</p>
</li>
<li>
<p>The auxiliary files are removed by RMAN, including the control files, online logs, and auxiliary set data files of the auxiliary database.</p>
</li>
<li>
<p>The auxiliary database is shut down.</p>
</li>
</ul>
<p>If the TSPITR operation fails, the auxiliary set files are removed and the auxiliary database is shut down. The recovery set files are left in the specified location and in an unresolved state from the failed TSPITR run.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV99978"></a>
<div class="props_rev_3"><a id="GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96"></a>
<h2 id="BRADV-GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96" class="sect2">Troubleshooting RMAN TSPITR</h2>
<div>
<div class="section">
<p>A variety of problems can cause RMAN TSPITR to fail. This section lists possible areas to check and fix:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>File name conflicts</p>
<p>See <a href="rcmtspit.htm#GUID-686CCC72-9402-422C-A7B7-82ABDECE3ACD">Troubleshooting File Name Conflicts During TSPITR</a>.</p>
</li>
<li>
<p>Mismatched or incorrect TSPITR target times for sets of tablespaces and undo segments</p>
<p>See <a href="rcmtspit.htm#GUID-D4786A53-826B-4503-83DE-B21B98591C0A">Troubleshooting the Identification of Tablespaces with Undo Segments During TSPITR</a>.</p>
</li>
<li>
<p>Management issues with auxiliary databases not created by RMAN</p>
<p>See <a href="rcmtspit.htm#GUID-DAF577E1-0177-4EBC-ABF8-3D821BD21BB0">Troubleshooting the Restart of a Manual Auxiliary Database After TSPITR Failure</a>.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="BRADV89826"></a>
<div class="props_rev_3"><a id="GUID-686CCC72-9402-422C-A7B7-82ABDECE3ACD"></a>
<h3 id="BRADV-GUID-686CCC72-9402-422C-A7B7-82ABDECE3ACD" class="sect3">Troubleshooting File Name Conflicts During TSPITR</h3>
<div>
<div class="section">
<p>Name conflicts can occur between files in the target database, file names assigned by the <code class="codeph">SET NEWNAME</code> or <code class="codeph">CONFIGURE AUXNAME</code> commands, and file names generated by the effect of the <code class="codeph">DB_FILE_NAME_CONVERT</code> parameter.</p>
<p>Suppose that <code class="codeph">SET NEWNAME</code>, <code class="codeph">CONFIGURE AUXNAME</code>, and <code class="codeph">DB_FILE_NAME_CONVERT</code> cause multiple files in the auxiliary or recovery sets to have the same name. In this case, RMAN reports an error during TSPITR. To correct the problem, use different values for these parameters.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89827"></a>
<div class="props_rev_3"><a id="GUID-D4786A53-826B-4503-83DE-B21B98591C0A"></a>
<h3 id="BRADV-GUID-D4786A53-826B-4503-83DE-B21B98591C0A" class="sect3">Troubleshooting the Identification of Tablespaces with Undo Segments During TSPITR</h3>
<div>
<div class="section">
<p>During TSPITR, RMAN needs information about which tablespaces had undo segments at the TSPITR target time. This information is usually available in the recovery catalog, if one is used.</p>
<p>If there is no recovery catalog or if the information is not found in the recovery catalog, RMAN assumes that the set of tablespaces with undo segments at the target time equals the set of tablespaces with undo segments at the present time. If this assumption is not correct, then TSPITR fails with an error. In this case, use the <code class="codeph">UNDO</code> <code class="codeph">TABLESPACE</code> clause to provide a list of tablespaces with undo segments at the target time.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89828"></a>
<div class="props_rev_3"><a id="GUID-DAF577E1-0177-4EBC-ABF8-3D821BD21BB0"></a>
<h3 id="BRADV-GUID-DAF577E1-0177-4EBC-ABF8-3D821BD21BB0" class="sect3">Troubleshooting the Restart of a Manual Auxiliary Database After TSPITR Failure</h3>
<div>
<div class="section">
<p>If you are managing your own auxiliary database and TSPITR fails, do not attempt to rerun TSPITR without resolving the errors and following this approach:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Identify and fix the problems that prevented TSPITR from a successful run.</span></li>
<li><span>Start the auxiliary database in <code class="codeph">NOMOUNT</code>.</span></li>
<li><span>Run TSPITR again.</span></li>
</ol>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="rcmadvre.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="rcmresind.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>