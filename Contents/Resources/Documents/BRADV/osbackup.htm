<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2648"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Making%20User-Managed%20Database%20Backups"></a><title>Making User-Managed Database Backups</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="CDBs, user-managed backups, PDBs, of CDBs, of PDBs, tablespaces, backups, tablespace, online, user-managed backups, in CDBs, user-managed backups, in PDBs, tablespaces in CDBs, tablespaces in PDBs, using storage snapshots, storage snapshots, snapshots, backing up using third-party technologies, Storage Snapshot Optimization, using Storage Snapshot Optimization"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="part_umb.htm" title="Previous" type="text/html"/>
<link rel="Next" href="osrecvry.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-2193FAD0-F62C-4671-9272-55E8BD7367DC"></a> <span id="PAGE" style="display:none;">44/48</span> <!-- End Header -->
<a id="BRADV016"></a>
<h1 id="BRADV-GUID-2193FAD0-F62C-4671-9272-55E8BD7367DC" class="sect1"><span class="enumeration_chapter">29</span> Making User-Managed Database Backups</h1>
<div>
<p><a id="d117138e67" class="indexterm-anchor"></a><a id="d117138e71" class="indexterm-anchor"></a>This chapter describes methods of backing up an Oracle database in a user-managed backup and recovery strategy, that is, a strategy that does not depend on using Recovery Manager (RMAN).</p>
<p>This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-B1342AE5-9632-459C-BC21-F0EEED53FC92">Querying V$ Views to Obtain Backup Information</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8">Making User-Managed Backups of the Whole Database</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5">Making User-Managed Backups of CDBs and PDBs</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-D1582062-FF0C-462B-8468-4052914FA7B3">Making User-Managed Backups of Tablespaces and Data Files</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-B4948C50-74CA-40DE-9CD8-11455F14B6AD">Making User-Managed Backups of Tablespaces in CDBs</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628">Making User-Managed Backups of the Control File</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88">Making User-Managed Backups of Archived Redo Logs</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47">Making User-Managed Backups in SUSPEND Mode</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-3E0AAB48-7D0B-4012-BB41-E33DD11189C0">Making User-Managed Backups to Raw Devices</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA">Making Backups with Third-Party Snapshot Technologies</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-F47FE2CE-EEE0-42E5-AE8E-0A9D5D1BB42C">Verifying User-Managed Data File Backups</a></p>
</li>
</ul>
</div>
<a id="BRADV198"></a>
<div class="props_rev_3"><a id="GUID-B1342AE5-9632-459C-BC21-F0EEED53FC92"></a>
<h2 id="BRADV-GUID-B1342AE5-9632-459C-BC21-F0EEED53FC92" class="sect2">Querying V$ Views to Obtain Backup Information</h2>
<div>
<p><a id="d117138e201" class="indexterm-anchor"></a><a id="d117138e205" class="indexterm-anchor"></a><a id="d117138e209" class="indexterm-anchor"></a><a id="d117138e213" class="indexterm-anchor"></a><a id="d117138e217" class="indexterm-anchor"></a><a id="d117138e219" class="indexterm-anchor"></a>Before making a backup, you must identify all the files in your database and decide what to back up. You can use V$ views to obtain this information.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0">Listing Database Files Before a Backup</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-C76503E4-81E4-418E-BAEF-E3B3ECF1CCD9">Determining Data File Status for Online Tablespace Backups</a></p>
</li>
</ul>
</div>
<a id="BRADV485"></a><a id="BRADV89998"></a>
<div class="props_rev_3"><a id="GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0"></a>
<h3 id="BRADV-GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0" class="sect3">Listing Database Files Before a Backup</h3>
<div>
<div class="section">
<p>Use the <code class="codeph">V$DATAFILE</code> and <code class="codeph">V$CONTROLFILE</code> views to identify the data files and control files for your database. This same procedure works whether you named these files manually or allowed Oracle Managed Files to name them.</p>
<div class="infobox-note" id="GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0__GUID-1FFD10B6-BB40-4AAC-AE8D-16E3A659320B">
<p class="notep1">Caution:</p>
<p>Never back up online redo log files.</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To list data files and control files:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and query <code class="codeph">V$DATAFILE</code> to obtain a list of data files. For example, enter:</span>
<div>
<pre dir="ltr">SELECT NAME FROM V$DATAFILE;
</pre>
<p>You can also join the <a id="d117138e333" class="indexterm-anchor"></a><a id="d117138e335" class="indexterm-anchor"></a><code class="codeph">V$TABLESPACE</code> and <code class="codeph">V$DATAFILE</code> views to obtain a listing of data files along with their associated tablespaces:</p>
<pre dir="ltr">SELECT   t.NAME &#34;Tablespace&#34;, f.NAME &#34;Data File&#34;
FROM     V$TABLESPACE t, V$DATAFILE f
WHERE    t.TS# = f.TS#
ORDER BY t.NAME;
</pre></div>
</li>
<li class="stepexpand"><span><a id="d117138e347" class="indexterm-anchor"></a>Obtain the file names of the current control files by querying the <code class="codeph">V$CONTROLFILE</code> view. For example, issue the following query:</span>
<div>
<pre dir="ltr">SELECT NAME FROM V$CONTROLFILE;
</pre>
<p>You only need to back up one copy of a <a id="d117138e360" class="indexterm-anchor"></a><a id="d117138e364" class="indexterm-anchor"></a>multiplexed control file.</p>
</div>
</li>
<li class="stepexpand"><span><a id="d117138e369" class="indexterm-anchor"></a><a id="d117138e373" class="indexterm-anchor"></a><a id="d117138e377" class="indexterm-anchor"></a>If you plan to perform control file backup with the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">&#39;</code><span class="italic"><code class="codeph">filename</code></span><code class="codeph">&#39;</code> statement, then save a list of all data files and online redo log files with the control file backup. Because the current database structure may not match the database structure at the time a given control file backup was created, saving a list of files recorded in the backup control file can aid the recovery procedure.</span></li>
</ol>
</div>
</div>
<a id="BRADV89999"></a>
<div class="props_rev_3"><a id="GUID-C76503E4-81E4-418E-BAEF-E3B3ECF1CCD9"></a>
<h3 id="BRADV-GUID-C76503E4-81E4-418E-BAEF-E3B3ECF1CCD9" class="sect3">Determining Data File Status for Online Tablespace Backups</h3>
<div>
<div class="section">
<p><a id="d117138e476" class="indexterm-anchor"></a><a id="d117138e480" class="indexterm-anchor"></a><a id="d117138e484" class="indexterm-anchor"></a>To check whether a data file is part of a current online tablespace backup, query the <a id="d117138e489" class="indexterm-anchor"></a><code class="codeph">V$BACKUP</code> view.</p>
<p>This view is useful only for user-managed online tablespace backups, because neither RMAN backups nor offline tablespace backups require the data files of a tablespace to be in <a href="glossary.htm#GUID-BD2A12D3-A995-49B8-AE99-B8DDDF4FE7E7"><span class="xrefglossterm">backup mode</span></a>. Some user-managed backup procedures require you to place the tablespace in backup mode to protect against the possibility of a fractured block. However, updates to the database create more than the usual amount of redo in backup mode.</p>
<p>The <code class="codeph">V$BACKUP</code> view is most useful when the database is open. It is also useful immediately after an instance failure because it shows the backup status of the files at the time of the failure. Use this information to determine whether you have left any tablespaces in backup mode.</p>
<p><code class="codeph">V$BACKUP</code> is not useful if the control file currently in use is a restored backup or a new control file created after the media failure occurred. A restored or re-created control file does not contain the information that the database needs to populate <code class="codeph">V$BACKUP</code> accurately. Also, if you have restored a backup of a file, this file&#39;s <code class="codeph">STATUS</code> in <code class="codeph">V$BACKUP</code> reflects the backup status of the older version of the file, not the most current version. Thus, this view can contain misleading data about restored files.</p>
<p>For example, the following query displays which data files are currently included in a tablespace that has been placed in backup mode:</p>
<pre dir="ltr">SELECT t.name AS &#34;TB_NAME&#34;, d.file# as &#34;DF#&#34;, d.name AS &#34;DF_NAME&#34;, b.status
FROM   V$DATAFILE d, V$TABLESPACE t, V$BACKUP b
WHERE  d.TS#=t.TS#
AND    b.FILE#=d.FILE#
AND    b.STATUS=&#39;ACTIVE&#39;;
</pre>
<p>The following sample output shows that the <code class="codeph">tools</code> and <code class="codeph">users</code> tablespaces currently have <code class="codeph">ACTIVE</code> status:</p>
<pre dir="ltr">TB_NAME                 DF#        DF_NAME                           STATUS
----------------------  ---------- --------------------------------  ------
TOOLS                   7          /oracle/oradata/trgt/tools01.dbf  ACTIVE
USERS                   8          /oracle/oradata/trgt/users01.dbf  ACTIVE
</pre>
<p>In the <code class="codeph">STATUS</code> column, <code class="codeph">NOT</code> <code class="codeph">ACTIVE</code> indicates that the file is not currently in backup mode (that is, you have not executed the <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code> or <code class="codeph">ALTER DATABASE BEGIN BACKUP</code> statement), whereas <code class="codeph">ACTIVE</code> indicates that the file is currently in backup mode.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV618"></a><a id="BRADV486"></a><a id="BRADV199"></a>
<div class="props_rev_3"><a id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8"></a>
<h2 id="BRADV-GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8" class="sect2">Making User-Managed Backups of the Whole Database</h2>
<div>
<div class="section">
<p>You can make a consistent whole database backup of all files in a database after the database has been shut down with the <code class="codeph">NORMAL</code>, <code class="codeph">IMMEDIATE</code>, or <code class="codeph">TRANSACTIONAL</code> options. <a id="d117138e650" class="indexterm-anchor"></a><a id="d117138e652" class="indexterm-anchor"></a><a id="d117138e656" class="indexterm-anchor"></a><a id="d117138e660" class="indexterm-anchor"></a>A whole database backup taken while the database is open or after an instance failure or <code class="codeph">SHUTDOWN</code> <code class="codeph">ABORT</code> command is inconsistent. In such cases, the files are inconsistent with the <a href="glossary.htm#GUID-60BB5B47-F889-4E54-9368-6AFF572B71B5"><span class="xrefglossterm">database checkpoint</span></a> SCN.</p>
<p>You<a id="d117138e678" class="indexterm-anchor"></a><a id="d117138e682" class="indexterm-anchor"></a> can make a whole database backup if a database is operating in either <code class="codeph">ARCHIVELOG</code> or <code class="codeph">NOARCHIVELOG</code> mode. If you run the database in <code class="codeph">NOARCHIVELOG</code> mode, however, then the backup must be consistent; that is, you must shut down the database cleanly before the backup.</p>
<p><a id="d117138e697" class="indexterm-anchor"></a><a id="d117138e701" class="indexterm-anchor"></a>The set of backup files that results from a consistent whole database backup is consistent because all files are checkpointed to the same SCN. You can restore the consistent database backup without further recovery. After restoring the backup files, you can perform additional recovery steps to recover the database to a more current time if the database is operated in <code class="codeph">ARCHIVELOG</code> mode. Also, you can take inconsistent whole database backups if your database is in <code class="codeph">ARCHIVELOG</code> mode.</p>
<p>Control files play a crucial role in database restore and recovery. For databases running in <code class="codeph">ARCHIVELOG</code> mode, Oracle recommends that you back up control files with the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">&#39;</code><span class="italic"><code class="codeph">filename</code></span><code class="codeph">&#39;</code> statement.</p>
<div class="infoboxnotealso" id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8__GUID-B7123461-A215-410C-ABC0-1093EE6E6845">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="osbackup.htm#GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628">Making User-Managed Backups of the Control File</a>&#34;</span> for more information about backing up control files</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2"><span>Making Consistent Whole Database Backups</span></p>
</div>
<!-- class="section" -->
<div class="section">
<p><a id="d117138e754" class="indexterm-anchor"></a><a id="d117138e758" class="indexterm-anchor"></a><a id="d117138e762" class="indexterm-anchor"></a><a id="d117138e766" class="indexterm-anchor"></a>This section describes how to back up the database with an operating system utility.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2"><span>To make a consistent whole database backup:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>If the database is open, then use SQL*Plus to shut down the database with the <code class="codeph">NORMAL</code>, <code class="codeph">IMMEDIATE</code>, or <code class="codeph">TRANSACTIONAL</code> options.</span></li>
<li class="stepexpand"><span>Use an operating system utility to make backups of all data files and all control files specified by the <code class="codeph">CONTROL_FILES</code> parameter of the initialization parameter file. Also, back up the initialization parameter file and other Oracle product initialization files. To find these files, do a search for <code class="codeph">*.ora</code> starting in your Oracle home directory and recursively search all of its subdirectories.</span>
<div>
<p>For example, you can back up the data files, control files, and archived logs to <code class="codeph">/disk2/backup</code> as follows:</p>
<pre dir="ltr">% cp $ORACLE_HOME/oradata/trgt/*.dbf /disk2/backup
% cp $ORACLE_HOME/oradata/trgt/arch/* /disk2/backup/arch
 
</pre></div>
</li>
<li class="stepexpand"><span>Restart the database with the <code class="codeph">STARTUP</code> command in SQL*Plus.</span>
<div>
<div class="infoboxnotealso" id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8__GUID-EEA8C77E-FEF8-4E07-99E6-DE8616A2D4E3">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN004" target="_blank" href="../ADMIN/start.htm#ADMIN004"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for more information about starting up and shutting down a database</p>
</div>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV652"></a><a id="BRADV653"></a><a id="BRADV651"></a>
<div class="props_rev_3"><a id="GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5"></a>
<h2 id="BRADV-GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5" class="sect2">Making User-Managed Backups of CDBs and PDBs</h2>
<div>
<div class="section">
<p>The information in this chapter applies to multitenant container databases (<a href="glossary.htm#GUID-3D253996-C2C0-449A-AFA2-85A9DA323FD3"><span class="xrefglossterm">CDB</span></a>s) and pluggable databases (<a href="glossary.htm#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>s) with only slight changes, as described in the following section.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To back up a whole CDB:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Open SQL*Plus.</p>
</li>
<li>
<p>Connect to the <a href="glossary.htm#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a> as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> system privilege as described in <span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span>.</p>
</li>
<li>
<p>Follow the instructions in <span class="q">&#34;<a href="osbackup.htm#GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8">Making User-Managed Backups of the Whole Database</a>&#34;</span>.</p>
<div class="infoboxnotealso" id="GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5__GUID-4321F8DA-D8FB-4037-A3E1-8961407E3129">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF00802" target="_blank" href="../SQLRF/statements_1006.htm#SQLRF00802"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about using ALTER DATABASE for CDBs</p>
</div>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To back up a PDB:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Open SQL*Plus.</span></li>
<li class="stepexpand"><span>Connect to the PDB as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> system privilege as described in <span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span>.</span></li>
<li class="stepexpand"><span>Begin the backup with the SQL <code class="codeph">ALTER DATABASE</code> command.</span>
<div>
<pre dir="ltr">ALTER DATABASE BEGIN BACKUP;
</pre></div>
</li>
<li class="stepexpand"><span>Use an operating system utility to copy the data files belonging to the PDB to a backup device.</span></li>
<li class="stepexpand"><span>End the backup with the SQL <code class="codeph">ALTER DATABASE</code> command.</span>
<div>
<pre dir="ltr">ALTER DATABASE END BACKUP;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV90001"></a>
<div class="props_rev_3"><a id="GUID-D1582062-FF0C-462B-8468-4052914FA7B3"></a>
<h2 id="BRADV-GUID-D1582062-FF0C-462B-8468-4052914FA7B3" class="sect2">Making User-Managed Backups of Tablespaces and Data Files</h2>
<div>
<p>The technique for making user-managed backups of tablespaces and data files depends on whether the files are offline or online.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8">Making User-Managed Backups of Offline Tablespaces and Data Files</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-57387AB6-1204-44F0-826A-F9B638453935">Making User-Managed Backups of Online Tablespaces and Data Files</a></p>
</li>
</ul>
</div>
<a id="BRADV487"></a><a id="BRADV20033"></a>
<div class="props_rev_3"><a id="GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8"></a>
<h3 id="BRADV-GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8" class="sect3">Making User-Managed Backups of Offline Tablespaces and Data Files</h3>
<div>
<div class="section">
<p><a id="d117138e1156" class="indexterm-anchor"></a><a id="d117138e1160" class="indexterm-anchor"></a><a id="d117138e1166" class="indexterm-anchor"></a><a id="d117138e1170" class="indexterm-anchor"></a><a id="d117138e1174" class="indexterm-anchor"></a><a id="d117138e1178" class="indexterm-anchor"></a><a id="d117138e1182" class="indexterm-anchor"></a>Note the following guidelines when backing up offline tablespaces:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>You cannot take offline the <code class="codeph">SYSTEM</code> tablespace or a tablespace with active undo segments. The following technique cannot be used for such tablespaces.</p>
</li>
<li>
<p>Assume that a table is in tablespace <code class="codeph">Primary</code> and its index is in tablespace <code class="codeph">Index</code>. Taking tablespace <code class="codeph">Index</code> offline while leaving tablespace <code class="codeph">Primary</code> online can cause errors when data manipulation language (DML) is issued against the indexed tables located in <code class="codeph">Primary</code>. The problem appears only when the access method chosen by the optimizer must access the indexes in the <code class="codeph">Index</code> tablespace.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><span>To back up offline tablespaces:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d117138e1224" class="indexterm-anchor"></a><a id="d117138e1226" class="indexterm-anchor"></a>Before beginning a backup of a tablespace, identify the tablespace&#39;s data files by querying the <code class="codeph">DBA_DATA_FILES</code> view. For example, assume that you want to back up the <code class="codeph">users</code> tablespace. Enter the following statement in SQL*Plus:</span>
<div>
<pre dir="ltr">SELECT TABLESPACE_NAME, FILE_NAME
  FROM SYS.DBA_DATA_FILES
  WHERE TABLESPACE_NAME = &#39;USERS&#39;;
 
TABLESPACE_NAME                   FILE_NAME
-------------------------------   --------------------------------
USERS                             /oracle/oradata/trgt/users01.dbf
</pre>
<p>In this example, <code class="codeph">/oracle/oradata/trgt/users01.dbf</code> is a fully specified file name corresponding to the data file in the <code class="codeph">users</code> tablespace.</p>
</div>
</li>
<li class="stepexpand"><span>Take the tablespace offline using normal priority if possible, because it guarantees that you can subsequently bring the tablespace online without having to recover it. For example:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER TABLESPACE users OFFLINE NORMAL;
</pre></div>
</li>
<li class="stepexpand"><span>Back up the offline data files. For example:</span>
<div>
<pre dir="ltr">% cp /oracle/oradata/trgt/users01.dbf /d2/users01_&#39;date &#34;+%m_%d_%y&#34;&#39;.dbf
</pre></div>
</li>
<li class="stepexpand"><span>Bring the tablespace online. For example:</span>
<div>
<pre dir="ltr">ALTER TABLESPACE users ONLINE;
</pre>
<div class="infobox-note" id="GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8__GUID-E3F2EDC0-CA83-4AF6-B7FD-0E3C88FCAC53">
<p class="notep1">Note:</p>
<p>If you took the tablespace offline using temporary or immediate priority, then you cannot bring the tablespace online unless you perform tablespace recovery.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Archive the unarchived redo logs so that the redo required to recover the tablespace backup is archived. For example, enter:</span>
<div>
<pre dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV201"></a>
<div class="props_rev_3"><a id="GUID-57387AB6-1204-44F0-826A-F9B638453935"></a>
<h3 id="BRADV-GUID-57387AB6-1204-44F0-826A-F9B638453935" class="sect3">Making User-Managed Backups of Online Tablespaces and Data Files</h3>
<div>
<p>You can back up all or only specific data files of an online tablespace while the database is open. The procedure differs depending on whether the online tablespace is read/write or read-only.</p>
<div class="infobox-note" id="GUID-57387AB6-1204-44F0-826A-F9B638453935__GUID-0AD81931-AC0B-41CB-86D0-6B2AB29F73AD">
<p class="notep1">Note:</p>
<p>Do not back up temporary tablespaces.</p>
</div>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8">Making User-Managed Backups of Online Read/Write Tablespaces</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-EDE86BA1-4CF1-454D-8E07-D601BAE1F98E">Making Multiple User-Managed Backups of Online Read/Write Tablespaces</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-8774B936-E0C4-4F1E-9146-2C2E2A20664C">Ending a Backup After an Instance Failure or SHUTDOWN ABORT</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-BB096DF9-D46E-4E17-8C76-E7568100611A">Making User-Managed Backups of Read-Only Tablespaces</a></p>
</li>
</ul>
</div>
<a id="BRADV488"></a><a id="BRADV90002"></a>
<div class="props_rev_3"><a id="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8"></a>
<h4 id="BRADV-GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8" class="sect4">Making User-Managed Backups of Online Read/Write Tablespaces</h4>
<div>
<div class="section">
<p>You must put a read/write tablespace in backup mode to make user-managed data file backups when the tablespace is online and the database is open. <a id="d117138e1441" class="indexterm-anchor"></a><a id="d117138e1445" class="indexterm-anchor"></a>The <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code> statement places a tablespace in backup mode. In backup mode, the database copies whole changed data blocks into the redo stream. After you take the tablespace out of backup mode with the <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> or <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement, the database advances the <a href="glossary.htm#GUID-22212AAE-6F3C-4E84-B940-5AB2261A7EDA"><span class="xrefglossterm">data file checkpoint</span></a> SCN to the current <a href="glossary.htm#GUID-60BB5B47-F889-4E54-9368-6AFF572B71B5"><span class="xrefglossterm">database checkpoint</span></a> SCN.</p>
<p>When restoring a data file backed up in this way, the database asks for the appropriate set of redo log files to apply if recovery is needed. The redo logs contain all changes required to recover the data files and make them consistent.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><span>To back up online read/write tablespaces in an open database:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d117138e1511" class="indexterm-anchor"></a><a id="d117138e1517" class="indexterm-anchor"></a><a id="d117138e1519" class="indexterm-anchor"></a>Before beginning a backup of a tablespace, use the <code class="codeph">DBA_DATA_FILES</code> data dictionary view to identify all of the data files in the tablespace. For example, assume that you want to back up the <code class="codeph">users</code> tablespace. Enter the following:</span>
<div>
<pre dir="ltr">SELECT TABLESPACE_NAME, FILE_NAME
FROM   SYS.DBA_DATA_FILES
WHERE  TABLESPACE_NAME = &#39;USERS&#39;;
 
TABLESPACE_NAME                   FILE_NAME
-------------------------------   --------------------
USERS                             /oracle/oradata/trgt/users01.dbf
USERS                             /oracle/oradata/trgt/users02.dbf
</pre></div>
</li>
<li class="stepexpand"><span>Mark the beginning of the online tablespace backup. For example, the following statement marks the start of an online backup for the tablespace <code class="codeph">users</code>:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
</pre>
<div class="infobox-note" id="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8__GUID-FA726CAF-8CC2-4BEB-8205-E5AD8ED76091">
<p class="notep1">Caution:</p>
<p><a id="d117138e1542" class="indexterm-anchor"></a><a id="d117138e1546" class="indexterm-anchor"></a>If you do not use <code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code> to mark the beginning of an online tablespace backup and wait for this statement to complete before starting your copies of online tablespaces, then the data file copies produced are not usable for subsequent recovery operations. Attempting to recover such a backup is risky and can return errors that result in inconsistent data. For example, the attempted recovery operation can issue a <a href="glossary.htm#GUID-B0F459C6-F2F5-48AD-97D3-B84C875FF723"><span class="xrefglossterm">fuzzy file</span></a> warning, and can lead to an inconsistent database that you cannot open.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Back up the online data files of the online tablespace with operating system commands. For example, Linux and UNIX users might enter:</span>
<div>
<pre dir="ltr">% cp /oracle/oradata/trgt/users01.dbf /d2/users01_&#39;date &#34;+%m_%d_%y&#34;&#39;.dbf
% cp /oracle/oradata/trgt/users02.dbf /d2/users02_&#39;date &#34;+%m_%d_%y&#34;&#39;.dbf
</pre></div>
</li>
<li class="stepexpand"><span>After backing up the data files of the online tablespace, run the SQL statement <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> with the <code class="codeph">END</code> <code class="codeph">BACKUP</code> option. For example, the following statement ends the online backup of the tablespace <code class="codeph">users</code>:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER TABLESPACE users END BACKUP;
</pre></div>
</li>
<li class="stepexpand"><span>Archive the unarchived redo logs so that the redo required to recover the tablespace backup is archived. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre>
<div class="infobox-note" id="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8__GUID-3B076AF3-56C5-415B-A11B-67339E359ECC">
<p class="notep1">Caution:</p>
<p><a id="d117138e1596" class="indexterm-anchor"></a>If you fail to take the tablespace out of backup mode, then Oracle Database continues to write copies of data blocks in this tablespace to the online redo logs, causing performance problems. Also, you receive an <code class="codeph">ORA-01149</code> error if you try to shut down the database with the tablespaces still in backup mode.</p>
</div>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV90003"></a>
<div class="props_rev_3"><a id="GUID-EDE86BA1-4CF1-454D-8E07-D601BAE1F98E"></a>
<h4 id="BRADV-GUID-EDE86BA1-4CF1-454D-8E07-D601BAE1F98E" class="sect4">Making Multiple User-Managed Backups of Online Read/Write Tablespaces</h4>
<div>
<p>When backing up several online tablespaces, you can back them up either serially or in parallel. Use either of the following procedures depending on your needs:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-9E89C219-D109-4435-BDE3-402C345F84C2">Backing Up Online Tablespaces in Parallel</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D">Backing Up Online Tablespaces Serially</a></p>
</li>
</ul>
</div>
<a id="BRADV489"></a><a id="BRADV90004"></a>
<div class="props_rev_3"><a id="GUID-9E89C219-D109-4435-BDE3-402C345F84C2"></a>
<h5 id="BRADV-GUID-9E89C219-D109-4435-BDE3-402C345F84C2" class="sect5">Backing Up Online Tablespaces in Parallel</h5>
<div>
<div class="section">
<p>You can simultaneously create data file copies of multiple tablespaces requiring backups in backup mode. Note, however, that by putting all tablespaces in online mode together, you can generate large redo logs if there is heavy update activity on the affected tablespaces, because the redo must contain a copy of each changed data block in each changed data file. Be sure to consider the size of the likely redo before using the procedure outlined here.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up online tablespaces in parallel:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Prepare the online tablespaces for backup by issuing all necessary <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> statements together. For example, put tablespaces <code class="codeph">users</code>, <code class="codeph">tools</code>, and <code class="codeph">indx</code> in backup mode as follows:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
SQL&gt; ALTER TABLESPACE tools BEGIN BACKUP;
SQL&gt; ALTER TABLESPACE indx BEGIN BACKUP;
</pre>
<p>If you are backing up all tablespaces, you can use this command:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE BEGIN BACKUP;
</pre></div>
</li>
<li class="stepexpand"><span>Back up all files of the online tablespaces. For example, a Linux or UNIX user might back up data files with the <code class="codeph">*.dbf</code> suffix as follows:</span>
<div>
<pre dir="ltr">% cp $ORACLE_HOME/oradata/trgt/*.dbf /disk2/backup/
</pre></div>
</li>
<li class="stepexpand"><span>Take the tablespaces out of backup mode as in the following example:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER TABLESPACE users END BACKUP;
SQL&gt; ALTER TABLESPACE tools END BACKUP;
SQL&gt; ALTER TABLESPACE indx END BACKUP;
</pre>
<p>Again, if you are handling all data files together, you can use the <code class="codeph">ALTER DATABASE</code> command instead of <code class="codeph">ALTER TABLESPACE</code>:</p>
<pre dir="ltr">SQL&gt; ALTER DATABASE END BACKUP;
</pre></div>
</li>
<li class="stepexpand"><span>Archive the online redo logs so that the redo required to recover the tablespace backups is available for later media recovery. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV490"></a><a id="BRADV90005"></a>
<div class="props_rev_3"><a id="GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D"></a>
<h5 id="BRADV-GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D" class="sect5">Backing Up Online Tablespaces Serially</h5>
<div>
<div class="section">
<p>You can place all tablespaces requiring online backups in backup mode one at a time. <a id="d117138e1909" class="indexterm-anchor"></a><a id="d117138e1913" class="indexterm-anchor"></a>Oracle recommends the serial backup option because it minimizes the time between <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">BEGIN/END</code> <code class="codeph">BACKUP</code> statements. During online backups, more redo information is generated for the tablespace because whole data blocks are copied into the redo log.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up online tablespaces serially:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Prepare a tablespace for online backup. For example, to put tablespace <code class="codeph">users</code> in backup mode enter the following:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
</pre>
<p>In this case you probably do not want to use <code class="codeph">ALTER DATABASE BEGIN BACKUP</code> to put all tablespaces in backup mode simultaneously, because of the unnecessary volume of redo log information generated for tablespaces in online mode.</p>
</div>
</li>
<li class="stepexpand"><span>Back up the data files in the tablespace. For example, enter:</span>
<div>
<pre dir="ltr">% cp /oracle/oradata/trgt/users01.dbf /d2/users01_&#39;date &#34;+%m_%d_%y&#34;&#39;.dbf
</pre></div>
</li>
<li class="stepexpand"><span>Take the tablespace out of backup mode. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER TABLESPACE users END BACKUP;
</pre></div>
</li>
<li class="stepexpand"><span>Repeat this procedure for each remaining tablespace.</span></li>
<li class="stepexpand"><span>Archive the unarchived redo logs so that the redo required to recover the tablespace backups is archived. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV90006"></a>
<div class="props_rev_3"><a id="GUID-8774B936-E0C4-4F1E-9146-2C2E2A20664C"></a>
<h4 id="BRADV-GUID-8774B936-E0C4-4F1E-9146-2C2E2A20664C" class="sect4">Ending a Backup After an Instance Failure or SHUTDOWN ABORT</h4>
<div>
<div class="section">
<p><a id="d117138e2044" class="indexterm-anchor"></a><a id="d117138e2048" class="indexterm-anchor"></a><a id="d117138e2052" class="indexterm-anchor"></a><a id="d117138e2056" class="indexterm-anchor"></a>The following situations can cause a tablespace backup to fail and be incomplete:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>The backup completed, but you did not run the <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement.</p>
</li>
<li>
<p>An instance failure or <code class="codeph">SHUTDOWN</code> <code class="codeph">ABORT</code> interrupted the backup.</p>
</li>
</ul>
<p>Whenever recovery from a failure is required, if a data file is in backup mode when an attempt is made to open it, then the database does not open the data file until either a recovery command is issued, or the data file is taken out of backup mode.</p>
<p>For example, the database may display a message such as the following at startup:</p>
<pre dir="ltr">ORA-01113: file 12 needs media recovery
ORA-01110: data file 12: &#39;/oracle/dbs/tbs_41.f&#39;
</pre>
<p>If the database indicates that the data files for multiple tablespaces require media recovery because you forgot to end the online backups for these tablespaces, then so long as the database is mounted, running the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement takes all the data files out of backup mode simultaneously.</p>
<p>In high availability situations, and in situations when no database administrator (DBA) is monitoring the database, the requirement for user intervention is intolerable. Hence, you can write a failure recovery script that does the following:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Mounts the database</span></li>
<li><span>Runs the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement</span></li>
<li><span>Runs <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">OPEN</code>, enabling the system to start automatically</span></li>
</ol>
<div class="section">
<p>An automated crash recovery script containing <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> is especially useful in the following situations:</p>
<ul style="list-style-type: disc;">
<li>
<p>All nodes in an Oracle Real Application Clusters (Oracle RAC) configuration fail.</p>
</li>
<li>
<p>One node fails in a <a id="d117138e2165" class="indexterm-anchor"></a><strong class="term">cold failover cluster</strong> (that is, a cluster that is <span class="italic">not</span> an Oracle RAC configuration in which the secondary node must mount and recover the database when the first node fails).</p>
</li>
</ul>
<p>Alternatively, you can take the following manual measures after the system fails with tablespaces in backup mode:</p>
<ul style="list-style-type: disc;">
<li>
<p>Recover the database and avoid issuing <code class="codeph">END</code> <code class="codeph">BACKUP</code> statements altogether.</p>
</li>
<li>
<p>Mount the database, then run the <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement for each tablespace still in backup mode.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="BRADV491"></a><a id="BRADV90007"></a>
<div class="props_rev_3"><a id="GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888"></a>
<h5 id="BRADV-GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888" class="sect5">Ending Backup Mode with the ALTER DATABASE END BACKUP Statement</h5>
<div>
<div class="section">
<p><a id="d117138e2276" class="indexterm-anchor"></a><a id="d117138e2280" class="indexterm-anchor"></a><a id="d117138e2284" class="indexterm-anchor"></a><a id="d117138e2288" class="indexterm-anchor"></a>You can run the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement when you have multiple tablespaces still in backup mode. The primary purpose of this command is to allow a crash recovery script to restart a failed system without DBA intervention. You can also perform the following procedure manually.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To take tablespaces out of backup mode simultaneously:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Mount but do not open the database. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP MOUNT
</pre></div>
</li>
<li class="stepexpand"><span>If you are performing this procedure manually (that is, not as part of a failure recovery script), query the <code class="codeph">V$BACKUP</code> view to list the data files of the tablespaces that were being backed up before the database was restarted:</span>
<div>
<pre dir="ltr">SQL&gt;  SELECT * FROM V$BACKUP WHERE STATUS = &#39;ACTIVE&#39;;
FILE#      STATUS             CHANGE#    TIME       CON_ID
---------- ------------------ ---------- ---------  -------
        12 ACTIVE                  20863 25-NOV-02        0
        13 ACTIVE                  20863 25-NOV-02        0
        20 ACTIVE                  20863 25-NOV-02        0
 3 rows selected.
</pre></div>
</li>
<li class="stepexpand"><span>Issue the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement to take all data files currently in backup mode out of backup mode. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; ALTER DATABASE END BACKUP;
</pre>
<p>You can use this statement only when the database is mounted but not open. If the database is open, then use <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> or <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">DATAFILE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> for each affected tablespace or data file.</p>
<div class="infobox-note" id="GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888__GUID-061EE957-EEC0-40B8-B7F5-65D6C0C56D15">
<p class="notep1">Caution:</p>
<p>Do not use <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> if you have restored any of the affected files from a backup.</p>
</div>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV492"></a><a id="BRADV90008"></a>
<div class="props_rev_3"><a id="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA"></a>
<h5 id="BRADV-GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA" class="sect5">Ending Backup Mode with the SQL*Plus RECOVER Command</h5>
<div>
<div class="section">
<p>The <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement is not the only way to respond to a failed online backup; you can also run the SQL*Plus <code class="codeph">RECOVER</code> command. This method is useful when you are not sure whether someone has restored a backup, because if someone has indeed restored a backup, then the <code class="codeph">RECOVER</code> command brings the backup up-to-date. Only run the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> or <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> statement if you are sure that the files are current.</p>
<div class="infobox-note" id="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA__GUID-2C8AD5E2-8958-4CC3-B6E2-0F72B9ECD5EE">
<p class="notep1">Note:</p>
<p>The <code class="codeph">RECOVER</code> command method is slow because the database must scan redo generated from the beginning of the online backup.</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To take tablespaces out of backup mode with the RECOVER command:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Mount the database. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; STARTUP MOUNT
</pre></div>
</li>
<li class="stepexpand"><span>Recover the database as usual. For example, enter:</span>
<div>
<pre dir="ltr">SQL&gt; RECOVER DATABASE
</pre></div>
</li>
<li class="stepexpand"><span>Use the <code class="codeph">V$BACKUP</code> view to confirm that there are no active data files:</span>
<div>
<pre dir="ltr">SQL&gt;  SELECT * FROM V$BACKUP WHERE STATUS = &#39;ACTIVE&#39;;

no rows selected.
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA__GUID-268E9F58-E2BD-4F28-BCA7-559EFA3D285E">
<p class="notep1">See Also:</p>
<p><a href="osrecvry.htm#GUID-704F6AB0-04C4-4345-913B-B316DD06D05E">Performing User-Managed Database Flashback and Recovery</a> for information about recovering a database</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV493"></a><a id="BRADV90009"></a>
<div class="props_rev_3"><a id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A"></a>
<h4 id="BRADV-GUID-BB096DF9-D46E-4E17-8C76-E7568100611A" class="sect4">Making User-Managed Backups of Read-Only Tablespaces</h4>
<div>
<div class="section">
<p><a id="d117138e2622" class="indexterm-anchor"></a><a id="d117138e2626" class="indexterm-anchor"></a><a id="d117138e2630" class="indexterm-anchor"></a>When backing up an online read-only tablespace, you can simply back up the online data files. You do not have to place the tablespace in backup mode because the database is not permitting changes to the data files.</p>
<p>If the set of read-only tablespaces is self-contained, then in addition to backing up the tablespaces with operating system commands, you can also export the tablespace metadata with the transportable tablespace functionality. If a media error or a user error occurs (such as accidentally dropping a table in the read-only tablespace), you can transport the tablespace back into the database.</p>
<div class="infoboxnotealso" id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A__GUID-E0E40A8D-CC58-442A-9A2D-FAF05E3EF0AF">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN11394" target="_blank" href="../ADMIN/transport.htm#ADMIN11394"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> to learn how to transport tablespaces</p>
</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up online read-only tablespaces in an open database:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d117138e2650" class="indexterm-anchor"></a><a id="d117138e2656" class="indexterm-anchor"></a><a id="d117138e2658" class="indexterm-anchor"></a>Query the <code class="codeph">DBA_TABLESPACES</code> view to determine which tablespaces are read-only. For example, run this query:</span>
<div>
<pre dir="ltr">SELECT TABLESPACE_NAME, STATUS 
FROM DBA_TABLESPACES
WHERE STATUS = &#39;READ ONLY&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>Before beginning a backup of a read-only tablespace, identify all of the tablespace&#39;s data files by querying the <code class="codeph">DBA_DATA_FILES</code> data dictionary view. For example, assume that you want to back up the <code class="codeph">history</code> tablespace:</span>
<div>
<pre dir="ltr">SELECT TABLESPACE_NAME, FILE_NAME
FROM SYS.DBA_DATA_FILES
WHERE TABLESPACE_NAME = &#39;HISTORY&#39;;
 
TABLESPACE_NAME                   FILE_NAME
-------------------------------   --------------------
HISTORY                           /oracle/oradata/trgt/history01.dbf
HISTORY                           /oracle/oradata/trgt/history02.dbf
</pre></div>
</li>
<li class="stepexpand"><span>Back up the online data files of the read-only tablespace with operating system commands. You do not have to take the tablespace offline or put the tablespace in backup mode because users are automatically prevented from making changes to the read-only tablespace. For example:</span>
<div>
<pre dir="ltr">% cp $ORACLE_HOME/oradata/trgt/history*.dbf  /disk2/backup/
</pre>
<div class="infobox-note" id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A__GUID-515C6BD6-5F52-4C06-BB73-CE1FA9765712">
<p class="notep1">Note:</p>
<p>When restoring a backup of a read-only tablespace, take the tablespace offline, restore the data files, then bring the tablespace online. A backup of a read-only tablespace is still usable if the read-only tablespace is made read/write after the backup, but the restored backup requires recovery.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Optionally, export the metadata in the read-only tablespace. By using the transportable tablespace feature, you can quickly restore the data files and import the metadata in case of media failure or user error. For example, export the metadata for tablespace <code class="codeph">history</code> as follows:</span>
<div>
<pre dir="ltr">% expdp DIRECTORY=dpump_dir1 DUMPFILE=hs.dmp TRANSPORT_TABLESPACES=history 
  LOGFILE=tts.log
</pre>
<div class="infoboxnotealso" id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A__GUID-2F7FCA03-95D3-4112-94B6-576CB9556695">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN002" target="_blank" href="../REFRN/GUID-8865F65B-EF6D-44A5-B0A1-3179EFF0C36A.htm#REFRN002"><span class="italic">Oracle Database Reference</span></a> for more information about the <code class="codeph">DBA_DATA_FILES</code> and <code class="codeph">DBA_TABLESPACES</code> views</p>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<a id="BRADV787"></a>
<div class="props_rev_3"><a id="GUID-B4948C50-74CA-40DE-9CD8-11455F14B6AD"></a>
<h2 id="BRADV-GUID-B4948C50-74CA-40DE-9CD8-11455F14B6AD" class="sect2">Making User-Managed Backups of Tablespaces in CDBs</h2>
<div>
<p>The procedures in the section <span class="q">&#34;<a href="osbackup.htm#GUID-D1582062-FF0C-462B-8468-4052914FA7B3">Making User-Managed Backups of Tablespaces and Data Files</a>&#34;</span> are applicable to CDBs and PDBs with the modifications described in the following sections:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350">Making User-Managed Backups of Offline Tablespaces and Data Files in CDBs</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A">Making User-Managed Backups of Online Tablespaces in CDBs and PDBs</a></p>
</li>
</ul>
</div>
<a id="BRADV789"></a><a id="BRADV790"></a><a id="BRADV788"></a>
<div class="props_rev_3"><a id="GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350"></a>
<h3 id="BRADV-GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350" class="sect3">Making User-Managed Backups of Offline Tablespaces and Data Files in CDBs</h3>
<div>
<div class="section">
<p>The guidelines described in <span class="q">&#34;<a href="osbackup.htm#GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8">Making User-Managed Backups of Offline Tablespaces and Data Files</a>&#34;</span> are also applicable to tablespaces and data files in CDBs and PDBs.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up offline tablespaces in the root container:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Open SQL*Plus.</p>
</li>
<li>
<p>Connect to the root as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> system privilege as described in <span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span>.</p>
</li>
<li>
<p>Follow the instructions in <span class="q">&#34;<a href="osbackup.htm#GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8">Making User-Managed Backups of Offline Tablespaces and Data Files</a>&#34;</span>.</p>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To backup offline tablespaces in a PDB:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Open SQL*Plus.</span></li>
<li><span>Connect to the PDB as a user with <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> system privilege as described in <span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span>.</span></li>
<li><span>Follow the instructions in <span class="q">&#34;<a href="osbackup.htm#GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8">Making User-Managed Backups of Offline Tablespaces and Data Files</a>&#34;</span>.</span></li>
</ol>
</div>
</div>
<a id="BRADV792"></a><a id="BRADV793"></a><a id="BRADV791"></a>
<div class="props_rev_3"><a id="GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A"></a>
<h3 id="BRADV-GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A" class="sect3">Making User-Managed Backups of Online Tablespaces in CDBs and PDBs</h3>
<div>
<div class="section">
<p>The guidelines described in <span class="q">&#34;<a href="osbackup.htm#GUID-57387AB6-1204-44F0-826A-F9B638453935">Making User-Managed Backups of Online Tablespaces and Data Files</a>&#34;</span> are also applicable to tablespaces and data files in CDBs and PDBs.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up online tablespaces in the root container:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Open SQL*Plus.</p>
</li>
<li>
<p>Connect to the root as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> system privilege as described in <span class="q">&#34;<a href="rcmcnctg.htm#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D">Connecting as Target to the Root</a>&#34;</span>.</p>
</li>
<li>
<p>Follow the instructions in <span class="q">&#34;<a href="osbackup.htm#GUID-57387AB6-1204-44F0-826A-F9B638453935">Making User-Managed Backups of Online Tablespaces and Data Files</a>&#34;</span>.</p>
</li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To backup online tablespaces in a PDB:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Open SQL*Plus.</span></li>
<li><span>Connect to the PDB as a user with <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> system privilege as described in <span class="q">&#34;<a href="rcmcnctg.htm#GUID-E95C5C27-C036-4773-B77C-E4120526F422">Connecting as Target to a PDB</a>&#34;</span>.</span></li>
<li><span>Follow the instructions in <span class="q">&#34;<a href="osbackup.htm#GUID-57387AB6-1204-44F0-826A-F9B638453935">Making User-Managed Backups of Online Tablespaces and Data Files</a>&#34;</span>.</span></li>
</ol>
</div>
</div>
</div>
<a id="BRADV202"></a>
<div class="props_rev_3"><a id="GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628"></a>
<h2 id="BRADV-GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628" class="sect2">Making User-Managed Backups of the Control File</h2>
<div>
<p>B<a id="d117138e3159" class="indexterm-anchor"></a><a id="d117138e3163" class="indexterm-anchor"></a><a id="d117138e3167" class="indexterm-anchor"></a><a id="d117138e3171" class="indexterm-anchor"></a><a id="d117138e3175" class="indexterm-anchor"></a>ack up the control file of a database after making a structural modification to a database operating in <code class="codeph">ARCHIVELOG</code> mode. To back up a database&#39;s control file, you must have the <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> system privilege.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC">Backing Up the Control File to a Binary File</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD">Backing Up the Control File to a Trace File</a></p>
</li>
</ul>
</div>
<a id="BRADV494"></a><a id="BRADV90010"></a>
<div class="props_rev_3"><a id="GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC"></a>
<h3 id="BRADV-GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC" class="sect3">Backing Up the Control File to a Binary File</h3>
<div>
<div class="section">
<p><a id="d117138e3274" class="indexterm-anchor"></a><a id="d117138e3280" class="indexterm-anchor"></a>The primary method for backing up the control file is to use a SQL statement to generate a binary file. A binary backup is preferable to a trace file backup because it contains additional information such as the archived log history, offline range for read-only and offline tablespaces, and backup sets and copies (if you use RMAN). If <code class="codeph">COMPATIBLE</code> is 10.2 or higher, binary control file backups include temp file entries.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up the control file after a structural change:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Make the desired change to the database. For example, you may create a tablespace:</span>
<div>
<pre dir="ltr">CREATE TABLESPACE tbs_1 DATAFILE &#39;file_1.f&#39; SIZE 10M;
</pre></div>
</li>
<li class="stepexpand"><span>Back up the database&#39;s control file, specifying a file name for the output binary file. The following example backs up a control file to <code class="codeph">/disk1/backup/cf.bak</code>:</span>
<div>
<pre dir="ltr">ALTER DATABASE BACKUP CONTROLFILE TO &#39;/disk1/backup/cf.bak&#39; REUSE;
</pre>
<p>Specify <code class="codeph">REUSE</code> to make the new control file overwrite one that currently exists.</p>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV495"></a><a id="BRADV90011"></a>
<div class="props_rev_3"><a id="GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD"></a>
<h3 id="BRADV-GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD" class="sect3">Backing Up the Control File to a Trace File</h3>
<div>
<div class="section">
<p>You can back up the control file to a text file that contains a <code class="codeph">CREATE CONTROLFILE</code> statement. You can edit the trace file to create a script that creates a new control file based on the control file that was current when you created the trace file.</p>
<p>If you specify neither the <code class="codeph">RESETLOGS</code> nor <code class="codeph">NORESETLOGS</code> option in the SQL statement, then the resulting trace file contains versions of the control file for both <code class="codeph">RESETLOGS</code> and <code class="codeph">NORESETLOGS</code> options. Temp file entries are included in the output using <code class="codeph">ALTER TABLESPACE ... ADD TEMPFILE</code> statements.</p>
<p>To avoid recovering offline normal or read-only tablespaces, edit them out of the <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statement. When you open the database with the re-created control file, the database marks these omitted files as <code class="codeph">MISSING</code>. You can run an <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code> statement to rename them to their original file names.</p>
<p>The trace file containing the <code class="codeph">CREATE CONTROLFILE</code> statement is stored in a subdirectory determined by the <code class="codeph">DIAGNOSTIC_DEST</code> initialization parameter. You can look in the database alert log for the name and location of the trace file to which the <code class="codeph">CREATE CONTROLFILE</code> statement was written. See <a class="olink ADMIN11267" target="_blank" href="../ADMIN/diag.htm#ADMIN11267"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> to learn how to locate the alert log.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To back up the control file to a trace file:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Mount or open the database.</span></li>
<li class="stepexpand"><span>Execute the following SQL statement:</span>
<div>
<pre dir="ltr">ALTER DATABASE BACKUP CONTROLFILE TO TRACE;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD__GUID-FD03E766-6013-450B-83B9-721D59D1BA96">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="osadvsce.htm#GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6">Recovery of Read-Only Files with a Re-Created Control File</a>&#34;</span> for special issues relating to read-only, offline normal, and temporary files included in <code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> statements</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV496"></a><a id="BRADV20333"></a>
<div class="props_rev_3"><a id="GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88"></a>
<h2 id="BRADV-GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88" class="sect2">Making User-Managed Backups of Archived Redo Logs</h2>
<div>
<div class="section">
<p>To save disk space in your primary archiving location, you may want to back up archived logs to tape or to an alternative disk location. If you archive to multiple locations, then only back up one copy of each log sequence number.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To back up archived redo logs:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d117138e3551" class="indexterm-anchor"></a>To determine which archived redo log files the database has generated, query <code class="codeph">V$ARCHIVED_LOG</code>. For example, run the following query:</span>
<div>
<pre dir="ltr">SELECT THREAD#,SEQUENCE#,NAME 
FROM V$ARCHIVED_LOG;
</pre></div>
</li>
<li class="stepexpand"><span>Back up one copy of each log sequence number by using an operating system utility. This example backs up all logs in the primary archiving location to a disk devoted to log backups:</span>
<div>
<pre dir="ltr">% cp $ORACLE_HOME/oracle/trgt/arch/* /disk2/backup/arch
</pre>
<div class="infoboxnotealso" id="GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88__GUID-064F4054-9800-4B47-90A9-B0B0F4F9004F">
<p class="notep1">See Also:</p>
<p><a class="olink REFRN002" target="_blank" href="../REFRN/GUID-8865F65B-EF6D-44A5-B0A1-3179EFF0C36A.htm#REFRN002"><span class="italic">Oracle Database Reference</span></a> for more information about the data dictionary views</p>
</div>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV204"></a>
<div class="props_rev_3"><a id="GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47"></a>
<h2 id="BRADV-GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47" class="sect2">Making User-Managed Backups in SUSPEND Mode</h2>
<div>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-79BD132A-31C6-4C37-93D9-6EDA1E187993">About the Suspend/Resume Feature</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6">Making Backups in a Suspended Database</a></p>
</li>
</ul>
</div>
<a id="BRADV90012"></a>
<div class="props_rev_3"><a id="GUID-79BD132A-31C6-4C37-93D9-6EDA1E187993"></a>
<h3 id="BRADV-GUID-79BD132A-31C6-4C37-93D9-6EDA1E187993" class="sect3">About the Suspend/Resume Feature</h3>
<div>
<p><a id="d117138e3725" class="indexterm-anchor"></a><a id="d117138e3731" class="indexterm-anchor"></a><a id="d117138e3735" class="indexterm-anchor"></a><a id="d117138e3737" class="indexterm-anchor"></a><a id="d117138e3741" class="indexterm-anchor"></a><a id="d117138e3745" class="indexterm-anchor"></a>Some third-party tools allow you to mirror a set of disks or logical devices, that is, maintain an exact duplicate of the primary data in another location, and then <span class="italic">split the mirror</span>. Splitting the mirror involves separating the copies so that you can use them independently.</p>
<p>With the <code class="codeph">SUSPEND</code>/<code class="codeph">RESUME</code> functionality, you can suspend I/O to the database, then split the mirror and make a backup of the split mirror. By using this feature, which complements the backup mode functionality, you can suspend database I/Os so that no new I/O can be performed. You can then access the suspended database to make backups without I/O interference.</p>
<p>Usually, you do not need to use <code class="codeph">SUSPEND</code>/<code class="codeph">RESUME</code> to make split mirror backups, although it is necessary if your system requires the database cache to be free of <span class="italic">dirty buffers</span> before a volume can be split. Some RAID devices benefit from suspending writes while the split operation is occurring; your RAID vendor can advise you on whether your system would benefit from this feature.</p>
<p>The <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code> statement suspends the database by halting I/Os to data file headers, data files, and control files. When the database is suspended, all preexisting I/O operations can complete; however, any new database I/O access attempts are queued.</p>
<p>The <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code> and <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">RESUME</code> statements operate on the database and not just the instance. If the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code> statement is entered on one system in an Oracle RAC configuration, then the internal locking mechanisms propagate the halt request across instances, thereby suspending I/O operations for all active instances in a given cluster.</p>
</div>
</div>
<a id="BRADV497"></a><a id="BRADV90013"></a>
<div class="props_rev_3"><a id="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6"></a>
<h3 id="BRADV-GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6" class="sect3">Making Backups in a Suspended Database</h3>
<div>
<div class="section">
<p>After a successful database suspension, you can back up the database to disk or break the mirrors. Because suspending a database does not guarantee immediate termination of I/O, Oracle recommends that you precede the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code> statement with a <code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code> statement so that the tablespaces are placed in backup mode.</p>
<p>You must use conventional user-managed backup methods to back up split mirrors. RMAN cannot make database backups or copies because these operations require reading the data file headers. After the database backup is finished or the mirrors are resilvered, then you can resume normal database operations using the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">RESUME</code> statement.</p>
<p>Backing up a suspended database without splitting mirrors can cause an extended database outage because the database is inaccessible during this time. If backups are taken by splitting mirrors, however, then the outage is nominal. The outage time depends on the size of cache to flush, the number of data files, and the time required to break the mirror.</p>
<p>Note the following restrictions for the <code class="codeph">SUSPEND/RESUME</code> feature:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>In an Oracle RAC configuration, do not start a new instance while the original nodes are suspended.</p>
</li>
<li>
<p>No checkpoint is initiated by the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code> or <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">RESUME</code> statements.</p>
</li>
<li>
<p>You cannot issue <code class="codeph">SHUTDOWN</code> with <code class="codeph">IMMEDIATE</code>, <code class="codeph">NORMAL</code>, or <code class="codeph">TRANSACTIONAL</code> options while the database is suspended.</p>
</li>
<li>
<p>Issuing <code class="codeph">SHUTDOWN</code> <code class="codeph">ABORT</code> on a database that is suspended reactivates the database. This prevents media recovery or failure recovery from getting into a unresponsive state.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To make a split mirror backup in SUSPEND mode:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Place the database tablespaces in backup mode. For example, to place tablespace <code class="codeph">users</code> in backup mode, enter:</span>
<div>
<pre dir="ltr">ALTER TABLESPACE users BEGIN BACKUP;
</pre>
<p>If you are backing up all of the tablespaces for your database, you can instead use:</p>
<pre dir="ltr">ALTER DATABASE BEGIN BACKUP;
</pre>
<div class="infobox-note" id="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6__GUID-714BD8DE-F478-4426-A8B4-F3554442A581">
<p class="notep1">Caution:</p>
<p>Do not use the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code> statement as a substitute for placing a tablespace in backup mode.</p>
</div>
</div>
</li>
<li class="stepexpand"><span><a id="d117138e3998" class="indexterm-anchor"></a><a id="d117138e4002" class="indexterm-anchor"></a>If your mirror system has problems with splitting a mirror while disk writes are occurring, then suspend the database. For example, issue the following statement:</span>
<div>
<pre dir="ltr">ALTER SYSTEM SUSPEND;
</pre></div>
</li>
<li class="stepexpand"><span><a id="d117138e4012" class="indexterm-anchor"></a><a id="d117138e4016" class="indexterm-anchor"></a>Verify that the database is suspended by querying the <code class="codeph">V$INSTANCE</code> view. For example:</span>
<div>
<pre dir="ltr">SELECT DATABASE_STATUS FROM V$INSTANCE;

DATABASE_STATUS 
----------------- 
SUSPENDED 
</pre></div>
</li>
<li class="stepexpand"><span>Split the mirrors at the operating system or hardware level.</span></li>
<li class="stepexpand"><span><a id="d117138e4032" class="indexterm-anchor"></a><a id="d117138e4036" class="indexterm-anchor"></a>End the database suspension. For example, issue the following statement:</span>
<div>
<pre dir="ltr">ALTER SYSTEM RESUME;
</pre></div>
</li>
<li class="stepexpand"><span>Establish that the database is active by querying the <code class="codeph">V$INSTANCE</code> view. For example, enter:</span>
<div>
<pre dir="ltr">SELECT DATABASE_STATUS FROM V$INSTANCE;

DATABASE_STATUS 
----------------- 
ACTIVE 
</pre></div>
</li>
<li class="stepexpand"><span>Take the specified tablespaces out of backup mode. For example, enter the following statement to take tablespace <code class="codeph">users</code> out of backup mode:</span>
<div>
<pre dir="ltr">ALTER TABLESPACE users END BACKUP;
</pre></div>
</li>
<li class="stepexpand"><span>Copy the control file and archive the online redo logs as usual for a backup.</span>
<div>
<div class="infoboxnotealso" id="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6__GUID-9A0956F3-C2E8-427F-A156-AF96997D6877">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmbckad.htm#GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C">Making Split Mirror Backups with RMAN</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ADMIN11165" target="_blank" href="../ADMIN/start.htm#ADMIN11165"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for more information about the <code class="codeph">SUSPEND</code>/<code class="codeph">RESUME</code> feature</p>
</li>
<li>
<p><a class="olink SQLRF00902" target="_blank" href="../SQLRF/statements_2017.htm#SQLRF00902"><span class="italic">Oracle Database SQL Language Reference</span></a> for the <a class="olink SQLRF00902" target="_blank" href="../SQLRF/statements_2017.htm#SQLRF00902"><code class="codeph">ALTER SYSTEM</code></a> <code class="codeph">SUSPEND</code> syntax</p>
</li>
</ul>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV205"></a>
<div class="props_rev_3"><a id="GUID-3E0AAB48-7D0B-4012-BB41-E33DD11189C0"></a>
<h2 id="BRADV-GUID-3E0AAB48-7D0B-4012-BB41-E33DD11189C0" class="sect2">Making User-Managed Backups to Raw Devices</h2>
<div>
<p><a id="d117138e4172" class="indexterm-anchor"></a>A <a href="glossary.htm#GUID-D6545038-B176-4D0E-9B4B-E4187A063984"><span class="xrefglossterm">raw device</span></a> is a disk or partition that does not have a file system. A raw device can contain only a single file. Backing up files on raw devices poses operating system specific issues. The following sections discuss some of these issues on UNIX, Linux, and Windows.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-AE360086-A112-481C-9295-9DF46D20F1CC">Backing Up to Raw Devices on Linux and UNIX</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B">Backing Up to Raw Devices on Windows</a></p>
</li>
</ul>
</div>
<a id="BRADV498"></a><a id="BRADV499"></a><a id="BRADV500"></a><a id="BRADV90014"></a>
<div class="props_rev_3"><a id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC"></a>
<h3 id="BRADV-GUID-AE360086-A112-481C-9295-9DF46D20F1CC" class="sect3">Backing Up to Raw Devices on Linux and UNIX</h3>
<div>
<p><a id="d117138e4266" class="indexterm-anchor"></a>The <code class="codeph">dd</code> command on Linux and UNIX is the most common backup utility for backing up to or from raw devices. See your operating system-specific documentation for complete details about this utility.</p>
<p>Using <code class="codeph">dd</code> effectively requires that you specify the correct options, based on your database. <a href="osbackup.htm#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__CHDFJAAE" title="Effect of dd on different types of data">Table 29-1</a> lists details about your database that affect the options you use for <code class="codeph">dd</code>.</p>
<div class="tblformal" id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC__CHDFJAAE">
<p class="titleintable">Table 29-1 Aspects of the Database Important for dd Usage</p>
<table class="cellalignment515" title="Aspects of the Database Important for dd Usage" summary="Effect of dd on different types of data">
<thead>
<tr class="cellalignment501">
<th class="cellalignment527" id="d117138e4297">Data</th>
<th class="cellalignment528" id="d117138e4300">Explanation</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4305" headers="d117138e4297">
<p>Block size</p>
</td>
<td class="cellalignment530" headers="d117138e4305 d117138e4300">
<p>You can specify the size of the buffer that <code class="codeph">dd</code> uses to copy data. For example, you can specify that <code class="codeph">dd</code> copies data in units of 8 KB or 64 KB. The block size for <code class="codeph">dd</code> need not correspond to either the Oracle block size or the operating system block size: it is merely the size of the buffer used by <code class="codeph">dd</code> when making the copy.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4324" headers="d117138e4297">
<p>Raw offset</p>
</td>
<td class="cellalignment530" headers="d117138e4324 d117138e4300">
<p>On some systems, the beginning of the file on the raw device is reserved for use by the operating system. This storage space is called the <strong class="term">raw offset</strong>. Oracle Database does not back up or restore these bytes.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4334" headers="d117138e4297">
<p>Size of Oracle Database block <code class="codeph">0</code></p>
</td>
<td class="cellalignment530" headers="d117138e4334 d117138e4300">
<p>At the beginning of every Oracle database file, the operating system-specific code places an Oracle block called <strong class="term">block 0</strong>. The generic Oracle code does not recognize this block, but the block is included in the size of the file on the operating system. Typically, this block is the same size as the other Oracle blocks in the file.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>The information in <a href="osbackup.htm#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__CHDFJAAE" title="Effect of dd on different types of data">Table 29-1</a> enables you to set the <code class="codeph">dd</code> options specified in <a href="osbackup.htm#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012027" title="This table describes options to the dd command.">Table 29-2</a>.</p>
<div class="tblformal" id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012027">
<p class="titleintable">Table 29-2 Options for dd Command</p>
<table class="cellalignment515" title="Options for dd Command" summary="This table describes options to the dd command.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment527" id="d117138e4370">This Option ...</th>
<th class="cellalignment528" id="d117138e4373">Specifies ...</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4378" headers="d117138e4370">
<p><code class="codeph">if</code></p>
</td>
<td class="cellalignment530" headers="d117138e4378 d117138e4373">
<p>The name of the input file, that is, the file that you are reading</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4386" headers="d117138e4370">
<p><code class="codeph">of</code></p>
</td>
<td class="cellalignment530" headers="d117138e4386 d117138e4373">
<p>The name of the output file, that is, the file to which you are writing</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4394" headers="d117138e4370">
<p><code class="codeph">bs</code></p>
</td>
<td class="cellalignment530" headers="d117138e4394 d117138e4373">
<p>The buffer size used by <code class="codeph">dd</code> to copy data</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4405" headers="d117138e4370">
<p><code class="codeph">skip</code></p>
</td>
<td class="cellalignment530" headers="d117138e4405 d117138e4373">
<p>The number of <code class="codeph">dd</code> buffers to skip on the input raw device if a raw offset exists. For example, if you are backing up a file on a raw device with a 64 KB raw offset, and the <code class="codeph">dd</code> buffer size is 8 KB, then you can specify <code class="codeph">skip=8</code> so that the copy starts at offset 64 KB.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4422" headers="d117138e4370">
<p><code class="codeph">seek</code></p>
</td>
<td class="cellalignment530" headers="d117138e4422 d117138e4373">
<p>The number of <code class="codeph">dd</code> buffers to skip on the output raw device if a raw offset exists. For example, if you are backing up a file onto a raw device with a 64 KB raw offset, and the <code class="codeph">dd</code> buffer size is 8 KB, then you can specify <code class="codeph">skip=8</code> so that the copy starts at offset 64 KB.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4439" headers="d117138e4370">
<p><code class="codeph">count</code></p>
</td>
<td class="cellalignment530" headers="d117138e4439 d117138e4373">
<p>The number of blocks on the input raw device for <code class="codeph">dd</code> to copy. It is best to specify the exact number of blocks to copy when copying from a raw device to a file system; otherwise extra space at the end of the raw volume that is not used by the Oracle data file is copied to the file system.</p>
<p>Remember to include block <code class="codeph">0</code> in the total size of the input file. For example, if the <code class="codeph">dd</code> block size is 8 KB, and you are backing up a 30720 KB data file, then you can set <code class="codeph">count=3841</code>. This value for <code class="codeph">count</code> actually backs up 30728 KB: the extra 8 KB are for Oracle block <code class="codeph">0</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Because a raw device can be the input or output device for a backup, you have four possible scenarios for the backup. The possible options for <code class="codeph">dd</code> depend on which scenario you choose, as illustrated in <a href="osbackup.htm#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012052" title="This table lists the options needed for the dd command based on the source and destination types for a backup.">Table 29-3</a>.</p>
<div class="tblformal" id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012052">
<p class="titleintable">Table 29-3 Scenarios Involving dd Backups</p>
<table class="cellalignment515" title="Scenarios Involving dd Backups" summary="This table lists the options needed for the dd command based on the source and destination types for a backup.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment522" id="d117138e4487">Backing Up from ...</th>
<th class="cellalignment522" id="d117138e4490">Backing Up to ...</th>
<th class="cellalignment522" id="d117138e4493">Options Specified for dd Command</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment524" id="d117138e4498" headers="d117138e4487">
<p>Raw device</p>
</td>
<td class="cellalignment524" headers="d117138e4498 d117138e4490">
<p>Raw device</p>
</td>
<td class="cellalignment524" headers="d117138e4498 d117138e4493">
<p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs,</code> <code class="codeph">skip</code>, <code class="codeph">seek</code>, <code class="codeph">count</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d117138e4524" headers="d117138e4487">
<p>Raw device</p>
</td>
<td class="cellalignment524" headers="d117138e4524 d117138e4490">
<p>File system</p>
</td>
<td class="cellalignment524" headers="d117138e4524 d117138e4493">
<p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs,</code> <code class="codeph">skip</code>, <code class="codeph">count</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d117138e4547" headers="d117138e4487">
<p>File system</p>
</td>
<td class="cellalignment524" headers="d117138e4547 d117138e4490">
<p>Raw device</p>
</td>
<td class="cellalignment524" headers="d117138e4547 d117138e4493">
<p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs,</code> <code class="codeph">seek</code></p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment524" id="d117138e4567" headers="d117138e4487">
<p>File system</p>
</td>
<td class="cellalignment524" headers="d117138e4567 d117138e4490">
<p>File system</p>
</td>
<td class="cellalignment524" headers="d117138e4567 d117138e4493">
<p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<a id="BRADV90015"></a>
<div class="props_rev_3"><a id="GUID-8D75A1AC-463C-486B-BE73-2F227A6D71B1"></a>
<h4 id="BRADV-GUID-8D75A1AC-463C-486B-BE73-2F227A6D71B1" class="sect4">Backing Up with the dd Utility on Linux and UNIX: Examples</h4>
<div>
<p>For these examples of <code class="codeph">dd</code> utility usage, assume the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>You are backing up a 30720 KB data file.</p>
</li>
<li>
<p>The beginning of the data file has a block 0 of 8 KB.</p>
</li>
<li>
<p>The raw offset is 64 KB.</p>
</li>
<li>
<p>You set the <code class="codeph">dd</code> block size to 8 KB when a raw device is involved in the copy.</p>
</li>
</ul>
<p>In the following example, you back up from one raw device to another raw device:</p>
<pre dir="ltr">% dd if=/dev/rsd1b of=/dev/rsd2b bs=8k skip=8 seek=8 count=3841
</pre>
<p>In the following example, you back up from a raw device to a file system:</p>
<pre dir="ltr">% dd if=/dev/rsd1b of=/backup/df1.dbf bs=8k skip=8 count=3841
</pre>
<p>In the following example, you back up from a file system to a raw device:</p>
<pre dir="ltr">% dd if=/backup/df1.dbf of=/dev/rsd2b bs=8k seek=8
</pre>
<p>In the following example, you back up from a file system to a file system, and set the block size to a high value to boost I/O performance:</p>
<pre dir="ltr">% dd if=/oracle/dbs/df1.dbf of=/backup/df1.dbf bs=1024k
</pre></div>
</div>
</div>
<a id="BRADV501"></a><a id="BRADV90016"></a>
<div class="props_rev_3"><a id="GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B"></a>
<h3 id="BRADV-GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B" class="sect3">Backing Up to Raw Devices on Windows</h3>
<div>
<div class="section">
<p><a id="d117138e4759" class="indexterm-anchor"></a>Like Linux and UNIX, Windows supports raw disk partitions in which the database can store data files, online logs, and control files. Each raw partition is assigned either a drive letter or physical drive number and does not contain a file system. As in Linux and UNIX, each raw partition on Windows is mapped to a single file.</p>
<p>Windows differs from Linux and UNIX in the naming convention for Oracle files. On Windows, raw data file names are formatted as follows:</p>
<pre dir="ltr">\\.\<span class="italic">drive_letter</span>:
\\.\PHYSICALDRIVE<span class="italic">drive_number</span>
</pre>
<p>For example, the following are possible raw file names:</p>
<pre dir="ltr">\\.\G:
\\.\PHYSICALDRIVE3
</pre>
<p>The procedure for making user-managed backups of raw data files is basically the same as for copying files on a Windows file system, except that you use the Oracle <code class="codeph">OCOPY</code> utility rather than the Windows-supplied <code class="codeph">copy.exe</code> or <code class="codeph">ntbackup.exe</code> utilities. <code class="codeph">OCOPY</code> supports 64-bit file I/O, physical raw drives, and raw files. The <code class="codeph">OCOPY</code> utility cannot back up directly to tape.</p>
<p>To display online documentation for <code class="codeph">OCOPY</code>, enter <code class="codeph">OCOPY</code> by itself at the Windows prompt. Sample output follows:</p>
<pre dir="ltr">Usage of OCOPY:
     ocopy from_file [to_file [a | size_1 [size_n]]]
     ocopy -b from_file to_drive
     ocopy -r from_drive to_dir
</pre>
<p>Note the important <code class="codeph">OCOPY</code> options described in <a href="osbackup.htm#GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B__CEGIEACH" title="This table lists important options to the ocopy command.">Table 29-4</a>.</p>
<div class="tblformal" id="GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B__CEGIEACH">
<p class="titleintable">Table 29-4 OCOPY Options</p>
<table class="cellalignment515" title="OCOPY Options" summary="This table lists important options to the ocopy command.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment527" id="d117138e4825">Option</th>
<th class="cellalignment528" id="d117138e4828">Action</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4833" headers="d117138e4825">
<p><code class="codeph">b</code></p>
</td>
<td class="cellalignment530" headers="d117138e4833 d117138e4828">
<p>Splits the input file into multiple output files. This option is useful for backing up to devices that are smaller than the input file.</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment529" id="d117138e4841" headers="d117138e4825">
<p><code class="codeph">r</code></p>
</td>
<td class="cellalignment530" headers="d117138e4841 d117138e4828">
<p>Combines multiple input files and writes to a single output file. This option is useful for restoring backups created with the <code class="codeph">-b</code> option.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="section" --></div>
<a id="BRADV90017"></a>
<div class="props_rev_3"><a id="GUID-81561179-3309-47C5-B139-11B3DD978025"></a>
<h4 id="BRADV-GUID-81561179-3309-47C5-B139-11B3DD978025" class="sect4">Backing Up with OCOPY: Example</h4>
<div>
<div class="section">
<p>In this example, assume the following:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Data file <code class="codeph">12</code> is mounted on the <code class="codeph">\\.\G:</code> raw partition.</p>
</li>
<li>
<p>The <code class="codeph">C:</code> drive mounts a file system.</p>
</li>
<li>
<p>The database is open.</p>
</li>
</ul>
<p>To back up the data file on the raw partition \\.\<code class="codeph">G:</code> to a local file system, you can run the following command at the prompt after placing data file <code class="codeph">12</code> in backup mode:</p>
<pre dir="ltr">OCOPY &#34;\\.G:&#34; C:\backup\datafile12.bak
</pre></div>
<!-- class="section" --></div>
</div>
<a id="BRADV90018"></a>
<div class="props_rev_3"><a id="GUID-C6327EEE-779B-491D-BDD0-453D5C154AA3"></a>
<h4 id="BRADV-GUID-C6327EEE-779B-491D-BDD0-453D5C154AA3" class="sect4">Specifying the -b and -r Options for OCOPY: Example</h4>
<div>
<div class="section">
<p>In this example, assume the following:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">\\.\G:</code> is a raw partition containing data file <code class="codeph">7</code></p>
</li>
<li>
<p>The <code class="codeph">E:</code> drive is a removable disk drive.</p>
</li>
<li>
<p>The database is open.</p>
</li>
</ul>
<p>To back up the data file onto drive <code class="codeph">E:</code>, you can execute the following command at the Windows prompt after placing data file <code class="codeph">7</code> in backup mode:</p>
<pre dir="ltr"># first argument is file name, second argument is drive
OCOPY -b &#34;\\.\G:&#34; E:\
</pre>
<p>When drive <code class="codeph">E:</code> fills up, you can use another disk. In this way, you can divide the backup of data file <code class="codeph">7</code> into multiple files.</p>
<p>Similarly, to restore the backup, take the tablespace containing data file <code class="codeph">7</code> offline and run this command:</p>
<pre dir="ltr"># first argument is drive, second argument is directory
OCOPY -r E:\ &#34;\\.\G:&#34;
</pre></div>
<!-- class="section" --></div>
</div>
</div>
</div>
<a id="BRADV90019"></a>
<div class="props_rev_3"><a id="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA"></a>
<h2 id="BRADV-GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA" class="sect2">Making Backups with Third-Party Snapshot Technologies</h2>
<div>
<div class="section">
<p>You can use Storage Snapshot Optimization to take third-party snapshots of the database, without placing the database in backup mode. The snapshots must conform to the requirements described in this section.</p>
<p>Storage Snapshot Optimization provides the following benefits:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Eliminates the complexity and overhead associated with placing the database in backup mode.</p>
</li>
<li>
<p>Performs the recovery in a single step by using the <code class="codeph">RECOVER ... SNAPSHOT TIME</code> command. You can recover either to the current time or to a point in time after the snapshot was taken.</p>
</li>
</ul>
<p>To use Snapshot Storage Optimization, the third-party snapshot technology must conform to the following requirements:</p>
<ul style="list-style-type: disc;">
<li>
<p>The database is crash consistent during the snapshot.</p>
</li>
<li>
<p>The snapshot preserves write order for each file.</p>
</li>
<li>
<p>The snapshot technology stores the time at which the snapshot is completed.</p>
</li>
</ul>
<p>If the vendor cannot guarantee compliance with these requirements, then you must place your data files into <a id="d117138e5182" class="indexterm-anchor"></a><a href="glossary.htm#GUID-BD2A12D3-A995-49B8-AE99-B8DDDF4FE7E7"><span class="xrefglossterm">backup mode</span></a> by using the <a class="olink SQLRF00802" target="_blank" href="../SQLRF/statements_1006.htm#SQLRF00802"><code class="codeph">ALTER DATABASE</code></a> or <a class="olink SQLRF01002" target="_blank" href="../SQLRF/statements_3002.htm#SQLRF01002"><code class="codeph">ALTER TABLESPACE</code></a> statement with the <code class="codeph">BEGIN BACKUP</code> clause. Place your data files in backup mode just before you create the snapshot. When a tablespace is in backup mode, the database writes the before image for an entire block to the redo stream before modifying a block. The database also records changes to the block in the online redo log. Backup mode also freezes the <a href="glossary.htm#GUID-22212AAE-6F3C-4E84-B940-5AB2261A7EDA"><span class="xrefglossterm">data file checkpoint</span></a> until the file is removed from backup mode. Oracle Database performs this safeguard because it cannot guarantee that a third-party backup tool copies the file header before copying the data blocks. Immediately after the snapshot is created, use the <code class="codeph">ALTER DATABASE</code> or <code class="codeph">ALTER TABLESPACE</code> command with the <code class="codeph">END BACKUP</code> clause to take the data files out of backup mode. You need not wait until the snapshot is actually copied to the backup media to end backup mode.</p>
<div class="infoboxnotealso" id="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA__GUID-70096045-0DF1-4E79-B264-C0EEAE0F52F6">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="osrecvry.htm#GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B">Recovery Using Storage Snapshot Optimization</a>&#34;</span></p>
</div>
<p><a href="glossary.htm#GUID-105781E5-32FB-4702-9248-9041B0EFBED4"><span class="xrefglossterm">Volume Shadow Copy Service (VSS)</span></a> is a set of Windows APIs that enable applications to create consistent snapshots called <strong class="term">shadow copies</strong>. The <a href="glossary.htm#GUID-CB860FA8-E039-4EC5-BAAC-F59091EA8F18"><span class="xrefglossterm">Oracle VSS writer</span></a> runs as a service on Windows systems and is integrated with VSS-enabled applications. You can use these applications to create snapshots of database files managed by the Oracle instance. For example, you can make shadow copies of an Oracle database while it is open read/write.</p>
<div class="infoboxnotealso" id="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA__GUID-ABF77C79-6193-464F-8472-407D5CAF68F3">
<p class="notep1">See Also:</p>
<p><a class="olink NTQRF" target="_blank" href="../NTQRF/toc.htm"><span class="italic">Oracle Database Platform Guide for Microsoft Windows</span></a> to learn how to back up and recover the database with VSS-enabled applications</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV206"></a>
<div class="props_rev_3"><a id="GUID-F47FE2CE-EEE0-42E5-AE8E-0A9D5D1BB42C"></a>
<h2 id="BRADV-GUID-F47FE2CE-EEE0-42E5-AE8E-0A9D5D1BB42C" class="sect2">Verifying User-Managed Data File Backups</h2>
<div>
<p><a id="d117138e5311" class="indexterm-anchor"></a><a id="d117138e5315" class="indexterm-anchor"></a><a id="d117138e5319" class="indexterm-anchor"></a><a id="d117138e5321" class="indexterm-anchor"></a>You must periodically verify your backups to ensure that they are usable for recovery.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="osbackup.htm#GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5">Testing the Restoration of Data File Backups</a></p>
</li>
<li>
<p><a href="osbackup.htm#GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D">Running the DBVERIFY Utility</a></p>
</li>
</ul>
</div>
<a id="BRADV90020"></a>
<div class="props_rev_3"><a id="GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5"></a>
<h3 id="BRADV-GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5" class="sect3">Testing the Restoration of Data File Backups</h3>
<div>
<p>The best way to test the usability of data file backups is to restore them to a separate host and attempt to open the database, performing media recovery if necessary. This option requires that you have a separate host available for the restore procedure.</p>
<div class="infoboxnotealso" id="GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5__GUID-27ABC0ED-6AE8-4B8D-A706-9C92D080B261">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="osrecvry.htm#GUID-66D07694-533F-4E3A-BA83-DD461B68DB56">Performing Complete Database Recovery</a>&#34;</span> to learn how to recover files with SQL*Plus</p>
</div>
</div>
</div>
<a id="BRADV90021"></a>
<div class="props_rev_3"><a id="GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D"></a>
<h3 id="BRADV-GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D" class="sect3">Running the DBVERIFY Utility</h3>
<div>
<div class="section">
<p>The <code class="codeph">DBVERIFY</code> program is an external command-line utility that performs a physical data structure integrity check on an offline data file. Use <code class="codeph">DBVERIFY</code> to ensure that a user-managed backup of a data file is valid before it is restored or as a diagnostic aid when you have encountered data corruption problems.</p>
<p>The name and location of <code class="codeph">DBVERIFY</code> is dependent on your operating system. For example, to perform an integrity check on data file <code class="codeph">users01.dbf</code> on Linux or UNIX, run the <code class="codeph">dbv</code> command as follows:</p>
<pre dir="ltr">% dbv file=users01.dbf
</pre>
<p>Sample <code class="codeph">dbv</code> output follows:</p>
<pre dir="ltr">DBVERIFY - Verification starting : FILE = users01.dbf


DBVERIFY - Verification complete

Total Pages Examined         : 250
Total Pages Processed (Data) : 1
Total Pages Failing   (Data) : 0
Total Pages Processed (Index): 0
Total Pages Failing   (Index): 0
Total Pages Processed (Other): 2
Total Pages Processed (Seg)  : 0
Total Pages Failing   (Seg)  : 0
Total Pages Empty            : 247
Total Pages Marked Corrupt   : 0
Total Pages Influx           : 0
</pre>
<div class="infoboxnotealso" id="GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D__GUID-1120334F-66DE-460A-8C68-36B37A1FD211">
<p class="notep1">See Also:</p>
<p><a class="olink SUTIL013" target="_blank" href="../SUTIL/GUID-05C9875B-1AC1-433D-A71E-B7C0667EE1F1.htm#SUTIL013"><span class="italic">Oracle Database Utilities</span></a> to learn about <code class="codeph">DBVERIFY</code></p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="part_umb.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="osrecvry.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>