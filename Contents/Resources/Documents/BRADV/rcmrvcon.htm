<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2679"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/RMAN%20Data%20Repair%20Concepts"></a><title>RMAN Data Repair Concepts</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="PDBs, orphaned backups"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="part_dia.htm" title="Previous" type="text/html"/>
<link rel="Next" href="rcmrepai.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-1805CCF7-4AF2-482D-B65A-998192F89C2B"></a> <span id="PAGE" style="display:none;">26/48</span> <!-- End Header -->
<a id="BRADV89703"></a>
<h1 id="BRADV-GUID-1805CCF7-4AF2-482D-B65A-998192F89C2B" class="sect1"><span class="enumeration_chapter">14</span> RMAN Data Repair Concepts</h1>
<div>
<p>This chapter describes the general concepts that you must understand to perform <a href="glossary.htm#GUID-80C351AD-232F-4C8F-995C-0B5239E6C378"><span class="xrefglossterm">data repair</span></a>. This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmrvcon.htm#GUID-6718D3FE-E35D-42D3-BD45-D50E662B5C23">Overview of RMAN Data Repair</a></p>
</li>
<li>
<p><a href="rcmrvcon.htm#GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA">About RMAN Restore Operations</a></p>
</li>
<li>
<p><a href="rcmrvcon.htm#GUID-76B772E9-9B69-4D86-8735-D9453A425017">About RMAN Media Recovery</a></p>
</li>
</ul>
</div>
<a id="BRADV8199"></a>
<div class="props_rev_3"><a id="GUID-6718D3FE-E35D-42D3-BD45-D50E662B5C23"></a>
<h2 id="BRADV-GUID-6718D3FE-E35D-42D3-BD45-D50E662B5C23" class="sect2">Overview of RMAN Data Repair</h2>
<div>
<p>As explained in <span class="q">&#34;<a href="rcmintro.htm#GUID-7D5CF571-0B7A-46D7-B9DC-CD15F3A4C34F">About Data Protection</a>&#34;</span>, a principal purpose of a backup and recovery strategy is data protection. The key to an effective, efficient strategy is to understand the basic options of data repair.</p>
</div>
<a id="BRADV89704"></a>
<div class="props_rev_3"><a id="GUID-4E91B620-9FB4-4DDF-BB1D-A1C5DA71B7F9"></a>
<h3 id="BRADV-GUID-4E91B620-9FB4-4DDF-BB1D-A1C5DA71B7F9" class="sect3">About Problems Requiring Data Repair</h3>
<div>
<p><a id="d64788e232" class="indexterm-anchor"></a>While several problems can halt the normal operation of an Oracle database or affect database I/O operations, only the following typically require DBA intervention and data repair: user errors, application errors, and media failures.</p>
</div>
<a id="BRADV89705"></a>
<div class="props_rev_3"><a id="GUID-8F3BC8E9-34F6-46DF-BDF4-7F69770C349F"></a>
<h4 id="BRADV-GUID-8F3BC8E9-34F6-46DF-BDF4-7F69770C349F" class="sect4">About User Errors</h4>
<div>
<p>User errors occur when, either due to an error in application logic or a manual mistake, data in your database is changed or deleted incorrectly. For example, a user logs in to the wrong database and drops a database table. User errors are estimated to be the greatest single cause of database downtime.</p>
</div>
</div>
<a id="BRADV89706"></a>
<div class="props_rev_3"><a id="GUID-5591B05F-8253-4B25-B64C-E7084E7A8DD9"></a>
<h4 id="BRADV-GUID-5591B05F-8253-4B25-B64C-E7084E7A8DD9" class="sect4">About Application Errors</h4>
<div>
<p>Sometimes a software malfunction can corrupt <a id="d64788e377" class="indexterm-anchor"></a>data blocks. In <a id="d64788e380" class="indexterm-anchor"></a>a <a href="glossary.htm#GUID-6035D1EA-C660-4F45-B1AC-FE6B15810C54"><span class="xrefglossterm">physical corruption</span></a>, which is also called a media corruption, the database does not recognize the block.</p>
</div>
</div>
<a id="BRADV89707"></a>
<div class="props_rev_3"><a id="GUID-5664E5E8-A5DA-4BA5-91C2-A50954010920"></a>
<h4 id="BRADV-GUID-5664E5E8-A5DA-4BA5-91C2-A50954010920" class="sect4">About Media Failures</h4>
<div>
<p>A <a href="glossary.htm#GUID-ABDE7EEF-D4B3-4867-A69C-3B24614AF430"><span class="xrefglossterm">media failure</span></a> occurs when a problem external to the database prevents it from reading from or writing to a file during normal operations. Typical media failures include disk failures and the deletion of database files. Media failures are less common than user or application errors, but your backup and recovery strategy should prepare for them.</p>
</div>
</div>
</div>
<a id="BRADV89708"></a>
<div class="props_rev_3"><a id="GUID-E78CF06A-1EF0-4B18-8AFA-6C4297B0AF8A"></a>
<h3 id="BRADV-GUID-E78CF06A-1EF0-4B18-8AFA-6C4297B0AF8A" class="sect3">About RMAN Data Repair Techniques</h3>
<div>
<p><a id="d64788e531" class="indexterm-anchor"></a>Depending on the situations you anticipate, consider incorporating each of the following options into your strategy for responding to data loss, and then set up your database to make these options possible.</p>
<ul style="list-style-type: disc;">
<li>
<p><a id="d64788e539" class="indexterm-anchor"></a><a href="glossary.htm#GUID-5E618F7B-127F-4BE2-9ED5-E9D1B828434D"><span class="xrefglossterm">Data Recovery Advisor</span></a></p>
<p>This Oracle Database infrastructure can diagnose failures, advise you on how to respond to them, and repair the failures automatically.</p>
<p><span class="q">&#34;<a href="rcmrepai.htm#GUID-636EA9BE-2DFB-4FA0-959E-B1290C774ABD">Overview of Data Recovery Advisor</a>&#34;</span> explains the basic concepts of Data Recovery Advisor.</p>
</li>
<li>
<p><a href="glossary.htm#GUID-66505C98-875E-4C34-AB45-39762061D6D7"><span class="xrefglossterm">logical flashback features</span></a></p>
<p>This subset of <a href="glossary.htm#GUID-B9B3A008-D1DB-4B83-B825-70E8B79A9920"><span class="xrefglossterm">Oracle Flashback Technology</span></a> features enables you to view or rewind individual database objects or transactions to a past time. These features do not require use of RMAN.</p>
<p><span class="q">&#34;<a href="rcmflash.htm#GUID-94B90ECF-69C9-40D4-A318-DC4AE9776557">Overview of Oracle Flashback Technology and Database Point-in-Time Recovery</a>&#34;</span> explains the basic concepts of the logical flashback features and provides pointers where appropriate.</p>
</li>
<li>
<p><a href="glossary.htm#GUID-DD883C9B-0441-48D3-9DDC-755597782971"><span class="xrefglossterm">Oracle Flashback Database</span></a></p>
<p><a id="d64788e575" class="indexterm-anchor"></a>Flashback Database is a block-level recovery mechanism that is similar to media recovery, but is generally faster and does not require a backup to be restored. You can return your whole database to a previous state without restoring old copies of your data files from backup, if you have enabled flashback logging in advance. You must have a fast recovery area configured for logging for flashback database or guaranteed restore points.</p>
<p><span class="q">&#34;<a href="rcmflash.htm#GUID-15D5CF76-8622-4117-8954-3D872A0B0A86">Basic Concepts of Point-in-Time Recovery and Flashback Features</a>&#34;</span> explains the basic concepts of Flashback Database.</p>
</li>
<li>
<p><a href="glossary.htm#GUID-01B3A956-DA97-4B47-9600-FA5549B7E868"><span class="xrefglossterm">data file media recovery</span></a></p>
<p>This form of <a href="glossary.htm#GUID-5FEE9C7C-AD8F-4CFB-BAF2-E6B52EDC67AB"><span class="xrefglossterm">media recovery</span></a> enables you to restore data file backups and apply archived redo logs or incremental backups to recover lost changes. You can either recover a whole database or a subset of the database. Data file media recovery is the most general-purpose form of recovery and can protect against both physical and logical failures.</p>
<p>The general concepts of data file media recovery are explained in this chapter. The techniques are described in <a href="rcmcomre.htm#GUID-D908719C-9D46-4084-850C-0F81C25094EB">Performing Complete Database Recovery</a> and <span class="q">&#34;<a href="rcmflash.htm#GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0">Performing Database Point-in-Time Recovery</a>&#34;</span>.</p>
</li>
<li>
<p><a href="glossary.htm#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">block media recovery</span></a></p>
<p>This form of <a href="glossary.htm#GUID-5FEE9C7C-AD8F-4CFB-BAF2-E6B52EDC67AB"><span class="xrefglossterm">media recovery</span></a> enables you to recover individual blocks within a data file rather than the whole data file.</p>
<p><span class="q">&#34;<a href="rcmblock.htm#GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216">Overview of Block Media Recovery</a>&#34;</span> explains the basic concepts of block media recovery.</p>
</li>
<li>
<p><a href="glossary.htm#GUID-8A257409-B3DC-41FD-A2AF-D47560FF9F18"><span class="xrefglossterm">tablespace point-in-time recovery (TSPITR)</span></a></p>
<p>This is a specialized form of <a href="glossary.htm#GUID-491BEF3A-18F0-4670-B078-2D84765141E8"><span class="xrefglossterm">point-in-time recovery</span></a> in which you recover one or more tablespaces to a time earlier than the rest of the database.</p>
<p><span class="q">&#34;<a href="rcmtspit.htm#GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1">Overview of RMAN TSPITR</a>&#34;</span> explains the basic concepts of TSPITR.</p>
</li>
</ul>
<p>In general, the concepts required to use the preceding repair techniques are explained along with the techniques. This chapter explains concepts that are common to several RMAN data repair solutions.</p>
</div>
</div>
</div>
<a id="BRADV116"></a>
<div class="props_rev_3"><a id="GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA"></a>
<h2 id="BRADV-GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA" class="sect2">About RMAN Restore Operations</h2>
<div>
<p><a id="d64788e711" class="indexterm-anchor"></a><a id="d64788e713" class="indexterm-anchor"></a><a id="d64788e717" class="indexterm-anchor"></a>In an RMAN <a href="glossary.htm#GUID-ACC5946D-4855-40AE-A10F-57A6883B5D13"><span class="xrefglossterm">restore</span></a> operation, you select files to be restored and then run the <code class="codeph">RESTORE</code> command. Typically, you restore files in preparation for media recovery. You can restore the following types of files:</p>
<ul style="list-style-type: disc;">
<li>
<p>Database (all data files)</p>
</li>
<li>
<p>Tablespaces</p>
</li>
<li>
<p>Control files</p>
</li>
<li>
<p>Archived redo logs</p>
</li>
<li>
<p>Server parameter files</p>
</li>
</ul>
<p>You can specify either the default location or a new location for restored data files and control files. If you restore to the default location, then RMAN overwrites any files with the same name that currently exist in this location. Alternatively, you can use the <code class="codeph">SET</code> <code class="codeph">NEWNAME</code> command to specify new locations for restored data files. You can then run a <code class="codeph">SWITCH</code> command to update the control file to indicate that the restored files in their new locations are now the current data files.</p>
<div class="infoboxnotealso" id="GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA__GUID-C1D72C97-1445-4CA2-A388-BA8F5FE26BC7">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF149" target="_blank" href="../RCMRF/rcmsynta2008.htm#RCMRF149"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">RESTORE</code> syntax and prerequisites, <a class="olink RCMRF153" target="_blank" href="../RCMRF/rcmsynta2014.htm#RCMRF153"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">SET</code> <code class="codeph">NEWNAME</code> syntax, and <a class="olink RCMRF159" target="_blank" href="../RCMRF/rcmsynta2021.htm#RCMRF159"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">SWITCH</code> syntax</p>
</div>
</div>
<a id="BRADV89709"></a>
<div class="props_rev_3"><a id="GUID-164F7AD2-EF3F-4541-98A3-5DE198D87550"></a>
<h3 id="BRADV-GUID-164F7AD2-EF3F-4541-98A3-5DE198D87550" class="sect3">About RMAN Backup Selection</h3>
<div>
<p><a id="d64788e856" class="indexterm-anchor"></a>RMAN uses the records of available backup sets or image copies in the RMAN repository to select the best available backups for use in the restore operation. The most recent backup available, or the most recent backup satisfying any <code class="codeph">UNTIL</code> clause specified in the <code class="codeph">RESTORE</code> command, is the preferred choice. If two backups are from the same point in time, then RMAN prefers image copies over backup sets because RMAN can restore more quickly from image copies than from backup sets (especially those stored on tape).</p>
<p>All specifications of the <code class="codeph">RESTORE</code> command must be satisfied before RMAN restores a backup. Unless limited by the <code class="codeph">DEVICE</code> <code class="codeph">TYPE</code> clause, the <code class="codeph">RESTORE</code> command searches for backups on all device types of configured channels. If no available backup in the repository satisfies all the specified criteria, then RMAN returns an error indicating that the file cannot be restored.</p>
<p>If you use only manually allocated channels, then a backup job may fail if there is no usable backup on the media for which you allocated channels. Configuring automatic channels makes it more likely that RMAN can find and restore a backup that satisfies the specified criteria.</p>
<p>If backup sets are protected with <a id="d64788e885" class="indexterm-anchor"></a><a id="d64788e887" class="indexterm-anchor"></a><a href="glossary.htm#GUID-65A13E9F-7391-4A6A-8379-B2EA64D0EA9E"><span class="xrefglossterm">backup encryption</span></a>, then RMAN automatically decrypts them when their contents are restored. Transparently encrypted backups require no intervention to restore, if the Oracle keystore is open and available. Password-encrypted backups require the correct password to be entered before they can be restored.</p>
<div class="infoboxnotealso" id="GUID-164F7AD2-EF3F-4541-98A3-5DE198D87550__GUID-78909369-4757-4D9E-889D-C6AA4E9B5F1F">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmconfa.htm#GUID-EF072AB8-AE89-4847-90B1-2214FD2336B3">Configuring Advanced Channel Options</a>&#34;</span></p>
</div>
</div>
</div>
<a id="BRADV30001"></a>
<div class="props_rev_3"><a id="GUID-D76CD1E8-2B9E-40F6-A13F-3264D6BA2B8C"></a>
<h3 id="BRADV-GUID-D76CD1E8-2B9E-40F6-A13F-3264D6BA2B8C" class="sect3">About RMAN Restore Failover</h3>
<div>
<p>RMAN automatically uses <a id="d64788e969" class="indexterm-anchor"></a><a href="glossary.htm#GUID-79973370-DFEB-4CF5-8076-020BDA87CCDB"><span class="xrefglossterm">restore failover</span></a> to skip corrupted or inaccessible backups and look for usable backups. When a backup is not found, or contains corrupt data, RMAN automatically looks for another backup from which to restore the desired files.</p>
<p>RMAN generates messages that indicate the type of failover that it is performing. For example, when RMAN fails over to another backup of the same file, it generates a message similar to the following:</p>
<pre dir="ltr">failover to piece handle=/u01/backup/db_1 tag=BACKUP_031009
</pre>
<p>If no usable copies are available, then RMAN searches for previous backups. The message generated is similar to the following example:</p>
<pre dir="ltr">ORA-19624: operation failed, retry possible
ORA-19505: failed to identify file &#34;/u01/backup/db_1&#34;
ORA-27037: unable to obtain file status
SVR4 Error: 2: No such file or directory
Additional information: 3
failover to previous backup
</pre>
<p>RMAN performs restore failover repeatedly until it has exhausted all possible backups. If all of the backups are unusable or no backups exists, then RMAN attempts to re-create the data file. Restore failover is also used when there are errors restoring archived redo logs during <code class="codeph">RECOVER</code>, <code class="codeph">RECOVER ... BLOCK</code>, and <code class="codeph">FLASHBACK DATABASE</code> commands.</p>
</div>
</div>
<a id="BRADV850"></a>
<div class="props_rev_3"><a id="GUID-1AE2D74F-250D-4D58-9025-3F47F494AC40"></a>
<h3 id="BRADV-GUID-1AE2D74F-250D-4D58-9025-3F47F494AC40" class="sect3">About RMAN Restore Operations and ASM</h3>
<div>
<p>When Automatic Storage Management (ASM) disk groups are used, an RMAN restore operation creates new copies of data files only if the full name of a data file, including the incarnation, does not match with the name of an existing data file. A fully qualified ASM file name is of the form <code class="codeph">+diskgroup/dbname/filetype/filetypetag.file.incarnation</code>. When you first restore the control file and then restore the other database files, the names of the data files in the control file may not match with the names of the existing data files and therefore the data files are recreated.</p>
<p>Use one of the following methods to ensure that existing data files are not recreated during a restore or duplicate operation:</p>
<ul style="list-style-type: disc;">
<li>
<p>In the control file, use alias names for each data file. The alias must not include the ASM incarnation number.</p>
</li>
<li>
<p>After restoring the control file and before restoring the other database files, use the <code class="codeph">CATALOG</code> command to ensure that the existing data files are cataloged in the restored control file. Next, use the <code class="codeph">SWITCH</code> command to make the restored control file point to the existing data files.</p>
</li>
<li>
<p>Use <code class="codeph">SET NEWNAME</code> to rename the data files before restoring the data files and after restoring the control file.</p>
</li>
</ul>
</div>
</div>
<a id="BRADV89710"></a>
<div class="props_rev_3"><a id="GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4"></a>
<h3 id="BRADV-GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4" class="sect3">About RMAN Restore Optimization</h3>
<div>
<p><a id="d64788e1158" class="indexterm-anchor"></a><a id="d64788e1162" class="indexterm-anchor"></a>RMAN uses <a href="glossary.htm#GUID-356F7553-3F98-48DD-B2C2-119BCE5C01DF"><span class="xrefglossterm">restore optimization</span></a> to avoid restoring data files from backup when possible. If a data file is present in the correct location and its header contains the expected information, then RMAN does not restore the data file from backup.</p>
<div class="infobox-note" id="GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4__GUID-E2108717-8DA3-41F9-A348-1F6827F14DE7">
<p class="notep1">Note:</p>
<p>Restore optimization only checks the data file header. It does not the scan the data file body for corrupted blocks.</p>
</div>
<p><a id="d64788e1173" class="indexterm-anchor"></a>You can use the <code class="codeph">FORCE</code> option of the <code class="codeph">RESTORE</code> command to override this behavior and restore the requested files unconditionally.</p>
<p>Restore optimization is particularly useful when an operation that restores several data files is interrupted. For example, assume that a full database restore encounters a power failure after all except one data file has been restored. If you run the same <code class="codeph">RESTORE</code> command again, then RMAN only restores the single data file that was not restored during the previous attempt.</p>
<p>Restore optimization is also used when duplicating a database. If a data file at the duplicate is in the correct place with the correct header contents, then the data file is not duplicated. Unlike <code class="codeph">RESTORE</code>, <code class="codeph">DUPLICATE</code> does not support a <code class="codeph">FORCE</code> option. To force RMAN to duplicate a data file that is skipped due to restore optimization, delete the data file from the duplicate before running the <code class="codeph">DUPLICATE</code> command.</p>
<div class="infoboxnotealso" id="GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4__GUID-EEB887D1-30F9-43C3-BC85-AEB345E82743">
<p class="notep1">See Also:</p>
<p><a class="olink RACAD059" target="_blank" href="../RACAD/GUID-A02120B2-BE62-4172-B402-BF034566E471.htm#RACAD059"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for description of <code class="codeph">RESTORE</code> behavior in an Oracle RAC configuration</p>
</div>
</div>
</div>
</div>
<a id="BRADV117"></a>
<div class="props_rev_3"><a id="GUID-76B772E9-9B69-4D86-8735-D9453A425017"></a>
<h2 id="BRADV-GUID-76B772E9-9B69-4D86-8735-D9453A425017" class="sect2">About RMAN Media Recovery</h2>
<div>
<p>In <a href="glossary.htm#GUID-5FEE9C7C-AD8F-4CFB-BAF2-E6B52EDC67AB"><span class="xrefglossterm">media recovery</span></a>, RMAN applies changes to restored data to roll forward this data in time. RMAN can perform either <a href="glossary.htm#GUID-01B3A956-DA97-4B47-9600-FA5549B7E868"><span class="xrefglossterm">data file media recovery</span></a> or <a href="glossary.htm#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">block media recovery</span></a>.</p>
<p>Data file media recovery is the application of redo logs or incremental backups to a restored data file to update it to the current time or some other specified time. <a id="d64788e1298" class="indexterm-anchor"></a>As explained in <a class="olink CNCPT031" target="_blank" href="../CNCPT/cncptdba.htm#CNCPT031"><span class="italic">Oracle Database Concepts</span></a>, you can use RMAN to perform <a href="glossary.htm#GUID-6486CE9C-3487-4B47-BDAF-EF5199D27E3A"><span class="xrefglossterm">complete recovery</span></a>, <a href="glossary.htm#GUID-FCC8BB91-79B6-4AF1-974A-43E75CD161E3"><span class="xrefglossterm">database point-in-time recovery (DBPITR)</span></a>, or <a href="glossary.htm#GUID-8A257409-B3DC-41FD-A2AF-D47560FF9F18"><span class="xrefglossterm">tablespace point-in-time recovery (TSPITR)</span></a>. <a id="d64788e1321" class="indexterm-anchor"></a><a id="d64788e1325" class="indexterm-anchor"></a><a id="d64788e1327" class="indexterm-anchor"></a><a id="d64788e1331" class="indexterm-anchor"></a>You can use the <code class="codeph">RESTORE</code> command to restore backups of lost and damaged data files or control files and the <code class="codeph">RECOVER</code> command to perform media recovery.<a id="d64788e1340" class="indexterm-anchor"></a></p>
<p>Block media recovery is the recovery of individual data blocks rather than entire data files. This section explains data file media recovery only. Block media recovery, which is a specialized form of media recovery, is explained in <span class="q">&#34;<a href="rcmblock.htm#GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216">Overview of Block Media Recovery</a>&#34;</span>.</p>
</div>
<a id="BRADV89711"></a>
<div class="props_rev_3"><a id="GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF"></a>
<h3 id="BRADV-GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF" class="sect3">About Selection of Incremental Backups and Archived Redo Logs</h3>
<div>
<p>RMAN automates media recovery. RMAN automatically restores and applies both incremental backups and archived redo logs in whatever combination is most efficient.<a id="d64788e1423" class="indexterm-anchor"></a><a id="d64788e1427" class="indexterm-anchor"></a></p>
<p>If the RMAN repository indicates that no copies of a required log sequence number exist on disk, then it automatically restores the required log from backup. By default, RMAN restores the archived logs to the fast recovery area, if an archiving destinations is set to <code class="codeph">USE_DB_RECOVERY_FILE_DEST</code>. Otherwise, RMAN restores the logs to the first local archiving destination specified in the initialization parameter file. <a id="d64788e1438" class="indexterm-anchor"></a></p>
<div class="infoboxnotealso" id="GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF__GUID-59AEC854-59F6-4D66-BD4A-7E91E46898D7">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF119" target="_blank" href="../RCMRF/rcmsynta014.htm#RCMRF119"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">CROSSCHECK</code> syntax</p>
</div>
</div>
</div>
<a id="BRADV1171"></a>
<div class="props_rev_3"><a id="GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D"></a>
<h3 id="BRADV-GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D" class="sect3">About Database Incarnations</h3>
<div>
<p><a id="d64788e1521" class="indexterm-anchor"></a>A database <a href="glossary.htm#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">incarnation</span></a> is created whenever you open the database with the <code class="codeph">RESETLOGS</code> option. After complete recovery, you can resume normal operations without an <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code>. After a DBPITR or recovery with a backup control file, however, you must open the database with the <code class="codeph">RESETLOGS</code> option, thereby creating a new incarnation of the database. The database requires a new incarnation to avoid confusion when two different redo streams have the same SCNs, but occurred at different times. If you apply the wrong redo to your database, then you corrupt it.</p>
<p>The existence of multiple incarnations of a single database determines how RMAN treats backups that are not in the current incarnation path. Usually, the current database incarnation is the correct one to use. Nevertheless, in some cases resetting the database to a previous incarnation is the best approach. For example, you may be dissatisfied with the results of a point-in-time recovery that you have performed and want to return the database to a time before the <code class="codeph">RESETLOGS</code>. An understanding of database incarnations is helpful to prepare for such situations.</p>
</div>
<a id="BRADV89712"></a>
<div class="props_rev_3"><a id="GUID-3DC071AD-5209-4F3D-98AA-6C0FA656D1B7"></a>
<h4 id="BRADV-GUID-3DC071AD-5209-4F3D-98AA-6C0FA656D1B7" class="sect4">About RMAN OPEN RESETLOGS Operations</h4>
<div>
<p><a id="d64788e1616" class="indexterm-anchor"></a>When you open the database with the <code class="codeph">RESETLOGS</code> option, the database performs the following actions:</p>
<ul style="list-style-type: disc;">
<li>
<p>Archives the current online redo logs (if they are accessible) and then erases the contents of the online redo logs and resets the log sequence number to 1.</p>
<p>For example, if the current online redo logs are sequence 1000 and 1001 when you open <code class="codeph">RESETLOGS</code>, then the database archives logs 1000 and 1001 and then resets the online redo logs to sequence 1 and 2.</p>
</li>
<li>
<p>Creates the online redo log files if they do not currently exist.</p>
</li>
<li>
<p>Initializes redo thread records and online redo log records in the control file to the beginning of the new database incarnation.</p>
<p>More specifically, the database sets the redo thread status to closed, sets the current thread sequence in the redo thread records to 1, sets the thread checkpoint of each redo thread to the beginning of log sequence 1, chooses one redo log from each thread and initialize its sequence to 1, and so on.</p>
</li>
<li>
<p><a id="d64788e1643" class="indexterm-anchor"></a>Updates all current data files and online redo logs and all subsequent archived redo logs with a new <code class="codeph">RESETLOGS</code> <code class="codeph">SCN</code> and time stamp.</p>
</li>
</ul>
<p>Because the database does not apply an archived redo log to a data file unless the <code class="codeph">RESETLOGS</code> <code class="codeph">SCN</code> and time stamps match, the <code class="codeph">RESETLOGS</code> requirement prevents you from corrupting data files with archived logs that are not from direct parent incarnations of the current incarnation. The relationship among incarnations is explained more fully in the following section.</p>
<p>In previous releases, it was recommended that you back up the database immediately after the <code class="codeph">OPEN RESETLOGS</code>. Because you can now easily recover a pre-<code class="codeph">RESETLOGS</code> backup like any other backup, making a new database backup is optional. To perform recovery through <code class="codeph">RESETLOGS</code> you must have all archived logs generated after the most recent backup and at least one control file (current, backup, or created).</p>
</div>
</div>
<a id="BRADV326"></a><a id="BRADV99974"></a>
<div class="props_rev_3"><a id="GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C"></a>
<h4 id="BRADV-GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C" class="sect4">Relationship Among Database Incarnations</h4>
<div>
<p>Database incarnations can stand in the following relationships to each other:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <a href="glossary.htm#GUID-4CC16BA6-2C59-4202-AEBB-3518F45BFD56"><span class="xrefglossterm">current incarnation</span></a> is the one in which the database is currently operating.</p>
</li>
<li>
<p>The incarnation from which the current incarnation branched following an <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code> operation is the <a href="glossary.htm#GUID-6DFC5F78-79E6-480B-9E29-B20876535B78"><span class="xrefglossterm">parent incarnation</span></a> of the current incarnation.</p>
</li>
<li>
<p>The parent of the parent incarnation is an <a href="glossary.htm#GUID-853064EA-D07A-43C2-B27A-1E41928D43A7"><span class="xrefglossterm">ancestor incarnation</span></a>. Any parent of an ancestor incarnation is also an ancestor of the current incarnation.</p>
</li>
<li>
<p>The <a id="d64788e1778" class="indexterm-anchor"></a><a href="glossary.htm#GUID-9FA6E4CA-C9C0-47E8-8FDF-2C2A313F8944"><span class="xrefglossterm">direct ancestral path</span></a> of the current incarnation begins with the earliest incarnation and includes only the branches to an ancestor of the current incarnation, the parent incarnation, or the current incarnation.</p>
</li>
</ul>
<p>An incarnation number is used to uniquely tag and identify a stream of redo. <a href="rcmrvcon.htm#GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">Figure 14-1</a> illustrates a database that goes through several incarnations, each with a different incarnation number.</p>
<div class="figure" id="GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">
<p class="titleinfigure">Figure 14-1 Database Incarnation History</p>
<img width="624" height="378" src="img/GUID-175E7B6E-6FEE-4AEA-BF6A-79EC55416D48-default.gif" alt="Description of Figure 14-1 follows" title="Description of Figure 14-1 follows"/><br/>
<a href="img_text/GUID-175E7B6E-6FEE-4AEA-BF6A-79EC55416D48-print.htm">Description of &#34;Figure 14-1 Database Incarnation History&#34;</a></div>
<!-- class="figure" -->
<p>Incarnation 1 of the database starts at SCN 1 and continues through SCN 1000 to SCN 2000. Suppose that at SCN 2000 in incarnation 1, you perform a point-in-time recovery back to SCN 1000, and then open the database with the <code class="codeph">RESETLOGS</code> option. Incarnation 2 now begins at SCN 1000 and continues to SCN 3000. In this example, incarnation 1 is the parent of incarnation 2.</p>
<p>Suppose that at SCN 3000 in incarnation 2, you perform a point-in-time recovery to SCN 2000 and open the database with the <code class="codeph">RESETLOGS</code> option. In this case, incarnation 2 is the parent of incarnation 3. Incarnation 1 is an ancestor of incarnation 3.</p>
<p>When DBPITR or Flashback Database has occurred in database, an SCN can refer to multiple points in time, depending on which incarnation is current. For example, SCN 1500 in <a href="rcmrvcon.htm#GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">Figure 14-1</a> could refer to an SCN in incarnation 1 or 2.</p>
<p>You can use the <code class="codeph">RESET</code> <code class="codeph">DATABASE</code> <code class="codeph">TO</code> <code class="codeph">INCARNATION</code> command to specify that SCNs are to be interpreted in the frame of reference of a specific database incarnation. The <code class="codeph">RESET DATABASE TO INCARNATION</code> command is required when you use <code class="codeph">FLASHBACK</code>, <code class="codeph">RESTORE</code>, or <code class="codeph">RECOVER</code> to return to an SCN in a noncurrent database incarnation. However, RMAN executes the <code class="codeph">RESET DATABASE TO INCARNATION</code> command implicitly with Flashback, as explained in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-304B2237-0921-422F-A084-D83E7B5C8D2B">Resetting the Database Incarnation in the Recovery Catalog</a>&#34;</span>.</p>
<div class="infoboxnotealso" id="GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__GUID-E295537F-7A2D-4B82-B057-B1F466123BDC">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmflash.htm#GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6">Recovering the Database to an Ancestor Incarnation</a>&#34;</span></p>
</li>
<li>
<p><a class="olink RCMRF148" target="_blank" href="../RCMRF/rcmsynta2007.htm#RCMRF148"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details about the <code class="codeph">RESET</code> <code class="codeph">DATABASE</code> command</p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV679"></a>
<div class="props_rev_3"><a id="GUID-195FE6CA-9CEB-4ED1-9810-F7323F119D87"></a>
<h4 id="BRADV-GUID-195FE6CA-9CEB-4ED1-9810-F7323F119D87" class="sect4">About Incarnations of PDBs</h4>
<div>
<p>A pluggable database (<a href="glossary.htm#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>) incarnation is a subincarnation of the <a href="glossary.htm#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">multitenant container database (CDB)</span></a> and is expressed as <code class="codeph">(</code><span class="italic"><code class="codeph">database_incarnation, pdb_incarnation</code></span><code class="codeph">)</code>. For example, if the CDB is incarnation <code class="codeph">5</code>, and a PDB is incarnation <code class="codeph">3</code>, then the fully specified incarnation number of the PDB is <code class="codeph">(5, 3)</code>. The initial incarnation of a PDB is 0. Subsequent incarnations are unique but not always sequential numbers.</p>
<p>The <code class="codeph">V$PDB_INCARNATION</code> view contains information about all PDB incarnations. Use the following query to display the current incarnation of a PDB:</p>
<pre dir="ltr">select PDB_INCARNATION# from v$pdb_incarnation where STATUS = &#39;CURRENT&#39; 
   and CON_ID = <span class="italic">PDB_container_id</span>;
</pre></div>
</div>
<a id="BRADV89713"></a>
<div class="props_rev_3"><a id="GUID-8D278206-A634-422C-BA3B-3D4DD09B6B26"></a>
<h4 id="BRADV-GUID-8D278206-A634-422C-BA3B-3D4DD09B6B26" class="sect4">About Orphaned Backups</h4>
<div>
<p>When a database goes through multiple incarnations, some backups can become <a id="d64788e2040" class="indexterm-anchor"></a><a id="d64788e2042" class="indexterm-anchor"></a><a href="glossary.htm#GUID-E8AA16F2-7DBA-40E4-9C42-987B20208E96"><span class="xrefglossterm">orphaned backups</span></a>. Orphaned backups are backups created during incarnations of the database that are not in the direct ancestral path.</p>
<p>Assume the scenario shown in <a href="rcmrvcon.htm#GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">Figure 14-1</a>. If incarnation 3 is the current incarnation, then the following backups are orphaned:</p>
<ul style="list-style-type: disc;">
<li>
<p>All backups from incarnation 1 after SCN 1000</p>
</li>
<li>
<p>All backups from incarnation 2 after SCN 2000</p>
</li>
</ul>
<p>In contrast, the following backups are not orphaned because they are in the direct ancestral path:</p>
<ul style="list-style-type: disc;">
<li>
<p>All backups from incarnation 1 before SCN 1000</p>
</li>
<li>
<p>All backups from incarnation 2 before SCN 2000</p>
</li>
<li>
<p>All backups from incarnation 3</p>
</li>
</ul>
<p>You can use orphaned backups when you intend to restore the database to an SCN not in the direct ancestral path. RMAN can restore backups from parent and ancestor incarnations and recover to the current time, even across <code class="codeph">OPEN RESETLOGS</code> operations, if a continuous path of archived logs exists from the earliest backups to the point to which you want to recover. If you restore a control file from an incarnation in which the changes represented in the backups had not been abandoned, then RMAN can also restore and recover orphaned backups.</p>
</div>
</div>
<a id="BRADV742"></a>
<div class="props_rev_3"><a id="GUID-21E646E6-CE3C-4C07-BD03-3904D30AD509"></a>
<h4 id="BRADV-GUID-21E646E6-CE3C-4C07-BD03-3904D30AD509" class="sect4">About Orphaned PDB Backups</h4>
<div>
<p>After recovering a PDB to a specified point-in-time, when you open the PDB using the <code class="codeph">RESETLOGS</code> option, a new incarnation of the PDB is created. Orphan PDB backups are backups that were created when the SCN or time value was between the SCN or time to which the PDB was recovered and the SCN or time at which the PDB was opened in <code class="codeph">RESETLOGS</code> mode. The <code class="codeph">END_RESETLOGS_SCN</code> column of the <code class="codeph">V$PDB_INCARNATION</code> view contains the SCN at which the PDB is opened in <code class="codeph">RESETLOGS</code> mode.</p>
</div>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="part_dia.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="rcmrepai.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>