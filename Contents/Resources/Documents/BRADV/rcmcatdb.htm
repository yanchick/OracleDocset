<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2664"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Managing%20a%20Recovery%20Catalog"></a><title>Managing a Recovery Catalog</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="Recovery Manager, recovery catalog, stored scripts, deleting, commands, Recovery Manager, LIST, INCARNATION option, LIST command, RESET DATABASE, RESET DATABASE command"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rcmmaint.htm" title="Previous" type="text/html"/>
<link rel="Next" href="part_dia.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-E836E243-6620-495B-ACFB-AC0001EF4E89"></a> <span id="PAGE" style="display:none;">24/48</span> <!-- End Header -->
<a id="BRADV8015"></a>
<h1 id="BRADV-GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" class="sect1"><span class="enumeration_chapter">13</span> Managing a Recovery Catalog</h1>
<div>
<p><a id="d57370e67" class="indexterm-anchor"></a>This <a id="d57370e72" class="indexterm-anchor"></a>chapter explains how to manage an RMAN recovery catalog. The catalog is a database schema that contains the RMAN repository data for one or more target databases. This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-2491887B-D9AC-48BE-914D-CB0341A77057">Overview of the RMAN Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8">Creating a Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC">Registering a Database in the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51">Cataloging Backups in the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-B3238BE0-F52D-4773-A277-D3627AE28D57">Creating and Managing Virtual Private Catalogs</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-6F052177-3BEE-44DD-9136-0A576EF3F010">Protecting the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-14E5B168-8033-4831-A02A-6003212988D7">Managing Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319">Maintaining a Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-F9345920-0731-40FA-B44A-CE8F50E09B40">Dropping a Recovery Catalog</a></p>
<div class="infoboxnotealso" id="GUID-E836E243-6620-495B-ACFB-AC0001EF4E89__GUID-97E25EA3-B4CA-4E27-B942-3430824DA02B">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmmaint.htm#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="You can delete backups and recovery catalog records for backups.">Maintaining RMAN Backups and Repository&nbsp;Records</a>to learn how to manage the RMAN repository as stored in the control file, without a recovery catalog</p>
</li>
<li>
<p>The compatibility matrix in <a class="olink RCMRF005" target="_blank" href="../RCMRF/compat.htm#RCMRF005"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for descriptions of supported interoperability scenarios</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<a id="BRADV89642"></a>
<div class="props_rev_3"><a id="GUID-2491887B-D9AC-48BE-914D-CB0341A77057"></a>
<h2 id="BRADV-GUID-2491887B-D9AC-48BE-914D-CB0341A77057" class="sect2">Overview of the RMAN Recovery Catalog</h2>
<div>
<p>This section explains the basic concepts related to managing a recovery catalog.</p>
</div>
<a id="BRADV89643"></a>
<div class="props_rev_3"><a id="GUID-D3E1D038-8698-4ACD-A58D-5260F271116A"></a>
<h3 id="BRADV-GUID-D3E1D038-8698-4ACD-A58D-5260F271116A" class="sect3">Purpose of the RMAN Recovery Catalog</h3>
<div>
<p><a id="d57370e287" class="indexterm-anchor"></a>A <a href="glossary.htm#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">recovery catalog</span></a> is a database schema used by RMAN to store metadata about one or more Oracle databases. Typically, you store the catalog in a dedicated database. A recovery catalog provides the following benefits:</p>
<ul style="list-style-type: disc;">
<li>
<p>A recovery catalog creates redundancy for the RMAN repository stored in the control file of each <a href="glossary.htm#GUID-272C4366-303F-4629-9679-1379AAC3FBC1"><span class="xrefglossterm">target database</span></a>. The recovery catalog serves as a secondary metadata repository. If the target control file and all backups are lost, then the RMAN metadata still exists in the recovery catalog.</p>
</li>
<li>
<p>A recovery catalog centralizes metadata for all your target databases. Storing the metadata in a single place makes reporting and administration tasks easier to perform.</p>
</li>
<li>
<p>A recovery catalog can store metadata history much longer than the control file. This capability is useful if you must do a recovery that goes further back in time than the history in the control file. The added complexity of managing a recovery catalog database can be offset by the convenience of having the extended backup history available.</p>
</li>
</ul>
<p>Some RMAN features function only when you use a recovery catalog. For example, you can store RMAN scripts in a recovery catalog. The chief advantage of a <a href="glossary.htm#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">stored script</span></a> is that it is available to any RMAN client that can connect to the target database and recovery catalog. Command files are only available if the RMAN client has access to the file system on which they are stored.</p>
<p>A recovery catalog is required when you use RMAN in a Data Guard environment. By storing backup metadata for all primary and standby databases, the catalog enables you to offload backup tasks to one standby database while enabling you to restore backups on other databases in the environment.</p>
</div>
</div>
<a id="BRADV89644"></a>
<div class="props_rev_3"><a id="GUID-D7962D13-1E91-4945-AF2B-9B0CE9A695F5"></a>
<h3 id="BRADV-GUID-D7962D13-1E91-4945-AF2B-9B0CE9A695F5" class="sect3">Basic Concepts for the RMAN Recovery Catalog</h3>
<div>
<p>The recovery catalog contains metadata about RMAN operations for each registered target database. When RMAN is connected to a recovery catalog, RMAN obtains its metadata exclusively from the catalog. The catalog includes the following types of metadata:</p>
<ul style="list-style-type: disc;">
<li>
<p>Data file and archived redo log backup sets and backup pieces</p>
</li>
<li>
<p>Data file copies</p>
</li>
<li>
<p>Archived redo logs and their copies</p>
</li>
<li>
<p>Database structure (tablespaces and data files)</p>
</li>
<li>
<p>Stored scripts, which are named user-created sequences of RMAN commands</p>
</li>
<li>
<p>Persistent RMAN configuration settings</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-D7962D13-1E91-4945-AF2B-9B0CE9A695F5__GUID-054EC601-AF76-4FBC-A7E5-0629A0D899E4">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-A61B4DA7-1F25-409B-83E4-003FD1073229">About Database Registration in an RMAN Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-01A0558C-84E1-47C3-96C0-ADC014577D23">About Centralization of Metadata in a Base RMAN Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-8DD30C7C-6157-407C-A398-0905BBBEB348">About RMAN Recovery Catalog Resynchronization</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4">About Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0">Recovery Catalog in a Data Guard Environment</a></p>
</li>
</ul>
</div>
</div>
<a id="BRADV90081"></a>
<div class="props_rev_3"><a id="GUID-A61B4DA7-1F25-409B-83E4-003FD1073229"></a>
<h4 id="BRADV-GUID-A61B4DA7-1F25-409B-83E4-003FD1073229" class="sect4">About Database Registration in an RMAN Recovery Catalog</h4>
<div>
<p><a id="d57370e503" class="indexterm-anchor"></a><a id="d57370e509" class="indexterm-anchor"></a>The process of enrolling of a database in a recovery catalog for RMAN use is called <a href="glossary.htm#GUID-A7DDB252-1053-4BD7-9F6A-CD5639E5451D"><span class="xrefglossterm">registration</span></a>. The recommended practice is to register every <a href="glossary.htm#GUID-272C4366-303F-4629-9679-1379AAC3FBC1"><span class="xrefglossterm">target database</span></a> in your environment in a single recovery catalog. <a id="d57370e522" class="indexterm-anchor"></a><a id="d57370e526" class="indexterm-anchor"></a>For example, you can register databases <code class="codeph">prod1</code>, <code class="codeph">prod2</code>, and <code class="codeph">prod3</code> in a single catalog owned by <code class="codeph">rco</code> in the database <code class="codeph">catdb</code>.</p>
<div class="infoboxnotealso" id="GUID-A61B4DA7-1F25-409B-83E4-003FD1073229__GUID-F49C7E7D-EA80-4E94-9718-E9382FC9361A">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC">Registering a Database in the Recovery Catalog</a>&#34;</span></p>
</div>
</div>
</div>
<a id="BRADV90082"></a>
<div class="props_rev_3"><a id="GUID-01A0558C-84E1-47C3-96C0-ADC014577D23"></a>
<h4 id="BRADV-GUID-01A0558C-84E1-47C3-96C0-ADC014577D23" class="sect4">About Centralization of Metadata in a Base RMAN Recovery Catalog</h4>
<div>
<p><a id="d57370e622" class="indexterm-anchor"></a>The owner of a centralized recovery catalog, which is also called the <a href="glossary.htm#GUID-4561ED89-3445-4AFE-8F48-4220C0C0044A"><span class="xrefglossterm">base recovery catalog</span></a>, can grant or revoke restricted access to the catalog to other database users. Each restricted user has full read/write access to his own metadata, which is called a <a href="glossary.htm#GUID-3ACE1C6A-AEA0-4F3A-973B-2308E0A5AD4B"><span class="xrefglossterm">virtual private catalog</span></a>. The RMAN metadata is stored in the schema of the virtual private catalog owner. The owner of the base recovery catalog determines which objects each virtual private catalog user can access.</p>
<p>You can use a recovery catalog in an environment in which you use or have used different versions of Oracle Database. As a result, your environment can have different versions of the RMAN client, recovery catalog database, recovery catalog schema, and target database. <span class="q">&#34;<a href="rcmcatdb.htm#GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C">Importing and Moving a Recovery Catalog</a>&#34;</span> explains how to merge multiple recovery catalog schemas into one.</p>
<div class="infoboxnotealso" id="GUID-01A0558C-84E1-47C3-96C0-ADC014577D23__GUID-5893BF12-6FEA-4B43-A999-587D409AD750">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-B3238BE0-F52D-4773-A277-D3627AE28D57">Creating and Managing Virtual Private Catalogs</a>&#34;</span></p>
</div>
</div>
</div>
<a id="BRADV90083"></a>
<div class="props_rev_3"><a id="GUID-8DD30C7C-6157-407C-A398-0905BBBEB348"></a>
<h4 id="BRADV-GUID-8DD30C7C-6157-407C-A398-0905BBBEB348" class="sect4">About RMAN Recovery Catalog Resynchronization</h4>
<div>
<p>For RMAN operations such as backup, restore, and crosscheck, RMAN always first updates the control file and then propagates the metadata to the recovery catalog. This flow of metadata from the mounted control file to the recovery catalog, which is known as recovery catalog <a href="glossary.htm#GUID-390A74EF-CD69-4173-B810-23EE2A5BB0EF"><span class="xrefglossterm">resynchronization</span></a>, ensures that the metadata that RMAN obtains from the control file is current.</p>
<div class="infoboxnotealso" id="GUID-8DD30C7C-6157-407C-A398-0905BBBEB348__GUID-A3763D9D-4936-4D07-9D7D-40692EA8EBCE">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-87642B50-AF67-482E-A93D-291B8D2EED92">Resynchronizing the Recovery Catalog</a>&#34;</span></p>
</div>
</div>
</div>
<a id="BRADV90084"></a>
<div class="props_rev_3"><a id="GUID-EAC1C023-2CD7-4397-81C7-3B5EFAA46128"></a>
<h4 id="BRADV-GUID-EAC1C023-2CD7-4397-81C7-3B5EFAA46128" class="sect4">About Stored Scripts</h4>
<div>
<p>You can use a <a href="glossary.htm#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">stored script</span></a> as an alternative to a command file for managing frequently used sequences of RMAN commands.<a id="d57370e803" class="indexterm-anchor"></a><a id="d57370e805" class="indexterm-anchor"></a> The script is stored in the recovery catalog rather than on the file system.</p>
<p>A local stored script is associated with the target database to which RMAN is connected when the script is created, and can only be executed when you are connected to this target database. A global stored script can be run against any database registered in the recovery catalog. A virtual private catalog user has read-only access to global scripts. Creating or updating global scripts must be done while connected to the base recovery catalog.</p>
<div class="infoboxnotealso" id="GUID-EAC1C023-2CD7-4397-81C7-3B5EFAA46128__GUID-F94AFF40-46EA-4F7F-A755-CF5D7C28AE2E">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-14E5B168-8033-4831-A02A-6003212988D7">Managing Stored Scripts</a>&#34;</span></p>
</div>
</div>
</div>
<a id="BRADV89645"></a>
<div class="props_rev_3"><a id="GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0"></a>
<h4 id="BRADV-GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0" class="sect4">Recovery Catalog in a Data Guard Environment</h4>
<div>
<p>As explained in <span class="q">&#34;<a href="rcmarchi.htm#GUID-B18B15EA-1F59-4858-B6E9-9870A564CD62">About RMAN in a Data Guard Environment</a>&#34;</span>, you must use a recovery catalog to manage RMAN metadata for all physical databases, both primary and standby databases, in the Data Guard environment. RMAN uses the recovery catalog as the single source of truth for the Data Guard environment.</p>
<p>RMAN can use the recovery catalog to update a primary or standby control file in a <a href="glossary.htm#GUID-52C89ABD-D7C1-4FE1-9825-BCBF1973B156"><span class="xrefglossterm">reverse resynchronization</span></a>. In this case, the metadata flows from the catalog to the control file rather than the other way around. RMAN automatically performs resynchronizations in most situations in which they are needed. Thus, you do not need to use the <code class="codeph">RESYNC</code> command to manually resynchronize very often.</p>
<div class="infoboxnotealso" id="GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0__GUID-C76F946E-810A-47C9-8240-75AEBBCCFE4F">
<p class="notep1">See Also:</p>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to configure the RMAN environment for use with a standby database</p>
</div>
</div>
</div>
</div>
<a id="BRADV89646"></a>
<div class="props_rev_3"><a id="GUID-24324A68-4C0E-45D9-9961-CF82B4CA7C63"></a>
<h3 id="BRADV-GUID-24324A68-4C0E-45D9-9961-CF82B4CA7C63" class="sect3">Basic Steps of Managing a Recovery Catalog</h3>
<div>
<div class="section">
<p>The basic steps for setting up a recovery catalog for use by RMAN are as follows:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Create the recovery catalog.</span>
<div>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8">Creating a Recovery Catalog</a>&#34;</span> explains how to perform this task.</p>
</div>
</li>
<li class="stepexpand"><span>Register your target databases in the recovery catalog.</span>
<div>
<p>This step enables RMAN to store metadata for the target databases in the recovery catalog. <span class="q">&#34;<a href="rcmcatdb.htm#GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC">Registering a Database in the Recovery Catalog</a>&#34;</span> explains this task.</p>
</div>
</li>
<li class="stepexpand"><span>If needed, catalog any older backups whose records are no longer stored in the target control file.</span>
<div>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51">Cataloging Backups in the Recovery Catalog</a>&#34;</span> explains how to perform this task.</p>
</div>
</li>
<li class="stepexpand"><span>If needed, create virtual private catalogs for specific users and determine the metadata to which they are permitted access.</span>
<div>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-B3238BE0-F52D-4773-A277-D3627AE28D57">Creating and Managing Virtual Private Catalogs</a>&#34;</span> explains how to perform this task.</p>
</div>
</li>
<li class="stepexpand"><span>Protect the recovery catalog by including it in your backup and recovery strategy.</span>
<div>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-6F052177-3BEE-44DD-9136-0A576EF3F010">Protecting the Recovery Catalog</a>&#34;</span> explains how to back up and recover the catalog, and increase its availability.</p>
</div>
</li>
</ol>
<div class="section">
<p>The remainder of the chapter explains how to manage the recovery catalog after it is operational. You can perform the following tasks:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-14E5B168-8033-4831-A02A-6003212988D7">Managing Stored Scripts</a>&#34;</span> explains how to store RMAN scripts in the recovery catalog and manage them.</p>
</li>
<li>
<p><a href="rcmreprt.htm#GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" title="The primary purpose of the LIST command is to list backup and copies. The REPORT command provides various reports of RMAN backups.">Reporting on RMAN Operations</a> explains how to report on RMAN operations. You can use the <code class="codeph">LIST</code> and <code class="codeph">REPORT</code> commands with or without a recovery catalog. <span class="q">&#34;<a href="rcmreprt.htm#GUID-C48F1F48-E11D-4DA4-AB54-6D7EB4CA8957">Querying Recovery Catalog Views</a>&#34;</span> explains how to report on RMAN operations using fixed views in the recovery catalog.</p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319">Maintaining a Recovery Catalog</a>&#34;</span> explains a variety of tasks for ongoing recovery catalog maintenance, including how to import one recovery catalog into another recovery catalog.</p>
</li>
</ul>
<p>If you no longer want to maintain a recovery catalog, then see <span class="q">&#34;<a href="rcmcatdb.htm#GUID-F9345920-0731-40FA-B44A-CE8F50E09B40">Dropping a Recovery Catalog</a>&#34;</span>.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV179"></a>
<div class="props_rev_3"><a id="GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8"></a>
<h2 id="BRADV-GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8" class="sect2">Creating a Recovery Catalog</h2>
<div>
<p>This section explains the phases of recovery catalog creation. This section contains the following topics:<a id="d57370e1154" class="indexterm-anchor"></a></p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430">Configuring the Recovery Catalog Database</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2">Creating the Recovery Catalog Schema Owner</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B">Executing the CREATE CATALOG Command</a></p>
</li>
</ul>
</div>
<a id="BRADV89647"></a>
<div class="props_rev_3"><a id="GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430"></a>
<h3 id="BRADV-GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430" class="sect3">Configuring the Recovery Catalog Database</h3>
<div>
<p>When you use a recovery catalog, RMAN requires that you maintain a recovery catalog schema. The recovery catalog is stored in the default tablespace of the schema. Privileged users such as <code class="codeph">SYS</code> cannot be the owner of the recovery catalog.</p>
<p>Decide which database you will use to install the recovery catalog schema, and also how you will back up this database. Also, decide whether to operate the catalog database in <code class="codeph">ARCHIVELOG</code> mode, which is recommended.</p>
<div class="infobox-note" id="GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430__GUID-C082B5A5-02F8-4775-8721-8CA434592A19">
<p class="notep1">Note:</p>
<p>Do not use the target database to be backed up as the database for the recovery catalog. The recovery catalog must be protected if the target database is lost.</p>
</div>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-FC223E07-1298-42AC-8D07-36D2BB893B10">Planning the Size of the Recovery Catalog Schema</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5">Allocating Disk Space for the Recovery Catalog Database</a></p>
</li>
</ul>
</div>
<a id="BRADV89648"></a>
<div class="props_rev_3"><a id="GUID-FC223E07-1298-42AC-8D07-36D2BB893B10"></a>
<h4 id="BRADV-GUID-FC223E07-1298-42AC-8D07-36D2BB893B10" class="sect4">Planning the Size of the Recovery Catalog Schema</h4>
<div>
<p>You must allocate space to be used by the catalog schema. The size of the recovery catalog schema depends upon the number of databases monitored by the catalog. The schema also grows as the number of archived redo log files and backups for each database increases. Finally, if you use RMAN stored scripts stored in the catalog, some space must be allocated for those scripts.</p>
<p>For example, assume that the <code class="codeph">trgt</code> database has 100 files, and that you back up the database once a day, producing 50 backup sets containing 1 backup piece each. If you assume that each row in the backup piece table uses the maximum amount of space, then one daily backup consumes less than 170 kilobytes in the recovery catalog. So, if you back up once a day for a year, then the total storage in this period is about 62 megabytes. Assume approximately the same amount for archived logs. Thus, the worst case is about 120 megabytes for a year for metadata storage. For a more typical case in which only a portion of the backup piece row space is used, 15 MB for each year is realistic.</p>
<p>If you plan to register multiple databases in your recovery catalog, then remember to add up the space required for each one based on the previous calculation to arrive at a total size for the default tablespace of the recovery catalog schema.</p>
</div>
</div>
<a id="BRADV302"></a><a id="BRADV89649"></a>
<div class="props_rev_3"><a id="GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5"></a>
<h4 id="BRADV-GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5" class="sect4">Allocating Disk Space for the Recovery Catalog Database</h4>
<div>
<p>If you are creating your recovery catalog in an existing database, then add enough room to hold the default tablespace for the recovery catalog schema. If you are creating a new database to hold your recovery catalog, then in addition to the space for the recovery catalog schema itself, allow space for other files in the recovery catalog database:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">SYSTEM</code> and <code class="codeph">SYSAUX</code> tablespaces</p>
</li>
<li>
<p>Temporary tablespaces</p>
</li>
<li>
<p>Undo tablespaces</p>
</li>
<li>
<p>Online redo log files</p>
</li>
</ul>
<p><a id="d57370e1435" class="indexterm-anchor"></a>Most of the space used in the recovery catalog database is devoted to supporting tablespaces, for example, the <code class="codeph">SYSTEM</code>, temporary, and undo tablespaces. <a href="rcmcatdb.htm#GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5__BGBDIJAJ" title="This table describes typical recovery catalog space requirements for one year.">Table 13-1</a> describes typical space requirements.</p>
<div class="tblformal" id="GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5__BGBDIJAJ">
<p class="titleintable">Table 13-1 Typical Recovery Catalog Space Requirements for 1 Year</p>
<table class="cellalignment515" title="Typical Recovery Catalog Space Requirements for 1 Year" summary="This table describes typical recovery catalog space requirements for one year.">
<thead>
<tr class="cellalignment501">
<th class="cellalignment537" id="d57370e1458">Type of Space</th>
<th class="cellalignment538" id="d57370e1461">Space Requirement</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment539" id="d57370e1466" headers="d57370e1458">
<p><code class="codeph">SYSTEM</code> tablespace</p>
</td>
<td class="cellalignment540" headers="d57370e1466 d57370e1461">
<p>90 MB</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment539" id="d57370e1475" headers="d57370e1458">
<p>Temp tablespace</p>
</td>
<td class="cellalignment540" headers="d57370e1475 d57370e1461">
<p>5 MB</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment539" id="d57370e1482" headers="d57370e1458">
<p>Rollback or undo tablespace</p>
</td>
<td class="cellalignment540" headers="d57370e1482 d57370e1461">
<p>5 MB</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment539" id="d57370e1489" headers="d57370e1458">
<p>Recovery catalog tablespace</p>
</td>
<td class="cellalignment540" headers="d57370e1489 d57370e1461">
<p>15 MB for each database registered in the recovery catalog</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment539" id="d57370e1496" headers="d57370e1458">
<p>Online redo logs</p>
</td>
<td class="cellalignment540" headers="d57370e1496 d57370e1461">
<p>1 MB each (three groups, each with two members)</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infobox-note" id="GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5__GUID-10641058-0774-4263-B71C-8E80071FD5EF">
<p class="notep1">Caution:</p>
<p>Ensure that the recovery catalog and target databases do <span class="italic">not</span> reside on the same disk. If both your recovery catalog and your target database suffer hard disk failure, then your recovery process is much more difficult. If possible, take other measures as well to eliminate common points of failure between your recovery catalog database and the databases that you are backing up.</p>
</div>
</div>
</div>
</div>
<a id="BRADV303"></a><a id="BRADV89650"></a>
<div class="props_rev_3"><a id="GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2"></a>
<h3 id="BRADV-GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2" class="sect3">Creating the Recovery Catalog Schema Owner</h3>
<div>
<div class="section">
<p>After choosing the recovery catalog database and creating the necessary space, you are ready to create the owner of the recovery catalog and grant this user necessary privileges. Assume the following background information for the instructions in the following sections:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>User <code class="codeph">SBU</code> has <code class="codeph">SYSBACKUP</code> privilege on the recovery catalog database <code class="codeph">catdb</code>.</p>
</li>
<li>
<p>A tablespace called <code class="codeph">TOOLS</code> in the recovery catalog database <code class="codeph">CATDB</code> stores the recovery catalog. If you use an RMAN reserved word as a tablespace name, you must enclose it in quotes and put it in uppercase.</p>
<div class="infoboxnotealso" id="GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2__GUID-10A4F440-F5E4-474E-8BD3-A4B963DC467F">
<p class="notep1">See Also:</p>
<p>See <a class="olink RCMRF909" target="_blank" href="../RCMRF/rcmcomma.htm#RCMRF909"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for a list of RMAN reserved words</p>
</div>
</li>
<li>
<p>A tablespace called <code class="codeph">TEMP</code> exists in the recovery catalog database.</p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create the recovery catalog schema in the recovery catalog database:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect with administrator privileges to the database containing the recovery catalog. In this example, the database is <code class="codeph">catdb</code>.</span></li>
<li class="stepexpand"><span>Create a user and schema for the recovery catalog. For example, you could enter the following SQL statement (replacing <span class="italic">password</span> with a user-defined password):</span>
<div>
<pre dir="ltr">CREATE USER rco IDENTIFIED BY <span class="italic">password</span>
  TEMPORARY TABLESPACE temp 
  DEFAULT TABLESPACE tools 
  QUOTA UNLIMITED ON tools;
</pre>
<div class="infobox-note" id="GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2__GUID-6DD20102-7F10-4FC8-9A9F-1FB891E698CD">
<p class="notep1">Note:</p>
<p>Create a password that is secure. See <a class="olink DBSEG33223" target="_blank" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for more information.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Grant the <code class="codeph">RECOVERY_CATALOG_OWNER</code> role to the schema owner. This role provides the user with all privileges required to maintain and query the recovery catalog.</span>
<div>
<pre dir="ltr">GRANT RECOVERY_CATALOG_OWNER TO rco;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV304"></a><a id="BRADV89651"></a>
<div class="props_rev_3"><a id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B"></a>
<h3 id="BRADV-GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B" class="sect3">Executing the CREATE CATALOG Command</h3>
<div>
<div class="section">
<p><a id="d57370e1728" class="indexterm-anchor"></a><a id="d57370e1730" class="indexterm-anchor"></a>After creating the catalog owner, create the catalog tables with the RMAN <code class="codeph">CREATE</code> <code class="codeph">CATALOG</code> command. The command creates the catalog in the default tablespace of the catalog owner.</p>
<div class="infobox-note" id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B__GUID-AE9BBD77-DB05-4D57-96B5-C24A31D61976">
<p class="notep1">Note:</p>
Starting with Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), the recovery catalog database must use the Enterprise Edition of Oracle Database.</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create the recovery catalog:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Enable Oracle Partitioning for the recovery catalog database.</span></li>
<li class="stepexpand"><span>Start RMAN and connect to the database that will contain the catalog. Connect to the database as the recovery catalog owner.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">CREATE</code> <code class="codeph">CATALOG</code> command to create the catalog. The creation of the catalog can take several minutes. If the catalog tablespace is this user&#39;s default tablespace, then you can run the following command:</span>
<div>
<pre dir="ltr">RMAN&gt; CREATE CATALOG;
</pre>
<p>You can specify the tablespace name for the catalog in the <code class="codeph">CREATE</code> <code class="codeph">CATALOG</code> command. For example:</p>
<pre dir="ltr">RMAN&gt; CREATE CATALOG TABLESPACE cat_tbs;
</pre>
<div class="infobox-note" id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B__GUID-76BC93A2-87D5-4C11-AB0C-90D9538A4C5F">
<p class="notep1">Note:</p>
<p>If the tablespace name for the recovery catalog is an RMAN reserved word, then it <span class="italic">must</span> be uppercase and enclosed in quotes. For example:</p>
<pre dir="ltr">CREATE CATALOG TABLESPACE &#39;CATALOG&#39;;
</pre></div>
</div>
</li>
<li class="stepexpand"><span>You can check the results by using SQL*Plus to query the recovery catalog to see which tables were created:</span>
<div>
<pre dir="ltr">SQL&gt; SELECT TABLE_NAME FROM USER_TABLES;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B__GUID-1F84D759-266E-4FAF-B47C-FA736E1CAA36">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink SQLRF" target="_blank" href="../SQLRF/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for the SQL syntax for the <code class="codeph">GRANT</code> and <code class="codeph">CREATE</code> <code class="codeph">USER</code> statements</p>
</li>
<li>
<p><a class="olink RCMRF117" target="_blank" href="../RCMRF/rcmsynta012.htm#RCMRF117"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">CREATE</code> <code class="codeph">CATALOG</code> command syntax</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV11001"></a>
<div class="props_rev_3"><a id="GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC"></a>
<h2 id="BRADV-GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC" class="sect2">Registering a Database in the Recovery Catalog</h2>
<div>
<p>This section describes how to maintain target database records in the recovery catalog. It contains the following sections:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-BAEDBF26-396B-4713-AB52-E056ACBDA6AC">About Registration of a Database in the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-1EC61518-B539-4FB0-9005-18ACED2F679A">Registering a Database with the REGISTER DATABASE Command</a></p>
</li>
</ul>
</div>
<a id="BRADV89652"></a>
<div class="props_rev_3"><a id="GUID-BAEDBF26-396B-4713-AB52-E056ACBDA6AC"></a>
<h3 id="BRADV-GUID-BAEDBF26-396B-4713-AB52-E056ACBDA6AC" class="sect3">About Registration of a Database in the Recovery Catalog</h3>
<div>
<p><a id="d57370e1975" class="indexterm-anchor"></a><a id="d57370e1981" class="indexterm-anchor"></a>The process of enrolling of a <a href="glossary.htm#GUID-272C4366-303F-4629-9679-1379AAC3FBC1"><span class="xrefglossterm">target database</span></a> in a recovery catalog is called <a href="glossary.htm#GUID-A7DDB252-1053-4BD7-9F6A-CD5639E5451D"><span class="xrefglossterm">registration</span></a>. If a target database is not registered in the recovery catalog, then RMAN cannot use the catalog to store metadata for operations on this database. You can still perform RMAN operations on an unregistered database: RMAN always stores its metadata in the control file of the target database.</p>
<p>If you are <span class="italic">not</span> using the recovery catalog in a Data Guard environment, then use the <code class="codeph">REGISTER</code> command to register each database. Each database must have a unique <a href="glossary.htm#GUID-2ABBEADC-F98C-4CF9-AD5B-065337E2733B"><span class="xrefglossterm">DBID</span></a>. If you use the RMAN <code class="codeph">DUPLICATE</code> command or the <code class="codeph">CREATE DATABASE</code> statement in SQL, then the database is assigned a unique DBID automatically. If you create a database by other means, then the copied database may have the same DBID as its source database. You can change the DBID with the <code class="codeph">DBNEWID</code> utility so that you can register the source and copy databases in the same catalog.</p>
<p>You can use the <code class="codeph">UNREGISTER</code> command to unregister a database from the recovery catalog.</p>
</div>
<a id="BRADV89653"></a>
<div class="props_rev_3"><a id="GUID-73A6A122-D90C-4E5C-8F51-2CE859B8F139"></a>
<h4 id="BRADV-GUID-73A6A122-D90C-4E5C-8F51-2CE859B8F139" class="sect4">About Standby Database Registration</h4>
<div>
<p>In a Data Guard environment, the primary and standby databases share the same DBID and database name. To be eligible for registration in the recovery catalog, each database in the Data Guard environment must have different <code class="codeph">DB_UNIQUE_NAME</code> values. The <code class="codeph">DB_UNIQUE_NAME</code> parameter for a database is set in its initialization parameter file.</p>
<p>If you use RMAN in a Data Guard environment, then you can use the <code class="codeph">REGISTER DATABASE</code> command only for the primary database. You can use the following techniques to register a standby database in the recovery catalog:</p>
<ul style="list-style-type: disc;">
<li>
<p>When you connect to a standby database as <code class="codeph">TARGET</code>, RMAN automatically registers the database in the recovery catalog.</p>
</li>
<li>
<p>When you run the <code class="codeph">CONFIGURE DB_UNIQUE_NAME</code> command for a standby database that is not known to the recovery catalog, RMAN automatically registers this standby database if its primary database is registered.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-73A6A122-D90C-4E5C-8F51-2CE859B8F139__GUID-440AF72A-8D22-4F92-819A-04094E27C2C4">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-8E35106D-950D-409B-98CA-91E142212D6A">Unregistering a Target Database from the Recovery Catalog</a>&#34;</span></p>
</li>
<li>
<p><a class="olink RCMRF126" target="_blank" href="../RCMRF/rcmsynta020.htm#RCMRF126"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">DUPLICATE</code> command syntax</p>
</li>
<li>
<p><a class="olink SUTIL014" target="_blank" href="../SUTIL/GUID-D138A757-6A2A-41A2-B722-A98708C5F5AD.htm#SUTIL014"><span class="italic">Oracle Database Utilities</span></a> to learn how to use the <code class="codeph">DBNEWID</code> utility to change the DBID</p>
</li>
<li>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn about using RMAN in a Data Guard environment</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="BRADV89654"></a>
<div class="props_rev_3"><a id="GUID-1EC61518-B539-4FB0-9005-18ACED2F679A"></a>
<h3 id="BRADV-GUID-1EC61518-B539-4FB0-9005-18ACED2F679A" class="sect3">Registering a Database with the REGISTER DATABASE Command</h3>
<div>
<div class="section">
<p><a id="d57370e2220" class="indexterm-anchor"></a><a id="d57370e2224" class="indexterm-anchor"></a>The first step in using a recovery catalog with a target database is registering the target database in the recovery catalog. If you use the catalog in a Data Guard environment, then you can only register the primary database in this way.</p>
<p>Use the following procedure:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog. The recovery catalog database must be open.</span>
<div>
<p>For example, issue the following command to connect to the catalog database with the net service name <code class="codeph">catdb</code> as user <code class="codeph">rco</code> (who owns the catalog schema):</p>
<pre dir="ltr">% rman TARGET / CATALOG rco@catdb;
</pre></div>
</li>
<li class="stepexpand"><span>If the target database is not mounted, then mount or open it:</span>
<div>
<pre dir="ltr">STARTUP MOUNT;
</pre></div>
</li>
<li class="stepexpand"><span><a id="d57370e2254" class="indexterm-anchor"></a><a id="d57370e2260" class="indexterm-anchor"></a><a id="d57370e2264" class="indexterm-anchor"></a><a id="d57370e2268" class="indexterm-anchor"></a>Register the target database in the connected recovery catalog:</span>
<div>
<pre dir="ltr">REGISTER DATABASE;
</pre>
<p>RMAN creates rows in the catalog tables to contain information about the target database, then copies all pertinent data about the target database from the control file into the catalog, synchronizing the catalog with the control file.</p>
</div>
</li>
<li class="stepexpand"><span>Verify that the registration was successful by running <code class="codeph">REPORT</code> <code class="codeph">SCHEMA</code>:</span>
<div>
<pre dir="ltr">REPORT SCHEMA;

Report of database schema for database with db_unique_name TRGT

List of Permanent Datafiles===========================
File Size(MB)   Tablespace       RB segs Datafile Name
---- ---------- ---------------- ------- -------------------
1        307200 SYSTEM             NO    /oracle/oradata/trgt/system01.dbf
2         20480 UNDOTBS            YES   /oracle/oradata/trgt/undotbs01.dbf
3         10240 CWMLITE            NO    /oracle/oradata/trgt/cwmlite01.dbf
4         10240 DRSYS              NO    /oracle/oradata/trgt/drsys01.dbf
5         10240 EXAMPLE            NO    /oracle/oradata/trgt/example01.dbf
6         10240 INDX               NO    /oracle/oradata/trgt/indx01.dbf
7         10240 TOOLS              NO    /oracle/oradata/trgt/tools01.dbf
8         10240 USERS              NO    /oracle/oradata/trgt/users01.dbf

List of Temporary Files
=======================
File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
---- -------- -------------------- ----------- --------------------
1    200      TEMP                 32767       /oracle/oradata/trgt/tbs_tmp.dbf
</pre></div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV89655"></a>
<div class="props_rev_3"><a id="GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51"></a>
<h2 id="BRADV-GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51" class="sect2">Cataloging Backups in the Recovery Catalog</h2>
<div>
<div class="section">
<p><a id="d57370e2358" class="indexterm-anchor"></a>If you have data file copies, backup pieces, or archived logs on disk, then you can catalog them in the recovery catalog with the <code class="codeph">CATALOG</code> command. When using a recovery catalog, cataloging older backups that have aged out of the control file lets RMAN use the older backups during restore operations. The following commands illustrate this technique:</p>
<pre dir="ltr">CATALOG DATAFILECOPY &#39;/disk1/old_datafiles/01_01_2003/users01.dbf&#39;;
CATALOG ARCHIVELOG &#39;/disk1/arch_logs/archive1_731.dbf&#39;, 
                   &#39;/disk1/arch_logs/archive1_732.dbf&#39;;
CATALOG BACKUPPIECE &#39;/disk1/backups/backup_820.bkp&#39;;
</pre>
<p><a id="d57370e2369" class="indexterm-anchor"></a>You can also catalog multiple backup files in a directory by using the <code class="codeph">CATALOG START WITH</code> command, as shown in the following example:</p>
<pre dir="ltr">CATALOG START WITH &#39;/disk1/backups/&#39;;
</pre>
<p>RMAN lists the files to be added to the RMAN repository and prompts for confirmation before adding the backups. Be careful when creating your prefix with <code class="codeph">CATALOG START WITH</code>. RMAN scans all paths for all files on disk that begin with the specified prefix. The prefix is not just a directory name. Using the wrong prefix can cause the cataloging of the wrong set of files.</p>
<p>For example, assume that a group of directories <code class="codeph">/disk1/backups</code>, <code class="codeph">/disk1/backups-year2003</code>, <code class="codeph">/disk1/backupsets</code>, and <code class="codeph">/disk1/backupsets/test</code> and so on, all contain backup files. The following command catalogs all files in all of these directories, because <code class="codeph">/disk1/backups</code> is a prefix for the paths for all of these directories:</p>
<pre dir="ltr">CATALOG START WITH &#39;/disk1/backups&#39;;
</pre>
<p>To catalog only backups in the <code class="codeph">/disk1/backups</code> directory, the correct command is as follows:</p>
<pre dir="ltr">CATALOG START WITH &#39;/disk1/backups/&#39;;
</pre>
<div class="infoboxnotealso" id="GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51__GUID-89F35FE2-EEC2-4418-A2F0-708E280C720A">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF141" target="_blank" href="../RCMRF/rcmsynta2002.htm#RCMRF141"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">REGISTER</code> syntax</p>
</li>
<li>
<p><a class="olink UPGRD" target="_blank" href="../UPGRD/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a> for issues relating to database migration</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89656"></a>
<div class="props_rev_3"><a id="GUID-B3238BE0-F52D-4773-A277-D3627AE28D57"></a>
<h2 id="BRADV-GUID-B3238BE0-F52D-4773-A277-D3627AE28D57" class="sect2">Creating and Managing Virtual Private Catalogs</h2>
<div>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA">Overview of Virtual Private Catalogs</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-662B4BCE-CFEF-489C-85C5-1097F44088F0">Creating and Managing Virtual Private Catalogs with Oracle Database 12c Release 1 (12.1.0.1)</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-A1D4FCBC-94F0-44A8-92E5-415FDCA46C29">Creating and Managing Virtual Private Catalogs with Oracle Database 12c Release 1 (12.1.0.2)</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-969A7519-B611-4737-A549-6C9D551894F6">Upgrading Virtual Private Catalogs to Oracle Database 12c Release 1 (12.1.0.2)</a></p>
</li>
</ul>
</div>
<a id="BRADV89657"></a>
<div class="props_rev_3"><a id="GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA"></a>
<h3 id="BRADV-GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA" class="sect3">Overview of Virtual Private Catalogs</h3>
<div>
<p>By default, all of the users of an RMAN recovery catalog have full privileges to read, select, insert, update, and delete any metadata in the catalog. For example, if the administrators of two unrelated databases share the same recovery catalog, each administrator could, whether inadvertently or maliciously, destroy catalog data for the other&#39;s database. In many enterprises, this situation is tolerated because the same people manage many different databases and also manage the recovery catalog. But in other enterprises where clear separation of duty exists between administrators of various databases, and between the DBA and the administrator of the recovery catalog, you may desire to restrict each database administrator to modify only backup metadata belonging to those databases that they are responsible for, while still keeping the benefits of a single, centrally-managed, RMAN recovery catalog. This goal can be achieved by implementing <a href="glossary.htm#GUID-3ACE1C6A-AEA0-4F3A-973B-2308E0A5AD4B"><span class="xrefglossterm">virtual private catalog</span></a>s.</p>
<p>Every RMAN recovery catalog starting with Oracle Database 11<span class="italic">g</span> supports virtual private catalogs, but they are not used unless explicitly created. There is no restriction to the number of virtual private catalogs that can be created beneath one recovery catalog. Each virtual private catalog is owned by a database schema user which is different than the user who owns the recovery catalog.</p>
<p>After you set up a virtual private catalog user, the administrator for the recovery catalog grants each virtual private catalog the privilege to use that catalog for one or more databases that are currently registered in the recovery catalog. The administrator of the recovery catalog can also grant the privilege to register new databases while using a virtual private catalog.</p>
<div class="infobox-note" id="GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA__GUID-669EBCEC-18D1-4908-8DDC-9C26EC568132">
<p class="notep1">Note:</p>
<p>Every virtual private catalog has access to all global stored scripts, and those non-global stored scripts that belong to those databases for which this virtual private catalog has privileges. Virtual private catalogs cannot access non-global stored scripts that belong to databases that they do not have privileges for, and they cannot create global stored scripts.</p>
</div>
</div>
<a id="BRADV841"></a>
<div class="props_rev_3"><a id="GUID-75E10BF2-18A0-4ECA-85D3-20E78003F080"></a>
<h4 id="BRADV-GUID-75E10BF2-18A0-4ECA-85D3-20E78003F080" class="sect4">About Using Virtual Private Catalogs</h4>
<div>
<p>The process of creating and managing virtual private catalogs depends on the Oracle Database version being used.</p>
<ul style="list-style-type: disc;">
<li>
<p>To create and manage virtual private catalogs using Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.1), use the instructions in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-662B4BCE-CFEF-489C-85C5-1097F44088F0">Creating and Managing Virtual Private Catalogs with Oracle Database 12c Release 1 (12.1.0.1)</a>&#34;</span>.</p>
</li>
<li>
<p>To create virtual private catalogs using Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), use the steps described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-A1D4FCBC-94F0-44A8-92E5-415FDCA46C29">Creating and Managing Virtual Private Catalogs with Oracle Database 12c Release 1 (12.1.0.2)</a>&#34;</span>.</p>
</li>
<li>
<p>To migrate existing virtual private catalogs that were created using Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.1) or earlier, you must upgrade these virtual private catalogs to Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2) using the steps described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-969A7519-B611-4737-A549-6C9D551894F6">Upgrading Virtual Private Catalogs to Oracle Database 12c Release 1 (12.1.0.2)</a>&#34;</span>.</p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV842"></a>
<div class="props_rev_3"><a id="GUID-662B4BCE-CFEF-489C-85C5-1097F44088F0"></a>
<h3 id="BRADV-GUID-662B4BCE-CFEF-489C-85C5-1097F44088F0" class="sect3">Creating and Managing Virtual Private Catalogs with Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.1)</h3>
<div>
<div class="section">
<p>Use the steps described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-485E9087-7540-4087-B64F-9E5D55C83379">Steps to Create a Virtual Private Catalog</a>&#34;</span> to create one or more virtual private catalogs.</p>
<p>After the virtual private catalog is created, you can revoke catalog access privileges as necessary. This task is described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B">Revoking Privileges from a Virtual Private Catalog Owner</a>&#34;</span>. <span class="q">&#34;<a href="rcmcatdb.htm#GUID-C63F1349-158D-418A-8F73-8E6FD163302A">Dropping a Virtual Private Catalog</a>&#34;</span> explains how to drop a virtual private catalog.</p>
</div>
<!-- class="section" --></div>
<a id="BRADV843"></a>
<div class="props_rev_3"><a id="GUID-485E9087-7540-4087-B64F-9E5D55C83379"></a>
<h4 id="BRADV-GUID-485E9087-7540-4087-B64F-9E5D55C83379" class="sect4">Steps to Create a Virtual Private Catalog</h4>
<div>
<ol>
<li class="stepexpand"><span>Create the database user who will own the virtual private catalog and grant access privileges to this user.</span>
<div>
<p>This task is described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-B26B5815-7E91-4871-A511-111CBC9C3791">Creating and Granting Privileges to a Virtual Private Catalog Owner</a>&#34;</span>.</p>
</div>
</li>
<li class="stepexpand"><span>Create the virtual private catalog.</span>
<div>
<p>This task is described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-5CCA09B5-4156-44CC-8006-8CB2D9581209">Creating a Virtual Private Catalog</a>&#34;</span>.</p>
</div>
</li>
</ol>
<div class="section">
<p>If the recovery catalog is a virtual private catalog, then the RMAN client connecting to it must be at patch level 10.1.0.6 or 10.2.0.3. Oracle9<span class="italic">i</span> RMAN clients cannot connect to a virtual private catalog. This version restriction does not affect RMAN client connections to an Oracle Database 11<span class="italic">g</span> base recovery catalog, even if it has some virtual private catalog users.</p>
<div class="infoboxnotealso" id="GUID-485E9087-7540-4087-B64F-9E5D55C83379__GUID-4D04CBB9-FB61-41F8-AB6A-B4C36B88BEF3">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF908" target="_blank" href="../RCMRF/compat.htm#RCMRF908"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for details about RMAN version compatibility</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV845"></a><a id="BRADV844"></a>
<div class="props_rev_3"><a id="GUID-B26B5815-7E91-4871-A511-111CBC9C3791"></a>
<h4 id="BRADV-GUID-B26B5815-7E91-4871-A511-111CBC9C3791" class="sect4">Creating and Granting Privileges to a Virtual Private Catalog Owner</h4>
<div>
<div class="section">
<p>This section assumes that you created the base recovery catalog.</p>
<p>Assume that the following databases are registered in the base recovery catalog: <code class="codeph">prod1</code>, <code class="codeph">prod2</code>, and <code class="codeph">prod3</code>. The database user who owns the base recovery catalog is <code class="codeph">rco</code>. You want to create database user <code class="codeph">vpc1</code> and grant this user access privileges only to <code class="codeph">prod1</code> and <code class="codeph">prod2</code>. By default, a virtual private catalog owner has no access to the base recovery catalog.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create and grant privileges to a virtual private catalog owner:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect to the recovery catalog database with administrator privileges.</span></li>
<li class="stepexpand"><span>Create the user who will own the virtual private catalog.</span>
<div>
<p>For example, if you want database user <code class="codeph">vpc1</code> to own the virtual private catalog, then execute the following command (replacing <span class="italic">password</span> with a user-defined password):</p>
<pre dir="ltr">SQL&gt; CREATE USER vpc1 IDENTIFIED BY <span class="italic">password</span>
  2  DEFAULT TABLESPACE vpcusers
  3  QUOTA UNLIMITED ON vpcusers;
</pre>
<div class="infobox-note" id="GUID-B26B5815-7E91-4871-A511-111CBC9C3791__GUID-839292B1-640D-42D6-894B-15D2D1508E5D">
<p class="notep1">Note:</p>
<p>Create a password that is secure. See <a class="olink DBSEG33223" target="_blank" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for more information.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Grant the <a id="d57370e3040" class="indexterm-anchor"></a><code class="codeph">RECOVERY_CATALOG_OWNER</code> role to the user, and then exit SQL*Plus.</span>
<div>
<p>The following example grants the role to user <code class="codeph">vpc1</code>:</p>
<pre dir="ltr">SQL&gt; GRANT recovery_catalog_owner TO vpc1;
SQL&gt; EXIT;
</pre></div>
</li>
<li class="stepexpand"><span>Start RMAN and connect to the recovery catalog database as the base recovery catalog owner (<span class="italic">not</span> the virtual private catalog owner).</span>
<div>
<p>The following example connects to the base recovery catalog as <code class="codeph">rco</code>:</p>
<pre dir="ltr">% rman
RMAN&gt; CONNECT CATALOG rco@catdb;

recovery catalog database Password: <span class="italic">password</span>
connected to recovery catalog database
</pre></div>
</li>
<li class="stepexpand"><span>Grant desired privileges to the virtual private catalog owner.</span>
<div>
<p><a id="d57370e3075" class="indexterm-anchor"></a><a id="d57370e3077" class="indexterm-anchor"></a>The following example gives user <code class="codeph">vpc1</code> access to the metadata for <code class="codeph">prod1</code> and <code class="codeph">prod2</code> (but not <code class="codeph">prod3</code>):</p>
<pre dir="ltr">RMAN&gt; GRANT CATALOG FOR DATABASE prod1 TO vpc1;
RMAN&gt; GRANT CATALOG FOR DATABASE prod2 TO vpc1;
</pre>
<p>You can also use a DBID rather than a database name. The virtual private catalog user does not have access to the metadata for any other databases registered in the recovery catalog.</p>
<p>You can also grant the user the ability to register new target databases in the recovery catalog. For example:</p>
<pre dir="ltr">RMAN&gt; GRANT REGISTER DATABASE TO vpc1;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV306"></a><a id="BRADV89659"></a>
<div class="props_rev_3"><a id="GUID-5CCA09B5-4156-44CC-8006-8CB2D9581209"></a>
<h4 id="BRADV-GUID-5CCA09B5-4156-44CC-8006-8CB2D9581209" class="sect4">Creating a Virtual Private Catalog</h4>
<div>
<div class="section">
<p>This section assumes that the virtual private catalog owner has been given the <code class="codeph">CREATE SESSION</code> privilege. Also, the base recovery catalog owner used the <code class="codeph">GRANT</code> command to give the virtual private catalog owner access to metadata in the base recovery catalog.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create a virtual private catalog:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the recovery catalog database as the virtual private catalog owner (<span class="italic">not</span> the base recovery catalog owner).</span>
<div>
<p>The following example connects to the recovery catalog as <code class="codeph">vpc1</code>:</p>
<pre dir="ltr">% rman
RMAN&gt; CONNECT CATALOG vpc1@catdb;
</pre></div>
</li>
<li class="stepexpand"><span>Create the virtual private catalog.</span>
<div>
<p><a id="d57370e3204" class="indexterm-anchor"></a><a id="d57370e3206" class="indexterm-anchor"></a>The following command creates the virtual private catalog:</p>
<pre dir="ltr">RMAN&gt; CREATE VIRTUAL CATALOG;
</pre></div>
</li>
<li class="stepexpand"><span>If you intend to use a 10.2 or earlier release of RMAN with this virtual private catalog, then execute the following PL/SQL procedure (where <span class="italic">base_catalog_owner</span> is the database user who owns the base recovery catalog):</span>
<div>
<pre dir="ltr">SQL&gt; EXECUTE <span class="italic">base_catalog_owner</span>.DBMS_RCVCAT.CREATE_VIRTUAL_CATALOG;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV307"></a><a id="BRADV89660"></a>
<div class="props_rev_3"><a id="GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B"></a>
<h4 id="BRADV-GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B" class="sect4">Revoking Privileges from a Virtual Private Catalog Owner</h4>
<div>
<div class="section">
<p>This section assumes that you have created a virtual private catalog.</p>
<p>Assume that two databases are registered in the base recovery catalog: <code class="codeph">prod1</code> and <code class="codeph">prod2</code>. As owner of the base recovery catalog, you have granted the <code class="codeph">vpc1</code> user access privileges to <code class="codeph">prod1</code>. You have also granted this user the right to register databases in his virtual private catalog. Now you want to revoke privileges from <code class="codeph">vpc1</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To revoke privileges from a virtual private catalog owner:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the recovery catalog database as the recovery catalog owner (<span class="italic">not</span> the virtual private catalog owner).</span>
<div>
<p>The following example connects to the recovery catalog as <code class="codeph">rco</code>:</p>
<pre dir="ltr">% rman
RMAN&gt; CONNECT CATALOG rco@catdb;
</pre></div>
</li>
<li class="stepexpand"><span><a id="d57370e3334" class="indexterm-anchor"></a><a id="d57370e3336" class="indexterm-anchor"></a>Revoke specified privileges from the virtual private catalog owner.</span>
<div>
<p>The following command revokes access to the metadata for <code class="codeph">prod1</code> from virtual private catalog owner <code class="codeph">vpc1</code>:</p>
<pre dir="ltr">REVOKE CATALOG FOR DATABASE prod1 FROM vpc1;
</pre>
<p>You can also specify a DBID rather than a database name. The catalog <code class="codeph">vpc1</code> retains all other granted catalog privileges.</p>
<p>You can also revoke the privilege to register new target databases in the recovery catalog. For example:</p>
<pre dir="ltr">REVOKE REGISTER DATABASE FROM vpc1;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV308"></a><a id="BRADV89661"></a>
<div class="props_rev_3"><a id="GUID-C63F1349-158D-418A-8F73-8E6FD163302A"></a>
<h4 id="BRADV-GUID-C63F1349-158D-418A-8F73-8E6FD163302A" class="sect4">Dropping a Virtual Private Catalog</h4>
<div>
<div class="section">
<p><a id="d57370e3432" class="indexterm-anchor"></a>This section assumes that you have created a virtual private catalog and now want to drop it. When you drop a virtual private catalog, you do not remove the base recovery catalog itself, but only drop the security policies that restrict access to the base recovery catalog.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To drop a virtual private catalog:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the recovery catalog database as the virtual private catalog owner (<span class="italic">not</span> the base recovery catalog owner).</span>
<div>
<p>The following example connects to the recovery catalog as user <code class="codeph">vpc1</code>:</p>
<pre dir="ltr">% rman
RMAN&gt; CONNECT CATALOG vpc1@catdb;
</pre></div>
</li>
<li class="stepexpand"><span>Drop the catalog.</span>
<div>
<p>If you are using an Oracle Database 11<span class="italic">g</span> or later RMAN executable, then drop the virtual private catalog with the <code class="codeph">DROP CATALOG</code> command:</p>
<pre dir="ltr">RMAN&gt; DROP CATALOG;
</pre>
<p>If you are using an Oracle Database 10<span class="italic">g</span> or earlier RMAN executable, then you cannot use the <code class="codeph">DROP CATALOG</code> command. Instead, connect SQL*Plus to the catalog database as the virtual private catalog user, then execute the following PL/SQL procedure (where <span class="italic">base_catalog_owner</span> is the database user who owns the base recovery catalog):</p>
<pre dir="ltr">SQL&gt; EXECUTE <span class="italic">base_catalog_owner</span>.DBMS_RCVCAT.DELETE_VIRTUAL_CATALOG;
</pre></div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV846"></a>
<div class="props_rev_3"><a id="GUID-A1D4FCBC-94F0-44A8-92E5-415FDCA46C29"></a>
<h3 id="BRADV-GUID-A1D4FCBC-94F0-44A8-92E5-415FDCA46C29" class="sect3">Creating and Managing Virtual Private Catalogs with Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2)</h3>
<div>
<div class="section">
<p>Use the steps described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-994E2B1B-E1E6-4765-90CB-DB27AA9ED714">Creating Virtual Private Catalogs with Oracle Database 12c Release 1 (12.1.0.2)</a>&#34;</span> to create a virtual private catalog.</p>
<p>After the virtual private catalog is set up, you can revoke catalog access privileges as necessary. This task is described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B">Revoking Privileges from a Virtual Private Catalog Owner</a>&#34;</span>.</p>
<p>To drop a virtual private catalog, you must revoke all privileges granted to the database user who owns the virtual private catalog. The virtual private catalog is dropped automatically when the virtual private catalog owner no longer has any privileges. You can subsequently drop the virtual private catalog owner by running the <code class="codeph">DROP USER</code> command.</p>
<div class="infobox-note" id="GUID-A1D4FCBC-94F0-44A8-92E5-415FDCA46C29__GUID-78ACE8C2-9D57-49D3-8E5B-0CFC29B86286">
<p class="notep1">Note:</p>
<p>Starting with Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), virtual private catalogs can be used only with Oracle Database Enterprise Edition. This functionality is not supported with the Standard Edition.</p>
</div>
</div>
<!-- class="section" --></div>
<a id="BRADV305"></a><a id="BRADV847"></a><a id="BRADV89658"></a>
<div class="props_rev_3"><a id="GUID-994E2B1B-E1E6-4765-90CB-DB27AA9ED714"></a>
<h4 id="BRADV-GUID-994E2B1B-E1E6-4765-90CB-DB27AA9ED714" class="sect4">Creating Virtual Private Catalogs with Oracle Database 12c Release 1 (12.1.0.2)</h4>
<div>
<div class="section">
<p>This section assumes that you created the base recovery catalog.</p>
<p>Assume that the following databases are registered in the base recovery catalog: <code class="codeph">prod1</code>, <code class="codeph">prod2</code>, and <code class="codeph">prod3</code>. The database user who owns the base recovery catalog is <code class="codeph">rco</code>. You want to create database user <code class="codeph">vpc1</code> and grant this user access privileges only to <code class="codeph">prod1</code> and <code class="codeph">prod2</code>. Next, you want to connect to the virtual private catalog owned by <code class="codeph">vpc1</code>, register the database <code class="codeph">prod1</code> with the virtual private catalog, and store backup metadata for <code class="codeph">prod1</code> in the virtual private catalog.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create and grant privileges to a virtual private catalog owner:</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>Start SQL*Plus and connect to the recovery catalog database with administrator privileges.</p>
</li>
<li>
<p>Create the user who will own the virtual private catalog.</p>
<p>For example, if you want database user <code class="codeph">vpc1</code> to own the virtual private catalog, then execute the following command (replacing <span class="italic">password</span> with a user-defined password):</p>
<pre dir="ltr">SQL&gt; CREATE USER vpc1 IDENTIFIED BY <span class="italic">password</span>
  2  DEFAULT TABLESPACE vpcusers
  3  QUOTA UNLIMITED ON vpcusers;
</pre>
<div class="infobox-note" id="GUID-994E2B1B-E1E6-4765-90CB-DB27AA9ED714__GUID-3860C1AF-D99F-49DC-A2CD-20C2EADD95E9">
<p class="notep1">Note:</p>
<p>Create a password that is secure. See <a class="olink DBSEG33223" target="_blank" href="../DBSEG/authentication.htm#DBSEG33223"><span class="italic">Oracle Database Security Guide</span></a> for more information.</p>
</div>
</li>
<li>
<p>Grant the <a id="d57370e3724" class="indexterm-anchor"></a><code class="codeph">CREATE SESSION</code> privilege to the user and then exit SQL*Plus.</p>
<p>The following example grants the <code class="codeph">CREATE SESSION</code> privilege to user <code class="codeph">vpc1</code>:</p>
<pre dir="ltr">SQL&gt; GRANT CREATE SESSION TO vpc1;
SQL&gt; EXIT;
</pre></li>
<li>
<p>Start RMAN and connect to the recovery catalog database as the base recovery catalog owner (<span class="italic">not</span> the virtual private catalog owner).</p>
<p>The following example connects to the base recovery catalog as <code class="codeph">rco</code>:</p>
<pre dir="ltr">% rman
RMAN&gt; CONNECT CATALOG rco@catdb;

recovery catalog database Password: <span class="italic">password</span>
connected to recovery catalog database
</pre></li>
<li>
<p>Grant desired privileges to the virtual private catalog owner.</p>
<p><a id="d57370e3759" class="indexterm-anchor"></a><a id="d57370e3761" class="indexterm-anchor"></a>The following example grants user <code class="codeph">vpc1</code> access to the metadata for <code class="codeph">prod1</code> and <code class="codeph">prod2</code> (but not <code class="codeph">prod3</code>):</p>
<pre dir="ltr">RMAN&gt; GRANT CATALOG FOR DATABASE prod1 TO vpc1;
RMAN&gt; GRANT CATALOG FOR DATABASE prod2 TO vpc1;
</pre>
<p>You can also use a DBID instead of a database name. The virtual private catalog user does not have access to the metadata for any other databases registered in the recovery catalog.</p>
<p>You can also grant the user the ability to register new target databases in the recovery catalog. For example:</p>
<pre dir="ltr">RMAN&gt; GRANT REGISTER DATABASE TO vpc1;
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To register a database with a virtual private catalog and store backup metadata:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to the recovery catalog database as the virtual private catalog owner (<span class="italic">not</span> the base recovery catalog owner). Connect to the database that you want to register as <code class="codeph">TARGET</code>.</span>
<div>
<pre dir="ltr">%rman
RMAN&gt; CONNECT TARGET /
RMAN&gt; CONNECT CATALOG vpc1@catdb;
</pre></div>
</li>
<li class="stepexpand"><span>Register the database whose metadata must be stored in the virtual private catalog.</span>
<div>
<p>The following example registers the database with the virtual private catalog owner <code class="codeph">vpc1</code>.</p>
<pre dir="ltr">RMAN&gt; REGISTER DATABASE;
</pre></div>
</li>
<li class="stepexpand"><span>Back up the database using the <code class="codeph">BACKUP</code> command with the required clauses.</span>
<div>
<p>Metadata related to the backup is stored in the virtual private catalog.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV849"></a><a id="BRADV848"></a>
<div class="props_rev_3"><a id="GUID-969A7519-B611-4737-A549-6C9D551894F6"></a>
<h3 id="BRADV-GUID-969A7519-B611-4737-A549-6C9D551894F6" class="sect3">Upgrading Virtual Private Catalogs to Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2)</h3>
<div>
<div class="section">
<p>Starting with Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), RMAN uses the Virtual Private Database (VPD) functionality to implement virtual private catalogs. The only privilege that you need to grant to the database user who owns the virtual private catalog is the <code class="codeph">CREATE SESSION</code> privilege. If you created a recovery catalog and virtual private catalogs using a version lower than Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), then you must upgrade these virtual private catalogs. RMAN provides scripts, located in the <span class="italic"><code class="codeph">$ORACLE_HOME</code></span><code class="codeph">/rdbms/admin</code> directory, to upgrade virtual private catalogs.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To upgrade existing virtual private catalogs to Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2):</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Use SQL*Plus to connect to the recovery catalog database as the <code class="codeph">SYS</code> user with <code class="codeph">SYSDBA</code> privilege.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">dbmsrmansys.sql</code> script to grant additional privileges that are required for the <code class="codeph">RECOVERY_CATALOG_OWNER</code> role.</span>
<div>
<pre dir="ltr">SQL&gt; @<span class="italic">$ORACLE_HOME</span>/rdbms/admin/dbmsrmansys.sql
</pre></div>
</li>
<li class="stepexpand"><span>Connect RMAN to the base recovery catalog, upgrade the base recovery catalog, and then exit RMAN.</span>
<div>
<p>Assume that the database user who owns the base recovery catalog is <code class="codeph">rco</code>. The following command upgrades the base recovery catalog. The <code class="codeph">UPGRADE CATALOG</code> command must be entered twice to confirm the upgrade.</p>
<pre dir="ltr">$ rman CATALOG rco@catdb
recovery catalog database Password: 
RMAN&gt; UPGRADE CATALOG;
RMAN&gt; UPGRADE CATALOG;
RMAN&gt; EXIT;
</pre></div>
</li>
<li class="stepexpand"><span>Use SQL*Plus to connect to the recovery catalog database as the <code class="codeph">SYS</code> user with <code class="codeph">SYSDBA</code> privilege.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">dbmsmanvpc.sql</code> script to upgrade virtual private catalog schemas to the VPD model.</span>
<div>
<p>The base recovery catalog schema name must be provided as an input parameter to this script. You can specify a maximum of 10 schema names. Alternately, you can use the <code class="codeph">-all</code> option to automatically detect base catalog schemas and upgrade all associated virtual private catalog schemas.</p>
<p>The following command upgrades the virtual private catalog schemas of the base recovery catalog owned by <code class="codeph">rco</code>:</p>
<pre dir="ltr">SQL&gt; @<span class="italic">$ORACLE_HOME</span>/rdbms/admin/dbmsrmanvpc.sql rco
</pre></div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV89662"></a>
<div class="props_rev_3"><a id="GUID-6F052177-3BEE-44DD-9136-0A576EF3F010"></a>
<h2 id="BRADV-GUID-6F052177-3BEE-44DD-9136-0A576EF3F010" class="sect2">Protecting the Recovery Catalog</h2>
<div>
<p>Include the recovery catalog database in your backup and recovery strategy. If you do not back up the recovery catalog and a disk failure occurs that destroys the recovery catalog database, then you may lose the metadata in the catalog. Without the recovery catalog contents, recovery of your other databases is likely to be more difficult.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29">Backing Up the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9">Recovering the Recovery Catalog</a></p>
</li>
</ul>
</div>
<a id="BRADV89663"></a>
<div class="props_rev_3"><a id="GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29"></a>
<h3 id="BRADV-GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29" class="sect3">Backing Up the Recovery Catalog</h3>
<div>
<p><a id="d57370e4141" class="indexterm-anchor"></a><a id="d57370e4145" class="indexterm-anchor"></a><a id="d57370e4149" class="indexterm-anchor"></a>A single recovery catalog can store metadata for multiple target databases. Consequently, loss of the recovery catalog can be disastrous. You must back up the recovery catalog frequently. <a id="d57370e4154" class="indexterm-anchor"></a><a id="d57370e4158" class="indexterm-anchor"></a><a id="d57370e4164" class="indexterm-anchor"></a>This section provides general guidelines for developing a strategy for protecting the recovery catalog.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-D2B27859-AE2D-44A5-A3DA-BF486026B3DE">Backing Up the Recovery Catalog Frequently</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E">Choosing the Appropriate Technique for Physical Backups</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-FC926F88-2EC6-47B5-A15C-0C548C94388F">Separating the Recovery Catalog from the Target Database</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-3399C205-2AF3-4CB6-AE4A-7FD40AE79699">Exporting the Recovery Catalog Data for Logical Backups</a></p>
</li>
</ul>
</div>
<a id="BRADV89664"></a>
<div class="props_rev_3"><a id="GUID-D2B27859-AE2D-44A5-A3DA-BF486026B3DE"></a>
<h4 id="BRADV-GUID-D2B27859-AE2D-44A5-A3DA-BF486026B3DE" class="sect4">Backing Up the Recovery Catalog Frequently</h4>
<div>
<p>The recovery catalog database is a database like any other, and is also a key part of your backup and recovery strategy. Protect the recovery catalog like any other part of your database, by backing it up. The backup strategy for your recovery catalog database is part of an overall backup and recovery strategy.</p>
<p>Back up the recovery catalog with the same frequency that you back up a target database. For example, if you make a weekly whole database backup of a target database, then back up the recovery catalog after the backup of the target database. This backup of the recovery catalog can help you in a disaster recovery scenario. Even if you must restore the recovery catalog database with a control file autobackup, you can use the full record of backups in your restored recovery catalog database to restore the target database.</p>
</div>
</div>
<a id="BRADV309"></a><a id="BRADV89665"></a>
<div class="props_rev_3"><a id="GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E"></a>
<h4 id="BRADV-GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E" class="sect4">Choosing the Appropriate Technique for Physical Backups</h4>
<div>
<p>When backing up the recovery catalog database, you can use RMAN to make the backups. As illustrated in <a href="rcmcatdb.htm#GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E__i1013751">Figure 13-1</a>, start RMAN with the <code class="codeph">NOCATALOG</code> option so that the repository for RMAN is the control file in the catalog database.</p>
<div class="figure" id="GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E__i1013751">
<p class="titleinfigure">Figure 13-1 Using the Control File as the Repository for Backups of the Recovery Catalog</p>
<img width="496" height="332" src="img/GUID-33CD5C91-DBF9-4E32-9140-868C3081EDB5-default.gif" alt="Description of Figure 13-1 follows" title="Description of Figure 13-1 follows"/><br/>
<a href="img_text/GUID-33CD5C91-DBF9-4E32-9140-868C3081EDB5-print.htm">Description of &#34;Figure 13-1 Using the Control File as the Repository for Backups of the Recovery Catalog&#34;</a></div>
<!-- class="figure" -->
<p>Follow these guidelines when developing an RMAN backup strategy for the recovery catalog database:</p>
<ul style="list-style-type: disc;">
<li>
<p>Run the recovery catalog database in <code class="codeph">ARCHIVELOG</code> mode so that you can do point-in-time recovery if needed.</p>
</li>
<li>
<p>Set the retention policy to a <code class="codeph">REDUNDANCY</code> value greater than <code class="codeph">1</code>.</p>
</li>
<li>
<p>Back up the database to two separate media (for example, disk and tape).</p>
</li>
<li>
<p>Run <code class="codeph">BACKUP</code> <code class="codeph">DATABASE</code> <code class="codeph">PLUS</code> <code class="codeph">ARCHIVELOG</code> at regular intervals, to a media manager if available, or just to disk.</p>
</li>
<li>
<p>Do not use another recovery catalog as the repository for the backups.</p>
</li>
<li>
<p>Configure the control file autobackup feature to <code class="codeph">ON</code>.</p>
</li>
</ul>
<p>With this strategy, the control file autobackup feature ensures that the recovery catalog database can always be recovered, so long as the control file autobackup is available.</p>
<div class="infoboxnotealso" id="GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E__GUID-50135869-9D77-46F7-B6C2-28787E021F3C">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmadvre.htm#GUID-195E30B2-6077-446D-A255-089D3341268A">Performing Disaster Recovery</a>&#34;</span> for more information for recovery with a control file autobackup</p>
</div>
</div>
</div>
<a id="BRADV89666"></a>
<div class="props_rev_3"><a id="GUID-FC926F88-2EC6-47B5-A15C-0C548C94388F"></a>
<h4 id="BRADV-GUID-FC926F88-2EC6-47B5-A15C-0C548C94388F" class="sect4">Separating the Recovery Catalog from the Target Database</h4>
<div>
<p>A recovery catalog is only effective when separated from the data that it is designed to protect. Thus, you must never store a recovery catalog containing the RMAN repository for a database in the same database as the target database. Also, do not store the catalog database on the same disks as the target database.</p>
<p>To illustrate why data separation is advised, assume that you store the catalog for database <code class="codeph">prod1</code> in <code class="codeph">prod1</code>. If <code class="codeph">prod1</code> suffers a total media failure, and if the recovery catalog for <code class="codeph">prod1</code> is also stored in <code class="codeph">prod1</code>, then if you lose the database you also lose the recovery catalog. At this point the only option is to restore an autobackup of the control file for <code class="codeph">prod1</code> and use it to restore and recover the database without the benefit of any information stored in the recovery catalog.</p>
</div>
</div>
<a id="BRADV89667"></a>
<div class="props_rev_3"><a id="GUID-3399C205-2AF3-4CB6-AE4A-7FD40AE79699"></a>
<h4 id="BRADV-GUID-3399C205-2AF3-4CB6-AE4A-7FD40AE79699" class="sect4">Exporting the Recovery Catalog Data for Logical Backups</h4>
<div>
<p>Logical backups of the RMAN recovery catalog created with the Data Pump Export utility can be a useful supplement for physical backups. For damage to a recovery catalog database, you can use Data Pump Import to quickly reimport the exported recovery catalog data into another database and rebuild the catalog.</p>
</div>
</div>
</div>
<a id="BRADV89668"></a>
<div class="props_rev_3"><a id="GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9"></a>
<h3 id="BRADV-GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9" class="sect3">Recovering the Recovery Catalog</h3>
<div>
<div class="section">
<p>Restoring and recovering the recovery catalog database is much like restoring and recovering any other database with RMAN. You can restore the control file and server parameter file for the recovery catalog database from an autobackup, then restore and perform complete recovery on the rest of the database. If you are in a situation where you are using multiple recovery catalogs, then you can also use another recovery catalog to record metadata about backups of this recovery catalog database.</p>
<p><a id="d57370e4634" class="indexterm-anchor"></a><a id="d57370e4640" class="indexterm-anchor"></a><a id="d57370e4644" class="indexterm-anchor"></a>If recovery of the recovery catalog database through the normal Oracle recovery procedures is not possible, then you must re-create the catalog. Examples of this worst-case scenario include:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>A recovery catalog database that has never been backed up</p>
</li>
<li>
<p>A recovery catalog database that has been backed up, but cannot be recovered because the data file backups or archived logs are not available</p>
</li>
</ul>
<p>You have the following options for partially re-creating the contents of the missing recovery catalog:</p>
<ul style="list-style-type: disc;">
<li>
<p>Use the <a id="d57370e4663" class="indexterm-anchor"></a><a id="d57370e4667" class="indexterm-anchor"></a><a id="d57370e4673" class="indexterm-anchor"></a><code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> command to update the recovery catalog with any RMAN repository information from the control file of the target database or a control file copy. Any metadata from control file records that aged out of the control file is lost.</p>
</li>
<li>
<p>Issue <code class="codeph">CATALOG START WITH...</code> commands to recatalog any available backups.</p>
</li>
</ul>
<p>To minimize the likelihood of this worst-case scenario, your backup strategy must at least include backing up the recovery catalog. This technique is described in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29">Backing Up the Recovery Catalog</a>&#34;</span>.</p>
<div class="infoboxnotealso" id="GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9__GUID-873B9F00-E217-458F-B8E2-5E19F0F11E14">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF109" target="_blank" href="../RCMRF/rcmsynta007.htm#RCMRF109"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for information about the <code class="codeph">CATALOG</code> command</p>
</li>
<li>
<p><a class="olink RCMRF119" target="_blank" href="../RCMRF/rcmsynta014.htm#RCMRF119"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for information about the <code class="codeph">CROSSCHECK</code> command</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV182"></a>
<div class="props_rev_3"><a id="GUID-14E5B168-8033-4831-A02A-6003212988D7"></a>
<h2 id="BRADV-GUID-14E5B168-8033-4831-A02A-6003212988D7" class="sect2">Managing Stored Scripts</h2>
<div>
<p>As explained in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4">About Stored Scripts</a>&#34;</span>, you can store scripts in the recovery catalog. This section explains how to create and manage stored scripts.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4">About Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E">Creating Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-367CC981-6BFD-45E1-9A78-931003C32DB7">Replacing Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E">Executing Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C">Creating and Executing Dynamic Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-551823D1-881A-424E-86F1-201126B31EC9">Printing Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3">Listing Stored Script Names</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3">Deleting Stored Scripts</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A">Executing a Stored Script at RMAN Startup</a></p>
</li>
</ul>
</div>
<a id="BRADV89669"></a>
<div class="props_rev_3"><a id="GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4"></a>
<h3 id="BRADV-GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4" class="sect3">About Stored Scripts</h3>
<div>
<p><a id="d57370e4910" class="indexterm-anchor"></a><a id="d57370e4914" class="indexterm-anchor"></a><a id="d57370e4916" class="indexterm-anchor"></a><a id="d57370e4920" class="indexterm-anchor"></a>You can use a <a href="glossary.htm#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">stored script</span></a> as an alternative to a command file for managing frequently used sequences of RMAN commands.<a id="d57370e4929" class="indexterm-anchor"></a><a id="d57370e4931" class="indexterm-anchor"></a> The script is stored in the recovery catalog rather than on the file system.</p>
<p>Stored scripts can be local or global. A local script is associated with the target database to which RMAN is connected when the script is created, and can only be executed when you are connected to that target database. A global stored script can be run against any database registered in the recovery catalog, if the RMAN client is connected to the recovery catalog and a target database.</p>
<p>The commands allowable within the brackets of the <code class="codeph">CREATE SCRIPT</code> command are the same commands supported within a <code class="codeph">RUN</code> block. Any command that is legal within a <code class="codeph">RUN</code> command is permitted in the stored script. The following commands are not legal within stored scripts: <code class="codeph">RUN</code>, <code class="codeph">@</code>, and <code class="codeph">@@</code>.</p>
<p>When specifying a script name, RMAN permits but generally does not require that you use quotes around the name of a stored script. If the name begins with a digit or is an RMAN reserved word, however, then you must put quotes around the name to use it as a stored script name. Consider avoiding stored script names that begin with nonalphabetic characters or that are the same as RMAN reserved words.</p>
<p>Consider using a naming convention to avoid confusion between global and local stored scripts. For the <code class="codeph">EXECUTE SCRIPT</code>, <code class="codeph">DELETE SCRIPT</code> and <code class="codeph">PRINT SCRIPT</code> commands, if the script name passed as an argument is not the name of a script defined for the connected target instance, then RMAN looks for a global script by the same name. For example, if the global script <code class="codeph">global_backup</code> is in the recovery catalog, but no local stored script <code class="codeph">global_backup</code> is defined for the target database, then the following command deletes the global script:</p>
<pre dir="ltr">DELETE SCRIPT global_backup;
</pre>
<p>To use commands related to stored scripts, even global scripts, you must be connected to both a recovery catalog and a target database instance.</p>
</div>
</div>
<a id="BRADV310"></a><a id="BRADV89670"></a>
<div class="props_rev_3"><a id="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E"></a>
<h3 id="BRADV-GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E" class="sect3">Creating Stored Scripts</h3>
<div>
<div class="section">
<p><a id="d57370e5053" class="indexterm-anchor"></a><a id="d57370e5055" class="indexterm-anchor"></a>You can use the <code class="codeph">CREATE SCRIPT</code> command to create a stored script. If <code class="codeph">GLOBAL</code> is specified, then a global script with this name must not exist in the recovery catalog. If <code class="codeph">GLOBAL</code> is not specified, then a local script must not exist with the same name for the same target database. You can also use the <code class="codeph">REPLACE SCRIPT</code> to create a new script or update an existing script.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create a stored script:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span>
<div>
<div class="infoboxnotealso" id="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E__GUID-A3653BF2-031B-4EAE-8CB4-FFCB44D4C79D">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmcnctg.htm#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C">Making Database Connections with RMAN</a>&#34;</span></p>
</div>
</div>
</li>
<li class="stepexpand"><span><a id="d57370e5088" class="indexterm-anchor"></a><a id="d57370e5094" class="indexterm-anchor"></a>Run the <code class="codeph">CREATE</code> <code class="codeph">SCRIPT</code> command.</span>
<div>
<p>The following example illustrates creation of a local script:</p>
<pre dir="ltr">CREATE SCRIPT full_backup 
{     
  BACKUP DATABASE PLUS ARCHIVELOG;
  DELETE OBSOLETE;
}
</pre>
<p>For a global script, the syntax is similar:</p>
<pre dir="ltr">CREATE GLOBAL SCRIPT global_full_backup 
{     
  BACKUP DATABASE PLUS ARCHIVELOG;
  DELETE OBSOLETE;
}
</pre>
<p>Optionally, you can provide a <code class="codeph">COMMENT</code> with descriptive information:</p>
<pre dir="ltr">CREATE GLOBAL SCRIPT global_full_backup 
COMMENT &#39;use only with ARCHIVELOG mode databases&#39;
{     
  BACKUP DATABASE PLUS ARCHIVELOG;
  DELETE OBSOLETE;
}
</pre>
<p>You can also create a script by reading its contents from a text file. The file must begin with a left brace (<code class="codeph">{</code>) character, contain a series of commands valid within a <code class="codeph">RUN</code> block, and end with a right brace (<code class="codeph">}</code>) character. Otherwise, a syntax error is signalled, just as if the commands were entered at the keyboard.</p>
<pre dir="ltr">CREATE SCRIPT full_backup 
  FROM FILE &#39;/tmp/my_script_file.txt&#39;;
</pre></div>
</li>
<li class="stepexpand"><span>Examine the output.</span>
<div>
<p>If no errors are displayed, then RMAN successfully created the script and stored in the recovery catalog.</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E__GUID-95D8EB3A-4AB5-43EA-816D-60F0B9F501A5">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF909" target="_blank" href="../RCMRF/rcmcomma.htm#RCMRF909"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for the list of RMAN reserved words</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV311"></a><a id="BRADV89671"></a>
<div class="props_rev_3"><a id="GUID-367CC981-6BFD-45E1-9A78-931003C32DB7"></a>
<h3 id="BRADV-GUID-367CC981-6BFD-45E1-9A78-931003C32DB7" class="sect3">Replacing Stored Scripts</h3>
<div>
<div class="section">
<p><a id="d57370e5229" class="indexterm-anchor"></a><a id="d57370e5231" class="indexterm-anchor"></a>To update stored scripts, use the <code class="codeph">REPLACE</code> <code class="codeph">SCRIPT</code> command. If you are replacing a local script, then you must be connected to the target database that you connected to when you created the script. If the script does not exist, then RMAN creates it.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To replace a stored script:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span></li>
<li class="stepexpand"><span>Execute <code class="codeph">REPLACE SCRIPT</code>.</span>
<div>
<p>This following example updates the script <code class="codeph">full_backup</code> with new contents:</p>
<pre dir="ltr">REPLACE SCRIPT full_backup 
{
  BACKUP DATABASE PLUS ARCHIVELOG;
}
</pre>
<p>You can update global scripts by specifying the <code class="codeph">GLOBAL</code> keyword as follows:</p>
<pre dir="ltr">REPLACE GLOBAL SCRIPT global_full_backup 
COMMENT &#39;A script for full backup to be used with any database&#39;
{
  BACKUP AS BACKUPSET DATABASE PLUS ARCHIVELOG;
}
</pre>
<p>As with <code class="codeph">CREATE SCRIPT</code>, you can update a local or global stored script from a text file with the following form of the command:</p>
<pre dir="ltr">REPLACE GLOBAL SCRIPT global_full_backup 
  FROM FILE &#39;/tmp/my_script_file.txt&#39;;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-367CC981-6BFD-45E1-9A78-931003C32DB7__GUID-B86CA244-208D-49EA-8FC8-CB79D0EC4D2A">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF145" target="_blank" href="../RCMRF/rcmsynta2005.htm#RCMRF145"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">REPLACE</code> <code class="codeph">SCRIPT</code> command syntax</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV312"></a><a id="BRADV89672"></a>
<div class="props_rev_3"><a id="GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E"></a>
<h3 id="BRADV-GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E" class="sect3">Executing Stored Scripts</h3>
<div>
<div class="section">
<p><a id="d57370e5362" class="indexterm-anchor"></a><a id="d57370e5364" class="indexterm-anchor"></a>Use the <code class="codeph">EXECUTE SCRIPT</code> command to run a stored script. If <code class="codeph">GLOBAL</code> is specified, then a global script with this name must exist in the recovery catalog; otherwise, RMAN returns error <code class="codeph">RMAN-06004</code>. If <code class="codeph">GLOBAL</code> is not specified, then RMAN searches for a local stored script defined for the current target database. If no local script with this name is found, then RMAN searches for a global script by the same name and executes it if one is found.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To execute a stored script:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span></li>
<li class="stepexpand"><span>If needed, use <code class="codeph">SHOW</code> to examine your configured channels.</span>
<div>
<p>Your script uses the automatic channels configured at the time you execute the script. Use <code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code> commands in the script if you must override the configured channels. Because of the <code class="codeph">RUN</code> block, if an RMAN command in the script fails, subsequent RMAN commands in the script do not execute.</p>
</div>
</li>
<li class="stepexpand"><span>Run <code class="codeph">EXECUTE</code> <code class="codeph">SCRIPT</code>. This command requires a <code class="codeph">RUN</code> block, as shown in the following example:</span>
<div>
<pre dir="ltr">RUN 
{ 
  EXECUTE SCRIPT full_backup; 
}
</pre>
<p>The preceding command invokes a local script if one exists with the name specified. If no local script is found, but there is a global script with the name specified, then RMAN executes the global script.</p>
<p>You can also use <code class="codeph">EXECUTE GLOBAL SCRIPT</code> to control which script is invoked if a local and a global script have the same name. If there is no local script called <code class="codeph">global_full_backup</code>, the following two commands have the same effect:</p>
<pre dir="ltr">RUN 
{
  EXECUTE GLOBAL SCRIPT global_full_backup;
}

RUN
{ 
  EXECUTE SCRIPT global_full_backup; 
}
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E__GUID-BEAAFC82-B9EA-4783-A1AE-12C58AB27B83">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF127" target="_blank" href="../RCMRF/rcmsynta021.htm#RCMRF127"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">EXECUTE</code> <code class="codeph">SCRIPT</code> command syntax</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV313"></a><a id="BRADV89673"></a>
<div class="props_rev_3"><a id="GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C"></a>
<h3 id="BRADV-GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C" class="sect3">Creating and Executing Dynamic Stored Scripts</h3>
<div>
<div class="section">
<p><a id="d57370e5519" class="indexterm-anchor"></a><a id="d57370e5523" class="indexterm-anchor"></a>You can specify substitution variables in the <a class="olink RCMRF118" target="_blank" href="../RCMRF/rcmsynta013.htm#RCMRF118"><code class="codeph">CREATE SCRIPT</code></a> command. When you start RMAN on the command line, the <code class="codeph">USING</code> clause specifies one or more values for use in substitution variables in a command file. As in SQL*Plus, <code class="codeph">&amp;1</code> indicates where to place the first value, <code class="codeph">&amp;2</code> indicates where to place the second value, and so on.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create and use a dynamic stored script:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span><a id="d57370e5546" class="indexterm-anchor"></a>Create a command file that contains a <code class="codeph">CREATE SCRIPT</code> statement with substitution variables for values that must be dynamically updated.</span>
<div>
<p>The following example uses substitution variables for the name of the tape set, for a string in the <code class="codeph">FORMAT</code> specification, and for the name of the restore point.</p>
<pre dir="ltr">CREATE SCRIPT quarterly { 
  ALLOCATE CHANNEL c1
    DEVICE TYPE sbt
    PARMS &#39;ENV=(OB_MEDIA_FAMILY=&amp;1)&#39;;
  BACKUP
    TAG &amp;2
    FORMAT &#39;/disk2/bck/&amp;1%U.bck&#39;
    KEEP FOREVER
    RESTORE POINT &amp;3
    DATABASE;
}
</pre></div>
</li>
<li class="stepexpand"><span>Connect RMAN to a target database (which must be mounted or open) and recovery catalog, specifying the initial values for the recovery catalog script.</span>
<div>
<p>For example, enter the following command:</p>
<pre dir="ltr">% rman TARGET / CATALOG rco@catdb USING arc_backup bck0906 FY06Q3
</pre>
<p>A recovery catalog is required for <code class="codeph">KEEP FOREVER</code>, but is not required for any other <code class="codeph">KEEP</code> option.</p>
</div>
</li>
<li class="stepexpand"><span>Run the command file created in the first step to create the stored script.</span>
<div>
<p>For example, run the <code class="codeph">/tmp/catscript.rman</code> command file as follows:</p>
<pre dir="ltr">RMAN&gt; @/tmp/catscript.rman
</pre>
<p>This step creates but does not execute the stored script.</p>
</div>
</li>
<li class="stepexpand"><span>Every quarter, execute the stored script, passing values for the substitution variables.</span>
<div>
<p>The following example executes the recovery catalog script named <code class="codeph">quarterly</code>. The example specifies <code class="codeph">arc_backup</code> as the name of the media family (set of tapes), <code class="codeph">bck1206</code> as part of the <code class="codeph">FORMAT</code> string and <code class="codeph">FY06Q4</code> as the name of the restore point.</p>
<pre dir="ltr">RUN
{ 
  EXECUTE SCRIPT quarterly 
    USING arc_backup
          bck1206
          FY06Q4;
}
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C__GUID-AFD994CA-032C-40BD-8F29-A31564182209">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="rcmbckba.htm#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9">Making Database Backups for Long-Term Storage</a>&#34;</span></p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV314"></a><a id="BRADV89674"></a>
<div class="props_rev_3"><a id="GUID-551823D1-881A-424E-86F1-201126B31EC9"></a>
<h3 id="BRADV-GUID-551823D1-881A-424E-86F1-201126B31EC9" class="sect3">Printing Stored Scripts</h3>
<div>
<div class="section">
<p><a id="d57370e5693" class="indexterm-anchor"></a><a id="d57370e5695" class="indexterm-anchor"></a><a id="d57370e5699" class="indexterm-anchor"></a>The <code class="codeph">PRINT</code> <code class="codeph">SCRIPT</code> command displays a stored script or writes it out to a file.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To print stored scripts:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">PRINT SCRIPT</code> command as follows:</span>
<div>
<pre dir="ltr">PRINT SCRIPT full_backup;
</pre>
<p>To send the contents of a script to a file, use this form of the command:</p>
<pre dir="ltr">PRINT SCRIPT full_backup 
  TO FILE &#39;/tmp/my_script_file.txt&#39;;
</pre>
<p>For global scripts, the analogous syntax is as follows:</p>
<pre dir="ltr">PRINT GLOBAL SCRIPT global_full_backup;
PRINT GLOBAL SCRIPT global_full_backup 
  TO FILE &#39;/tmp/my_script_file.txt&#39;;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-551823D1-881A-424E-86F1-201126B31EC9__GUID-18E7ABC4-500E-4086-A2B2-E7A0C8996D18">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF136" target="_blank" href="../RCMRF/rcmsynta028.htm#RCMRF136"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">PRINT</code> <code class="codeph">SCRIPT</code> command syntax</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV315"></a><a id="BRADV89675"></a>
<div class="props_rev_3"><a id="GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3"></a>
<h3 id="BRADV-GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3" class="sect3">Listing Stored Script Names</h3>
<div>
<div class="section">
<p><a id="d57370e5822" class="indexterm-anchor"></a>Use the <code class="codeph">LIST ... SCRIPT NAMES</code> command to display the names of scripts defined in the recovery catalog. <code class="codeph">LIST GLOBAL SCRIPT NAMES</code> and <code class="codeph">LIST ALL SCRIPT NAMES</code> are the only commands that work when RMAN is connected to a recovery catalog without connecting to a target instance; the other forms of the <code class="codeph">LIST ... SCRIPT NAMES</code> command require a recovery catalog connection.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To list stored script names:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog.</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">LIST ... SCRIPT NAMES</code> command.</span>
<div>
<p>For example, run the following command to list the names of all global and local scripts that can be executed for the currently connected target database:</p>
<pre dir="ltr">LIST SCRIPT NAMES;
</pre>
<p>The following example lists <span class="italic">only</span> global script names:</p>
<pre dir="ltr">LIST GLOBAL SCRIPT NAMES;
</pre>
<p>To list the names of all scripts stored in the current recovery catalog, including global scripts and local scripts for all target databases registered in the recovery catalog, use the following form of the command:</p>
<pre dir="ltr">LIST ALL SCRIPT NAMES;
</pre>
<p>For each script listed, the output indicates which target database the script is defined for (or whether a script is global).</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3__GUID-2F853742-AC63-4837-AAEA-F3BA99C25D8C">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF132" target="_blank" href="../RCMRF/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">LIST</code> <code class="codeph">SCRIPT NAMES</code> command syntax and output format</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV316"></a><a id="BRADV89676"></a>
<div class="props_rev_3"><a id="GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3"></a>
<h3 id="BRADV-GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3" class="sect3">Deleting Stored Scripts</h3>
<div>
<div class="section">
<p>Use the <code class="codeph">DELETE GLOBAL SCRIPT</code> command to delete a stored script from the recovery catalog.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To delete a stored script:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog.</span></li>
<li class="stepexpand"><span>Enter the <code class="codeph">DELETE SCRIPT</code> command.</span>
<div>
<p>If you use <code class="codeph">DELETE SCRIPT</code> without <code class="codeph">GLOBAL</code>, and there is no stored script for the target database with the specified name, then RMAN looks for a global stored script by the specified name and deletes the global script if it exists. For example, suppose you enter the following command:</p>
<pre dir="ltr">DELETE SCRIPT &#39;global_full_backup&#39;;
</pre>
<p>In this case, RMAN looks for a script <code class="codeph">global_full_backup</code> defined for the connected target database, and if it did not find one, it searches the global scripts for a script called <code class="codeph">global_full_backup</code> and delete that script.</p>
<p>To delete a global stored script, use <code class="codeph">DELETE GLOBAL SCRIPT</code>:</p>
<pre dir="ltr">DELETE GLOBAL SCRIPT &#39;global_full_backup&#39;;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3__GUID-5BCCE0E5-44FB-4D3F-9976-9D9DBD55FD5C">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF122" target="_blank" href="../RCMRF/rcmsynta016.htm#RCMRF122"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">DELETE</code> <code class="codeph">SCRIPT</code> command syntax</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV89677"></a>
<div class="props_rev_3"><a id="GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A"></a>
<h3 id="BRADV-GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A" class="sect3">Executing a Stored Script at RMAN Startup</h3>
<div>
<div class="section">
<p><a id="d57370e6098" class="indexterm-anchor"></a>To run the RMAN client and start a stored script in the recovery catalog on startup, use the <code class="codeph">SCRIPT</code> argument when starting the RMAN client. For example, you could enter the following command to execute script <code class="codeph">/tmp/fbkp.cmd</code>:</p>
<pre dir="ltr">% rman TARGET / CATALOG rco@catdb SCRIPT &#39;/tmp/fbkp.cmd&#39;;
</pre>
<p>You must connect to the recovery catalog, which contains the stored script, and the target database, to which the script applies, when starting the RMAN client.</p>
<p>If local and global stored scripts are defined with the same name, then RMAN always executes the local script.</p>
<div class="infoboxnotealso" id="GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A__GUID-BD862196-8BA4-438C-9857-58E137B87DB4">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF111" target="_blank" href="../RCMRF/rcmsynta2011.htm#RCMRF111"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for full RMAN client command line syntax</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV89678"></a>
<div class="props_rev_3"><a id="GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319"></a>
<h2 id="BRADV-GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319" class="sect2">Maintaining a Recovery Catalog</h2>
<div>
<p>This section describes various management and maintenance tasks. This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9">About Recovery Catalog Maintenance</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-87642B50-AF67-482E-A93D-291B8D2EED92">Resynchronizing the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8">Updating the Recovery Catalog After Changing a DB_UNIQUE_NAME</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-8E35106D-950D-409B-98CA-91E142212D6A">Unregistering a Target Database from the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-304B2237-0921-422F-A084-D83E7B5C8D2B">Resetting the Database Incarnation in the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7">Upgrading the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C">Importing and Moving a Recovery Catalog</a></p>
</li>
</ul>
</div>
<a id="BRADV89679"></a>
<div class="props_rev_3"><a id="GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9"></a>
<h3 id="BRADV-GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9" class="sect3">About Recovery Catalog Maintenance</h3>
<div>
<p>After you have created a recovery catalog and registered your target databases, you must maintain this catalog. For example, you must run the <a href="glossary.htm#GUID-F89B6EF7-3067-45B0-A45C-DE5247E0C326"><span class="xrefglossterm">RMAN maintenance commands</span></a>, which are explained in <a href="rcmmaint.htm#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="You can delete backups and recovery catalog records for backups.">Maintaining RMAN Backups and Repository&nbsp;Records</a>, to update backup records and to delete backups that are no longer needed. You must perform this type of maintenance regardless of whether you use RMAN with a recovery catalog. Other types of maintenance, such as upgrading a recovery catalog schema, are specific to use of RMAN with a recovery catalog.</p>
<p>If you use a recovery catalog in a Data Guard environment, then special considerations apply for backups and database files recorded in the catalog. See <span class="q">&#34;<a href="rcmarchi.htm#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B">About RMAN File Management in a Data Guard Environment</a>&#34;</span> for an explanation of when backups are accessible to RMAN and how RMAN maintenance commands work with accessible backups.</p>
</div>
</div>
<a id="BRADV181"></a>
<div class="props_rev_3"><a id="GUID-87642B50-AF67-482E-A93D-291B8D2EED92"></a>
<h3 id="BRADV-GUID-87642B50-AF67-482E-A93D-291B8D2EED92" class="sect3">Resynchronizing the Recovery Catalog</h3>
<div>
<p>When RMAN performs a <a href="glossary.htm#GUID-390A74EF-CD69-4173-B810-23EE2A5BB0EF"><span class="xrefglossterm">resynchronization</span></a>, it compares the recovery catalog to either the current or backup control file of the target database and updates the catalog with metadata that is missing or changed<a id="d57370e6390" class="indexterm-anchor"></a><a id="d57370e6394" class="indexterm-anchor"></a><a id="d57370e6398" class="indexterm-anchor"></a><a id="d57370e6402" class="indexterm-anchor"></a><a id="d57370e6404" class="indexterm-anchor"></a><a id="d57370e6410" class="indexterm-anchor"></a>. Most RMAN commands perform a resynchronization automatically when the target control file is mounted and the catalog is available. In a Data Guard environment, RMAN can perform a <a href="glossary.htm#GUID-52C89ABD-D7C1-4FE1-9825-BCBF1973B156"><span class="xrefglossterm">reverse resynchronization</span></a> to update a database control file with metadata from the catalog.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-C4EC7335-316B-45D6-A021-2A2B2030439F">About Resynchronization of the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-A7B674BE-0E9C-444D-8517-E7F7D83115D0">Deciding When to Resynchronize the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C">Manually Resynchronizing the Recovery Catalog</a></p>
</li>
</ul>
</div>
<a id="BRADV89680"></a>
<div class="props_rev_3"><a id="GUID-C4EC7335-316B-45D6-A021-2A2B2030439F"></a>
<h4 id="BRADV-GUID-C4EC7335-316B-45D6-A021-2A2B2030439F" class="sect4">About Resynchronization of the Recovery Catalog</h4>
<div>
<p><a id="d57370e6504" class="indexterm-anchor"></a><a id="d57370e6510" class="indexterm-anchor"></a><a id="d57370e6514" class="indexterm-anchor"></a>Resynchronization of the recovery catalog ensures that the metadata that RMAN obtains from the control file stays current. Resynchronizations can be full or partial.</p>
<p>In a <a href="glossary.htm#GUID-A9DE7F92-35F1-49D7-BF9D-19C2D6A6D24A"><span class="xrefglossterm">partial resynchronization</span></a>, RMAN reads the current control file of the target database to update changed metadata about new backups, new archived redo logs, and so on. RMAN does not resynchronize metadata about the database physical schema.</p>
<p>In a <a href="glossary.htm#GUID-ABC68132-29E7-43AA-A03C-2DAC11B7C91D"><span class="xrefglossterm">full resynchronization</span></a>, RMAN updates all changed records, including those for the database schema. RMAN performs a full resynchronization after structural changes to database (adding or dropping database files, creating new incarnation, and so on) or after changes to the RMAN persistent configuration.</p>
<p>RMAN creates a <a id="d57370e6533" class="indexterm-anchor"></a><a id="d57370e6535" class="indexterm-anchor"></a><a href="glossary.htm#GUID-C49B814B-6834-4CC0-911D-60F7CA87669F"><span class="xrefglossterm">snapshot control file</span></a>, which is a temporary backup control file, when it performs a full resynchronization. The database ensures that only one RMAN session accesses a snapshot control file at any point in time. RMAN creates the snapshot control file in an operating system-specific location on the target database host. You can specify the name and location of the snapshot control file, as explained in <span class="q">&#34;<a href="rcmconfa.htm#GUID-B7B61600-6DED-413D-B134-1DAE79627A01">Configuring the Snapshot Control File Location</a>&#34;</span>.</p>
<p>This snapshot control file ensures that RMAN has a consistent view of the control file. Because the control file is intended for short-term use, it is not registered in the catalog. RMAN records the control file checkpoint in the recovery catalog to indicate the currency of the catalog.</p>
<div class="infoboxnotealso" id="GUID-C4EC7335-316B-45D6-A021-2A2B2030439F__GUID-389FECA5-1097-470F-BEC4-CFAB8AD02B61">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF150" target="_blank" href="../RCMRF/rcmsynta2009.htm#RCMRF150"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for more information about the <code class="codeph">RESYNC</code> command</p>
</div>
</div>
<a id="BRADV89681"></a>
<div class="props_rev_3"><a id="GUID-4394EE9B-2D71-4B44-BD08-217DAAEB94A6"></a>
<h5 id="BRADV-GUID-4394EE9B-2D71-4B44-BD08-217DAAEB94A6" class="sect5">About RMAN Recovery Catalog Resynchronization in a Data Guard Environment</h5>
<div>
<p>RMAN only automatically resynchronizes the recovery catalog with a database when connected to this database as <code class="codeph">TARGET</code>. Thus, RMAN does not automatically resynchronize every database in a Data Guard environment when connected as <code class="codeph">TARGET</code> to one database in the environment. You can use the <code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME</code> command to manually resynchronize the recovery catalog with a database in the Data Guard environment.</p>
<p>For an example of a manual resynchronization, assume that RMAN is connected as <code class="codeph">TARGET</code> to production database <code class="codeph">prod</code>, and that you have used <code class="codeph">CONFIGURE</code> to create a configuration for <code class="codeph">dgprod3</code>. If you run <code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME dgprod3</code>, then RMAN resynchronizes the recovery catalog with the <code class="codeph">dgprod3</code> control file. In this case RMAN performs both a normal resynchronization, in which metadata flows from the <code class="codeph">dgprod3</code> control file to the catalog, and a <a href="glossary.htm#GUID-52C89ABD-D7C1-4FE1-9825-BCBF1973B156"><span class="xrefglossterm">reverse resynchronization</span></a>. In a reverse resynchronization, RMAN uses the persistent configurations in the recovery catalog to update the <code class="codeph">dgprod3</code> control file.</p>
<div class="infoboxnotealso" id="GUID-4394EE9B-2D71-4B44-BD08-217DAAEB94A6__GUID-644AB6AA-1230-417A-B2F3-F49D90C17C04">
<p class="notep1">See Also:</p>
<p><a class="olink SBYDB" target="_blank" href="../SBYDB/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a></p>
</div>
</div>
</div>
</div>
<a id="BRADV89682"></a>
<div class="props_rev_3"><a id="GUID-A7B674BE-0E9C-444D-8517-E7F7D83115D0"></a>
<h4 id="BRADV-GUID-A7B674BE-0E9C-444D-8517-E7F7D83115D0" class="sect4">Deciding When to Resynchronize the Recovery Catalog</h4>
<div>
<p>RMAN automatically resynchronizes the recovery catalog when RMAN is connected to a target database and recovery catalog and you have executed RMAN commands. Thus, you do not need to manually run the <code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> command very often.</p>
<div class="p">The following sections describe situations requiring a manual catalog resynchronization:
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-A4BEADEE-60C8-4CA8-9893-793EC799756F">Resynchronizing After the Recovery Catalog is Unavailable</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-20A5BE48-6303-4215-9E05-144E98733CCC">Resynchronizing in ARCHIVELOG Mode When You Back Up Infrequently</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-1A4258E7-24BE-45F0-9AA1-333A870BF5FF">Resynchronizing After Configuring a Standby Database</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D">Resynchronizing the Recovery Catalog Before Control File Records Age Out</a></p>
</li>
</ul>
</div>
</div>
<a id="BRADV89683"></a>
<div class="props_rev_3"><a id="GUID-A4BEADEE-60C8-4CA8-9893-793EC799756F"></a>
<h5 id="BRADV-GUID-A4BEADEE-60C8-4CA8-9893-793EC799756F" class="sect5">Resynchronizing After the Recovery Catalog is Unavailable</h5>
<div>
<p>If the recovery catalog is unavailable when you issue RMAN commands that cause a partial resynchronization, then open the catalog database later and resynchronize it manually with the <code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> command.</p>
<p>For example, the target database may be in New York while the recovery catalog database is in Japan. You may not want to make daily backups of the target database in <code class="codeph">CATALOG</code> mode, to avoid depending on the availability of a geographically distant database. In such a case you could connect to the catalog as often as feasible and run the <code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> command.</p>
</div>
</div>
<a id="BRADV89684"></a>
<div class="props_rev_3"><a id="GUID-20A5BE48-6303-4215-9E05-144E98733CCC"></a>
<h5 id="BRADV-GUID-20A5BE48-6303-4215-9E05-144E98733CCC" class="sect5">Resynchronizing in ARCHIVELOG Mode When You Back Up Infrequently</h5>
<div>
<p>Assume that a target database runs in <code class="codeph">ARCHIVELOG</code> mode. Also assume that you do the following:</p>
<ul style="list-style-type: disc;">
<li>
<p>Back up the database infrequently (for example, hundreds of redo logs are archived between database backups)</p>
</li>
<li>
<p>Generate a high number of log switches every day (for example, 1000 switches between catalog resynchronizations)</p>
</li>
</ul>
<p>In this case, you may want to manually resynchronize the recovery catalog regularly because the recovery catalog is <span class="italic">not</span> updated automatically when a redo log switch occurs or when a redo log is archived. The database stores metadata about redo log switches and archived redo logs only in the control file. You must periodically resynchronize to propagate this information into the recovery catalog.</p>
<p>How frequently you must resynchronize the recovery catalog depends on the rate at which the database archives redo logs. The cost of the operation is proportional to the number of records in the control file that have been inserted or changed since the previous resynchronization. If no records have been inserted or changed, then the cost of resynchronization is very low; if many records have been inserted or changed, then the resynchronization is more time-consuming.</p>
</div>
</div>
<a id="BRADV89686"></a>
<div class="props_rev_3"><a id="GUID-1A4258E7-24BE-45F0-9AA1-333A870BF5FF"></a>
<h5 id="BRADV-GUID-1A4258E7-24BE-45F0-9AA1-333A870BF5FF" class="sect5">Resynchronizing After Configuring a Standby Database</h5>
<div>
<p>You can create or change an RMAN configuration for a standby database even when not connected to this database as <code class="codeph">TARGET</code>. You perform this task with the <code class="codeph">CONFIGURE DB_UNIQUE_NAME</code> or <code class="codeph">CONFIGURE ... FOR DB_UNIQUE_NAME</code> command. As explained in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C">Manually Resynchronizing the Recovery Catalog</a>&#34;</span>, you can resynchronize the standby database manually to update the control file of the standby database.</p>
</div>
</div>
<a id="BRADV89687"></a>
<div class="props_rev_3"><a id="GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D"></a>
<h5 id="BRADV-GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D" class="sect5">Resynchronizing the Recovery Catalog Before Control File Records Age Out</h5>
<div>
<p>Your goal is to ensure that the metadata in the recovery catalog is current. Because the recovery catalog obtains its metadata from the target control file, the currency of the data in the catalog depends on the currency of the data in the control file. You must make sure that the backup metadata in the control file is recorded in the catalog before it is overwritten with new records.</p>
<p>The <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter determines the minimum number of days that records are retained in the control file before they are candidates for being overwritten. Thus, you must ensure that you resynchronize the recovery catalog with the control file records before these records are erased.</p>
<p>Perform either of the following actions at intervals less than the <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> setting:</p>
<ul style="list-style-type: disc;">
<li>
<p>Make a backup, thereby performing an implicit resynchronization of the recovery catalog</p>
</li>
<li>
<p>Manually resynchronize the recovery catalog with the <code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> command</p>
</li>
</ul>
<p>Make sure that <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> is longer than the interval between backups or resynchronizations. Otherwise, control file records could be reused before they are propagated to the recovery catalog. An extra week is a safe margin in most circumstances.</p>
<div class="infobox-note" id="GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D__GUID-65F32D0C-1AD7-4345-B0E3-DDE15275121F">
<p class="notep1">Caution:</p>
<p>Never set <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> to <code class="codeph">0</code>. If you do, then backup records may be overwritten in the control file before RMAN can add them to the catalog.</p>
</div>
<p>One problem can arise if the control file becomes too large. <a id="d57370e7143" class="indexterm-anchor"></a><a id="d57370e7149" class="indexterm-anchor"></a>The size of the target database control file grows depending on the number of:</p>
<ul style="list-style-type: disc;">
<li>
<p>Backups that you perform</p>
</li>
<li>
<p>Archived redo logs that the database generates</p>
</li>
<li>
<p>Days that this information is stored in the control file</p>
</li>
</ul>
<p>If the control file grows so large that it can no longer expand because it has reached either the maximum number of blocks or the maximum number of records, then the database may overwrite the oldest records even if their age is less than the <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> setting. In this case, the database writes a message to the alert log. If you discover that this situation occurs frequently, then reducing the value of <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> and increase the frequency of resynchronizations.</p>
<div class="infoboxnotealso" id="GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D__GUID-0C53A433-7810-4D57-A9E2-756424B75488">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN10020" target="_blank" href="../REFRN/GUID-58479E43-2CE8-4FFD-BD1C-CE3F8C583A75.htm#REFRN10020"><span class="italic">Oracle Database Reference</span></a> for more information about the <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> parameter</p>
</li>
<li>
<p><a class="olink ADMIN006" target="_blank" href="../ADMIN/control.htm#ADMIN006"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for more detailed information on other aspects of control file management</p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmmaint.htm#GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A">Preventing the Loss of Control File Records</a>&#34;</span> to learn how to monitor the overwriting of control file records</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<a id="BRADV89688"></a>
<div class="props_rev_3"><a id="GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C"></a>
<h4 id="BRADV-GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C" class="sect4">Manually Resynchronizing the Recovery Catalog</h4>
<div>
<div class="section">
<p><a id="d57370e7269" class="indexterm-anchor"></a><a id="d57370e7271" class="indexterm-anchor"></a><a id="d57370e7275" class="indexterm-anchor"></a>Use <code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> to force a full resynchronization of the recovery catalog with a target database control file. You can specify a database unique name with <code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME</code> or <code class="codeph">ALL</code>, depending on whether you want to resynchronize a specific database or all databases in the Data Guard environment. To use <code class="codeph">DB_UNIQUE_NAME ALL</code>, you must connect to the target database using password file authentication and as the <code class="codeph">SYS</code> user. Typically, you perform this operation after you run the <code class="codeph">CONFIGURE</code> command for a standby database, but have not yet connected to this standby database.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog.</span></li>
<li class="stepexpand"><span>Mount or open the target database:</span>
<div>
<pre dir="ltr">STARTUP MOUNT;
</pre></div>
</li>
<li class="stepexpand"><span>Resynchronize the recovery catalog.</span>
<div>
<p>Run the <code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> command at the RMAN prompt as follows:</p>
<pre dir="ltr">RESYNC CATALOG;
</pre>
<p>The following example resynchronizes the control file of <code class="codeph">standby1</code>:</p>
<pre dir="ltr">RESYNC CATALOG FROM DB_UNIQUE_NAME standby1;
</pre>
<p>The following variation, when connected to the target database as the <code class="codeph">SYS</code> user and using password file authentication, resynchronizes the control files for all databases in the Data Guard environment:</p>
<pre dir="ltr">RESYNC CATALOG FROM DB_UNIQUE_NAME ALL;
</pre>
<div class="infoboxnotealso" id="GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C__GUID-9C5925D9-47C3-4EA7-9456-055280482482">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF150" target="_blank" href="../RCMRF/rcmsynta2009.htm#RCMRF150"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code> command syntax</p>
</li>
<li>
<p><a class="olink SBYDB04700" target="_blank" href="../SBYDB/rman.htm#SBYDB04700"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> to learn how to configure the RMAN environment for use with a standby database</p>
</li>
</ul>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<a id="BRADV317"></a><a id="BRADV89690"></a>
<div class="props_rev_3"><a id="GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8"></a>
<h3 id="BRADV-GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8" class="sect3">Updating the Recovery Catalog After Changing a DB_UNIQUE_NAME</h3>
<div>
<div class="section">
<p>You may decide to change the <code class="codeph">DB_UNIQUE_NAME</code> of a database in a <a id="d57370e7436" class="indexterm-anchor"></a>Data Guard environment. In this case, you can run <a id="d57370e7441" class="indexterm-anchor"></a>the <code class="codeph">CHANGE DB_UNIQUE_NAME</code> command to associate the metadata stored in recovery catalog for the old <code class="codeph">DB_UNIQUE_NAME</code> to the new <code class="codeph">DB_UNIQUE_NAME</code>. The <code class="codeph">CHANGE DB_UNIQUE_NAME</code> command does not actually change the <code class="codeph">DB_UNIQUE_NAME</code> of the database itself. Instead, it updates the catalog metadata for the database whose unique name has been or will be changed.</p>
<p>The following procedure assumes that the <code class="codeph">DB_UNIQUE_NAME</code> of the primary database is <code class="codeph">prodny</code>, and that you have changed the <code class="codeph">DB_UNIQUE_NAME</code> of a standby database from <code class="codeph">prodsf1</code> to <code class="codeph">prodsf2</code>. You can use the same procedure after changing the <code class="codeph">DB_UNIQUE_NAME</code> of a <span class="italic">primary</span> database, except in Step <a href="rcmcatdb.htm#GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8__CHDCACIA">1</a> connect RMAN as <code class="codeph">TARGET</code> to a standby database instead of a primary database.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To update the recovery catalog after DB_UNIQUE_NAME is changed:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand" id="GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8__CHDCACIA"><span>Connect RMAN to the <span class="italic">primary</span> database as <code class="codeph">TARGET</code> and also to the recovery catalog. For example, enter the following commands:</span>
<div>
<pre dir="ltr">% rman
RMAN&gt; CONNECT CATALOG rco@catdb

recovery catalog database Password: <span class="italic">password</span>
connected to recovery catalog database

RMAN&gt; CONNECT TARGET sbu@prodny

target database Password: <span class="italic">password</span>
connected to target database: PRODNY (DBID=39525561)
</pre></div>
</li>
<li class="stepexpand"><span>List the <code class="codeph">DB_UNQUE_NAME</code> values known to the recovery catalog.</span>
<div>
<p>Run the following <code class="codeph">LIST</code> command:</p>
<pre dir="ltr">RMAN&gt; LIST DB_UNIQUE_NAME OF DATABASE;
</pre></div>
</li>
<li class="stepexpand"><span>Change the <code class="codeph">DB_UNIQUE_NAME</code> in the RMAN metadata.</span>
<div>
<p>The following example changes the database unique name from standby database <code class="codeph">prodsf1</code> to <code class="codeph">prodsf2</code>:</p>
<pre dir="ltr">RMAN&gt; CHANGE DB_UNIQUE_NAME FROM prodsf1 TO prodsf2;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV89691"></a>
<div class="props_rev_3"><a id="GUID-8E35106D-950D-409B-98CA-91E142212D6A"></a>
<h3 id="BRADV-GUID-8E35106D-950D-409B-98CA-91E142212D6A" class="sect3">Unregistering a Target Database from the Recovery Catalog</h3>
<div>
<p><a id="d57370e7614" class="indexterm-anchor"></a><a id="d57370e7616" class="indexterm-anchor"></a><a id="d57370e7618" class="indexterm-anchor"></a><a id="d57370e7622" class="indexterm-anchor"></a><a id="d57370e7626" class="indexterm-anchor"></a>You can use the <code class="codeph">UNREGISTER DATABASE</code> command to unregister a database from the recovery catalog. When a database is unregistered from the recovery catalog, all RMAN repository records in the recovery catalog are lost. The database can be registered again, but the recovery catalog records for that database are then based on the contents of the control file at the time of reregistration. Records older than the <code class="codeph">CONTROLFILE_RECORD_KEEP_TIME</code> setting in the target database control file are lost. Stored scripts, which are not stored in the control file, are also lost.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-7ECC38D1-F425-4C1C-ACDB-6F7078A0A42E">Unregistering a Target Database When Not in a Data Guard Environment</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-051D7B4D-906A-4329-BA0A-7E391F74CF59">Unregistering a Standby Database</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F">Unregistering a Target Database in a Recovery Appliance Environment</a></p>
</li>
</ul>
</div>
<a id="BRADV318"></a><a id="BRADV89692"></a>
<div class="props_rev_3"><a id="GUID-7ECC38D1-F425-4C1C-ACDB-6F7078A0A42E"></a>
<h4 id="BRADV-GUID-7ECC38D1-F425-4C1C-ACDB-6F7078A0A42E" class="sect4">Unregistering a Target Database When Not in a Data Guard Environment</h4>
<div>
<div class="section">
<p>This scenario assumes that you are not using the recovery catalog to store metadata for primary and standby databases.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To unregister a database:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect as <code class="codeph">TARGET</code> to the database to unregister. Also connect to the recovery catalog.</span>
<div>
<p>It is not necessary to connect to the target database, but if you do not, then you must specify the name of the target database in the <code class="codeph">UNREGISTER</code> command. If multiple databases have the same name in the recovery catalog, then you must create a <code class="codeph">RUN</code> block around the command and use <code class="codeph">SET DBID</code> to set the DBID for the database.</p>
</div>
</li>
<li class="stepexpand"><span>Make a note of the DBID as displayed by RMAN at startup.</span>
<div>
<p>For example, RMAN outputs a line of the following form when it connects to a target database that is open:</p>
<pre dir="ltr">connected to target database: PROD (DBID=39525561)
</pre></div>
</li>
<li class="stepexpand"><span>As a precaution, it may be useful to list all of the backups recorded in the recovery catalog using <code class="codeph">LIST BACKUP SUMMARY</code> and <code class="codeph">LIST COPY SUMMARY</code>. This way, you can recatalog backups not known to the control file if you later decide to reregister the database.</span></li>
<li class="stepexpand"><span>If your intention is to actually delete all backups of the database completely, then run <code class="codeph">DELETE</code> statements to delete all existing backups. Do not delete all backups if your intention is only to remove the database from the recovery catalog and rely on the control file to store the RMAN metadata for this database.</span>
<div>
<p>The following commands illustrate how to delete backups:</p>
<pre dir="ltr">DELETE BACKUP DEVICE TYPE sbt;
DELETE BACKUP DEVICE TYPE DISK;
DELETE COPY;
</pre>
<p>RMAN lists the backups that it intends to delete and prompts for confirmation before deleting them.</p>
</div>
</li>
<li class="stepexpand"><span>Run the <code class="codeph">UNREGISTER</code> <code class="codeph">DATABASE</code> command. For example:</span>
<div>
<pre dir="ltr">UNREGISTER DATABASE;
</pre>
<p>RMAN displays the database name and DBID, and prompts you for a confirmation:</p>
<pre dir="ltr">database name is &#34;RDBMS&#34; and DBID is 931696259
 
Do you really want to unregister the database (enter YES or NO)? yes
</pre>
<p>When the process is complete, RMAN outputs the following message:</p>
<pre dir="ltr">database unregistered from the recovery catalog
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV319"></a><a id="BRADV89693"></a>
<div class="props_rev_3"><a id="GUID-051D7B4D-906A-4329-BA0A-7E391F74CF59"></a>
<h4 id="BRADV-GUID-051D7B4D-906A-4329-BA0A-7E391F74CF59" class="sect4">Unregistering a Standby Database</h4>
<div>
<div class="section">
<p>The <code class="codeph">UNREGISTER</code> command supports a <code class="codeph">DB_UNIQUE_NAME</code> clause for use in a Data Guard environment. You can use this clause to remove metadata for a specific database.</p>
<p>The recovery catalog associates a backup with a particular database. When you unregister a database, RMAN updates the database name for these backup files to <code class="codeph">null</code>. Thus, the backups are still recorded but have no owner. You can execute the <code class="codeph">CHANGE ... RESET DB_UNIQUE_NAME</code> command to associate ownership of the currently ownerless backups to a different database. If you specify <code class="codeph">INCLUDING BACKUPS</code> on the <code class="codeph">UNREGISTER</code> command, then RMAN removes the backup metadata for the unregistered database as well.</p>
<p>In this scenario, assume that primary database <code class="codeph">lnx3</code> has associated standby database <code class="codeph">standby1</code>. You want to unregister the standby database.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To unregister a standby database:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect as <code class="codeph">TARGET</code> to the <span class="italic">primary</span> database. Also, connect RMAN to a recovery catalog.</span>
<div>
<p>For example, enter the following commands:</p>
<pre dir="ltr">% rman
RMAN&gt; CONNECT TARGET &#34;sbu@lnx3 AS SYSBACKUP&#34;;

target database Password: <span class="italic">password</span>
connected to target database: LNX3 (DBID=781317675)

RMAN&gt; CONNECT CATALOG rco@catdb;
</pre></div>
</li>
<li class="stepexpand"><span>List the database unique names.</span>
<div>
<p>For example, execute the <code class="codeph">LIST DB_UNIQUE_NAME</code> command as follows:</p>
<pre dir="ltr">RMAN&gt; LIST DB_UNIQUE_NAME OF DATABASE;

List of Databases
DB Key  DB Name DB ID             Database Role   Db_unique_name
------- ------- ----------------- --------------- ------------------
1       LNX3    781317675         STANDBY         STANDBY1
1       LNX3    781317675         PRIMARY         LNX3
</pre></div>
</li>
<li class="stepexpand"><span>Run the <code class="codeph">UNREGISTER</code> <code class="codeph">DB_UNIQUE_NAME</code> command.</span>
<div>
<p>For example, execute the <code class="codeph">UNREGISTER</code> command as follows to unregister database <code class="codeph">standby</code>:</p>
<pre dir="ltr">RMAN&gt; UNREGISTER DB_UNIQUE_NAME standby1;
</pre>
<p>RMAN displays the database name and DBID, and prompts you for a confirmation:</p>
<pre dir="ltr">database db_unique_name is &#34;standby1&#34;, db_name is &#34;LNX3&#34; and DBID is 781317675
 
Do you really want to unregister the database (enter YES or NO)? yes
</pre>
<p>When the process is complete, RMAN outputs the following message:</p>
<pre dir="ltr">database with db_unique_name standby1 unregistered from the recovery catalog
</pre></div>
</li>
</ol>
</div>
</div>
<a id="BRADV769"></a>
<div class="props_rev_3"><a id="GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F"></a>
<h4 id="BRADV-GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F" class="sect4">Unregistering a Target Database in a Recovery Appliance Environment</h4>
<div>
<div class="section">
<p>In a <a href="glossary.htm#GUID-238433D1-4ED8-412E-978F-24197B953D94"><span class="xrefglossterm">Zero Data Loss Recovery Appliance (Recovery Appliance)</span></a> environment, the <code class="codeph">UNREGISTER DATABASE</code> command cannot be used to unregister a protected database from the Recovery Appliance catalog. Instead, use the <code class="codeph">DBMS_RA.DELETE_DB</code> procedure.</p>
<p><span class="bold">To unregister a target database from the Recovery Appliance recovery catalog:</span></p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Obtain the <code class="codeph">DB_NAME</code> of the protected database that you want to unregister.</span></li>
<li class="stepexpand"><span>(Optional) To delete all the backups associated with this protected database, perform the following steps:</span>
<div>
<ul style="list-style-type: disc;">
<li>
<p>Connect to the protected database as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</p>
</li>
<li>
<p>Use the following commands to delete all backups:</p>
<pre dir="ltr">DELETE BACKUP DEVICE TYPE sbt;
DELETE BACKUP DEVICE TYPE DISK;
DELETE COPY;
</pre>
<p>RMAN lists the backups that it intends to delete and prompts for confirmation before deleting them.</p>
</li>
</ul>
</div>
</li>
<li class="stepexpand"><span>Start SQL*Plus and connect to the Recovery Appliance metadata database as <code class="codeph">RASYS</code> (Recovery Appliance catalog owner).</span></li>
<li class="stepexpand"><span>Unregister the protected database from Recovery Appliance using the <code class="codeph">DBMS_RA.DELETE_DB</code> procedure.</span>
<div>
<pre dir="ltr">begin
      DBMS_RA.DELETE_DB(&#39;TEST_DB&#39;);
end;
/
</pre>
<p>RMAN prompts you to confirm the unregister database operation.</p>
</div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F__GUID-FEE4B1D1-B574-48CD-8B3C-5B6FADE0AF5A">
<p class="notep1">See Also:</p>
<p><a class="olink AMAGD1348" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=AMAGD1348"><span class="italic">Zero Data Loss Recovery Appliance Administrator&#39;s Guide</span></a> for details of the <code class="codeph">DBMS_RA.DELETE_DB</code> procedure</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV320"></a><a id="BRADV89694"></a>
<div class="props_rev_3"><a id="GUID-304B2237-0921-422F-A084-D83E7B5C8D2B"></a>
<h3 id="BRADV-GUID-304B2237-0921-422F-A084-D83E7B5C8D2B" class="sect3">Resetting the Database Incarnation in the Recovery Catalog</h3>
<div>
<div class="section">
<p><a id="d57370e8208" class="indexterm-anchor"></a>As explained in <span class="q">&#34;<a href="rcmrvcon.htm#GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D">About Database Incarnations</a>&#34;</span>, you create an <a href="glossary.htm#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">incarnation</span></a> of the database when you open the database with the <code class="codeph">RESETLOGS</code> option. You can access a record of the new incarnation in the <a id="d57370e8225" class="indexterm-anchor"></a><code class="codeph">V$DATABASE_INCARNATION</code> view.</p>
<p><a id="d57370e8231" class="indexterm-anchor"></a><a id="d57370e8235" class="indexterm-anchor"></a>If you open the database with the <code class="codeph">RESETLOGS</code> option, then a new database incarnation record is automatically created in the recovery catalog. The database also implicitly and automatically issues a <code class="codeph">RESET</code> <code class="codeph">DATABASE</code> command, which specifies that this new incarnation of the database is the current incarnation. All subsequent backups and log archiving done by the target database is associated with the new database incarnation.</p>
<p>Whenever RMAN returns the database to an SCN before the current <code class="codeph">RESETLOGS</code> SCN, either with <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> or <code class="codeph">FLASHBACK DATABASE</code>, the <code class="codeph">RESET DATABASE TO INCARNATION</code> command is required. However, you do not need to execute <code class="codeph">RESET DATABASE TO INCARNATION</code> explicitly in the following scenarios because RMAN runs the command implicitly with Flashback.</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><a id="d57370e8274" class="indexterm-anchor"></a>You use <code class="codeph">FLASHBACK DATABASE</code> to rewind the database to an SCN in the <a href="glossary.htm#GUID-9FA6E4CA-C9C0-47E8-8FDF-2C2A313F8944"><span class="xrefglossterm">direct ancestral path</span></a> (see <span class="q">&#34;<a href="rcmrvcon.htm#GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D">About Database Incarnations</a>&#34;</span> for an explanation of the direct ancestral path).</p>
</li>
<li>
<p>You use <code class="codeph">FLASHBACK DATABASE</code> to rewind the database to a <a href="glossary.htm#GUID-A5A5E7B1-72B6-4F50-8E11-04C03EB5FFAE"><span class="xrefglossterm">restore point</span></a>.</p>
</li>
</ul>
<p>The following procedure explains how to reset the database incarnation when recovering through a <code class="codeph">RESETLOGS</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To reset the recovery catalog to an older incarnation for media recovery:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Determine the incarnation key of the desired database incarnation. Obtain the incarnation key value by issuing a <code class="codeph">LIST</code> command:</span>
<div>
<pre dir="ltr">LIST INCARNATION OF DATABASE trgt;

List of Database Incarnations
DB Key  Inc Key   DB Name   DB ID       STATUS     Reset SCN    Reset Time
------- -------   -------   ------      -------    ----------   ----------
1       2         TRGT      1224038686  PARENT     1            02-JUL-12
1       582       TRGT      1224038686  CURRENT    59727        10-JUL-12

</pre>
<p>The incarnation key is listed in the <code class="codeph">Inc Key</code> column.</p>
</div>
</li>
<li class="stepexpand"><span>Reset the database to the old incarnation. For example, enter:</span>
<div>
<pre dir="ltr">RESET DATABASE TO INCARNATION 2;
</pre></div>
</li>
<li class="stepexpand"><span>If the control file of the previous incarnation is available and mounted, then skip to Step 6 of this procedure. Otherwise, shut down the database and start it without mounting. For example:</span>
<div>
<pre dir="ltr">SHUTDOWN IMMEDIATE
STARTUP NOMOUNT
</pre></div>
</li>
<li class="stepexpand"><span>Restore a control file from the old incarnation. If you have a control file tagged, then specify the tag. Otherwise, you can run the <code class="codeph">SET</code> <code class="codeph">UNTIL</code> command, as in this example:</span>
<div>
<pre dir="ltr">RUN 
{
  SET UNTIL &#39;SYSDATE-45&#39;;
  RESTORE CONTROLFILE; # only if current control file is not available
}
</pre></div>
</li>
<li class="stepexpand"><span>Mount the restored control file:</span>
<div>
<pre dir="ltr">ALTER DATABASE MOUNT;
</pre></div>
</li>
<li class="stepexpand"><span>Run <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to restore and recover the database files from the prior incarnation, then open the database with the <code class="codeph">RESETLOGS</code> option. For example, enter:</span>
<div>
<pre dir="ltr">RESTORE DATABASE;
RECOVER DATABASE;
ALTER DATABASE OPEN RESETLOGS;
</pre>
<div class="infoboxnotealso" id="GUID-304B2237-0921-422F-A084-D83E7B5C8D2B__GUID-F500125B-BEA7-4AD8-AD99-85C9EFA4D783">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF148" target="_blank" href="../RCMRF/rcmsynta2007.htm#RCMRF148"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">RESET</code> <code class="codeph">DATABASE</code> syntax, <a class="olink RCMRF132" target="_blank" href="../RCMRF/rcmsynta027.htm#RCMRF132"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">LIST</code> syntax</p>
</div>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV188"></a>
<div class="props_rev_3"><a id="GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7"></a>
<h3 id="BRADV-GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7" class="sect3">Upgrading the Recovery Catalog</h3>
<div>
<p><a id="d57370e8460" class="indexterm-anchor"></a>This section explains what a recovery catalog upgrade is and when you must do it.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-A16CF9F7-822F-46E0-A87D-C9433F49453E">About Recovery Catalog Upgrades</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52">Determining the Schema Version of the Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC">Using the UPGRADE CATALOG Command</a></p>
</li>
</ul>
</div>
<a id="BRADV89695"></a>
<div class="props_rev_3"><a id="GUID-A16CF9F7-822F-46E0-A87D-C9433F49453E"></a>
<h4 id="BRADV-GUID-A16CF9F7-822F-46E0-A87D-C9433F49453E" class="sect4">About Recovery Catalog Upgrades</h4>
<div>
<p>If you are upgrading to Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), then the recovery catalog database must use the Enterprise Edition of Oracle Database.</p>
<p>If you use a version of the recovery catalog schema that is older than that required by the RMAN client, then you must upgrade it. The compatibility matrix in <a class="olink RCMRF005" target="_blank" href="../RCMRF/compat.htm#RCMRF005"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> explains which schema versions are compatible with which versions of RMAN. For example, you must upgrade the catalog if you use an Oracle Database 11<span class="italic">g</span> RMAN client with a release 10.2 version of the recovery catalog schema.<a id="d57370e8566" class="indexterm-anchor"></a><a id="d57370e8570" class="indexterm-anchor"></a><a id="d57370e8576" class="indexterm-anchor"></a><a id="d57370e8578" class="indexterm-anchor"></a></p>
<p>The Oracle Database 10<span class="italic">g</span> Release 1 version of the recovery catalog schema requires the <code class="codeph">CREATE TYPE</code> privilege. If you created the recovery catalog owner in a release before 10<span class="italic">g</span>R1, and if you granted the <code class="codeph">RECOVERY_CATALOG_OWNER</code> role when it did not include the <code class="codeph">CREATE TYPE</code> privilege, then you must grant <code class="codeph">CREATE TYPE</code> to this user explicitly before upgrading the catalog.</p>
<p>You receive an error when issuing <code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code> if the recovery catalog is at a version greater than that required by the RMAN client. RMAN permits the <code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code> command to be run if the recovery catalog is current and does not require upgrading, however, so that you can re-create packages at any time if necessary. Check the message log for error messages generated during the upgrade.</p>
</div>
<a id="BRADV89696"></a>
<div class="props_rev_3"><a id="GUID-BE7ACDDE-200F-477C-9CA3-C157BE4772AC"></a>
<h5 id="BRADV-GUID-BE7ACDDE-200F-477C-9CA3-C157BE4772AC" class="sect5">Special Considerations for Upgrading the Recovery Catalog in a Data Guard Environment</h5>
<div>
<p>Assume that you upgrade the recovery catalog schema to Oracle Database 11<span class="italic">g</span> in a Data Guard environment. When RMAN connects to a standby database, it automatically registers the new database information and resynchronizes to obtain the file names from the control file.</p>
<p>During the resynchronization, RMAN associates the names with the target database name. Because the recovery catalog contains historical metadata, some records in the catalog are not known to the control file. For example, the <code class="codeph">standby1</code> control file does not know about all backups made on <code class="codeph">primary1</code>. The database unique name for these old records is <code class="codeph">null</code>. As explained in <span class="q">&#34;<a href="rcmcatdb.htm#GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9">About Recovery Catalog Maintenance</a>&#34;</span>, you can use <code class="codeph">CROSSCHECK</code> to fix these records.</p>
</div>
</div>
</div>
<a id="BRADV321"></a><a id="BRADV11032"></a>
<div class="props_rev_3"><a id="GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52"></a>
<h4 id="BRADV-GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52" class="sect4">Determining the Schema Version of the Recovery Catalog</h4>
<div>
<div class="section">
<p>The schema version of the recovery catalog is stored in the recovery catalog itself. The information is important in case you maintain multiple databases of different versions in your production system, and you must determine whether the catalog schema version is usable with a specific target database version.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To determine the schema version of the recovery catalog:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start SQL*Plus and connect to the recovery catalog database as the catalog owner.</span></li>
<li class="stepexpand"><span>Query the <code class="codeph">RCVER</code> table to obtain the schema version, as in the following example (sample output included):</span>
<div>
<pre dir="ltr">SELECT *
FROM   rcver;

VERSION
------------
12.01.00.01 
</pre></div>
</li>
</ol>
<div class="section">
<p>If the table displays multiple rows, then the highest version in the <code class="codeph">RCVER</code> table is the current catalog schema version. The table stores only the major version numbers and not the patch numbers. For example, assume that the <code class="codeph">rcver</code> table displays the following rows:</p>
<pre dir="ltr">VERSION
------------
10.02.00
11.02.00
12.01.00.01
</pre>
<p>These rows indicate that the catalog was created with a release 10.2.0 executable, then upgraded to release 11.2.0, and finally upgraded to release 12.1.0.1. The current version of the catalog schema is 12.1.0.1.</p>
<div class="infoboxnotealso" id="GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52__GUID-F3DADD67-4CD7-4D56-B277-BB015E895F1E">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF005" target="_blank" href="../RCMRF/compat.htm#RCMRF005"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for the complete set of compatibility rules governing the RMAN environment</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV322"></a><a id="BRADV89697"></a>
<div class="props_rev_3"><a id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC"></a>
<h4 id="BRADV-GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC" class="sect4">Using the UPGRADE CATALOG Command</h4>
<div>
<div class="section">
<p>This scenario assumes that you are upgrading a recovery catalog schema to the current version.</p>
<div class="infobox-note" id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC__GUID-25E7E38B-95CA-416F-B42F-0D4596FF8847">
<p class="notep1">Note:</p>
Starting with Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), the recovery catalog database must use the Enterprise Edition of Oracle Database.</div>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To upgrade the recovery catalog to Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.1):</p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li>
<p>If you created the recovery catalog owner in a release before 10<span class="italic">g</span>R1, and if the <code class="codeph">RECOVERY_CATALOG_OWNER</code> role did not include the <code class="codeph">CREATE TYPE</code> privilege, then grant it.</p>
<p>For example, start SQL*Plus and connect to the recovery catalog database with administrator privileges. You can then execute the following <code class="codeph">GRANT</code> statement:</p>
<pre dir="ltr">SQL&gt; GRANT CREATE TYPE TO rman;
SQL&gt; EXIT;
</pre></li>
<li>
<p>Start RMAN and connect RMAN to the recovery catalog database.</p>
</li>
<li>
<p>Run the <code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code> command:</p>
<pre dir="ltr">RMAN&gt; UPGRADE CATALOG;

recovery catalog owner is rman 
enter UPGRADE CATALOG command again to confirm catalog upgrade 
</pre></li>
<li>
<p>Run the <code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code> command again to confirm:</p>
<pre dir="ltr">RMAN&gt; UPGRADE CATALOG;

recovery catalog upgraded to version 12.01.00.01
DBMS_RCVMAN package upgraded to version 12.01.00.01
DBMS_RCVCAT package upgraded to version 12.01.00.01
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To upgrade the recovery catalog to Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2):</p>
<ol>
<li>
<p>Enable Oracle Partitioning for the recovery catalog database.</p>
</li>
<li>
<p>If the recovery catalog database uses the Standard Edition, then use one of the following techniques:</p>
<ul style="list-style-type: disc;">
<li>
<p>Migrate the recovery catalog database from Standard Edition to Enterprise Edition.</p>
<div class="infobox-note" id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC__GUID-6C6B6216-7BB3-4CCE-9022-C55B9A368CA3">
<p class="notep1">Note:</p>
<span class="italic">Oracle Database Upgrade Guide</span> for information about moving to the Enterprise Edition</div>
</li>
</ul>
<ul style="list-style-type: disc;">
<li>
<p>Move the recovery catalog into an Oracle Enterprise Edition database and then use the <code class="codeph">IMPORT CATALOG</code> command to import the recovery catalog into this database.</p>
</li>
</ul>
</li>
<li>
<p>Use SQL*Plus to connect to the recovery catalog database as the <code class="codeph">SYS</code> user with the <code class="codeph">SYSDBA</code> privilege.</p>
</li>
<li>
<p>Run the <code class="codeph">dbmsrmansys.sql</code> script to grant additional privileges that are required for the <code class="codeph">RECOVERY_CATALOG_OWNER</code> role.</p>
<pre dir="ltr">SQL&gt; @$ORACLE_HOME/rdbms/admin/dbmsrmansys.sql
</pre></li>
<li>
<p>Exit SQL*Plus.</p>
</li>
<li>
<p>Start RMAN and connect RMAN to the recovery catalog database.</p>
</li>
<li>
<p>Run the <code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code> command:</p>
<pre dir="ltr">RMAN&gt; UPGRADE CATALOG;

recovery catalog owner is rman 
enter UPGRADE CATALOG command again to confirm catalog upgrade 
</pre></li>
<li>
<p>Run the <code class="codeph">UPDATE</code> <code class="codeph">CATALOG</code> command again to confirm:</p>
<pre dir="ltr">RMAN&gt; UPGRADE CATALOG;

recovery catalog upgraded to version 12.01.00.01
DBMS_RCVMAN package upgraded to version 12.01.00.01
DBMS_RCVCAT package upgraded to version 12.01.00.01
</pre></li>
</ol>
</div>
<!-- class="section" -->
<div class="section">
<div class="infoboxnotealso" id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC__GUID-90701C06-70A1-4C85-812D-5CF7A711AFDA">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink RCMRF161" target="_blank" href="../RCMRF/rcmsynta2024.htm#RCMRF161"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code> command syntax</p>
</li>
<li>
<p><a class="olink RCMRF908" target="_blank" href="../RCMRF/compat.htm#RCMRF908"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for information about recovery catalog compatibility</p>
</li>
<li>
<p><a class="olink UPGRD" target="_blank" href="../UPGRD/toc.htm"><span class="italic">Oracle Database Upgrade Guide</span></a> for complete compatibility and migration information</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV89698"></a>
<div class="props_rev_3"><a id="GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C"></a>
<h3 id="BRADV-GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C" class="sect3">Importing and Moving a Recovery Catalog</h3>
<div>
<p><a id="d57370e9122" class="indexterm-anchor"></a>You can use <a id="d57370e9127" class="indexterm-anchor"></a><a id="d57370e9129" class="indexterm-anchor"></a>the <code class="codeph">IMPORT CATALOG</code> command in RMAN to merge one recovery catalog schema into another. This command is useful in the following situations:</p>
<ul style="list-style-type: disc;">
<li>
<p>You have multiple recovery catalog schemas for different versions of the database. You want to merge all existing schemas into one without losing backup metadata.</p>
</li>
<li>
<p>You want to move a recovery catalog from one database to another database.</p>
</li>
</ul>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="rcmcatdb.htm#GUID-5AF2CC06-52F0-46E3-BA27-38477383672C">About Recovery Catalog Imports</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36">About Importing Recovery Catalogs in a Recovery Appliance Environment</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-52C875C7-03D3-457A-B9B9-BBAF057D47C3">Prerequisites for Importing a Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5">Importing a Recovery Catalog</a></p>
</li>
<li>
<p><a href="rcmcatdb.htm#GUID-E9D1588E-F4F7-4E7D-A8B9-6DB43F175635">Moving a Recovery Catalog</a></p>
</li>
</ul>
</div>
<a id="BRADV89699"></a>
<div class="props_rev_3"><a id="GUID-5AF2CC06-52F0-46E3-BA27-38477383672C"></a>
<h4 id="BRADV-GUID-5AF2CC06-52F0-46E3-BA27-38477383672C" class="sect4">About Recovery Catalog Imports</h4>
<div>
<p>When using <code class="codeph">IMPORT CATALOG</code>, the <strong class="term">source catalog schema</strong> is the catalog schema to import into a different schema. The <strong class="term">destination catalog schema</strong> is the catalog schema into which you intend to import the source catalog schema.</p>
<p>By default, RMAN imports metadata from all target databases registered in the source recovery catalog. Optionally, you can specify the list of database IDs to be imported from the source catalog schema.</p>
<p>By default, RMAN unregisters the imported databases from the source catalog schema after a successful import. To indicate whether the unregister was successful, RMAN prints messages before and after unregistering the merged databases. You can also specify the <code class="codeph">NO UNREGISTER</code> option to specify that the databases is not unregistered from the source catalog.</p>
<p>A <a id="d57370e9260" class="indexterm-anchor"></a><a href="glossary.htm#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">stored script</span></a> is either global or local. It is possible for global scripts, but not local scripts, to have name conflicts during import because the destination schema already contains the script name. In this case, RMAN renames the global script name to <code class="codeph">COPY OF</code> <span class="italic"><code class="codeph">script_name</code></span>. For example, RMAN renames <code class="codeph">bp_cmd</code> to <code class="codeph">COPY OF bp_cmd</code>.</p>
<p>If the renamed global script is still not unique, then RMAN renames it to <code class="codeph">COPY(2) OF</code> <span class="italic"><code class="codeph">script_name</code></span>. If this script name also exists, then RMAN renames the script to <code class="codeph">COPY(3) OF</code> <span class="italic"><code class="codeph">script_name</code></span>. RMAN continues the <code class="codeph">COPY(</code><span class="italic"><code class="codeph">n</code></span><code class="codeph">) OF</code> pattern until the script is uniquely named.</p>
</div>
</div>
<a id="BRADV770"></a>
<div class="props_rev_3"><a id="GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36"></a>
<h4 id="BRADV-GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36" class="sect4">About Importing Recovery Catalogs in a Recovery Appliance Environment</h4>
<div>
<p>In a Recovery Appliance environment, a single, centrally-managed Recovery Appliance catalog residing on the Recovery Appliance is shared by all the protected databases. This catalog must be used by all protected databases that send backups to Recovery Appliance.</p>
<p>When you move protected databases to a data protection strategy that uses Recovery Appliance, you can choose to migrate existing backups and backup metadata to Recovery Appliance. To migrate backup metadata, you must import the RMAN recovery catalog into the Recovery Appliance catalog.</p>
<div class="infoboxnotealso" id="GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36__GUID-014FA197-0449-4F86-9C36-B2C30EA552F3">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink AMAGD231" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=AMAGD231"><span class="italic">Zero Data Loss Recovery Appliance Administrator&#39;s Guide</span></a> for an overview of the Recovery Appliance catalog</p>
</li>
<li>
<p><a class="olink AMPDB892" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=AMPDB892"><span class="italic">Zero Data Loss Recovery Appliance Protected Database Configuration Guide</span></a> for the steps to migrate backups and backup metadata</p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV89700"></a>
<div class="props_rev_3"><a id="GUID-52C875C7-03D3-457A-B9B9-BBAF057D47C3"></a>
<h4 id="BRADV-GUID-52C875C7-03D3-457A-B9B9-BBAF057D47C3" class="sect4">Prerequisites for Importing a Recovery Catalog</h4>
<div>
<p>As shown in compatibility matrix in <a class="olink RCMRF005" target="_blank" href="../RCMRF/compat.htm#RCMRF005"><span class="italic">Oracle Database Backup and Recovery Reference</span></a>, a target database, recovery catalog database, and recovery catalog schema can be at different database versions. The recommended practice is to import all existing recovery catalogs into a single recovery catalog at the latest version of the recovery catalog schema. <span class="q">&#34;<a href="rcmcatdb.htm#GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52">Determining the Schema Version of the Recovery Catalog</a>&#34;</span> explains how to determine the catalog version. Check the compatibility matrix to determine which schema versions are compatible in your environment.</p>
<p>When using <code class="codeph">IMPORT CATALOG</code>, the version of the source recovery catalog schema must be equal to the current version of the RMAN executable with which you run the command. If the source catalog schema is a <span class="italic">lower</span> version, then upgrade it to the current version before importing the schema. <span class="q">&#34;<a href="rcmcatdb.htm#GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7">Upgrading the Recovery Catalog</a>&#34;</span> explains how to upgrade. If the source recovery catalog schema is a <span class="italic">higher</span> version, then retry the import with a higher version RMAN executable.</p>
<p>No database can be registered in both the source and destination catalog schema. If a database is currently registered in both catalog schemas, then unregister the database from source catalog schema before performing the import.</p>
</div>
</div>
<a id="BRADV323"></a><a id="BRADV89701"></a>
<div class="props_rev_3"><a id="GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5"></a>
<h4 id="BRADV-GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5" class="sect4">Importing a Recovery Catalog</h4>
<div>
<div class="section">
<p>When importing one recovery catalog into another, no connection to a target database is necessary. RMAN only needs connectivity to the source and destination catalogs.</p>
<p>In this example, database <code class="codeph">srcdb</code> contains a 10.2 recovery catalog schema owned by user <code class="codeph">102cat</code>, while database <code class="codeph">destdb</code> contains an 11.1 recovery catalog schema owned by user <code class="codeph">111cat</code>.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To import a recovery catalog:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect as <code class="codeph">CATALOG</code> to the destination recovery catalog schema. For example:</span>
<div>
<pre dir="ltr">% rman
RMAN&gt; CONNECT CATALOG 111cat@destdb;
</pre></div>
</li>
<li class="stepexpand"><span>Import the source recovery catalog schema, specifying the connection string for the source catalog.</span>
<div>
<p>For example, enter the following command to import the catalog owned by <code class="codeph">102cat</code> on database <code class="codeph">srcdb</code>:</p>
<pre dir="ltr">IMPORT CATALOG 102cat@srcdb;
</pre>
<p>A variation is to import metadata for a subset of the target databases registered in the source catalog. You can specify the databases by DBID or database name, as shown in the following examples:</p>
<pre dir="ltr">IMPORT CATALOG 102cat@srcdb DBID=1423241, 1423242;
IMPORT CATALOG 102cat@srcdb DB_NAME=prod3, prod4;
</pre></div>
</li>
<li class="stepexpand"><span>Optionally, connect to a target database to check that the metadata was successfully imported. For example, the following commands connect to database <code class="codeph">prod1</code> as <code class="codeph">TARGET</code> and list all backups for this database:</span>
<div>
<pre dir="ltr">CONNECT TARGET &#34;sbu@prod1 AS SYSBACKUP&#34;;
LIST BACKUP;
</pre>
<p><code class="codeph">sbu</code> is a user who is granted the <code class="codeph">SYSBACKUP</code> privilege in the target database.</p>
</div>
</li>
</ol>
</div>
</div>
<a id="BRADV89702"></a>
<div class="props_rev_3"><a id="GUID-E9D1588E-F4F7-4E7D-A8B9-6DB43F175635"></a>
<h4 id="BRADV-GUID-E9D1588E-F4F7-4E7D-A8B9-6DB43F175635" class="sect4">Moving a Recovery Catalog</h4>
<div>
<div class="section">
<p><a id="d57370e9693" class="indexterm-anchor"></a>The procedure for moving a recovery catalog from one database to another is a variation of the procedure for importing a catalog. In this scenario, the source database is the database containing the existing recovery catalog, while the destination database contains the moved recovery catalog.</p>
<p>To move a recovery catalog from the source database to the destination database:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Create a recovery catalog on the destination database, but do not register any databases in the new catalog.</span>
<div>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8">Creating a Recovery Catalog</a>&#34;</span> explains how to perform this task.</p>
</div>
</li>
<li class="stepexpand"><span>Import the source catalog into the catalog created in the preceding step.</span>
<div>
<p><span class="q">&#34;<a href="rcmcatdb.htm#GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5">Importing a Recovery Catalog</a>&#34;</span> explains how to perform this task.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<a id="BRADV324"></a><a id="BRADV189"></a>
<div class="props_rev_3"><a id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40"></a>
<h2 id="BRADV-GUID-F9345920-0731-40FA-B44A-CE8F50E09B40" class="sect2">Dropping a Recovery Catalog</h2>
<div>
<div class="section">
<p><a id="d57370e9793" class="indexterm-anchor"></a><a id="d57370e9797" class="indexterm-anchor"></a><a id="d57370e9801" class="indexterm-anchor"></a><a id="d57370e9803" class="indexterm-anchor"></a>The <code class="codeph">DROP</code> <code class="codeph">CATALOG</code> command removes those objects that were created by the <code class="codeph">CREATE CATALOG</code> command. If the user who owns the recovery catalog also owns objects that were <span class="italic">not</span> created by <code class="codeph">CREATE CATALOG</code>, then the <code class="codeph">DROP CATALOG</code> command does not remove these objects.</p>
<p>If you drop a recovery catalog, and if you have no backups of the recovery catalog schema, then backups of all target databases registered in this catalog may become unusable. However, the control file of every target database still retains a record of recent backups of this database.</p>
<p>The <code class="codeph">DROP</code> <code class="codeph">CATALOG</code> command is not appropriate for unregistering a single database from a recovery catalog that has multiple target databases registered. Dropping the recovery catalog deletes the recovery catalog record of backups for all target databases registered in the catalog.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead2">To drop a recovery catalog schema:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog. Connect to the recovery catalog as the owner of the catalog schema to be dropped.</span>
<div>
<p>The following example connects to a recovery catalog as user <code class="codeph">rco</code>:</p>
<pre dir="ltr">% rman TARGET / CATALOG rco@catdb
</pre></div>
</li>
<li class="stepexpand"><span>Run the <code class="codeph">DROP</code> <code class="codeph">CATALOG</code> command:</span>
<div>
<pre dir="ltr">DROP CATALOG;

recovery catalog owner is rco
enter DROP CATALOG command again to confirm catalog removal
</pre></div>
</li>
<li class="stepexpand"><span>Run the <code class="codeph">DROP</code> <code class="codeph">CATALOG</code> command again to confirm:</span>
<div>
<pre dir="ltr">DROP CATALOG;
</pre>
<div class="infobox-note" id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40__GUID-D32523AE-09BF-4A8B-B7F3-E515B275EE54">
<p class="notep1">Note:</p>
<p>Even after you drop the recovery catalog, the control file still contains records about the backups. To purge RMAN repository records from the control file, re-create the control file.</p>
</div>
<div class="infoboxnotealso" id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40__GUID-25E7F61B-02B3-4D5B-BE31-EEE621BE5323">
<p class="notep1">See Also:</p>
<p><a class="olink RCMRF125" target="_blank" href="../RCMRF/rcmsynta018.htm#RCMRF125"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">DROP</code> <code class="codeph">CATALOG</code> command syntax, and <span class="q">&#34;<a href="rcmcatdb.htm#GUID-8E35106D-950D-409B-98CA-91E142212D6A">Unregistering a Target Database from the Recovery Catalog</a>&#34;</span> to learn how to unregister a database from the catalog</p>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="rcmmaint.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="part_dia.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>