<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-2616"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Using%20Flashback%20Database%20and%20Restore%20Points"></a><title>Using Flashback Database and Restore Points</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="Flashback Database, enabling, disabling"/>
<meta name="dcterms.created" content="2017-06-07T23:52:16Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"/>
<meta name="dcterms.identifier" content="E50658-09"/>
<meta name="dcterms.isVersionOf" content="BRADV"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="rcmconfa.htm" title="Previous" type="text/html"/>
<link rel="Next" href="part_bak.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E50658-09.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-909BBEEF-389B-443B-8CD7-F3C027AAFFF3"></a> <span id="PAGE" style="display:none;">16/48</span> <!-- End Header -->
<a id="BRADV71000"></a>
<h1 id="BRADV-GUID-909BBEEF-389B-443B-8CD7-F3C027AAFFF3" class="sect1"><span class="enumeration_chapter">7</span> Using Flashback Database and Restore Points</h1>
<div>
<p>This chapter explains Flashback Database and restore points. It discusses configuring, monitoring, and maintaining these features as part of an overall data protection strategy.</p>
<p>This chapter contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="flashdb.htm#GUID-FAA04D1F-36E2-4B20-954F-845E42386775">Overview of Flashback Database_ Restore Points and Guaranteed Restore Points</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-E90F7FBD-CCE2-4234-A3B4-FDFEC3BC2E90">About Logging for Flashback Database and Guaranteed Restore Points</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D">Prerequisites for Flashback Database and Guaranteed Restore Points</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09">Using Normal and Guaranteed Restore Points</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-4E96DB60-3616-4680-866A-F38A6049053A">Using Flashback Database</a></p>
</li>
</ul>
<div class="infobox-note" id="GUID-909BBEEF-389B-443B-8CD7-F3C027AAFFF3__GUID-DC5B60B4-8FC2-4C41-B8BF-DBF72DC7ABCE">
<p class="notep1">Note:</p>
<p>Detailed information on recovery scenarios that use Flashback Database and normal and guaranteed restore points can be found in <a href="rcmflash.htm#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B">Performing Flashback and Database Point-in-Time Recovery</a>.</p>
</div>
</div>
<a id="BRADV180"></a>
<div class="props_rev_3"><a id="GUID-FAA04D1F-36E2-4B20-954F-845E42386775"></a>
<h2 id="BRADV-GUID-FAA04D1F-36E2-4B20-954F-845E42386775" class="sect2">Overview of Flashback Database, Restore Points and Guaranteed Restore Points</h2>
<div>
<p><a href="glossary.htm#GUID-DD883C9B-0441-48D3-9DDC-755597782971"><span class="xrefglossterm">Oracle Flashback Database</span></a> and restore points are related data protection features that enable you to rewind data back in time to correct any problems caused by logical data corruption or user errors within a designated time window. These features provide a more efficient alternative to point-in-time recovery and does not require a backup of the database to be restored first. The effects are similar to <a href="glossary.htm#GUID-FCC8BB91-79B6-4AF1-974A-43E75CD161E3"><span class="xrefglossterm">database point-in-time recovery (DBPITR)</span></a>. Flashback Database and restore points are not only effective in traditional database recovery situations but can also be useful during database upgrades, application deployments and testing scenarios when test databases must be quickly created and re-created. Flashback Database also provides an efficient alternative to rebuilding a failed primary database after a Data Guard failover.</p>
<div class="infoboxnotealso" id="GUID-FAA04D1F-36E2-4B20-954F-845E42386775__GUID-DB8A922F-0AA5-403B-BC4F-D927F669F039">
<p class="notep1">See Also:</p>
<p><a class="olink SBYDB" target="_blank" href="../SBYDB/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a></p>
</div>
<p>Restore points provide capabilities related to Flashback Database and other media recovery operations. In particular, a guaranteed restore point created at a system change number (SCN) ensures that you can use Flashback Database to rewind the database to this SCN. You can use restore points and Flashback Database independently or together.</p>
<p>Flashback Database is accessible through both RMAN and SQL as <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>. You can use either language to quickly recover the database from logical data corruption or user errors. The following examples return the database to a specified SCN or restore point:</p>
<pre dir="ltr">FLASHBACK DATABASE TO RESTORE POINT &#39;before_upgrade&#39;;
FLASHBACK DATABASE TO SCN 202381;
</pre></div>
<a id="BRADV582"></a>
<div class="props_rev_3"><a id="GUID-509FB7A6-4CB2-4730-80CA-7B2D68F50773"></a>
<h3 id="BRADV-GUID-509FB7A6-4CB2-4730-80CA-7B2D68F50773" class="sect3">About Flashback Database</h3>
<div>
<p><a id="d32076e267" class="indexterm-anchor"></a>Flashback Database is similar to conventional point-in-time recovery in its effects. It enables you to return a database to its state at a time in the recent past. Flashback Database is much faster than point-in-time recovery because it does not require restoring data files from backup and requires applying fewer changes from the archived redo logs.</p>
<p>You can use Flashback Database to reverse most unwanted changes to a database if the data files are intact. You can return a database to its state in a previous <a href="glossary.htm#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">incarnation</span></a>, and undo the effects of an <a class="olink SQLRF00802" target="_blank" href="../SQLRF/statements_1006.htm#SQLRF00802"><code class="codeph">ALTER DATABASE OPEN RESETLOGS</code></a> statement. <span class="q">&#34;<a href="rcmflash.htm#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F">Rewinding a Database with Flashback Database</a>&#34;</span> explains how to use the <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> command to reverse database changes.</p>
<p>Flashback Database uses its own logging mechanism, creating <a id="d32076e296" class="indexterm-anchor"></a><a href="glossary.htm#GUID-725ED3D7-5077-4F16-85AA-CDAD5BFCE554"><span class="xrefglossterm">flashback logs</span></a> and storing them in the <a href="glossary.htm#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a>. You can only use Flashback Database if flashback logs are available. To take advantage of this feature, you must set up your database in advance to create flashback logs.</p>
<p>To enable Flashback Database, you configure a fast recovery area and set a <a id="d32076e308" class="indexterm-anchor"></a><a href="glossary.htm#GUID-F472DAAD-F619-47F7-B025-7FE21FD9E5DB"><span class="xrefglossterm">flashback retention target</span></a>. This retention target specifies how far back you can rewind a database with Flashback Database.</p>
<p>From that time onwards, at regular intervals, the database copies images of each altered block in every data file into the flashback logs. These block images can later be reused to reconstruct the data file contents for any moment at which logs were captured.</p>
<p>When you use Flashback Database to rewind a database to a past target time, the command determines which blocks changed after the target time and restores them from the flashback logs. The database restores the version of each block that is immediately before the target time. The database then uses redo logs to reapply changes that were made after these blocks were written to the flashback logs.</p>
<p>Redo logs on disk or tape must be available for the entire time period spanned by the flashback logs. For example, if the flashback retention target is 1 week, then you must ensure that online and archived redo logs that contain all changes for the past week are accessible. In practice, redo logs are typically needed much longer than the flashback retention target to support point-in-time recovery.</p>
</div>
</div>
<a id="BRADV583"></a>
<div class="props_rev_3"><a id="GUID-9699CDF3-C01E-4104-8452-8F01443760AC"></a>
<h3 id="BRADV-GUID-9699CDF3-C01E-4104-8452-8F01443760AC" class="sect3">About Flashback Database Window</h3>
<div>
<p>The range of SCNs for which there is currently enough flashback log data to support the <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> command is called the <a id="d32076e396" class="indexterm-anchor"></a><a id="d32076e398" class="indexterm-anchor"></a><a href="glossary.htm#GUID-C25BCFCE-4DE2-499A-A5E3-407A774FE9F3"><span class="xrefglossterm">flashback database window</span></a>. The flashback database window cannot extend further back than the earliest SCN in the available flashback logs.</p>
<div class="infobox-note" id="GUID-9699CDF3-C01E-4104-8452-8F01443760AC__GUID-CA78ADB1-9F49-4235-ADF1-471147F6858A">
<p class="notep1">Note:</p>
<p>Some database operations, such as dropping a tablespace or shrinking a data file, cannot be reversed with Flashback Database. See <span class="q">&#34;<a href="flashdb.htm#GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB">Limitations of Flashback Database</a>&#34;</span> for details.</p>
</div>
<p>You cannot back up flashback logs to locations outside the fast recovery area. To increase the likelihood that enough flashback logs are retained to meet the flashback database window, you can increase the space in your fast recovery area (see <span class="q">&#34;<a href="rcmconfb.htm#GUID-233338E2-3EE6-4248-A2B6-16A7899DB14F__CHDDJJHE" title="This table describes the DB_RECOVERY_FILE_DEST_SIZE and DB_RECOVERY_FILE_DEST parameters.">Table 5-3</a>&#34;</span>).</p>
<p>If the fast recovery area is not large enough to hold the flashback logs and files such as archived redo logs and other backups needed for the retention policy, then the database may delete flashback logs from the earliest SCNs forward to make room for other files. Consequently, the flashback database window can be shorter than the flashback retention target, depending on the size of the fast recovery area, other backups that must be retained, and how much flashback logging data is needed. The flashback retention target is a target, not a guarantee that Flashback Database is available.</p>
<p>If you cannot use <code class="codeph">FLASHBACK DATABASE</code> because the flashback database window is not long enough, then usually you can use database point-in-time recovery (DBPITR) to achieve a similar result. Guaranteed restore points are the only way to ensure that you can use Flashback Database to return to a specific point in time or guarantee the size of the flashback window.</p>
<div class="infoboxnotealso" id="GUID-9699CDF3-C01E-4104-8452-8F01443760AC__GUID-CDAA88FD-BB79-406E-882C-4FFBA793F84D">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="rcmflash.htm#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F">Rewinding a Database with Flashback Database</a>&#34;</span> to learn about Flashback Database</p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmflash.htm#GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0">Performing Database Point-in-Time Recovery</a>&#34;</span> to learn about DBPITR</p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV286"></a>
<div class="props_rev_3"><a id="GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB"></a>
<h3 id="BRADV-GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB" class="sect3">Limitations of Flashback Database</h3>
<div>
<p><a id="d32076e515" class="indexterm-anchor"></a>Because Flashback Database works by undoing changes to the data files that exist at the moment when you run the command, it has the following limitations:</p>
<ul style="list-style-type: disc;">
<li>
<p>Flashback Database can only undo changes to a data file made by Oracle Database. It cannot be used to repair media failures, or to recover from accidental deletion of data files.</p>
</li>
<li>
<p>You cannot use Flashback Database to undo a shrink data file operation. However, you can take the shrunken file offline, flash back the rest of the database, and then later restore and recover the shrunken data file.</p>
</li>
<li>
<p>You cannot use Flashback Database alone to retrieve a dropped data file. If you flash back a database to a time when a dropped data file existed in the database, only the data file entry is added to the control file. You can only recover the dropped data file by using RMAN to fully restore and recover the data file.</p>
</li>
<li>
<p>If the database control file is restored from backup or re-created, all accumulated flashback log information is discarded. You cannot use <code class="codeph">FLASHBACK DATABASE</code> to return to a point in time before the restore or re-creation of a control file.</p>
</li>
<li>
<p>When using Flashback Database with a target time at which a <code class="codeph">NOLOGGING</code> operation was in progress, block corruption is likely in the database objects and data files affected by the <code class="codeph">NOLOGGING</code> operation. For example, if you perform a direct-path <code class="codeph">INSERT</code> operation in <code class="codeph">NOLOGGING</code> mode, and that operation runs from 9:00 to 9:15 on April 3, 2005, and you later use Flashback Database to return to the target time 09:07 on that date, the objects and data files updated by the direct-path <code class="codeph">INSERT</code> may be left with block corruption after the Flashback Database operation completes.</p>
<p>If possible, avoid using Flashback Database with a target time or SCN that coincides with a <code class="codeph">NOLOGGING</code> operation. Also, perform a full or incremental backup of the affected data files immediately after any <code class="codeph">NOLOGGING</code> operation to ensure recoverability to points in time after the operation. If you expect to use Flashback Database to return to a point in time during an operation such as a direct-path <code class="codeph">INSERT</code>, consider performing the operation in <code class="codeph">LOGGING</code> mode.</p>
<div class="infoboxnotealso" id="GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB__GUID-76D3EF63-9FC7-4084-ACEA-9F811164EAEA">
<p class="notep1">See Also:</p>
<p><code class="codeph">LOGGING_CLAUSE</code> in <a class="olink SQLRF" target="_blank" href="../SQLRF/toc.htm"><span class="italic">Oracle Database SQL Language Reference</span></a> for more information about operations that support <code class="codeph">NOLOGGING</code> mode.</p>
</div>
</li>
</ul>
</div>
</div>
<a id="BRADV529"></a>
<div class="props_rev_3"><a id="GUID-1EE0CCDD-BAA4-402B-B808-D228212AF772"></a>
<h3 id="BRADV-GUID-1EE0CCDD-BAA4-402B-B808-D228212AF772" class="sect3">About Normal Restore Points</h3>
<div>
<p>Creating a <a href="glossary.htm#GUID-565076C7-1651-4D58-9F8E-9617561A450A"><span class="xrefglossterm">normal restore point</span></a> assigns a restore point name to an SCN or specific point in time. Thus, a restore point functions as a bookmark or alias for this SCN. Before performing any operation that you may have to reverse, you can create a normal restore point. The control file stores the name of the restore point and the SCN.</p>
<p>If you use flashback features or point-in-time recovery, then you can use the name of the restore point instead of a time or SCN. The following commands support this use of restore points:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <a class="olink RCMRF140" target="_blank" href="../RCMRF/rcmsynta2001.htm#RCMRF140"><code class="codeph">RECOVER DATABASE</code></a> and <code class="codeph">FLASHBACK DATABASE</code> commands in RMAN</p>
</li>
<li>
<p>The <a class="olink SQLRF01802" target="_blank" href="../SQLRF/statements_9013.htm#SQLRF01802"><code class="codeph">FLASHBACK TABLE</code></a> statement in SQL</p>
</li>
</ul>
<p>Creating a normal restore point eliminates manually recording an SCN in advance or determine the correct SCN after the fact by using features such as Flashback Query.</p>
<p>Normal restore points are lightweight. The control file can maintain a record of thousands of normal restore points with no significant effect on database performance. Normal restore points eventually age out of the control file if not manually deleted, so they require no ongoing maintenance.</p>
<div class="infoboxnotealso" id="GUID-1EE0CCDD-BAA4-402B-B808-D228212AF772__GUID-04F2EBB0-9D6A-42CE-A57B-278B783C0C6F">
<p class="notep1">See Also:</p>
<p><a class="olink ADFNS1008" target="_blank" href="../ADFNS/adfns_flashback.htm#ADFNS1008"><span class="italic">Oracle Database Development Guide</span></a> to learn how to use Flashback Query</p>
</div>
</div>
</div>
<a id="BRADV530"></a>
<div class="props_rev_3"><a id="GUID-82523F18-5AE7-40C8-972D-35A9423F19B7"></a>
<h3 id="BRADV-GUID-82523F18-5AE7-40C8-972D-35A9423F19B7" class="sect3">About Guaranteed Restore Points</h3>
<div>
<p>Like a normal restore point, a <a href="glossary.htm#GUID-CC1A7D5D-50B6-4F90-89DE-855B21C299F2"><span class="xrefglossterm">guaranteed restore point</span></a> serves as an alias for an SCN in recovery operations. A principal difference is that guaranteed restore points never age out of the control file and must be explicitly dropped. In general, you can use a guaranteed restore point as an alias for an SCN with any command that works with a normal restore point. Except as noted, the information about where and how to use normal restore points applies to guaranteed restore points as well.</p>
<p><a id="d32076e763" class="indexterm-anchor"></a><a id="d32076e767" class="indexterm-anchor"></a><a id="d32076e771" class="indexterm-anchor"></a>A guaranteed restore point ensures that you can use Flashback Database to rewind a database to its state at the restore point SCN, even if the generation of <a href="glossary.htm#GUID-725ED3D7-5077-4F16-85AA-CDAD5BFCE554"><span class="xrefglossterm">flashback logs</span></a> is disabled. If flashback logging is enabled, then a guaranteed restore point enforces the retention of flashback logs required for Flashback Database to any SCN after the earliest guaranteed restore point. Thus, if flashback logging is enabled, you can rewind the database to any SCN in the continuum rather than to a single SCN only.</p>
<div class="infobox-note" id="GUID-82523F18-5AE7-40C8-972D-35A9423F19B7__GUID-6108369A-D8BC-4DD7-93F6-A811F2A453E9">
<p class="notep1">Note:</p>
<p>If flashback logging is disabled, then you <span class="italic">cannot</span> <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> directly to SCNs between the guaranteed restore points and the current time. You can, however, flashback to the guaranteed restore point first and then recover to SCN&#39;s between the guaranteed restore point and current time.</p>
</div>
<p>If the recovery area has enough disk space to store the needed logs, then you can use a guaranteed restore point to rewind a whole database to a known good state days or weeks ago. As with Flashback Database, even the effects of <code class="codeph">NOLOGGING</code> operations like direct load inserts can be reversed with guaranteed restore points.</p>
<div class="infobox-note" id="GUID-82523F18-5AE7-40C8-972D-35A9423F19B7__GUID-B993BD4D-AB0A-4E19-B8EA-0FF07F26656E">
<p class="notep1">Note:</p>
<p>Limitations that apply to Flashback Database also apply to guaranteed restore points. For example, shrinking a data file or dropping a tablespace can prevent flashing back the affected data files to the guaranteed restore point. See <span class="q">&#34;<a href="flashdb.htm#GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB">Limitations of Flashback Database</a>&#34;</span> for details. In addition, when there are guaranteed restore points in the database, the database compatibility parameter cannot be set to a higher database version. An attempt to do so results in an error. This restriction exists because flashback database is currently unable to reverse the effects of increasing the database version with the compatibility initialization parameter.</p>
</div>
</div>
<a id="BRADV543"></a>
<div class="props_rev_3"><a id="GUID-F70E202F-A53C-4E33-AB0F-7091EA3DE608"></a>
<h4 id="BRADV-GUID-F70E202F-A53C-4E33-AB0F-7091EA3DE608" class="sect4">Guaranteed Restore Points versus Storage Snapshots</h4>
<div>
<p><a id="d32076e874" class="indexterm-anchor"></a><a id="d32076e878" class="indexterm-anchor"></a>In <a id="d32076e885" class="indexterm-anchor"></a><a id="d32076e887" class="indexterm-anchor"></a>practice, guaranteed restore points provide a useful alternative to storage snapshots. Storage snapshots are often used to protect a database before risky operations such as large-scale database updates or application patches or upgrades. Rather than creating a snapshot or <a href="glossary.htm#GUID-FFB6CFD5-300C-4290-B3C0-BFD930ACA30C"><span class="xrefglossterm">duplicate database</span></a> to test the operation, you can create a guaranteed restore point on a primary or <a href="glossary.htm#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">physical standby database</span></a>. You can then perform the risky operation with the certainty that the required flashback logs are retained.</p>
</div>
</div>
</div>
</div>
<a id="BRADV577"></a>
<div class="props_rev_3"><a id="GUID-E90F7FBD-CCE2-4234-A3B4-FDFEC3BC2E90"></a>
<h2 id="BRADV-GUID-E90F7FBD-CCE2-4234-A3B4-FDFEC3BC2E90" class="sect2">About Logging for Flashback Database and Guaranteed Restore Points</h2>
<div>
<p>Logging for Flashback Database and guaranteed restore points involves capturing images of data file blocks before changes are applied. The <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> command can use these images to return the data files to their previous state.</p>
<p>The chief differences between normal flashback logging and logging for guaranteed restore points are related to when blocks are logged and whether the logs can be deleted in response to space pressure in the fast recovery area. These differences affect space usage for logs and database performance.</p>
<p>Your recoverability goals partially determine whether to enable logging for flashback database, or use guaranteed restore points, or both. The implications in performance and in space usage for these features, separately and when used together, also factor into your decision.</p>
</div>
<a id="BRADV581"></a>
<div class="props_rev_3"><a id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE"></a>
<h3 id="BRADV-GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE" class="sect3">Guaranteed Restore Points and Fast Recovery Area Space Usage</h3>
<div>
<p>The following rules govern creating, retaining, overwriting and deleting of flashback logs in the fast recovery area:<a id="d32076e1050" class="indexterm-anchor"></a></p>
<ul style="list-style-type: disc;">
<li>
<p>If the fast recovery area has enough space, then a flashback log is created whenever necessary to satisfy the flashback retention target.</p>
</li>
<li>
<p>If a flashback log is old enough that it is no longer needed to satisfy the flashback retention target, then a flashback log is reused.</p>
</li>
<li>
<p>If the database must create a flashback log and the fast recovery area is full or there is no disk space, then the oldest flashback log is reused instead.</p>
<div class="infobox-note" id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE__GUID-AF4F2CFC-7C8D-4C5D-8922-E0FF099A4C11">
<p class="notep1">Note:</p>
<p>Reusing the oldest flashback log shortens the flashback database window. If enough flashback logs are reused due to a lack of disk space, then the flashback retention target may not be satisfied.</p>
</div>
</li>
<li>
<p>If the fast recovery area is full, then an archived redo log that is reclaimable according to the fast recovery area rules may be automatically deleted by the fast recovery area to make space for other files. In this case, any flashback logs that require the use of that redo log file for the use of <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> are also deleted.</p>
<div class="infobox-note" id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE__GUID-8D953A0A-806D-43DB-AF26-DFA84707E8FE">
<p class="notep1">Note:</p>
<p>According to fast recovery area rules, a file is reclaimable when one of the following criteria is true:</p>
<ul style="list-style-type: disc;">
<li>
<p>The file is reported as obsolete and not needed by the flashback database. For example, the file is outside the <code class="codeph">DB_FLASHBACK_RETENTION_TARGET</code> parameters.</p>
</li>
<li>
<p>The file is backed up to tape.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Files in the fast recovery area are not eligible for deletion if they are required to satisfy a guaranteed restore point. However, archived redo logs required to satisfy a guaranteed restore point may be deleted after they are backed up to disk or tape. When you use the RMAN <code class="codeph">FLASHBACK DATABASE</code> command, if the archived redo logs required to satisfy a specified guaranteed restore point are not available in the fast recovery area, they are restored from the backups.</p>
<p>Retention of flashback logs and other files required to satisfy the guaranteed restore point, in addition to files required to satisfy the backup retention policy, can cause the fast recovery area to fill completely. Consult <span class="q">&#34;<a href="rcmmaint.htm#GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F">Responding to a Full Fast Recovery Area</a>&#34;</span> if your fast recovery area becomes full.</p>
</li>
</ul>
<p>When you create a guaranteed restore point, with or without enabling full flashback database logging, you must monitor the space available in your fast recovery area. <span class="q">&#34;<a href="rcmmaint.htm#GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C">Managing Space for Flashback Logs in the Fast Recovery Area</a>&#34;</span> explains how to monitor fast recovery area disk space usage.</p>
<div class="infobox-note" id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE__GUID-DE859F0F-29CD-4859-9113-B871BD4DC08D">
<p class="notep1">Caution:</p>
<p>If no files are eligible for deletion from the fast recovery area because of the requirements imposed by your retention policy and the guaranteed restore point, then the database performs as if it has encountered a disk full condition. In many circumstances, this causes your database to halt. See <span class="q">&#34;<a href="rcmmaint.htm#GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F">Responding to a Full Fast Recovery Area</a>&#34;</span>.</p>
</div>
</div>
</div>
<a id="BRADV584"></a>
<div class="props_rev_3"><a id="GUID-D0FAAADC-6185-4F8D-A557-18346EE3BDFF"></a>
<h3 id="BRADV-GUID-D0FAAADC-6185-4F8D-A557-18346EE3BDFF" class="sect3">About Logging for Guaranteed Restore Points with Flashback Logging Disabled</h3>
<div>
<p>Assume that you create a guaranteed restore point when logging for Flashback Database is disabled. In this case, the first time a data file block is modified after the time of the guaranteed restore point, the database stores an image of the block before the modification in the flashback logs. Thus, the flashback logs preserve the contents of every changed data block when the guaranteed restore point was created. Later modifications to the same block do not cause the contents to be logged again unless another guaranteed restore point was created after the block was last modified or a subsequent flashback database operation has restored the original contents of the block. When you use Flashback Database to restore a database multiple times to the same restore point, it is common practise to drop and recreate the guaranteed restore point each time. This deletes the old flashback logs and also ensures that the space quota for the fast recovery area is not exceeded.</p>
<p>This method of logging has the following important consequences:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> can re-create the data file contents at the time of a guaranteed restore point by using the block images.</p>
</li>
<li>
<p>For workloads that repeatedly modify the same data, disk space usage can be less than normal flashback logging. Less space is needed because each changed block is only logged once. Applications with low volume inserts may benefit from this disk space saving. This advantage is less likely for applications with high volume inserts or large batch inserts. The performance overhead of logging for a guaranteed restore point without flashback database logging enabled can also be lower.</p>
</li>
</ul>
<p>Assume that your primary goal is the ability to return your database to the time at which the guaranteed restore point was created. In this case, it is usually more efficient to turn off flashback logging and use only guaranteed restore points. For example, suppose that you are performing an application upgrade on a database host over a weekend. You could create a guaranteed restore point at the start of the upgrade. If the upgrade fails, then reverse the changes with the <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> command.</p>
</div>
</div>
<a id="BRADV585"></a>
<div class="props_rev_3"><a id="GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D"></a>
<h3 id="BRADV-GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D" class="sect3">About Logging for Flashback Database with Guaranteed Restore Points Defined</h3>
<div>
<p>If you enable Flashback Database and define one or more guaranteed restore points, then the database performs normal flashback logging. In this case, the recovery area retains the flashback logs required to flash back to any arbitrary time between the present and the earliest currently defined guaranteed restore point. Flashback logs are not deleted in response to space pressure if they are required to satisfy the guarantee.</p>
<p>Flashback logging causes some performance overhead. Depending upon the pattern of activity on your database, it can also cause significant space pressure in the fast recovery area. Thus, you should monitor space used in the fast recovery area.</p>
</div>
</div>
</div>
<a id="BRADV587"></a><a id="BRADV588"></a><a id="BRADV586"></a>
<div class="props_rev_3"><a id="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D"></a>
<h2 id="BRADV-GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" class="sect2">Prerequisites for Flashback Database and Guaranteed Restore Points</h2>
<div>
<p>To ensure successful operation of Flashback Database and guaranteed restore points, you must first set some key database options.</p>
<div class="section">
<p class="subhead2">Flashback Database</p>
</div>
<!-- class="section" -->
<p>Configure the following database settings before enabling Flashback Database:</p>
<ul style="list-style-type: disc;">
<li>
<p><a id="d32076e1363" class="indexterm-anchor"></a>Your database must be running in <code class="codeph">ARCHIVELOG</code> mode, because archived logs are used in the Flashback Database operation.</p>
</li>
<li>
<p>You must have a fast recovery area enabled, because flashback logs can only be stored in the fast recovery area.</p>
</li>
<li>
<p>For Oracle Real Application Clusters (Oracle RAC) databases, the fast recovery area must be in a clustered file system or in ASM.</p>
</li>
</ul>
<div class="section">
<p class="subhead2">Guaranteed Restore Points</p>
</div>
<!-- class="section" -->
<p><a id="d32076e1381" class="indexterm-anchor"></a><a id="d32076e1385" class="indexterm-anchor"></a>To use guaranteed restore points, the database must satisfy the following additional prerequisite: the <a class="olink REFRN10019" target="_blank" href="../REFRN/GUID-6C57EE11-BD06-4BB8-A0F7-D6CDDD086FA9.htm#REFRN10019"><code class="codeph">COMPATIBLE</code></a> initialization parameter must be set to 10.2.0 or greater</p>
<div class="infobox-note" id="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D__GUID-5DA71B43-3FF6-410F-ADC8-7002C19DA1EA">
<p class="notep1">Note:</p>
<p>There are no special prerequisites to set before using normal restore points.</p>
</div>
</div>
</div>
<a id="BRADV589"></a>
<div class="props_rev_3"><a id="GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09"></a>
<h2 id="BRADV-GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09" class="sect2">Using Normal and Guaranteed Restore Points</h2>
<div>
<p>This section describes the various commands and monitoring capabilities you use with normal and guaranteed restore points.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="flashdb.htm#GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1">Creating Normal and Guaranteed Restore Points</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D">Listing Restore Points</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-A1563822-015B-4941-B7EB-C3D44A63232C">Dropping Restore Points</a></p>
</li>
</ul>
</div>
<a id="BRADV591"></a><a id="BRADV590"></a>
<div class="props_rev_3"><a id="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1"></a>
<h3 id="BRADV-GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1" class="sect3">Creating Normal and Guaranteed Restore Points</h3>
<div>
<div class="section">
<p><a id="d32076e1557" class="indexterm-anchor"></a><a id="d32076e1561" class="indexterm-anchor"></a>To create normal or guaranteed restore points, use the <a class="olink SQLRF20001" target="_blank" href="../SQLRF/statements_6013.htm#SQLRF20001"><code class="codeph">CREATE RESTORE POINT</code></a> SQL statement, providing a name for the restore point and specifying whether it is to be a guaranteed restore point or a normal one (the default).</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To create a restore point:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Connect SQL*Plus to a target database.</span>
<div>
<div class="infoboxnotealso" id="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1__GUID-B60F84B6-AF9E-436D-8665-24189928BC26">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN00102" target="_blank" href="http://www.oracle.com/pls/topic/lookup?ctx=E50529-01&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for using SQL*Plus to connect to a database</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Ensure that the database is open or mounted. If the database is mounted, then it must have been shut down cleanly (unless it is a physical standby database).</span></li>
<li class="stepexpand"><span>Run the <code class="codeph">CREATE RESTORE POINT</code> statement.</span>
<div>
<p>The following example shows how to create a normal restore point in SQL*Plus:</p>
<pre dir="ltr">SQL&gt; CREATE RESTORE POINT before_upgrade;
</pre>
<p>This example shows how to create a guaranteed restore point:</p>
<pre dir="ltr">SQL&gt; CREATE RESTORE POINT before_upgrade GUARANTEE FLASHBACK DATABASE;
</pre></div>
</li>
</ol>
<div class="section">
<div class="infoboxnotealso" id="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1__GUID-2071B65F-23F8-44AF-A55F-C3E871D9D02B">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink SQLRF20001" target="_blank" href="../SQLRF/statements_6013.htm#SQLRF20001"><span class="italic">Oracle Database SQL Language Reference</span></a> for reference information about the SQL <code class="codeph">CREATE RESTORE POINT</code> statement</p>
</li>
<li>
<p><span class="q">&#34;<a href="flashdb.htm#GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D">Listing Restore Points</a>&#34;</span> to learn how to list restore point</p>
</li>
<li>
<p><span class="q">&#34;<a href="flashdb.htm#GUID-A1563822-015B-4941-B7EB-C3D44A63232C">Dropping Restore Points</a>&#34;</span> to learn how to delete restore points</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV592"></a>
<div class="props_rev_3"><a id="GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D"></a>
<h3 id="BRADV-GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D" class="sect3">Listing Restore Points</h3>
<div>
<div class="section">
<p><a id="d32076e1701" class="indexterm-anchor"></a>You can use the <code class="codeph">LIST</code> command to list either a specific restore point or all restore points known to the RMAN repository. The variations of the command are as follows:</p>
<pre dir="ltr">LIST RESTORE POINT <span class="italic">restore_point_name</span>;
LIST RESTORE POINT ALL;
</pre>
<p>RMAN indicates the SCN and time of the restore point, the type of restore point, and the name of the restore point. The following example shows sample output:</p>
<pre dir="ltr">RMAN&gt; LIST RESTORE POINT ALL;
 
using target database control file instead of recovery catalog
SCN              RSP Time  Type       Time      Name
---------------- --------- ---------- --------- ----
341859           28-JUL-06            28-JUL-06 NORMAL_RS
343690           28-JUL-06 GUARANTEED 28-JUL-06 GUARANTEED_RS
</pre>
<p>To see a list of all currently defined restore points (normal and guaranteed), use the <code class="codeph">V$RESTORE_POINT</code> control file view in the following query:</p>
<pre dir="ltr">SQL&gt; SELECT NAME, SCN, TIME, DATABASE_INCARNATION#,
        GUARANTEE_FLASHBACK_DATABASE,STORAGE_SIZE
        FROM V$RESTORE_POINT;
</pre>
<p>The output from the view:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Name of each restore point (guaranteed and normal)</p>
</li>
<li>
<p>SCN</p>
</li>
<li>
<p>Time and database incarnation number when the restore points were created</p>
</li>
<li>
<p>Type of restore point (normal or guaranteed)</p>
</li>
<li>
<p>Amount of space in the fast recovery area being used to support information needed for Flashback Database operations for that restore point</p>
</li>
</ul>
<p><a id="d32076e1745" class="indexterm-anchor"></a>For normal restore points, <code class="codeph">STORAGE_SIZE</code> is zero. For guaranteed restore points, <code class="codeph">STORAGE_SIZE</code> indicates the amount of disk space in the fast recovery area used to retain logs required to guarantee <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> to that restore point.</p>
<div class="infoboxnotealso" id="GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D__GUID-4195DB14-20E0-460E-A713-BCFED405EB8B">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN30390" target="_blank" href="../REFRN/GUID-19A363CF-E112-4BFE-8457-E5BB5FAF6FFB.htm#REFRN30390"><span class="italic">Oracle Database Reference</span></a> for information about <code class="codeph">V$RESTORE_POINT</code></p>
</li>
<li>
<p><span class="q">&#34;<a href="rcmflash.htm#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F">Rewinding a Database with Flashback Database</a>&#34;</span></p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV593"></a>
<div class="props_rev_3"><a id="GUID-A1563822-015B-4941-B7EB-C3D44A63232C"></a>
<h3 id="BRADV-GUID-A1563822-015B-4941-B7EB-C3D44A63232C" class="sect3">Dropping Restore Points</h3>
<div>
<div class="section">
<p>When you are satisfied that you do not need an existing restore point, or when you want to create a restore point with the name of an existing restore point, you can drop the restore point, using the <code class="codeph">DROP RESTORE POINT</code> SQL*Plus statement. For example:</p>
<pre dir="ltr">SQL&gt; DROP RESTORE POINT before_app_upgrade;
Restore point dropped.
</pre>
<p>The same statement is used to drop both normal and guaranteed restore points.</p>
<div class="infobox-note" id="GUID-A1563822-015B-4941-B7EB-C3D44A63232C__GUID-C8141E34-1290-4E83-BDEE-5C4A65BA07D2">
<p class="notep1">Note:</p>
<p>Normal restore points eventually age out of the control file, even if not explicitly dropped. The rules governing retention of restore points in the control file are:</p>
<ul style="list-style-type: disc;">
<li>
<p>The most recent 2048 restore points are always kept in the control file, regardless of their age.</p>
</li>
<li>
<p>Any restore point more recent than the value of <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> is retained, regardless of how many restore points are defined.</p>
</li>
</ul>
<p>Normal restore points that do not meet either of these conditions may age out of the control file.</p>
</div>
<p>Guaranteed restore points never age out of the control file. They remain until they are explicitly dropped.</p>
<div class="infobox-note" id="GUID-A1563822-015B-4941-B7EB-C3D44A63232C__GUID-CF9D23CC-90DF-4B8C-B01A-0FF25B10A8E0">
<p class="notep1">See also:</p>
<p><a class="olink SQLRF20002" target="_blank" href="../SQLRF/statements_8031.htm#SQLRF20002"><span class="italic">Oracle Database SQL Language Reference</span></a> for reference information about the SQL <code class="codeph">DROP RESTORE POINT</code> statement</p>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="BRADV594"></a>
<div class="props_rev_3"><a id="GUID-4E96DB60-3616-4680-866A-F38A6049053A"></a>
<h2 id="BRADV-GUID-4E96DB60-3616-4680-866A-F38A6049053A" class="sect2">Using Flashback Database</h2>
<div>
<p>This section describes the basic commands for Flashback Database. It also lists guidelines to ensure optimal performance of Flashback Database.</p>
<p>This section contains the following topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="flashdb.htm#GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4">Enabling Flashback Database</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-B343C3D9-0CA1-49E5-AC62-1E872E9966A6">Disabling Flashback Database Logging</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045">Configuring the Environment for Optimal Flashback Database Performance</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-19A3894F-22A9-49B1-91F4-951E9824C95F">Monitoring the Effect of Flashback Database on Performance</a></p>
</li>
<li>
<p><a href="flashdb.htm#GUID-C6E3FBBA-188F-4D26-AC7D-31ED3D190E88">About Flashback Writer (RVWR) Behavior with I/O Errors</a></p>
</li>
</ul>
</div>
<a id="BRADV596"></a><a id="BRADV595"></a>
<div class="props_rev_3"><a id="GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4"></a>
<h3 id="BRADV-GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4" class="sect3">Enabling Flashback Database</h3>
<div>
<div class="section">
<p>Follow these steps to enable Flashback Database.</p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3">To enable flashback logging:</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Ensure the database instance is open or mounted. If the instance is mounted, then the database must be shut down cleanly unless it is a physical standby database. Other Oracle RAC instances can be in any mode.</span></li>
<li class="stepexpand"><span>Configure the recovery area as described in <span class="q">&#34;<a href="rcmconfb.htm#GUID-233338E2-3EE6-4248-A2B6-16A7899DB14F">Enabling the Fast Recovery Area</a>&#34;</span>.</span></li>
<li class="stepexpand"><span>Optionally, set the <code class="codeph">DB_FLASHBACK_RETENTION_TARGET</code> to the length of the desired flashback window in minutes:</span>
<div>
<pre dir="ltr">ALTER SYSTEM SET DB_FLASHBACK_RETENTION_TARGET=4320; # 3 days
</pre>
<p>By default <code class="codeph">DB_FLASHBACK_RETENTION_TARGET</code> is set to 1 day (1440 minutes).</p>
<div class="infobox-note" id="GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4__GUID-B8D2BB65-B88E-4547-AF77-1B8B9EFA6CD4">
<p class="notep1">Note:</p>
<p>This setting must be persistent across database startup and shutdown.</p>
</div>
</div>
</li>
<li class="stepexpand"><span>Enable the Flashback Database feature for the whole database:</span>
<div>
<pre dir="ltr">ALTER DATABASE FLASHBACK ON;
</pre></div>
</li>
<li class="stepexpand"><span>Optionally, disable flashback logging for specific tablespaces.</span>
<div>
<p>By default, flashback logs are generated for all permanent tablespaces. You can reduce overhead by disabling flashback logging for specific tablespaces as in the following example:</p>
<pre dir="ltr">ALTER TABLESPACE tbs_3 FLASHBACK OFF;
</pre>
<p>You can re-enable flashback logging for a tablespace later with this command:</p>
<pre dir="ltr">ALTER TABLESPACE tbs_3 FLASHBACK ON;
</pre>
<p>If you disable Flashback Database for a tablespace, then you must take its data files offline before running <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>.</p>
</div>
</li>
</ol>
<div class="section">
<p>When you enable Flashback Database while the database is open, there is a very small chance the command may not be able to obtain the memory it needs. If the command fails because of that reason, retry the command after a while or retry after a shutdown and restart of the instance.</p>
<p>When you enable Flashback Database on a <a href="glossary.htm#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">physical standby database</span></a>, you can flash back a standby database. Flashback Database of standby databases has some applications in the Data Guard environment. See <a class="olink SBYDB" target="_blank" href="../SBYDB/toc.htm"><span class="italic">Oracle Data Guard Concepts and Administration</span></a> for details.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV597"></a>
<div class="props_rev_3"><a id="GUID-B343C3D9-0CA1-49E5-AC62-1E872E9966A6"></a>
<h3 id="BRADV-GUID-B343C3D9-0CA1-49E5-AC62-1E872E9966A6" class="sect3">Disabling Flashback Database Logging</h3>
<div>
<div class="section">
<p>On a database instance that is either in mount or open state, issue the following command:</p>
<pre dir="ltr">ALTER DATABASE FLASHBACK OFF;
</pre></div>
<!-- class="section" --></div>
</div>
<a id="BRADV598"></a>
<div class="props_rev_3"><a id="GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045"></a>
<h3 id="BRADV-GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045" class="sect3">Configuring the Environment for Optimal Flashback Database Performance</h3>
<div>
<div class="section">
<p><a id="d32076e2292" class="indexterm-anchor"></a>Maintaining flashback logs imposes comparatively limited overhead on an database instance. Changed blocks are written from memory to the flashback logs at relatively infrequent, regular intervals, to limit processing and I/O overhead.</p>
<p>To achieve good performance for large production databases with Flashback Database enabled, Oracle recommends the following:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Use a fast file system for your fast recovery area, preferably without operating system file caching.</p>
<p>Files that the database creates in the fast recovery area, including flashback logs, are typically large. Operating system file caching is typically not effective for these files, and may actually add CPU overhead for reading from and writing to these files. Thus, it is recommended to use a file system that avoids operating system file caching, such as ASM.</p>
</li>
<li>
<p>Configure enough disk spindles for the file system that holds the fast recovery area.</p>
<p>For large production databases, multiple disk spindles may be needed to support the required disk throughput for the database to write the flashback logs effectively.</p>
</li>
<li>
<p>If the storage system used to hold the fast recovery area does not have nonvolatile RAM, then try to configure the file system on striped storage volumes.</p>
<p>Use a relatively small stripe size such as 128 KB. This technique enables each write to the flashback logs to be spread across multiple spindles, improving performance.</p>
</li>
<li>
<p>For large databases, set the initialization parameter <code class="codeph">LOG_BUFFER</code> to at least 8 MB.</p>
</li>
</ul>
<p>The overhead of logging for Flashback Database depends on the mixture of reads and writes in the database workload. When you have a write-intensive workload, the Flashback Database logging overhead is high since it must log all those database changes. Queries do not change data and thus do not contribute to logging activity for Flashback Database.</p>
</div>
<!-- class="section" --></div>
</div>
<a id="BRADV600"></a><a id="BRADV599"></a>
<div class="props_rev_3"><a id="GUID-19A3894F-22A9-49B1-91F4-951E9824C95F"></a>
<h3 id="BRADV-GUID-19A3894F-22A9-49B1-91F4-951E9824C95F" class="sect3">Monitoring the Effect of Flashback Database on Performance</h3>
<div>
<div class="p"><a id="d32076e2394" class="indexterm-anchor"></a> There are several data analysis methods for monitoring the Flashback Database workload on your system.
<ul style="list-style-type: disc;">
<li>
<p>AWR reports</p>
<p>The <a id="d32076e2405" class="indexterm-anchor"></a>Automatic Workload Repository (AWR) automates database statistics gathering by collecting, processing, and maintaining performance statistics for database problem detection and self-tuning. You can compare AWR reports from before and after the Flashback Database was turned on to monitor performance effects.</p>
</li>
<li>
<p>AWR snapshots</p>
<p>You can review AWR snapshots to pinpoint system usage caused by flashback logging. For example, if <code class="codeph">flashback buf free by RVWR</code> is the top wait event, then you know that Oracle Database cannot write flashback logs very quickly. Therefore, you might want to tune the file system and storage used by the fast recovery area, possibly using a technique described in <span class="q">&#34;<a href="flashdb.htm#GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045">Configuring the Environment for Optimal Flashback Database Performance</a>&#34;</span></p>
</li>
<li>
<p><a id="d32076e2422" class="indexterm-anchor"></a><code class="codeph">V$FLASHBACK_DATABASE_STAT</code> view</p>
<p>The <code class="codeph">V$FLASHBACK_DATABASE_STAT</code> view shows the bytes of flashback data logged by the database. Each row in the view shows the statistics accumulated (typically over the course of an hour). The <code class="codeph">FLASHBACK_DATA</code> and <code class="codeph">REDO_DATA</code> columns describe bytes of flashback data and redo data written respectively during the time interval, while the <code class="codeph">DB_DATA</code> column describes bytes of data blocks read and written. The columns <code class="codeph">FLASHBACK_DATA</code> and <code class="codeph">REDO_DATA</code> correspond to sequential writes, whereas <code class="codeph">DB_DATA</code> column corresponds to random reads and writes.</p>
</li>
<li>
<p><code class="codeph">V$SYSSTAT</code> view</p>
<p>Because of the difference between sequential I/O and random I/O, a better indication of I/O overhead is the number of I/O operations issued for flashback logs. <a id="d32076e2458" class="indexterm-anchor"></a>The <code class="codeph">V$SYSSTAT</code> statistics shown in <a href="flashdb.htm#GUID-19A3894F-22A9-49B1-91F4-951E9824C95F__CFHBHCAG" title="Describes columns in the V$SYSSTAT View">Table 7-1</a> can tell you the number of I/O operations that your instance has issued for various purposes.</p>
</li>
</ul>
</div>
<div class="tblformal" id="GUID-19A3894F-22A9-49B1-91F4-951E9824C95F__CFHBHCAG">
<p class="titleintable">Table 7-1 V$SYSSTAT Statistics</p>
<table class="cellalignment515" title="V$SYSSTAT Statistics" summary="Describes columns in the V$SYSSTAT View">
<thead>
<tr class="cellalignment501">
<th class="cellalignment545" id="d32076e2479">Column Name</th>
<th class="cellalignment546" id="d32076e2482">Column Meaning</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment501">
<td class="cellalignment547" id="d32076e2487" headers="d32076e2479">
<p>Physical write I/O request</p>
</td>
<td class="cellalignment548" headers="d32076e2487 d32076e2482">
<p>The number of write operations issued for writing data blocks</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d32076e2494" headers="d32076e2479">
<p>Physical read I/O request</p>
</td>
<td class="cellalignment548" headers="d32076e2494 d32076e2482">
<p>The number of read operations issued for reading data blocks</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d32076e2501" headers="d32076e2479">
<p>Redo writes</p>
</td>
<td class="cellalignment548" headers="d32076e2501 d32076e2482">
<p>The number of write operations issued for writing to the redo log</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d32076e2508" headers="d32076e2479">
<p>Flashback log writes</p>
</td>
<td class="cellalignment548" headers="d32076e2508 d32076e2482">
<p>The number of write operations issued for writing to flashback logs</p>
</td>
</tr>
<tr class="cellalignment501">
<td class="cellalignment547" id="d32076e2515" headers="d32076e2479">
<p>Flashback log write bytes</p>
</td>
<td class="cellalignment548" headers="d32076e2515 d32076e2482">
<p>Total size in bytes of flashback database data written from this instance</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-19A3894F-22A9-49B1-91F4-951E9824C95F__GUID-82CC01DB-6C2C-4835-9076-5FDD2F685269">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN103" target="_blank" href="../REFRN/GUID-2A9F2E5B-992E-43D1-8377-F4080824129C.htm#REFRN103"><span class="italic">Oracle Database Reference</span></a> for more details on columns in the <code class="codeph">V$SYSSTAT</code> view</p>
</li>
<li>
<p><a class="olink TGDBA185" target="_blank" href="../TGDBA/gather_stats.htm#TGDBA185"><span class="italic">Oracle Database Performance Tuning Guide</span></a> to learn about AWR</p>
</li>
<li>
<p><a class="olink TDPPT091" target="_blank" href="../TDPPT/tdppt_degrade.htm#TDPPT091"><span class="italic">Oracle Database 2 Day + Performance Tuning Guide</span></a> for more information about AWR reports</p>
</li>
</ul>
</div>
</div>
</div>
<a id="BRADV601"></a>
<div class="props_rev_3"><a id="GUID-C6E3FBBA-188F-4D26-AC7D-31ED3D190E88"></a>
<h3 id="BRADV-GUID-C6E3FBBA-188F-4D26-AC7D-31ED3D190E88" class="sect3">About Flashback Writer (RVWR) Behavior with I/O Errors</h3>
<div>
<p>When flashback is enabled or when there are guaranteed restore points, the background process RVWR writes flashback data to flashback database logs in the fast recovery area. If RVWR encounters an I/O error, then the following behavior is expected:</p>
<ul style="list-style-type: disc;">
<li>
<p>If there are any guaranteed restore points defined, then the instance fails when RVWR encounters I/O errors.</p>
</li>
<li>
<p>If no guaranteed restore points are defined, then the instance remains unaffected when RVWR encounters I/O errors. Note the following cases:</p>
<ul style="list-style-type: disc;">
<li>
<p>On a primary database, Oracle Database automatically disables Flashback Database while the database is open. All existing transactions and queries proceed unaffected. This behavior is expected for both single-instance and Oracle RAC databases.</p>
</li>
<li>
<p>On a physical or logical standby, RVWR appears to have stopped responding, retrying the I/O periodically. This may eventually cause the logical standby or the managed recovery of the physical standby to suspend. (Oracle Database does not cause the standby instance to fail because it does not want to cause the primary database to fail in maximum protection mode.) To resolve the issue, you can issue either a <code class="codeph">SHUTDOWN</code> <code class="codeph">ABORT</code> or an <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">FLASHBACK</code> <code class="codeph">OFF</code> command.</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment500">
<tr>
<td class="cellalignment512">
<table class="cellalignment505">
<tr>
<td class="cellalignment504"><a href="rcmconfa.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment504"><a href="part_bak.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2003, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment514">
<table class="cellalignment503">
<tr>
<td class="cellalignment504"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment504"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment504"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment504"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment504"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment504"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>