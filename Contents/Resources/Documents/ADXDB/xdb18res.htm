<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-1617"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Repository%20Access%20Using%20RESOURCE_VIEW%20and%20PATH_VIEW"></a><title>Repository Access Using RESOURCE_VIEW and PATH_VIEW</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="Predefined public views RESOURCE_VIEW and PATH_VIEW provide access to Oracle XML&nbsp;DB repository data. You can use Oracle SQL functions under_path and equals_path to query resources based on their path names, and functions path and depth to return resource path names and depths."/>
<meta name="keywords" content="RESOURCE_VIEW, explained, views, RESOURCE and PATH, PATH_VIEW, query-based access to resources, using RESOURCE_VIEW and PATH_VIEW, under_path SQL function, functions, SQL, under_path, depth SQL function, SQL, depth, under_path, different correlations for different folders, resource, deleting, using DELETE, nonempty container, updating, updating repository resource, simultaneous operations, resource-view-cache-size configuration parameter, Oracle Text, searching for resources, searching for, using Oracle Text"/>
<meta name="dcterms.created" content="2016-12-08T13:53:25Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="XML DB Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E41152-15"/>
<meta name="dcterms.isVersionOf" content="ADXDB"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="xdb_xlink.htm" title="Previous" type="text/html"/>
<link rel="Next" href="xdb17ver.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41152-15.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-70F798A7-A73F-4D2B-AD34-A802BA950E55"></a> <span id="PAGE" style="display:none;">37/61</span> <!-- End Header -->
<a id="ADXDB2200"></a>
<h1 id="ADXDB-GUID-70F798A7-A73F-4D2B-AD34-A802BA950E55" class="sect1"><span class="enumeration_chapter">24</span> Repository Access Using RESOURCE_VIEW and PATH_VIEW</h1>
<div>
<p>Predefined public views <code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code> provide access to Oracle XML&nbsp;DB repository data. You can use Oracle SQL functions <code>under_path</code> and <code>equals_path</code> to query resources based on their path names, and functions <code>path</code> and <code>depth</code> to return resource path names and depths.</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="xdb18res.htm#GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4" title="Public views RESOURCE_VIEW and PATH_VIEW provide a mechanism for using SQL to access data stored in Oracle XML&nbsp;DB Repository. You can use these views to access data stored in the repository using Internet protocols such as FTP and WebDAV or using application program interfaces (APIs).">Overview of Oracle XML&nbsp;DB RESOURCE_VIEW and PATH_VIEW</a></p>
</li>
<li>
<p><a href="xdb18res.htm#GUID-4570E0E5-53B8-468C-9589-35EDF0C41B19" title="Oracle SQL functions used with public views RESOURCE_VIEW and PATH_VIEW include under_path, equals_path, path, and depth.">Oracle SQL Functions That Use RESOURCE_VIEW and PATH_VIEW</a></p>
</li>
<li>
<p><a href="xdb18res.htm#GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A" title="Examples here illustrate how to access Oracle XML&nbsp;DB Repository paths, resources, and link properties.">Accessing Repository Data Paths_ Resources and Links: Examples</a></p>
</li>
<li>
<p><a href="xdb18res.htm#GUID-BCA4A460-7C38-46E4-A827-E3B3B20DDB1F" title="Examples here illustrate how to delete Oracle XML&nbsp;DB Repository resources and paths.">Deleting Repository Resources: Examples</a></p>
</li>
<li>
<p><a href="xdb18res.htm#GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D" title="Examples here illustrate how to update Oracle XML&nbsp;DB Repository resources and paths.">Updating Repository Resources: Examples</a></p>
</li>
<li>
<p><a href="xdb18res.htm#GUID-EB652889-E723-4727-B2BC-DFFC378037FD" title="To perform an operation on multiple Oracle XML&nbsp;DB resources, or to find one or more Oracle XML&nbsp;DB resources that meet a certain set of criteria, use SQL with RESOURCE_VIEW and PATH_VIEW.">Working with Multiple Oracle XML&nbsp;DB Resources</a></p>
</li>
<li>
<p><a href="xdb18res.htm#GUID-9022CFD7-F8C8-434D-A3D6-21208328B2F2" title="Guidelines are presented for improving the performance of repository operations such as resource creation and querying.">Performance Guidelines for Oracle XML&nbsp;DB Repository Operations</a></p>
</li>
<li>
<p><a href="xdb18res.htm#GUID-79391B36-9690-44DC-8923-653CFE299E9C" title="Table XDB$RESOURCE in database schema XDB stores the metadata and content of repository resources. You can search for resources that contain a specific keyword by using Oracle SQL function contains with RESOURCE_VIEW or PATH_VIEW.">Searching for Resources Using Oracle Text</a></p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-70F798A7-A73F-4D2B-AD34-A802BA950E55__GUID-6F457DFF-7D21-49E9-9B39-C3FF754F2CDC">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN29079" target="_blank" href="../REFRN/GUID-33DBD6B2-6DE6-426E-9169-AA4CE59A5D45.htm#REFRN29079"><span class="italic">Oracle Database Reference</span></a> for more information about view <code>PATH_VIEW</code></p>
</li>
<li>
<p><a class="olink REFRN29080" target="_blank" href="../REFRN/GUID-5F69D817-EF39-4B1B-89FF-439952B8CCD0.htm#REFRN29080"><span class="italic">Oracle Database Reference</span></a> for more information about view <code>RESOURCE_VIEW</code></p>
</li>
</ul>
</div>
</div>
<a id="ADXDB5389"></a><a id="ADXDB5394"></a><a id="ADXDB5388"></a>
<div class="props_rev_3"><a id="GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4"></a>
<h2 id="ADXDB-GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4" class="sect2"><span class="enumeration_section">24.1</span> Overview of Oracle XML&nbsp;DB RESOURCE_VIEW and PATH_VIEW</h2>
<div>
<p>Public views <code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code> provide a mechanism for using SQL to access data stored in Oracle XML&nbsp;DB Repository. You can use these views to access data stored in the repository using Internet protocols such as FTP and WebDAV or using application program interfaces (APIs).</p>
<p><a href="xdb18res.htm#GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__i1029352">Figure 24-1</a> illustrates this.</p>
<p><code>RESOURCE_VIEW</code> consists of a resource, itself an <code>XMLType</code> instance, that contains the name of the resource, its ACLs, and its properties, static or extensible.</p>
<ul style="list-style-type: disc;">
<li>
<p>If the content of a resource is XML data stored somewhere in an <code>XMLType</code> table or view then the <code>RESOURCE_VIEW</code> points to the <code>XMLType</code> row that stores the content.</p>
</li>
<li>
<p>If the content of a resource is not XML data then the <code>RESOURCE_VIEW</code> stores the content as a LOB.</p>
</li>
</ul>
<div class="infobox-note" id="GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__GUID-0BC98FEE-9A53-42EA-971C-B99CABA08CC2">
<p class="notep1">Note:</p>
<p>As of Oracle Database&nbsp;Release 11.2.0.1.0, repository content stored in line as a LOB uses SecureFiles LOB storage. Prior to that, it used BasicFiles LOB storage.</p>
</div>
<p>Parent-child relationships between folders are maintained and traversed efficiently using the hierarchical repository index. Text indexes are available to search the properties of a resource, and internal B-tree indexes over names and ACLs speed up access to these attributes of the resource <code>XMLType</code> data.</p>
<p><code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code>, along with PL/SQL package <code>DBMS_XDB_REPOS</code>, provide all query-based access to Oracle XML&nbsp;DB and DML functionality that is available through the API.</p>
<p>The base table for <code>RESOURCE_VIEW</code> is <code>XDB.XDB$RESOURCE</code>. Access this table only using <code>RESOURCE_VIEW</code> or PL/SQL package <code>DBMS_XDB_REPOS</code>.</p>
<div class="infoboxnotealso" id="GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__GUID-EFA7A1AD-5694-4C58-A1D3-25349EBB0904">
<p class="notep1">See Also:</p>
<p><a href="xdb03usg.htm#GUID-757B4470-851B-47B7-AB78-81F47ECE5398" title="An overview of the various ways of using Oracle XML&nbsp;DB is presented.">Overview of How To Use Oracle XML&nbsp;DB</a></p>
</div>
<div class="figure" id="GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__i1029352">
<p class="titleinfigure">Figure 24-1 Accessing Repository Resources Using RESOURCE_VIEW and PATH_VIEW</p>
<img width="422" height="386" src="img/GUID-286FA62C-C537-4FA7-AF04-E5D5515D7253-default.gif" alt="Description of Figure 24-1 follows" title="Description of Figure 24-1 follows"/><br/>
<a href="img_text/GUID-286FA62C-C537-4FA7-AF04-E5D5515D7253-print.htm">Description of &#34;Figure 24-1 Accessing Repository Resources Using RESOURCE_VIEW and PATH_VIEW&#34;</a></div>
<!-- class="figure" -->
<p><a href="xdb18res.htm#GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__i1027962">Figure 24-2</a> illustrates the structure of <code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code>.</p>
<div class="figure" id="GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__i1027962">
<p class="titleinfigure">Figure 24-2 RESOURCE_VIEW and PATH_VIEW Structure</p>
<img width="497" height="132" src="img/GUID-A4429E91-4EFE-45B8-958E-1768E311FA0B-default.gif" alt="Description of Figure 24-2 follows" title="Description of Figure 24-2 follows"/><br/>
<a href="img_text/GUID-A4429E91-4EFE-45B8-958E-1768E311FA0B-print.htm">Description of &#34;Figure 24-2 RESOURCE_VIEW and PATH_VIEW Structure&#34;</a></div>
<!-- class="figure" -->
<div class="infobox-note" id="GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__GUID-199770A4-29F2-40C0-A188-98374FF84270">
<p class="notep1">Note:</p>
<p>Neither <code>RESOURCE_VIEW</code> nor <code>PATH_VIEW</code> contains the <span class="italic">root</span> folder (<code>/</code>) resource. All other repository resources are included.</p>
</div>
<p>A path in the <code>RESOURCE_VIEW</code> is an arbitrary one of the paths that can be used to access the given resource. Oracle SQL function <code>under_path</code> lets applications search for resources that are contained (recursively) within a particular folder, get the resource depth, and so on. Each row in the <code>PATH_VIEW</code> and <code>RESOURCE_VIEW</code> columns is of data type <code>XMLType</code>. DML on repository views can be used to insert, rename, delete, and update resource properties and contents. Programmatic APIs must be used for some operations, such as creating links to existing resources.</p>
<p>Paths in the <code>ANY_PATH</code> column of the <code>RESOURCE_VIEW</code> and the <code>PATH</code> column in the <code>PATH_VIEW</code> are <span class="italic">absolute</span> paths: they start at the root.</p>
<div class="infobox-note" id="GUID-14598A45-6DFA-4FB9-AB2E-CC5B23C6F6D4__GUID-A81563F3-96FC-4B37-A6A4-937550D80CD8">
<p class="notep1">Note:</p>
<p>Test resource paths for equality using Oracle SQL function <code>equals_path</code>: <code>equals_path(&#39;/my/path&#39;) = 1</code>. Do <span class="italic">not</span> test <code>ANY_PATH</code> for equality against an absolute path: <code>ANY_PATH = &#39;/my/path&#39;</code>.</p>
</div>
<p>Paths returned by the <code>path</code> function are <span class="italic">relative</span> paths under the path name specified by function <code>under_path</code>. For example, if there are two resources referenced by path names <code>/a/b/c</code> and <code>/a/d</code>, respectively, then a <code>path</code> expression that retrieves paths under folder <code>/a</code> returns relative paths <code>b/c</code> and <code>d</code>.</p>
<p>When there are multiple hard links to the same resource, only paths under the path name specified by function <code>under_path</code> are returned. If <code>/a/b/c</code>, <code>/a/b/d</code>, and <code>/a/e</code> are all links to the same resource, then a query on <code>PATH_VIEW</code> that retrieves all of the paths under <code>/a/b</code> returns only <code>/a/b/c</code> and <code>/a/b/d</code>, not <code>/a/e</code>.</p>
</div>
<a id="ADXDB5391"></a><a id="ADXDB5390"></a>
<div class="props_rev_3"><a id="GUID-7B998BF8-1450-4C70-8C64-D9303C405F50"></a>
<h3 id="ADXDB-GUID-7B998BF8-1450-4C70-8C64-D9303C405F50" class="sect3"><span class="enumeration_section">24.1.1</span> RESOURCE_VIEW Definition and Structure</h3>
<div>
<p>Public view <code>RESOURCE_VIEW</code> contains one row for each resource in Oracle XML&nbsp;DB Repository (except for the root folder resource).</p>
<p><a href="xdb18res.htm#GUID-7B998BF8-1450-4C70-8C64-D9303C405F50__CHDBBIBF" title="Structure of RESOURCE_VIEW">Table 24-1</a> describes the structure of <code>RESOURCE_VIEW</code>.</p>
<div class="tblformal" id="GUID-7B998BF8-1450-4C70-8C64-D9303C405F50__CHDBBIBF">
<p class="titleintable">Table 24-1 Structure of RESOURCE_VIEW</p>
<table class="cellalignment3420" title="Structure of RESOURCE_VIEW" summary="Structure of RESOURCE_VIEW">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3467" id="d121339e480">Column</th>
<th class="cellalignment3467" id="d121339e483">Data Type</th>
<th class="cellalignment3515" id="d121339e486">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3470" id="d121339e491" headers="d121339e480">
<p><code>RES</code></p>
</td>
<td class="cellalignment3470" headers="d121339e491 d121339e483">
<p><code>XMLType</code></p>
</td>
<td class="cellalignment3517" headers="d121339e491 d121339e486">
<p>A resource in the repository (except for the root folder resource)</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3470" id="d121339e503" headers="d121339e480">
<p><code>ANY_PATH</code></p>
</td>
<td class="cellalignment3470" headers="d121339e503 d121339e483">
<p><code>VARCHAR2</code></p>
</td>
<td class="cellalignment3517" headers="d121339e503 d121339e486">
<p>An (absolute) path to the resource</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3470" id="d121339e515" headers="d121339e480">
<p><code>RESID</code></p>
</td>
<td class="cellalignment3470" headers="d121339e515 d121339e483">
<p><code>RAW</code></p>
</td>
<td class="cellalignment3517" headers="d121339e515 d121339e486">
<p>Resource OID, which is a unique handle to the resource</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="ADXDB5393"></a><a id="ADXDB5392"></a>
<div class="props_rev_3"><a id="GUID-B3D3011A-9117-452D-B6E9-32B1C29AA612"></a>
<h3 id="ADXDB-GUID-B3D3011A-9117-452D-B6E9-32B1C29AA612" class="sect3"><span class="enumeration_section">24.1.2</span> PATH_VIEW Definition and Structure</h3>
<div>
<p>Public view <code>PATH_VIEW</code> contains one row for each unique path that accesses a resource in Oracle XML&nbsp;DB Repository (except for the root folder resource). Each resource can have multiple paths, also called <strong class="term">links</strong>.</p>
<p><a href="xdb18res.htm#GUID-B3D3011A-9117-452D-B6E9-32B1C29AA612__CHDICFHF" title="Structure of RESOURCE_VIEW">Table 24-2</a> describes the structure of <code>PATH_VIEW</code>.</p>
<div class="tblformal" id="GUID-B3D3011A-9117-452D-B6E9-32B1C29AA612__CHDICFHF">
<p class="titleintable">Table 24-2 Structure of PATH_VIEW</p>
<table class="cellalignment3420" title="Structure of PATH_VIEW" summary="Structure of RESOURCE_VIEW">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3467" id="d121339e576">Column</th>
<th class="cellalignment3467" id="d121339e579">Data Type</th>
<th class="cellalignment3515" id="d121339e582">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3470" id="d121339e587" headers="d121339e576">
<p><code>PATH</code></p>
</td>
<td class="cellalignment3470" headers="d121339e587 d121339e579">
<p><code>VARCHAR2</code></p>
</td>
<td class="cellalignment3517" headers="d121339e587 d121339e582">
<p>An (absolute) path to repository resource <code>RES</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3470" id="d121339e601" headers="d121339e576">
<p><code>RES</code></p>
</td>
<td class="cellalignment3470" headers="d121339e601 d121339e579">
<p><code>XMLType</code></p>
</td>
<td class="cellalignment3517" headers="d121339e601 d121339e582">
<p>The resource referred to by column <code>PATH</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3470" id="d121339e615" headers="d121339e576">
<p><code>LINK</code></p>
</td>
<td class="cellalignment3470" headers="d121339e615 d121339e579">
<p><code>XMLType</code></p>
</td>
<td class="cellalignment3517" headers="d121339e615 d121339e582">
<p>Link property</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3470" id="d121339e627" headers="d121339e576">
<p><code>RESID</code></p>
</td>
<td class="cellalignment3470" headers="d121339e627 d121339e579">
<p><code>RAW</code></p>
</td>
<td class="cellalignment3517" headers="d121339e627 d121339e582">
<p>Resource OID</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="ADXDB5396"></a><a id="ADXDB5395"></a>
<div class="props_rev_3"><a id="GUID-84FC63E5-BC2C-41CF-A9CA-F59C44092610"></a>
<h3 id="ADXDB-GUID-84FC63E5-BC2C-41CF-A9CA-F59C44092610" class="sect3"><span class="enumeration_section">24.1.3</span> The Difference Between RESOURCE_VIEW and PATH_VIEW</h3>
<div>
<p><code>PATH_VIEW</code> includes <span class="italic">all</span> the path names to a particular resource. <code>RESOURCE_VIEW</code> includes <span class="italic">one</span> of the possible path names to the resource. <code>PATH_VIEW</code> also includes the link properties. For better performance, use <code>RESOURCE_VIEW</code>, not <code>PATH_VIEW</code>, whenever possible.</p>
<p><a href="xdb18res.htm#GUID-84FC63E5-BC2C-41CF-A9CA-F59C44092610__i1027970">Figure 24-3</a> illustrates this difference.</p>
<p>Because many Internet applications need only one URL to access a resource, <code>RESOURCE_VIEW</code> is widely applicable.</p>
<p><code>PATH_VIEW</code> contains both <span class="italic">link</span> properties and resource properties, whereas the <code>RESOURCE_VIEW</code> contains only resource properties.</p>
<p>Because it handles the information for multiple paths, <code>PATH_VIEW</code> access can be slower. If you use <code>RESOURCE_VIEW</code>then the database can take advantage of the fact that only one path is needed; the index can do less work to determine all the possible paths.</p>
<div class="infobox-note" id="GUID-84FC63E5-BC2C-41CF-A9CA-F59C44092610__GUID-DB1D1943-47A6-413B-B8D5-5C02780F22F2">
<p class="notep1">Note:</p>
<p>When using <code>RESOURCE_VIEW</code>, if you specify a path using function <code>under_path</code> or <code>equals_path</code>, the function finds the resource regardless of whether or not the specified path is the arbitrary one chosen to normally appear with that resource using <code>RESOURCE_VIEW</code>.</p>
</div>
<div class="figure" id="GUID-84FC63E5-BC2C-41CF-A9CA-F59C44092610__i1027970">
<p class="titleinfigure">Figure 24-3 RESOURCE_VIEW and PATH_VIEW Explained</p>
<img width="636" height="341" src="img/GUID-191F53BA-5AC7-4BF6-9EEF-C0ECEF00C699-default.gif" alt="Description of Figure 24-3 follows" title="Description of Figure 24-3 follows"/><br/>
<a href="img_text/GUID-191F53BA-5AC7-4BF6-9EEF-C0ECEF00C699-print.htm">Description of &#34;Figure 24-3 RESOURCE_VIEW and PATH_VIEW Explained&#34;</a></div>
<!-- class="figure" --></div>
</div>
<a id="ADXDB5397"></a>
<div class="props_rev_3"><a id="GUID-EDDF8821-F46C-405F-BD10-1EE7A2A2A7B6"></a>
<h3 id="ADXDB-GUID-EDDF8821-F46C-405F-BD10-1EE7A2A2A7B6" class="sect3"><span class="enumeration_section">24.1.4</span> Operations You Can Perform Using UNDER_PATH and EQUALS_PATH</h3>
<div>
<p>You can use Oracle SQL functions <code>under_path</code> and <code>equals_path</code> to get a resource or its OID; create, delete, or update a resource; or list a directory that corresponds to a path name.</p>
<ul style="list-style-type: disc;">
<li>
<p>Given a path name, you can:</p>
<ul style="list-style-type: disc;">
<li>
<p>Get a resource or its OID</p>
</li>
<li>
<p>List the directory given by the path name</p>
</li>
<li>
<p>Create a resource</p>
</li>
<li>
<p>Delete a resource</p>
</li>
<li>
<p>Update a resource</p>
</li>
</ul>
</li>
<li>
<p>Given a condition that uses <code>under_path</code> or other SQL functions, you can:</p>
<ul style="list-style-type: disc;">
<li>
<p>Update resources</p>
</li>
<li>
<p>Delete resources</p>
</li>
<li>
<p>Get resources or their OID</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<a id="ADXDB5398"></a>
<div class="props_rev_3"><a id="GUID-4570E0E5-53B8-468C-9589-35EDF0C41B19"></a>
<h2 id="ADXDB-GUID-4570E0E5-53B8-468C-9589-35EDF0C41B19" class="sect2"><span class="enumeration_section">24.2</span> Oracle SQL Functions That Use RESOURCE_VIEW and PATH_VIEW</h2>
<div>
<p>Oracle SQL functions used with public views <code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code> include <code>under_path</code>, <code>equals_path</code>, <code>path</code>, and <code>depth</code>.</p>
<div class="section"></div>
<!-- class="section" --></div>
<a id="ADXDB5400"></a><a id="ADXDB5401"></a><a id="ADXDB5399"></a>
<div class="props_rev_3"><a id="GUID-F1E3092D-6FAF-499C-A9DB-AB99E1C0C1AD"></a>
<h3 id="ADXDB-GUID-F1E3092D-6FAF-499C-A9DB-AB99E1C0C1AD" class="sect3"><span class="enumeration_section">24.2.1</span> UNDER_PATH SQL Function</h3>
<div>
<p>Oracle SQL function <code>under_path</code> uses the hierarchical index of Oracle XML&nbsp;DB Repository to return the paths to all hard links under a particular path. This index is designed to speed access when traversing a path (the most common usage).</p>
<div class="section">
<p>If the other parts of a query predicate are very selective, however, then a functional implementation of <code>under_path</code> can be chosen that walks back up the repository. This can be more efficient, because fewer links must be traversed. <a href="xdb18res.htm#GUID-F1E3092D-6FAF-499C-A9DB-AB99E1C0C1AD__BABIHCGH">Figure 24-4</a> shows the <code>under_path</code> syntax.</p>
<div class="figure" id="GUID-F1E3092D-6FAF-499C-A9DB-AB99E1C0C1AD__BABIHCGH">
<p class="titleinfigure">Figure 24-4 UNDER_PATH Syntax</p>
<img width="683" height="46" src="img/GUID-8B5E0137-4118-490A-AF1D-7732FBB97617-default.gif" alt="Description of Figure 24-4 follows" title="Description of Figure 24-4 follows"/><br/>
<a href="img_text/GUID-8B5E0137-4118-490A-AF1D-7732FBB97617-print.htm">Description of &#34;Figure 24-4 UNDER_PATH Syntax&#34;</a></div>
<!-- class="figure" -->
<p><a href="xdb18res.htm#GUID-F1E3092D-6FAF-499C-A9DB-AB99E1C0C1AD__g1031254" title="This table describes the UNDER_PATH operator syntax for RESOURCE_VIEW and PATH_VIEW.">Table 24-3</a> details the signature of Oracle SQL function <code>under_path</code>.</p>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-F1E3092D-6FAF-499C-A9DB-AB99E1C0C1AD__g1031254">
<p class="titleintable">Table 24-3 UNDER_PATH SQL Function Signature</p>
<table class="cellalignment3420" title=" UNDER_PATH SQL Function Signature" summary="This table describes the UNDER_PATH operator syntax for RESOURCE_VIEW and PATH_VIEW.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3522" id="d121339e907">Syntax</th>
<th class="cellalignment3540" id="d121339e910">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3523" id="d121339e915" headers="d121339e907">
<pre dir="ltr">under_path(<span class="italic">resource_column</span>, <span class="italic">pathname</span>); 
</pre></td>
<td class="cellalignment3541" headers="d121339e915 d121339e910">
<p>Determines whether a resource is under a specified path.</p>
<p>Parameters:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic"><code>resource_column</code></span> &ndash;The column name or column alias of the <code>RESOURCE</code> column in the <code>PATH_VIEW</code> or <code>RESOURCE_VIEW.</code></p>
</li>
<li>
<p><span class="italic"><code>pathname</code></span> &ndash; The path name to resolve.</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3523" id="d121339e951" headers="d121339e907">
<pre dir="ltr">under_path(<span class="italic">resource_column</span>, <span class="italic">depth</span>, <span class="italic">pathname</span>);
</pre></td>
<td class="cellalignment3541" headers="d121339e951 d121339e910">
<p>Determines whether a resource is under a specified path, with a depth argument to restrict the number of levels to search.</p>
<p>Parameters:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic"><code>resource_column</code></span> &ndash; The column name or column alias of the <code>RESOURCE</code> column in the <code>PATH_VIEW</code> or <code>RESOURCE_VIEW</code><code>.</code></p>
</li>
<li>
<p><code>depth</code> &ndash; The maximum depth to search. A nonnegative integer.</p>
</li>
<li>
<p><span class="italic"><code>pathname</code></span> &ndash; The path name to resolve.</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3523" id="d121339e997" headers="d121339e907">
<pre dir="ltr">under_path(<span class="italic">resource_column</span>, <span class="italic">pathname</span>, <span class="italic">correlation</span>);
</pre></td>
<td class="cellalignment3541" headers="d121339e997 d121339e910">
<p>Determines if a resource is under a specified path, with a correlation argument for related SQL functions.</p>
<p>Parameters:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic"><code>resource_column</code></span> &ndash; The column name or column alias of the <code>RESOURCE</code> column in the <code>PATH_VIEW</code> or <code>RESOURCE_VIEW</code><code>.</code></p>
</li>
<li>
<p><span class="italic"><code>pathname</code></span> &ndash; The path name to resolve.</p>
</li>
<li>
<p><span class="italic"><code>correlation</code></span> &ndash; An integer that can be used to correlate <code>under_path</code> with related SQL functions (<code>path</code> and <code>depth</code>).</p>
</li>
</ul>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3523" id="d121339e1053" headers="d121339e907">
<pre dir="ltr">under_path(<span class="italic">resource_column</span>, <span class="italic">depth</span>, <span class="italic">pathname</span>, <span class="italic">correlation</span>);
</pre></td>
<td class="cellalignment3541" headers="d121339e1053 d121339e910">
<p>Determines if a resource is under a specified path with a depth argument to restrict the number of levels to search, and with a correlation argument for related SQL functions.</p>
<p>Parameters:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic"><code>resource_column</code></span> &ndash; The column name or column alias of the <code>RESOURCE</code> column in the <code>PATH_VIEW</code> or <code>RESOURCE_VIEW</code>.</p>
</li>
<li>
<p><span class="italic"><code>depth</code></span> &ndash; The maximum depth to search. A nonnegative integer.</p>
</li>
<li>
<p><span class="italic"><code>pathname</code></span> &ndash; The path name to resolve.</p>
</li>
<li>
<p><span class="italic"><code>correlation</code></span> &ndash; An integer that can be used to correlate <code>under_path</code> with related SQL functions (<code>path</code> and <code>depth</code>).</p>
</li>
</ul>
<p>Note that, for a resource to be returned, only one of the accessible paths to the resource must be under the <span class="italic"><code>pathname</code></span> argument. If no such path is under argument <span class="italic"><code>pathname</code></span> then a <code>NULL</code> value is returned.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<div class="infobox-note" id="GUID-F1E3092D-6FAF-499C-A9DB-AB99E1C0C1AD__GUID-04B0A082-1583-4DE8-BC9C-029EFE9D5FE7">
<p class="notep1">Note:</p>
<p>Function <code>under_path</code> does not follow weak links, because such traversal could lead to cycles. A weak-link argument to <code>under_path</code> is resolved correctly, but weak links are not followed when traversing resources under that path.</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="ADXDB5403"></a><a id="ADXDB5402"></a>
<div class="props_rev_3"><a id="GUID-BA4119B2-0266-4161-A783-D919AB32A588"></a>
<h3 id="ADXDB-GUID-BA4119B2-0266-4161-A783-D919AB32A588" class="sect3"><span class="enumeration_section">24.2.2</span> EQUALS_PATH SQL Function</h3>
<div>
<p>You use Oracle SQL function <code>equals_path</code> to find a resource that has a given path name. It is functionally equivalent to <code>under_path</code> with a depth restriction of zero.</p>
<div class="section">
<pre dir="ltr">equals_path(resource_column, pathname);
</pre>
<p>where:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>resource_column</code> is the column name or column alias of the <code>RESOURCE</code> column in <code>PATH_VIEW</code> or <code>RESOURCE_VIEW.</code></p>
</li>
<li>
<p><code>pathname</code> is the (absolute) path name to resolve. This can contain components that are hard or weak resource links.</p>
</li>
</ul>
<p><a href="xdb18res.htm#GUID-BA4119B2-0266-4161-A783-D919AB32A588__BABJBIAI">Figure 24-5</a> illustrates the complete <code>equals_path</code> syntax.</p>
<div class="figure" id="GUID-BA4119B2-0266-4161-A783-D919AB32A588__BABJBIAI">
<p class="titleinfigure">Figure 24-5 EQUALS_PATH Syntax</p>
<img width="558" height="46" src="img/GUID-28208FFC-E45E-46E9-89C0-C2EF0775E63C-default.gif" alt="Description of Figure 24-5 follows" title="Description of Figure 24-5 follows"/><br/>
<a href="img_text/GUID-28208FFC-E45E-46E9-89C0-C2EF0775E63C-print.htm">Description of &#34;Figure 24-5 EQUALS_PATH Syntax&#34;</a></div>
<!-- class="figure" -->
<div class="infobox-note" id="GUID-BA4119B2-0266-4161-A783-D919AB32A588__GUID-4179739A-1BB0-4327-9B73-3788EE25CA9E">
<p class="notep1">Note:</p>
<ul style="list-style-type: disc;">
<li>
<p>Test resource paths for equality using Oracle SQL function <code>equals_path</code>: <code>equals_path(&#39;/my/path&#39;) = 1</code>. Do <span class="italic">not</span> test <code>ANY_PATH</code> for equality against an absolute path: <code>ANY_PATH = &#39;/my/path&#39;</code>.</p>
</li>
<li>
<p>Use bind variables, instead of hard-coded strings, with <code>equals_path</code>.</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="ADXDB5405"></a><a id="ADXDB5404"></a>
<div class="props_rev_3"><a id="GUID-0435D4ED-14A7-4359-88C4-7639CD33FD9F"></a>
<h3 id="ADXDB-GUID-0435D4ED-14A7-4359-88C4-7639CD33FD9F" class="sect3"><span class="enumeration_section">24.2.3</span> PATH SQL Function</h3>
<div>
<p>Oracle SQL function <code>path</code> returns the relative path name of the resource under a given <span class="italic"><code>pathname</code></span> argument to function <code>under_path</code> or <code>equal_path</code>.</p>
<div class="section">
<p>The path column in the <code>RESOURCE_VIEW</code> always contains the absolute path of the resource. The syntax of function <code>path</code> is:</p>
<pre dir="ltr">path(<span class="italic">correlation</span>);
</pre>
<p>where:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic"><code>correlation</code></span> is an integer that can be used to correlate <code>path</code> with under_path or <code>equals_path</code>.</p>
</li>
</ul>
<p><a href="xdb18res.htm#GUID-0435D4ED-14A7-4359-88C4-7639CD33FD9F__BABBDBAB">Figure 24-6</a> illustrates the syntax for function <code>path</code>.</p>
<div class="figure" id="GUID-0435D4ED-14A7-4359-88C4-7639CD33FD9F__BABBDBAB">
<p class="titleinfigure">Figure 24-6 PATH Syntax</p>
<img width="254" height="27" src="img/GUID-1BBA1129-9F8C-4DD5-808B-62B73540CAD0-default.gif" alt="Description of Figure 24-6 follows" title="Description of Figure 24-6 follows"/><br/>
<a href="img_text/GUID-1BBA1129-9F8C-4DD5-808B-62B73540CAD0-print.htm">Description of &#34;Figure 24-6 PATH Syntax&#34;</a></div>
<!-- class="figure" --></div>
<!-- class="section" --></div>
</div>
<a id="ADXDB5406"></a>
<div class="props_rev_3"><a id="GUID-5DAEAAC7-BDFF-4773-9A29-6BBE9039AC1C"></a>
<h3 id="ADXDB-GUID-5DAEAAC7-BDFF-4773-9A29-6BBE9039AC1C" class="sect3"><span class="enumeration_section">24.2.4</span> DEPTH SQL Function</h3>
<div>
<p>Oracle SQL function <code>depth</code> returns the folder depth of the resource under the specified starting path.</p>
<div class="section">
<pre dir="ltr">depth(<span class="italic">correlation</span>);
</pre>
<p>where:</p>
<p><span class="italic"><code>correlation</code></span> is an integer that can be used to correlate <code>depth</code> with <code>path</code> with under_path or <code>equals_path</code>.</p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="ADXDB5409"></a><a id="ADXDB5410"></a><a id="ADXDB5411"></a><a id="ADXDB5412"></a><a id="ADXDB5413"></a><a id="ADXDB5414"></a><a id="ADXDB5415"></a><a id="ADXDB5416"></a><a id="ADXDB5417"></a><a id="ADXDB5418"></a><a id="ADXDB5419"></a><a id="ADXDB5420"></a><a id="ADXDB5421"></a><a id="ADXDB5422"></a><a id="ADXDB5408"></a>
<div class="props_rev_3"><a id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A"></a>
<h2 id="ADXDB-GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A" class="sect2"><span class="enumeration_section">24.3</span> Accessing Repository Data Paths, Resources and Links: Examples</h2>
<div>
<p>Examples here illustrate how to access Oracle XML&nbsp;DB Repository paths, resources, and link properties.</p>
<div class="section">
<p>The first few examples use resources specified by the following paths:</p>
<pre dir="ltr">/a/b/c
/a/b/c/d
/a/e/c
/a/e/c/d
</pre>
<p><a href="xdb18res.htm#GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CHDFJCAJ">Example 24-1</a> uses Oracle SQL function <code>path</code> to retrieve the <span class="italic">relative</span> paths under path <code>/a/b</code>.</p>
<p><a href="xdb18res.htm#GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CHDGBEFF">Example 24-2</a> uses <code>ANY_PATH</code> to retrieve the <span class="italic">absolute</span> paths under path <code>/a/b</code>.</p>
<p><a href="xdb18res.htm#GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CJAGAEHJ">Example 24-3</a> is the same as <a href="xdb18res.htm#GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CHDGBEFF">Example 24-2</a>, except that the test is <span class="italic">not</span>-equals (<code>!=</code>) instead of equals (<code>=</code>). The query in <a href="xdb18res.htm#GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CJAGAEHJ">Example 24-3</a> finds <span class="italic">all paths in the repository</span> that are <span class="italic">not</span> under path <code>/a/b</code>.</p>
<p><a href="xdb18res.htm#GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CIHJFIGD">Example 24-4</a> shows the relative paths that are under repository folders <code>a/b</code> and <code>/a/e</code>, respectively. The expression <code>path(</code><span class="bold"><code>1</code></span><code>)</code> represents the paths that are under folder <code>a/b</code>, since it uses the same correlation number, <span class="bold"><code>1</code></span>, as the expression <code>under_path(RES, &#39;/a/b&#39;,</code> <span class="bold"><code>1</code></span><code>)</code>, which specifies folder <code>a/b</code>. Similarly for <code>path(2)</code> and folder <code>/a/e</code>. Expression <code>ANY_PATH</code> returns the corresponding absolute paths.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CHDFJCAJ">
<p class="titleinexample">Example 24-1 Determining Paths Under a Path: Relative</p>
<pre dir="ltr">SELECT path(<span class="bold">1</span>) FROM RESOURCE_VIEW WHERE under_path(RES, &#39;/a/b&#39;, <span class="bold">1</span>) = 1;
</pre>
<pre dir="ltr">PATH(1)
-------
c
c/d

2 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CHDGBEFF">
<p class="titleinexample">Example 24-2 Determining Paths Under a Path: Absolute</p>
<pre dir="ltr">SELECT <span class="bold">ANY_PATH</span> FROM RESOURCE_VIEW WHERE under_path(RES, &#39;/a/b&#39;) = 1;
</pre>
<pre dir="ltr">ANY_PATH
--------
/a/b/c
/a/b/c/d

2 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CJAGAEHJ">
<p class="titleinexample">Example 24-3 Determining Paths Not Under a Path</p>
<pre dir="ltr">SELECT ANY_PATH FROM RESOURCE_VIEW WHERE under_path(RES, &#39;/a/b&#39;) <span class="bold">!=</span> 1
</pre>
<pre dir="ltr">ANY_PATH
--------
/a
/a/b
/a/e
/a/e/c
/a/e/c/d
/home
/home/OE
/home/OE/PurchaseOrders
/home/OE/PurchaseOrders/2002
/home/OE/PurchaseOrders/2002/Apr
/home/OE/PurchaseOrders/2002/Apr/AMCEWEN-20021009123336171PDT.xml
/home/OE/PurchaseOrders/2002/Apr/AMCEWEN-20021009123336271PDT.xml
/home/OE/PurchaseOrders/2002/Apr/EABEL-20021009123336251PDT.xml
<span class="bold">. . .</span>
/public
/sys
/sys/acls
/sys/acls/all_all_acl.xml
/sys/acls/all_owner_acl.xml
/sys/acls/bootstrap_acl.xml
/sys/acls/ro_all_acl.xml
/sys/apps
/sys/apps/plsql
/sys/apps/plsql/xs
/sys/apps/plsql/xs/netaclrc.xml
/sys/apps/plsql/xs/netaclsc.xml
/sys/databaseSummary.xml
/sys/log
/sys/schemas
/sys/schemas/OE
/sys/schemas/OE/localhost:8080
<span class="bold">. . .</span>

326 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__CIHJFIGD">
<p class="titleinexample">Example 24-4 Determining Paths Using Multiple Correlations</p>
<pre dir="ltr">SELECT ANY_PATH, path(<span class="bold">1</span>), path(<span class="bold">2</span>) 
  FROM RESOURCE_VIEW
  WHERE under_path(RES, &#39;/a/b&#39;, <span class="bold">1</span>) = 1 OR under_path(RES, &#39;/a/e&#39;, <span class="bold">2</span>) = 1;
</pre>
<pre dir="ltr">ANY_PATH   PATH(<span class="bold">1</span>)  PATH(<span class="bold">2</span>)
---------- -------- --------
/a/b/c     c
/a/b/c/d   c/d
/a/e/c              c
/a/e/c/d            c/d
 
4 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-AB641B8B-3ABD-4CAF-B50C-BA2BB2E58DEE">
<p class="titleinexample">Example 24-5 Relative Path Names for Three Levels of Resources</p>
<pre dir="ltr">SELECT path(1) FROM RESOURCE_VIEW WHERE under_path(RES, <span class="bold">3</span>, &#39;/sys&#39;, 1) = 1;
</pre>
<p>This produces a result similar to the following.</p>
<pre dir="ltr">PATH(1)
-------
acls
acls/all_all_acl.xml
acls/all_owner_acl.xml
acls/bootstrap_acl.xml
acls/ro_all_acl.xml
apps
apps/plsql
apps/plsql/xs
databaseSummary.xml
log
schemas
schemas/OE
schemas/OE/localhost:8080
schemas/PUBLIC
schemas/PUBLIC/www.w3.org
schemas/PUBLIC/xmlns.oracle.com
 
93 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-F78B2B79-9530-4572-BDD2-80C248A0ABD6">
<p class="titleinexample">Example 24-6 Extracting Resource Metadata Using UNDER_PATH</p>
<pre dir="ltr">SELECT ANY_PATH,
       XMLQuery(&#39;declare namespace ns = &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                 $r/ns:Resource&#39; PASSING RES AS &#34;r&#34; RETURNING CONTENT)
  FROM RESOURCE_VIEW WHERE under_path(RES, &#39;/sys&#39;) = 1;
 
</pre>
<p>This produces a result similar to the following:</p>
<pre dir="ltr">ANY_PATH
--------
XMLQUERY(&#39;DECLARENAMESPACENS=&#34;HTTP://XMLNS.ORACLE.COM/XDB/XDBRESOURCE.XSD&#34;;(::)$
--------------------------------------------------------------------------------
/sys/acls
&lt;Resource xmlns=&#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;&gt;
  &lt;CreationDate&gt;2008-06-25T13:17:45.164662&lt;/CreationDate&gt;
  &lt;ModificationDate&gt;2008-06-25T13:17:47.865163&lt;/ModificationDate&gt;
  &lt;DisplayName&gt;acls&lt;/DisplayName&gt;
  &lt;Language&gt;en-US&lt;/Language&gt;
  &lt;CharacterSet&gt;UTF-8&lt;/CharacterSet&gt;
  &lt;ContentType&gt;application/octet-stream&lt;/ContentType&gt;
  &lt;RefCount&gt;1&lt;/RefCount&gt;
&lt;/Resource&gt;
 
/sys/acls/all_all_acl.xml
&lt;Resource xmlns=&#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;&gt;
  &lt;CreationDate&gt;2008-06-25T13:17:47.759806&lt;/CreationDate&gt;
  &lt;ModificationDate&gt;2008-06-25T13:17:47.759806&lt;/ModificationDate&gt;
  &lt;DisplayName&gt;all_all_acl.xml&lt;/DisplayName&gt;
  &lt;Language&gt;en-US&lt;/Language&gt;
  &lt;CharacterSet&gt;UTF-8&lt;/CharacterSet&gt;
  &lt;ContentType&gt;text/xml&lt;/ContentType&gt;
  &lt;RefCount&gt;1&lt;/RefCount&gt;
&lt;/Resource&gt;
<span class="bold">. . .</span>
41 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-DABD3140-6CE3-4D51-A760-1653001E2124">
<p class="titleinexample">Example 24-7 Using Functions PATH and DEPTH with PATH_VIEW</p>
<pre dir="ltr">SELECT path(1) path, depth(1) <span class="bold">depth</span> FROM PATH_VIEW 
  WHERE under_path(RES, 3, &#39;/sys&#39;, 1) = 1;
 
</pre>
<p>This produces a result similar to the following:</p>
<pre dir="ltr">PATH                                      DEPTH
----                                      -----
acls                                      1
acls/all_all_acl.xml                      2
acls/all_owner_acl.xml                    2
acls/bootstrap_acl.xml                    2
acls/ro_all_acl.xml                       2
apps                                      1
apps/plsql                                2
apps/plsql/xs                             3
databaseSummary.xml                       1
log                                       1
schemas                                   1
schemas/OE                                2
schemas/OE/localhost:8080                 3
schemas/PUBLIC                            2
schemas/PUBLIC/www.w3.org                 3
schemas/PUBLIC/xmlns.oracle.com           3
<span class="bold">. . .</span>
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-71239F55-D92B-415C-BF4E-6F7326E294F8">
<p class="titleinexample">Example 24-8 Extracting Link and Resource Information from PATH_VIEW</p>
<pre dir="ltr">SELECT PATH, 
       XMLCast(XMLQuery(
                 &#39;declare namespace ns =
                           &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                  $l/ns:LINK/ns:<span class="bold">Name</span>&#39; PASSING LINK AS &#34;l&#34; RETURNING CONTENT)
               AS VARCHAR2(256)),
       XMLCast(XMLQuery(
                 &#39;declare namespace ns =
                           &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                  $l/ns:LINK/ns:<span class="bold">ParentName</span>&#39; PASSING LINK AS &#34;l&#34; RETURNING CONTENT)
               AS VARCHAR2(256)),
       XMLCast(XMLQuery(
                 &#39;declare namespace ns =
                           &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                  $l/ns:LINK/ns:<span class="bold">ChildName</span>&#39; PASSING LINK AS &#34;l&#34; RETURNING CONTENT)
               AS VARCHAR2(256)),
       XMLCast(XMLQuery(
                 &#39;declare namespace ns =
                           &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                  $r/ns:Resource/ns:<span class="bold">DisplayName</span>&#39; 
                    PASSING RES AS &#34;r&#34; RETURNING CONTENT)
               AS VARCHAR2(128))
  FROM PATH_VIEW WHERE PATH LIKE &#39;/sys%&#39;;
</pre>
<p>This produces a result similar to the following:</p>
<pre dir="ltr">/sys/schemas/PUBLIC/www.w3.org/1999/xlink.xsd
xlink.xsd
 
/sys/schemas/PUBLIC/www.w3.org/1999/xlink
xlink
 
/sys/schemas/PUBLIC/www.w3.org/1999/csx.xlink.xsd
csx.xlink.xsd

<span class="bold">. . .</span>

118 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-85811A9F-1BC2-44E2-801B-30B647BB9848">
<p class="titleinexample">Example 24-9 All Repository Paths to a Certain Depth Under a Path</p>
<pre dir="ltr">SELECT path(1) FROM PATH_VIEW WHERE under_path(RES, 3, &#39;/sys&#39;, 1) &gt; 0;
</pre>
<p>This produces a result similar to the following:</p>
<pre dir="ltr">PATH(1)
-------
acls
acls/all_all_acl.xml
acls/all_owner_acl.xml
acls/bootstrap_acl.xml
acls/ro_all_acl.xml
apps
apps/plsql
apps/plsql/xs
databaseSummary.xml
log
principals
principals/groups
principals/users
schemas
schemas/PUBLIC
schemas/PUBLIC/www.opengis.net
schemas/PUBLIC/www.w3.org
schemas/PUBLIC/xmlns.oracle.com
workspaces
<span class="bold">. . .</span>
 
43 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-E464CEE1-C930-48DC-90F3-76064C8DB1D9">
<p class="titleinexample">Example 24-10 Locating a Repository Path Using EQUALS_PATH</p>
<pre dir="ltr">SELECT ANY_PATH FROM RESOURCE_VIEW WHERE equals_path(RES, &#39;/sys&#39;) &gt; 0;
</pre>
<pre dir="ltr">ANY_PATH
--------
/sys
 
1 row selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-8BBBEBF0-F941-4599-B7AE-DC9C88478E23">
<p class="titleinexample">Example 24-11 Retrieve RESID of a Given Resource</p>
<pre dir="ltr">SELECT RESID FROM RESOURCE_VIEW
  WHERE XMLCast(XMLQuery(
                  &#39;declare namespace ns = 
                     &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                   $r/ns:Resource/ns:DisplayName&#39;
                  PASSING RES AS &#34;r&#34; RETURNING CONTENT)
                AS VARCHAR2(128))
        = &#39;example&#39;;
</pre>
<p>This produces a result similar to the following:</p>
<pre dir="ltr">RESID
--------------------------------
F301A10152470252E030578CB00B432B
 
1 row selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-37A15864-9D84-4C6D-B3D5-2145CDAF7DBA">
<p class="titleinexample">Example 24-12 Obtaining the Path Name of a Resource from its RESID</p>
<pre dir="ltr">DECLARE
  resid_example RAW(16);
  path          VARCHAR2(4000);
BEGIN
  SELECT RESID INTO resid_example FROM RESOURCE_VIEW
    WHERE XMLCast(XMLQuery(
                    &#39;declare namespace ns =
                       &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                     $r/ns:Resource/ns:DisplayName&#39;
                    PASSING RES AS &#34;r&#34; RETURNING CONTENT)
                  AS VARCHAR2(128))
 
          = &#39;example&#39;;
  SELECT ANY_PATH INTO path FROM RESOURCE_VIEW WHERE RESID = resid_example;
  DBMS_OUTPUT.put_line(&#39;The path is: &#39; || path);
END;
/
<span class="bold">The path is: /public/example</span>
 
PL/SQL procedure successfully completed.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-3DB3DE06-D72F-4C84-858C-DA2D59B7A3D3">
<p class="titleinexample">Example 24-13 Folders Under a Given Path</p>
<pre dir="ltr">SELECT ANY_PATH FROM RESOURCE_VIEW
  WHERE under_path(RES, 1, &#39;/sys&#39;) = 1
    AND XMLExists(&#39;declare namespace ns = 
                     &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                   $r/ns:Resource[@Container = xs:boolean(&#34;true&#34;)]&#39;
                  PASSING RES AS &#34;r&#34;);
</pre>
<p>This produces a result like the following:</p>
<pre dir="ltr">ANY_PATH
--------
/sys/acls
/sys/apps
/sys/log
/sys/schemas
 
4 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BAED71B1-A65F-4119-BFF1-BD0E272EA44A__GUID-880F90AB-E95A-4A74-8527-649387BB9695">
<p class="titleinexample">Example 24-14 Joining RESOURCE_VIEW with an XMLType Table</p>
<pre dir="ltr">SELECT ANY_PATH, XMLQuery(&#39;$p/PurchaseOrder/LineItems&#39;
                          PASSING po.OBJECT_VALUE AS &#34;p&#34; RETURNING CONTENT)
  FROM purchaseorder po, RESOURCE_VIEW rv
  WHERE ref(po)
        = XMLCast(XMLQuery(&#39;declare default element namespace
                            &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                            fn:data(/Resource/XMLRef)&#39;
                           PASSING rv.RES RETURNING CONTENT)
                  AS REF XMLType)
    AND ROWNUM &lt; 2;
 
ANY_PATH
--------------------------------------------------------------------------------
XMLQUERY(&#39;$P/PURCHASEORDER/LINEITEMS&#39;PASSINGPO.OBJECT_VALUEAS&#34;P&#34;RETURNINGCONTENT
--------------------------------------------------------------------------------
/home/OE/PurchaseOrders/2002/Apr/AMCEWEN-20021009123336171PDT.xml
&lt;LineItems&gt;
  &lt;LineItem ItemNumber=&#34;1&#34;&gt;
    &lt;Description&gt;Salesman&lt;/Description&gt;
    &lt;Part Id=&#34;37429158920&#34; UnitPrice=&#34;39.95&#34; Quantity=&#34;2&#34;/&gt;
  &lt;/LineItem&gt;
  &lt;LineItem ItemNumber=&#34;2&#34;&gt;
    &lt;Description&gt;Big Deal on Madonna Street&lt;/Description&gt;
    &lt;Part Id=&#34;37429155424&#34; UnitPrice=&#34;29.95&#34; Quantity=&#34;1&#34;/&gt;
  &lt;/LineItem&gt;
  &lt;LineItem ItemNumber=&#34;3&#34;&gt;
    &lt;Description&gt;Hearts and Minds&lt;/Description&gt;
    &lt;Part Id=&#34;37429166321&#34; UnitPrice=&#34;39.95&#34; Quantity=&#34;1&#34;/&gt;
  &lt;/LineItem&gt;

<span class="bold">. . .</span>

  &lt;LineItem ItemNumber=&#34;23&#34;&gt;
    &lt;Description&gt;Great Expectations&lt;/Description&gt;
    &lt;Part Id=&#34;37429128022&#34; UnitPrice=&#34;39.95&#34; Quantity=&#34;4&#34;/&gt;
  &lt;/LineItem&gt;
&lt;/LineItems&gt;
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB5424"></a><a id="ADXDB5425"></a><a id="ADXDB5423"></a>
<div class="props_rev_3"><a id="GUID-BCA4A460-7C38-46E4-A827-E3B3B20DDB1F"></a>
<h2 id="ADXDB-GUID-BCA4A460-7C38-46E4-A827-E3B3B20DDB1F" class="sect2"><span class="enumeration_section">24.4</span> Deleting Repository Resources: Examples</h2>
<div>
<p>Examples here illustrate how to delete Oracle XML&nbsp;DB Repository resources and paths.</p>
<div class="section">
<p>If you delete only <span class="italic">leaf</span> resources, then you can use <code>DELETE FROM RESOURCE_VIEW</code>, as in <a href="xdb18res.htm#GUID-BCA4A460-7C38-46E4-A827-E3B3B20DDB1F__CJAJEJAB">Example 24-15</a>.</p>
<p>For multiple links to the same resource, deleting from <code>RESOURCE_VIEW</code> deletes the resource together with <span class="italic">all</span> of its links. Deleting from <code>PATH_VIEW</code> deletes only the link with the specified path.</p>
<p><a href="xdb18res.htm#GUID-BCA4A460-7C38-46E4-A827-E3B3B20DDB1F__CJAJFFDA">Example 24-16</a> illustrates this.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-BCA4A460-7C38-46E4-A827-E3B3B20DDB1F__CJAJEJAB">
<p class="titleinexample">Example 24-15 Deleting Resources</p>
<pre dir="ltr">DELETE FROM RESOURCE_VIEW WHERE equals_path(RES, &#39;/public/myfile&#39;) = 1&#39;;
 
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-BCA4A460-7C38-46E4-A827-E3B3B20DDB1F__CJAJFFDA">
<p class="titleinexample">Example 24-16 Deleting Links to Resources</p>
<p>Suppose that <code>&#39;/home/myfile1&#39;</code> is a link to <code>&#39;/public/myfile&#39;</code>:</p>
<pre dir="ltr">CALL DBMS_XDB_REPOS.link(&#39;/public/myfile&#39;, &#39;/home&#39;, &#39;myfile1&#39;);
</pre>
<p>The following SQL DML statement deletes everything in Oracle XML&nbsp;DB Repository that is found at path <code>/home/myfile1</code> &ndash; both the link and the resource:</p>
<pre dir="ltr">DELETE FROM <span class="bold">RESOURCE_VIEW</span> WHERE equals_path(RES, &#39;/home/myfile1&#39;) = 1;
</pre>
<p>The following DML statement deletes <span class="italic">only the link</span> with path <code>/home/file1</code>:</p>
<pre dir="ltr">DELETE FROM <span class="bold">PATH_VIEW</span> WHERE equals_path(RES, &#39;/home/file1&#39;) = 1;
</pre></div>
<!-- class="example" --></div>
<a id="ADXDB5427"></a><a id="ADXDB5426"></a>
<div class="props_rev_3"><a id="GUID-2CDB9961-1ADE-4133-9253-3F34935F2DEB"></a>
<h3 id="ADXDB-GUID-2CDB9961-1ADE-4133-9253-3F34935F2DEB" class="sect3"><span class="enumeration_section">24.4.1</span> Deleting Nonempty Folder Resources</h3>
<div>
<p>The <code>DELETE</code> DML operator is not allowed on a nonempty folder. If you try to delete a nonempty folder, you must first delete its contents and then delete the resulting empty folder. This rule must be applied recursively to any folders contained in the target folder.</p>
<div class="section">
<p>However, the order of the paths returned from a <code>WHERE</code> clause is not guaranteed, and the <code>DELETE</code> operator does not allow an <code>ORDER BY</code> clause in its table-expression subclause. You <span class="italic">cannot</span> do the following:</p>
<pre dir="ltr">DELETE FROM (SELECT 1 FROM RESOURCE_VIEW
               WHERE under_path(RES, &#39;/public&#39;, 1) = 1
               ORDER BY depth(1) DESCENDING);
</pre>
<p><a href="xdb18res.htm#GUID-2CDB9961-1ADE-4133-9253-3F34935F2DEB__CHDJHEHB">Example 24-17</a> illustrates how to delete a nonempty folder: folder <code>example</code> is deleted, along with its subfolder <code>example1</code>.</p>
<div class="infobox-note" id="GUID-2CDB9961-1ADE-4133-9253-3F34935F2DEB__GUID-B4A18C04-7C18-40F2-B204-E4E75B1786A3">
<p class="notep1">Note:</p>
<p>As always, take care to avoid deadlocks with concurrent transactions when operating on multiple rows.</p>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-2CDB9961-1ADE-4133-9253-3F34935F2DEB__CHDJHEHB">
<p class="titleinexample">Example 24-17 Deleting a Nonempty Folder</p>
<pre dir="ltr">SELECT PATH FROM PATH_VIEW WHERE under_path(RES, &#39;/home/US1&#39;) = 1;
 
PATH
--------------------------
/home/US1/example
/home/US1/example/example1
 
2 rows selected.

DECLARE
  CURSOR c1 IS
    SELECT ANY_PATH p FROM RESOURCE_VIEW
      WHERE under_path(RES, &#39;/home/US1&#39;, 1) = 1
        AND XMLExists(&#39;declare namespace ns =
                         &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                       $r/ns:Resource[ns:Owner=&#34;US1&#34;]&#39; PASSING RES AS &#34;r&#34;)
      ORDER BY depth(1) DESC;
  del_stmt VARCHAR2(500) :=
    &#39;DELETE FROM RESOURCE_VIEW WHERE equals_path(RES, :1)=1&#39;;
BEGIN
  FOR r1 IN c1 LOOP
    EXECUTE IMMEDIATE del_stmt USING r1.p;
  END LOOP;
END;
/
 
PL/SQL procedure successfully completed.
 
SELECT PATH FROM PATH_VIEW WHERE under_path(RES, &#39;/home/US1&#39;) = 1;
 
<span class="bold">no rows selected</span>
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADXDB5429"></a><a id="ADXDB5430"></a><a id="ADXDB5428"></a>
<div class="props_rev_3"><a id="GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D"></a>
<h2 id="ADXDB-GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D" class="sect2"><span class="enumeration_section">24.5</span> Updating Repository Resources: Examples</h2>
<div>
<p>Examples here illustrate how to update Oracle XML&nbsp;DB Repository resources and paths.</p>
<div class="section">
<p><a href="xdb18res.htm#GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D__CJAIBBFE">Example 24-18</a> changes the resource at path <code>/test/HR/example/paper</code>.</p>
<div class="infoboxnotealso" id="GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D__GUID-8A45A7E3-19A5-4FDB-8761-4FEC2482BE84">
<p class="notep1">See Also:</p>
<p><a href="xdb_repos_meta.htm#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a> for additional examples of updating resource metadata</p>
</div>
<p>Note that, by default, the <code>DisplayName</code> element content, <code>paper</code>, was the same text as the last location step of the resource path, <code>/test/HR/example/paper</code>. This is only the default value, however. The <code>DisplayName</code> is independent of the resource path, so updating it does not change the path.</p>
<p>Element <code>DisplayName</code> is defined by the WebDAV standard, and it is recognized by WebDAV applications. Applications, such as an FTP client, that are not WebDAV-based do not recognize the <code>DisplayName</code> of a resource. An FTP client lists the resource as <code>paper</code> (using FTP command <code>ls</code>, for example) even after the <code>UPDATE</code> operation.</p>
<p><a href="xdb18res.htm#GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D__CJAHGHGE">Example 24-19</a> changes the path for the resource from <code>/test/HR/example/paper</code> to <code>/test/myexample</code>. It is analogous to using the UNIX or Linux command <code>mv /test/HR/example/paper /test/myexample</code>.</p>
<div class="infoboxnotealso" id="GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D__GUID-7C479194-D4FF-4D3C-8B0B-5619DAC16A88">
<p class="notep1">See Also:</p>
<p><a href="xdb16fol.htm#GUID-B162A199-F7F8-4E81-B2FD-919B90F7FE83__BABBJJDI" title="This table describes the API options for accessing Oracle XML DB Repository.">Table 21-3</a> for additional examples that use SQL functions that apply to <code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code></p>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D__CJAIBBFE">
<p class="titleinexample">Example 24-18 Updating a Resource</p>
<p>This is the complete resource before the update operation:</p>
<pre dir="ltr">SELECT XMLSerialize(DOCUMENT r.RES AS CLOB)
  FROM RESOURCE_VIEW r WHERE equals_path(r.RES, &#39;/test/HR/example/paper&#39;) = 1;
 
XMLSERIALIZE(DOCUMENTR.RESASCLOB)
--------------------------------------------------------------------------------
&lt;Resource xmlns=&#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34; Hidden=&#34;false&#34; Inv
alid=&#34;false&#34; Container=&#34;false&#34; CustomRslv=&#34;false&#34; VersionHistory=&#34;false&#34; StickyR
ef=&#34;true&#34;&gt;
  &lt;CreationDate&gt;2005-04-29T16:30:01.588835&lt;/CreationDate&gt;
  &lt;ModificationDate&gt;2005-04-29T16:30:01.588835&lt;/ModificationDate&gt;
  &lt;DisplayName&gt;<span class="bold">paper</span>&lt;/DisplayName&gt;
  &lt;Language&gt;en-US&lt;/Language&gt;
  &lt;CharacterSet&gt;UTF-8&lt;/CharacterSet&gt;
  &lt;ContentType&gt;application/octet-stream&lt;/ContentType&gt;
  &lt;RefCount&gt;1&lt;/RefCount&gt;
  &lt;ACL&gt;
    &lt;acl description=&#34;Public:All privileges to PUBLIC&#34; xmlns=&#34;http://xmlns.oracl
e.com/xdb/acl.xsd&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:sch
emaLocation=&#34;http://xmlns.oracle.com/xdb/acl.xsd                           http:
//xmlns.oracle.com/xdb/acl.xsd&#34;&gt;
      &lt;ace&gt;
        &lt;principal&gt;PUBLIC&lt;/principal&gt;
        &lt;grant&gt;true&lt;/grant&gt;
        &lt;privilege&gt;
          &lt;all/&gt;
        &lt;/privilege&gt;
      &lt;/ace&gt;
    &lt;/acl&gt;
  &lt;/ACL&gt;
  &lt;Owner&gt;TESTUSER1&lt;/Owner&gt;
  &lt;Creator&gt;TESTUSER1&lt;/Creator&gt;
  &lt;LastModifier&gt;TESTUSER1&lt;/LastModifier&gt;
  &lt;SchemaElement&gt;http://xmlns.oracle.com/xdb/XDBSchema.xsd#binary&lt;/SchemaElement
&gt;
  &lt;Contents&gt;
    &lt;binary&gt;4F7261636C65206F7220554E4958&lt;/binary&gt;
  &lt;/Contents&gt;
&lt;/Resource&gt;
 
1 row selected.
</pre>
<p>All of the XML elements shown here are resource <span class="italic">metadata</span> elements, with the exception of <code>Contents</code>, which contains the resource <span class="italic">content</span>.</p>
<p>This <code>UPDATE</code> statement updates (only) the <code>DisplayName</code> metadata element.</p>
<pre dir="ltr">UPDATE RESOURCE_VIEW r
  SET r.RES =
    XMLQuery(&#39;copy $i := $p1 modify
                (for $j in $i/Resource/DisplayName
                 return replace value of node $j with $p2)
              return $i&#39;
             PASSING r.RES AS &#34;p1&#34;, &#39;My New Paper&#39; AS &#34;p2&#34;
             RETURNING CONTENT)
    WHERE equals_path(r.RES, &#39;/test/HR/example/paper&#39;) = 1;
 
1 row updated.

SELECT XMLSerialize(DOCUMENT r.RES AS CLOB)
  FROM RESOURCE_VIEW r WHERE equals_path(r.RES, &#39;/test/HR/example/paper&#39;) = 1;
 
XMLSERIALIZE(DOCUMENTR.RESASCLOB)
--------------------------------------------------------------------------------
&lt;Resource xmlns=&#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34; Hidden=&#34;false&#34; Inv
alid=&#34;false&#34; Container=&#34;false&#34; CustomRslv=&#34;false&#34; VersionHistory=&#34;false&#34; StickyR
ef=&#34;true&#34;&gt;
  &lt;CreationDate&gt;2005-04-29T16:30:01.588835&lt;/CreationDate&gt;
  &lt;ModificationDate&gt;2005-04-29T16:30:01.883838&lt;/ModificationDate&gt;
  &lt;DisplayName&gt;<span class="bold">My New Paper</span>&lt;/DisplayName&gt;
  &lt;Language&gt;en-US&lt;/Language&gt;

  <span class="bold">. . .</span>

  &lt;Contents&gt;
    &lt;binary&gt;4F7261636C65206F7220554E4958&lt;/binary&gt;
  &lt;/Contents&gt;
&lt;/Resource&gt;
 
1 row selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-3DDCD870-2149-494C-AA20-E7D269CC6E7D__CJAHGHGE">
<p class="titleinexample">Example 24-19 Updating a Path in the PATH_VIEW</p>
<pre dir="ltr">SELECT ANY_PATH FROM RESOURCE_VIEW WHERE under_path(RES, &#39;/test&#39;) = 1;
 
ANY_PATH
--------
/test/HR
/test/HR/example
/test/HR/<span class="bold">example/paper</span>
 
3 rows selected.

UPDATE PATH_VIEW 
  SET PATH = &#39;/test/<span class="bold">myexample</span>&#39; WHERE PATH = &#39;/test/HR/<span class="bold">example/paper</span>&#39;;

ANY_PATH
--------
/test/HR
/test/HR/example
/test/<span class="bold">myexample</span>
 
3 rows selected.
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB5432"></a><a id="ADXDB5433"></a><a id="ADXDB5434"></a><a id="ADXDB5431"></a>
<div class="props_rev_3"><a id="GUID-EB652889-E723-4727-B2BC-DFFC378037FD"></a>
<h2 id="ADXDB-GUID-EB652889-E723-4727-B2BC-DFFC378037FD" class="sect2"><span class="enumeration_section">24.6</span> Working with Multiple Oracle XML&nbsp;DB Resources</h2>
<div>
<p>To perform an operation on multiple Oracle XML&nbsp;DB resources, or to find one or more Oracle XML&nbsp;DB resources that meet a certain set of criteria, use SQL with <code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code>.</p>
<div class="section">
<p>For example, you can perform the following operations:</p>
<ul style="list-style-type: disc;">
<li>
<p>Update resources based on attributes &ndash; see <a href="xdb18res.htm#GUID-EB652889-E723-4727-B2BC-DFFC378037FD__CHDDHFII">Example 24-20</a></p>
</li>
<li>
<p>Finding resources inside a folder &ndash; see <a href="xdb18res.htm#GUID-EB652889-E723-4727-B2BC-DFFC378037FD__CHDJCACB">Example 24-21</a></p>
</li>
<li>
<p>Copy a set of Oracle XML&nbsp;DB resources &ndash; see <a href="xdb18res.htm#GUID-EB652889-E723-4727-B2BC-DFFC378037FD__CHDIGEEH">Example 24-22</a></p>
</li>
</ul>
<p>The SQL DML statement in <a href="xdb18res.htm#GUID-EB652889-E723-4727-B2BC-DFFC378037FD__CHDIGEEH">Example 24-22</a> copies all of the resources in folder <code>public</code> to folder <code>newlocation</code>. It is analogous to the UNIX or Linux command <code>cp /public/* /newlocation</code>. Target folder <code>newlocation</code> must exist before the copy.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-EB652889-E723-4727-B2BC-DFFC378037FD__CHDDHFII">
<p class="titleinexample">Example 24-20 Updating Resources Based on Attributes</p>
<pre dir="ltr">UPDATE RESOURCE_VIEW
  SET RES =
    XMLQuery(&#39;copy $i := $p1 modify
                (for $j in $i/Resource/DisplayName
                 return replace value of node $j with $p2)
               return $i&#39;
              PASSING RES AS &#34;p1&#34;, &#39;My New Paper&#39; AS &#34;p2&#34;
              RETURNING CONTENT)
  WHERE XMLCast(XMLQuery(&#39;declare namespace ns =
                          &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)    
                          $r/ns:Resource/ns:DisplayName&#39;
                         PASSING RES AS &#34;r&#34; RETURNING CONTENT)
                AS VARCHAR2(128))
        = &#39;My Paper&#39;;
 
1 row updated.
 
SELECT ANY_PATH FROM RESOURCE_VIEW
  WHERE XMLCast(XMLQuery(&#39;declare namespace ns =
                            &#34;http://xmlns.oracle.com/xdb/XDBResource.xsd&#34;; (: :)
                          $r/ns:Resource/ns:DisplayName&#39;
                         PASSING RES AS &#34;r&#34; RETURNING CONTENT)
                AS VARCHAR2(128))
          = &#39;My New Paper&#39;;
 
ANY_PATH
---------------
/test/myexample
 
1 row selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-EB652889-E723-4727-B2BC-DFFC378037FD__CHDJCACB">
<p class="titleinexample">Example 24-21 Finding Resources Inside a Folder</p>
<pre dir="ltr">SELECT ANY_PATH FROM RESOURCE_VIEW
  WHERE under_path(resource, &#39;/sys/schemas/PUBLIC/xmlns.oracle.com/xdb&#39;) = 1;

ANY_PATH
--------------------------------------------------------------
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/XDBResource.xsd
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/XDBSchema.xsd
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/XDBStandard.xsd
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/acl.xsd
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/dav.xsd
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/log
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/log/xdblog.xsd
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/stats.xsd
/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/xdbconfig.xsd
 
12 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-EB652889-E723-4727-B2BC-DFFC378037FD__CHDIGEEH">
<p class="titleinexample">Example 24-22 Copying Resources</p>
<pre dir="ltr">SELECT PATH FROM PATH_VIEW WHERE under_path(RES, &#39;/test&#39;) = 1;
 
PATH
-----------------
/test/HR
/test/HR/example
/test/myexample
 
3 rows selected.
 
INSERT INTO PATH_VIEW
  SELECT &#39;/newlocation/&#39; || path(1), RES, LINK, NULL FROM PATH_VIEW
    WHERE under_path(RES, &#39;/test&#39;, 1) = 1
    ORDER BY depth(1);
 
3 rows created.
 
SELECT PATH FROM PATH_VIEW WHERE under_path(RES, &#39;/newlocation&#39;) = 1;
 
PATH
------------------------
/newlocation/HR
/newlocation/HR/example
/newlocation/myexample
 
3 rows selected.
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB5435"></a>
<div class="props_rev_3"><a id="GUID-9022CFD7-F8C8-434D-A3D6-21208328B2F2"></a>
<h2 id="ADXDB-GUID-9022CFD7-F8C8-434D-A3D6-21208328B2F2" class="sect2"><span class="enumeration_section">24.7</span> Performance Guidelines for Oracle XML&nbsp;DB Repository Operations</h2>
<div>
<p>Guidelines are presented for improving the performance of repository operations such as resource creation and querying.</p>
<p>Folders that contain a large number of resources can negatively affect concurrency, particularly when many resources are created or deleted. As a rule of thumb, do not have folders that contain more than 10,000 resources. This empirical limit is based on the database block size and the average filename length.</p>
<p>If you create resources in bulk, perform a <code>COMMIT</code> operation at least every 1,000 resources. Performance can be negatively impacted if you commit very often or you commit less often than every 1,000 resource creations.</p>
<p>When creating a file resource that is an XML Schema-based document for which the XML schema is known, specify the XML schema URL as a parameter to PL/SQL function <code>DBMS_XDB_REPOS.createResource</code>. This saves preparsing the document to determine the XML schema.</p>
<p>Oracle XML&nbsp;DB uses configuration file <code>xdbconfig.xml</code> for configuring the system and protocol environment. This file includes an element parameter, <code>resource-view-cache-size</code>, that defines the size in dynamic memory of the <code>RESOURCE_VIEW</code> cache. The default value is <code>1048576</code>.</p>
<p>The performance of some queries on <code>RESOURCE_VIEW</code> and <code>PATH_VIEW</code> can be improved by tuning <code>resource-view-cache-size</code>. In general, the bigger the cache size, the faster the query. The default <code>resource-view-cache-size</code> is appropriate for most cases, but you may want to enlarge your <code>resource-view-cache-size</code> element when querying a sizable <code>RESOURCE_VIEW</code>.</p>
<p>The default limits for the following elements are soft limits. The system automatically adapts when these limits are exceeded.</p>
<ul style="list-style-type: disc;">
<li>
<p><code>xdbcore-loadableunit-size</code> &ndash; This element indicates the maximum size to which a loadable unit (partition) can grow in Kilobytes. When a partition is read into memory or a partition is built while consuming a new document, the partition is built until it reaches the maximum size. The default value is 16 KB.</p>
</li>
<li>
<p><code>xdbcore-xobmem-bound</code> &ndash; This element indicates the maximum memory in kilobytes that a document is allowed to occupy. The default value is 1024 KB. Once the document exceeds this number, some loadable units (partitions) are swapped out.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-9022CFD7-F8C8-434D-A3D6-21208328B2F2__GUID-975D85E4-5474-47FC-8B2D-AB9C52889DC7">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="appaman.htm#GUID-FD0BCF20-2345-4D78-B96F-C52A4361291D" title="Administration of Oracle XML&nbsp;DB includes installing, upgrading, and configuring it.">Administration of Oracle XML&nbsp;DB</a></p>
</li>
<li>
<p><a class="olink ARPLS74212" target="_blank" href="../ARPLS/d_xdb_repos.htm#ARPLS74212"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about PL/SQL function <code>DBMS_XDB_REPOS.createResource</code></p>
</li>
</ul>
</div>
</div>
</div>
<a id="ADXDB5437"></a><a id="ADXDB5438"></a><a id="ADXDB5436"></a>
<div class="props_rev_3"><a id="GUID-79391B36-9690-44DC-8923-653CFE299E9C"></a>
<h2 id="ADXDB-GUID-79391B36-9690-44DC-8923-653CFE299E9C" class="sect2"><span class="enumeration_section">24.8</span> Searching for Resources Using Oracle Text</h2>
<div>
<p>Table <code>XDB$RESOURCE</code> in database schema <code>XDB</code> stores the metadata and content of repository resources. You can search for resources that contain a specific keyword by using Oracle SQL function <code>contains</code> with <code>RESOURCE_VIEW</code> or <code>PATH_VIEW</code>.</p>
<div class="section">
<p>To evaluate such queries, you must first create a context index on the <code>XDB$RESOURCE</code> table. Depending on the type of documents stored in Oracle XML&nbsp;DB, choose one of the following options for creating your context index:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">If Oracle XML&nbsp;DB contains only XML documents</span>, that is, no binary data, then a regular Context Index can be created on the <code>XDB$RESOURCE</code> table. This is the case for <a href="xdb18res.htm#GUID-79391B36-9690-44DC-8923-653CFE299E9C__CHDDAJAE">Example 24-24</a>.</p>
<pre dir="ltr">CREATE INDEX xdb$resource_ctx_i ON XDB.XDB$RESOURCE(OBJECT_VALUE)
  INDEXTYPE IS CTXSYS.CONTEXT;
</pre>
<div class="infoboxnotealso" id="GUID-79391B36-9690-44DC-8923-653CFE299E9C__GUID-CBE7DF65-CC75-4A8D-ACA2-B9FAC954A2C0">
<p class="notep1">See Also:</p>
<p><a href="xdb04cre.htm#GUID-01C75289-804F-4BAA-AE7C-DFA73198581E" title="There are many ways for applications to query and update XML data that is in Oracle Database, both XML schema-based and non-schema-based.">Query and Update of XML Data</a> and <a href="app_depr_otext.htm#GUID-1B838D2B-DD94-480A-8D3D-53E0204A2282" title="Oracle-specific full-text search over XML data is described, including how to use Oracle SQL function contains and Oracle XPath function ora:contains.">Full-Text Search over XML Data Without XQuery</a></p>
</div>
</li>
<li>
<p><span class="italic">If Oracle XML&nbsp;DB contains binary data</span> such as Microsoft Word documents, then a user filter is required to filter such documents prior to indexing. Use package <code>DBMS_XDBT</code> (<code>dbmsxdbt.sql</code>) to create and configure the Context Index.</p>
<pre dir="ltr">-- Install the package - connected as SYS
@dbmsxdbt
-- Create the preferences
EXEC DBMS_XDBT.createPreferences;
-- Create the index
EXEC DBMS_XDBT.createIndex;
</pre>
<div class="infoboxnotealso" id="GUID-79391B36-9690-44DC-8923-653CFE299E9C__GUID-DFA002DE-3E53-48BD-9F12-ED35D82745A3">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ARPLS372" target="_blank" href="../ARPLS/d_xdbt.htm#ARPLS372"><span class="italic">Oracle Database PL/SQL Packages and Types Reference,</span></a> for information about installing and using <code>DBMS_XDBT</code>.</p>
</li>
<li>
<p><span class="q">&#34;<a href="xdb10pls.htm#GUID-63032A9C-B4E2-4BB9-89E5-EBEEEF282C39" title="The PL/SQL Application Programming Interfaces (APIs) for XMLType are described.">PL/SQL APIs for XMLType: References</a>&#34;</span></p>
</li>
</ul>
</div>
</li>
</ul>
<p>Package <code>DBMS_XDBT</code> also includes procedures to synchronize and optimize the index. You can use procedure <code>configureAutoSync()</code> to automatically sync the index by using job queues.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-79391B36-9690-44DC-8923-653CFE299E9C__GUID-75B8AE41-CC42-4FDA-8C48-8EA7F0B9E4C9">
<p class="titleinexample">Example 24-23 Find All Resources Containing &#34;Paper&#34;</p>
<pre dir="ltr">SELECT PATH FROM PATH_VIEW WHERE contains(RES, &#39;Paper&#39;) &gt; 0;

PATH
-----------------------
/newlocation/myexample
/test/myexample
 
2 rows selected.
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-79391B36-9690-44DC-8923-653CFE299E9C__CHDDAJAE">
<p class="titleinexample">Example 24-24 Find All Resources Containing &#34;Paper&#34; that are Under a Specified Path</p>
<pre dir="ltr">SELECT ANY_PATH FROM RESOURCE_VIEW
   WHERE contains(RES, &#39;Paper&#39;) &gt; 0 AND under_path(RES, &#39;/test&#39;) &gt; 0;

ANY_PATH
----------------
/test/myexample
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment3410">
<tr>
<td class="cellalignment3417">
<table class="cellalignment3415">
<tr>
<td class="cellalignment3414"><a href="xdb_xlink.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment3414"><a href="xdb17ver.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment3419">
<table class="cellalignment3413">
<tr>
<td class="cellalignment3414"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment3414"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment3414"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment3414"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment3414"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment3414"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>