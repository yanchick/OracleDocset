<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-1611"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/The%20C%20API%20for%20XML"></a><title>The C API for XML</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C."/>
<meta name="keywords" content="C API for XML, OCI API for XML"/>
<meta name="dcterms.created" content="2016-12-08T13:53:25Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="XML DB Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E41152-15"/>
<meta name="dcterms.isVersionOf" content="ADXDB"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="xdb11jav.htm" title="Previous" type="text/html"/>
<link rel="Next" href="xdb_odpnet.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41152-15.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9"></a> <span id="PAGE" style="display:none;">25/61</span> <!-- End Header -->
<a id="ADXDB1400"></a>
<h1 id="ADXDB-GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" class="sect1"><span class="enumeration_chapter">14</span> The C API for XML</h1>
<div>
<p>The C DOM API for <code>XMLType</code> lets you operate on <code>XMLType</code> instances using a DOM in C.</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="xdb12oci.htm#GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659" title="The C API for XML is a DOM API that is used for Oracle XML Developer&#39;s Kit (XDK) and Oracle XML&nbsp;DB. You can use it for XML data that is inside or outside the database.">Overview of the C API for XML</a></p>
</li>
<li>
<p><a href="xdb12oci.htm#GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B" title="Oracle XML&nbsp;DB provides support for storing and manipulating XML instances using abstract data type XMLType. These XML instances can be accessed and manipulated on the client side using the Oracle Call Interface (OCI) in conjunction with the C DOM API for XML.">Access to XMLType Data Stored in the Database Using OCI</a></p>
</li>
<li>
<p><a href="xdb12oci.htm#GUID-5E94BF15-CCE2-48BC-A692-6BEE4FC106A9" title="You can construct new XMLType instances on the client side using the C DOM API methods XMLCreateDocument() and XmlLoadDom().">Creating XMLType Instances on the Client</a></p>
</li>
<li>
<p><a href="xdb12oci.htm#GUID-10FA0209-10E6-49CC-B783-4340B221CB35" title="An XML context is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer&#39;s Kit applications and Oracle XML&nbsp;DB.">XML Context Parameter for C DOM API Functions</a></p>
</li>
<li>
<p><a href="xdb12oci.htm#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D" title="An example illustrates a C program that uses the C&nbsp;DOM API to construct an XML document and save it to Oracle Database.">Initializing and Terminating an XML Context</a></p>
</li>
<li>
<p><a href="xdb12oci.htm#GUID-556A53A1-7522-4786-AAB8-157326B7DFEA" title="You can use the C API for XML to read or write XML data that is encoded as binary XML from or to Oracle XML DB. Doing so involves the usual read and write procedures.">Using the C API for XML with Binary XML</a></p>
</li>
<li>
<p><a href="xdb12oci.htm#GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3" title="You can use the Oracle XML Developer&#39;s Kit pull parser with XMLType instances in Oracle XML&nbsp;DB. When you use this parser, parsing is done on demand, so your application drives the parsing process.">Using the Oracle XML Developer&#39;s Kit Pull Parser with Oracle XML&nbsp;DB</a></p>
</li>
<li>
<p><a href="xdb12oci.htm#GUID-687495C3-551B-4786-8A5F-F594985553E2" title="Common XML operations are provided by the C API for XML.">Common XMLType Operations in C</a></p>
</li>
</ul>
</div>
<a id="ADXDB4962"></a>
<div class="props_rev_3"><a id="GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659"></a>
<h2 id="ADXDB-GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659" class="sect2"><span class="enumeration_section">14.1</span> Overview of the C API for XML</h2>
<div>
<p>The C API for XML is a DOM API that is used for Oracle XML Developer&#39;s Kit (XDK) and Oracle XML&nbsp;DB. You can use it for XML data that is inside or outside the database.</p>
<p>DOM refers to compliance with the World Wide Web Consortium (W3C) DOM 2.0 Recommendation.</p>
<p>The C API for XML also includes performance-improving extensions that you can use in XDK for traditional storage of XML data, or in Oracle XML&nbsp;DB for storage as an <code>XMLType</code> column in a table.</p>
<div class="infobox-note" id="GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659__GUID-E7791695-608B-422C-A5B0-19D1A7FBD346">
<p class="notep1">Note:</p>
<p>C DOM functions from releases prior to Oracle Database&nbsp;10<span class="italic">g</span> Release 1 are supported only for backward compatibility.</p>
</div>
<p>The C API for XML is implemented on <code>XMLType</code> in Oracle XML&nbsp;DB. In the W3C DOM Recommendation, the term &#34;document&#34; is used in a broad sense (URI, file system, memory buffer, standard input and output). The C API for XML is a combined programming interface that includes all of the functionality needed by Oracle XML Developer&#39;s Kit and Oracle XML&nbsp;DB applications. It provides XSLT and XML Schema implementations. Although the DOM 2.0 Recommendation was followed closely, some naming changes were required for mapping from the objected-oriented DOM 2.0 Recommendation to the flat C namespace. For example, method <code>getName()</code> was renamed to <code>getAttrName()</code>.</p>
<p>The C API for XML supersedes older Oracle APIs. In particular, the <code>oraxml</code> interface (top-level, DOM, SAX, and XSLT) and <code>oraxsd.h</code> (Schema) interfaces will be deprecated in a future release.</p>
<p>The reference documentation for the C and C++ Application Programming Interfaces (APIs) that you can use to manipulate XML data is <a class="olink CAXML" target="_blank" href="../CAXML/toc.htm"><span class="italic">Oracle Database XML C API Reference</span></a>, and <a class="olink CPXML" target="_blank" href="../CPXML/toc.htm"><span class="italic">Oracle Database XML C++ API Reference</span></a>.</p>
<div class="infoboxnotealso" id="GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659__GUID-BD28138B-325E-4844-B502-5D74CE997DDB">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span> for information about PL/SQL APIs for XML</p>
</li>
<li>
<p><a class="olink JAXML" target="_blank" href="../JAXML/toc.htm"><span class="italic">Oracle Database XML Java API Reference</span></a> for information about Java APIs for XML</p>
</li>
</ul>
</div>
</div>
</div>
<a id="ADXDB4964"></a>
<div class="props_rev_3"><a id="GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B"></a>
<h2 id="ADXDB-GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B" class="sect2"><span class="enumeration_section">14.2</span> Access to XMLType Data Stored in the Database Using OCI</h2>
<div>
<p>Oracle XML&nbsp;DB provides support for storing and manipulating XML instances using abstract data type <code>XMLType</code>. These XML instances can be accessed and manipulated on the client side using the Oracle Call Interface (OCI) in conjunction with the C DOM API for XML.</p>
<p>You can bind and define <code>XMLType</code> values using the C DOM structure <code>xmldocnode</code>. This structure can be used for binding, defining and operating on XML values in OCI statements. You can use OCI statements to select XML data from the server, which you can then use with C DOM API functions. Similarly, values can be bound back to SQL statements directly.</p>
<p>The main flow for an application program involves initializing the usual OCI handles, such as server handle and statement handle, and then initializing an XML context parameter. You can then either operate on XML instances in the database or create new instances on the client side. The initialized XML context can be used with all of the C DOM functions.</p>
<div class="infoboxnotealso" id="GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B__GUID-11F291FC-E208-4091-86E5-24E67664B742">
<p class="notep1">See Also:</p>
<p><span class="q">&#34;<a href="xdb12oci.htm#GUID-10FA0209-10E6-49CC-B783-4340B221CB35" title="An XML context is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer&#39;s Kit applications and Oracle XML&nbsp;DB.">XML Context Parameter for C DOM API Functions</a>&#34;</span></p>
</div>
</div>
</div>
<a id="ADXDB4965"></a>
<div class="props_rev_3"><a id="GUID-5E94BF15-CCE2-48BC-A692-6BEE4FC106A9"></a>
<h2 id="ADXDB-GUID-5E94BF15-CCE2-48BC-A692-6BEE4FC106A9" class="sect2"><span class="enumeration_section">14.3</span> Creating XMLType Instances on the Client</h2>
<div>
<p>You can construct new <code>XMLType</code> instances on the client side using the C DOM API methods <code>XMLCreateDocument()</code> and <code>XmlLoadDom()</code>.</p>
<div class="section">
<p>You can construct empty <code>XMLType</code> instances using <code>XMLCreateDocument()</code>. This is similar to using <code>OCIObjectNew()</code> for other types.</p>
<p>You construct a non-empty <code>XMLType</code> instance using <code>XmlLoadDom()</code>, as follows:</p>
</div>
<!-- class="section" -->
<ol>
<li><span>Initialize the <code>xmlctx</code> as in <a href="xdb12oci.htm#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a>.</span></li>
<li><span>Construct the XML data from a user buffer, local file, or URI. The return value, a (<code>xmldocnode*</code>), can be used in the rest of the common C API.</span></li>
<li><span>If required, you can cast (<code>xmldocnode *</code>) to (<code>void*</code>) and provide it directly as the bind value.</span></li>
</ol>
</div>
</div>
<a id="ADXDB4966"></a>
<div class="props_rev_3"><a id="GUID-10FA0209-10E6-49CC-B783-4340B221CB35"></a>
<h2 id="ADXDB-GUID-10FA0209-10E6-49CC-B783-4340B221CB35" class="sect2"><span class="enumeration_section">14.4</span> XML Context Parameter for C DOM API Functions</h2>
<div>
<p>An <span class="italic">XML context</span> is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer&#39;s Kit applications and Oracle XML&nbsp;DB.</p>
<div class="section">
<p>For Oracle XML&nbsp;DB, OCI functions <code>OCIXmlDbInitXmlCtx()</code>and <code>OCIXmlDbFreeXmlCtx()</code>, respectively, initialize and terminate an XML context.</p>
</div>
<!-- class="section" --></div>
<a id="ADXDB4968"></a><a id="ADXDB4967"></a>
<div class="props_rev_3"><a id="GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30"></a>
<h3 id="ADXDB-GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30" class="sect3"><span class="enumeration_section">14.4.1</span> OCIXmlDbInitXmlCtx() Syntax</h3>
<div>
<p>OCI function <code>OCIXmlDbInitXmlCtx()</code>initializes an XML context.</p>
<div class="section">
<p>The syntax of <code>OCIXmlDbInitXmlCtx()</code> is as follows:</p>
<pre dir="ltr">xmlctx *OCIXmlDbInitXMlCtx (OCIEnv        *envhp,
                            OCISvcHp      *svchp,
                            OCIError      *errhp,
                            ocixmldbparam *params,
                            ub4           num_params);
</pre>
<p><a href="xdb12oci.htm#GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30__BGGHEDDH" title="This table describes the OCIXmlDBlInitXmlCtx parameters.">Table 14-1</a> describes the parameters.</p>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30__BGGHEDDH">
<p class="titleintable">Table 14-1 OCIXmlDbInitXMlCtx() Parameters</p>
<table class="cellalignment3420" title="OCIXmlDbInitXMlCtx() Parameters " summary="This table describes the OCIXmlDBlInitXmlCtx parameters.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3474" id="d78526e402">Parameter</th>
<th class="cellalignment3542" id="d78526e405">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3477" id="d78526e410" headers="d78526e402">
<p><code>envhp (IN)</code></p>
</td>
<td class="cellalignment3543" headers="d78526e410 d78526e405">
<p>The OCI environment handle.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3477" id="d78526e418" headers="d78526e402">
<p><code>svchp (IN)</code></p>
</td>
<td class="cellalignment3543" headers="d78526e418 d78526e405">
<p>The OCI service handle.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3477" id="d78526e426" headers="d78526e402">
<p><code>errhp (IN)</code></p>
</td>
<td class="cellalignment3543" headers="d78526e426 d78526e405">
<p>The OCI error handle.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3477" id="d78526e434" headers="d78526e402">
<p><code>params (IN)</code></p>
</td>
<td class="cellalignment3543" headers="d78526e434 d78526e405">
<p>An array of optional values:</p>
<ul style="list-style-type: disc;">
<li>
<p>OCI duration. Default value is <code>OCI_DURATION_SESSION</code>.</p>
</li>
<li>
<p>Error handler, which is a user-registered callback:</p>
<pre dir="ltr">void (*err_handler) (sword errcode, 
                     (CONST OraText *) errmsg);
</pre></li>
</ul>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3477" id="d78526e454" headers="d78526e402">
<p><code>num_params (IN)</code></p>
</td>
<td class="cellalignment3543" headers="d78526e454 d78526e405">
<p>Number of parameters to be read from <code>params</code>.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="ADXDB4969"></a>
<div class="props_rev_3"><a id="GUID-22790786-C29D-4D86-8108-46586E41CF1C"></a>
<h3 id="ADXDB-GUID-22790786-C29D-4D86-8108-46586E41CF1C" class="sect3"><span class="enumeration_section">14.4.2</span> OCIXmlDbFreeXmlCtx() Syntax</h3>
<div>
<p>OCI function <code>OCIXmlDbFreeXmlCtx()</code>terminates an XML context.</p>
<div class="section">
<p>The syntax of <code>OCIXmlDbFreeXmlCtx()</code> is as follows, where parameter <code>xctx (IN)</code> is the XML context to terminate.:</p>
<pre dir="ltr">void OCIXmlDbFreeXmlCtx (xmlctx *xctx);
</pre></div>
<!-- class="section" --></div>
</div>
</div>
<a id="ADXDB4971"></a><a id="ADXDB4970"></a>
<div class="props_rev_3"><a id="GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D"></a>
<h2 id="ADXDB-GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D" class="sect2"><span class="enumeration_section">14.5</span> Initializing and Terminating an XML Context</h2>
<div>
<p>An example illustrates a C program that uses the C&nbsp;DOM API to construct an XML document and save it to Oracle Database.</p>
<div class="section">
<p><a href="xdb12oci.htm#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a> shows this. The document constructed is stored in table <code>my_table</code>. OCI functions <code>OCIXmlDbInitXmlCtx()</code> and <code>OCIXmlDbFreeXmlCtx()</code> are used to initialize and terminate the XML context, respectively. These functions are defined in header file <code>ocixmldb.h</code>.</p>
<p>The code uses helper functions <code>exec_bind_xml</code>, <code>init_oci_handles</code>, and <code>free_oci_handles</code>, which are not listed here. The complete listing of this example, including the helper functions, can be found in <a href="apphxdb.htm#GUID-8FCAD86A-3BF9-4B20-A9EE-8FC46C95C3CE" title="Full listings are provided here for the Oracle XML&nbsp;DB-supplied XML schemas, purchase-order XML schemas and an XSLT stylesheet used in various examples, and C-language (OCI) examples for loading XML content into Oracle XML&nbsp;DB and initializing and terminating an XML context.">Oracle-Supplied XML Schemas and Examples</a>, <span class="q">&#34;<a href="apphxdb.htm#GUID-8CA90A5B-999C-49B6-A2FD-41427C332F17" title="An example shows how to use OCI functions OCIXmlDbInitXmlCtx() and OCIXmlDbFreeXmlCtx() to initialize and terminate an XML context. It constructs an XML document using the C&nbsp;DOM API and saves it to the database.">Initializing and Terminating an XML Context (OCI)</a>&#34;</span>.</p>
<p>The C code in <a href="xdb12oci.htm#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a> assumes that the following SQL code has first been executed to create table <code>my_table</code> in database schema <code>capiuser</code>:</p>
<pre dir="ltr">CONNECT CAPIUSER
Enter password: <span class="italic">password</span>

Connected.

CREATE TABLE my_table OF XMLType;
</pre>
<p><a href="xdb12oci.htm#GUID-687495C3-551B-4786-8A5F-F594985553E2__CHDBIHJI">Example 14-4</a> queries table <code>my_table</code> to show the data that was inserted by <a href="xdb12oci.htm#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a>.</p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">
<p class="titleinexample">Example 14-1 Using OCIXMLDBINITXMLCTX() and OCIXMLDBFREEXMLCTX()</p>
<pre dir="ltr">#ifndef S_ORACLE
#endif
#ifndef ORATYPES_ORACLE
#include &lt;oratypes.h&gt;
#endif
#ifndef XML_ORACLE
#include &lt;xml.h&gt;
#endif
#ifndef OCIXML_ORACLE
#include &lt;ocixml.h&gt;
#endif
#ifndef OCI_ORACLE
#include &lt;oci.h&gt;
#endif
#include &lt;string.h&gt;
 
typedef struct test_ctx {
        OCIEnv *envhp;
        OCIError *errhp;
        OCISvcCtx *svchp;
        OCIStmt *stmthp;
        OCIServer *srvhp;
        OCIDuration dur;
        OCISession *sesshp;
        oratext *username;
        oratext *password;
} test_ctx;
 
/* Helper function 1: execute a sql statement which binds xml data */
static sword <span class="bold">exec_bind_xml</span>(OCISvcCtx *svchp,
                           OCIError *errhp,
                           OCIStmt *stmthp,
                           void *xml,
                           OCIType *xmltdo,
                           OraText *sqlstmt);
 
/* Helper function 2: Initialize OCI handles and connect */
static sword <span class="bold">init_oci_handles</span>(test_ctx *ctx);
 
/* Helper function 3: Free OCI handles and disconnect */
static <span class="bold">sword free_oci_handles</span>(test_ctx *ctx);
 
void <span class="bold">main</span>()
{
  test_ctx temp_ctx;
  test_ctx *ctx = &amp;temp_ctx;
  OCIType *xmltdo = (OCIType *) 0;
  xmldocnode *doc = (xmldocnode *)0;
  ocixmldbparam params[1];
  xmlnode *quux, *foo, *foo_data, *top;
  xmlerr err;
  sword status = 0;
  xmlctx *xctx;
 
  oratext ins_stmt[] = &#34;insert into my_table values (:1)&#34;; 
  oratext tlpxml_test_sch[] = &#34;<span class="bold">&lt;TOP/&gt;</span>&#34;;
  ctx-&gt;username = (oratext *)&#34;capiuser&#34;;
  ctx-&gt;password = (oratext *)&#34;***********&#34;; /* Replace with real password */
 
  /* Initialize envhp, svchp, errhp, dur, stmthp */
  init_oci_handles(ctx);
 
  /* Get an xml context */
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;ctx-&gt;dur;
  xctx = <span class="bold">OCIXmlDbInitXmlCtx</span>(ctx-&gt;envhp, ctx-&gt;svchp, ctx-&gt;errhp, params, 1);
 
  /* Start processing - first, check that this DOM supports XML 1.0 */
  printf(&#34;\n\nSupports XML 1.0? : %s\n&#34;,
         <span class="bold">XmlHasFeature</span>(xctx, (oratext *) &#34;xml&#34;, (oratext *) &#34;1.0&#34;) ?
         &#34;YES&#34; : &#34;NO&#34;);
 
  /* Parse a document */
  if (!(doc = <span class="bold">XmlLoadDom</span>(xctx, &amp;err, &#34;buffer&#34;, tlpxml_test_sch,
                         &#34;buffer_length&#34;, sizeof(tlpxml_test_sch)-1,
                         &#34;validate&#34;, TRUE, NULL)))
  {
    printf(&#34;Parse failed, code %d\n&#34;, err);
  }
  else
  {
    /* Get the document element */
    top = (xmlnode *)<span class="bold">XmlDomGetDocElem</span>(xctx, doc);
 
    /* Print out the top element */
    printf(&#34;\n\nOriginal top element is :\n&#34;);   
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, top, &#34;stdio&#34;, stdout, NULL);
 
    /* Print out the document-note that the changes are reflected here */
    printf(&#34;\n\nOriginal document is :\n&#34;);
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, (xmlnode *)doc, &#34;stdio&#34;, stdout, NULL);
 
    /* Create some elements and add them to the document */
    quux = (xmlnode *) <span class="bold">XmlDomCreateElem</span>(xctx ,doc, (oratext *) &#34;<span class="bold">QUUX</span>&#34;);
    foo = (xmlnode *) <span class="bold">XmlDomCreateElem</span>(xctx, doc, (oratext *) &#34;<span class="bold">FOO</span>&#34;);
    foo_data = (xmlnode *) <span class="bold">XmlDomCreateText</span>(xctx, doc, (oratext *) &#34;<span class="bold">data</span>&#34;);
    foo_data = <span class="bold">XmlDomAppendChild</span>(xctx, (xmlnode *) foo, (xmlnode *) foo_data);
    foo = <span class="bold">XmlDomAppendChild</span>(xctx, quux, foo);
    quux = <span class="bold">XmlDomAppendChild</span>(xctx, top, quux);
 
    /* Print out the top element */
    printf(&#34;\n\nNow the top element is :\n&#34;);   
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, top, &#34;stdio&#34;, stdout, NULL);
 
    /* Print out the document. Note that the changes are reflected here */
    printf(&#34;\n\nNow the document is :\n&#34;);
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, (xmlnode *)doc, &#34;stdio&#34;, stdout, NULL);
 
    /* Insert the document into my_table */
    status = OCITypeByName(ctx-&gt;envhp, ctx-&gt;errhp, ctx-&gt;svchp, 
                           (const text *) &#34;SYS&#34;, (ub4) strlen((char *)&#34;SYS&#34;), 
                           (const text *) &#34;XMLTYPE&#34;,
                           (ub4) strlen((char *)&#34;XMLTYPE&#34;), (CONST text *) 0,
                           (ub4) 0, OCI_DURATION_SESSION, OCI_TYPEGET_HEADER,
                           (OCIType **) &amp;xmltdo);
    if (status == OCI_SUCCESS)
    {
      exec_bind_xml(ctx-&gt;svchp, ctx-&gt;errhp, ctx-&gt;stmthp, (void *)doc, xmltdo, 
                    ins_stmt);
    }
  }
  /* Free xml ctx */
  <span class="bold">OCIXmlDbFreeXmlCtx</span>(xctx);
 
  /* Free envhp, svchp, errhp, stmthp */
  free_oci_handles(ctx);
}
</pre>
<p>The output from compiling and running this C program is as follows:</p>
<pre dir="ltr">Supports XML 1.0? : YES
 
Original top element is :
&lt;TOP/&gt;
 
Original document is :
&lt;TOP/&gt;
 
Now the top element is :
&lt;TOP&gt;
  &lt;QUUX&gt;
    &lt;FOO&gt;data&lt;/FOO&gt;
  &lt;/QUUX&gt;
&lt;/TOP&gt;
 
Now the document is :
&lt;TOP&gt;
  &lt;QUUX&gt;
    &lt;FOO&gt;data&lt;/FOO&gt;
  &lt;/QUUX&gt;
&lt;/TOP&gt;
</pre>
<p>This is the result of querying the constructed document in <code>my_table</code>:</p>
<pre dir="ltr">SELECT * FROM my_table;

SYS_NC_ROWINFO$
---------------
&lt;TOP&gt; 
  &lt;QUUX&gt; 
    &lt;FOO&gt;data&lt;/FOO&gt; 
  &lt;/QUUX&gt; 
&lt;/TOP&gt; 
 
1 row selected.
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB4977"></a><a id="ADXDB4976"></a>
<div class="props_rev_3"><a id="GUID-556A53A1-7522-4786-AAB8-157326B7DFEA"></a>
<h2 id="ADXDB-GUID-556A53A1-7522-4786-AAB8-157326B7DFEA" class="sect2"><span class="enumeration_section">14.6</span> Using the C API for XML with Binary XML</h2>
<div>
<p>You can use the C API for XML to read or write XML data that is encoded as binary XML from or to Oracle XML DB. Doing so involves the usual read and write procedures.</p>
<div class="section">
<p>Binary XML is a compact, XML Schema-aware encoding of XML data. You can use binary XML as a storage model for <code>XMLType</code> data in the database, but you can also use it for XML data located outside the database.</p>
<p>Binary XML data is XML Schema-aware, and it can use various encoding schemes, depending on your needs. In order to manipulate binary XML data, you must have both the data and this metadata about the relevant XML schemas and encodings.</p>
<p>For <code>XMLType</code> data stored in the database, this metadata is also stored in the database. However, depending on how your database and data are set up, the metadata might not be on the same server as the data it applies to. If this is the case, then, before you can read or write binary XML data from or to the database, you must carry out these steps:</p>
<ol>
<li>
<p>Create a context instance for the metadata.</p>
</li>
<li>
<p>Associate this context with a data connection that you use to access binary XML data in the database. A data connection can be a dedicated connection (<code>OCISvcCtx</code>) or a connection pool (<code>OCICPool</code>).</p>
</li>
</ol>
<p>Then, when your application needs to encode or decode binary XML data on the data connection, it automatically fetches the metadata needed for that. As is illustrated by <a href="xdb12oci.htm#GUID-556A53A1-7522-4786-AAB8-157326B7DFEA__CHDEHEHF">Example 14-2</a>, the overall sequence of actions is as follows:</p>
<ol>
<li>
<p>Create the usual OCI handles for environment (<code>OCIEnv</code>), connection (<code>OCISvcCtx</code>), and error context (<code>OCIError</code>).</p>
</li>
<li>
<p>Create one or more metadata contexts, as needed. A metadata context is sometimes referred to as a metadata repository, and <code>OCIBinXMLReposCtx</code> is the OCI context data structure. You use <code>OCIBinXMLCreateReposCtxFromConn</code> to create a metadata context from a dedicated connection and <code>OCIBinXMLCreateReposCtxFromCPool</code> to create a context from a connection pool.</p>
</li>
<li>
<p>Associate the metadata context(s) with the binary XML data connection(s). You use <code>OCIBinXmlSetReposCtxForConn</code> to do this.</p>
</li>
<li>
<p>(Optional) If the XML data originated outside of the database, use <code>setPicklePreference</code> to specify that XML data to be sent to the database from now on is in binary XML format. This applies to a DOM document (<code>xmldomdoc</code>). If you do not specify binary XML, the data is stored as text (<code>CLOB</code>).</p>
</li>
<li>
<p>Use OCI libraries to read and write XML data from and to the database. Whenever it is needed for encoding or decoding binary XML documents, the necessary metadata is fetched automatically using the metadata context. Use the C DOM API for XML to operate on the XML data at the client level.</p>
</li>
</ol>
<div class="infoboxnotealso" id="GUID-556A53A1-7522-4786-AAB8-157326B7DFEA__GUID-485AD655-204D-4965-8517-F4D163801F48">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="xdb01int.htm#GUID-B8507F44-B010-4384-94E6-101131DD7D88" title="XMLType is an abstract data type that provides different storage models to best fit your data and your use of it. As an abstract data type, your applications and database queries gain in flexibility: the same interface is available for all XMLType operations.">XMLType Storage Models</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ADXDK1810" target="_blank" href="../ADXDK/adx_c_xmlbin.htm#ADXDK1810"><span class="italic">Oracle XML Developer&#39;s Kit Programmer&#39;s Guide</span></a></p>
</li>
</ul>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-556A53A1-7522-4786-AAB8-157326B7DFEA__CHDEHEHF">
<p class="titleinexample">Example 14-2 Using the C API for XML with Binary XML</p>
<pre dir="ltr"><span class="bold">. . .</span>
/* Private types and constants */
#define SCHEMA        (OraText *)&#34;SYS&#34;
#define TYPE          (OraText *)&#34;XMLTYPE&#34;
#define USER          (OraText *)&#34;oe&#34;
#define USER_LEN      (ub2)(strlen((char *)USER))
#define PWD           (OraText *)&#34;oe&#34;
#define PWD_LEN       (ub2)(strlen((char *)PWD))
#define NUM_PARAMS    1
static void checkerr(OCIError *errhp, sword status);
static sword create_env(OraText *user, ub2 user_len, OraText *pwd, ub2 pwd_len,
                        OCIEnv **envhp, OCISvcCtx **svchp, OCIError **errhp);
static sword run_example(OCIEnv *envhp, OCISvcCtx *svchp, OCIError *errhp,
                         OCIDuration dur);
static void cleanup(OCIEnv *envhp, OCISvcCtx *svchp, OCIError *errhp);
 
int <span class="bold">main</span> (int argc, char *argv[])
{
  OCIEnv     *envhp;
  <span class="bold">OCISvcCtx</span>  *svchp;
  OCIError   *errhp;
  printf(&#34;*** Starting Binary XML Example program\n&#34;);
  if (create_env(USER, USER_LEN, PWD, PWD_LEN, &amp;envhp, &amp;svchp, &amp;errhp))
    {
      printf(&#34;FAILED: create_env()\n&#34;);
      cleanup(envhp, svchp, errhp);
      return OCI_ERROR;
    }
  if (run_example(envhp, svchp, errhp, OCI_DURATION_SESSION))
    {
      printf(&#34;FAILED: run_example()\n&#34;);
      cleanup(envhp, svchp, errhp);
      return OCI_ERROR;
    }
  cleanup(envhp, svchp, errhp);
  printf (&#34;*** Completed Binary XML example\n&#34;);
  return OCI_SUCCESS;
}
 
static sword <span class="bold">create_env</span>(OraText *user, ub2 user_len,
                        OraText *pwd,  ub2 pwd_len,
                        OCIEnv **envhp, OCISvcCtx **svchp, OCIError **errhp)
{
  sword       status;
  OCIServer  *srvhp;
  OCISession *usrp;
  OCICPool   *poolhp;
  OraText    *poolname;
  ub4         poolnamelen;
  OraText    *database =(OraText *)&#34;&#34;;
  <span class="bold">OCIBinXmlReposCtx</span> *rctx;
  /* Create and initialize environment. Allocate error handle. */
  <span class="bold">. . .</span>
  if ((status = OCIConnectionPoolCreate((dvoid *)*envhp, (dvoid*)*errhp,
                                        (dvoid *)poolhp, &amp;poolname,
                                        (sb4 *)&amp;poolnamelen, 
                                        (OraText *)0, 
                                        (sb4) 0, 1, 10, 1, 
                                        (OraText *)USER, 
                                        (sb4) USER_LEN, 
                                        (OraText *)PWD, 
                                        (sb4) PWD_LEN,
                                        OCI_DEFAULT)) != OCI_SUCCESS)
    {
      printf (&#34;OCIConnectionPoolCreate - Fail %d\n&#34;, status);
      return OCI_ERROR;
    }
  status = OCILogon2((OCIEnv *)*envhp, *errhp, svchp, (OraText *)USER,
                     (ub4)USER_LEN, (const oratext *)PWD, (ub4)PWD_LEN,
                     (const oratext *)poolname, poolnamelen, OCI_CPOOL);
  if (status)
    {
      printf (&#34;OCILogon2 - Fail %d\n&#34;, status);
      return OCI_ERROR;
    }
  <span class="bold">OCIBinXmlCreateReposCtxFromCPool</span>(*envhp, poolhp, *errhp, &amp;rctx);
  <span class="bold">OCIBinXmlSetReposCtxForConn</span>(*svchp, rctx);
  return OCI_SUCCESS;
}
 
static sword <span class="bold">run_example</span>(OCIEnv *envhp, OCISvcCtx *svchp, OCIError *errhp,
                         OCIDuration dur)
{
  OCIType   *xmltdo = (OCIType *)0;
  OCIStmt   *stmthp;
  OCIDefine *defnp;
  xmldocnode *xmldoc = (xmldocnode *)0;
  ub4        xmlsize = 0;
  text      *selstmt = (text *)&#34;SELECT doc FROM po_binxmltab&#34;;
  sword      status;
  struct xmlctx *xctx = (xmlctx *) 0;
  ocixmldbparam params[NUM_PARAMS];
  xmlerr xerr = (xmlerr) 0;
  /* Obtain type definition for XMLType. Allocate statement handle.
     Prepare SELECT statement. Define variable for XMLType. Execute statement. */
  <span class="bold">. . .</span>
  /* Construct xmlctx for using XML C API */
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;dur;
  xctx = OCIXmlDbInitXmlCtx(envhp, svchp, errhp, params, NUM_PARAMS);
  /* Print result to local string */
  XmlSaveDom(xctx, &amp;xerr, (xmlnode *)xmldoc, &#34;stdio&#34;, stdout, NULL);
  /* Free instances */
  <span class="bold">. . .</span>
}
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB4979"></a><a id="ADXDB4978"></a>
<div class="props_rev_3"><a id="GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3"></a>
<h2 id="ADXDB-GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3" class="sect2"><span class="enumeration_section">14.7</span> Using the Oracle XML Developer&#39;s Kit Pull Parser with Oracle XML&nbsp;DB</h2>
<div>
<p>You can use the Oracle XML Developer&#39;s Kit pull parser with <code>XMLType</code> instances in Oracle XML&nbsp;DB. When you use this parser, parsing is done on demand, so your application drives the parsing process.</p>
<div class="section">
<p>Your application accesses an XML document through a sequence of events, with start tags, end tags, and comments, just as in Simple API for XML (SAX) parsing. However, unlike the case of SAX parsing, where parsing events are handled by callbacks, in pull parsing your application calls methods to ask for (pull) events only when it needs them. This gives the application more control over XML processing. In particular, filtering is more flexible with the pull parser than with the SAX parser.</p>
<p>You can also use the Oracle XML Developer&#39;s Kit pull parser to perform stream-based XML Schema validation.</p>
<p><a href="xdb12oci.htm#GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3__CHDIFDBE">Example 14-3</a> shows how to use the Oracle XML&nbsp;DB pull parser with an <code>XMLType</code> instance. To use the pull parser, you also need static library <code>libxml10.a</code> on UNIX and Linux systems or <code>oraxml10.dll</code> on Microsoft Windows systems. You also need header file <code>xmlev.h</code>.</p>
<div class="infoboxnotealso" id="GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3__GUID-D9D74E5C-F57E-4528-9592-2731705A0CAB">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink ADXDK1410" target="_blank" href="../ADXDK/adx_c_parser.htm#ADXDK1410"><span class="italic">Oracle XML Developer&#39;s Kit Programmer&#39;s Guide</span></a> for information about the Oracle XML Developer&#39;s Kit pull parser</p>
</li>
<li>
<p><a class="olink ADXDK1600" target="_blank" href="../ADXDK/adx_c_sproc.htm#ADXDK1600"><span class="italic">Oracle XML Developer&#39;s Kit Programmer&#39;s Guide</span></a> for information on using the pull parser for stream-based validation</p>
</li>
</ul>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3__CHDIFDBE">
<p class="titleinexample">Example 14-3 Using the Oracle XML&nbsp;DB Pull Parser</p>
<pre dir="ltr">#define MAXBUFLEN 64*1024
void main()
{
  test_ctx temp_ctx;
  test_ctx *ctx = &amp;temp_ctx;
  OCIType *xmltdo = (OCIType *) 0;
  ocixmldbparam params[1];
  sword status = 0;
  xmlctx *xctx;
  OCIDefine *defnp = (OCIDefine *) 0;
  oratext sel_stmt[] =
    &#34;<span class="bold">SELECT XMLSerialize(DOCUMENT x.OBJECT_VALUE AS CLOB) FROM PURCHASEORDER x where rownum = 1</span>&#34;;
  OCILobLocator *cob;
  ub4 amtp, nbytes;
  ub1 bufp[MAXBUFLEN];
  ctx-&gt;username = (oratext *)&#34;oe&#34;;
  ctx-&gt;password = (oratext *)&#34;*************&#34;;    /* Replace with real password */
 
  <span class="bold">/* Initialize envhp, svchp, errhp, dur, stmthp */</span>
  init_oci_handles(ctx);
 
  <span class="bold">/* Get an xml context */</span>
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;ctx-&gt;dur;
  xctx = OCIXmlDbInitXmlCtx(ctx-&gt;envhp, ctx-&gt;svchp, ctx-&gt;errhp, params, 1);
 
  <span class="bold">/* Start processing */</span>
  printf(&#34;\n\n<span class="bold">Supports XML 1.0? :</span> %s\n&#34;,
         XmlHasFeature(xctx, (oratext *) &#34;xml&#34;, (oratext *) &#34;1.0&#34;) ?
         &#34;YES&#34; : &#34;NO&#34;);
 
  <span class="bold">/* Allocate the lob descriptor */</span>
  status = OCIDescriptorAlloc((dvoid *) ctx-&gt;envhp, (dvoid **) &amp;clob,
                       (ub4)OCI_DTYPE_LOB, (size_t) 0, (dvoid **) 0);
  if (status)
  {
    printf(&#34;OCIDescriptorAlloc Failed\n&#34;);
    goto error;
  }
  status = OCIStmtPrepare(ctx-&gt;stmthp, ctx-&gt;errhp,
                 (CONST OraText *)sel_stmt, (ub4) strlen((char *)sel_stmt),
                 (ub4) OCI_NTV_SYNTAX, (ub4) OCI_DEFAULT);
  if (status)
  {
    printf(&#34;OCIStmtPrepare Failed\n&#34;);
    goto error;
  }
  status = OCIDefineByPos(ctx-&gt;stmthp, &amp;defnp, ctx-&gt;errhp, (ub4) 1,
                 (dvoid *) &amp;clob, (sb4) -1, (ub2 ) SQLT_CLOB,
                 (dvoid *) 0, (ub2 *)0,
                 (ub2 *)0, (ub4) OCI_DEFAULT);
  if (status)
  {
    printf(&#34;OCIDefineByPos Failed\n&#34;);
    goto error;
  }
  status = OCIStmtExecute(ctx-&gt;svchp, ctx-&gt;stmthp, ctx-&gt;errhp, (ub4) 1,
                          (ub4) 0, (CONST OCISnapshot*) 0, (OCISnapshot*) 0,
                          (ub4) OCI_DEFAULT);
  if (status)
  {
    printf(&#34;OCIStmtExecute Failed\n&#34;);
    goto error;
  }
  /* read the fetched value into a buffer */
  amtp = nbytes = MAXBUFLEN-1;
  status = OCILobRead(ctx-&gt;svchp, ctx-&gt;errhp, clob, &amp;amtp,
                (ub4) 1, (dvoid *) bufp, (ub4) nbytes, (dvoid *)0,
                (sb4 (*)(dvoid *, CONST dvoid *, ub4, ub1)) 0,
                (ub2) 0, (ub1) SQLCS_IMPLICIT);
  if (status)
  {
    printf(&#34;OCILobRead Failed\n&#34;);
    goto error;
  }
  bufp[amtp] = &#39;\0&#39;;
  if (amtp &gt; 0)
  {
     printf(&#34;\n<span class="bold">=&gt; Query result</span> of %s: \n%s\n&#34;, sel_stmt, bufp);
     <span class="bold">/********** PULL PARSING ******************/</span>
     status = pp_parse(xctx, bufp, amtp);
     if (status)
       printf(&#34;Pull Parsing failed\n&#34;);
  }
error: 
  <span class="bold">/* Free XML Ctx */</span>
  OCIXmlDbFreeXmlCtx(xctx);
 
  <span class="bold">/* Free envhp, svchp, errhp, stmthp */</span>
  free_oci_handles(ctx);
}
#define ERRBUFLEN 256
sb4 pp_parse(xctx, buf, amt)
xmlctx  *xctx;
oratext *buf;
ub4     amt;
{
  xmlevctx *evctx;
  xmlerr   xerr = XMLERR_OK;
  oratext  message[ERRBUFLEN];
  oratext  *emsg = message;
  xmlerr   ecode;
  boolean  done, inattr = FALSE;
  xmlevtype event;
 
  <span class="bold">/* Create an XML event context - Pull Parser Context */</span>
  evctx = XmlEvCreatePPCtx(xctx, &amp;xerr,
                           &#34;expand_entities&#34;, FALSE,
                           &#34;validate&#34;, TRUE,
                           &#34;attr_events&#34;, TRUE,
                           &#34;raw_buffer_len&#34;, 1024,
                           NULL);
 if (!evctx)
  {
    printf(&#34;FAILED: XmlEvCreatePPCtx: %d\n&#34;, xerr);
    return OCI_ERROR;
  }
  <span class="bold">/* Load the document from input buffer */</span>
  xerr = XmlEvLoadPPDoc(xctx, evctx, &#34;buffer&#34;, buf, amt, &#34;utf-8&#34;);
  if (xerr)
  {
    printf(&#34;FAILED: XmlEvLoadPPDoc: %d\n&#34;, xerr);
    return OCI_ERROR;
  }
 <span class="bold"> /* Process the events until END_DOCUMENT event or error */</span>
  done = FALSE;
  while(!done)
  {
    event = XmlEvNext(evctx);
    switch(event)
    {
      case XML_EVENT_START_ELEMENT:
        printf(&#34;<span class="bold">START ELEMENT:</span> %s\n&#34;, XmlEvGetName0(evctx));
        break;
      case XML_EVENT_END_ELEMENT:
        printf(&#34;<span class="bold">END ELEMENT:</span> %s\n&#34;, XmlEvGetName0(evctx));
        break;
      case XML_EVENT_START_DOCUMENT:
        printf(&#34;<span class="bold">START DOCUMENT</span>\n&#34;);
        break;
      case XML_EVENT_END_DOCUMENT:
        printf(&#34;<span class="bold">END DOCUMENT</span>\n&#34;);
        done = TRUE;
        break;
      case XML_EVENT_START_ATTR:
        printf(&#34;<span class="bold">START ATTRIBUTE:</span> %s\n&#34;, XmlEvGetAttrName0(evctx, 0));
        inattr = TRUE;
        break;
      case XML_EVENT_END_ATTR:
        printf(&#34;<span class="bold">END ATTRIBUTE:</span> %s\n&#34;, XmlEvGetAttrName0(evctx, 0));
        inattr = FALSE;
        break;
      case XML_EVENT_CHARACTERS:
        if (inattr)
          printf(&#34;<span class="bold">ATTR VALUE:</span> %s\n&#34;, XmlEvGetText0(evctx));
        else
          printf(&#34;<span class="bold">TEXT:</span> %s\n&#34;, XmlEvGetText0(evctx));
        break;
      case XML_EVENT_ERROR:
      case XML_EVENT_FATAL_ERROR:
        done = TRUE;
        ecode = XmlEvGetError(evctx, &amp;emsg);
        printf(&#34;ERROR: %d: %s\n&#34;, ecode, emsg);
        break;
    }
  }
  <span class="bold">/* Destroy the event context */</span>
  XmlEvDestroyPPCtx(xctx, evctx);
  return OCI_SUCCESS;
}
</pre>
<p>The output from compiling and running this C program is as follows:</p>
<pre dir="ltr"><span class="bold">=&gt; Query result</span> of XMLSerialize(DOCUMENT x.OBJECT_VALUE AS CLOB) FROM PURCHASEORDER x where rownum = 1: 
</pre>
<pre dir="ltr">&lt;PurchaseOrder xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
               xsi:noNamespaceSchemaLocation=
                 &#34;http://localhost:8080/source/schemas/poSource/xsd/purchaseOrder.xsd&#34;&gt;
  &lt;Reference&gt;AMCEWEN-20021009123336171PDT&lt;/Reference&gt;
  &lt;Actions&gt;
    &lt;Action&gt;
      &lt;User&gt;KPARTNER&lt;/User&gt;
    &lt;/Action&gt;
  &lt;/Actions&gt;
  &lt;Reject/&gt;
  &lt;Requestor&gt;Allan D. McEwen&lt;/Requestor&gt;
  &lt;User&gt;AMCEWEN&lt;/User&gt;
  &lt;CostCenter&gt;S30&lt;/CostCenter&gt;
  &lt;ShippingInstructions&gt;
    &lt;name&gt;Allan D. McEwen&lt;/name&gt;
    &lt;address&gt;Oracle Plaza
Twin Dolphin Drive
Redwood Shores
CA
94065
USA&lt;/address&gt;
    &lt;telephone&gt;650 506 7700&lt;/telephone&gt;
  &lt;/ShippingInstructions&gt;
  &lt;SpecialInstructions&gt;Ground&lt;/SpecialInstructions&gt;
  &lt;LineItems&gt;
    &lt;LineItem ItemNumber=&#34;1&#34;&gt;
      &lt;Description&gt;Salesman&lt;/Description&gt;
      &lt;Part Id=&#34;37429158920&#34; UnitPrice=&#34;39.95&#34; Quantity=&#34;2&#34;/&gt;
    &lt;/LineItem&gt;
    <span class="bold">. . .</span>
  &lt;/LineItems&gt;
&lt;/PurchaseOrder&gt;
 
START DOCUMENT
START ELEMENT: PurchaseOrder
START ATTRIBUTE: xmlns:xsi
ATTR VALUE: http://www.w3.org/2001/XMLSchema-instance
END ATTRIBUTE: xmlns:xsi
START ATTRIBUTE: xsi:noNamespaceSchemaLocation
ATTR VALUE: http://localhost:8080/source/schemas/poSource/xsd/purchaseOrder.xsd
END ATTRIBUTE: xsi:noNamespaceSchemaLocation
START ELEMENT: Reference
TEXT: AMCEWEN-20021009123336171PDT
END ELEMENT: Reference
START ELEMENT: Actions
START ELEMENT: Action
START ELEMENT: User
TEXT: KPARTNER
END ELEMENT: User
END ELEMENT: Action
END ELEMENT: Actions
START ELEMENT: Reject
END ELEMENT: Reject
START ELEMENT: Requestor
TEXT: Allan D. McEwen
END ELEMENT: Requestor
START ELEMENT: User
TEXT: AMCEWEN
END ELEMENT: User
START ELEMENT: CostCenter
TEXT: S30
END ELEMENT: CostCenter
START ELEMENT: ShippingInstructions
START ELEMENT: name
TEXT: Allan D. McEwen
END ELEMENT: name
START ELEMENT: address
TEXT: Oracle Plaza
Twin Dolphin Drive
Redwood Shores
CA
94065
USA
END ELEMENT: address
START ELEMENT: telephone
TEXT: 650 506 7700
END ELEMENT: telephone
END ELEMENT: ShippingInstructions
START ELEMENT: SpecialInstructions
TEXT: Ground
END ELEMENT: SpecialInstructions
START ELEMENT: LineItems
START ELEMENT: LineItem
START ATTRIBUTE: ItemNumber
ATTR VALUE: 1
END ATTRIBUTE: ItemNumber
START ELEMENT: Description
TEXT: Salesman
END ELEMENT: Description
START ELEMENT: Part
START ATTRIBUTE: Id
ATTR VALUE: 37429158920
END ATTRIBUTE: Id
START ATTRIBUTE: UnitPrice
ATTR VALUE: 39.95
END ATTRIBUTE: UnitPrice
START ATTRIBUTE: Quantity
ATTR VALUE: 2
END ATTRIBUTE: Quantity
END ELEMENT: Part
END ELEMENT: LineItem
<span class="bold">. . .</span>
END ELEMENT: LineItems
END ELEMENT: PurchaseOrder
END DOCUMENT
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB4981"></a><a id="ADXDB4982"></a><a id="ADXDB4980"></a>
<div class="props_rev_3"><a id="GUID-687495C3-551B-4786-8A5F-F594985553E2"></a>
<h2 id="ADXDB-GUID-687495C3-551B-4786-8A5F-F594985553E2" class="sect2"><span class="enumeration_section">14.8</span> Common XMLType Operations in C</h2>
<div>
<p>Common XML operations are provided by the C API for XML.</p>
<p><a href="xdb12oci.htm#GUID-687495C3-551B-4786-8A5F-F594985553E2__BABGGACF" title="This table describes the C API for XML&rsquo;s XMLType functions.">Table 14-2</a> provides the <code>XMLType</code> functional equivalent of common XML operations.</p>
<div class="tblformal" id="GUID-687495C3-551B-4786-8A5F-F594985553E2__BABGGACF">
<p class="titleintable">Table 14-2 Common XMLType Operations in C</p>
<table class="cellalignment3420" title="Common XMLType Operations in C " summary="This table describes the C API for XML&rsquo;s XMLType functions.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3500" id="d78526e1043">Description</th>
<th class="cellalignment3497" id="d78526e1046">C API XMLType Function</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1051" headers="d78526e1043">
<p>Create empty <code>XMLType</code> instance</p>
</td>
<td class="cellalignment3499" headers="d78526e1051 d78526e1046">
<p><code>XmlCreateDocument()</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1062" headers="d78526e1043">
<p>Create from a source buffer</p>
</td>
<td class="cellalignment3499" headers="d78526e1062 d78526e1046">
<p><code>XmlLoadDom()</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1070" headers="d78526e1043">
<p>Extract an XPath expression</p>
</td>
<td class="cellalignment3499" headers="d78526e1070 d78526e1046">
<p><code>XmlXPathEvalexpr()</code> and family</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1079" headers="d78526e1043">
<p>Transform using an XSLT stylesheet</p>
</td>
<td class="cellalignment3499" headers="d78526e1079 d78526e1046">
<p><code>XmlXslProcess()</code> and family</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1088" headers="d78526e1043">
<p>Check if an XPath exists</p>
</td>
<td class="cellalignment3499" headers="d78526e1088 d78526e1046">
<p><code>XmlXPathEvalexpr()</code> and family</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1097" headers="d78526e1043">
<p>Is document schema-based?</p>
</td>
<td class="cellalignment3499" headers="d78526e1097 d78526e1046">
<p><code>XmlDomIsSchemaBased()</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1105" headers="d78526e1043">
<p>Get schema information</p>
</td>
<td class="cellalignment3499" headers="d78526e1105 d78526e1046">
<p><code>XmlDomGetSchema()</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1113" headers="d78526e1043">
<p>Get document namespace</p>
</td>
<td class="cellalignment3499" headers="d78526e1113 d78526e1046">
<p><code>XmlDomGetNodeURI()</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1121" headers="d78526e1043">
<p>Validate using schema</p>
</td>
<td class="cellalignment3499" headers="d78526e1121 d78526e1046">
<p><code>XmlSchemaValidate()</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1129" headers="d78526e1043">
<p>Obtain DOM from <code>XMLType</code></p>
</td>
<td class="cellalignment3499" headers="d78526e1129 d78526e1046">
<p>Cast <code>(void *)</code> to <code>(xmldocnode *)</code></p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3501" id="d78526e1143" headers="d78526e1043">
<p>Obtain XMLType from DOM</p>
</td>
<td class="cellalignment3499" headers="d78526e1143 d78526e1046">
<p>Cast <code>(xmldocnode *)</code> to <code>(void *)</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="infoboxnotealso" id="GUID-687495C3-551B-4786-8A5F-F594985553E2__GUID-4CBD907D-4B95-4991-825E-B520D0F83A24">
<p class="notep1">See Also:</p>
<p><a class="olink ADXDK1400" target="_blank" href="../ADXDK/adx_c_parser.htm#ADXDK1400"><span class="italic">Oracle XML Developer&#39;s Kit Programmer&#39;s Guide</span></a> &#34;XML Parser for C&#34;</p>
</div>
<p><a href="xdb12oci.htm#GUID-687495C3-551B-4786-8A5F-F594985553E2__CHDBIHJI">Example 14-4</a> shows how to use the DOM to determine how many instances of a particular part have been ordered. The part in question has <code>Id</code> <code>37429158722</code>. See <a href="apphxdb.htm#GUID-8FCAD86A-3BF9-4B20-A9EE-8FC46C95C3CE" title="Full listings are provided here for the Oracle XML&nbsp;DB-supplied XML schemas, purchase-order XML schemas and an XSLT stylesheet used in various examples, and C-language (OCI) examples for loading XML content into Oracle XML&nbsp;DB and initializing and terminating an XML context.">Oracle-Supplied XML Schemas and Examples</a>, <a href="apphxdb.htm#GUID-8CA90A5B-999C-49B6-A2FD-41427C332F17__BABGHJFA">Example A-6</a> for the definitions of helper functions <code>exec_bind_xml</code>, <code>free_oci_handles</code>, and <code>init_oci_handles</code>.</p>
<div class="example" id="GUID-687495C3-551B-4786-8A5F-F594985553E2__CHDBIHJI">
<p class="titleinexample">Example 14-4 Using the DOM to Count Ordered Parts</p>
<pre dir="ltr">#ifndef S_ORACLE
#endif
#ifndef ORATYPES_ORACLE
#include &lt;oratypes.h&gt;
#endif
#ifndef XML_ORACLE
#include &lt;xml.h&gt;
#endif
#ifndef OCIXML_ORACLE
#include &lt;ocixml.h&gt;
#endif
#ifndef OCI_ORACLE
#include &lt;oci.h&gt;
#endif
#include &lt;string.h&gt;
 
typedef struct test_ctx {
        OCIEnv *envhp;
        OCIError *errhp;
        OCISvcCtx *svchp;
        OCIStmt *stmthp;
        OCIServer *srvhp;
        OCIDuration dur;
        OCISession *sesshp;
        oratext *username;
        oratext *password;
} test_ctx;
 
/* Helper function 1: execute a sql statement which binds xml data */
static sword <span class="bold">exec_bind_xml</span>(OCISvcCtx *svchp,
                           OCIError *errhp,
                           OCIStmt *stmthp,
                           void *xml,
                           OCIType *xmltdo,
                           OraText *sqlstmt);
 
/* Helper function 2: Initialize OCI handles and connect */
static sword <span class="bold">init_oci_handles</span>(test_ctx *ctx);
 
/* Helper function 3: Free OCI handles and disconnect */
static sword <span class="bold">free_oci_handles</span>(test_ctx *ctx);
 
void <span class="bold">main</span>()
{
  test_ctx temp_ctx;
  test_ctx *ctx = &amp;temp_ctx;
  OCIType *xmltdo = (OCIType *) 0;
  xmldocnode *doc = (xmldocnode *)0;
  ocixmldbparam params[1];
  xmlnode *quux, *foo, *foo_data, *top;
  xmlerr err;
  sword status = 0;
  xmlctx *xctx;
  ub4 xmlsize = 0;
  OCIDefine *defnp = (OCIDefine *) 0;
  oratext sel_stmt[] = &#34;SELECT SYS_NC_ROWINFO$ FROM PURCHASEORDER&#34;;
  xmlnodelist *litems = (xmlnodelist *)0;
  xmlnode *item = (xmlnode *)item;
  xmlnode *part;
  xmlnamedmap *attrs;
  xmlnode *id;
  xmlnode *qty;
  oratext *idval;
  oratext *qtyval;
  ub4 total_qty;
  int i;
  int numdocs;
  
  ctx-&gt;username = (oratext *)&#34;oe&#34;;
  ctx-&gt;password = (oratext *)&#34;***********&#34;;   /* Replace with real password */

  /* Initialize envhp, svchp, errhp, dur, stmthp */
  init_oci_handles(ctx);
 
  /* Get an xml context */
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;ctx-&gt;dur;
  xctx = OCIXmlDbInitXmlCtx(ctx-&gt;envhp, ctx-&gt;svchp, ctx-&gt;errhp, params, 1);
 
  /* Start processing */
  printf(&#34;\n\n<span class="bold">Supports XML 1.0? :</span> %s\n&#34;,
         XmlHasFeature(xctx, (oratext *) &#34;xml&#34;, (oratext *) &#34;1.0&#34;) ?
         &#34;YES&#34; : &#34;NO&#34;);
 
  /* Get the documents from the database using a select statement */
  status = OCITypeByName(ctx-&gt;envhp, ctx-&gt;errhp, ctx-&gt;svchp, (const text *) &#34;SYS&#34;,
                         (ub4) strlen((char *)&#34;SYS&#34;), (const text *) &#34;XMLTYPE&#34;,
                         (ub4) strlen((char *)&#34;XMLTYPE&#34;), (CONST text *) 0,
                         (ub4) 0, OCI_DURATION_SESSION, OCI_TYPEGET_HEADER,
                         (OCIType **) &amp;xmltdo);
  status = OCIStmtPrepare(ctx-&gt;stmthp, ctx-&gt;errhp,
                 (CONST OraText *)sel_stmt, (ub4) strlen((char *)sel_stmt),
                 (ub4) OCI_NTV_SYNTAX, (ub4) OCI_DEFAULT);
  status = OCIDefineByPos(ctx-&gt;stmthp, &amp;defnp, ctx-&gt;errhp, (ub4) 1, (dvoid *) 0,
                 (sb4) 0, SQLT_NTY, (dvoid *) 0, (ub2 *)0,
                 (ub2 *)0, (ub4) OCI_DEFAULT);
  status = OCIDefineObject(defnp, ctx-&gt;errhp, (OCIType *) xmltdo,
                  (dvoid **) &amp;doc,
                  &amp;xmlsize, (dvoid **) 0, (ub4 *) 0);
  status = OCIStmtExecute(ctx-&gt;svchp, ctx-&gt;stmthp, ctx-&gt;errhp, (ub4) 0, (ub4) 0,
                 (CONST OCISnapshot*) 0, (OCISnapshot*) 0, (ub4) OCI_DEFAULT);
 
  /* Initialize variables */
  total_qty = 0;
  numdocs = 0; 
 
  /* Loop through all the documents */
  while ((status = OCIStmtFetch2(ctx-&gt;stmthp, ctx-&gt;errhp, (ub4) 1, (ub4) OCI_FETCH_NEXT,
                                 (ub4)1, (ub4) OCI_DEFAULT)) == 0)
  {
    numdocs++;
 
    /* Get all the LineItem elements */
    litems = XmlDomGetDocElemsByTag(xctx, doc, (oratext *)&#34;LineItem&#34;);
    i = 0;
 
    /* Loop through all LineItems */
    while (item = XmlDomGetNodeListItem(xctx, litems, i))
    {
      /* Get the part */
      part = XmlDomGetLastChild(xctx, item);
     
      /* Get the attributes */
      attrs = XmlDomGetAttrs(xctx, (xmlelemnode *)part);
 
      /* Get the id attribute and its value */
      id = XmlDomGetNamedItem(xctx, attrs, (oratext *)&#34;Id&#34;);
      idval = XmlDomGetNodeValue(xctx, id);
 
      /* Keep only parts with id 37429158722 */
      if (idval &amp;&amp; (strlen((char *)idval) == 11 )
          &amp;&amp; !strncmp((char *)idval, (char *)&#34;37429158722&#34;, 11))
      {
        /* Get the quantity attribute and its value.*/
        qty = XmlDomGetNamedItem(xctx, attrs, (oratext *)&#34;Quantity&#34;);
        qtyval = XmlDomGetNodeValue(xctx, qty);
 
        /* Add the quantity to total_qty */
        total_qty += atoi((char *)qtyval);
      }
      i++;
    }
    XmlFreeDocument(xctx, doc);
    doc = (xmldocnode *)0;
  }
  printf(&#34;<span class="bold">Total quantity needed for part 37429158722 =</span> %d\n&#34;, total_qty);
  printf(&#34;<span class="bold">Number of documents in table PURCHASEORDER =</span> %d\n&#34;, numdocs);
 
  /* Free Xml Ctx */
  OCIXmlDbFreeXmlCtx(xctx);
 
  /* Free envhp, svchp, errhp, stmthp */
  free_oci_handles(ctx);
}
</pre>
<p>The output from compiling and running this C program is as follows:</p>
<pre dir="ltr">Supports XML 1.0? : YES
Total quantity needed for part 37429158722 = 42
Number of documents in table PURCHASEORDER = 132
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment3410">
<tr>
<td class="cellalignment3417">
<table class="cellalignment3415">
<tr>
<td class="cellalignment3414"><a href="xdb11jav.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment3414"><a href="xdb_odpnet.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment3419">
<table class="cellalignment3413">
<tr>
<td class="cellalignment3414"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment3414"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment3414"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment3414"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment3414"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment3414"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>