<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-1607"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/XML%20Schema%20Evolution"></a><title>XML Schema Evolution</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="description" content="You can use XML schema evolution to update your XML schema after you have registered it with Oracle XML&nbsp;DB."/>
<meta name="keywords" content="DBMS_XMLSCHEMA PL/SQL package, copyEvolve procedure, copyEvolve PL/SQL procedure, procedures, PL/SQL, copyEvolve, inPlaceEvolve procedure, inPlaceEvolve PL/SQL procedure, inPlaceEvolve, XML schema, evolution, updating after registering, evolution, XML schema, schema evolution, XML schema evolution, copy-based XML schema evolution, copy-based, purchase-order XML schema, revised, stylesheet for updating XML instance documents, XSLT, stylesheets, for updating XML instance documents, in-place XML schema evolution, in-place, backward-compatible, definition, backward-compatible XML schema evolution, definition, model, XML Schema"/>
<meta name="dcterms.created" content="2016-12-08T13:53:25Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="XML DB Developer&#39;s Guide"/>
<meta name="dcterms.identifier" content="E41152-15"/>
<meta name="dcterms.isVersionOf" content="ADXDB"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2002, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Prev" href="xdb_rewrite.htm" title="Previous" type="text/html"/>
<link rel="Next" href="partpg5.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E41152-15.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-F2E920B3-C6D7-428B-9E75-5CE9C21F9B5F"></a> <span id="PAGE" style="display:none;">32/61</span> <!-- End Header -->
<a id="ADXDB0800"></a>
<h1 id="ADXDB-GUID-F2E920B3-C6D7-428B-9E75-5CE9C21F9B5F" class="sect1"><span class="enumeration_chapter">20</span> XML Schema Evolution</h1>
<div>
<p>You can use XML schema evolution to update your XML schema after you have registered it with Oracle XML&nbsp;DB.</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="xdb07evo.htm#GUID-98F5058B-852E-48C2-80A5-C5E7068AE0DD" title="A major challenge for developers using an XML schema with Oracle XML&nbsp;DB is how to deal with changes in the content or structure of XML documents. In some environments, the need for changes may be frequent or extensive, arising from new regulations, internal needs, or external opportunities.">Overview of XML Schema Evolution</a></p>
</li>
<li>
<p><a href="xdb07evo.htm#GUID-0E4FC235-D8D1-4F27-85DC-A3DCCC2662AB" title="You perform copy-based XML schema evolution using PL/SQL procedure DBMS_XMLSCHEMA.copyEvolve. This backs up existing instance documents to temporary XMLType tables, drops the old version of the XML schema (which also deletes the associated instance documents), registers the new version, and copies the backed-up instance documents to new XMLType tables.">Copy-Based Schema Evolution</a></p>
</li>
<li>
<p><a href="xdb07evo.htm#GUID-0C97EA66-1890-495D-9117-55FB0D563992" title="In-place XML schema evolution makes changes to an XML schema without requiring that existing data be copied, deleted, and reinserted. In-place evolution is thus much faster than copy-based evolution. However, in-place evolution also has several restrictions that do not apply to copy-based evolution.">In-Place XML Schema Evolution</a></p>
</li>
</ul>
<p>Oracle XML&nbsp;DB supports the W3C XML Schema recommendation. XML instance documents that conform to an XML schema can be stored and retrieved using SQL and protocols such as FTP, HTTP(S), and WebDAV. In addition to specifying the structure of XML documents, XML schemas determine the mapping between XML and object-relational storage.</p>
<div class="infoboxnotealso" id="GUID-F2E920B3-C6D7-428B-9E75-5CE9C21F9B5F__GUID-39C9F165-EB50-422A-B094-03F10D8E220A">
<p class="notep1">See Also:</p>
<p><a href="xdb05sto.htm#GUID-C09824C1-6B02-4556-A265-B1749DEE8DE1" title="XML Schema is a standard for describing the content and structure of XML documents. You can register, update, and delete an XML schema used with Oracle XML&nbsp;DB. You can define storage structures to use for your XML schema-based data and map XML Schema data types to SQL data types.">XML Schema Storage and Query: Basic</a></p>
</div>
</div>
<a id="ADXDB4680"></a>
<div class="props_rev_3"><a id="GUID-98F5058B-852E-48C2-80A5-C5E7068AE0DD"></a>
<h2 id="ADXDB-GUID-98F5058B-852E-48C2-80A5-C5E7068AE0DD" class="sect2"><span class="enumeration_section">20.1</span> Overview of XML Schema Evolution</h2>
<div>
<p>A major challenge for developers using an XML schema with Oracle XML&nbsp;DB is how to deal with changes in the content or structure of XML documents. In some environments, the need for changes may be frequent or extensive, arising from new regulations, internal needs, or external opportunities.</p>
<p>For example, you might need to add new elements or attributes to an XML schema definition, modify a data type, or relax or tighten certain minimum and maximum occurrence requirements.</p>
<p>In such cases, you need to &#34;evolve&#34; the XML schema so that new requirements are accommodated, while any existing instance documents (the data) remain valid (or can be made valid), and existing applications can continue to run.</p>
<p>If you do not care about any existing documents, you can of course simply drop the <code>XMLType</code> tables that are dependent on the XML schema, delete the old XML schema, and register the new XML schema at the same URL. In most cases, however, you need to keep the existing documents, possibly transforming them to accommodate the new XML schema.</p>
<p>Oracle XML&nbsp;DB supports two kinds of schema evolution:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="bold">Copy-based schema evolution</span>, in which all instance documents that conform to the schema are copied to a temporary location in the database, the old schema is deleted, the modified schema is registered, and the instance documents are inserted into their new locations from the temporary area</p>
</li>
<li>
<p><span class="bold">In-place schema evolution</span>, which does not require copying, deleting, and inserting existing data and thus is much faster than copy-based evolution, but which has restrictions that do not apply to copy-based evolution</p>
<p>In general, in-place evolution is permitted if you are not changing the storage model and if the changes do not invalidate existing documents (that is, if existing documents are conformant with the new schema or can be made conformant with it). A more detailed explanation of restrictions and guidelines is presented in <span class="q">&#34;<a href="xdb07evo.htm#GUID-0C97EA66-1890-495D-9117-55FB0D563992" title="In-place XML schema evolution makes changes to an XML schema without requiring that existing data be copied, deleted, and reinserted. In-place evolution is thus much faster than copy-based evolution. However, in-place evolution also has several restrictions that do not apply to copy-based evolution.">In-Place XML Schema Evolution</a>&#34;</span>.</p>
</li>
</ul>
<p>Each approach has its own PL/SQL procedure: <code>DBMS_XMLSCHEMA.copyEvolve</code> for copy-based evolution, <code>DBMS_XMLSCHEMA.inPlaceEvolve</code> for in-place evolution. This chapter explains the use of each procedure and presents guidelines for using its associated approach to schema evolution.</p>
</div>
</div>
<a id="ADXDB4681"></a>
<div class="props_rev_3"><a id="GUID-0E4FC235-D8D1-4F27-85DC-A3DCCC2662AB"></a>
<h2 id="ADXDB-GUID-0E4FC235-D8D1-4F27-85DC-A3DCCC2662AB" class="sect2"><span class="enumeration_section">20.2</span> Copy-Based Schema Evolution</h2>
<div>
<p>You perform copy-based XML schema evolution using PL/SQL procedure <code>DBMS_XMLSCHEMA.copyEvolve</code>. This backs up existing instance documents to temporary <code>XMLType</code> tables, drops the old version of the XML schema (which also deletes the associated instance documents), registers the new version, and copies the backed-up instance documents to new <code>XMLType</code> tables.</p>
<p>In case of a problem, the backup copies are restored&thinsp;&mdash;&thinsp;see <span class="q">&#34;<a href="xdb07evo.htm#GUID-8EDAD01C-4791-4458-A0F3-EBFAC3E94D61" title="Procedure DBMS_XMLSCHEMA.copyEvolve either completely succeeds or it raises an error. If it raises an error then it tries to roll back as much of the operation as possible.">Rollback When Procedure DBMS_XMLSCHEMA.COPYEVOLVE Raises an Error</a>&#34;</span>.</p>
<p>Using procedure <code>copyEvolve</code>, you can evolve your registered XML schema in such a way that existing XML instance documents continue to be valid.</p>
</div>
<a id="ADXDB4683"></a><a id="ADXDB4682"></a>
<div class="props_rev_3"><a id="GUID-AD87A5C3-D0E8-4109-A6B2-F3F673D42FFD"></a>
<h3 id="ADXDB-GUID-AD87A5C3-D0E8-4109-A6B2-F3F673D42FFD" class="sect3"><span class="enumeration_section">20.2.1</span> Scenario for Copy-Based Evolution</h3>
<div>
<p>An evolved version of a purchase-order XML schema is shown. It is used in examples that illustrate the use of copy-based XML schema evolution.</p>
<p><a href="xdb07evo.htm#GUID-AD87A5C3-D0E8-4109-A6B2-F3F673D42FFD__BCGJAFFH">Example 20-1</a> shows a <span class="italic">partial</span> listing of a revised version of the purchase-order XML schema of <a href="apphxdb.htm#GUID-1CB2213C-C6E8-4BC4-86A3-EFDE51AEBEFD__BABDAGBF">Example A-2</a>. See <a href="apphxdb.htm#GUID-1CB2213C-C6E8-4BC4-86A3-EFDE51AEBEFD__BABJJIFI">Example A-3</a> for the <span class="italic">complete</span> revised schema listing. Text that is in <span class="bold">bold</span> here is new or different from that in the original schema.</p>
<div class="example" id="GUID-AD87A5C3-D0E8-4109-A6B2-F3F673D42FFD__BCGJAFFH">
<p class="titleinexample">Example 20-1 Revised Purchase-Order XML Schema</p>
<pre dir="ltr">&lt;xs:schema xmlns:xs=&#34;http://www.w3.org/2001/XMLSchema&#34;
           xmlns:xdb=&#34;http://xmlns.oracle.com/xdb&#34;
           version=&#34;1.0&#34;&gt;
  &lt;xs:element
    name=&#34;PurchaseOrder&#34; type=&#34;PurchaseOrderType&#34;
    xdb:defaultTable=&#34;PURCHASEORDER&#34;
    <span class="bold">xdb:columnProps=</span>
      <span class="bold">&#34;CONSTRAINT purchaseorder_pkey PRIMARY KEY (XMLDATA.reference),</span>
       <span class="bold">CONSTRAINT valid_email_address FOREIGN KEY (XMLDATA.userid)</span>
         <span class="bold">REFERENCES hr.employees (EMAIL)&#34;</span>
    xdb:tableProps=
      &#34;VARRAY XMLDATA.ACTIONS.ACTION STORE AS TABLE ACTION_TABLE
        ((CONSTRAINT action_pkey PRIMARY KEY (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
       VARRAY XMLDATA.LINEITEMS.LINEITEM STORE AS TABLE LINEITEM_TABLE
        ((constraint LINEITEM_PKEY primary key (NESTED_TABLE_ID, SYS_NC_ARRAY_INDEX$)))
       lob (XMLDATA.NOTES) STORE AS (ENABLE STORAGE IN ROW STORAGE(INITIAL 4K NEXT 32K))&#34;/&gt;
  &lt;xs:complexType name=&#34;PurchaseOrderType&#34; xdb:SQLType=&#34;PURCHASEORDER_T&#34;&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name=&#34;Actions&#34; type=&#34;ActionsType&#34; xdb:SQLName=&#34;ACTIONS&#34;/&gt;
      &lt;xs:element name=&#34;Reject&#34; type=&#34;RejectionType&#34; minOccurs=&#34;0&#34; xdb:SQLName=&#34;REJECTION&#34;/&gt;
      &lt;xs:element name=&#34;Requestor&#34; type=&#34;RequestorType&#34; xdb:SQLName=&#34;REQUESTOR&#34;/&gt;
      &lt;xs:element name=&#34;User&#34; type=&#34;UserType&#34; xdb:SQLName=&#34;USERID&#34;/&gt;
      &lt;xs:element name=&#34;CostCenter&#34; type=&#34;CostCenterType&#34; xdb:SQLName=&#34;COST_CENTER&#34;/&gt; 
      <span class="bold">&lt;xs:element name=&#34;BillingAddress&#34; type=&#34;AddressType&#34; minOccurs=&#34;0&#34;</span>
                  <span class="bold">xdb:SQLName=&#34;BILLING_ADDRESS&#34;/&gt;</span> 
      &lt;xs:element name=&#34;ShippingInstructions&#34; type=&#34;ShippingInstructionsType&#34;
                  xdb:SQLName=&#34;SHIPPING_INSTRUCTIONS&#34;/&gt; 
      &lt;xs:element name=&#34;SpecialInstructions&#34; type=&#34;SpecialInstructionsType&#34;
                  xdb:SQLName=&#34;SPECIAL_INSTRUCTIONS&#34;/&gt; 
      &lt;xs:element name=&#34;LineItems&#34; type=&#34;LineItemsType&#34; xdb:SQLName=&#34;LINEITEMS&#34;/&gt;
      <span class="bold">&lt;xs:element name=&#34;Notes&#34; type=&#34;NotesType&#34; minOccurs=&#34;0&#34; xdb:SQLType=&#34;CLOB&#34;</span>
                  <span class="bold">xdb:SQLName=&#34;NOTES&#34;/&gt;</span> 
    &lt;/xs:sequence&gt;
    <span class="bold">&lt;xs:attribute name=&#34;Reference&#34; type=&#34;ReferenceType&#34; use=&#34;required&#34; xdb:SQLName=&#34;REFERENCE&#34;/&gt;</span>
    &lt;xs:attribute name=&#34;DateCreated&#34; type=&#34;xs:dateTime&#34; use=&#34;required&#34;
                  xdb:SQLType=&#34;TIMESTAMP WITH TIME ZONE&#34;/&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name=&#34;LineItemsType&#34; xdb:SQLType=&#34;LINEITEMS_T&#34;&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name=&#34;LineItem&#34; type=&#34;LineItemType&#34; maxOccurs=&#34;unbounded&#34; xdb:SQLName=&#34;LINEITEM&#34;
                  xdb:SQLCollType=&#34;LINEITEM_V&#34;/&gt;  
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name=&#34;LineItemType&#34; xdb:SQLType=&#34;LINEITEM_T&#34;&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name=&#34;Part&#34; type=&#34;PartType&#34; xdb:SQLName=&#34;PART&#34;/&gt;
      <span class="bold">&lt;xs:element name=&#34;Quantity&#34; type=&#34;quantityType&#34;/&gt;</span>
    &lt;/xs:sequence&gt;
    &lt;xs:attribute name=&#34;ItemNumber&#34; type=&#34;xs:integer&#34; xdb:SQLName=&#34;ITEMNUMBER&#34;
                  xdb:SQLType=&#34;NUMBER&#34;/&gt; 
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name=&#34;PartType&#34; xdb:SQLType=&#34;PART_T&#34;&gt;
    <span class="bold">&lt;xs:simpleContent&gt;</span>
      <span class="bold">&lt;xs:extension base=&#34;UPCCodeType&#34;&gt;</span>
        <span class="bold">&lt;xs:attribute name=&#34;Description&#34; type=&#34;DescriptionType&#34; use=&#34;required&#34;</span>
                      <span class="bold">xdb:SQLName=&#34;DESCRIPTION&#34;/&gt;</span> 
        <span class="bold">&lt;xs:attribute name=&#34;UnitCost&#34; type=&#34;moneyType&#34; use=&#34;required&#34;/&gt;</span>
      <span class="bold">&lt;/xs:extension&gt;</span>
    <span class="bold">&lt;/xs:simpleContent&gt;</span>
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name=&#34;ReferenceType&#34;&gt;
    &lt;xs:restriction base=&#34;xs:string&#34;&gt;
      &lt;xs:minLength value=&#34;18&#34;/&gt;
      &lt;xs:maxLength value=&#34;30&#34;/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
</pre>
<pre dir="ltr"><span class="bold">. . .</span>
</pre>
<pre dir="ltr">  &lt;xs:complexType name=&#34;RejectionType&#34; xdb:SQLType=&#34;REJECTION_T&#34;&gt;
    &lt;xs:all&gt;
      &lt;xs:element name=&#34;User&#34; type=&#34;UserType&#34; minOccurs=&#34;0&#34; xdb:SQLName=&#34;REJECTED_BY&#34;/&gt;
      &lt;xs:element name=&#34;Date&#34; type=&#34;DateType&#34; minOccurs=&#34;0&#34; xdb:SQLName=&#34;DATE_REJECTED&#34;/&gt;
      &lt;xs:element name=&#34;Comments&#34; type=&#34;CommentsType&#34; minOccurs=&#34;0&#34; xdb:SQLName=&#34;REASON_REJECTED&#34;/&gt;
    &lt;/xs:all&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:complexType name=&#34;ShippingInstructionsType&#34; xdb:SQLType=&#34;SHIPPING_INSTRUCTIONS_T&#34;&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name=&#34;name&#34; type=&#34;NameType&#34; minOccurs=&#34;0&#34; xdb:SQLName=&#34;SHIP_TO_NAME&#34;/&gt;
      <span class="bold">&lt;xs:choice&gt;</span>
        <span class="bold">&lt;xs:element name=&#34;address&#34; type=&#34;AddressType&#34; minOccurs=&#34;0&#34;/&gt;</span>
        <span class="bold">&lt;xs:element name=&#34;fullAddress&#34; type=&#34;FullAddressType&#34; minOccurs=&#34;0&#34;</span>
                    <span class="bold">xdb:SQLName=&#34;SHIP_TO_ADDRESS&#34;/&gt;</span> 
      <span class="bold">&lt;/xs:choice&gt;</span>
      &lt;xs:element name=&#34;telephone&#34; type=&#34;TelephoneType&#34; minOccurs=&#34;0&#34; xdb:SQLName=&#34;SHIP_TO_PHONE&#34;/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
</pre>
<pre dir="ltr"><span class="bold">. . .</span>
</pre>
<pre dir="ltr">  &lt;xs:simpleType name=&#34;NameType&#34;&gt;
    &lt;xs:restriction base=&#34;xs:string&#34;&gt;
      &lt;xs:minLength value=&#34;1&#34;/&gt;
      &lt;xs:maxLength value=&#34;20&#34;/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  <span class="bold">&lt;xs:simpleType name=&#34;FullAddressType&#34;&gt;</span>
    &lt;xs:restriction base=&#34;xs:string&#34;&gt;
      &lt;xs:minLength value=&#34;1&#34;/&gt;
      &lt;xs:maxLength value=&#34;256&#34;/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
</pre>
<pre dir="ltr"><span class="bold">. . .</span>
</pre>
<pre dir="ltr">  &lt;xs:simpleType name=&#34;DescriptionType&#34;&gt;
    &lt;xs:restriction base=&#34;xs:string&#34;&gt;
      &lt;xs:minLength value=&#34;1&#34;/&gt;
      &lt;xs:maxLength value=&#34;256&#34;/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  <span class="bold">&lt;xs:complexType name=&#34;AddressType&#34; xdb:SQLType=&#34;ADDRESS_T&#34;&gt;</span>
    <span class="bold">&lt;xs:sequence&gt;</span>
      <span class="bold">&lt;xs:element name=&#34;StreetLine1&#34; type=&#34;StreetType&#34;/&gt;</span>
      <span class="bold">&lt;xs:element name=&#34;StreetLine2&#34; type=&#34;StreetType&#34; minOccurs=&#34;0&#34;/&gt;</span>
      <span class="bold">&lt;xs:element name=&#34;City&#34; type=&#34;CityType&#34;/&gt;</span>
      <span class="bold">&lt;xs:choice&gt;</span>
        <span class="bold">&lt;xs:sequence&gt;</span>
          <span class="bold">&lt;xs:element name=&#34;State&#34; type=&#34;StateType&#34;/&gt;</span>
          <span class="bold">&lt;xs:element name=&#34;ZipCode&#34; type=&#34;ZipCodeType&#34;/&gt;</span>
        <span class="bold">&lt;/xs:sequence&gt;</span>
        <span class="bold">&lt;xs:sequence&gt;</span>
          <span class="bold">&lt;xs:element name=&#34;Province&#34; type=&#34;ProvinceType&#34;/&gt;</span>
          <span class="bold">&lt;xs:element name=&#34;PostCode&#34; type=&#34;PostCodeType&#34;/&gt;</span>
        <span class="bold">&lt;/xs:sequence&gt;</span>
        <span class="bold">&lt;xs:sequence&gt;</span>
          <span class="bold">&lt;xs:element name=&#34;County&#34; type=&#34;CountyType&#34;/&gt;</span>
          <span class="bold">&lt;xs:element name=&#34;Postcode&#34; type=&#34;PostCodeType&#34;/&gt;</span>
        <span class="bold">&lt;/xs:sequence&gt;</span>
      <span class="bold">&lt;/xs:choice&gt;</span>
      <span class="bold">&lt;xs:element name=&#34;Country&#34; type=&#34;CountryType&#34;/&gt;</span>
    <span class="bold">&lt;/xs:sequence&gt;</span>
  <span class="bold">&lt;/xs:complexType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;StreetType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;1&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;128&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;CityType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;1&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;64&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;StateType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;2&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;2&#34;/&gt;</span>
      <span class="bold">&lt;xs:enumeration value=&#34;AK&#34;/&gt;</span>
      <span class="bold">&lt;xs:enumeration value=&#34;AL&#34;/&gt;</span>
      <span class="bold">&lt;xs:enumeration value=&#34;AR&#34;/&gt;</span>
</pre>
<pre dir="ltr"><span class="bold"> . . .</span> <span class="italic">-- A value for each US state abbreviation</span>
</pre>
<pre dir="ltr">      <span class="bold">&lt;xs:enumeration value=&#34;WY&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;ZipCodeType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:pattern value=&#34;\d{5}&#34;/&gt;</span>
      <span class="bold">&lt;xs:pattern value=&#34;\d{5}-\d{4}&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;CountryType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;1&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;64&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;CountyType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;1&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;32&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;PostCodeType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;1&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;12&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;ProvinceType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;2&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;2&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;NotesType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;32767&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
  <span class="bold">&lt;xs:simpleType name=&#34;UPCCodeType&#34;&gt;</span>
    <span class="bold">&lt;xs:restriction base=&#34;xs:string&#34;&gt;</span>
      <span class="bold">&lt;xs:minLength value=&#34;11&#34;/&gt;</span>
      <span class="bold">&lt;xs:maxLength value=&#34;14&#34;/&gt;</span>
      <span class="bold">&lt;xs:pattern value=&#34;\d{11}&#34;/&gt;</span>
      <span class="bold">&lt;xs:pattern value=&#34;\d{12}&#34;/&gt;</span>
      <span class="bold">&lt;xs:pattern value=&#34;\d{13}&#34;/&gt;</span>
      <span class="bold">&lt;xs:pattern value=&#34;\d{14}&#34;/&gt;</span>
    <span class="bold">&lt;/xs:restriction&gt;</span>
  <span class="bold">&lt;/xs:simpleType&gt;</span>
&lt;/xs:schema&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB4685"></a><a id="ADXDB4686"></a><a id="ADXDB4684"></a>
<div class="props_rev_3"><a id="GUID-8F38814C-56AE-4021-AF31-AB8A99342C47"></a>
<h3 id="ADXDB-GUID-8F38814C-56AE-4021-AF31-AB8A99342C47" class="sect3"><span class="enumeration_section">20.2.2</span> COPYEVOLVE Parameters and Errors</h3>
<div>
<p>The parameters of PL/SQL procedure <code>DBMS_XMLSCHEMA.copyEvolve</code> are described, as are the errors associated with this procedure.</p>
<div class="section">
<p>This is the signature of procedure <code>DBMS_XMLSCHEMA.copyEvolve</code>:</p>
<pre dir="ltr">procedure copyEvolve(schemaURLs       IN XDB$STRING_LIST_T,
                     newSchemas       IN XMLSequenceType,
                     transforms       IN XMLSequenceType := NULL,
                     preserveOldDocs  IN BOOLEAN := FALSE,
                     mapTabName       IN VARCHAR2 := NULL,
                     generateTables   IN BOOLEAN := TRUE,
                     force            IN BOOLEAN := FALSE,
                     schemaOwners     IN XDB$STRING_LIST_T := NULL
                     parallelDegree   IN PLS_INTEGER := 0,
                     options          IN PLS_INTEGER := 0);
</pre>
<p><a href="xdb07evo.htm#GUID-8F38814C-56AE-4021-AF31-AB8A99342C47__BCGJCFHJ" title="This table describes the DBMS_XMLSCHEMA.CopyEvolve parameters.">Table 20-1</a> describes the individual parameters. <a href="xdb07evo.htm#GUID-8F38814C-56AE-4021-AF31-AB8A99342C47__BCGGIFAF" title="This table describes DG&lsquo;BMS_XMLSCHEMA.copyevolve&rsquo;s errors and exceptions. It includes the cause and action to take.">Table 20-2</a> describes the errors associated with the procedure.</p>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-8F38814C-56AE-4021-AF31-AB8A99342C47__BCGJCFHJ">
<p class="titleintable">Table 20-1 Parameters of Procedure DBMS_XMLSCHEMA.COPYEVOLVE</p>
<table class="cellalignment3420" title="Parameters of Procedure DBMS_XMLSCHEMA.COPYEVOLVE" summary="This table describes the DBMS_XMLSCHEMA.CopyEvolve parameters.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3518" id="d104231e710">Parameter</th>
<th class="cellalignment3519" id="d104231e713">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e718" headers="d104231e710">
<p><code>schemaURLs</code></p>
</td>
<td class="cellalignment3521" headers="d104231e718 d104231e713">
<p>Varray of URLs of XML schemas to be evolved (varray of <code>VARCHAR2(4000)</code>. This should include the dependent schemas as well. Unless the force parameter is <code>TRUE</code>, the URLs should be in the dependency order, that is, if URL A comes before URL B in the varray, then schema A should not be dependent on schema B but schema B may be dependent on schema A.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e732" headers="d104231e710">
<p><code>newSchemas</code></p>
</td>
<td class="cellalignment3521" headers="d104231e732 d104231e713">
<p>Varray of new XML schema documents (<code>XMLType</code> instances). Specify this in exactly the same order as the corresponding URLs. If no change is necessary in an XML schema, provide the unchanged schema.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e743" headers="d104231e710">
<p><code>transforms</code></p>
</td>
<td class="cellalignment3521" headers="d104231e743 d104231e713">
<p>Varray of XSL documents (<code>XMLType</code> instances) that are applied to XML schema based documents to make them conform to the new schemas. Specify these in exactly the same order as the corresponding URLs. If no transformations are required, this parameter need not be specified.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e754" headers="d104231e710">
<p><code>preserveOldDocs</code></p>
</td>
<td class="cellalignment3521" headers="d104231e754 d104231e713">
<p>If this is <code>TRUE</code>, then the temporary tables holding old data are not dropped at the end of schema evolution. See also <span class="q">&#34;<a href="xdb07evo.htm#GUID-52D895D1-BFD2-4DA8-B106-6385E9E7BA0D" title="General guidelines for using PL/SQL procedure DBMS_XMLSCHEMA.copyEvolveare presented, as well as guidelines that are specific to particular contexts.">Guidelines for Using Procedure COPYEVOLVE</a>&#34;</span>.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e776" headers="d104231e710">
<p><code>mapTabName</code></p>
</td>
<td class="cellalignment3521" headers="d104231e776 d104231e713">
<p>Specifies the name of table that maps old <code>XMLType</code> table or column names to names of corresponding temporary tables.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e787" headers="d104231e710">
<p><code>generateTables</code></p>
</td>
<td class="cellalignment3521" headers="d104231e787 d104231e713">
<p>By default this parameter is <code>TRUE</code>. If <code>FALSE</code> then <code>XMLType</code> tables or columns are not generated after registering new XML schemas. If <code>FALSE</code>, <code>preserveOldDocs</code> must be <code>TRUE</code> and <code>mapTabName</code> must not be <code>NULL</code>.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e820" headers="d104231e710">
<p><code>force</code></p>
</td>
<td class="cellalignment3521" headers="d104231e820 d104231e713">
<p>If this is <code>TRUE</code>, then errors during the registration of new schemas are ignored. If there are circular dependencies among the schemas, set this flag to <code>TRUE</code> to ensure that each schema is stored even though there may be errors in registration.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e834" headers="d104231e710">
<p><code>schemaOwners</code></p>
</td>
<td class="cellalignment3521" headers="d104231e834 d104231e713">
<p>Varray of names of schema owners. Specify these in exactly the same order as the corresponding URLs.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e842" headers="d104231e710">
<p><code>parallelDegree</code></p>
</td>
<td class="cellalignment3521" headers="d104231e842 d104231e713">
<p>Specifies the degree of parallelism to be used in a <code>PARALLEL</code> hint during the data-copy stage. If this is <code>0</code> (default value), a <code>PARALLEL</code> hint is absent from the data-copy statements.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e859" headers="d104231e710">
<p><code>options</code></p>
</td>
<td class="cellalignment3521" headers="d104231e859 d104231e713">
<p>Miscellaneous options. The only option is <code>COPYEVOLVE_BINARY_XML</code>, which means to register the new XML schemas for binary XML data and create the new tables or columns with binary XML as the storage model.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="tblformal" id="GUID-8F38814C-56AE-4021-AF31-AB8A99342C47__BCGGIFAF">
<p class="titleintable">Table 20-2 Errors Associated with Procedure DBMS_XMLSCHEMA.COPYEVOLVE</p>
<table class="cellalignment3420" title="Errors Associated with Procedure DBMS_XMLSCHEMA.COPYEVOLVE" summary="This table describes DG&lsquo;BMS_XMLSCHEMA.copyevolve&rsquo;s errors and exceptions. It includes the cause and action to take.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3481" id="d104231e880">Error Number and Message</th>
<th class="cellalignment3522" id="d104231e883">Cause</th>
<th class="cellalignment3522" id="d104231e886">Action</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3484" id="d104231e891" headers="d104231e880">
<p><span class="bold">30942</span> XML Schema Evolution error for schema &#39;&lt;schema_url&gt;&#39; table &#34;&lt;owner_name&gt;.&lt;table_name&gt;&#34; column &#39;&lt;column_name&gt;&#39;</p>
</td>
<td class="cellalignment3523" headers="d104231e891 d104231e883">
<p>The given <code>XMLType</code> table or column that conforms to the given XML schema had errors during evolution. In the case of a table, the column name is empty. See also the more specific error that follows this.</p>
</td>
<td class="cellalignment3523" headers="d104231e891 d104231e886">
<p>Based on the schema, table, and column information in this error and the more specific error that follows, take corrective action.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3484" id="d104231e906" headers="d104231e880">
<p><span class="bold">30943</span> XML Schema &#39;&lt;schema_url&gt;&#39; is dependent on XML schema &#39;&lt;schema_url&gt;&#39;</p>
</td>
<td class="cellalignment3523" headers="d104231e906 d104231e883">
<p>Not all dependent XML schemas were specified or the schemas were not specified in dependency order, that is, if schema S1 is dependent on schema S, S must appear before S1.</p>
</td>
<td class="cellalignment3523" headers="d104231e906 d104231e886">
<p>Include the previously unspecified schema in the list of schemas or correct the order in which the schemas are specified. Then retry the operation.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3484" id="d104231e918" headers="d104231e880">
<p><span class="bold">30944</span> Error during rollback for XML schema &#39;&lt;schema_url&gt;&#39; table &#34;&lt;owner_name&gt;.&lt;table_name&gt;&#34; column &#39;&lt;column_name&gt;&#39;</p>
</td>
<td class="cellalignment3523" headers="d104231e918 d104231e883">
<p>The given <code>XMLType</code> table or column that conforms to the given XML schema had errors during a rollback of XML schema evolution. For a table, the column name is empty. See also the more specific error that follows this.</p>
</td>
<td class="cellalignment3523" headers="d104231e918 d104231e886">
<p>Based on the schema, table, and column information in this error and the more specific error that follows, take corrective action.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3484" id="d104231e933" headers="d104231e880">
<p><span class="bold">30945</span> Could not create mapping table &#39;&lt;table_name&gt;&#39;</p>
</td>
<td class="cellalignment3523" headers="d104231e933 d104231e883">
<p>A mapping table could not be created during XML schema evolution. See also the more specific error that follows this.</p>
</td>
<td class="cellalignment3523" headers="d104231e933 d104231e886">
<p>Ensure that a table with the given name does not exist and retry the operation.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3484" id="d104231e945" headers="d104231e880">
<p><span class="bold">30946</span> XML Schema Evolution warning: temporary tables not cleaned up</p>
</td>
<td class="cellalignment3523" headers="d104231e945 d104231e883">
<p>An error occurred after the schema was evolved while cleaning up temporary tables. The schema evolution was successful.</p>
</td>
<td class="cellalignment3523" headers="d104231e945 d104231e886">
<p>If you need to remove the temporary tables, use the mapping table to get the temporary table names and drop them.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
<a id="ADXDB4687"></a>
<div class="props_rev_3"><a id="GUID-12760FD2-5A95-49E9-A090-634C2AD18DA5"></a>
<h3 id="ADXDB-GUID-12760FD2-5A95-49E9-A090-634C2AD18DA5" class="sect3"><span class="enumeration_section">20.2.3</span> Limitations of Procedure COPYEVOLVE</h3>
<div>
<p>The use of PL/SQL procedure <code>DBMS_XMLSCHEMA.copyEvolve</code> involves certain limitations.</p>
<ul style="list-style-type: disc;">
<li>
<p>Indexes, triggers, constraints, row-level security (RLS) policies, and other metadata related to the <code>XMLType</code> tables that are dependent on the schemas are not preserved. These must be re-created after evolution.</p>
</li>
<li>
<p>If top-level element names are changed, additional steps are required after <code>copyEvolve</code> finishes executing. See <span class="q">&#34;<a href="xdb07evo.htm#GUID-26F70F58-478C-415D-8640-3B17FCEA25EF" title="PL/SQL procedure DBMS_XMLSCHEMA.copyEvolve assumes that top-level elements have not been dropped in new schemas and that their names have not been changed. If there are such changes then call procedure copyEvolve with parameter generateTables set to FALSE and parameter preserveOldDocs set to TRUE, so that backup document copies are available.">Top-Level Element Name Changes</a>&#34;</span>.</p>
</li>
<li>
<p>Copy-based evolution cannot be used if there is a table with an object-type column that has an <code>XMLType</code> attribute that is dependent on any of the schemas to be evolved. For example, consider this table:</p>
<pre dir="ltr">CREATE TYPE t1 AS OBJECT (n NUMBER, x XMLType);
CREATE TABLE tab1 (e NUMBER, o t1) XMLType 
 COLUMN o.x XMLSchema &#34;s1.xsd&#34; ELEMENT &#34;Employee&#34;;
</pre>
<p>This assumes that an XML schema with a top-level element <code>Employee</code> has been registered under URL <code>s1.xsd</code>. It is not possible to evolve this XML schema, because table <code>tab1</code> with column <code>o</code> with <code>XMLType</code> attribute <code>x</code> is dependent on the XML schema. Note that although <code>copyEvolve</code> does not handle <code>XMLType</code> object attributes, it does raise an error in such cases.</p>
</li>
</ul>
</div>
</div>
<a id="ADXDB4688"></a>
<div class="props_rev_3"><a id="GUID-52D895D1-BFD2-4DA8-B106-6385E9E7BA0D"></a>
<h3 id="ADXDB-GUID-52D895D1-BFD2-4DA8-B106-6385E9E7BA0D" class="sect3"><span class="enumeration_section">20.2.4</span> Guidelines for Using Procedure COPYEVOLVE</h3>
<div>
<p>General guidelines for using PL/SQL procedure <code>DBMS_XMLSCHEMA.copyEvolve</code>are presented, as well as guidelines that are specific to particular contexts.</p>
<p>The following general guideline applies to using <code>copyEvolve</code>. The rest of this section describes specific guidelines that can also be appropriate in particular contexts.</p>
<ol>
<li>
<p>Turn off the recycle bin, to prevent dropped tables from being copied to it:</p>
<pre dir="ltr">ALTER SESSION SET RECYCLEBIN=off;
</pre></li>
<li id="GUID-52D895D1-BFD2-4DA8-B106-6385E9E7BA0D__CHDDCIBA">
<p>Identify the XML schemas that are dependent on the XML schema that is to be evolved. You can acquire the URLs of the dependent XML schemas using the following query, where <span class="italic"><code>schema_to_be_evolved</code></span> is the schema to be evolved, and <span class="italic"><code>owner_of_schema_to_be_evolved</code></span> is its owner (database user).</p>
<pre dir="ltr">SELECT dxs.SCHEMA_URL, dxs.OWNER
    FROM DBA_DEPENDENCIES dd, DBA_XML_SCHEMAS dxs
    WHERE dd.REFERENCED_NAME = (SELECT INT_OBJNAME
                                  FROM DBA_XML_SCHEMAS
                                  WHERE SCHEMA_URL = <span class="italic">schema_to_be_evolved</span>
                                    AND OWNER = <span class="italic">owner_of_schema_to_be_evolved</span>)
      AND dxs.INT_OBJNAME = dd.NAME;
</pre>
<p>In many cases, no changes are needed in the dependent XML schemas. But if the dependent XML schemas need to be changed, then you must also prepare new versions of those XML schemas.</p>
</li>
<li>
<p>If the existing instance documents do not conform to the new XML schema, then you must provide an XSL stylesheet that, when applied to an instance document, transforms it to conform to the new schema. You must do this for each XML schema identified in Step <a href="xdb07evo.htm#GUID-52D895D1-BFD2-4DA8-B106-6385E9E7BA0D__CHDDCIBA">2</a>. The transformation must handle documents that conform to all top-level elements in the new XML schema.</p>
</li>
<li>
<p>Call procedure <code>DBMS_XMLSCHEMA.copyEvolve</code>, specifying the XML schema URLs, new schemas, and transformation stylesheet.</p>
</li>
</ol>
</div>
<a id="ADXDB4689"></a>
<div class="props_rev_3"><a id="GUID-26F70F58-478C-415D-8640-3B17FCEA25EF"></a>
<h4 id="ADXDB-GUID-26F70F58-478C-415D-8640-3B17FCEA25EF" class="sect4"><span class="enumeration_section">20.2.4.1</span> Top-Level Element Name Changes</h4>
<div>
<p>PL/SQL procedure <code>DBMS_XMLSCHEMA.copyEvolve</code> assumes that top-level elements have not been dropped in new schemas and that their names have not been changed. If there are such changes then call procedure <code>copyEvolve</code> with parameter <code>generateTables</code> set to <code>FALSE</code> and parameter <code>preserveOldDocs</code> set to <code>TRUE</code>, so that backup document copies are available.</p>
<p>With those parameter values, new tables are not generated, and the temporary tables holding the old documents (backup copies) are not dropped at the end of the procedure. You can then store the old documents in whatever form is appropriate and drop the temporary tables. See <span class="q">&#34;<a href="xdb07evo.htm#GUID-8F38814C-56AE-4021-AF31-AB8A99342C47" title="The parameters of PL/SQL procedure DBMS_XMLSCHEMA.copyEvolve are described, as are the errors associated with this procedure.">COPYEVOLVE Parameters and Errors</a>&#34;</span> for more details on using these parameters.</p>
</div>
</div>
<a id="ADXDB4690"></a>
<div class="props_rev_3"><a id="GUID-A672BEE9-10BA-4881-8DC2-3CFF0182AC93"></a>
<h4 id="ADXDB-GUID-A672BEE9-10BA-4881-8DC2-3CFF0182AC93" class="sect4"><span class="enumeration_section">20.2.4.2</span> User-Created Virtual Columns of Tables Other Than Default Tables</h4>
<div>
<p>For tables that are not default tables, any virtual columns that you create are not re-created during copy-based evolution. If such columns are needed then set <code>copyEvolve</code> parameter <code>preserveOldDocs</code> to <code>TRUE</code>, create the tables, and copy the old documents after procedure <code>copyEvolve</code> has finished.</p>
</div>
</div>
<a id="ADXDB4691"></a>
<div class="props_rev_3"><a id="GUID-FC3DC35A-0BCD-40C8-9300-EFF38F92794F"></a>
<h4 id="ADXDB-GUID-FC3DC35A-0BCD-40C8-9300-EFF38F92794F" class="sect4"><span class="enumeration_section">20.2.4.3</span> Ensure That the XML Schema and Dependents Are Not Used by Concurrent Sessions</h4>
<div>
<p>Ensure that the XML schema to be evolved, as well as its dependents, are not used by any concurrent session during the XML schema evolution process.</p>
<p>If other, concurrent sessions have shared locks on this schema at the beginning of the evolution process, then procedure <code>DBMS_XMLSCHEMA.copyEvolve</code> waits for these sessions to release the locks so that it can acquire an exclusive lock. However, this lock is released immediately to allow the rest of the process to continue.</p>
</div>
</div>
<a id="ADXDB4692"></a>
<div class="props_rev_3"><a id="GUID-8EDAD01C-4791-4458-A0F3-EBFAC3E94D61"></a>
<h4 id="ADXDB-GUID-8EDAD01C-4791-4458-A0F3-EBFAC3E94D61" class="sect4"><span class="enumeration_section">20.2.4.4</span> Rollback When Procedure DBMS_XMLSCHEMA.COPYEVOLVE Raises an Error</h4>
<div>
<p>Procedure <code>DBMS_XMLSCHEMA.copyEvolve</code> either completely succeeds or it raises an error. If it raises an error then it tries to roll back as much of the operation as possible.</p>
<p>Evolving an XML schema involves many database DDL statements. When an error occurs, compensating DDL statements are executed to undo the effect of all steps executed to that point. If the old tables or schemas have been dropped, they are re-created, but any table, column, and storage properties and any auxiliary structures (such as indexes, triggers, constraints, and RLS policies) associated with the tables and columns are lost.</p>
</div>
</div>
<a id="ADXDB4693"></a>
<div class="props_rev_3"><a id="GUID-8095D2EB-608D-4FE0-8E91-A37EDDD356F7"></a>
<h4 id="ADXDB-GUID-8095D2EB-608D-4FE0-8E91-A37EDDD356F7" class="sect4"><span class="enumeration_section">20.2.4.5</span> Failed Rollback From Insufficient Privileges</h4>
<div>
<p>In certain cases you cannot roll back a copy-based evolution operation. For example, if table creation fails due to reasons not related to the new XML schema, then there is no way to roll back.</p>
<p>An example is failure due to insufficient privileges. The temporary tables are not deleted even if <code>preserveOldDocs</code> is <code>FALSE</code>, so the data can be recovered. If the <code>mapTabName</code> parameter is null, the mapping table name is <code>XDB$MAPTAB</code> followed by a sequence number. The exact table name can be found using a query such as the following:</p>
<pre dir="ltr">SELECT TABLE_NAME FROM USER_TABLES WHERE TABLE_NAME LIKE &#39;XDB$MAPTAB<span class="bold">%</span>&#39;;
</pre></div>
</div>
<a id="ADXDB4694"></a>
<div class="props_rev_3"><a id="GUID-9D8602A7-07F3-4320-A70A-98AD84061FE8"></a>
<h4 id="ADXDB-GUID-9D8602A7-07F3-4320-A70A-98AD84061FE8" class="sect4"><span class="enumeration_section">20.2.4.6</span> Privileges Needed for XML Schema Evolution</h4>
<div>
<p>There are several database privileges that you might need, in order to perform copy-based XML schema evolution.</p>
<p>Copy-based XML schema evolution can involve dropping or creating SQL data types, so you need type-related privileges such as <code>DROP TYPE</code>, <code>CREATE TYPE</code>, and <code>ALTER TYPE</code>. You need privileges to delete and register the XML schemas involved in the evolution. You need all privileges on <code>XMLType</code> tables that conform to the schemas being evolved. For <code>XMLType</code> columns, the <code>ALTER TABLE</code> privilege is needed on corresponding tables. If there are schema-based <code>XMLType</code> tables or columns in other database schemas, you need privileges such as the following:</p>
<ul style="list-style-type: disc;">
<li>
<p><code>CREATE ANY TABLE</code></p>
</li>
<li>
<p><code>CREATE ANY INDEX</code></p>
</li>
<li>
<p><code>SELECT ANY TABLE</code></p>
</li>
<li>
<p><code>READ ANY TABLE</code></p>
</li>
<li>
<p><code>UPDATE ANY TABLE</code></p>
</li>
<li>
<p><code>INSERT ANY TABLE</code></p>
</li>
<li>
<p><code>DELETE ANY TABLE</code></p>
</li>
<li>
<p><code>DROP ANY TABLE</code></p>
</li>
<li>
<p><code>ALTER ANY TABLE</code></p>
</li>
<li>
<p><code>DROP ANY INDEX</code></p>
</li>
</ul>
<p>To avoid needing to grant all these privileges to the database- schema owner, Oracle recommends that a database administrator perform the evolution if there are XML schema-based <code>XMLType</code> table or columns belonging to other database schemas.</p>
</div>
</div>
</div>
<a id="ADXDB4696"></a><a id="ADXDB4695"></a>
<div class="props_rev_3"><a id="GUID-737B8590-6531-44BC-B81B-713466ABC931"></a>
<h3 id="ADXDB-GUID-737B8590-6531-44BC-B81B-713466ABC931" class="sect3"><span class="enumeration_section">20.2.5</span> Update of Existing XML Instance Documents Using an XSLT Stylesheet</h3>
<div>
<p>After you modify a registered XML schema, you must update any existing XML instance documents that use the schema. You do this by applying an XSLT stylesheet to each of the instance documents. The stylesheet represents the difference between the old and new XML schemas.</p>
<p><a href="xdb07evo.htm#GUID-737B8590-6531-44BC-B81B-713466ABC931__BCGGIEFI">Example 20-2</a> shows an XSLT stylesheet, in file <code>evolvePurchaseOrder.xsl</code>, that transforms existing purchase-order documents that use the old XML schema, so they use the new XML schema instead.</p>
<div class="example" id="GUID-737B8590-6531-44BC-B81B-713466ABC931__BCGGIEFI">
<p class="titleinexample">Example 20-2 evolvePurchaseOrder.xsl: XSLT Stylesheet to Update Instance Documents</p>
<pre dir="ltr">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;xsl:stylesheet 
  version=&#34;1.0&#34; 
  xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34; 
  xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;&gt;
  &lt;xsl:output method=&#34;xml&#34; encoding=&#34;UTF-8&#34;/&gt;
  &lt;xsl:template match=&#34;/PurchaseOrder&#34;&gt;
    &lt;PurchaseOrder&gt;
      &lt;xsl:attribute name=&#34;xsi:noNamespaceSchemaLocation&#34;&gt;
        http://localhost:8080/source/schemas/poSource/xsd/purchaseOrder.xsd
      &lt;/xsl:attribute&gt;
      &lt;xsl:for-each select=&#34;Reference&#34;&gt;
        &lt;xsl:attribute name=&#34;Reference&#34;&gt;
          &lt;xsl:value-of select=&#34;.&#34;/&gt;
        &lt;/xsl:attribute&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:variable name=&#34;V264_394&#34; select=&#34;&#39;2004-01-01T12:00:00.000000-08:00&#39;&#34;/&gt;
      &lt;xsl:attribute name=&#34;DateCreated&#34;&gt;
        &lt;xsl:value-of select=&#34;$V264_394&#34;/&gt;
      &lt;/xsl:attribute&gt;
      &lt;xsl:for-each select=&#34;Actions&#34;&gt;
        &lt;Actions&gt;
          &lt;xsl:for-each select=&#34;Action&#34;&gt;
            &lt;Action&gt;
              &lt;xsl:for-each select=&#34;User&#34;&gt;
                &lt;User&gt;
                  &lt;xsl:value-of select=&#34;.&#34;/&gt;
                &lt;/User&gt;
              &lt;/xsl:for-each&gt;
              &lt;xsl:for-each select=&#34;Date&#34;&gt;
                &lt;Date&gt;
                  &lt;xsl:value-of select=&#34;.&#34;/&gt;
                &lt;/Date&gt;
              &lt;/xsl:for-each&gt;
            &lt;/Action&gt;
          &lt;/xsl:for-each&gt;
        &lt;/Actions&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&#34;Reject&#34;&gt;
        &lt;Reject&gt;
          &lt;xsl:for-each select=&#34;User&#34;&gt;
            &lt;User&gt;
              &lt;xsl:value-of select=&#34;.&#34;/&gt;
            &lt;/User&gt;
          &lt;/xsl:for-each&gt;
          &lt;xsl:for-each select=&#34;Date&#34;&gt;
            &lt;Date&gt;
              &lt;xsl:value-of select=&#34;.&#34;/&gt;
            &lt;/Date&gt;
          &lt;/xsl:for-each&gt;
          &lt;xsl:for-each select=&#34;Comments&#34;&gt;
            &lt;Comments&gt;
              &lt;xsl:value-of select=&#34;.&#34;/&gt;
            &lt;/Comments&gt;
          &lt;/xsl:for-each&gt;
        &lt;/Reject&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&#34;Requestor&#34;&gt;
        &lt;Requestor&gt;
          &lt;xsl:value-of select=&#34;.&#34;/&gt;
        &lt;/Requestor&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&#34;User&#34;&gt;
        &lt;User&gt;
          &lt;xsl:value-of select=&#34;.&#34;/&gt;
        &lt;/User&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&#34;CostCenter&#34;&gt;
        &lt;CostCenter&gt;
          &lt;xsl:value-of select=&#34;.&#34;/&gt;
        &lt;/CostCenter&gt;
      &lt;/xsl:for-each&gt;
      &lt;ShippingInstructions&gt;
        &lt;xsl:for-each select=&#34;ShippingInstructions&#34;&gt;
          &lt;xsl:for-each select=&#34;name&#34;&gt;
            &lt;name&gt;
              &lt;xsl:value-of select=&#34;.&#34;/&gt;
            &lt;/name&gt;
          &lt;/xsl:for-each&gt;
        &lt;/xsl:for-each&gt;
        &lt;xsl:for-each select=&#34;ShippingInstructions&#34;&gt;
          &lt;xsl:for-each select=&#34;address&#34;&gt;
            &lt;fullAddress&gt;
              &lt;xsl:value-of select=&#34;.&#34;/&gt;
            &lt;/fullAddress&gt;
          &lt;/xsl:for-each&gt;
        &lt;/xsl:for-each&gt;
        &lt;xsl:for-each select=&#34;ShippingInstructions&#34;&gt;
          &lt;xsl:for-each select=&#34;telephone&#34;&gt;
            &lt;telephone&gt;
              &lt;xsl:value-of select=&#34;.&#34;/&gt;
            &lt;/telephone&gt;
          &lt;/xsl:for-each&gt;
        &lt;/xsl:for-each&gt;
      &lt;/ShippingInstructions&gt;
      &lt;xsl:for-each select=&#34;SpecialInstructions&#34;&gt;
        &lt;SpecialInstructions&gt;
          &lt;xsl:value-of select=&#34;.&#34;/&gt;
        &lt;/SpecialInstructions&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:for-each select=&#34;LineItems&#34;&gt;
        &lt;LineItems&gt;
          &lt;xsl:for-each select=&#34;LineItem&#34;&gt;
            &lt;xsl:variable name=&#34;V22&#34; select=&#34;.&#34;/&gt;
            &lt;LineItem&gt;
              &lt;xsl:for-each select=&#34;@ItemNumber&#34;&gt;
                &lt;xsl:attribute name=&#34;ItemNumber&#34;&gt;
                  &lt;xsl:value-of select=&#34;.&#34;/&gt;
                &lt;/xsl:attribute&gt;
              &lt;/xsl:for-each&gt;
              &lt;xsl:for-each select=&#34;$V22/Part&#34;&gt;
                &lt;xsl:variable name=&#34;V24&#34; select=&#34;.&#34;/&gt;
                &lt;xsl:for-each select=&#34;@Id&#34;&gt;
                  &lt;Part&gt;
                    &lt;xsl:for-each select=&#34;$V22/Description&#34;&gt;
                      &lt;xsl:attribute name=&#34;Description&#34;&gt;
                        &lt;xsl:value-of select=&#34;.&#34;/&gt;
                      &lt;/xsl:attribute&gt;
                    &lt;/xsl:for-each&gt;
                    &lt;xsl:for-each select=&#34;$V24/@UnitPrice&#34;&gt;
                      &lt;xsl:attribute name=&#34;UnitCost&#34;&gt;
                        &lt;xsl:value-of select=&#34;.&#34;/&gt;
                      &lt;/xsl:attribute&gt;
                    &lt;/xsl:for-each&gt;
                    &lt;xsl:value-of select=&#34;.&#34;/&gt;
                  &lt;/Part&gt;
                &lt;/xsl:for-each&gt;
              &lt;/xsl:for-each&gt;
              &lt;xsl:for-each select=&#34;$V22/Part&#34;&gt;
                &lt;xsl:for-each select=&#34;@Quantity&#34;&gt;
                  &lt;Quantity&gt;
                    &lt;xsl:value-of select=&#34;.&#34;/&gt;
                  &lt;/Quantity&gt;
                &lt;/xsl:for-each&gt;
              &lt;/xsl:for-each&gt;
            &lt;/LineItem&gt;
          &lt;/xsl:for-each&gt;
        &lt;/LineItems&gt;
      &lt;/xsl:for-each&gt;
    &lt;/PurchaseOrder&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB4701"></a><a id="ADXDB4702"></a><a id="ADXDB4703"></a><a id="ADXDB4699"></a><a id="ADXDB4700"></a><a id="ADXDB4698"></a>
<div class="props_rev_3"><a id="GUID-977E4919-1072-4A96-B03C-6576A7B98786"></a>
<h3 id="ADXDB-GUID-977E4919-1072-4A96-B03C-6576A7B98786" class="sect3"><span class="enumeration_section">20.2.6</span> Examples of Using Procedure COPYEVOLVE</h3>
<div>
<p>Several examples are presented of using PL/SQL procedure<code>DBMS_XMLSCHEMA.copyEvolve</code> to update an XML schema. (Be sure to back up all registered XML schemas and XML documents that reference them, before using the procedure.)</p>
<div class="section">
<p><a href="xdb07evo.htm#GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGBIBHG">Example 20-3</a> loads a revised XML schema and evolution XSL stylesheet into Oracle XML&nbsp;DB Repository.</p>
<p><a href="xdb07evo.htm#GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGFEAFB">Example 20-4</a> shows how to use procedure <code>DBMS_XMLSCHEMA.copyEvolve</code> to evolve the XML schema <code>purchaseOrder.xsd</code> to <code>revisedPurchaseOrder.xsd</code> using the XSLT stylesheet <code>evolvePurchaseOrder.xsl</code>.</p>
<p>Procedure <code>DBMS_XMLSCHEMA.copyEvolve</code> evolves registered XML schemas in such a way that existing instance documents continue to remain valid.</p>
<div class="infobox-note" id="GUID-977E4919-1072-4A96-B03C-6576A7B98786__GUID-F44084BE-2EB5-4245-BCD8-2661F498C13F">
<p class="notep1">Caution:</p>
<p>Before executing procedure <code>DBMS_XMLSCHEMA.copyEvolve</code>, always <span class="italic">back up</span> all registered XML schemas and all XML documents that conform to them. Procedure <code>copyEvolve</code> <span class="italic">deletes</span> all documents that conform to registered XML schemas.</p>
</div>
<p>First, procedure <code>copyEvolve</code> copies the data in XML schema-based <code>XMLType</code> tables and columns to temporary tables. It then drops the original tables and columns, and deletes the old XML schemas. After registering the new XML schemas, it creates <code>XMLType</code> tables and columns and populates them with data (unless parameter <code>GENTABLES</code> is <code>FALSE</code>) but it does not create any auxiliary structures such as indexes, constraints, triggers, and row-level security (RLS) policies. Procedure <code>copyEvolve</code> creates the tables and columns as follows:</p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>It creates default tables while registering the new schemas.</p>
</li>
<li>
<p>It creates tables that are not default tables using a statement of the following form:</p>
<pre dir="ltr">CREATE TABLE <span class="italic">table_name</span> OF XMLType OID &#39;<span class="italic">oid</span>&#39;
   XMLSCHEMA <span class="italic">schema_url</span> ELEMENT <span class="italic">element_name</span>
</pre>
<p>where <span class="italic"><code>OID</code></span> is the original OID of the table, before it was dropped.</p>
</li>
<li>
<p>It adds <code>XMLType</code> columns using a statement of the following form:</p>
<pre dir="ltr">ALTER TABLE <span class="italic">table_name</span> ADD (<span class="italic">column_name</span> XMLType) XMLType COLUMN
 <span class="italic">column_name</span> XMLSCHEMA <span class="italic">schema_url</span> ELEMENT <span class="italic">element_name</span>
</pre></li>
</ul>
<p>When a new XML schema is registered, types are generated if the registration of the corresponding old schema had generated types. If an XML schema was global before the evolution, then it is also global after the evolution. Similarly, if an XML schema was local before the evolution, then it is also local (owned by the same user) after the evolution. You have the option to preserve the temporary tables that contain the old documents, by setting parameter <code>preserveOldDocs</code> to <code>TRUE</code>. All temporary tables are created in the database schema of the current user. For <code>XMLType</code> tables, the temporary table has the columns shown in <a href="xdb07evo.htm#GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGDADHA" title="This table describes XML Schema evolution XMLType tables&rsquo; temporary table columns, including the column name and type.">Table 20-3</a>.</p>
<div class="tblformal" id="GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGDADHA">
<p class="titleintable">Table 20-3 XML Schema Evolution: XMLType Table Temporary Table Columns</p>
<table class="cellalignment3420" title="XML Schema Evolution: XMLType Table Temporary Table Columns " summary="This table describes XML Schema evolution XMLType tables&rsquo; temporary table columns, including the column name and type.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3518" id="d104231e1615">Name</th>
<th class="cellalignment3475" id="d104231e1618">Type</th>
<th class="cellalignment3502" id="d104231e1621">Comment</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1626" headers="d104231e1615">
<p><code>Data</code></p>
</td>
<td class="cellalignment3478" headers="d104231e1626 d104231e1618">
<p><code>CLOB</code></p>
</td>
<td class="cellalignment3504" headers="d104231e1626 d104231e1621">
<p>XML document from the old table, in <code>CLOB</code> format.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1641" headers="d104231e1615">
<p><code>OID</code></p>
</td>
<td class="cellalignment3478" headers="d104231e1641 d104231e1618">
<p><code>RAW(16)</code></p>
</td>
<td class="cellalignment3504" headers="d104231e1641 d104231e1621">
<p><code>OID</code> of the corresponding row in the old table.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1655" headers="d104231e1615">
<p><code>ACLOID</code></p>
</td>
<td class="cellalignment3478" headers="d104231e1655 d104231e1618">
<p><code>RAW(16)</code></p>
</td>
<td class="cellalignment3504" headers="d104231e1655 d104231e1621">
<p>This column is present only if the old table is hierarchy-enabled. <code>ACLOID</code> of corresponding row in old table.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1670" headers="d104231e1615">
<p><code>OWNERID</code></p>
</td>
<td class="cellalignment3478" headers="d104231e1670 d104231e1618">
<p><code>RAW(16)</code></p>
</td>
<td class="cellalignment3504" headers="d104231e1670 d104231e1621">
<p>This column is present only if old table is hierarchy-enabled. <code>OWNERID</code> of corresponding row in old table.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>For <code>XMLType</code> columns, the temporary table has the columns shown in <a href="xdb07evo.htm#GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGIJHAH" title="This table describes the XML schema evolution XMLType columns&rsquo; temporary table columns.">Table 20-4</a>.</p>
<div class="tblformal" id="GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGIJHAH">
<p class="titleintable">Table 20-4 XML Schema Evolution: XMLType Column Temporary Table Columns</p>
<table class="cellalignment3420" title="XML Schema Evolution: XMLType Column Temporary Table Columns" summary="This table describes the XML schema evolution XMLType columns&rsquo; temporary table columns.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3518" id="d104231e1705">Name</th>
<th class="cellalignment3475" id="d104231e1708">Type</th>
<th class="cellalignment3449" id="d104231e1711">Comment</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1716" headers="d104231e1705">
<p><code>Data</code></p>
</td>
<td class="cellalignment3478" headers="d104231e1716 d104231e1708">
<p><code>CLOB</code></p>
</td>
<td class="cellalignment3451" headers="d104231e1716 d104231e1711">
<p>XML document from the old column, in <code>CLOB</code> format.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1731" headers="d104231e1705">
<p><code>RID</code></p>
</td>
<td class="cellalignment3478" headers="d104231e1731 d104231e1708">
<p><code>ROWID</code></p>
</td>
<td class="cellalignment3451" headers="d104231e1731 d104231e1711">
<p><code>ROWID</code> of the corresponding row in the table containing this column.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>Procedure <code>copyEvolve</code> stores information about the mapping from the old table or column name to the corresponding temporary table name in a separate table specified by parameter <code>mapTabName</code>. If <code>preserveOldDocs</code> is <code>TRUE</code>, then the <code>mapTabName</code> parameter must not be <code>NULL</code>, and it must not be the name of any existing table in the current database schema. Each row in the mapping table has information about one of the old tables/columns. <a href="xdb07evo.htm#GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGJADCF" title="This table describes the mapping of the CopyEvolve procedure for XML schema evolution.">Table 20-5</a> shows the mapping table columns.</p>
<div class="tblformal" id="GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGJADCF">
<p class="titleintable">Table 20-5 Procedure COPYEVOLVE Mapping Table</p>
<table class="cellalignment3420" title="Procedure COPYEVOLVE Mapping Table " summary="This table describes the mapping of the CopyEvolve procedure for XML schema evolution.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3518" id="d104231e1781">Column Name</th>
<th class="cellalignment3492" id="d104231e1784">Column Type</th>
<th class="cellalignment3524" id="d104231e1787">Comment</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1792" headers="d104231e1781">
<p><code>SCHEMA_URL</code></p>
</td>
<td class="cellalignment3493" headers="d104231e1792 d104231e1784">
<p><code>VARCHAR2(700)</code></p>
</td>
<td class="cellalignment3525" headers="d104231e1792 d104231e1787">
<p>URL of the schema to which this table or column conforms.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1804" headers="d104231e1781">
<p><code>SCHEMA_OWNER</code></p>
</td>
<td class="cellalignment3493" headers="d104231e1804 d104231e1784">
<p><code>VARCHAR2(30)</code></p>
</td>
<td class="cellalignment3525" headers="d104231e1804 d104231e1787">
<p>Owner of the schema.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1816" headers="d104231e1781">
<p><code>ELEMENT_NAME</code></p>
</td>
<td class="cellalignment3493" headers="d104231e1816 d104231e1784">
<p><code>VARCHAR2(256)</code></p>
</td>
<td class="cellalignment3525" headers="d104231e1816 d104231e1787">
<p>Element to which this table or column conforms.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1828" headers="d104231e1781">
<p><code>TABLE_NAME</code></p>
</td>
<td class="cellalignment3493" headers="d104231e1828 d104231e1784">
<p><code>VARCHAR2(65)</code></p>
</td>
<td class="cellalignment3525" headers="d104231e1828 d104231e1787">
<p>Qualified name of the table (<code>&lt;owner_name&gt;.&lt;table_name&gt;</code>).</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1843" headers="d104231e1781">
<p><code>TABLE_OID</code></p>
</td>
<td class="cellalignment3493" headers="d104231e1843 d104231e1784">
<p><code>RAW(16)</code></p>
</td>
<td class="cellalignment3525" headers="d104231e1843 d104231e1787">
<p><code>OID</code> of table.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1857" headers="d104231e1781">
<p><code>COLUMN_NAME</code></p>
</td>
<td class="cellalignment3493" headers="d104231e1857 d104231e1784">
<p><code>VARCHAR2(4000)</code></p>
</td>
<td class="cellalignment3525" headers="d104231e1857 d104231e1787">
<p>Name of the column (<code>NULL</code> for <code>XMLType</code> tables).</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3520" id="d104231e1875" headers="d104231e1781">
<p><code>TEMP_TABNAME</code></p>
</td>
<td class="cellalignment3493" headers="d104231e1875 d104231e1784">
<p><code>VARCHAR2(30)</code></p>
</td>
<td class="cellalignment3525" headers="d104231e1875 d104231e1787">
<p>Name of temporary table that holds the data for this table or column.</p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p>You can avoid generating any tables or columns after registering the new XML schema by setting parameter <code>GENTABLES</code> to <code>FALSE</code>. If <code>GENTABLES</code> is <code>FALSE</code>, parameter <code>PRESERVEOLDDOCS</code> must be <code>TRUE</code> and parameter <code>MAPTABNAME</code> must not be <code>NULL</code>. This ensures that the data in the old tables is not lost. This is useful if you do not want the tables to be created by the procedure, as described in section <span class="q">&#34;<a href="xdb07evo.htm#GUID-8F38814C-56AE-4021-AF31-AB8A99342C47" title="The parameters of PL/SQL procedure DBMS_XMLSCHEMA.copyEvolve are described, as are the errors associated with this procedure.">COPYEVOLVE Parameters and Errors</a>&#34;</span>.</p>
<p>By default, it is assumed that all XML schemas are owned by the current user. If this is not true, then you must specify the owner of each XML schema in the <code>schemaOwners</code> parameter.</p>
<div class="infoboxnotealso" id="GUID-977E4919-1072-4A96-B03C-6576A7B98786__GUID-49F7BCE9-78FB-445B-85E3-281B578A33DB">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF01001" target="_blank" href="../SQLRF/statements_3001.htm#SQLRF01001"><span class="italic">Oracle Database SQL Language Reference</span></a> for the complete description of <code>ALTER TABLE</code></p>
</div>
</div>
<!-- class="section" -->
<div class="example" id="GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGBIBHG">
<p class="titleinexample">Example 20-3 Loading Revised XML Schema and XSLT Stylesheet</p>
<pre dir="ltr">DECLARE
  res BOOLEAN;
BEGIN
  res := DBMS_XDB_REPOS.createResource(         -- Load revised XML schema
           &#39;/source/schemas/poSource/revisedPurchaseOrder.xsd&#39;,
           bfilename(&#39;XMLDIR&#39;, &#39;revisedPurchaseOrder.xsd&#39;),
           nls_charset_id(&#39;AL32UTF8&#39;));
  res := DBMS_XDB_REPOS.createResource(         -- Load revised XSL stylesheet
           &#39;/source/schemas/poSource/evolvePurchaseOrder.xsl&#39;,
           bfilename(&#39;XMLDIR&#39;, &#39;evolvePurchaseOrder.xsl&#39;),
           nls_charset_id(&#39;AL32UTF8&#39;));
END;/
</pre></div>
<!-- class="example" -->
<div class="example" id="GUID-977E4919-1072-4A96-B03C-6576A7B98786__BCGFEAFB">
<p class="titleinexample">Example 20-4 Updating an XML Schema Using DBMS_XMLSCHEMA.COPYEVOLVE</p>
<pre dir="ltr">BEGIN
  DBMS_XMLSCHEMA.copyEvolve(
    xdb$string_list_t(&#39;http://localhost:8080/source/schemas/poSource/xsd/purchaseOrder.xsd&#39;),
    XMLSequenceType(XDBURIType(&#39;/source/schemas/poSource/revisedPurchaseOrder.xsd&#39;).getXML()),
    XMLSequenceType(XDBURIType(&#39;/source/schemas/poSource/evolvePurchaseOrder.xsl&#39;).getXML()));
END;
</pre>
<pre dir="ltr">SELECT XMLQuery(&#39;$p/PurchaseOrder/LineItems/LineItem[1]&#39;
                PASSING po.OBJECT_VALUE AS &#34;p&#34; RETURNING CONTENT) line_item
  FROM purchaseorder po
  WHERE XMLExists(&#39;$p/PurchaseOrder[Reference=&#34;SBELL-2003030912333601PDT&#34;]&#39;
                  PASSING po.OBJECT_VALUE AS &#34;p&#34;);
 
LINE_ITEM
------------------------------------------------------------------------------
&lt;LineItem ItemNumber=&#34;1&#34;&gt;
  <span class="bold">&lt;Part Description=&#34;A Night to Remember&#34; UnitCost=&#34;39.95&#34;&gt;715515009058&lt;/Part&gt;</span>
  <span class="bold">&lt;Quantity&gt;2&lt;/Quantity&gt;</span>
&lt;/LineItem&gt;
</pre>
<p>The same query would have produced the following result before the schema evolution:</p>
<pre dir="ltr">LINE_ITEM
----------------------------------------------------------
&lt;LineItem ItemNumber=&#34;1&#34;&gt;
  <span class="bold">&lt;Description&gt;A Night to Remember&lt;/Description&gt;</span>
  <span class="bold">&lt;Part Id=&#34;715515009058&#34; UnitPrice=&#34;39.95&#34; Quantity=&#34;2&#34;/&gt;</span>
&lt;/LineItem&gt;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
<a id="ADXDB0850"></a>
<div class="props_rev_3"><a id="GUID-0C97EA66-1890-495D-9117-55FB0D563992"></a>
<h2 id="ADXDB-GUID-0C97EA66-1890-495D-9117-55FB0D563992" class="sect2"><span class="enumeration_section">20.3</span> In-Place XML Schema Evolution</h2>
<div>
<p>In-place XML schema evolution makes changes to an XML schema without requiring that existing data be copied, deleted, and reinserted. In-place evolution is thus much faster than copy-based evolution. However, in-place evolution also has several restrictions that do not apply to copy-based evolution.</p>
<p>You use procedure <code>DBMS_XMLSCHEMA.inPlaceEvolve</code> to perform in-place evolution. Using this procedure, you identify the changes to be made to an existing XML schema by specifying an XML schema-differences document, and you optionally specify flags to be applied to the evolution process.</p>
<p>In-place evolution constructs a new version of an XML schema by applying changes specified in a <code>diffXML</code> document, validates that new XML schema (against the XML schema for XML schemas), constructs DDL statements to evolve the disk structures used to store the XML instance documents associated with the XML schema, executes these DDL statements, and replaces the old version of the XML schema with the new, in that order. If the new version of the XML schema is not a valid schema, then in-place evolution fails.</p>
</div>
<a id="ADXDB4704"></a>
<div class="props_rev_3"><a id="GUID-7532CECB-3F71-4E7A-A6C0-F603CDB9BAFB"></a>
<h3 id="ADXDB-GUID-7532CECB-3F71-4E7A-A6C0-F603CDB9BAFB" class="sect3"><span class="enumeration_section">20.3.1</span> Restrictions for In-Place XML Schema Evolution</h3>
<div>
<p>Because in-place XML schema evolution avoids copying data, it does not permit arbitrary changes to an XML schema. The primary restriction on using in-place evolution can be stated generally as a requirement that a given XML schema can be evolved in place in only a backward-compatible way.</p>
<p>For the complete list of changes supported by in-place evolution, see <span class="q">&#34;<a href="xdb07evo.htm#GUID-A58F605A-45D6-4159-9C2B-104DBE72673F" title="Some of the operations that are supported for in-place schema evolution are described. Some of these are not permitted in specific contexts, which are specified.">Supported Operations for In-Place XML Schema Evolution</a>&#34;</span>.</p>
<p><strong class="term">Backward-compatible</strong> here means that any possible instance document that would validate against a given XML schema must also validate against a later (evolved) version of that XML schema. This applies to <span class="italic">all possible</span> conforming instance documents, not only to <span class="italic">existing</span> instance documents For XML data that is stored as binary XML, backward compatibility also means that any XML schema annotations that affect binary XML treatment must not change during evolution. Backward compatibility is described further in section <span class="q">&#34;<a href="xdb07evo.htm#GUID-17B520D9-8711-4CC0-A122-D9F220E39B39" title="Restrictions on in-place XML schema evolution are described that ensure backward compatibility of an evolved schema, so that any possible instance documents that satisfy the old XML schema also satisfy the new one.">Backward-Compatibility Restrictions</a>&#34;</span>.</p>
<p>In addition to this general backward-compatibility restriction, there are some other restrictions for in-place evolution. These are described in section <span class="q">&#34;<a href="xdb07evo.htm#GUID-843D0864-84E5-414F-8315-4AB84FA978FF" title="Some restrictions on in-place XML schema evolution are necessary for reasons other than backward compatibility of the evolved XML schema.">Other Restrictions on In-Place Evolution</a>&#34;</span>.</p>
</div>
<a id="ADXDB4705"></a>
<div class="props_rev_3"><a id="GUID-17B520D9-8711-4CC0-A122-D9F220E39B39"></a>
<h4 id="ADXDB-GUID-17B520D9-8711-4CC0-A122-D9F220E39B39" class="sect4"><span class="enumeration_section">20.3.1.1</span> Backward-Compatibility Restrictions</h4>
<div>
<p>Restrictions on in-place XML schema evolution are described that ensure backward compatibility of an evolved schema, so that any possible instance documents that satisfy the old XML schema also satisfy the new one.</p>
</div>
<a id="ADXDB4707"></a><a id="ADXDB4706"></a>
<div class="props_rev_3"><a id="GUID-631A3DDB-8491-4070-93C4-B70097EFBF00"></a>
<h5 id="ADXDB-GUID-631A3DDB-8491-4070-93C4-B70097EFBF00" class="sect5"><span class="enumeration_section">20.3.1.1.1</span> Changes in Data Layout on Disk</h5>
<div>
<p>Certain changes to an XML schema alter the layout of the associated instance documents on disk, and are therefore not permitted. This situation is more common when the storage layer is tightly integrated with information derived from the XML schema, as is the case for object-relational storage.</p>
<p>One such example is an XML schema, registered for object-relational storage mapping, that is evolved by splitting a complex type into two complex types. In <a href="xdb07evo.htm#GUID-631A3DDB-8491-4070-93C4-B70097EFBF00__CHDDDEGA">Example 20-5</a>, complex type <code>ShippingInstructionsType</code> is split into two complex types, <code>Person-Name</code> and <code>Contact-Info</code>, and the <code>ShippingInstructionsType</code> complex type is deleted.</p>
<p>Even if this XML schema has no associated instance documents, and therefore no data copy is required, a change in the layout of existing tables is required to accommodate future instance documents.</p>
<div class="example" id="GUID-631A3DDB-8491-4070-93C4-B70097EFBF00__CHDDDEGA">
<p class="titleinexample">Example 20-5 Splitting a Complex Type into Two Complex Types</p>
<p>These code excerpts show the definitions of the original <code>ShippingInstructionsType</code> type and the new <code>Person</code><code>-Name</code> and <code>Contact-Info</code> types.</p>
<pre dir="ltr">&lt;complexType name=&#34;ShippingInstructionsType&#34;&gt; 
    &lt;sequence&gt; 
        &lt;element name=&#34;name&#34;   type=&#34;NameType&#34; minOccurs=&#34;0&#34;/&gt; 
        &lt;element name=&#34;address&#34; type=&#34;AddressType&#34; minOccurs=&#34;0&#34;/&gt; 
        &lt;element name=&#34;telephone&#34; type=&#34;TelephoneType&#34; minOccurs=&#34;0&#34;/&gt; 
    &lt;/sequence&gt; 
&lt;/complexType&gt; 
 
&lt;complexType name=&#34;Person-Name&#34;&gt; 
    &lt;sequence&gt; 
        &lt;element name=&#34;name&#34; type=&#34;NameType&#34; minOccurs=&#34;0&#34;/&gt; 
    &lt;/sequence&gt;
&lt;/complexType&gt;
 
&lt;complexType name=&#34;Contact-Info&#34;&gt;
    &lt;sequence&gt;
        &lt;element name=&#34;address&#34; type=&#34;AddressType&#34; minOccurs=&#34;0&#34;/&gt; 
        &lt;element name=&#34;telephone&#34; type=&#34;TelephoneType&#34; minOccurs=&#34;0&#34;/&gt; 
    &lt;/sequence&gt; 
&lt;/complexType&gt;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="ADXDB4708"></a>
<div class="props_rev_3"><a id="GUID-C806E9FD-2D1A-42CA-8961-516DC8326141"></a>
<h5 id="ADXDB-GUID-C806E9FD-2D1A-42CA-8961-516DC8326141" class="sect5"><span class="enumeration_section">20.3.1.1.2</span> Reorder of XML Schema Constructs</h5>
<div>
<p>You cannot use in-place evolution to reorder XML schema elements in a way that affects the DOM fidelity of XML instance documents. For example, you cannot change the order of elements within a <code>&lt;sequence&gt;</code> element in a complex type definition.</p>
<p>As an example, if a complex type named <code>ShippingInstructionsType</code> requires that its child elements <code>name</code>, <code>address</code>, and <code>telephone</code> be in that order, you cannot use in-place evolution to change the order to <code>name</code>, <code>telephone</code>, and <code>address</code>.</p>
</div>
</div>
<a id="ADXDB4709"></a>
<div class="props_rev_3"><a id="GUID-1ACC4849-6725-4806-B991-4A4114A07D67"></a>
<h5 id="ADXDB-GUID-1ACC4849-6725-4806-B991-4A4114A07D67" class="sect5"><span class="enumeration_section">20.3.1.1.3</span> Changes from a Collection to a Non-Collection</h5>
<div>
<p>You cannot use in-place evolution to change a collection to a non-collection. An example would be changing from <code>maxOccurs</code> greater than one to <code>maxOccurs</code> equal to one. In-place evolution thus cannot delete an element from a complex type if the deletion requires that a collection be evolved to a non-collection.</p>
</div>
</div>
<a id="ADXDB6002"></a>
<div class="props_rev_3"><a id="GUID-FDDFFC60-63AF-447D-B95C-EEFBCFA8D301"></a>
<h5 id="ADXDB-GUID-FDDFFC60-63AF-447D-B95C-EEFBCFA8D301" class="sect5"><span class="enumeration_section">20.3.1.1.4</span> Model Changes within a complexType Element</h5>
<div>
<p>A <strong class="term">model</strong> is a <code>group</code>, <code>choice</code>, <code>sequence</code>, or <code>all</code> element. Within a <code>complexType</code> element you cannot use in-place evolution to either add a new model or replace an existing model with a model of another type (for example, replace a <code>choice</code> element with a <code>sequence</code> element).</p>
<p>You can, however, add a global <code>group</code> element, that is, add a <code>group</code> element outside of a <code>complexType</code> element.</p>
</div>
</div>
</div>
<a id="ADXDB4710"></a>
<div class="props_rev_3"><a id="GUID-843D0864-84E5-414F-8315-4AB84FA978FF"></a>
<h4 id="ADXDB-GUID-843D0864-84E5-414F-8315-4AB84FA978FF" class="sect4"><span class="enumeration_section">20.3.1.2</span> Other Restrictions on In-Place Evolution</h4>
<div>
<p>Some restrictions on in-place XML schema evolution are necessary for reasons other than backward compatibility of the evolved XML schema.</p>
</div>
<a id="ADXDB4711"></a>
<div class="props_rev_3"><a id="GUID-E2E4E681-4C97-4DDA-9F1B-A055B23ED6AC"></a>
<h5 id="ADXDB-GUID-E2E4E681-4C97-4DDA-9F1B-A055B23ED6AC" class="sect5"><span class="enumeration_section">20.3.1.2.1</span> Changes to Attributes in Namespace xdb</h5>
<div>
<p>Except for attribute <code>xdb:defaultTable</code>, you cannot use in-place evolution to modify any attributes in namespace <code>http://xmlns.oracle.com/xdb</code> (which has the predefined prefix <code>xdb</code>).</p>
</div>
</div>
<a id="ADXDB4712"></a>
<div class="props_rev_3"><a id="GUID-DC55F317-E8AC-41D6-A66D-EF1249551F61"></a>
<h5 id="ADXDB-GUID-DC55F317-E8AC-41D6-A66D-EF1249551F61" class="sect5"><span class="enumeration_section">20.3.1.2.2</span> Changes from a Non-Collection to a Collection</h5>
<div>
<p>For object-relational <code>XMLType</code> data, you cannot use in-place evolution to change a non-collection object type to a collection object type. An example would be adding an element to a complex type if the element is already present in the type (or in a type related through inheritance).</p>
</div>
</div>
</div>
</div>
<a id="ADXDB4713"></a>
<div class="props_rev_3"><a id="GUID-A58F605A-45D6-4159-9C2B-104DBE72673F"></a>
<h3 id="ADXDB-GUID-A58F605A-45D6-4159-9C2B-104DBE72673F" class="sect3"><span class="enumeration_section">20.3.2</span> Supported Operations for In-Place XML Schema Evolution</h3>
<div>
<p>Some of the operations that are supported for in-place schema evolution are described. Some of these are not permitted in specific contexts, which are specified.</p>
<ul style="list-style-type: disc;">
<li>
<p>Add an optional element to a complex type or group: Always permitted. An example is the addition of the optional element <code>shipmethod</code> in the following complex type definition:</p>
<pre dir="ltr">&lt;xs:complexType name=&#34;ShippingInstructionsType&#34;&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name=&#34;name&#34; type=&#34;NameType&#34; minOccurs=&#34;0&#34;/&gt;
        &lt;xs:element name=&#34;address&#34; type=&#34;AddressType&#34; minOccurs=&#34;0&#34;/&gt;
        &lt;xs:element name=&#34;telephone&#34; type=&#34;TelephoneType&#34; minOccurs=&#34;0&#34;/&gt;
        <span class="bold">&lt;xs:element name = &#34;shipmethod&#34; type = &#34;xs:string&#34; minOccurs = &#34;0&#34;/&gt;</span>
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
</pre></li>
<li>
<p>Add an optional attribute to a complex type or attribute group: Always permitted. An example is the addition of the optional attribute <code>shipbydate</code> in the following complex type definition:</p>
<pre dir="ltr">&lt;xs:complexType name=&#34;ShippingInstructionsType&#34;&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name=&#34;name&#34; type=&#34;NameType&#34; minOccurs=&#34;0&#34;/&gt;
        &lt;xs:element name=&#34;address&#34; type=&#34;AddressType&#34; minOccurs=&#34;0&#34;/&gt;
        &lt;xs:element name=&#34;telephone&#34; type=&#34;TelephoneType&#34; minOccurs=&#34;0&#34;/&gt;
    &lt;/xs:sequence&gt;
    <span class="bold">&lt;xs:attribute name=&#34;shipbydate&#34; type=&#34;DateType&#34; use=&#34;optional&#34;/&gt;</span>
&lt;/xs:complexType&gt;
</pre></li>
<li>
<p>Convert an element from simple type to complex type with simple content: Supported only if the storage model is binary XML.</p>
</li>
<li>
<p>Modify the value attribute of an existing maxLength element: Always permitted. The value can only be increased, not decreased.</p>
</li>
<li>
<p>Add an enumeration value: You can add a new enumeration value only to the end of an enumeration list.</p>
</li>
<li>
<p>Add a global element: Always permitted. An example is the addition of the global element <code>PurchaseOrderComment</code> in the following schema definition:</p>
<pre dir="ltr">&lt;xs:schema ...&gt; 
... 
    <span class="bold">&lt;xs:element name=&#34;PurchaseOrderComment&#34; type=&#34;string&#34; xdb:defaultTable=&#34;&#34;/&gt;</span> 
.. 
&lt;/xs:schema&gt;
</pre></li>
<li>
<p>Add a global attribute: Always permitted.</p>
</li>
<li>
<p>Add or delete a global complex type: Always permitted. An example is the addition of the global complex type <code>ComplexAddressType</code> in the following schema definition:</p>
<pre dir="ltr">&lt;xs:schema ...&gt; 
.... 
    <span class="bold">&lt;xs:complexType name=&#34;ComplexAddressType&#34;&gt;</span> 
        <span class="bold">&lt;xs:sequence&gt;</span> 
            <span class="bold">&lt;xs:element name=&#34;street&#34; type=&#34;string&#34;/&gt;</span> 
            <span class="bold">&lt;xs:element name=&#34;city&#34; type=&#34;string&#34;/&gt;</span> 
            <span class="bold">&lt;xs:element ref=&#34;zip&#34; type=&#34;positiveInteger&#34;/&gt;</span> 
            <span class="bold">&lt;xs:element name=&#34;country&#34;  type=&#34;string&#34;/&gt;</span> 
        <span class="bold">&lt;/xs:sequence&gt;</span> 
     <span class="bold">&lt;/xs:complexType&gt;</span> 
... 
&lt;/xs:schema&gt;
</pre></li>
<li>
<p>Add or delete a global simple type: Always permitted.</p>
</li>
<li>
<p>Change the <code>minOccurs</code> attribute value: The value of <code>minOccurs</code> can only be decreased.</p>
</li>
<li>
<p>Change the <code>maxOccurs</code> attribute value: The value of <code>maxOccurs</code> can only be increased, and this is only possible for data stored as binary XML. That is, you cannot make any change to the <code>maxOccurs</code> attribute for data stored object-relationally.</p>
</li>
<li>
<p>Add or delete a global group or <code>attributeGroup</code>: Always permitted. An example is the addition of an <code>Instructions</code> group in the following type definition:</p>
<pre dir="ltr">&lt;xsd:schema ...&gt; 
... 
  <span class="bold">&lt;xsd:group name=&#34;Instructions&#34;&gt;</span> 
    <span class="bold">&lt;xsd:sequence&gt;</span> 
     <span class="bold">&lt;xsd:element name=&#34;ShippingInstructions&#34; type=&#34;ShippingInstructionsType&#34;/&gt;</span> 
     <span class="bold">&lt;xsd:element name=&#34;SpecialInstructions&#34; type=&#34; SpecialInstructionsType&#34;/&gt;</span> 
    <span class="bold">&lt;/xsd:sequence&gt;</span> 
  <span class="bold">&lt;/xsd:group&gt;</span> 
... 
&lt;/xsd:schema&gt;
</pre></li>
<li>
<p>Change the xdb:defaultTable attribute value: Always permitted. Changes are <span class="italic">not</span> permitted to any other attributes in the <code>xdb</code> namespace.</p>
</li>
<li>
<p>Add, modify, or delete a comment or processing instruction: Always permitted.</p>
</li>
</ul>
</div>
</div>
<a id="ADXDB4714"></a>
<div class="props_rev_3"><a id="GUID-81D1FF2B-D820-47D4-BCC2-543FAC05541C"></a>
<h3 id="ADXDB-GUID-81D1FF2B-D820-47D4-BCC2-543FAC05541C" class="sect3"><span class="enumeration_section">20.3.3</span> Guidelines for Using In-Place XML Schema Evolution</h3>
<div>
<p>Guidelines that apply to in-place XML-schema evolution are presented. (Be sure to back up your data before performing in-place schema evolution.)</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">Before</span> you perform an in-place XML-schema evolution:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic">Back up all existing data</span> (instance documents) for the XML schema to be evolved.</p>
<div class="infobox-note" id="GUID-81D1FF2B-D820-47D4-BCC2-543FAC05541C__GUID-BB7E8076-CAE6-4F69-B9ED-DBB2949B97D1">
<p class="notep1">Caution:</p>
<p>Make sure that you back up your data before performing in-place XML schema evolution, in case the result is not what you intended. There is <span class="italic">no rollback</span> possible after an in-place evolution. If any errors occur during evolution, or if you make a major mistake and need to redo the entire operation, you must be able to go back to the backup copy of your original data.</p>
</div>
</li>
<li>
<p><span class="italic">Perform a dry run</span> using trace only, that is, without actually evolving the XML schema or updating any instance documents, produce a trace of the update operations that would be performed during evolution. To do this, set the <code>flag</code> parameter value to only <code>INPLACE_TRACE</code>. Do not also use <code>INPLACE_EVOLVE</code>.</p>
<p>After performing the dry run, examine the trace file, verifying that the listed DDL operations are in fact those that you intend.</p>
</li>
</ul>
</li>
<li>
<p><span class="italic">After</span> you perform an in-place XML-schema evolution:</p>
<p>If you are accessing the database using a client that caches data, or if you are not sure whether this is the case, then <span class="italic">restart your client</span>. Otherwise, the pre-evolution version of the XML schema might continue to be used locally, with unpredictable results.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-81D1FF2B-D820-47D4-BCC2-543FAC05541C__GUID-7F56A972-5D6D-4BBA-8093-FE1CEA8347A1">
<p class="notep1">See Also:</p>
<p><a class="olink ADMIN11263" target="_blank" href="../ADMIN/diag.htm#ADMIN11263"><span class="italic">Oracle Database Administrator&#39;s Guide</span></a> for information about using trace files</p>
</div>
</div>
</div>
<a id="ADXDB4716"></a><a id="ADXDB4715"></a>
<div class="props_rev_3"><a id="GUID-B67CE8DE-8D9E-4221-995F-2065A4DE2F03"></a>
<h3 id="ADXDB-GUID-B67CE8DE-8D9E-4221-995F-2065A4DE2F03" class="sect3"><span class="enumeration_section">20.3.4</span> inPlaceEvolve Parameters</h3>
<div>
<p>The parameters of PL/SQL procedure <code>DBMS_XMLSCHEMA.inPlaceEvolve</code> are described, as are the errors associated with this procedure.</p>
<div class="section">
<p>This is the signature of procedure <code>DBMS_XMLSCHEMA.inPlaceEvolve</code>:</p>
<pre dir="ltr">procedure inPlaceEvolve(schemaURL IN VARCHAR2,
                        diffXML   IN XMLType, 
                        flags     IN NUMBER);
</pre>
<p><a href="xdb07evo.htm#GUID-B67CE8DE-8D9E-4221-995F-2065A4DE2F03__BCGHFHEI" title="This table describes the DBMS_XMLSCHEMA.InPlaceEvolve parameters.">Table 20-6</a> describes the individual parameters.</p>
</div>
<!-- class="section" -->
<div class="tblformal" id="GUID-B67CE8DE-8D9E-4221-995F-2065A4DE2F03__BCGHFHEI">
<p class="titleintable">Table 20-6 Parameters of Procedure DBMS_XMLSCHEMA.INPLACEEVOLVE</p>
<table class="cellalignment3420" title="Parameters of Procedure DBMS_XMLSCHEMA.INPLACEEVOLVE" summary="This table describes the DBMS_XMLSCHEMA.InPlaceEvolve parameters.">
<thead>
<tr class="cellalignment3411">
<th class="cellalignment3436" id="d104231e2673">Parameter</th>
<th class="cellalignment3437" id="d104231e2676">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment3411">
<td class="cellalignment3438" id="d104231e2681" headers="d104231e2673">
<p><code>schemaURL</code></p>
</td>
<td class="cellalignment3439" headers="d104231e2681 d104231e2676">
<p>URL of the XML schema to be evolved (<code>VARCHAR2)</code>.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3438" id="d104231e2692" headers="d104231e2673">
<p><code>diffXML</code></p>
</td>
<td class="cellalignment3439" headers="d104231e2692 d104231e2676">
<p>XML document (<code>XMLType</code> instance) that conforms to the <code>xdiff</code> XML schema, and that specifies the changes to apply and the locations in the XML schema where the changes are to be applied. For information about how to create the document for this parameter, see <span class="q">&#34; <a href="xdb07evo.htm#GUID-4517E8F7-3ADB-464F-9744-189785466F7F" title="The value of parameter diffXML of procedure DBMS_XMLSCHEMA.inPlaceEvolve is an XMLType instance that specifies the changes to be applied to an XML schema for in-place evolution. This diffXML document contains a sequence of operations that describe the changes between the old XML schema and the new (the intended evolution result).">The diffXML Parameter Document</a>&#34;</span>.</p>
</td>
</tr>
<tr class="cellalignment3411">
<td class="cellalignment3438" id="d104231e2726" headers="d104231e2673">
<p><code>flags</code></p>
</td>
<td class="cellalignment3439" headers="d104231e2726 d104231e2676">
<p>A bit mask that controls the behavior of the procedure. You can set the following bit values in this mask independently, summing them to define the overall effect. The default <code>flags</code> value is 1 (bit 1 on, bit 2 off), meaning that in-place evolution is performed and no trace is written.</p>
<ul style="list-style-type: disc;">
<li>
<p><code>INPLACE_EVOLVE</code> (value 1, meaning that bit 1 is on) &ndash; Perform in-place XML schema evolution. Construct a new XML schema and validate it (against the XML schema for XML schemas). Construct the DDL statements needed to evolve the instance-document disk structures. Execute the DDL statements. Replace the old XML schema with the new.</p>
</li>
<li>
<p><code>INPLACE_TRACE</code> (value 2, meaning that bit 2 is on) &ndash; Perform all steps necessary for in-place evolution, <span class="italic">except</span> executing the DDL statements and overwriting the old XML schema with the new, then write both the DDL statements and the new XML schema to a trace file.</p>
</li>
</ul>
<p>That is, each of the bits constructs the new XML schema, validates it, and determines the steps needed to evolve the disk structures underlying the instance documents. In addition:</p>
<ul style="list-style-type: disc;">
<li>
<p>Bit <code>INPLACE_EVOLVE</code> carries out those evolution steps and replaces the old XML schema with the new.</p>
</li>
<li>
<p>Bit <code>INPLACE_TRACE</code> saves the evolution steps and the new XML schema in a trace file (it does not carry out the evolution steps).</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="section">
<p>Procedure <code>DBMS_XMLSCHEMA.inPlaceEvolve</code> raises an error in the following cases:</p>
<ul style="list-style-type: disc;">
<li>
<p>An XPath expression is invalid, or is syntactically correct but does not target a node in the XML schema.</p>
</li>
<li>
<p>The <code>diffXML</code> document does not conform to the <code>xdiff</code> XML schema.</p>
</li>
<li>
<p>The change makes the XML schema invalid or not well formed.</p>
</li>
<li>
<p>A generated DDL statement (<code>CREATE TYPE</code>, <code>ALTER TYPE</code>, and so on) causes a problem when it is executed.</p>
</li>
<li>
<p>An index object associated with an <code>XMLType</code> table is in an unsafe state, which could be caused by partition management operations.</p>
</li>
</ul>
</div>
<!-- class="section" --></div>
</div>
<a id="ADXDB4717"></a>
<div class="props_rev_3"><a id="GUID-4517E8F7-3ADB-464F-9744-189785466F7F"></a>
<h3 id="ADXDB-GUID-4517E8F7-3ADB-464F-9744-189785466F7F" class="sect3"><span class="enumeration_section">20.3.5</span> The diffXML Parameter Document</h3>
<div>
<p>The value of parameter <code>diffXML</code> of procedure <code>DBMS_XMLSCHEMA.inPlaceEvolve</code> is an <code>XMLType</code> instance that specifies the changes to be applied to an XML schema for in-place evolution. This <code>diffXML</code> document contains a sequence of operations that describe the changes between the old XML schema and the new (the intended evolution result).</p>
<p>The changes specified by the <code>diffXML</code> document are applied in order.</p>
<p>You must create the XML document to be used for the <code>diffXML</code> parameter You can do this in any of the following ways:</p>
<ul style="list-style-type: disc;">
<li>
<p>The <code>XMLDiff</code> JavaBean (<code>oracle.xml.differ.XMLDiff</code>)</p>
</li>
<li>
<p>The <code>xmldiff</code> command-line utility</p>
</li>
<li>
<p>SQL function <code>XMLDiff</code></p>
</li>
</ul>
<p>The <code>diffXML</code> parameter document must conform to the <code>xdiff</code> XML schema.</p>
<p>The rest of this section presents examples of some operations in a document that conforms to the <code>xdiff</code> XML schema.</p>
<div class="infoboxnotealso" id="GUID-4517E8F7-3ADB-464F-9744-189785466F7F__GUID-EAAF0640-80D5-4CD7-9B59-14D52A785DC7">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="q">&#34;<a href="apphxdb.htm#GUID-F3A101B3-A943-4CBC-8AE7-243B76ECFEBD" title="A full listing is presented of xdiff.xsd, the Oracle XML&nbsp;DB-supplied XML schema to which the document specified as the diffXML parameter to procedure DBMS_XMLSCHEMA.inPlaceEvolve must conform.">xdiff.xsd: XML Schema for Comparing Schemas for In-Place Evolution</a>&#34;</span></p>
</li>
<li>
<p><a class="olink ADXDK246" target="_blank" href="../ADXDK/adx_j_beans_ap.htm#ADXDK246"><span class="italic">Oracle XML Developer&#39;s Kit Programmer&#39;s Guide</span></a> for information on using the <code>XMLDiff</code> JavaBean</p>
</li>
<li>
<p><a class="olink ADXDK2540" target="_blank" href="../ADXDK/adx_c_diff.htm#ADXDK2540"><span class="italic">Oracle XML Developer&#39;s Kit Programmer&#39;s Guide</span></a> for information on command-line utility <code>xmldiff</code></p>
</li>
<li>
<p><a class="olink SQLRF20025" target="_blank" href="../SQLRF/functions257.htm#SQLRF20025"><span class="italic">Oracle Database SQL Language Reference</span></a> for information on SQL function <code>XMLDiff</code></p>
</li>
</ul>
</div>
</div>
<a id="ADXDB4719"></a><a id="ADXDB4718"></a>
<div class="props_rev_3"><a id="GUID-A40016C6-9610-40D2-8A34-6437ABCAEA0C"></a>
<h4 id="ADXDB-GUID-A40016C6-9610-40D2-8A34-6437ABCAEA0C" class="sect4"><span class="enumeration_section">20.3.5.1</span> diffXML Operations and Examples</h4>
<div>
<p>Operations that can be specified in the <code>diffXML</code> document supplied to procedure <code>DBMS_XMLSCHEMA.inPlaceEvolve</code> are described. An example XML document that conforms to the <code>xdiff</code> XML schema is shown.</p>
<p>The <code>&lt;append-node&gt;</code> element is used for most of the supported changes, such as adding a new attribute to a complex type or appending a new element to a group.</p>
<p>The <code>&lt;insert-node-before&gt;</code> element specifies that a node of the given type should be inserted before the specified node. The <code>xpath</code> attribute specifies the location of the specified node and the <code>node-type</code> attribute specifies the type of node to be inserted. The node to be inserted is specified by the <code>&lt;content&gt;</code> child element. The <code>&lt;insert-node-before&gt;</code> element is mainly used for inserting comments and processing instructions, and for changing and adding add annotation elements.</p>
<p>The <code>&lt;delete-node&gt;</code> element specifies that the node with the given XPath (specified by the <code>xpath</code> attribute) should be deleted along with all its children. For example, you can use this element to delete comments and annotation elements. You can also use this element, in conjunction with <code>&lt;append-node&gt;</code> or <code>&lt;insert-node-before&gt;</code>, to make changes to an existing node.</p>
<p><a href="xdb07evo.htm#GUID-A40016C6-9610-40D2-8A34-6437ABCAEA0C__BCGBHCDH">Example 20-6</a> shows an XML document for the <code>diffXML</code> parameter that specifies the following changes:</p>
<ul style="list-style-type: disc;">
<li>
<p>Delete complex type <code>PartType</code>.</p>
</li>
<li>
<p>Add complex type <code>PartType</code> with a maximum length of 28.</p>
</li>
<li>
<p>Add a comment before element <code>ShippingInstructions</code>.</p>
</li>
<li>
<p>Add a required element <code>shipmethod</code> to element <code>ShippingInstructions</code>.</p>
</li>
</ul>
<div class="example" id="GUID-A40016C6-9610-40D2-8A34-6437ABCAEA0C__BCGBHCDH">
<p class="titleinexample">Example 20-6 diffXML Parameter Document</p>
<pre dir="ltr">&lt;xd:xdiff  xmlns=&#34;http://www.w3c.org/2001/XMLSchema&#34; 
           xmlns:xd=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd&#34; 
           xmlns:xsi=&#34;http://www.w3c.org/2001/XMLSchema-Instance&#34; 
           xsi:schemaLocation=&#34;http://xmlns.oracle.com/xdb/xdiff.xsd
           http://xmlns.oracle.com/xdb/xdiff.xsd&#34;&gt; 
 &lt;xd:delete-node xpath=&#34;/schema/complexType[@name=&amp;quote;PartType&amp;quote;]//maxLength/&gt; 
 &lt;xd:append-node
  parent-xpath = &#34;/schema/complexType[@name=&amp;quote;PartType&amp;quote;]//restriction&#34;
  node-type = &#34;element&#34;&gt; 
  &lt;xd:content&gt; 
    &lt;xs:maxLength value = &#34;28&#34;/&gt;
  &lt;/xd:content&gt; 
 &lt;/xd:append-node&gt; 
 &lt;xd:insert-node-before 
  xpath=&#34;/schema/complexType[@name =&amp;quote;ShippingInstructionsType&amp;quote;]/sequence&#34; 
  node-type=&#34;comment&#34;&gt; 
  &lt;xd:content&gt; 
    &lt;!-- A type representing instructions for shipping --&gt; 
  &lt;/xd:content&gt; 
 &lt;/xd:insert-node-before&gt; 
 &lt;xd:append-node 
  parent-xpath=&#34;/schema/complexType[@name=&amp;quote;ShippingInstructionsType&amp;quote;]/sequence&#34; 
  node-type=&#34;element&#34;&gt; 
  &lt;xd:content&gt; 
   &lt;xs:element name = &#34;shipmethod&#34; type = &#34;xs:string&#34; minOccurs = &#34;1&#34;/&gt; 
  &lt;/xd:content&gt; 
 &lt;/xd:append-node&gt; 
&lt;/xd:xdiff&gt;
</pre></div>
<!-- class="example" --></div>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment3410">
<tr>
<td class="cellalignment3417">
<table class="cellalignment3415">
<tr>
<td class="cellalignment3414"><a href="xdb_rewrite.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment3414"><a href="partpg5.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2016, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment3419">
<table class="cellalignment3413">
<tr>
<td class="cellalignment3414"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment3414"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment3414"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment3414"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment3414"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment3414"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>