<!DOCTYPE html><html lang="en-US"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="UTF-8"/>
<a class="dashingAutolink" name="autolink-5279"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Managing%20Security%20for%20Definer%27s%20Rights%20and%C2%A0Invoker%27s%20Rights"></a><title>Managing Security for Definer&#39;s Rights and&nbsp;Invoker&#39;s Rights</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"/>
<meta name="keywords" content="invoker&rsquo;s rights, compared with definer&rsquo;s rights, definer&rsquo;s rights, compared with invoker&rsquo;s rights, procedure privileges, used with, about, security, procedures enhance, procedures, security enhanced by, example of when to use, schema privileges for, procedure security, about, triggers, privileges for executing, privileges, trigger privileges, controlled step-in, controlled step-in procedures, security risk, security risks, invoker&rsquo;s rights procedures, INHERIT PRIVILEGES privilege, INHERIT ANY PRIVILEGES privilege, ORA-06598 error, errors, ORA-06598, when it should be granted, revoking from powerful users, auditing, INHERIT PRIVILEGE privilege, managing, views, SYS_CONTEXT function, used in views, USERENV function, finding user who invoked invoker&rsquo;s right view, code based access control, code based access control (CBAC), how code based access control works, how works with invoker&rsquo;s rights, how works with definers rights, CDBs, CBAC role grants with DELEGATE option, granting and revoking roles to program unit, roles, granting and revoking to program units, tutorials, invoker&rsquo;s rights procedure using CBAC, tutorial"/>
<meta name="dcterms.created" content="2017-06-05T11:20:26Z"/>
<meta name="robots" content="all"/>
<meta name="dcterms.title" content="Database Security Guide"/>
<meta name="dcterms.identifier" content="E48135-19"/>
<meta name="dcterms.isVersionOf" content="DBSEG"/>
<meta name="dcterms.rights" content="Copyright&nbsp;&copy;&nbsp;2006, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved."/>
<link rel="Start" href="../index.htm" title="Home" type="text/html"/>
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html"/>

<script type="application/javascript" src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript" src="../nav/js/doccd.js" charset="UTF-8"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html"/>
<link rel="Index" href="index.htm" title="Index" type="text/html"/>
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html"/>
<link rel="Prev" href="authorization.htm" title="Previous" type="text/html"/>
<link rel="Next" href="fine_grained_access.htm" title="Next" type="text/html"/>
<link rel="alternate" href="E48135-19.pdf" title="PDF version" type="application/pdf"/>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/"/>
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/header.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/footer.css"/>
<link rel="stylesheet" type="text/css" href="../dcommon/css/fonts.css"/>
<link rel="stylesheet" href="../dcommon/css/foundation.css"/>
<link rel="stylesheet" href="../dcommon/css/codemirror.css"/>
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css"/>
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css"/>
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="/s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen"/>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
</head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a><header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-EF625176-A3AA-47F5-BAEE-248DBAAF22A3"></a> <span id="PAGE" style="display:none;">11/44</span> <!-- End Header -->
<a id="DBSEG658"></a>
<h1 id="DBSEG-GUID-EF625176-A3AA-47F5-BAEE-248DBAAF22A3" class="sect1"><span class="enumeration_chapter">5</span> Managing Security for Definer&#39;s Rights and&nbsp;Invoker&#39;s Rights</h1>
<div>
<p>Invoker&rsquo;s rights and definer&rsquo;s rights have several security advantages when used to control access to privileges to run user-created procedures.</p>
<p>Topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-18B223A9-223B-4625-AADE-4E47A56A5E9D" title="Definer&#39;s rights and invoker&#39;s rights are used to control access to the privileges necessary to run a user-created procedure, or program unit.">About Definer&#39;s Rights and Invoker&#39;s Rights</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-5ECAD7B4-BF99-4A36-B770-2132A43ED5A5" title="The owner of a procedure, called the definer, must have the necessary object privileges for objects that the procedure references.">How Procedure Privileges Affect Definer&#39;s Rights</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-74D3BC6B-1371-4AA8-B7E7-ECB84394B9D4" title="An invoker&rsquo;s rights procedure executes with all of the invoker&#39;s privileges.">How Procedure Privileges Affect Invoker&#39;s Rights</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-547A6A16-51AA-4FD9-BDB9-0D8A79B8CF24" title="Oracle recommends that you create invoker&#39;s rights procedures in certain situations.">When You Should Create Invoker&#39;s Rights Procedures</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-4DEF8C03-0DCA-4B72-9EEC-F1141E076A2F" title="You can use the INHERIT PRIVILEGES and INHERIT ANY PRIVILEGES privileges to regulate the privileges used when invoker&#39;s rights procedures are run.">Controlling Invoker&#39;s Rights Privileges for Procedure Calls and View Access</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-2897C310-D0B5-4AB0-8237-384196C4EC81" title="You can use the BEQEATH clause in the CREATE VIEW SQL statement to control definer&#39;s rights and invoker&#39;s rights in user-created views.">Definer&#39;s Rights and Invoker&#39;s Rights in Views</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-45E77E8E-587F-42AF-A163-D814264341E2" title="You can use code based access control to attach database roles to a PL/SQL function, procedure, or package. This functionality works well with invoker&#39;s rights and definer&#39;s program units.">Using Code Based Access Control for Definer&#39;s Rights and Invoker&#39;s Rights</a></p>
</li>
</ul>
</div>
<a id="DBSEG659"></a>
<div class="props_rev_3"><a id="GUID-18B223A9-223B-4625-AADE-4E47A56A5E9D"></a>
<h2 id="DBSEG-GUID-18B223A9-223B-4625-AADE-4E47A56A5E9D" class="sect2">About Definer&#39;s Rights and Invoker&#39;s Rights</h2>
<div>
<p>Definer&#39;s rights and invoker&#39;s rights are used to control access to the privileges necessary to run a user-created procedure, or program unit.</p>
<p>In a <a href="glossary.htm#GUID-87141F4A-F49D-4C0E-8229-B9943FFC7FA4"><span class="xrefglossterm">definer&#39;s rights procedure</span></a>, the procedure executes with the privileges of the owner. The privileges are bound to the schema in which they were created. An <a href="glossary.htm#GUID-68637D3F-FA77-453D-962B-172202ACC23C"><span class="xrefglossterm">invoker&#39;s rights procedure</span></a> executes with the privileges of the current user, that is, the user who invokes the procedure.</p>
<p>For example, suppose user <code class="codeph">bixby</code> creates a procedure that is designed to modify table <code class="codeph">cust_records</code> and then he grants the <code class="codeph">EXECUTE</code> privilege on this procedure to user <code class="codeph">rlayton</code>. If <code class="codeph">bixby</code> had created the procedure with definer&#39;s rights, then the procedure would look for table <code class="codeph">cust_records</code> in <code class="codeph">bixby</code>&#39;s schema. Had the procedure been created with invoker&#39;s rights, then when <code class="codeph">rlayton</code> runs it, the procedure would look for table <code class="codeph">cust_records</code> in <code class="codeph">rlayton</code>&#39;s schema.</p>
<p>By default, all procedures are considered definer&#39;s rights. You can designate a procedure to be an invoker&#39;s rights procedure by using the <code class="codeph">AUTHID CURRENT_USER</code> clause when you create or modify it, or you can use the <code class="codeph">AUTHID DEFINER</code> clause to make it a definer&#39;s rights procedure.</p>
<div class="infoboxnotealso" id="GUID-18B223A9-223B-4625-AADE-4E47A56A5E9D__GUID-7B55F5B6-0DE6-4F7B-8890-322927081A87">
<p class="notep1">See Also:</p>
<p><a class="olink LNPLS00809" target="_blank" href="../LNPLS/subprograms.htm#LNPLS00809"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for more details about definer&#39;s rights and invoker&#39;s rights procedures</p>
</div>
</div>
</div>
<a id="DBSEG99925"></a>
<div class="props_rev_3"><a id="GUID-5ECAD7B4-BF99-4A36-B770-2132A43ED5A5"></a>
<h2 id="DBSEG-GUID-5ECAD7B4-BF99-4A36-B770-2132A43ED5A5" class="sect2">How Procedure Privileges Affect Definer&#39;s Rights</h2>
<div>
<p>The owner of a procedure, called the <span class="italic">definer</span>, must have the necessary object privileges for objects that the procedure references.</p>
<p>If the procedure owner grants to another user the right to use the procedure, then the privileges of the procedure owner (on the objects the procedure references) apply to the grantee&#39;s exercise of the procedure. The privileges of the procedure&#39;s definer must be granted directly to the procedure owner, not granted through roles. These are called definer&#39;s rights.</p>
<p>The user of a procedure who is not its owner is called the <span class="italic">invoker</span>. Additional privileges on referenced objects are required for an <a href="glossary.htm#GUID-68637D3F-FA77-453D-962B-172202ACC23C"><span class="xrefglossterm">invoker&#39;s rights procedure</span></a>, but not for a <a href="glossary.htm#GUID-87141F4A-F49D-4C0E-8229-B9943FFC7FA4"><span class="xrefglossterm">definer&#39;s rights procedure</span></a>.</p>
<p>A user of a definer&#39;s rights procedure requires only the privilege to execute the procedure and no privileges on the underlying objects that the procedure accesses. This is because a definer&#39;s rights procedure operates under the security domain of the user who owns the procedure, regardless of who is executing it. The owner of the procedure must have all the necessary object privileges for referenced objects. Fewer privileges need to be granted to users of a definer&#39;s rights procedure. This results in stronger control of database access.</p>
<p>You can use definer&#39;s rights procedures to control access to private database objects and add a level of database security. By writing a definer&#39;s rights procedure and granting only the <code class="codeph">EXECUTE</code> privilege to a user, this user can be forced to access the referenced objects only through the procedure.</p>
<p>At run time, Oracle Database checks whether the privileges of the owner of a definer&#39;s rights procedure allow access to that procedure&#39;s referenced objects, before the procedure is executed. If a necessary privilege on a referenced object was revoked from the owner of a definer&#39;s rights procedure, then no user, including the owner, can run the procedure.</p>
<p>An example of when you may want to use a definer&#39;s rights procedure is as follows: Suppose that you must create an API whose procedures have unrestricted access to its tables, but you want to prevent ordinary users from selecting table data directly, and from changing it with <code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, and <code class="codeph">DELETE</code> statements. To accomplish this, in a separate, low-privileged schema, create the tables and the procedures that comprise the API. By default, each procedure is a definer&#39;s rights unit, so you do not need to specify <code class="codeph">AUTHID DEFINER</code> when you create it. Then grant the <code class="codeph">EXECUTE</code> privilege to the users who must use this API, but do not grant any privileges that allow data access. This solution gives you complete control over your API behavior and how users have access to its underlying objects.</p>
<p>Oracle recommends that you create your definer&#39;s rights procedures, and views that access these procedures, in their own schema. Grant this schema very low privileges, or no privileges at all. This way, when other users run these procedures or views, they will not have access to any unnecessarily high privileges from this schema.</p>
<div class="infobox-note" id="GUID-5ECAD7B4-BF99-4A36-B770-2132A43ED5A5__GUID-C29D430B-6314-4ECF-865F-D7B59EFE91F9">
<p class="notep1">Note:</p>
<p>Trigger processing follows the same patterns as definer&#39;s rights procedures. The user runs a SQL statement, which that user is privileged to run. As a result of the SQL statement, a trigger is fired. The statements within the triggered action temporarily execute under the security domain of the user that owns the trigger. For more information, see &#34;Overview of Triggers&#34; in <a class="olink CNCPT118" target="_blank" href="../CNCPT/srvrside.htm#CNCPT118"><span><cite>Oracle Database Concepts</cite></span></a>.</p>
</div>
<div class="infoboxnotealso" id="GUID-5ECAD7B4-BF99-4A36-B770-2132A43ED5A5__GUID-3A74DB9B-5512-4F8B-9B93-8C99D1B6766C">
<p class="notep1">See Also:</p>
<p><a href="authorization.htm#GUID-5C57B842-AF82-4462-88E9-5E9E8FD59874" title="The use of roles in a PL/SQL block depends on whether it is an anonymous block or a named block (stored procedure, function, or trigger), and whether it executes with definer&#39;s rights or invoker&#39;s rights.">How Roles Work in PL/SQL Blocks</a></p>
</div>
</div>
</div>
<a id="DBSEG99926"></a>
<div class="props_rev_3"><a id="GUID-74D3BC6B-1371-4AA8-B7E7-ECB84394B9D4"></a>
<h2 id="DBSEG-GUID-74D3BC6B-1371-4AA8-B7E7-ECB84394B9D4" class="sect2">How Procedure Privileges Affect Invoker&#39;s Rights</h2>
<div>
<p>An invoker&rsquo;s rights procedure executes with all of the invoker&#39;s privileges.</p>
<p>Oracle Database enables the privileges that were granted to the invoker through any of the invoker&#39;s enabled roles to take effect, unless a definer&#39;s rights procedure calls the <a href="glossary.htm#GUID-68637D3F-FA77-453D-962B-172202ACC23C"><span class="xrefglossterm">invoker&#39;s rights procedure</span></a> directly or indirectly. A user of an invoker&#39;s rights procedure must have privileges (granted to the user either directly or through a role) on objects that the procedure accesses through external references that are resolved in the schema of the invoker. When the invoker runs an invoker&#39;s rights procedure, this user temporarily has <span class="italic">all</span> of the privileges of the invoker. (See <a href="dr_ir.htm#GUID-4DEF8C03-0DCA-4B72-9EEC-F1141E076A2F" title="You can use the INHERIT PRIVILEGES and INHERIT ANY PRIVILEGES privileges to regulate the privileges used when invoker&#39;s rights procedures are run.">Controlling Invoker&#39;s Rights Privileges for Procedure Calls and View Access</a> for more on this aspect of invoker&#39;s rights procedures.)</p>
<p>The invoker must have privileges at run time to access program references embedded in DML statements or dynamic SQL statements, because they are effectively recompiled at run time.</p>
<p>For all other external references, such as direct PL/SQL function calls, Oracle Database checks the privileges of the owner at compile time, but does not perform a run-time check. Therefore, the user of an invoker&#39;s rights procedure does not need privileges on external references outside DML or dynamic SQL statements. Alternatively, the developer of an invoker&#39;s rights procedure must only grant privileges on the procedure itself, not on all objects directly referenced by the invoker&#39;s rights procedure.</p>
<p>You can create a software bundle that consists of multiple program units, some with definer&#39;s rights and others with invoker&#39;s rights, and restrict the program entry points <span class="italic">(controlled step-in)</span>. A user who has the privilege to run an entry-point procedure can also execute internal program units indirectly, but cannot directly call the internal programs. For very precise control over query processing, you can create a PL/SQL package specification with explicit cursors.</p>
</div>
</div>
<a id="DBSEG1038"></a>
<div class="props_rev_3"><a id="GUID-547A6A16-51AA-4FD9-BDB9-0D8A79B8CF24"></a>
<h2 id="DBSEG-GUID-547A6A16-51AA-4FD9-BDB9-0D8A79B8CF24" class="sect2">When You Should Create Invoker&#39;s Rights Procedures</h2>
<div>
<p>Oracle recommends that you create invoker&#39;s rights procedures in certain situations.</p>
<p>These situations are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="bold">When creating a PL/SQL procedure in a high-privileged schema.</span> When lower-privileged users invoke the procedure, then it can do no more than those users are allowed to do. In other words, the invoker&#39;s rights procedure runs with the privileges of the invoking user.</p>
</li>
<li>
<p><span class="bold">When the PL/SQL procedure contains no SQL and is available to other users.</span> The <code class="codeph">DBMS_OUTPUT</code> PL/SQL package is an example of a PL/SQL subprogram that contains no SQL and is available to all users. The reason you should use an invoker&#39;s rights procedure in this situation is because the unit issues no SQL statements at run time, so the run-time system does not need to check their privileges. Specifying <code class="codeph">AUTHID</code> <code class="codeph">CURRENT_USER</code> makes invocations of the procedure more efficient, because when an invoker&#39;s right procedure is pushed onto, or comes from, the call stack, the values of <code class="codeph">CURRENT_USER</code> and <code class="codeph">CURRENT_SCHEMA</code>, and the currently enabled roles do not change.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-547A6A16-51AA-4FD9-BDB9-0D8A79B8CF24__GUID-8587C1C6-1685-45FD-AFA6-4618863F2126">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="vpd.htm#GUID-8F39CFC1-E210-4011-9D49-F84E91AF41CB" title="You can use the DBMS_RLS PL/SQL package to configure Oracle Virtual Private Database (VPD) policies.">Configuration of Oracle Virtual Private Database Policies</a></p>
</li>
<li>
<p><a href="authorization.htm#GUID-32479D5D-74E8-49C0-B11D-D33D3774FC06" title="System privileges that use the ANY keyword enable you to set privileges for an entire category of objects in the database.">About ANY Privileges and the PUBLIC Role</a></p>
</li>
<li>
<p><a class="olink LNPLS00809" target="_blank" href="../LNPLS/subprograms.htm#LNPLS00809"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about how Oracle Database handles name resolution and privilege checking at runtime using invoker&#39;s and definer&#39;s rights</p>
</li>
<li>
<p><a class="olink LNPLS00809" target="_blank" href="../LNPLS/subprograms.htm#LNPLS00809"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for more information about the differences between invoker&#39;s rights and definer&#39;s rights units</p>
</li>
<li>
<p><a class="olink LNPLS01371" target="_blank" href="../LNPLS/create_package.htm#LNPLS01371"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about defining explicit cursors in the <code class="codeph">CREATE PACKAGE</code> statement</p>
</li>
</ul>
</div>
</div>
</div>
<a id="DBSEG653"></a>
<div class="props_rev_3"><a id="GUID-4DEF8C03-0DCA-4B72-9EEC-F1141E076A2F"></a>
<h2 id="DBSEG-GUID-4DEF8C03-0DCA-4B72-9EEC-F1141E076A2F" class="sect2">Controlling Invoker&#39;s Rights Privileges for Procedure Calls and View Access</h2>
<div>
<p>You can use the <code class="codeph">INHERIT PRIVILEGES</code> and <code class="codeph">INHERIT ANY PRIVILEGES</code> privileges to regulate the privileges used when invoker&#39;s rights procedures are run.</p>
<p>Topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-0B9271DA-4151-4915-AB1A-FB1A262E287E" title="An invoker&rsquo;s rights procedure is useful in situations where a lower-privileged user must execute a procedure owned by a higher-privileged user.">How the Privileges of a Schema Affect the Use of Invoker&#39;s Rights Procedures</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-174CF65A-209E-4A50-93ED-648C0EB38E90" title="Use the INHERIT PRIVILEGES and INHERIT ANY PRIVILEGES privileges to secure invoker&rsquo;s rights procedures.">How the INHERIT [ANY] PRIVILEGES Privileges Control Privilege Access</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-B2D69EFA-7BB0-46A1-8750-7787323B0870" title="By default, all users are granted INHERIT PRIVILEGES ON USER newuser TO PUBLIC.">Grants of the INHERIT PRIVILEGES Privilege to Other Users</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-4F8D794B-E54C-4B68-AF94-770700805EAC" title="The GRANT statement can grant the INHERIT PRIVILEGES privilege on an invoking user to a procedure owner.">Example: Granting INHERIT PRIVILEGES on an Invoking User</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-4773E302-0995-4EDD-9B8A-79629448F662" title="The REVOKE statement can revoke the INHERIT PRIVILEGES privilege from a user.">Example: Revoking INHERIT PRIVILEGES</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-4950AE44-1C25-4DCA-8F8E-93373081DEFE" title="By default, user SYS has the INHERIT ANY PRIVILEGES system privilege and can grant this privilege to other database users or roles.">Grants of the INHERIT ANY PRIVILEGES Privilege to Other Users</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-7534ABF6-CA9B-4F91-8EC2-5FFDECC576CE" title="The GRANT statement can grant the INHERIT ANY PRIVILEGES privilege to trusted procedure owners.">Example: Granting INHERIT ANY PRIVILEGES to a Trusted Procedure Owner</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-575EE41D-1F31-412E-9AD1-707DF544B9F1" title="By default, PUBLIC has the INHERIT PRIVILEGE privilege on new and upgraded user accounts; the SYS user has the INHERIT ANY PRIVILEGES privilege.">Managing INHERIT PRIVILEGES and INHERIT ANY PRIVILEGES</a></p>
</li>
</ul>
</div>
<a id="DBSEG660"></a>
<div class="props_rev_3"><a id="GUID-0B9271DA-4151-4915-AB1A-FB1A262E287E"></a>
<h3 id="DBSEG-GUID-0B9271DA-4151-4915-AB1A-FB1A262E287E" class="sect3">How the Privileges of a Schema Affect the Use of Invoker&#39;s Rights Procedures</h3>
<div>
<p>An invoker&rsquo;s rights procedure is useful in situations where a lower-privileged user must execute a procedure owned by a higher-privileged user.</p>
<p>When a user runs an invoker&#39;s rights procedure (or any PL/SQL program unit that has been created with the <code class="codeph">AUTHID CURRENT_USER</code> clause), the procedure temporarily inherits all of the privileges of the invoking user while the procedure runs.</p>
<p>During that time, the procedure owner has, through the procedure, access to this invoking user&#39;s privileges. Consider the following scenario:</p>
<ol>
<li>
<p>User <code class="codeph">ebrown</code> creates the <code class="codeph">check_syntax</code> <a href="glossary.htm#GUID-68637D3F-FA77-453D-962B-172202ACC23C"><span class="xrefglossterm">invoker&#39;s rights procedure</span></a> and then grants user <code class="codeph">jward</code> the <code class="codeph">EXECUTE</code> privilege on it.</p>
</li>
<li>
<p>User <code class="codeph">ebrown</code>, who is a junior programmer, has only the minimum set of privileges necessary for his job. The <code class="codeph">check_syntax</code> procedure resides in <code class="codeph">ebrown</code>&#39;s schema.</p>
</li>
<li>
<p>User <code class="codeph">jward</code>, who is a manager, has a far more powerful set of privileges than user <code class="codeph">ebrown</code>.</p>
</li>
<li>
<p>When user <code class="codeph">jward</code> runs the <code class="codeph">check_syntax</code> invoker&#39;s rights procedure, the procedure inherits user <code class="codeph">jward</code>&#39;s higher privileges while it runs.</p>
</li>
<li>
<p>Because user <code class="codeph">ebrown</code> owns the <code class="codeph">check_syntax</code> procedure, he has access to user <code class="codeph">jward</code>&#39;s privileges whenever <code class="codeph">jward</code> runs the <code class="codeph">check_syntax</code> procedure.</p>
</li>
</ol>
<p>The danger in this type of situation&mdash;in which the lower privileged <code class="codeph">ebrown</code>&#39;s procedure has access to <code class="codeph">jward</code>&#39;s higher privileges whenever <code class="codeph">jward</code> runs the procedure&mdash;lies in the risk that the procedure owner can misuse the higher privileges of the invoking user. For example, user <code class="codeph">ebrown</code> could make use of <code class="codeph">jward</code>&#39;s higher privileges by rewriting the <code class="codeph">check_syntax</code> procedure to give <code class="codeph">ebrown</code> a raise or delete <code class="codeph">ebrown</code>&#39;s bad performance appraisal record. Or, <code class="codeph">ebrown</code> originally could have created the procedure as a definer&#39;s rights procedure, granted its <code class="codeph">EXECUTE</code> privilege to <code class="codeph">jward</code>, and then later on change it to a potentially malicious invoker&#39;s rights procedure without letting <code class="codeph">jward</code> know. These types of risks increase when random users, such as application users, have access to a database that uses invoker&#39;s rights procedures.</p>
<p>When user <code class="codeph">jward</code> runs <code class="codeph">ebrown</code>&#39;s invoker&#39;s rights procedure, there is an element of trust involved. He must be assured that <code class="codeph">ebrown</code> will not use the <code class="codeph">check_syntax</code> procedure in a malicious way when it accesses <code class="codeph">jward</code>&#39;s privileges. The <code class="codeph">INHERIT PRIVILEGES</code> and <code class="codeph">INHERIT ANY PRIVILEGES</code> privileges can help user <code class="codeph">jward</code> control whether user <code class="codeph">ebrown</code>&#39;s procedure can have access to his (<code class="codeph">jward</code>&#39;s) privileges. Any user can grant or revoke the <code class="codeph">INHERIT PRIVILEGES</code> privilege on themselves to the user whose invoker&#39;s rights procedures they want to run. <code class="codeph">SYS</code> users manage the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege.</p>
</div>
</div>
<a id="DBSEG661"></a>
<div class="props_rev_3"><a id="GUID-174CF65A-209E-4A50-93ED-648C0EB38E90"></a>
<h3 id="DBSEG-GUID-174CF65A-209E-4A50-93ED-648C0EB38E90" class="sect3">How the INHERIT [ANY] PRIVILEGES Privileges Control Privilege Access</h3>
<div>
<p>Use the <code class="codeph">INHERIT PRIVILEGES</code> and <code class="codeph">INHERIT ANY PRIVILEGES</code> privileges to secure invoker&rsquo;s rights procedures.</p>
<p>The <code class="codeph">INHERIT PRIVILEGES</code> and <code class="codeph">INHERIT ANY PRIVILEGES</code> privileges regulate the privileges used when a user runs an invoker&#39;s rights procedure or queries a <code class="codeph">BEQUEATH CURRENT_USER</code> view that references an invoker&#39;s rights procedure.</p>
<p>When a user runs an invoker&#39;s rights procedure, Oracle Database checks it to ensure that the procedure owner has either the <code class="codeph">INHERIT PRIVILEGES</code> privilege on the invoking user, or if the owner has been granted the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege. If the privilege check fails, then Oracle Database returns an <code class="codeph">ORA-06598: insufficient INHERIT PRIVILEGES privilege</code> error.</p>
<p>The benefit of these two privileges is that they give invoking users control over who can access their privileges when they run an invoker&#39;s rights procedure or query a <code class="codeph">BEQUEATH CURRENT_USER</code> view.</p>
</div>
</div>
<a id="DBSEG662"></a>
<div class="props_rev_3"><a id="GUID-B2D69EFA-7BB0-46A1-8750-7787323B0870"></a>
<h3 id="DBSEG-GUID-B2D69EFA-7BB0-46A1-8750-7787323B0870" class="sect3">Grants of the INHERIT PRIVILEGES Privilege to Other Users</h3>
<div>
<p>By default, all users are granted <code class="codeph">INHERIT PRIVILEGES</code> <code class="codeph">ON USER</code> <span class="italic"><code class="codeph">newuser</code></span> <code class="codeph">TO PUBLIC</code>.</p>
<p>This grant takes place when the user accounts are created or when accounts that were created earlier are upgraded to the current release.</p>
<p>The invoking user can revoke the <code class="codeph">INHERIT PRIVILEGE</code> privilege from other users on himself and then grant it only to users that he trusts.</p>
<p>The syntax for the <code class="codeph">INHERIT PRIVILEGES</code> privilege grant is as follows:</p>
<pre dir="ltr">GRANT INHERIT PRIVILEGES ON USER <span class="italic">invoking_user</span> TO <span class="italic">procedure_owner</span>;
</pre>
<p>In this specification:</p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic"><code class="codeph">invoking_user</code></span> is the user who runs the invoker&#39;s rights procedure. This user must be a database user account.</p>
</li>
<li>
<p><span class="italic"><code class="codeph">procedure_owner</code></span> is the user who owns the invoker&#39;s rights procedure. This value must be a database user account. As an alternative to granting the <code class="codeph">INHERIT PRIVILEGES</code> privilege to the procedure&#39;s owner, you can grant the privilege to a role that is in turn granted to the procedure.</p>
</li>
</ul>
<p>The following users or roles must have the <code class="codeph">INHERIT PRIVILEGES</code> privilege granted to them by users who will run their invoker&#39;s rights procedures:</p>
<ul style="list-style-type: disc;">
<li>
<p>Users or roles who own the invoker&#39;s rights procedures</p>
</li>
<li>
<p>Users or roles who own <code class="codeph">BEQUEATH CURRENT_USER</code> views</p>
</li>
</ul>
</div>
</div>
<a id="DBSEG663"></a>
<div class="props_rev_3"><a id="GUID-4F8D794B-E54C-4B68-AF94-770700805EAC"></a>
<h3 id="DBSEG-GUID-4F8D794B-E54C-4B68-AF94-770700805EAC" class="sect3">Example: Granting INHERIT PRIVILEGES on an Invoking User</h3>
<div>
<p>The <code class="codeph">GRANT</code> statement can grant the <code class="codeph">INHERIT PRIVILEGES</code> privilege on an invoking user to a procedure owner.</p>
<p><a href="dr_ir.htm#GUID-4F8D794B-E54C-4B68-AF94-770700805EAC__CACDCCHG">Example 5-1</a> shows how the invoking user <code class="codeph">jward</code> can grant user <code class="codeph">ebrown</code> the <code class="codeph">INHERIT PRIVILEGES</code> privilege.</p>
<div class="example" id="GUID-4F8D794B-E54C-4B68-AF94-770700805EAC__CACDCCHG">
<p class="titleinexample">Example 5-1 Granting INHERIT PRIVILEGES on an Invoking User to a Procedure Owner</p>
<pre dir="ltr">GRANT INHERIT PRIVILEGES ON USER jward TO ebrown;
</pre>
<p>The statement enables any invoker&#39;s rights procedure that <code class="codeph">ebrown</code> writes, or will write in the future, to access <code class="codeph">jward</code>&#39;s privileges when <code class="codeph">jward</code> runs it.</p>
</div>
<!-- class="example" --></div>
</div>
<a id="DBSEG664"></a>
<div class="props_rev_3"><a id="GUID-4773E302-0995-4EDD-9B8A-79629448F662"></a>
<h3 id="DBSEG-GUID-4773E302-0995-4EDD-9B8A-79629448F662" class="sect3">Example: Revoking INHERIT PRIVILEGES</h3>
<div>
<p>The <code class="codeph">REVOKE</code> statement can revoke the <code class="codeph">INHERIT PRIVILEGES</code> privilege from a user.</p>
<p><a href="dr_ir.htm#GUID-4773E302-0995-4EDD-9B8A-79629448F662__CACJEACI">Example 5-2</a> shows how user <code class="codeph">jward</code> can revoke the use of his privileges from <code class="codeph">ebrown</code>.</p>
<div class="example" id="GUID-4773E302-0995-4EDD-9B8A-79629448F662__CACJEACI">
<p class="titleinexample">Example 5-2 Revoking INHERIT PRIVILEGES</p>
<pre dir="ltr">REVOKE INHERIT PRIVILEGES ON USER jward FROM ebrown;
</pre></div>
<!-- class="example" --></div>
</div>
<a id="DBSEG665"></a>
<div class="props_rev_3"><a id="GUID-4950AE44-1C25-4DCA-8F8E-93373081DEFE"></a>
<h3 id="DBSEG-GUID-4950AE44-1C25-4DCA-8F8E-93373081DEFE" class="sect3">Grants of the INHERIT ANY PRIVILEGES Privilege to Other Users</h3>
<div>
<p>By default, user <code class="codeph">SYS</code> has the <code class="codeph">INHERIT ANY PRIVILEGES</code> system privilege and can grant this privilege to other database users or roles.</p>
<p>As with all <code class="codeph">ANY</code> privileges, only grant this privilege to trusted users or roles. Once a user or role has been granted the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege, then this user&#39;s invoker&#39;s rights procedures have access to the privileges of the invoking user. You can find the users who have been granted the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege by querying the <code class="codeph">DBA_SYS_PRIVS</code> data dictionary view.</p>
</div>
</div>
<a id="DBSEG666"></a>
<div class="props_rev_3"><a id="GUID-7534ABF6-CA9B-4F91-8EC2-5FFDECC576CE"></a>
<h3 id="DBSEG-GUID-7534ABF6-CA9B-4F91-8EC2-5FFDECC576CE" class="sect3">Example: Granting INHERIT ANY PRIVILEGES to a Trusted Procedure Owner</h3>
<div>
<p>The <code class="codeph">GRANT</code> statement can grant the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege to trusted procedure owners.</p>
<p><a href="dr_ir.htm#GUID-7534ABF6-CA9B-4F91-8EC2-5FFDECC576CE__CACBBIJC">Example 5-3</a> shows how to grant the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege to user <code class="codeph">ebrown</code>.</p>
<div class="example" id="GUID-7534ABF6-CA9B-4F91-8EC2-5FFDECC576CE__CACBBIJC">
<p class="titleinexample">Example 5-3 Granting INHERIT ANY PRIVILEGES to a Trusted Procedure Owner</p>
<pre dir="ltr">GRANT INHERIT ANY PRIVILEGES TO ebrown;
</pre>
<p>Be careful about revoking the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege from powerful users. For example, suppose user <code class="codeph">SYSTEM</code> has created a set of invoker&#39;s rights procedures. If you revoke <code class="codeph">INHERIT ANY PRIVILEGES</code> from <code class="codeph">SYSTEM</code>, then other users cannot run his procedures, unless they have specifically granted him the <code class="codeph">INHERIT PRIVILEGE</code> privilege.</p>
</div>
<!-- class="example" --></div>
</div>
<a id="DBSEG667"></a>
<div class="props_rev_3"><a id="GUID-575EE41D-1F31-412E-9AD1-707DF544B9F1"></a>
<h3 id="DBSEG-GUID-575EE41D-1F31-412E-9AD1-707DF544B9F1" class="sect3">Managing INHERIT PRIVILEGES and INHERIT ANY PRIVILEGES</h3>
<div>
<p>By default, <code class="codeph">PUBLIC</code> has the <code class="codeph">INHERIT PRIVILEGE</code> privilege on new and upgraded user accounts; the <code class="codeph">SYS</code> user has the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege.</p>
<div class="section">
<p>Oracle by default configures a set of grants of <code class="codeph">INHERIT PRIVILEGES</code> that are designed to help protect against misuse of the privileges of various Oracle-defined users.</p>
<p>You can choose to revoke the default grant of <code class="codeph">INHERIT PRIVILEGES ON USER</code> <span class="italic"><code class="codeph">user_name</code></span> <code class="codeph">TO PUBLIC</code> for a customer-defined user and grant more specific grants of <code class="codeph">INHERIT PRIVILEGES</code> as appropriate for that particular user. To find the users who have been granted the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege, query the <code class="codeph">DBA_SYS_PRIVS</code> data dictionary view.</p>
</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Revoke the <code class="codeph">INHERIT PRIVILEGES</code> privilege from <code class="codeph">PUBLIC</code>.</span>
<div>
<p>For example:</p>
<pre dir="ltr">REVOKE INHERIT PRIVILEGES ON <span class="italic">invoking_user</span> FROM PUBLIC;
</pre>
<p>Be aware that this time, any users who run invoker&#39;s rights procedures cannot do so, due to run-time errors from failed <code class="codeph">INHERIT PRIVILEGES</code> checks.</p>
</div>
</li>
<li class="stepexpand"><span>Selectively grant the <code class="codeph">INHERIT PRIVILEGES</code> privilege to trusted users or roles.</span></li>
<li class="stepexpand"><span>Similarly, selectively grant the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege only to trusted users or roles.</span></li>
</ol>
<div class="section">
<p>You can create an audit policy to audit the granting and revoking of these two privileges, but you cannot audit run-time errors that result from failed <code class="codeph">INHERIT PRIVILEGES</code> privilege checks.</p>
<div class="infoboxnotealso" id="GUID-575EE41D-1F31-412E-9AD1-707DF544B9F1__GUID-1C1D5CD9-D7F4-42D0-9F05-F5EEABC78AA5">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink LNPLS01109" target="_blank" href="../LNPLS/dynamic.htm#LNPLS01109"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about SQL injection attacks</p>
</li>
<li>
<p><a class="olink SQLRF01603" target="_blank" href="../SQLRF/statements_9014.htm#SQLRF01603"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for more information about the <code class="codeph">GRANT</code> statement and default privileges</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="DBSEG586"></a>
<div class="props_rev_3"><a id="GUID-2897C310-D0B5-4AB0-8237-384196C4EC81"></a>
<h2 id="DBSEG-GUID-2897C310-D0B5-4AB0-8237-384196C4EC81" class="sect2">Definer&#39;s Rights and Invoker&#39;s Rights in Views</h2>
<div>
<p>You can use the <code class="codeph">BEQEATH</code> clause in the <code class="codeph">CREATE VIEW</code> SQL statement to control definer&#39;s rights and invoker&#39;s rights in user-created views.</p>
<p>Topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-0AF4F672-7252-4C90-BC95-AD9337511A09" title="You can configure user-defined views to accommodate invoker&#39;s rights functions that are referenced in the view.">About Controlling Definer&#39;s Rights and Invoker&#39;s Rights in Views</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-EF5300C7-E153-4316-805E-0A87FF2EA676" title="The BEQUEATH controls how an invoker&rsquo;s right function can be executed using the rights of the invoking user.">Using the BEQUEATH Clause in the CREATE VIEW Statement</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-E8238F8F-046F-411C-A0D4-BA3581A6907A" title="PL/SQL functions can be used to find the invoking user, based on whether invoker&rsquo;s rights or definer&rsquo;s rights are being used.">Finding the User Name or User ID of the Invoking User</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-6B0BD428-F194-4344-B9EE-02466181EDCB" title="You can find out if a view is a BEQUEATH DEFINER or BEQUEATH CURRENT_USER view.">Finding BEQUEATH DEFINER and BEQUEATH_CURRENT_USER Views</a></p>
</li>
</ul>
</div>
<a id="DBSEG558"></a>
<div class="props_rev_3"><a id="GUID-0AF4F672-7252-4C90-BC95-AD9337511A09"></a>
<h3 id="DBSEG-GUID-0AF4F672-7252-4C90-BC95-AD9337511A09" class="sect3">About Controlling Definer&#39;s Rights and Invoker&#39;s Rights in Views</h3>
<div>
<p>You can configure user-defined views to accommodate invoker&#39;s rights functions that are referenced in the view.</p>
<p>When a user invokes an identity- or privilege-sensitive SQL function or an invoker&#39;s rights PL/SQL or Java function, then current schema, current user, and currently enabled roles within the operation&#39;s execution can be inherited from the querying user&#39;s environment, rather than being set to the owner of the view.</p>
<p>This configuration does not turn the view itself into an invoker&#39;s rights object. Name resolution within the view is still handled using the view owner&#39;s schema, and privilege checking for the view is done using the view owner&#39;s privileges. However, at runtime, the function referenced by view runs under the invoking user&#39;s privileges rather than those of the view owner&#39;s.</p>
<p>The benefit of this feature is that it enables functions such as <code class="codeph">SYS_CONTEXT</code> and <code class="codeph">USERENV</code>, which must return information accurate for the invoking user, to return consistent results when these functions are referenced in a view.</p>
</div>
</div>
<a id="DBSEG668"></a>
<div class="props_rev_3"><a id="GUID-EF5300C7-E153-4316-805E-0A87FF2EA676"></a>
<h3 id="DBSEG-GUID-EF5300C7-E153-4316-805E-0A87FF2EA676" class="sect3">Using the BEQUEATH Clause in the CREATE VIEW Statement</h3>
<div>
<p>The <code class="codeph">BEQUEATH</code> controls how an invoker&rsquo;s right function can be executed using the rights of the invoking user.</p>
<div class="section">
<p>To enable an invoker&#39;s rights function to be executed using the rights of the user issuing SQL that references the view, in the <code class="codeph">CREATE VIEW</code> statement, you can set the <code class="codeph">BEQUEATH</code> clause to <code class="codeph">CURRENT_USER</code>.</p>
<p>If you plan to issue a SQL query or DML statement against the view, then the view owner must be granted the <code class="codeph">INHERIT</code> <code class="codeph">PRIVILEGES</code> privilege on the invoking user or the view owner must have the <code class="codeph">INHERIT ANY PRIVILEGES</code> privilege. If not, then when a <code class="codeph">SELECT</code> query or DML statement involves a <code class="codeph">BEQUEATH</code> <code class="codeph">CURRENT_USER</code> view, the run-time system will raise error <code class="codeph">ORA-06598: insufficient INHERIT PRIVILEGES privilege</code>.</p>
<ul style="list-style-type: disc;">
<li>
<p>Use the use <code class="codeph">BEQUEATH CURRENT_USER</code> clause to set the view&#39;s function to be executed using invoker&#39;s rights.</p>
</li>
</ul>
<p>For example:</p>
<pre dir="ltr">CREATE VIEW MY_OBJECTS_VIEW BEQUEATH CURRENT_USER AS
 SELECT GET_OBJS_FUNCTION;
</pre>
<p>If you want the function within the view to be executed using the view owner&#39;s rights, then you should either omit the <code class="codeph">BEQUEATH</code> clause or set it to <code class="codeph">DEFINER</code>.</p>
<p>For example:</p>
<pre dir="ltr">CREATE VIEW my_objects_view BEQUEATH DEFINER AS
 SELECT OBJECT_NAME FROM USER_OBJECTS;
</pre>
<div class="infoboxnotealso" id="GUID-EF5300C7-E153-4316-805E-0A87FF2EA676__GUID-3458CCE5-41A5-46CF-94FA-410038C5FF6F">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-4DEF8C03-0DCA-4B72-9EEC-F1141E076A2F" title="You can use the INHERIT PRIVILEGES and INHERIT ANY PRIVILEGES privileges to regulate the privileges used when invoker&#39;s rights procedures are run.">Controlling Invoker&#39;s Rights Privileges for Procedure Calls and View Access</a> for more information about how the <code class="codeph">INHERIT PRIVILEGE</code> privilege works</p>
</li>
<li>
<p><a class="olink SQLRF01603" target="_blank" href="../SQLRF/statements_9014.htm#SQLRF01603"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for additional information about granting the <code class="codeph">INHERIT</code> <code class="codeph">PRIVILEGES</code> and <code class="codeph">INHERIT</code> <code class="codeph">ANY</code> <code class="codeph">PRIVILEGES</code> privileges</p>
</li>
<li>
<p><a class="olink DBFSG433" target="_blank" href="../DBFSG/data_security.htm#DBFSG433"><span><cite>Oracle Database Real Application Security Administrator&#39;s and Developer&#39;s Guide</cite></span></a> for information about how to use <code class="codeph">BEQUEATH CURRENT_USER</code> views with Oracle Database Real Application Security applications</p>
</li>
</ul>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="DBSEG836"></a>
<div class="props_rev_3"><a id="GUID-E8238F8F-046F-411C-A0D4-BA3581A6907A"></a>
<h3 id="DBSEG-GUID-E8238F8F-046F-411C-A0D4-BA3581A6907A" class="sect3">Finding the User Name or User ID of the Invoking User</h3>
<div>
<p>PL/SQL functions can be used to find the invoking user, based on whether invoker&rsquo;s rights or definer&rsquo;s rights are being used.</p>
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>Use the <code class="codeph">ORA_INVOKING_USER</code> or <code class="codeph">ORA_INVOKING_USERID</code> function to find the invoking user based on whether invoker&#39;s rights or definer&#39;s rights:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">ORA_INVOKING_USER</code>: Use this function to return the name of the user who is invoking the current statement or view. This function treats the intervening views as specified by their <code class="codeph">BEQUEATH</code> clauses. If the invoking user is an Oracle Database Real Application Security-defined user, then this function returns <code class="codeph">XS$NULL</code>.</p>
</li>
<li>
<p><code class="codeph">ORA_INVOKING_USERID</code>: Use this function to return the identifier (ID) of the user who is invoking the current statement or view. This function treats the intervening views as specified by their <code class="codeph">BEQUEATH</code> clauses. If the invoking user is an Oracle Database Real Application Security-defined user, then this function returns an ID that is common to all Real Application Security sessions but is different from the ID of any database user.</p>
<p>For example:</p>
<pre dir="ltr">CONNECT HR
Enter password: <span class="italic">password</span>

SELECT ORA_INVOKING_USER FROM DUAL;

ORA_INVOKING_USER
--------------------
HR
</pre></li>
</ul>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-E8238F8F-046F-411C-A0D4-BA3581A6907A__GUID-26B4D7B8-C366-41DB-B9AF-4BB23B283A8D">
<p class="notep1">See Also:</p>
<p><a class="olink DBFSG436" target="_blank" href="../DBFSG/data_security.htm#DBFSG436"><span><cite>Oracle Database Real Application Security Administrator&#39;s and Developer&#39;s Guide</cite></span></a> for information about similar functions that are used for Oracle Database Real Application Security applications</p>
</div>
</div>
<!-- class="section" --></div>
</div>
<a id="DBSEG795"></a>
<div class="props_rev_3"><a id="GUID-6B0BD428-F194-4344-B9EE-02466181EDCB"></a>
<h3 id="DBSEG-GUID-6B0BD428-F194-4344-B9EE-02466181EDCB" class="sect3">Finding BEQUEATH DEFINER and BEQUEATH_CURRENT_USER Views</h3>
<div>
<p>You can find out if a view is a <code class="codeph">BEQUEATH DEFINER</code> or <code class="codeph">BEQUEATH CURRENT_USER</code> view.</p>
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p>To find if a view is <code class="codeph">BEQUEATH DEFINER</code> or <code class="codeph">BEQUEATH CURRENT_USER</code> view, query the <code class="codeph">BEQUEATH</code> column of a <code class="codeph">*_VIEWS</code> or <code class="codeph">*_VIEWS_AE</code> static data dictionary view for that view.</p>
</li>
</ul>
<div class="infoboxnotealso" id="GUID-6B0BD428-F194-4344-B9EE-02466181EDCB__GUID-F88AA33D-70EA-47E5-9406-E745C6527A75">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a class="olink REFRN20305" target="_blank" href="../REFRN/GUID-0FE29B36-0882-47AE-A54E-A01FC9C4100A.htm#REFRN20305"><span><cite>Oracle Database Reference</cite></span></a> for more information about <code class="codeph">*_VIEWS</code> static data dictionary views</p>
</li>
<li>
<p><a class="olink REFRN20696" target="_blank" href="../REFRN/GUID-DEFCF513-F6E9-4D4C-BB26-D2920A3ED27E.htm#REFRN20696"><span><cite>Oracle Database Reference</cite></span></a> for more information about <code class="codeph">*_VIEWS_AE</code> static data dictionary views</p>
</li>
</ul>
<p>For example:</p>
<pre dir="ltr">SELECT BEQUEATH FROM USER_VIEWS WHERE VIEW_NAME = &#39;MY_OBJECTS&#39;;

BEQUEATH
------------
CURRENT_USER
</pre></div>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="DBSEG977"></a>
<div class="props_rev_3"><a id="GUID-45E77E8E-587F-42AF-A163-D814264341E2"></a>
<h2 id="DBSEG-GUID-45E77E8E-587F-42AF-A163-D814264341E2" class="sect2">Using Code Based Access Control for Definer&#39;s Rights and Invoker&#39;s Rights</h2>
<div>
<p>You can use code based access control to attach database roles to a PL/SQL function, procedure, or package. This functionality works well with invoker&#39;s rights and definer&#39;s program units.</p>
<p>Topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-7AA2D9C4-DB10-4BF1-AD4C-F48547F7AA82" title="You can use code based access control (CBAC) to better manage definer&rsquo;s rights program units.">About Using Code Based Access Control for Applications</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-D7E76448-152C-4207-9D48-FE562E0D911C" title="Code based access control roles can be granted to a program unit if a set of conditions are met.">Who Can Grant Code Based Access Control Roles to a Program Unit?</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-C00B198C-5770-4D89-958C-DB2ECE8FADC6" title="Code based access control can run a program unit in an invoking user&#39;s context and with roles associated with this context.">How Code Based Access Control Works with Invoker&#39;s Rights Program Units</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-D93C6165-9E9A-4E5F-987E-35DC46812C20" title="Code based access control can be used to secure definer&rsquo;s rights.">How Code Based Access Control Works with Definer&#39;s Rights Program Units</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-CD18ADC1-2068-4250-881A-10836818A390" title="The DELEGATE option in the GRANT statement can limit privilege grants to roles by users responsible for CBAC grants.">Grants of Database Roles to Users for Their CBAC Grants</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-7C59ADD4-BF48-4A16-A2AD-272F710EE48B" title="The GRANT and REVOKE statements can grant database roles to or revoke database roles from a program unit.">Grants and Revokes of Database Roles to a Program Unit</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-1CBA23D1-FC6B-4544-A281-7D85071FF89D" title="This tutorial demonstrates how to control access to sensitive data in the HR schema by using code based access control.">Tutorial: Controlling Access to Sensitive Data Using Code Based Access Control</a></p>
</li>
</ul>
</div>
<a id="DBSEG978"></a>
<div class="props_rev_3"><a id="GUID-7AA2D9C4-DB10-4BF1-AD4C-F48547F7AA82"></a>
<h3 id="DBSEG-GUID-7AA2D9C4-DB10-4BF1-AD4C-F48547F7AA82" class="sect3">About Using Code Based Access Control for Applications</h3>
<div>
<p>You can use code based access control (CBAC) to better manage definer&rsquo;s rights program units.</p>
<p>Applications must often run program units in the caller&#39;s environment, while requiring elevated privileges. PL/SQL programs traditionally make use of definer&#39;s rights to temporarily elevate the privileges of the program.</p>
<p>However, definer&#39;s rights based program units run in the context of the definer or the owner of the program unit, as opposed to the invoker&#39;s context. Also, using definer&#39;s rights based programs often leads to the program unit getting more privileges than required.</p>
<p>Code based access control (CBAC) provides the solution by enabling you to attach database roles to a PL/SQL function, procedure, or package. These database roles are enabled at run time, enabling the program unit to execute with the required privileges in the calling user&#39;s environment.</p>
</div>
</div>
<a id="DBSEG1039"></a>
<div class="props_rev_3"><a id="GUID-D7E76448-152C-4207-9D48-FE562E0D911C"></a>
<h3 id="DBSEG-GUID-D7E76448-152C-4207-9D48-FE562E0D911C" class="sect3">Who Can Grant Code Based Access Control Roles to a Program Unit?</h3>
<div>
<p>Code based access control roles can be granted to a program unit if a set of conditions are met.</p>
<p>These conditions are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>The grantor is user <code class="codeph">SYS</code> or owns the program unit.</p>
</li>
<li>
<p>If the grantor owns the program unit, then the grantor must have the <code class="codeph">GRANT ANY ROLE</code> system privilege, or have the <code class="codeph">ADMIN</code> or <code class="codeph">DELEGATE</code> option for the roles that they want to grant to program units.</p>
</li>
<li>
<p>The roles to be granted are directly granted roles to the owner.</p>
</li>
<li>
<p>The roles to be granted are standard database roles.</p>
</li>
</ul>
<p>If these three conditions are not met, then error <code class="codeph">ORA-28702: Program unit string is not owned by the grantor</code> is raised if the first condition is not met, and error <code class="codeph">ORA-1924: role &#39;string&#39; not granted or does not exist</code> is raised if the second and third conditions are not met.</p>
<div class="infoboxnotealso" id="GUID-D7E76448-152C-4207-9D48-FE562E0D911C__GUID-44A13893-D800-422F-A81E-61C3F5B4801D">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-CD18ADC1-2068-4250-881A-10836818A390" title="The DELEGATE option in the GRANT statement can limit privilege grants to roles by users responsible for CBAC grants.">Grants of Database Roles to Users for Their CBAC Grants</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-7C59ADD4-BF48-4A16-A2AD-272F710EE48B" title="The GRANT and REVOKE statements can grant database roles to or revoke database roles from a program unit.">Grants and Revokes of Database Roles to a Program Unit</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="DBSEG980"></a><a id="DBSEG981"></a><a id="DBSEG979"></a>
<div class="props_rev_3"><a id="GUID-C00B198C-5770-4D89-958C-DB2ECE8FADC6"></a>
<h3 id="DBSEG-GUID-C00B198C-5770-4D89-958C-DB2ECE8FADC6" class="sect3">How Code Based Access Control Works with Invoker&#39;s Rights Program Units</h3>
<div>
<p>Code based access control can run a program unit in an invoking user&#39;s context and with roles associated with this context.</p>
<p>Consider a scenario where there are two application users, <code class="codeph">1</code> and <code class="codeph">2</code>. Application user <code class="codeph">2</code> creates the invoker&#39;s right program unit, grants database role <code class="codeph">2</code> to the invoker&#39;s rights unit, and then grants execute privileges on the invoker&#39;s rights unit to application user <code class="codeph">1</code>.</p>
<p><a href="dr_ir.htm#GUID-C00B198C-5770-4D89-958C-DB2ECE8FADC6__CHDHEHGG">Figure 5-1</a> shows the database roles <code class="codeph">1</code> and <code class="codeph">2</code> granted to application users <code class="codeph">1</code> and <code class="codeph">2</code>, and an invoker&#39;s right program unit.</p>
<div class="figure" id="GUID-C00B198C-5770-4D89-958C-DB2ECE8FADC6__CHDHEHGG">
<p class="titleinfigure">Figure 5-1 Roles Granted to Application Users and Invoker&#39;s Right Program Unit</p>
<img width="255" height="263" src="img/GUID-460E83FF-72A4-43EF-81FC-BF026CFCB363-default.png" alt="Description of Figure 5-1 follows" title="Description of Figure 5-1 follows"/><br/>
<a href="img_text/GUID-460E83FF-72A4-43EF-81FC-BF026CFCB363-print.htm">Description of &#34;Figure 5-1 Roles Granted to Application Users and Invoker&#39;s Right Program Unit&#34;</a></div>
<!-- class="figure" -->
<p>The grants are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>Application user <code class="codeph">1</code> is directly granted database roles <code class="codeph">1</code> and <code class="codeph">4</code>.</p>
</li>
<li>
<p>Application user <code class="codeph">2</code> is directly granted database role <code class="codeph">2</code>, which includes application roles <code class="codeph">3</code> and <code class="codeph">4</code>.</p>
</li>
<li>
<p>The invoker&#39;s right program unit is granted database role <code class="codeph">2</code>.</p>
</li>
</ul>
<p>When application user <code class="codeph">1</code> logs in and executes the invoker&#39;s rights program unit, then the invoker&#39;s rights unit executes with the combined database roles of user <code class="codeph">1</code> and the database roles attached to the invoker&#39;s rights unit.</p>
<p><a href="dr_ir.htm#GUID-C00B198C-5770-4D89-958C-DB2ECE8FADC6__CHDDICAG">Figure 5-2</a> shows the security context in which the invoker&#39;s rights unit is executed. When application user <code class="codeph">1</code> first logs on, application user <code class="codeph">1</code> has the database <code class="codeph">PUBLIC</code> role (by default), and the database roles <code class="codeph">1</code> and <code class="codeph">4</code>, which have been granted to it. Application user <code class="codeph">1</code> next executes the invoker&#39;s rights program unit created by application user <code class="codeph">2</code>.</p>
<p>The invoker&#39;s rights unit executes in application user <code class="codeph">1</code>&#39;s context, and has the additional database role <code class="codeph">2</code> attached to it. Database roles <code class="codeph">3</code> and <code class="codeph">4</code> are included, as they are a part of database role <code class="codeph">2</code>. After the invoker&#39;s rights unit exits, then application user <code class="codeph">1</code> only has the application roles that have been granted to it, <code class="codeph">PUBLIC</code>, role <code class="codeph">1</code>, and role <code class="codeph">4</code>.</p>
<div class="figure" id="GUID-C00B198C-5770-4D89-958C-DB2ECE8FADC6__CHDDICAG">
<p class="titleinfigure">Figure 5-2 Security Context in Which Invoker&#39;s Right Program Unit IR Is Executed</p>
<img width="437" height="312" src="img/GUID-2BCFF2B8-AA2A-43DA-B78A-B88750762E12-default.png" alt="Description of Figure 5-2 follows" title="Description of Figure 5-2 follows"/><br/>
<a href="img_text/GUID-2BCFF2B8-AA2A-43DA-B78A-B88750762E12-print.htm">Description of &#34;Figure 5-2 Security Context in Which Invoker&#39;s Right Program Unit IR Is Executed&#34;</a></div>
<!-- class="figure" --></div>
</div>
<a id="DBSEG982"></a><a id="DBSEG983"></a><a id="DBSEG671"></a>
<div class="props_rev_3"><a id="GUID-D93C6165-9E9A-4E5F-987E-35DC46812C20"></a>
<h3 id="DBSEG-GUID-D93C6165-9E9A-4E5F-987E-35DC46812C20" class="sect3">How Code Based Access Control Works with Definer&#39;s Rights Program Units</h3>
<div>
<p>Code based access control can be used to secure definer&rsquo;s rights.</p>
<p>Code based access control works with definer&#39;s rights program units to enable the program unit to run using the defining user&#39;s rights, with the privileges of a combined set of database roles that are associated with this user.</p>
<p>Consider a scenario where application user <code class="codeph">2</code> creates a definer&#39;s rights program unit, grants role <code class="codeph">2</code> to the definer&#39;s rights program unit, and then grants the <code class="codeph">EXECUTE</code> privilege on the definer&#39;s rights program unit to application user <code class="codeph">1</code>.</p>
<p><a href="dr_ir.htm#GUID-D93C6165-9E9A-4E5F-987E-35DC46812C20__CHDEFJDG">Figure 5-3</a> shows the database roles granted to application users <code class="codeph">1</code> and <code class="codeph">2</code>, and a definer&#39;s rights program unit.</p>
<div class="figure" id="GUID-D93C6165-9E9A-4E5F-987E-35DC46812C20__CHDEFJDG">
<p class="titleinfigure">Figure 5-3 Roles Granted to Application Users and Definer&#39;s Rights Program Unit</p>
<img width="255" height="263" src="img/GUID-A36573B4-0F0A-4705-8C46-B159C824216A-default.png" alt="Description of Figure 5-3 follows" title="Description of Figure 5-3 follows"/><br/>
<a href="img_text/GUID-A36573B4-0F0A-4705-8C46-B159C824216A-print.htm">Description of &#34;Figure 5-3 Roles Granted to Application Users and Definer&#39;s Rights Program Unit&#34;</a></div>
<!-- class="figure" -->
<p>The grants are as follows:</p>
<ul style="list-style-type: disc;">
<li>
<p>Application user <code class="codeph">1</code> is directly granted database roles <code class="codeph">1</code> and <code class="codeph">4</code>.</p>
</li>
<li>
<p>Application user <code class="codeph">2</code> is directly granted database role<code class="codeph">2</code>, which includes database roles <code class="codeph">3</code> and <code class="codeph">4</code>.</p>
</li>
<li>
<p>The definer&#39;s right program unit is granted database role <code class="codeph">2</code>.</p>
</li>
</ul>
<p>When application user <code class="codeph">1</code> logs in and executes definer&#39;s right program unit, then the definer&#39;s rights unit executes with the combined database roles of application user <code class="codeph">2</code> and the database roles attached to the definer&#39;s rights unit (roles <code class="codeph">2</code>, <code class="codeph">3</code>, and <code class="codeph">4</code>).</p>
<p><a href="dr_ir.htm#GUID-D93C6165-9E9A-4E5F-987E-35DC46812C20__CHDGCDHC">Figure 5-4</a> shows the security context in which the definer&#39;s right program unit is executed. When application user <code class="codeph">1</code> first logs on, application user <code class="codeph">1</code> has the database <code class="codeph">PUBLIC</code> role (by default), and the database roles <code class="codeph">1</code> and<code class="codeph">4</code>, which have been granted to it. Application user <code class="codeph">1</code> next executes the definer&#39;s rights program unit created by application user <code class="codeph">2</code>.</p>
<p>The definer&#39;s rights program unit executes in application user <code class="codeph">2</code>&#39;s context, and has the additional database role <code class="codeph">2</code> attached to it. Database roles <code class="codeph">3</code> and <code class="codeph">4</code> are included, as they are a part of database role <code class="codeph">2</code>. After the definer&#39;s rights unit exits, application user <code class="codeph">1</code> only has the database roles that have been granted to it (<code class="codeph">PUBLIC</code>, role <code class="codeph">1</code>, and role <code class="codeph">4</code>).</p>
<div class="figure" id="GUID-D93C6165-9E9A-4E5F-987E-35DC46812C20__CHDGCDHC">
<p class="titleinfigure">Figure 5-4 Security Context in Which Definer&#39;s Right Program Unit DR Is Executed</p>
<img width="405" height="312" src="img/GUID-1E60FF68-BA24-427A-849B-C281CBC30E3E-default.png" alt="Description of Figure 5-4 follows" title="Description of Figure 5-4 follows"/><br/>
<a href="img_text/GUID-1E60FF68-BA24-427A-849B-C281CBC30E3E-print.htm">Description of &#34;Figure 5-4 Security Context in Which Definer&#39;s Right Program Unit DR Is Executed&#34;</a></div>
<!-- class="figure" --></div>
</div>
<a id="DBSEG676"></a>
<div class="props_rev_3"><a id="GUID-CD18ADC1-2068-4250-881A-10836818A390"></a>
<h3 id="DBSEG-GUID-CD18ADC1-2068-4250-881A-10836818A390" class="sect3">Grants of Database Roles to Users for Their CBAC Grants</h3>
<div>
<p>The <code class="codeph">DELEGATE</code> option in the <code class="codeph">GRANT</code> statement can limit privilege grants to roles by users responsible for CBAC grants.</p>
<p>When you grant a database role to a user who is responsible for CBAC grants, you can include the <code class="codeph">DELEGATE</code> option in the <code class="codeph">GRANT</code> statement to prevent giving the grantee additional privileges on the roles.</p>
<p>The <code class="codeph">DELEGATE</code> option enables the roles to be granted to program units, but it does not permit the granting of the role to other principals or the administration of the role itself. You also can use the <code class="codeph">ADMIN</code> option for the grants, which does permit the granting of the role to other principals. Both the <code class="codeph">ADMIN</code> and <code class="codeph">DELEGATE</code> options are compatible; that is, you can grant both to a user, though you must do this in separate <code class="codeph">GRANT</code> statements for each option. To find if a user has been granted a role with these options, query the <code class="codeph">DELEGATE_OPTION</code> column or the <code class="codeph">ADMIN_OPTION</code> column of either the <code class="codeph">USER_ROLE_PRIVS</code> or <code class="codeph">DBA_ROLE_PRIVS</code> for the user.</p>
<p>The syntax for using the <code class="codeph">DELEGATE</code> and <code class="codeph">ADMIN</code> option is as follows:</p>
<pre dir="ltr">GRANT <span class="italic">role_list</span> to <span class="italic">user_list</span> WITH DELEGATE OPTION;

GRANT <span class="italic">role_list</span> to <span class="italic">user_list</span> WITH ADMIN OPTION;
</pre>
<p>For example:</p>
<pre dir="ltr">GRANT cb_role1 to usr1 WITH DELEGATE OPTION;

GRANT cb_role1 to usr1 WITH ADMIN OPTION;

GRANT cb_role1, cb_role2 to usr1, usr2 with DELEGATE OPTION;

GRANT cb_role1, cb_role2 to usr1, usr2 with ADMIN OPTION;
</pre>
<p>In a multitenant environment, you can use the <code class="codeph">DELEGATE</code> option for common grants such as granting common roles to common users, just as you can with the <code class="codeph">ADMIN</code> option.</p>
<p>For example:</p>
<pre dir="ltr">GRANT c##cb_role1 to c##usr1 WITH DELEGATE OPTION CONTAINER = ALL;
</pre>
<p>Be aware that CBAC grants themselves can only take place locally in a PDB.</p>
<div class="infoboxnotealso" id="GUID-CD18ADC1-2068-4250-881A-10836818A390__GUID-1F8D528E-8C11-4FB8-B17E-D883F047F9E6">
<p class="notep1">See Also:</p>
<p><a class="olink SQLRF55020" target="_blank" href="../SQLRF/statements_9014.htm#SQLRF55020"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for more information about the <code class="codeph">ADMIN</code> option</p>
</div>
</div>
</div>
<a id="DBSEG984"></a>
<div class="props_rev_3"><a id="GUID-7C59ADD4-BF48-4A16-A2AD-272F710EE48B"></a>
<h3 id="DBSEG-GUID-7C59ADD4-BF48-4A16-A2AD-272F710EE48B" class="sect3">Grants and Revokes of Database Roles to a Program Unit</h3>
<div>
<p>The <code class="codeph">GRANT</code> and <code class="codeph">REVOKE</code> statements can grant database roles to or revoke database roles from a program unit.</p>
<p>The following syntax to grants or revokes database roles for a PL/SQL function, procedure, or package:</p>
<pre dir="ltr">GRANT <span class="italic">role_list</span> TO <span class="italic">code_list</span> 
REVOKE {<span class="italic">role_list</span> | ALL} FROM <span class="italic">code_list</span>
 
</pre>
<p>In this specification:</p>
<pre dir="ltr">role_list ::=  <span class="italic">code-based_role_name</span>[, <span class="italic">role_list</span>]
code_list ::=  {
      {FUNCTION  [<span class="italic">schema</span>.]<span class="italic">function_name</span>}
   |  {PROCEDURE [<span class="italic">schema</span>.]<span class="italic">procedure_name</span>}
   |  {PACKAGE   [<span class="italic">schema</span>.]<span class="italic">package_name</span>}
                 }[, <span class="italic">code_list</span>]
</pre>
<p>For example:</p>
<pre dir="ltr">GRANT cb_role1 TO FUNCTION func1, PACKAGE pack1;

GRANT cb_role2, cb_role3 TO FUNCTION HR.func2, PACKAGE SYS.pack2;

REVOKE cb_role1 FROM FUNCTION func1, PACKAGE pack1;

REVOKE ALL FROM FUNCTION HR.func2, PACKAGE SYS.pack2;
</pre>
<div class="infoboxnotealso" id="GUID-7C59ADD4-BF48-4A16-A2AD-272F710EE48B__GUID-997DCD38-675C-4772-86CE-BBED0C27AA81">
<p class="notep1">See Also:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-D7E76448-152C-4207-9D48-FE562E0D911C" title="Code based access control roles can be granted to a program unit if a set of conditions are met.">Who Can Grant Code Based Access Control Roles to a Program Unit?</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-CD18ADC1-2068-4250-881A-10836818A390" title="The DELEGATE option in the GRANT statement can limit privilege grants to roles by users responsible for CBAC grants.">Grants of Database Roles to Users for Their CBAC Grants</a></p>
</li>
</ul>
</div>
</div>
</div>
<a id="DBSEG678"></a>
<div class="props_rev_3"><a id="GUID-1CBA23D1-FC6B-4544-A281-7D85071FF89D"></a>
<h3 id="DBSEG-GUID-1CBA23D1-FC6B-4544-A281-7D85071FF89D" class="sect3">Tutorial: Controlling Access to Sensitive Data Using Code Based Access Control</h3>
<div>
<p>This tutorial demonstrates how to control access to sensitive data in the <code class="codeph">HR</code> schema by using code based access control.</p>
<p>Topics:</p>
<ul style="list-style-type: disc;">
<li>
<p><a href="dr_ir.htm#GUID-CCB52926-DA6F-4063-8881-F4F180225837" title="In this tutorial, you will create a user who must have access to specific employee information for his department.">About This Tutorial</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-9C8DA467-25DF-4093-A004-E08E704821A1" title="To begin, you must create the &#34;Finance&#34; user account and then grant this the HR user the CREATE ROLE privilege.">Step 1: Create the User and Grant HR the CREATE ROLE Privilege</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-214608A1-D504-4E9C-81EF-BDBCB7631CD9" title="The print_employees invoker&#39;s rights procedure shows employee information in the current user&#39;s department.">Step 2: Create the print_employees Invoker&#39;s Rights Procedure</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-5B846F6A-87A3-482F-B3D8-E95D04DCF939" title="Next, you are ready to create the hr_clerk role, which must have the EXECUTE privilege on the print_employees procedure.">Step 3: Create the hr_clerk Role and Grant Privileges for It</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-7316DA6F-4746-43ED-81A6-DBB176227BD7" title="At this stage, you are ready to test the code based access control HR.print_employees procedure.">Step 4: Test the Code Based Access Control HR.print_employees Procedure</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-770D86DD-5B8C-4A11-B4CB-2488C8F0E64B" title="Next, user HR must create the view_emp_role role and then grant privileges to it.">Step 5: Create the view_emp_role Role and Grant Privileges for It</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-B124BA6A-E0C2-4C7E-9B0D-8FD7BD4810E2" title="With the appropriate privileges in place, user &#34;Finance&#34; can try the HR.print_employees procedure again.">Step 6: Test the HR.print_employees Procedure Again</a></p>
</li>
<li>
<p><a href="dr_ir.htm#GUID-AC53C480-FB4E-44D5-A08C-091ECD614417" title="If you no longer need the components of this tutorial, then you can remove them.">Step 7: Remove the Components of This Tutorial</a></p>
</li>
</ul>
</div>
<a id="DBSEG679"></a>
<div class="props_rev_3"><a id="GUID-CCB52926-DA6F-4063-8881-F4F180225837"></a>
<h4 id="DBSEG-GUID-CCB52926-DA6F-4063-8881-F4F180225837" class="sect4">About This Tutorial</h4>
<div>
<p>In this tutorial, you will create a user who must have access to specific employee information for his department.</p>
<p>However, the table <code class="codeph">HR.EMPLOYEES</code> contains sensitive information such as employee salaries, which must not be accessible to the user. You will implement access control using code based access control. The employee data will be shown to the user through an invoker&#39;s rights procedure. Instead of granting the <code class="codeph">SELECT</code> privilege directly to the user, you will grant the <code class="codeph">SELECT</code> privilege to the invoker&#39;s rights procedure through a database role. In the procedure, you will hide the sensitive information, such as salaries. Because the procedure is an invoker&#39;s rights procedure, you know the caller&#39;s context inside the procedure. In this case, the caller&#39;s context is for the Finance department. The user is named <code class="codeph">&#34;Finance&#34;</code>, so that only data for employees who work in the Finance department is accessible to the user.</p>
</div>
</div>
<a id="DBSEG680"></a>
<div class="props_rev_3"><a id="GUID-9C8DA467-25DF-4093-A004-E08E704821A1"></a>
<h4 id="DBSEG-GUID-9C8DA467-25DF-4093-A004-E08E704821A1" class="sect4">Step 1: Create the User and Grant HR the CREATE ROLE Privilege</h4>
<div>
<p>To begin, you must create the <code class="codeph">&#34;Finance&#34;</code> user account and then grant this the <code class="codeph">HR</code> user the <code class="codeph">CREATE ROLE</code> privilege.</p>
<ol>
<li class="stepexpand"><span>Log into the database instance as an administrator who has privileges to create user accounts and roles.</span>
<div>
<p>For example:</p>
<pre dir="ltr">sqlplus sec_admin
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Create the <code class="codeph">&#34;Finance&#34;</code> user account.</span>
<div>
<pre dir="ltr">GRANT CONNECT TO &#34;Finance&#34; IDENTIFIED BY <span class="italic">password</span>;
</pre>
<p>Ensure that you enter <code class="codeph">&#34;Finance&#34;</code> in the case shown, enclosed by double quotation marks. Replace <span class="italic"><code class="codeph">password</code></span> with a password that is secure. See <a href="authentication.htm#GUID-AA1AA635-1CD5-422E-B8CA-681ED7C253CA" title="Oracle provides a set of minimum requirements for passwords.">Minimum Requirements for Passwords</a> for more information.</p>
</div>
</li>
<li class="stepexpand"><span>Grant the <code class="codeph">CREATE ROLE</code> privilege to user <code class="codeph">HR</code>.</span>
<div>
<pre dir="ltr">GRANT CREATE ROLE TO HR;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="DBSEG681"></a>
<div class="props_rev_3"><a id="GUID-214608A1-D504-4E9C-81EF-BDBCB7631CD9"></a>
<h4 id="DBSEG-GUID-214608A1-D504-4E9C-81EF-BDBCB7631CD9" class="sect4">Step 2: Create the print_employees Invoker&#39;s Rights Procedure</h4>
<div>
<p>The <code class="codeph">print_employees</code> invoker&#39;s rights procedure shows employee information in the current user&#39;s department.</p>
<div class="section">You must create this procedure as an invoker&#39;s rights procedure because you must know who the caller is when inside the procedure.</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Connect as user <code class="codeph">HR</code>.</span>
<div>
<pre dir="ltr">CONNECT HR
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Create the <code class="codeph">print_employees</code> procedure as follows.</span>
<div>
<pre dir="ltr">create or replace procedure print_employees
authid current_user
as 
begin
  dbms_output.put_line(rpad(&#39;ID&#39;, 10) ||
                       rpad(&#39;First Name&#39;, 15)  ||
                       rpad(&#39;Last Name&#39;, 15)   ||
                       rpad(&#39;Email&#39;, 15)       ||
                       rpad(&#39;Phone Number&#39;, 20));
  for rec in (select e.employee_id, e.first_name, e.last_name, 
                     e.email, e.phone_number
                from hr.employees e, hr.departments d 
               where e.department_id = d.department_id
                 and d.department_name = 
                     sys_context(&#39;userenv&#39;, &#39;current_user&#39;))
  loop
    dbms_output.put_line(rpad(rec.employee_ID, 10)  ||
                         rpad(rec.first_name, 15)   || 
                         rpad(rec.last_name, 15)    ||
                         rpad(rec.email, 15)        ||
                         rpad(rec.phone_number, 20));
  end loop;
end;
/
</pre>
<p>In this example:</p>
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">dbms_output.put_line</code> prints the table header.</p>
</li>
<li>
<p><code class="codeph">for rec in (select ...</code> finds the employee information for the caller&#39;s department, which for this tutorial is the Finance department for user <code class="codeph">&#34;Finance&#34;</code>. Had you created a user named <code class="codeph">&#34;Marketing&#34;</code> (which is also listed in the <code class="codeph">DEPARTMENT_NAME</code> column of the <code class="codeph">HR.EMPLOYEES</code> table), then the procedure could capture information for Marketing employees.</p>
</li>
<li>
<p><code class="codeph">loop</code> and <code class="codeph">dbms_output.put_line</code> populate the output with the employee data from the Finance department.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<a id="DBSEG682"></a>
<div class="props_rev_3"><a id="GUID-5B846F6A-87A3-482F-B3D8-E95D04DCF939"></a>
<h4 id="DBSEG-GUID-5B846F6A-87A3-482F-B3D8-E95D04DCF939" class="sect4">Step 3: Create the hr_clerk Role and Grant Privileges for It</h4>
<div>
<p>Next, you are ready to create the <code class="codeph">hr_clerk</code> role, which must have the <code class="codeph">EXECUTE</code> privilege on the <code class="codeph">print_employees</code> procedure.</p>
<div class="section">After you create this role, you must grant it to <code class="codeph">&#34;Finance&#34;</code>.</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Create the <code class="codeph">hr_clerk</code> role.</span>
<div>
<pre dir="ltr">CREATE ROLE hr_clerk;
</pre></div>
</li>
<li class="stepexpand"><span>Grant the <code class="codeph">EXECUTE</code> privilege on the print_employees procedure to the <code class="codeph">hr_clerk</code> role.</span>
<div>
<pre dir="ltr">GRANT EXECUTE ON print_employees TO hr_clerk;
</pre></div>
</li>
<li class="stepexpand"><span>Grant the <code class="codeph">hr_clerk</code> role to <code class="codeph">&#34;Finance&#34;</code>.</span>
<div>
<pre dir="ltr">GRANT hr_clerk TO &#34;Finance&#34;;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="DBSEG683"></a>
<div class="props_rev_3"><a id="GUID-7316DA6F-4746-43ED-81A6-DBB176227BD7"></a>
<h4 id="DBSEG-GUID-7316DA6F-4746-43ED-81A6-DBB176227BD7" class="sect4">Step 4: Test the Code Based Access Control HR.print_employees Procedure</h4>
<div>
<p>At this stage, you are ready to test the code based access control <code class="codeph">HR.print_employees</code> procedure.</p>
<div class="section">To test the code based access control <code class="codeph">HR.print_employees</code> procedure, user <code class="codeph">&#34;Finance&#34;</code> must query the <code class="codeph">HR.EMPLOYEES</code> table and try to run the <code class="codeph">HR.print_employees</code> procedure.</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Connect to the database instance as user <code class="codeph">&#34;Finance&#34;</code>.</span>
<div>
<pre dir="ltr">CONNECT &#34;Finance&#34;
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Try to directly query the <code class="codeph">HR.EMPLOYEES</code> table.</span>
<div>
<pre dir="ltr">SELECT EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY FROM HR.EMPLOYEES;
</pre>
<p>The query fails because user <code class="codeph">Finance</code> does not have the <code class="codeph">SELECT</code> privilege for <code class="codeph">HR.EMPLOYEES</code>.</p>
<pre dir="ltr">ERROR at line 1:
ORA-00942: table or view does not exist
</pre></div>
</li>
<li class="stepexpand"><span>Execute the <code class="codeph">HR.print_employees</code> procedure.</span>
<div>
<pre dir="ltr">EXEC HR.print_employees;
</pre>
<p>The query fails because user <code class="codeph">&#34;Finance&#34;</code> does not have the appropriate privileges.</p>
<pre dir="ltr">ERROR at line 1:
ORA-00942: table or view does not exist
ORA-06512: at &#34;HR.PRINT_EMPLOYEES&#34;, line 13ORA-06512: at line 1
</pre></div>
</li>
</ol>
</div>
</div>
<a id="DBSEG684"></a>
<div class="props_rev_3"><a id="GUID-770D86DD-5B8C-4A11-B4CB-2488C8F0E64B"></a>
<h4 id="DBSEG-GUID-770D86DD-5B8C-4A11-B4CB-2488C8F0E64B" class="sect4">Step 5: Create the view_emp_role Role and Grant Privileges for It</h4>
<div>
<p>Next, user <code class="codeph">HR</code> must create the <code class="codeph">view_emp_role</code> role and then grant privileges to it.</p>
<div class="section">User <code class="codeph">HR</code> grants the <code class="codeph">SELECT</code> privilege <code class="codeph">HR.EMPLOYEES</code> and <code class="codeph">HR.DEPARTMENTS</code> to the <code class="codeph">view_emp_role</code> role, and then grants <code class="codeph">SELECT</code> on <code class="codeph">HR.EMPLOYEES</code> and <code class="codeph">HR.DEPARTMENTS</code> to the <code class="codeph">view_emp_role</code> role.</div>
<!-- class="section" -->
<ol>
<li class="stepexpand"><span>Connect as user <code class="codeph">HR</code>.</span>
<div>
<pre dir="ltr">CONNECT HR
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Create the <code class="codeph">view_emp_role</code> role.</span>
<div>
<pre dir="ltr">CREATE ROLE view_emp_role;
</pre></div>
</li>
<li class="stepexpand"><span>Grant the <code class="codeph">SELECT</code> privilege on <code class="codeph">HR.EMPLOYEES</code> and <code class="codeph">HR.DEPARTMENTS</code> to the <code class="codeph">view_emp_role</code> role.</span>
<div>
<pre dir="ltr">GRANT SELECT ON HR.EMPLOYEES TO view_emp_role;
GRANT SELECT ON HR.DEPARTMENTS TO view_emp_role;
</pre></div>
</li>
<li class="stepexpand"><span>Grant the <code class="codeph">view_emp_role</code> role to the <code class="codeph">HR.print_employees</code> invoker&#39;s rights procedure.</span>
<div>
<pre dir="ltr">GRANT view_emp_role TO PROCEDURE HR.print_employees;
</pre></div>
</li>
</ol>
</div>
</div>
<a id="DBSEG685"></a>
<div class="props_rev_3"><a id="GUID-B124BA6A-E0C2-4C7E-9B0D-8FD7BD4810E2"></a>
<h4 id="DBSEG-GUID-B124BA6A-E0C2-4C7E-9B0D-8FD7BD4810E2" class="sect4">Step 6: Test the HR.print_employees Procedure Again</h4>
<div>
<p>With the appropriate privileges in place, user <code class="codeph">&#34;Finance&#34;</code> can try the <code class="codeph">HR.print_employees</code> procedure again.</p>
<ol>
<li class="stepexpand"><span>Connect as user <code class="codeph">&#34;Finance&#34;</code>.</span>
<div>
<pre dir="ltr">CONNECT &#34;Finance&#34;
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Set the server output to display.</span>
<div>
<pre dir="ltr">SET SERVEROUTPUT ON;
</pre></div>
</li>
<li class="stepexpand"><span>Try to directly query the <code class="codeph">HR.EMPLOYEES</code> table.</span>
<div>
<pre dir="ltr">SELECT EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY FROM HR.EMPLOYEES;
</pre>
<p>The query fails.</p>
<pre dir="ltr">ERROR at line 1:
ORA-00942: table or view does not exist
</pre></div>
</li>
<li class="stepexpand"><span>Execute the <code class="codeph">HR.print_employees</code> procedure to show the employee information.</span>
<div>
<pre dir="ltr">EXEC HR.print_employees;
</pre>
<p>The call succeeds.</p>
<pre dir="ltr">ID        First Name     Last Name      Email          Phone Number
108       Nancy          Greenberg      NGREENBE       515.124.4569
109       Daniel         Faviet         DFAVIET        515.124.4169
110       John           Chen           JCHEN          515.124.4269
111       Ismael         Sciarra        ISCIARRA       515.124.4369
112       Jose Manuel    Urman          JMURMAN        515.124.4469
113       Luis           Popp           LPOPP          515.124.4567

PL/SQL procedure successfully completed.
</pre></div>
</li>
</ol>
</div>
</div>
<a id="DBSEG947"></a>
<div class="props_rev_3"><a id="GUID-AC53C480-FB4E-44D5-A08C-091ECD614417"></a>
<h4 id="DBSEG-GUID-AC53C480-FB4E-44D5-A08C-091ECD614417" class="sect4">Step 7: Remove the Components of This Tutorial</h4>
<div>
<p>If you no longer need the components of this tutorial, then you can remove them.</p>
<ol>
<li class="stepexpand"><span>Connect as a user with administrative privileges.</span>
<div>
<p>For example:</p>
<pre dir="ltr">CONNECT sec_admin
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Drop the user <code class="codeph">&#34;Finance&#34;</code>.</span>
<div>
<pre dir="ltr">DROP USER &#34;Finance&#34;;
</pre></div>
</li>
<li class="stepexpand"><span>Drop the <code class="codeph">hr_clerk</code> role.</span>
<div>
<pre dir="ltr">DROP ROLE hr_clerk;
</pre></div>
</li>
<li class="stepexpand"><span>Connect as user <code class="codeph">HR</code>.</span>
<div>
<pre dir="ltr">CONNECT HR
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Drop the view_emp_role role and the <code class="codeph">HR.print_employees</code> procedure.</span>
<div>
<pre dir="ltr">DROP ROLE view_emp_role;
DROP PROCEDURE print_employees;
</pre></div>
</li>
<li class="stepexpand"><span>Connect as the administrative user.</span>
<div>
<pre dir="ltr">CONNECT sec_admin
Enter password: <span class="italic">password</span>
</pre></div>
</li>
<li class="stepexpand"><span>Revoke the <code class="codeph">CREATE ROLE</code> privilege from <code class="codeph">HR</code>.</span>
<div>
<pre dir="ltr">REVOKE CREATE ROLE FROM HR;
</pre></div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment3670">
<tr>
<td class="cellalignment3684">
<table class="cellalignment3675">
<tr>
<td class="cellalignment3674"><a href="authorization.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment3674"><a href="fine_grained_access.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2006, 2017, Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment3686">
<table class="cellalignment3673">
<tr>
<td class="cellalignment3674"><a href="../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment3674"><a href="../nav/portal_booklist.htm"><img width="24" height="24" src="../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td class="cellalignment3674"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment3674"><a href="index.htm"><img width="24" height="24" src="../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment3674"><a href="../nav/mindx.htm"><img width="24" height="24" src="../dcommon/gifs/masterix.gif" alt="Go to Master Index" /><br />
<span class="icon">Master Index</span></a></td>
<td class="cellalignment3674"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


</body></html>